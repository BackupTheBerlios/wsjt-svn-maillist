<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [WSJT-SVN] r1164 - branches/wspr
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/wsjt-svn/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r1164%20-%20branches/wspr&In-Reply-To=%3C200904260351.n3Q3p5qe022379%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000854.html">
   <LINK REL="Next"  HREF="000856.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[WSJT-SVN] r1164 - branches/wspr</H1>
    <B>va3db at BerliOS</B> 
    <A HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r1164%20-%20branches/wspr&In-Reply-To=%3C200904260351.n3Q3p5qe022379%40sheep.berlios.de%3E"
       TITLE="[WSJT-SVN] r1164 - branches/wspr">va3db at mail.berlios.de
       </A><BR>
    <I>Sun Apr 26 05:51:05 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000854.html">[WSJT-SVN] r1163 - trunk
</A></li>
        <LI>Next message: <A HREF="000856.html">[WSJT-SVN] r1165 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#855">[ date ]</a>
              <a href="thread.html#855">[ thread ]</a>
              <a href="subject.html#855">[ subject ]</a>
              <a href="author.html#855">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: va3db
Date: 2009-04-26 05:51:03 +0200 (Sun, 26 Apr 2009)
New Revision: 1164

Added:
   branches/wspr/wspr
Modified:
   branches/wspr/Makefile.in
   branches/wspr/configure
   branches/wspr/configure.ac
Log:
- Clean up configure and install.
- Add a wspr wrapper.



Modified: branches/wspr/Makefile.in
===================================================================
--- branches/wspr/Makefile.in	2009-04-26 03:07:46 UTC (rev 1163)
+++ branches/wspr/Makefile.in	2009-04-26 03:51:03 UTC (rev 1164)
@@ -1,11 +1,13 @@
 MV ?= mv
 MKDIR ?= mkdir
+INSTALL=	install
 CC ?= @CC@
 FFLAGS	= @FFLAGS@
 LDFLAGS	= @LDFLAGS@
 LIBS	= @LIBS@
 CPPFLAGS = @CPPFLAGS@
 CFLAGS	= @CFLAGS@
+PREFIX	= @PREFIX@
 # ${CFLAGS}# WSPR specific C flags
 CFLAGS	+= -DBIGSYM=1 -fPIC
 DEFS = @DEFS@
@@ -30,9 +32,9 @@
 OS=@OS@
 FC=@FC@
 FCV=@FCV@
-COMPILER += @FC_LIB_PATH@
+FC_LIB_PATH	+= @FC_LIB_PATH@
 
-LDFLAGS	+= -L${COMPILER}
+LDFLAGS	+= -L${FC_LIB_PATH}
 
 PYTHON	?= @PYTHON@
 RM	?= @RM@
@@ -94,9 +96,15 @@
 	$(FC) -c $(FFLAGS) wspr_rxtest.f90
 
 .PHONY : clean
+install:	WsprMod/w.so
+	${RM} -rf build/
+	${PYTHON} setup.py install
+	${INSTALL} wspr ${PREFIX}/bin
+
 clean:
 	${RM} -f *.o *.pyc *.pyo WsprMod/*.pyc WsprMod/*.pyo WsprMod/w.so \
 		WsprMod/*.so wspr wspr_rxtest w.so wspr.spec *~
+	${RM} -rf build/
 
 distclean:
 	${RM} -f config.log config.status Makefile

Modified: branches/wspr/configure
===================================================================
--- branches/wspr/configure	2009-04-26 03:07:46 UTC (rev 1163)
+++ branches/wspr/configure	2009-04-26 03:51:03 UTC (rev 1164)
@@ -2,7 +2,7 @@
 # Guess values for system-dependent variables and create Makefiles.
 # Generated by GNU Autoconf 2.62 for wspr 0.8.
 #
-# $Id: configure.ac 853 2008-06-07 17:22:14Z va3db $
+# $Id: configure.ac 1145 2009-04-23 15:32:14Z va3db $
 #
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 # 2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
@@ -703,12 +703,13 @@
 F2PY
 G95
 GFORTRAN
-OS
 VERSION
+OS
 CLOBBER
 FC_LIB_PATH
 FC
 FCV
+PREFIX
 LOCAL_PORTAUDIO
 LOCAL_PORTAUDIO_CLEAN
 LIBOBJS
@@ -1453,7 +1454,7 @@
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 
-$Id: configure.ac 853 2008-06-07 17:22:14Z va3db $
+$Id: configure.ac 1145 2009-04-23 15:32:14Z va3db $
 _ACEOF
   exit
 fi
@@ -1827,8 +1828,6 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-rev=`echo &quot;$Rev: 848 $&quot;|awk '{print $2}'`
-version=&quot;0.8 r${rev}&quot;
 fail=0
 
 
@@ -3049,6 +3048,11 @@
 LIBS=&quot; -lpthread ${LIBS}&quot;
 FCV=&quot;&quot;
 
+
+if test -n ${FC} ; then
+	gfortran=${FC}
+fi
+
 { $as_echo &quot;$as_me:$LINENO: checking uname -s for Cygwin, Solaris or HPUX&quot; &gt;&amp;5
 $as_echo_n &quot;checking uname -s for Cygwin, Solaris or HPUX... &quot; &gt;&amp;6; }
 case `uname -s` in
@@ -3066,12 +3070,22 @@
 _ACEOF
 
 	;;
+        FreeBSD*)
+		if test -z ${gfortran} ; then
+			gfortran=`grep FC: /usr/ports/Mk/bsd.gcc.mk | head -1 |awk '{print $2}'`
+		fi
+	;;
 	*)
 		{ $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
 $as_echo &quot;no&quot; &gt;&amp;6; }
 	;;
 esac
 
+
+if test -z $gfortran ; then
+	gfortran=&quot;gfortran&quot;
+fi
+
 if test &quot;$ac_cv_c_compiler_gnu&quot; = yes; then
 	{ $as_echo &quot;$as_me:$LINENO: checking if $CC is Apple GCC&quot; &gt;&amp;5
 $as_echo_n &quot;checking if $CC is Apple GCC... &quot; &gt;&amp;6; }
@@ -4270,13 +4284,8 @@
 fi
 
 
-{ $as_echo &quot;$as_me:$LINENO: checking g95 lib path&quot; &gt;&amp;5
-$as_echo_n &quot;checking g95 lib path... &quot; &gt;&amp;6; }
-G95_LIB_PATH=`${G95} -print-file-name=`
-{ $as_echo &quot;$as_me:$LINENO: result: ${G95_LIB_PATH}&quot; &gt;&amp;5
-$as_echo &quot;${G95_LIB_PATH}&quot; &gt;&amp;6; }
-# Extract the first word of &quot;gfortran&quot;, so it can be a program name with args.
-set dummy gfortran; ac_word=$2
+# Extract the first word of &quot;${gfortran}&quot;, so it can be a program name with args.
+set dummy ${gfortran}; ac_word=$2
 { $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
 $as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_GFORTRAN+set}&quot; = set; then
@@ -4315,60 +4324,15 @@
 fi
 
 
-# Extract the first word of &quot;gfortran43&quot;, so it can be a program name with args.
-set dummy gfortran43; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_GFORTRAN+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $GFORTRAN in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_GFORTRAN=&quot;$GFORTRAN&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_GFORTRAN=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+VERSION=&quot;${version}&quot;
 
-  ;;
-esac
-fi
-GFORTRAN=$ac_cv_path_GFORTRAN
-if test -n &quot;$GFORTRAN&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $GFORTRAN&quot; &gt;&amp;5
-$as_echo &quot;$GFORTRAN&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking gfortran lib path&quot; &gt;&amp;5
-$as_echo_n &quot;checking gfortran lib path... &quot; &gt;&amp;6; }
-GFORTRAN_LIB_PATH=`${GFORTRAN} -print-file-name=`
-{ $as_echo &quot;$as_me:$LINENO: result: ${GFORTRAN_LIB_PATH}&quot; &gt;&amp;5
-$as_echo &quot;${GFORTRAN_LIB_PATH}&quot; &gt;&amp;6; }
 { $as_echo &quot;$as_me:$LINENO: checking OS&quot; &gt;&amp;5
 $as_echo_n &quot;checking OS... &quot; &gt;&amp;6; }
 OS=`uname`
 OS=&quot;${OS}&quot;
 
-VERSION=&quot;${version}&quot;
 
 
-
 { $as_echo &quot;$as_me:$LINENO: checking for ANSI C header files&quot; &gt;&amp;5
 $as_echo_n &quot;checking for ANSI C header files... &quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_stdc+set}&quot; = set; then
@@ -5204,14 +5168,8 @@
 
 fi
 
-
 if test &quot;$prefix&quot; = &quot;NONE&quot;; then
-
-cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PREFIX &quot;$ac_default_prefix&quot;
-_ACEOF
-
-
+	prefix=${ac_default_prefix}
 else
 
 
@@ -5224,10 +5182,7 @@
 
 fi
 
-ac_config_files=&quot;$ac_config_files Makefile setup.py&quot;
 
-
-
 # Check whether --enable-g95 was given.
 if test &quot;${enable_g95+set}&quot; = set; then
   enableval=$enable_g95; g95=$enableval
@@ -5246,9 +5201,9 @@
 
 
 if test ! -z $GFORTRAN ; then
-	echo &quot;*** gfortran compiler found&quot;
+	echo &quot;*** gfortran compiler found at ${GFORTRAN}&quot;
 	if test &quot;$gfortran&quot; = yes; then
-       		FC_LIB_PATH=${GFORTRAN_LIB_PATH}
+       		FC_LIB_PATH=`${GFORTRAN} -print-file-name=`
 		FC=`basename ${GFORTRAN}`
 		g95=no
 		FFLAGS=&quot;$FFLAGS -fno-range-check -ffixed-line-length-none&quot;
@@ -5261,7 +5216,7 @@
 if test ! -z $G95 ; then
 	echo &quot;*** g95 compiler found&quot;
 	if test &quot;$g95&quot; = yes; then
-		FC_LIB_PATH=${G95_LIB_PATH}
+       		FC_LIB_PATH=`${G95} -print-file-name=`
 		FC=`basename ${G95}`
 		gfortran=no
 		FFLAGS=&quot;${FFLAGS} -ftrace=full -cpp&quot;
@@ -5276,7 +5231,7 @@
 		if test &quot;$g95&quot; = yes; then
 			echo &quot;You enabled g95, but no g95 compiler found, defaulting to gfortran instead&quot;
 		fi
-       		FC_LIB_PATH=${GFORTRAN_LIB_PATH}
+       		FC_LIB_PATH=`${GFORTRAN} -print-file-name=`
 	        FC=`basename ${GFORTRAN}`
 		g95=no
 		gfortran=yes
@@ -5286,7 +5241,7 @@
 		if test &quot;$gfortran&quot; = yes; then
 			echo &quot;You enabled gfortran, but no gfortran compiler found, defaulting to g95 instead&quot;
 		fi
-       		FC_LIB_PATH=${G95_LIB_PATH}
+       		FC_LIB_PATH=`${G95} -print-file-name=`
 	        FC=`basename ${G95}`
 		g95=yes
 		gfortran=no
@@ -5311,8 +5266,10 @@
 
 FCV=&quot;${FCV}&quot;
 
+PREFIX=&quot;${prefix}&quot;
 
 
+
 { $as_echo &quot;$as_me:$LINENO: checking for a v19 portaudio &quot; &gt;&amp;5
 $as_echo_n &quot;checking for a v19 portaudio ... &quot; &gt;&amp;6; }
 
@@ -5557,6 +5514,7 @@
 
 LOCAL_PORTAUDIO_CLEAN=&quot;${LOCAL_PORTAUDIO_CLEAN}&quot;
 
+ac_config_files=&quot;$ac_config_files Makefile&quot;
 
 cat &gt;confcache &lt;&lt;\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -6161,7 +6119,6 @@
 do
   case $ac_config_target in
     &quot;Makefile&quot;) CONFIG_FILES=&quot;$CONFIG_FILES Makefile&quot; ;;
-    &quot;setup.py&quot;) CONFIG_FILES=&quot;$CONFIG_FILES setup.py&quot; ;;
 
   *) { { $as_echo &quot;$as_me:$LINENO: error: invalid argument: $ac_config_target&quot; &gt;&amp;5
 $as_echo &quot;$as_me: error: invalid argument: $ac_config_target&quot; &gt;&amp;2;}
@@ -6669,6 +6626,7 @@
 
 
 
+
 echo
 echo
 

Modified: branches/wspr/configure.ac
===================================================================
--- branches/wspr/configure.ac	2009-04-26 03:07:46 UTC (rev 1163)
+++ branches/wspr/configure.ac	2009-04-26 03:51:03 UTC (rev 1164)
@@ -3,13 +3,11 @@
 
 dnl AC_PREREQ(2.61)
 
-dnl Sneaky way to get an Id tag into the configure script
+dnl This should be a svn hook instead.
+dnl Sneakier way to get a Version into setup.py
 AC_COPYRIGHT([$Id$])
 
 AC_INIT([wspr],[0.8])
-dnl Sneakier way to get a Version into setup.py
-rev=`echo &quot;$Rev: 848 $&quot;|awk '{print $2}'`
-version=&quot;0.8 r${rev}&quot;
 fail=0
 
 AC_PREFIX_DEFAULT(/usr/local/)
@@ -29,6 +27,15 @@
 LIBS=&quot; -lpthread ${LIBS}&quot;
 FCV=&quot;&quot;
 
+dnl
+dnl Pick up FC from the environment if present
+dnl I'll add a test to confirm this is a gfortran later -db
+dnl
+
+if test -n ${FC} ; then
+	gfortran=${FC}
+fi
+
 AC_MSG_CHECKING([uname -s for Cygwin, Solaris or HPUX])
 case `uname -s` in
 	CYGWIN*)
@@ -39,11 +46,27 @@
 		AC_MSG_RESULT(SunOS or Solaris)
 		AC_DEFINE(__EXTENSIONS__, 1, [This is needed to use strtok_r on Solaris.])
 	;;
+dnl
+dnl Pick up current gfortran from ports infrastructure for fbsd
+dnl
+        FreeBSD*)
+		if test -z ${gfortran} ; then
+			gfortran=`grep FC: /usr/ports/Mk/bsd.gcc.mk | head -1 |awk '{print $2}'`
+		fi
+	;;
 	*)
 		AC_MSG_RESULT(no)
 	;;
 esac
 
+dnl
+dnl look for gfortran if nothing else was given
+dnl
+
+if test -z $gfortran ; then
+	gfortran=&quot;gfortran&quot;
+fi
+
 if test &quot;$ac_cv_c_compiler_gnu&quot; = yes; then
 	AC_MSG_CHECKING(if $CC is Apple GCC)
 	
@@ -87,18 +110,11 @@
 AC_PATH_PROG(PYTHON, python)
 AC_PATH_PROG(F2PY, f2py)
 AC_PATH_PROG(G95, g95)
-AC_MSG_CHECKING([g95 lib path])
-G95_LIB_PATH=`${G95} -print-file-name=`
-AC_MSG_RESULT(${G95_LIB_PATH})
-AC_PATH_PROG(GFORTRAN, gfortran)
-AC_PATH_PROG(GFORTRAN, gfortran43)
-AC_MSG_CHECKING([gfortran lib path])
-GFORTRAN_LIB_PATH=`${GFORTRAN} -print-file-name=`
-AC_MSG_RESULT(${GFORTRAN_LIB_PATH})
+AC_PATH_PROG(GFORTRAN, ${gfortran})
+AC_SUBST(VERSION, &quot;${version}&quot;)
 AC_MSG_CHECKING([OS])
 OS=`uname`
 AC_SUBST(OS, &quot;${OS}&quot;)
-AC_SUBST(VERSION, &quot;${version}&quot;)
 
 dnl Checks for header files.
 
@@ -153,10 +169,8 @@
 	AC_DEFINE(NDEBUG, 1, [Define this to disable debugging support.])
 fi
 
-
 if test &quot;$prefix&quot; = &quot;NONE&quot;; then 
-	AC_DEFINE_UNQUOTED(PREFIX, &quot;$ac_default_prefix&quot;, [Prefix where wspr is installed.])
-
+	prefix=${ac_default_prefix}
 else
 
 dnl Don't get bitten by Cygwin's stupidity if the user specified
@@ -167,10 +181,6 @@
 	
 fi
 
-AC_CONFIG_FILES(		\
-	Makefile setup.py
-)
-
 dnl pick gfortran or g95
 dnl ====================
 
@@ -186,9 +196,9 @@
 dnl ====================================================
 
 if test ! -z $GFORTRAN ; then
-	echo &quot;*** gfortran compiler found&quot;
+	echo &quot;*** gfortran compiler found at ${GFORTRAN}&quot;
 	if test &quot;$gfortran&quot; = yes; then
-       		FC_LIB_PATH=${GFORTRAN_LIB_PATH}
+       		FC_LIB_PATH=`${GFORTRAN} -print-file-name=`
 		FC=`basename ${GFORTRAN}`
 		g95=no
 		FFLAGS=&quot;$FFLAGS -fno-range-check -ffixed-line-length-none&quot;
@@ -201,7 +211,7 @@
 if test ! -z $G95 ; then
 	echo &quot;*** g95 compiler found&quot;
 	if test &quot;$g95&quot; = yes; then
-		FC_LIB_PATH=${G95_LIB_PATH}
+       		FC_LIB_PATH=`${G95} -print-file-name=`
 		FC=`basename ${G95}`
 		gfortran=no
 		FFLAGS=&quot;${FFLAGS} -ftrace=full -cpp&quot;
@@ -219,7 +229,7 @@
 		if test &quot;$g95&quot; = yes; then
 			echo &quot;You enabled g95, but no g95 compiler found, defaulting to gfortran instead&quot;
 		fi
-       		FC_LIB_PATH=${GFORTRAN_LIB_PATH}
+       		FC_LIB_PATH=`${GFORTRAN} -print-file-name=`
 	        FC=`basename ${GFORTRAN}`
 		g95=no
 		gfortran=yes
@@ -229,7 +239,7 @@
 		if test &quot;$gfortran&quot; = yes; then
 			echo &quot;You enabled gfortran, but no gfortran compiler found, defaulting to g95 instead&quot;
 		fi
-       		FC_LIB_PATH=${G95_LIB_PATH}
+       		FC_LIB_PATH=`${G95} -print-file-name=`
 	        FC=`basename ${G95}`
 		g95=yes
 		gfortran=no
@@ -243,6 +253,7 @@
 AC_DEFINE_UNQUOTED(FC, &quot;${FC}&quot;, [Fortran compiler.])
 AC_SUBST(FC, &quot;${FC}&quot;)
 AC_SUBST(FCV, &quot;${FCV}&quot;)
+AC_SUBST(PREFIX, &quot;${prefix}&quot;)
 
 dnl set defaults
 dnl ============
@@ -340,10 +351,10 @@
 AC_SUBST(FFLAGS)
 AC_SUBST(LOCAL_PORTAUDIO,&quot;${LOCAL_PORTAUDIO}&quot;)
 AC_SUBST(LOCAL_PORTAUDIO_CLEAN,&quot;${LOCAL_PORTAUDIO_CLEAN}&quot;)
-
+AC_CONFIG_FILES(Makefile)
 AC_OUTPUT
-dnl AC_CONFIG_FILES(Makefile)
 
+
 dnl do summary
 
 echo

Added: branches/wspr/wspr
===================================================================
--- branches/wspr/wspr	2009-04-26 03:07:46 UTC (rev 1163)
+++ branches/wspr/wspr	2009-04-26 03:51:03 UTC (rev 1164)
@@ -0,0 +1,12 @@
+#!/bin/sh
+if [ -e /usr/local/bin/python ] ; then
+	LOCALBASE=/usr/local/
+else
+	LOCALBASE=/usr/
+fi
+if [ ! -e ~/.wspr ] ; then
+	mkdir ~/.wspr
+	mkdir ~/.wspr/save
+fi
+cd ~/.wspr
+python ${LOCALBASE}/bin/wspr.py


Property changes on: branches/wspr/wspr
___________________________________________________________________
Name: svn:executable
   + *


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000854.html">[WSJT-SVN] r1163 - trunk
</A></li>
	<LI>Next message: <A HREF="000856.html">[WSJT-SVN] r1165 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#855">[ date ]</a>
              <a href="thread.html#855">[ thread ]</a>
              <a href="subject.html#855">[ subject ]</a>
              <a href="author.html#855">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/wsjt-svn">More information about the wsjt-svn
mailing list</a><br>
</body></html>
