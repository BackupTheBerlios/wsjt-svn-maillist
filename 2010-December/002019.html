<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [WSJT-SVN] r2327 - in branches/wspr: . WsprModNoGui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/wsjt-svn/2010-December/index.html" >
   <LINK REL="made" HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r2327%20-%20in%20branches/wspr%3A%20.%20WsprModNoGui&In-Reply-To=%3C20101229055818.DA49D480646%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002018.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[WSJT-SVN] r2327 - in branches/wspr: . WsprModNoGui</H1>
    <B>sivan_toledo at mail.berlios.de</B> 
    <A HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r2327%20-%20in%20branches/wspr%3A%20.%20WsprModNoGui&In-Reply-To=%3C20101229055818.DA49D480646%40sheep.berlios.de%3E"
       TITLE="[WSJT-SVN] r2327 - in branches/wspr: . WsprModNoGui">sivan_toledo at mail.berlios.de
       </A><BR>
    <I>Wed Dec 29 06:58:18 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002018.html">[WSJT-SVN] r2326 - branches/wspr
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2019">[ date ]</a>
              <a href="thread.html#2019">[ thread ]</a>
              <a href="subject.html#2019">[ subject ]</a>
              <a href="author.html#2019">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: sivan_toledo
Date: 2010-12-29 06:58:18 +0100 (Wed, 29 Dec 2010)
New Revision: 2327

Added:
   branches/wspr/WsprModNoGui/
   branches/wspr/WsprModNoGui/__init__.py
   branches/wspr/WsprModNoGui/advanced.py
   branches/wspr/WsprModNoGui/g.py
   branches/wspr/WsprModNoGui/hopping.py
   branches/wspr/WsprModNoGui/iq.py
   branches/wspr/WsprModNoGui/options.py
   branches/wspr/WsprModNoGui/palettes.py
   branches/wspr/tkrep.py
   branches/wspr/wspr_nogui.py
   branches/wspr/wspr_nogui.txt
Log:
A prototype of no-gui WSPR

Added: branches/wspr/WsprModNoGui/__init__.py
===================================================================
Added: branches/wspr/WsprModNoGui/advanced.py
===================================================================
--- branches/wspr/WsprModNoGui/advanced.py	                        (rev 0)
+++ branches/wspr/WsprModNoGui/advanced.py	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,14 @@
+import g
+from tkrep import *
+
+idint=IntVar()
+bfofreq=IntVar()
+idint=IntVar()
+igrid6=IntVar()
+isc1=IntVar()
+isc1.set(0)
+encal=IntVar()
+fset=IntVar()
+Acal=DoubleVar()
+Bcal=DoubleVar()
+fset.set(0)

Added: branches/wspr/WsprModNoGui/g.py
===================================================================
--- branches/wspr/WsprModNoGui/g.py	                        (rev 0)
+++ branches/wspr/WsprModNoGui/g.py	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,32 @@
+DFreq=0.0
+Freq=0.0
+PingTime=0.0
+PingFile=&quot;current&quot;
+report=&quot;26&quot;
+rms=1.0
+mode_change=0
+showspecjt=0
+g2font='courier 16 bold'
+
+#------------------------------------------------------ ftnstr
+def ftnstr(x):
+    y=&quot;&quot;
+    xs=x.tostring()
+    for i in range(len(xs)):
+        y=y+xs[i]
+    return y
+
+#------------------------------------------------------ filetime
+def filetime(t):
+#    i=t.rfind(&quot;.&quot;)
+    i=rfnd(t,&quot;.&quot;)
+    t=t[:i][-6:]
+    t=t[0:2]+&quot;:&quot;+t[2:4]+&quot;:&quot;+t[4:6]
+    return t
+
+#------------------------------------------------------ rfnd
+#Temporary workaround to replace t.rfind(c)
+def rfnd(t,c):
+    for i in range(len(t)-1,0,-1):
+        if t[i:i+1]==c: return i
+    return -1

Added: branches/wspr/WsprModNoGui/hopping.py
===================================================================
--- branches/wspr/WsprModNoGui/hopping.py	                        (rev 0)
+++ branches/wspr/WsprModNoGui/hopping.py	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,55 @@
+import os,time
+import g
+from tkrep import *
+
+bandlabels=['dummy','600 m','160 m','80 m','60 m','40 m','30 m',\
+            '20 m','17 m','15 m','12 m','10 m','6 m','4 m','2 m',\
+            'Other']
+
+coord_bands=IntVar()
+coord_bands.set(1)
+hopping=IntVar()
+hopping.set(0)
+hoppingconfigured=IntVar()
+hoppingconfigured.set(0)
+bhopping   =range(len(bandlabels))
+shopping   =range(len(bandlabels))
+lhopping   =range(len(bandlabels))
+hoppingflag=range(len(bandlabels))
+hoppingpctx=range(len(bandlabels))
+btuneup    =range(len(bandlabels))
+tuneupflag =range(len(bandlabels))
+
+for r in range(1,16):
+    hoppingflag[r] = IntVar()
+    hoppingflag[r].set(0)
+    hoppingpctx[r] = IntVar()
+    hoppingpctx[r].set(0)
+    tuneupflag[r] = IntVar()
+    tuneupflag[r].set(0)
+
+#def save_params(appdir):
+#    f=open(appdir+'/hopping.ini',mode='w')
+#    t=&quot;%d %d\n&quot; % (hopping.get(),coord_bands.get())
+#    f.write(t)
+#    for r in range(1,16):
+#        t=&quot;%4s %2d %5d %2d\n&quot; % (bandlabels[r][:-2], hoppingflag[r].get(), \
+#                                hoppingpctx[r].get(),tuneupflag[r].get())
+#        f.write(t)
+#    f.close()
+
+def restore_params(appdir):
+    if os.path.isfile(appdir+'/hopping.ini'):
+        try:
+            f=open(appdir+'/hopping.ini',mode='r')
+            s=f.readlines()
+            f.close()
+            hopping.set(int(s[0][0:1]))
+            coord_bands.set(int(s[0][2:3]))
+            for r in range(1,16):
+                hoppingflag[r].set(int(s[r][6:7]))
+                hoppingpctx[r].set(int(s[r][8:13]))
+                tuneupflag[r].set(int(s[r][13:16]))
+            globalupdate()
+        except:
+            print 'Error reading hopping.ini.'

Added: branches/wspr/WsprModNoGui/iq.py
===================================================================
--- branches/wspr/WsprModNoGui/iq.py	                        (rev 0)
+++ branches/wspr/WsprModNoGui/iq.py	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,83 @@
+import w
+import g
+from tkrep import *
+import pickle
+
+NONE=None
+
+iqmode=IntVar()
+iqrx=IntVar()
+iqtx=IntVar()
+fiq=IntVar()
+iqrxapp=IntVar()
+iqrxadj=IntVar()
+
+isc2=IntVar()
+isc2.set(0)
+isc2a=IntVar()
+isc2a.set(0)
+isc3=IntVar()
+isc3.set(0)
+isc3a=IntVar()
+isc3a.set(0)
+
+ib=IntVar()
+gain=DoubleVar()
+phdeg=DoubleVar()
+mb=[0,600,160,80,60,40,30,20,17,15,12,10,6,4,2,0]
+tbal=[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]
+tpha=[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]
+rbal=[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]
+rpha=[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]
+allbands=0
+
+def saveband(event=NONE):
+    global allbands,tbal,tpha,rbal,rpha
+    if allbands:
+        for j in range(1,15):
+            tbal[j]=isc2.get() + 0.02*isc2a.get()
+            tpha[j]=isc3.get() + 0.02*isc3a.get()
+            rbal[j]=w.acom1.gain
+            rpha[j]=57.2957795*w.acom1.phase
+    else:
+        j=ib.get()
+        tbal[j]=isc2.get() + 0.02*isc2a.get()
+        tpha[j]=isc3.get() + 0.02*isc3a.get()
+        rbal[j]=w.acom1.gain
+        rpha[j]=57.2957795*w.acom1.phase
+
+    f=open(g.appdir+'/iqpickle',mode='w')
+    pickle.dump(tbal,f)    
+    pickle.dump(tpha,f)    
+    pickle.dump(rbal,f)    
+    pickle.dump(rpha,f)    
+    f.close()
+
+def saveall(event=NONE):
+    global allbands
+    allbands=1
+    saveband()
+    allbands=0
+
+def restore():
+    global tbal,tpha,rbal,rpha
+    try:
+        f=open(g.appdir+'/iqpickle',mode='r')
+        tbal=pickle.load(f)
+        tpha=pickle.load(f)
+        rbal=pickle.load(f)
+        rpha=pickle.load(f)
+        f.close()
+    except:
+        pass
+    newband()
+
+def newband():
+    j=ib.get()
+    #lab0.configure(text=str(mb[j])+' m') #gui related
+    w.acom1.gain=rbal[j]
+    w.acom1.phase=rpha[j]/57.2957795
+    isc2.set(int(tbal[j]))
+    isc2a.set(int((tbal[j]-isc2.get())/0.02))
+    isc3.set(int(tpha[j]))
+    isc3a.set(int((tpha[j]-isc3.get())/0.02))

Added: branches/wspr/WsprModNoGui/options.py
===================================================================
--- branches/wspr/WsprModNoGui/options.py	                        (rev 0)
+++ branches/wspr/WsprModNoGui/options.py	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,128 @@
+import g
+from tkrep import *
+
+ptt_port=IntVar()
+CatPort=StringVar()
+PttPort=StringVar()
+CatPort.set('None')
+PttPort.set('None')
+ndevin=IntVar()
+ndevout=IntVar()
+DevinName=StringVar()
+DevoutName=StringVar()
+dBm=IntVar()
+dBm.set(37)
+pttmode=StringVar()
+serial_rate=IntVar()
+serial_rate.set(4800)
+databits=IntVar()
+databits.set(8)
+stopbits=IntVar()
+stopbits.set(2)
+serial_handshake=StringVar()
+cat_enable=IntVar()
+rig=StringVar()
+rig.set('214     Kenwood         TS-2000')
+rignum=IntVar()
+inbad=IntVar()
+outbad=IntVar()
+
+pttmode.set('DTR')
+serial_handshake.set('None')
+
+pttlist=(&quot;CAT&quot;,&quot;DTR&quot;,&quot;RTS&quot;,&quot;VOX&quot;)
+baudlist=(1200,4800,9600,19200,38400,57600)
+hslist=(&quot;None&quot;,&quot;XONXOFF&quot;,&quot;Hardware&quot;)
+pwrlist=(-30,-27,-23,-20,-17,-13,-10,-7,-3,   \
+         0,3,7,10,13,17,20,23,27,30,33,37,40,43,47,50,53,57,60)
+
+if g.Win32:
+    serialportlist=(&quot;None&quot;,&quot;COM1&quot;,&quot;COM2&quot;,&quot;COM3&quot;,&quot;COM4&quot;,&quot;COM5&quot;,&quot;COM6&quot;, \
+        &quot;COM7&quot;,&quot;COM8&quot;,&quot;COM9&quot;,&quot;COM10&quot;,&quot;COM11&quot;,&quot;COM12&quot;,&quot;COM13&quot;,&quot;COM14&quot;, \
+        &quot;COM15&quot;,&quot;USB&quot;)
+else:
+    serialportlist=(&quot;None&quot;,&quot;/dev/ttyS0&quot;,&quot;/dev/ttyS1&quot;,&quot;/dev/ttyUSB0&quot;, \
+        &quot;/dev/ttyUSB1&quot;,&quot;/dev/ttyUSB2&quot;,&quot;/dev/ttyUSB3&quot;,&quot;/dev/ttyUSB4&quot;, \
+        &quot;/dev/ttyUSB5&quot;,&quot;/dev/ttyUSB6&quot;,&quot;/dev/ttyUSB7&quot;,&quot;/dev/ttyUSB8&quot;)
+                    
+datalist=(7,8)
+stoplist=(1,2)
+indevlist=[]
+outdevlist=[]
+riglist=[]
+
+MyCall=StringVar()
+MyGrid=StringVar()
+
+try:
+    f=open('audio_caps','r')
+    s=f.readlines()
+    f.close
+    t=&quot;Input Devices:\n&quot;
+    for i in range(len(s)):
+        col=s[i].split()
+        if int(col[1])&gt;0:
+            t=str(i) + s[i][29:]
+            t=t[:len(t)-1]
+            indevlist.append(t)
+    for i in range(len(s)):
+        col=s[i].split()
+        if int(col[2])&gt;0:
+            t=str(i) + s[i][29:]
+            t=t[:len(t)-1]
+            outdevlist.append(t)
+except:
+    pass
+
+try:
+    f=open('hamlib_rig_numbers','r')
+    s=f.readlines()
+    f.close
+    for i in range(len(s)):
+        t=s[i]
+        riglist.append(t[:len(t)-1])
+except:
+    pass
+
+#------------------------------------------------------ audin
+#def audin(event=NONE):
+#    g.DevinName.set(DevinName.get())
+#    g.ndevin.set(int(DevinName.get()[:2]))
+    
+#------------------------------------------------------ audout
+#def audout(event=NONE):
+#    g.DevoutName.set(DevoutName.get())
+#    g.ndevout.set(int(DevoutName.get()[:2]))
+
+#------------------------------------------------------ rig_number
+#def rig_number(event=NONE):
+#    rignum.set(int(rig.get()[:4]))
+
+#------------------------------------------------------- chkcall
+def chkcall(t):
+    r=-1
+    n=len(t)
+    if n&gt;=3 and n&lt;=10:
+        i1=t.count('/')
+        i2=t.find('/')
+        if i1==1 and i2&gt;0:
+            t=t[:i2-1]+t[i2+1:]
+        if t.isalnum() and t.find(' ')&lt;0:
+            r=1
+    return r
+
+#------------------------------------------------------- chkgrid
+def chkgrid(t):
+    r=-1
+    n=len(t)
+    if n==4 or n==6:
+        if int(t[0:1],36)&gt;=10 and int(t[0:1],36)&lt;=27 and \
+           int(t[1:2],36)&gt;=10 and int(t[1:2],36)&lt;=27 and \
+           int(t[2:3],36)&gt;=0 and int(t[2:3],36)&lt;=9 and \
+           int(t[3:4],36)&gt;=0 and int(t[3:4],36)&lt;=9: r=1
+        if r==1 and n==6:
+            r=-1
+            if int(t[4:5],36)&gt;=10 and int(t[4:5],36)&lt;=33 and \
+               int(t[5:6],36)&gt;=10 and int(t[5:6],36)&lt;=33: r=1
+    return r
+

Added: branches/wspr/WsprModNoGui/palettes.py
===================================================================
--- branches/wspr/WsprModNoGui/palettes.py	                        (rev 0)
+++ branches/wspr/WsprModNoGui/palettes.py	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,1566 @@
+import string
+import g
+
+# Several colormaps
+colormapblue =  &quot;&quot;&quot;
+    0.0       0.0       0.0
+    0.0902    0.0902    0.2558
+    0.1176    0.1176    0.2694
+    0.1412    0.1412    0.2820
+    0.1569    0.1569    0.2938
+    0.1725    0.1725    0.3049
+    0.1843    0.1843    0.3154
+    0.1961    0.1961    0.3254
+    0.2039    0.2039    0.3349
+    0.2157    0.2157    0.3440
+    0.2235    0.2235    0.3528
+    0.2314    0.2314    0.3612
+    0.2392    0.2392    0.3693
+    0.2471    0.2471    0.3772
+    0.2549    0.2549    0.3848
+    0.2588    0.2588    0.3921
+    0.2667    0.2667    0.3992
+    0.2706    0.2706    0.4061
+    0.2784    0.2784    0.4129
+    0.2824    0.2824    0.4194
+    0.2902    0.2902    0.4258
+    0.2941    0.2941    0.4319
+    0.2980    0.2980    0.4380
+    0.3059    0.3059    0.4439
+    0.3098    0.3098    0.4496
+    0.3137    0.3137    0.4553
+    0.3176    0.3176    0.4608
+    0.3216    0.3216    0.4661
+    0.3294    0.3294    0.4714
+    0.3333    0.3333    0.4765
+    0.3373    0.3373    0.4815
+    0.3412    0.3412    0.4865
+    0.3451    0.3451    0.4913
+    0.3490    0.3490    0.4960
+    0.3529    0.3529    0.5006
+    0.3569    0.3569    0.5052
+    0.3608    0.3608    0.5096
+    0.3647    0.3647    0.5140
+    0.3686    0.3686    0.5183
+    0.3725    0.3725    0.5225
+    0.3765    0.3765    0.5266
+    0.3804    0.3804    0.5306
+    0.3843    0.3843    0.5346
+    0.3843    0.3843    0.5385
+    0.3882    0.3882    0.5423
+    0.3922    0.3922    0.5460
+    0.3961    0.3961    0.5497
+    0.4000    0.4000    0.5533
+    0.4039    0.4039    0.5569
+    0.4078    0.4078    0.5603
+    0.4118    0.4118    0.5638
+    0.4118    0.4118    0.5671
+    0.4157    0.4157    0.5704
+    0.4196    0.4196    0.5736
+    0.4235    0.4235    0.5768
+    0.4275    0.4275    0.5799
+    0.4314    0.4314    0.5829
+    0.4314    0.4314    0.5859
+    0.4353    0.4353    0.5889
+    0.4392    0.4392    0.5917
+    0.4431    0.4431    0.5946
+    0.4471    0.4471    0.5973
+    0.4471    0.4471    0.6001
+    0.4510    0.4510    0.6027
+    0.4549    0.4549    0.6053
+    0.4588    0.4588    0.6079
+    0.4627    0.4627    0.6104
+    0.4627    0.4627    0.6129
+    0.4667    0.4667    0.6153
+    0.4706    0.4706    0.6176
+    0.4745    0.4745    0.6199
+    0.4745    0.4745    0.6222
+    0.4784    0.4784    0.6244
+    0.4824    0.4824    0.6266
+    0.4863    0.4863    0.6287
+    0.4863    0.4863    0.6308
+    0.4902    0.4902    0.6328
+    0.4941    0.4941    0.6348
+    0.4980    0.4980    0.6367
+    0.5020    0.5020    0.6386
+    0.5020    0.5020    0.6404
+    0.5059    0.5059    0.6422
+    0.5098    0.5098    0.6440
+    0.5098    0.5098    0.6457
+    0.5137    0.5137    0.6474
+    0.5176    0.5176    0.6490
+    0.5216    0.5216    0.6506
+    0.5216    0.5216    0.6521
+    0.5255    0.5255    0.6536
+    0.5294    0.5294    0.6551
+    0.5333    0.5333    0.6565
+    0.5333    0.5333    0.6578
+    0.5373    0.5373    0.6591
+    0.5412    0.5412    0.6604
+    0.5451    0.5451    0.6617
+    0.5451    0.5451    0.6629
+    0.5490    0.5490    0.6640
+    0.5529    0.5529    0.6651
+    0.5569    0.5569    0.6662
+    0.5569    0.5569    0.6672
+    0.5608    0.5608    0.6682
+    0.5647    0.5647    0.6692
+    0.5647    0.5647    0.6701
+    0.5686    0.5686    0.6710
+    0.5725    0.5725    0.6718
+    0.5765    0.5765    0.6726
+    0.5765    0.5765    0.6733
+    0.5804    0.5804    0.6740
+    0.5843    0.5843    0.6747
+    0.5843    0.5843    0.6753
+    0.5882    0.5882    0.6759
+    0.5922    0.5922    0.6765
+    0.5961    0.5961    0.6770
+    0.5961    0.5961    0.6774
+    0.6000    0.6000    0.6779
+    0.6039    0.6039    0.6783
+    0.6039    0.6039    0.6786
+    0.6078    0.6078    0.6789
+    0.6118    0.6118    0.6792
+    0.6157    0.6157    0.6794
+    0.6157    0.6157    0.6796
+    0.6196    0.6196    0.6798
+    0.6235    0.6235    0.6799
+    0.6235    0.6235    0.6800
+    0.6275    0.6275    0.6800
+    0.6314    0.6314    0.6800
+    0.6353    0.6353    0.6799
+    0.6353    0.6353    0.6799
+    0.6392    0.6392    0.6797
+    0.6431    0.6431    0.6796
+    0.6431    0.6431    0.6794
+    0.6471    0.6471    0.6791
+    0.6510    0.6510    0.6789
+    0.6549    0.6549    0.6785
+    0.6549    0.6549    0.6782
+    0.6588    0.6588    0.6778
+    0.6627    0.6627    0.6773
+    0.6627    0.6627    0.6769
+    0.6667    0.6667    0.6763
+    0.6706    0.6706    0.6758
+    0.6745    0.6745    0.6752
+    0.6745    0.6745    0.6746
+    0.6784    0.6784    0.6739
+    0.6824    0.6824    0.6732
+    0.6824    0.6824    0.6724
+    0.6863    0.6863    0.6716
+    0.6902    0.6902    0.6708
+    0.6941    0.6941    0.6699
+    0.6941    0.6941    0.6690
+    0.6980    0.6980    0.6680
+    0.7020    0.7020    0.6670
+    0.7020    0.7020    0.6660
+    0.7059    0.7059    0.6649
+    0.7098    0.7098    0.6638
+    0.7098    0.7098    0.6626
+    0.7137    0.7137    0.6614
+    0.7176    0.7176    0.6601
+    0.7216    0.7216    0.6589
+    0.7216    0.7216    0.6575
+    0.7255    0.7255    0.6561
+    0.7294    0.7294    0.6547
+    0.7294    0.7294    0.6533
+    0.7333    0.7333    0.6518
+    0.7373    0.7373    0.6502
+    0.7412    0.7412    0.6486
+    0.7412    0.7412    0.6470
+    0.7451    0.7451    0.6453
+    0.7490    0.7490    0.6436
+    0.7490    0.7490    0.6418
+    0.7529    0.7529    0.6400
+    0.7569    0.7569    0.6382
+    0.7608    0.7608    0.6363
+    0.7608    0.7608    0.6343
+    0.7647    0.7647    0.6324
+    0.7686    0.7686    0.6303
+    0.7686    0.7686    0.6282
+    0.7725    0.7725    0.6261
+    0.7765    0.7765    0.6239
+    0.7804    0.7804    0.6217
+    0.7804    0.7804    0.6194
+    0.7843    0.7843    0.6171
+    0.7882    0.7882    0.6147
+    0.7882    0.7882    0.6123
+    0.7922    0.7922    0.6098
+    0.7961    0.7961    0.6073
+    0.8000    0.8000    0.6047
+    0.8000    0.8000    0.6021
+    0.8039    0.8039    0.5994
+    0.8078    0.8078    0.5967
+    0.8078    0.8078    0.5939
+    0.8118    0.8118    0.5911
+    0.8157    0.8157    0.5882
+    0.8196    0.8196    0.5853
+    0.8196    0.8196    0.5823
+    0.8235    0.8235    0.5792
+    0.8275    0.8275    0.5761
+    0.8275    0.8275    0.5729
+    0.8314    0.8314    0.5697
+    0.8353    0.8353    0.5664
+    0.8392    0.8392    0.5630
+    0.8392    0.8392    0.5596
+    0.8431    0.8431    0.5561
+    0.8471    0.8471    0.5525
+    0.8471    0.8471    0.5489
+    0.8510    0.8510    0.5452
+    0.8549    0.8549    0.5414
+    0.8588    0.8588    0.5376
+    0.8588    0.8588    0.5337
+    0.8627    0.8627    0.5297
+    0.8667    0.8667    0.5257
+    0.8667    0.8667    0.5215
+    0.8706    0.8706    0.5173
+    0.8745    0.8745    0.5130
+    0.8784    0.8784    0.5086
+    0.8784    0.8784    0.5042
+    0.8824    0.8824    0.4996
+    0.8863    0.8863    0.4950
+    0.8863    0.8863    0.4902
+    0.8902    0.8902    0.4854
+    0.8941    0.8941    0.4804
+    0.8980    0.8980    0.4754
+    0.8980    0.8980    0.4702
+    0.9020    0.9020    0.4649
+    0.9059    0.9059    0.4595
+    0.9098    0.9098    0.4540
+    0.9098    0.9098    0.4484
+    0.9137    0.9137    0.4426
+    0.9176    0.9176    0.4366
+    0.9176    0.9176    0.4306
+    0.9216    0.9216    0.4243
+    0.9255    0.9255    0.4179
+    0.9294    0.9294    0.4114
+    0.9294    0.9294    0.4046
+    0.9333    0.9333    0.3977
+    0.9373    0.9373    0.3905
+    0.9373    0.9373    0.3831
+    0.9412    0.9412    0.3754
+    0.9451    0.9451    0.3675
+    0.9490    0.9490    0.3594
+    0.9490    0.9490    0.3509
+    0.9529    0.9529    0.3420
+    0.9569    0.9569    0.3328
+    0.9608    0.9608    0.3232
+    0.9608    0.9608    0.3131
+    0.9647    0.9647    0.3024
+    0.9686    0.9686    0.2912
+    0.9686    0.9686    0.2792
+    0.9725    0.9725    0.2664
+    0.9765    0.9765    0.2526
+    0.9804    0.9804    0.2375
+    0.9804    0.9804    0.2208
+    0.9843    0.9843    0.2020
+    0.9882    0.9882    0.1800
+    1.0       0.0       0.0
+    1.0       1.0       0.0
+    0.0       1.000     0.0
+&quot;&quot;&quot;
+colormapgray0 =  &quot;&quot;&quot;
+    0.0000    0.0000    0.0000
+    0.0039    0.0039    0.0039
+    0.0078    0.0078    0.0078
+    0.0118    0.0118    0.0118
+    0.0157    0.0157    0.0157
+    0.0196    0.0196    0.0196
+    0.0235    0.0235    0.0235
+    0.0275    0.0275    0.0275
+    0.0314    0.0314    0.0314
+    0.0353    0.0353    0.0353
+    0.0392    0.0392    0.0392
+    0.0431    0.0431    0.0431
+    0.0471    0.0471    0.0471
+    0.0510    0.0510    0.0510
+    0.0549    0.0549    0.0549
+    0.0588    0.0588    0.0588
+    0.0627    0.0627    0.0627
+    0.0667    0.0667    0.0667
+    0.0706    0.0706    0.0706
+    0.0745    0.0745    0.0745
+    0.0784    0.0784    0.0784
+    0.0824    0.0824    0.0824
+    0.0863    0.0863    0.0863
+    0.0902    0.0902    0.0902
+    0.0941    0.0941    0.0941
+    0.0980    0.0980    0.0980
+    0.1020    0.1020    0.1020
+    0.1059    0.1059    0.1059
+    0.1098    0.1098    0.1098
+    0.1137    0.1137    0.1137
+    0.1176    0.1176    0.1176
+    0.1216    0.1216    0.1216
+    0.1255    0.1255    0.1255
+    0.1294    0.1294    0.1294
+    0.1333    0.1333    0.1333
+    0.1373    0.1373    0.1373
+    0.1412    0.1412    0.1412
+    0.1451    0.1451    0.1451
+    0.1490    0.1490    0.1490
+    0.1529    0.1529    0.1529
+    0.1569    0.1569    0.1569
+    0.1608    0.1608    0.1608
+    0.1647    0.1647    0.1647
+    0.1686    0.1686    0.1686
+    0.1725    0.1725    0.1725
+    0.1765    0.1765    0.1765
+    0.1804    0.1804    0.1804
+    0.1843    0.1843    0.1843
+    0.1882    0.1882    0.1882
+    0.1922    0.1922    0.1922
+    0.1961    0.1961    0.1961
+    0.2000    0.2000    0.2000
+    0.2039    0.2039    0.2039
+    0.2078    0.2078    0.2078
+    0.2118    0.2118    0.2118
+    0.2157    0.2157    0.2157
+    0.2196    0.2196    0.2196
+    0.2235    0.2235    0.2235
+    0.2275    0.2275    0.2275
+    0.2314    0.2314    0.2314
+    0.2353    0.2353    0.2353
+    0.2392    0.2392    0.2392
+    0.2431    0.2431    0.2431
+    0.2471    0.2471    0.2471
+    0.2510    0.2510    0.2510
+    0.2549    0.2549    0.2549
+    0.2588    0.2588    0.2588
+    0.2627    0.2627    0.2627
+    0.2667    0.2667    0.2667
+    0.2706    0.2706    0.2706
+    0.2745    0.2745    0.2745
+    0.2784    0.2784    0.2784
+    0.2824    0.2824    0.2824
+    0.2863    0.2863    0.2863
+    0.2902    0.2902    0.2902
+    0.2941    0.2941    0.2941
+    0.2980    0.2980    0.2980
+    0.3020    0.3020    0.3020
+    0.3059    0.3059    0.3059
+    0.3098    0.3098    0.3098
+    0.3137    0.3137    0.3137
+    0.3176    0.3176    0.3176
+    0.3216    0.3216    0.3216
+    0.3255    0.3255    0.3255
+    0.3294    0.3294    0.3294
+    0.3333    0.3333    0.3333
+    0.3373    0.3373    0.3373
+    0.3412    0.3412    0.3412
+    0.3451    0.3451    0.3451
+    0.3490    0.3490    0.3490
+    0.3529    0.3529    0.3529
+    0.3569    0.3569    0.3569
+    0.3608    0.3608    0.3608
+    0.3647    0.3647    0.3647
+    0.3686    0.3686    0.3686
+    0.3725    0.3725    0.3725
+    0.3765    0.3765    0.3765
+    0.3804    0.3804    0.3804
+    0.3843    0.3843    0.3843
+    0.3882    0.3882    0.3882
+    0.3922    0.3922    0.3922
+    0.3961    0.3961    0.3961
+    0.4000    0.4000    0.4000
+    0.4039    0.4039    0.4039
+    0.4078    0.4078    0.4078
+    0.4118    0.4118    0.4118
+    0.4157    0.4157    0.4157
+    0.4196    0.4196    0.4196
+    0.4235    0.4235    0.4235
+    0.4275    0.4275    0.4275
+    0.4314    0.4314    0.4314
+    0.4353    0.4353    0.4353
+    0.4392    0.4392    0.4392
+    0.4431    0.4431    0.4431
+    0.4471    0.4471    0.4471
+    0.4510    0.4510    0.4510
+    0.4549    0.4549    0.4549
+    0.4588    0.4588    0.4588
+    0.4627    0.4627    0.4627
+    0.4667    0.4667    0.4667
+    0.4706    0.4706    0.4706
+    0.4745    0.4745    0.4745
+    0.4784    0.4784    0.4784
+    0.4824    0.4824    0.4824
+    0.4863    0.4863    0.4863
+    0.4902    0.4902    0.4902
+    0.4941    0.4941    0.4941
+    0.4980    0.4980    0.4980
+    0.5020    0.5020    0.5020
+    0.5059    0.5059    0.5059
+    0.5098    0.5098    0.5098
+    0.5137    0.5137    0.5137
+    0.5176    0.5176    0.5176
+    0.5216    0.5216    0.5216
+    0.5255    0.5255    0.5255
+    0.5294    0.5294    0.5294
+    0.5333    0.5333    0.5333
+    0.5373    0.5373    0.5373
+    0.5412    0.5412    0.5412
+    0.5451    0.5451    0.5451
+    0.5490    0.5490    0.5490
+    0.5529    0.5529    0.5529
+    0.5569    0.5569    0.5569
+    0.5608    0.5608    0.5608
+    0.5647    0.5647    0.5647
+    0.5686    0.5686    0.5686
+    0.5725    0.5725    0.5725
+    0.5765    0.5765    0.5765
+    0.5804    0.5804    0.5804
+    0.5843    0.5843    0.5843
+    0.5882    0.5882    0.5882
+    0.5922    0.5922    0.5922
+    0.5961    0.5961    0.5961
+    0.6000    0.6000    0.6000
+    0.6039    0.6039    0.6039
+    0.6078    0.6078    0.6078
+    0.6118    0.6118    0.6118
+    0.6157    0.6157    0.6157
+    0.6196    0.6196    0.6196
+    0.6235    0.6235    0.6235
+    0.6275    0.6275    0.6275
+    0.6314    0.6314    0.6314
+    0.6353    0.6353    0.6353
+    0.6392    0.6392    0.6392
+    0.6431    0.6431    0.6431
+    0.6471    0.6471    0.6471
+    0.6510    0.6510    0.6510
+    0.6549    0.6549    0.6549
+    0.6588    0.6588    0.6588
+    0.6627    0.6627    0.6627
+    0.6667    0.6667    0.6667
+    0.6706    0.6706    0.6706
+    0.6745    0.6745    0.6745
+    0.6784    0.6784    0.6784
+    0.6824    0.6824    0.6824
+    0.6863    0.6863    0.6863
+    0.6902    0.6902    0.6902
+    0.6941    0.6941    0.6941
+    0.6980    0.6980    0.6980
+    0.7020    0.7020    0.7020
+    0.7059    0.7059    0.7059
+    0.7098    0.7098    0.7098
+    0.7137    0.7137    0.7137
+    0.7176    0.7176    0.7176
+    0.7216    0.7216    0.7216
+    0.7255    0.7255    0.7255
+    0.7294    0.7294    0.7294
+    0.7333    0.7333    0.7333
+    0.7373    0.7373    0.7373
+    0.7412    0.7412    0.7412
+    0.7451    0.7451    0.7451
+    0.7490    0.7490    0.7490
+    0.7529    0.7529    0.7529
+    0.7569    0.7569    0.7569
+    0.7608    0.7608    0.7608
+    0.7647    0.7647    0.7647
+    0.7686    0.7686    0.7686
+    0.7725    0.7725    0.7725
+    0.7765    0.7765    0.7765
+    0.7804    0.7804    0.7804
+    0.7843    0.7843    0.7843
+    0.7882    0.7882    0.7882
+    0.7922    0.7922    0.7922
+    0.7961    0.7961    0.7961
+    0.8000    0.8000    0.8000
+    0.8039    0.8039    0.8039
+    0.8078    0.8078    0.8078
+    0.8118    0.8118    0.8118
+    0.8157    0.8157    0.8157
+    0.8196    0.8196    0.8196
+    0.8235    0.8235    0.8235
+    0.8275    0.8275    0.8275
+    0.8314    0.8314    0.8314
+    0.8353    0.8353    0.8353
+    0.8392    0.8392    0.8392
+    0.8431    0.8431    0.8431
+    0.8471    0.8471    0.8471
+    0.8510    0.8510    0.8510
+    0.8549    0.8549    0.8549
+    0.8588    0.8588    0.8588
+    0.8627    0.8627    0.8627
+    0.8667    0.8667    0.8667
+    0.8706    0.8706    0.8706
+    0.8745    0.8745    0.8745
+    0.8784    0.8784    0.8784
+    0.8824    0.8824    0.8824
+    0.8863    0.8863    0.8863
+    0.8902    0.8902    0.8902
+    0.8941    0.8941    0.8941
+    0.8980    0.8980    0.8980
+    0.9020    0.9020    0.9020
+    0.9059    0.9059    0.9059
+    0.9098    0.9098    0.9098
+    0.9137    0.9137    0.9137
+    0.9176    0.9176    0.9176
+    0.9216    0.9216    0.9216
+    0.9255    0.9255    0.9255
+    0.9294    0.9294    0.9294
+    0.9333    0.9333    0.9333
+    0.9373    0.9373    0.9373
+    0.9412    0.9412    0.9412
+    0.9451    0.9451    0.9451
+    0.9490    0.9490    0.9490
+    0.9529    0.9529    0.9529
+    0.9569    0.9569    0.9569
+    0.9608    0.9608    0.9608
+    0.9647    0.9647    0.9647
+    0.9686    0.9686    0.9686
+    0.9725    0.9725    0.9725
+    0.9765    0.9765    0.9765
+    0.9804    0.9804    0.9804
+    0.9843    0.9843    0.9843
+    0.9882    0.9882    0.9882
+    1.0       0.0       0.0
+    1.0       1.0       0.0
+    0.0       1.000    0.0
+&quot;&quot;&quot;
+
+colormapHot=&quot;&quot;&quot;
+    0.0000    0.0000    0.0000
+    0.0118    0.0000    0.0000
+    0.0235    0.0000    0.0000
+    0.0353    0.0000    0.0000
+    0.0471    0.0000    0.0000
+    0.0588    0.0000    0.0000
+    0.0706    0.0000    0.0000
+    0.0824    0.0000    0.0000
+    0.0941    0.0000    0.0000
+    0.1059    0.0000    0.0000
+    0.1176    0.0000    0.0000
+    0.1294    0.0000    0.0000
+    0.1412    0.0000    0.0000
+    0.1529    0.0000    0.0000
+    0.1647    0.0000    0.0000
+    0.1765    0.0000    0.0000
+    0.1882    0.0000    0.0000
+    0.2000    0.0000    0.0000
+    0.2118    0.0000    0.0000
+    0.2235    0.0000    0.0000
+    0.2353    0.0000    0.0000
+    0.2471    0.0000    0.0000
+    0.2588    0.0000    0.0000
+    0.2706    0.0000    0.0000
+    0.2824    0.0000    0.0000
+    0.2941    0.0000    0.0000
+    0.3059    0.0000    0.0000
+    0.3176    0.0000    0.0000
+    0.3294    0.0000    0.0000
+    0.3412    0.0000    0.0000
+    0.3529    0.0000    0.0000
+    0.3647    0.0000    0.0000
+    0.3765    0.0000    0.0000
+    0.3882    0.0000    0.0000
+    0.4000    0.0000    0.0000
+    0.4118    0.0000    0.0000
+    0.4235    0.0000    0.0000
+    0.4353    0.0000    0.0000
+    0.4471    0.0000    0.0000
+    0.4588    0.0000    0.0000
+    0.4706    0.0000    0.0000
+    0.4824    0.0000    0.0000
+    0.4941    0.0000    0.0000
+    0.5059    0.0000    0.0000
+    0.5176    0.0000    0.0000
+    0.5294    0.0000    0.0000
+    0.5412    0.0000    0.0000
+    0.5529    0.0000    0.0000
+    0.5647    0.0000    0.0000
+    0.5765    0.0000    0.0000
+    0.5882    0.0000    0.0000
+    0.6000    0.0000    0.0000
+    0.6118    0.0000    0.0000
+    0.6235    0.0000    0.0000
+    0.6353    0.0000    0.0000
+    0.6471    0.0000    0.0000
+    0.6588    0.0000    0.0000
+    0.6706    0.0000    0.0000
+    0.6824    0.0000    0.0000
+    0.6941    0.0000    0.0000
+    0.7059    0.0000    0.0000
+    0.7176    0.0000    0.0000
+    0.7294    0.0000    0.0000
+    0.7412    0.0000    0.0000
+    0.7529    0.0000    0.0000
+    0.7647    0.0000    0.0000
+    0.7765    0.0000    0.0000
+    0.7882    0.0000    0.0000
+    0.8000    0.0000    0.0000
+    0.8118    0.0000    0.0000
+    0.8235    0.0000    0.0000
+    0.8353    0.0000    0.0000
+    0.8471    0.0000    0.0000
+    0.8588    0.0000    0.0000
+    0.8706    0.0000    0.0000
+    0.8824    0.0000    0.0000
+    0.8941    0.0000    0.0000
+    0.9059    0.0000    0.0000
+    0.9176    0.0000    0.0000
+    0.9294    0.0000    0.0000
+    0.9412    0.0000    0.0000
+    0.9529    0.0000    0.0000
+    0.9647    0.0000    0.0000
+    0.9765    0.0000    0.0000
+    0.9882    0.0000    0.0000
+    1.0000    0.0000    0.0000
+    1.0000    0.0118    0.0000
+    1.0000    0.0235    0.0000
+    1.0000    0.0353    0.0000
+    1.0000    0.0471    0.0000
+    1.0000    0.0588    0.0000
+    1.0000    0.0706    0.0000
+    1.0000    0.0824    0.0000
+    1.0000    0.0941    0.0000
+    1.0000    0.1059    0.0000
+    1.0000    0.1176    0.0000
+    1.0000    0.1294    0.0000
+    1.0000    0.1412    0.0000
+    1.0000    0.1529    0.0000
+    1.0000    0.1647    0.0000
+    1.0000    0.1765    0.0000
+    1.0000    0.1882    0.0000
+    1.0000    0.2000    0.0000
+    1.0000    0.2118    0.0000
+    1.0000    0.2235    0.0000
+    1.0000    0.2353    0.0000
+    1.0000    0.2471    0.0000
+    1.0000    0.2588    0.0000
+    1.0000    0.2706    0.0000
+    1.0000    0.2824    0.0000
+    1.0000    0.2941    0.0000
+    1.0000    0.3059    0.0000
+    1.0000    0.3176    0.0000
+    1.0000    0.3294    0.0000
+    1.0000    0.3412    0.0000
+    1.0000    0.3529    0.0000
+    1.0000    0.3647    0.0000
+    1.0000    0.3765    0.0000
+    1.0000    0.3882    0.0000
+    1.0000    0.4000    0.0000
+    1.0000    0.4118    0.0000
+    1.0000    0.4235    0.0000
+    1.0000    0.4353    0.0000
+    1.0000    0.4471    0.0000
+    1.0000    0.4588    0.0000
+    1.0000    0.4706    0.0000
+    1.0000    0.4824    0.0000
+    1.0000    0.4941    0.0000
+    1.0000    0.5059    0.0000
+    1.0000    0.5176    0.0000
+    1.0000    0.5294    0.0000
+    1.0000    0.5412    0.0000
+    1.0000    0.5529    0.0000
+    1.0000    0.5647    0.0000
+    1.0000    0.5765    0.0000
+    1.0000    0.5882    0.0000
+    1.0000    0.6000    0.0000
+    1.0000    0.6118    0.0000
+    1.0000    0.6235    0.0000
+    1.0000    0.6353    0.0000
+    1.0000    0.6471    0.0000
+    1.0000    0.6588    0.0000
+    1.0000    0.6706    0.0000
+    1.0000    0.6824    0.0000
+    1.0000    0.6941    0.0000
+    1.0000    0.7059    0.0000
+    1.0000    0.7176    0.0000
+    1.0000    0.7294    0.0000
+    1.0000    0.7412    0.0000
+    1.0000    0.7529    0.0000
+    1.0000    0.7647    0.0000
+    1.0000    0.7765    0.0000
+    1.0000    0.7882    0.0000
+    1.0000    0.8000    0.0000
+    1.0000    0.8118    0.0000
+    1.0000    0.8235    0.0000
+    1.0000    0.8353    0.0000
+    1.0000    0.8471    0.0000
+    1.0000    0.8588    0.0000
+    1.0000    0.8706    0.0000
+    1.0000    0.8824    0.0000
+    1.0000    0.8941    0.0000
+    1.0000    0.9059    0.0000
+    1.0000    0.9176    0.0000
+    1.0000    0.9294    0.0000
+    1.0000    0.9412    0.0000
+    1.0000    0.9529    0.0000
+    1.0000    0.9647    0.0000
+    1.0000    0.9765    0.0000
+    1.0000    0.9882    0.0000
+    1.0000    1.0000    0.0000
+    1.0000    1.0000    0.0118
+    1.0000    1.0000    0.0235
+    1.0000    1.0000    0.0353
+    1.0000    1.0000    0.0471
+    1.0000    1.0000    0.0588
+    1.0000    1.0000    0.0706
+    1.0000    1.0000    0.0824
+    1.0000    1.0000    0.0941
+    1.0000    1.0000    0.1059
+    1.0000    1.0000    0.1176
+    1.0000    1.0000    0.1294
+    1.0000    1.0000    0.1412
+    1.0000    1.0000    0.1529
+    1.0000    1.0000    0.1647
+    1.0000    1.0000    0.1765
+    1.0000    1.0000    0.1882
+    1.0000    1.0000    0.2000
+    1.0000    1.0000    0.2118
+    1.0000    1.0000    0.2235
+    1.0000    1.0000    0.2353
+    1.0000    1.0000    0.2471
+    1.0000    1.0000    0.2588
+    1.0000    1.0000    0.2706
+    1.0000    1.0000    0.2824
+    1.0000    1.0000    0.2941
+    1.0000    1.0000    0.3059
+    1.0000    1.0000    0.3176
+    1.0000    1.0000    0.3294
+    1.0000    1.0000    0.3412
+    1.0000    1.0000    0.3529
+    1.0000    1.0000    0.3647
+    1.0000    1.0000    0.3765
+    1.0000    1.0000    0.3882
+    1.0000    1.0000    0.4000
+    1.0000    1.0000    0.4118
+    1.0000    1.0000    0.4235
+    1.0000    1.0000    0.4353
+    1.0000    1.0000    0.4471
+    1.0000    1.0000    0.4588
+    1.0000    1.0000    0.4706
+    1.0000    1.0000    0.4824
+    1.0000    1.0000    0.4941
+    1.0000    1.0000    0.5059
+    1.0000    1.0000    0.5176
+    1.0000    1.0000    0.5294
+    1.0000    1.0000    0.5412
+    1.0000    1.0000    0.5529
+    1.0000    1.0000    0.5647
+    1.0000    1.0000    0.5765
+    1.0000    1.0000    0.5882
+    1.0000    1.0000    0.6000
+    1.0000    1.0000    0.6118
+    1.0000    1.0000    0.6235
+    1.0000    1.0000    0.6353
+    1.0000    1.0000    0.6471
+    1.0000    1.0000    0.6588
+    1.0000    1.0000    0.6706
+    1.0000    1.0000    0.6824
+    1.0000    1.0000    0.6941
+    1.0000    1.0000    0.7059
+    1.0000    1.0000    0.7176
+    1.0000    1.0000    0.7294
+    1.0000    1.0000    0.7412
+    1.0000    1.0000    0.7529
+    1.0000    1.0000    0.7647
+    1.0000    1.0000    0.7765
+    1.0000    1.0000    0.7882
+    1.0000    1.0000    0.8000
+    1.0000    1.0000    0.8118
+    1.0000    1.0000    0.8235
+    1.0000    1.0000    0.8353
+    1.0000    1.0000    0.8471
+    1.0000    1.0000    0.8588
+    1.0000    1.0000    0.8706
+    1.0000    1.0000    0.8824
+    1.0000    1.0000    0.8941
+    1.0000    1.0000    0.9059
+    1.0000    1.0000    0.9176
+    1.0000    1.0000    0.9294
+    1.0000    1.0000    0.9412
+    1.0000    1.0000    0.9529
+    1.0000    1.0000    0.9647
+    1.0       0.0       0.0
+    1.0       1.0       0.0
+    0.0       1.000     0.0
+&quot;&quot;&quot;
+
+colormapAFMHot=&quot;&quot;&quot;
+    0.0000    0.0000    0.0000
+    0.0078    0.0000    0.0000
+    0.0157    0.0000    0.0000
+    0.0235    0.0000    0.0000
+    0.0314    0.0000    0.0000
+    0.0392    0.0000    0.0000
+    0.0471    0.0000    0.0000
+    0.0549    0.0000    0.0000
+    0.0627    0.0000    0.0000
+    0.0706    0.0000    0.0000
+    0.0784    0.0000    0.0000
+    0.0863    0.0000    0.0000
+    0.0941    0.0000    0.0000
+    0.1020    0.0000    0.0000
+    0.1098    0.0000    0.0000
+    0.1176    0.0000    0.0000
+    0.1255    0.0000    0.0000
+    0.1333    0.0000    0.0000
+    0.1412    0.0000    0.0000
+    0.1490    0.0000    0.0000
+    0.1569    0.0000    0.0000
+    0.1647    0.0000    0.0000
+    0.1725    0.0000    0.0000
+    0.1804    0.0000    0.0000
+    0.1882    0.0000    0.0000
+    0.1961    0.0000    0.0000
+    0.2039    0.0000    0.0000
+    0.2118    0.0000    0.0000
+    0.2196    0.0000    0.0000
+    0.2275    0.0000    0.0000
+    0.2353    0.0000    0.0000
+    0.2431    0.0000    0.0000
+    0.2510    0.0000    0.0000
+    0.2588    0.0000    0.0000
+    0.2667    0.0000    0.0000
+    0.2745    0.0000    0.0000
+    0.2824    0.0000    0.0000
+    0.2902    0.0000    0.0000
+    0.2980    0.0000    0.0000
+    0.3059    0.0000    0.0000
+    0.3137    0.0000    0.0000
+    0.3216    0.0000    0.0000
+    0.3294    0.0000    0.0000
+    0.3373    0.0000    0.0000
+    0.3451    0.0000    0.0000
+    0.3529    0.0000    0.0000
+    0.3608    0.0000    0.0000
+    0.3686    0.0000    0.0000
+    0.3765    0.0000    0.0000
+    0.3843    0.0000    0.0000
+    0.3922    0.0000    0.0000
+    0.4000    0.0000    0.0000
+    0.4078    0.0000    0.0000
+    0.4157    0.0000    0.0000
+    0.4235    0.0000    0.0000
+    0.4314    0.0000    0.0000
+    0.4392    0.0000    0.0000
+    0.4471    0.0000    0.0000
+    0.4549    0.0000    0.0000
+    0.4627    0.0000    0.0000
+    0.4706    0.0000    0.0000
+    0.4784    0.0000    0.0000
+    0.4863    0.0000    0.0000
+    0.4941    0.0000    0.0000
+    0.5020    0.0000    0.0000
+    0.5098    0.0098    0.0000
+    0.5176    0.0176    0.0000
+    0.5255    0.0255    0.0000
+    0.5333    0.0333    0.0000
+    0.5412    0.0412    0.0000
+    0.5490    0.0490    0.0000
+    0.5569    0.0569    0.0000
+    0.5647    0.0647    0.0000
+    0.5725    0.0725    0.0000
+    0.5804    0.0804    0.0000
+    0.5882    0.0882    0.0000
+    0.5961    0.0961    0.0000
+    0.6039    0.1039    0.0000
+    0.6118    0.1118    0.0000
+    0.6196    0.1196    0.0000
+    0.6275    0.1275    0.0000
+    0.6353    0.1353    0.0000
+    0.6431    0.1431    0.0000
+    0.6510    0.1510    0.0000
+    0.6588    0.1588    0.0000
+    0.6667    0.1667    0.0000
+    0.6745    0.1745    0.0000
+    0.6824    0.1824    0.0000
+    0.6902    0.1902    0.0000
+    0.6980    0.1980    0.0000
+    0.7059    0.2059    0.0000
+    0.7137    0.2137    0.0000
+    0.7216    0.2216    0.0000
+    0.7294    0.2294    0.0000
+    0.7373    0.2373    0.0000
+    0.7451    0.2451    0.0000
+    0.7529    0.2529    0.0000
+    0.7608    0.2608    0.0000
+    0.7686    0.2686    0.0000
+    0.7765    0.2765    0.0000
+    0.7843    0.2843    0.0000
+    0.7922    0.2922    0.0000
+    0.8000    0.3000    0.0000
+    0.8078    0.3078    0.0000
+    0.8157    0.3157    0.0000
+    0.8235    0.3235    0.0000
+    0.8314    0.3314    0.0000
+    0.8392    0.3392    0.0000
+    0.8471    0.3471    0.0000
+    0.8549    0.3549    0.0000
+    0.8627    0.3627    0.0000
+    0.8706    0.3706    0.0000
+    0.8784    0.3784    0.0000
+    0.8863    0.3863    0.0000
+    0.8941    0.3941    0.0000
+    0.9020    0.4020    0.0000
+    0.9098    0.4098    0.0000
+    0.9176    0.4176    0.0000
+    0.9255    0.4255    0.0000
+    0.9333    0.4333    0.0000
+    0.9412    0.4412    0.0000
+    0.9490    0.4490    0.0000
+    0.9569    0.4569    0.0000
+    0.9647    0.4647    0.0000
+    0.9725    0.4725    0.0000
+    0.9804    0.4804    0.0000
+    0.9882    0.4882    0.0000
+    0.9961    0.4961    0.0000
+    1.0000    0.5039    0.0000
+    1.0000    0.5118    0.0118
+    1.0000    0.5196    0.0196
+    1.0000    0.5275    0.0275
+    1.0000    0.5353    0.0353
+    1.0000    0.5431    0.0431
+    1.0000    0.5510    0.0510
+    1.0000    0.5588    0.0588
+    1.0000    0.5667    0.0667
+    1.0000    0.5745    0.0745
+    1.0000    0.5824    0.0824
+    1.0000    0.5902    0.0902
+    1.0000    0.5980    0.0980
+    1.0000    0.6059    0.1059
+    1.0000    0.6137    0.1137
+    1.0000    0.6216    0.1216
+    1.0000    0.6294    0.1294
+    1.0000    0.6373    0.1373
+    1.0000    0.6451    0.1451
+    1.0000    0.6529    0.1529
+    1.0000    0.6608    0.1608
+    1.0000    0.6686    0.1686
+    1.0000    0.6765    0.1765
+    1.0000    0.6843    0.1843
+    1.0000    0.6922    0.1922
+    1.0000    0.7000    0.2000
+    1.0000    0.7078    0.2078
+    1.0000    0.7157    0.2157
+    1.0000    0.7235    0.2235
+    1.0000    0.7314    0.2314
+    1.0000    0.7392    0.2392
+    1.0000    0.7471    0.2471
+    1.0000    0.7549    0.2549
+    1.0000    0.7627    0.2627
+    1.0000    0.7706    0.2706
+    1.0000    0.7784    0.2784
+    1.0000    0.7863    0.2863
+    1.0000    0.7941    0.2941
+    1.0000    0.8020    0.3020
+    1.0000    0.8098    0.3098
+    1.0000    0.8176    0.3176
+    1.0000    0.8255    0.3255
+    1.0000    0.8333    0.3333
+    1.0000    0.8412    0.3412
+    1.0000    0.8490    0.3490
+    1.0000    0.8569    0.3569
+    1.0000    0.8647    0.3647
+    1.0000    0.8725    0.3725
+    1.0000    0.8804    0.3804
+    1.0000    0.8882    0.3882
+    1.0000    0.8961    0.3961
+    1.0000    0.9039    0.4039
+    1.0000    0.9118    0.4118
+    1.0000    0.9196    0.4196
+    1.0000    0.9275    0.4275
+    1.0000    0.9353    0.4353
+    1.0000    0.9431    0.4431
+    1.0000    0.9510    0.4510
+    1.0000    0.9588    0.4588
+    1.0000    0.9667    0.4667
+    1.0000    0.9745    0.4745
+    1.0000    0.9824    0.4824
+    1.0000    0.9902    0.4902
+    1.0000    0.9980    0.4980
+    1.0000    1.0000    0.5059
+    1.0000    1.0000    0.5137
+    1.0000    1.0000    0.5216
+    1.0000    1.0000    0.5294
+    1.0000    1.0000    0.5373
+    1.0000    1.0000    0.5451
+    1.0000    1.0000    0.5529
+    1.0000    1.0000    0.5608
+    1.0000    1.0000    0.5686
+    1.0000    1.0000    0.5765
+    1.0000    1.0000    0.5843
+    1.0000    1.0000    0.5922
+    1.0000    1.0000    0.6000
+    1.0000    1.0000    0.6078
+    1.0000    1.0000    0.6157
+    1.0000    1.0000    0.6235
+    1.0000    1.0000    0.6314
+    1.0000    1.0000    0.6392
+    1.0000    1.0000    0.6471
+    1.0000    1.0000    0.6549
+    1.0000    1.0000    0.6627
+    1.0000    1.0000    0.6706
+    1.0000    1.0000    0.6784
+    1.0000    1.0000    0.6863
+    1.0000    1.0000    0.6941
+    1.0000    1.0000    0.7020
+    1.0000    1.0000    0.7098
+    1.0000    1.0000    0.7176
+    1.0000    1.0000    0.7255
+    1.0000    1.0000    0.7333
+    1.0000    1.0000    0.7412
+    1.0000    1.0000    0.7490
+    1.0000    1.0000    0.7569
+    1.0000    1.0000    0.7647
+    1.0000    1.0000    0.7725
+    1.0000    1.0000    0.7804
+    1.0000    1.0000    0.7882
+    1.0000    1.0000    0.7961
+    1.0000    1.0000    0.8039
+    1.0000    1.0000    0.8118
+    1.0000    1.0000    0.8196
+    1.0000    1.0000    0.8275
+    1.0000    1.0000    0.8353
+    1.0000    1.0000    0.8431
+    1.0000    1.0000    0.8510
+    1.0000    1.0000    0.8588
+    1.0000    1.0000    0.8667
+    1.0000    1.0000    0.8745
+    1.0000    1.0000    0.8824
+    1.0000    1.0000    0.8902
+    1.0000    1.0000    0.8980
+    1.0000    1.0000    0.9059
+    1.0000    1.0000    0.9137
+    1.0000    1.0000    0.9216
+    1.0000    1.0000    0.9294
+    1.0000    1.0000    0.9373
+    1.0000    1.0000    0.9451
+    1.0000    1.0000    0.9529
+    1.0000    1.0000    0.9608
+    1.0000    1.0000    0.9686
+    1.0000    1.0000    0.9765
+    1.0       0.0       0.0
+    1.0       1.0       0.0
+    0.0       1.000     0.0
+&quot;&quot;&quot;
+colormapgray1 =  &quot;&quot;&quot;
+    1.0000    1.0000    1.0000
+    0.9961    0.9961    0.9961
+    0.9922    0.9922    0.9922
+    0.9882    0.9882    0.9882
+    0.9843    0.9843    0.9843
+    0.9804    0.9804    0.9804
+    0.9765    0.9765    0.9765
+    0.9725    0.9725    0.9725
+    0.9686    0.9686    0.9686
+    0.9647    0.9647    0.9647
+    0.9608    0.9608    0.9608
+    0.9569    0.9569    0.9569
+    0.9529    0.9529    0.9529
+    0.9490    0.9490    0.9490
+    0.9451    0.9451    0.9451
+    0.9412    0.9412    0.9412
+    0.9373    0.9373    0.9373
+    0.9333    0.9333    0.9333
+    0.9294    0.9294    0.9294
+    0.9255    0.9255    0.9255
+    0.9216    0.9216    0.9216
+    0.9176    0.9176    0.9176
+    0.9137    0.9137    0.9137
+    0.9098    0.9098    0.9098
+    0.9059    0.9059    0.9059
+    0.9020    0.9020    0.9020
+    0.8980    0.8980    0.8980
+    0.8941    0.8941    0.8941
+    0.8902    0.8902    0.8902
+    0.8863    0.8863    0.8863
+    0.8824    0.8824    0.8824
+    0.8784    0.8784    0.8784
+    0.8745    0.8745    0.8745
+    0.8706    0.8706    0.8706
+    0.8667    0.8667    0.8667
+    0.8627    0.8627    0.8627
+    0.8588    0.8588    0.8588
+    0.8549    0.8549    0.8549
+    0.8510    0.8510    0.8510
+    0.8471    0.8471    0.8471
+    0.8431    0.8431    0.8431
+    0.8392    0.8392    0.8392
+    0.8353    0.8353    0.8353
+    0.8314    0.8314    0.8314
+    0.8275    0.8275    0.8275
+    0.8235    0.8235    0.8235
+    0.8196    0.8196    0.8196
+    0.8157    0.8157    0.8157
+    0.8118    0.8118    0.8118
+    0.8078    0.8078    0.8078
+    0.8039    0.8039    0.8039
+    0.8000    0.8000    0.8000
+    0.7961    0.7961    0.7961
+    0.7922    0.7922    0.7922
+    0.7882    0.7882    0.7882
+    0.7843    0.7843    0.7843
+    0.7804    0.7804    0.7804
+    0.7765    0.7765    0.7765
+    0.7725    0.7725    0.7725
+    0.7686    0.7686    0.7686
+    0.7647    0.7647    0.7647
+    0.7608    0.7608    0.7608
+    0.7569    0.7569    0.7569
+    0.7529    0.7529    0.7529
+    0.7490    0.7490    0.7490
+    0.7451    0.7451    0.7451
+    0.7412    0.7412    0.7412
+    0.7373    0.7373    0.7373
+    0.7333    0.7333    0.7333
+    0.7294    0.7294    0.7294
+    0.7255    0.7255    0.7255
+    0.7216    0.7216    0.7216
+    0.7176    0.7176    0.7176
+    0.7137    0.7137    0.7137
+    0.7098    0.7098    0.7098
+    0.7059    0.7059    0.7059
+    0.7020    0.7020    0.7020
+    0.6980    0.6980    0.6980
+    0.6941    0.6941    0.6941
+    0.6902    0.6902    0.6902
+    0.6863    0.6863    0.6863
+    0.6824    0.6824    0.6824
+    0.6784    0.6784    0.6784
+    0.6745    0.6745    0.6745
+    0.6706    0.6706    0.6706
+    0.6667    0.6667    0.6667
+    0.6627    0.6627    0.6627
+    0.6588    0.6588    0.6588
+    0.6549    0.6549    0.6549
+    0.6510    0.6510    0.6510
+    0.6471    0.6471    0.6471
+    0.6431    0.6431    0.6431
+    0.6392    0.6392    0.6392
+    0.6353    0.6353    0.6353
+    0.6314    0.6314    0.6314
+    0.6275    0.6275    0.6275
+    0.6235    0.6235    0.6235
+    0.6196    0.6196    0.6196
+    0.6157    0.6157    0.6157
+    0.6118    0.6118    0.6118
+    0.6078    0.6078    0.6078
+    0.6039    0.6039    0.6039
+    0.6000    0.6000    0.6000
+    0.5961    0.5961    0.5961
+    0.5922    0.5922    0.5922
+    0.5882    0.5882    0.5882
+    0.5843    0.5843    0.5843
+    0.5804    0.5804    0.5804
+    0.5765    0.5765    0.5765
+    0.5725    0.5725    0.5725
+    0.5686    0.5686    0.5686
+    0.5647    0.5647    0.5647
+    0.5608    0.5608    0.5608
+    0.5569    0.5569    0.5569
+    0.5529    0.5529    0.5529
+    0.5490    0.5490    0.5490
+    0.5451    0.5451    0.5451
+    0.5412    0.5412    0.5412
+    0.5373    0.5373    0.5373
+    0.5333    0.5333    0.5333
+    0.5294    0.5294    0.5294
+    0.5255    0.5255    0.5255
+    0.5216    0.5216    0.5216
+    0.5176    0.5176    0.5176
+    0.5137    0.5137    0.5137
+    0.5098    0.5098    0.5098
+    0.5059    0.5059    0.5059
+    0.5020    0.5020    0.5020
+    0.4980    0.4980    0.4980
+    0.4941    0.4941    0.4941
+    0.4902    0.4902    0.4902
+    0.4863    0.4863    0.4863
+    0.4824    0.4824    0.4824
+    0.4784    0.4784    0.4784
+    0.4745    0.4745    0.4745
+    0.4706    0.4706    0.4706
+    0.4667    0.4667    0.4667
+    0.4627    0.4627    0.4627
+    0.4588    0.4588    0.4588
+    0.4549    0.4549    0.4549
+    0.4510    0.4510    0.4510
+    0.4471    0.4471    0.4471
+    0.4431    0.4431    0.4431
+    0.4392    0.4392    0.4392
+    0.4353    0.4353    0.4353
+    0.4314    0.4314    0.4314
+    0.4275    0.4275    0.4275
+    0.4235    0.4235    0.4235
+    0.4196    0.4196    0.4196
+    0.4157    0.4157    0.4157
+    0.4118    0.4118    0.4118
+    0.4078    0.4078    0.4078
+    0.4039    0.4039    0.4039
+    0.4000    0.4000    0.4000
+    0.3961    0.3961    0.3961
+    0.3922    0.3922    0.3922
+    0.3882    0.3882    0.3882
+    0.3843    0.3843    0.3843
+    0.3804    0.3804    0.3804
+    0.3765    0.3765    0.3765
+    0.3725    0.3725    0.3725
+    0.3686    0.3686    0.3686
+    0.3647    0.3647    0.3647
+    0.3608    0.3608    0.3608
+    0.3569    0.3569    0.3569
+    0.3529    0.3529    0.3529
+    0.3490    0.3490    0.3490
+    0.3451    0.3451    0.3451
+    0.3412    0.3412    0.3412
+    0.3373    0.3373    0.3373
+    0.3333    0.3333    0.3333
+    0.3294    0.3294    0.3294
+    0.3255    0.3255    0.3255
+    0.3216    0.3216    0.3216
+    0.3176    0.3176    0.3176
+    0.3137    0.3137    0.3137
+    0.3098    0.3098    0.3098
+    0.3059    0.3059    0.3059
+    0.3020    0.3020    0.3020
+    0.2980    0.2980    0.2980
+    0.2941    0.2941    0.2941
+    0.2902    0.2902    0.2902
+    0.2863    0.2863    0.2863
+    0.2824    0.2824    0.2824
+    0.2784    0.2784    0.2784
+    0.2745    0.2745    0.2745
+    0.2706    0.2706    0.2706
+    0.2667    0.2667    0.2667
+    0.2627    0.2627    0.2627
+    0.2588    0.2588    0.2588
+    0.2549    0.2549    0.2549
+    0.2510    0.2510    0.2510
+    0.2471    0.2471    0.2471
+    0.2431    0.2431    0.2431
+    0.2392    0.2392    0.2392
+    0.2353    0.2353    0.2353
+    0.2314    0.2314    0.2314
+    0.2275    0.2275    0.2275
+    0.2235    0.2235    0.2235
+    0.2196    0.2196    0.2196
+    0.2157    0.2157    0.2157
+    0.2118    0.2118    0.2118
+    0.2078    0.2078    0.2078
+    0.2039    0.2039    0.2039
+    0.2000    0.2000    0.2000
+    0.1961    0.1961    0.1961
+    0.1922    0.1922    0.1922
+    0.1882    0.1882    0.1882
+    0.1843    0.1843    0.1843
+    0.1804    0.1804    0.1804
+    0.1765    0.1765    0.1765
+    0.1725    0.1725    0.1725
+    0.1686    0.1686    0.1686
+    0.1647    0.1647    0.1647
+    0.1608    0.1608    0.1608
+    0.1569    0.1569    0.1569
+    0.1529    0.1529    0.1529
+    0.1490    0.1490    0.1490
+    0.1451    0.1451    0.1451
+    0.1412    0.1412    0.1412
+    0.1373    0.1373    0.1373
+    0.1333    0.1333    0.1333
+    0.1294    0.1294    0.1294
+    0.1255    0.1255    0.1255
+    0.1216    0.1216    0.1216
+    0.1176    0.1176    0.1176
+    0.1137    0.1137    0.1137
+    0.1098    0.1098    0.1098
+    0.1059    0.1059    0.1059
+    0.1020    0.1020    0.1020
+    0.0980    0.0980    0.0980
+    0.0941    0.0941    0.0941
+    0.0902    0.0902    0.0902
+    0.0863    0.0863    0.0863
+    0.0824    0.0824    0.0824
+    0.0784    0.0784    0.0784
+    0.0745    0.0745    0.0745
+    0.0706    0.0706    0.0706
+    0.0667    0.0667    0.0667
+    0.0627    0.0627    0.0627
+    0.0588    0.0588    0.0588
+    0.0549    0.0549    0.0549
+    0.0510    0.0510    0.0510
+    0.0471    0.0471    0.0471
+    0.0431    0.0431    0.0431
+    0.0392    0.0392    0.0392
+    0.0353    0.0353    0.0353
+    0.0314    0.0314    0.0314
+    0.0275    0.0275    0.0275
+    0.0235    0.0235    0.0235
+    0.0196    0.0196    0.0196
+    0.0157    0.0157    0.0157
+    0.0118    0.0118    0.0118
+    1.0       0.0       0.0
+    1.0       1.0       0.0
+    0.0       1.000     0.0
+&quot;&quot;&quot;
+colormapLinrad =  &quot;&quot;&quot;
+    0.0000    0.0000    0.0000
+    0.0000    0.0000    0.0123
+    0.0000    0.0000    0.0246
+    0.0000    0.0000    0.0368
+    0.0000    0.0000    0.0490
+    0.0000    0.0000    0.0612
+    0.0000    0.0000    0.0734
+    0.0000    0.0000    0.0855
+    0.0000    0.0000    0.0975
+    0.0000    0.0000    0.1094
+    0.0000    0.0000    0.1213
+    0.0000    0.0000    0.1331
+    0.0000    0.0000    0.1448
+    0.0000    0.0000    0.1564
+    0.0000    0.0000    0.1678
+    0.0000    0.0000    0.1792
+    0.0000    0.0000    0.1904
+    0.0000    0.0000    0.2015
+    0.0000    0.0000    0.2124
+    0.0000    0.0000    0.2232
+    0.0000    0.0000    0.2338
+    0.0000    0.0000    0.2442
+    0.0000    0.0000    0.2545
+    0.0000    0.0000    0.2645
+    0.0000    0.0000    0.2744
+    0.0000    0.0000    0.2841
+    0.0000    0.0000    0.2935
+    0.0000    0.0000    0.3028
+    0.0000    0.0000    0.3118
+    0.0000    0.0000    0.3206
+    0.0000    0.0000    0.3292
+    0.0000    0.0000    0.3375
+    0.0000    0.0000    0.3456
+    0.0000    0.0000    0.3534
+    0.0000    0.0000    0.3609
+    0.0000    0.0036    0.3682
+    0.0000    0.0149    0.3752
+    0.0000    0.0262    0.3820
+    0.0000    0.0375    0.3885
+    0.0000    0.0487    0.3946
+    0.0000    0.0600    0.4005
+    0.0000    0.0712    0.4061
+    0.0000    0.0824    0.4114
+    0.0000    0.0936    0.4164
+    0.0000    0.1047    0.4211
+    0.0000    0.1158    0.4255
+    0.0000    0.1269    0.4295
+    0.0000    0.1379    0.4333
+    0.0000    0.1489    0.4367
+    0.0000    0.1599    0.4398
+    0.0000    0.1707    0.4426
+    0.0000    0.1816    0.4451
+    0.0000    0.1923    0.4472
+    0.0000    0.2030    0.4490
+    0.0000    0.2137    0.4505
+    0.0000    0.2243    0.4517
+    0.0000    0.2348    0.4525
+    0.0000    0.2452    0.4530
+    0.0000    0.2555    0.4531
+    0.0000    0.2658    0.4529
+    0.0000    0.2760    0.4524
+    0.0000    0.2860    0.4516
+    0.0000    0.2960    0.4504
+    0.0000    0.3059    0.4489
+    0.0000    0.3157    0.4471
+    0.0000    0.3254    0.4449
+    0.0000    0.3350    0.4424
+    0.0000    0.3445    0.4396
+    0.0000    0.3538    0.4364
+    0.0000    0.3631    0.4330
+    0.0000    0.3722    0.4292
+    0.0000    0.3812    0.4251
+    0.0000    0.3901    0.4207
+    0.0000    0.3988    0.4160
+    0.0000    0.4075    0.4109
+    0.0000    0.4160    0.4056
+    0.0000    0.4243    0.4000
+    0.0000    0.4325    0.3941
+    0.0000    0.4406    0.3879
+    0.0000    0.4486    0.3814
+    0.0000    0.4563    0.3746
+    0.0000    0.4640    0.3676
+    0.0000    0.4715    0.3603
+    0.0000    0.4788    0.3527
+    0.0000    0.4860    0.3448
+    0.0000    0.4930    0.3367
+    0.0000    0.4998    0.3284
+    0.0000    0.5065    0.3198
+    0.0000    0.5131    0.3110
+    0.0000    0.5194    0.3020
+    0.0000    0.5256    0.2927
+    0.0000    0.5316    0.2832
+    0.0000    0.5375    0.2735
+    0.0000    0.5432    0.2636
+    0.0000    0.5487    0.2535
+    0.0000    0.5540    0.2433
+    0.0000    0.5591    0.2328
+    0.0000    0.5641    0.2222
+    0.0000    0.5688    0.2114
+    0.0000    0.5734    0.2005
+    0.0000    0.5778    0.1894
+    0.0000    0.5820    0.1782
+    0.0000    0.5860    0.1668
+    0.0000    0.5899    0.1553
+    0.0000    0.5935    0.1437
+    0.0120    0.5969    0.1320
+    0.0289    0.6002    0.1202
+    0.0458    0.6032    0.1084
+    0.0628    0.6061    0.0964
+    0.0797    0.6088    0.0844
+    0.0966    0.6112    0.0723
+    0.1134    0.6135    0.0601
+    0.1302    0.6155    0.0479
+    0.1470    0.6174    0.0357
+    0.1638    0.6190    0.0234
+    0.1805    0.6205    0.0112
+    0.1971    0.6217   -0.0011
+    0.2137    0.6228    0.0000
+    0.2302    0.6236    0.0000
+    0.2467    0.6243    0.0000
+    0.2631    0.6247    0.0000
+    0.2794    0.6250    0.0000
+    0.2957    0.6250    0.0000
+    0.3118    0.6248    0.0000
+    0.3279    0.6244    0.0000
+    0.3438    0.6239    0.0000
+    0.3597    0.6231    0.0000
+    0.3755    0.6221    0.0000
+    0.3911    0.6209    0.0000
+    0.4067    0.6195    0.0000
+    0.4221    0.6179    0.0000
+    0.4374    0.6161    0.0000
+    0.4526    0.6141    0.0000
+    0.4676    0.6119    0.0000
+    0.4826    0.6095    0.0000
+    0.4973    0.6069    0.0000
+    0.5120    0.6041    0.0000
+    0.5265    0.6011    0.0000
+    0.5408    0.5980    0.0000
+    0.5550    0.5946    0.0000
+    0.5690    0.5910    0.0000
+    0.5829    0.5872    0.0000
+    0.5965    0.5833    0.0000
+    0.6101    0.5791    0.0000
+    0.6234    0.5748    0.0000
+    0.6366    0.5702    0.0000
+    0.6496    0.5655    0.0000
+    0.6623    0.5606    0.0000
+    0.6750    0.5556    0.0000
+    0.6874    0.5503    0.0000
+    0.6996    0.5449    0.0000
+    0.7116    0.5392    0.0000
+    0.7234    0.5334    0.0000
+    0.7350    0.5275    0.0000
+    0.7464    0.5213    0.0000
+    0.7576    0.5150    0.0000
+    0.7685    0.5085    0.0000
+    0.7793    0.5019    0.0000
+    0.7898    0.4951    0.0000
+    0.8000    0.4881    0.0000
+    0.8101    0.4810    0.0000
+    0.8199    0.4737    0.0000
+    0.8295    0.4663    0.0000
+    0.8389    0.4587    0.0000
+    0.8480    0.4509    0.0000
+    0.8568    0.4430    0.0000
+    0.8654    0.4350    0.0000
+    0.8738    0.4268    0.0000
+    0.8819    0.4185    0.0000
+    0.8898    0.4101    0.0000
+    0.8974    0.4015    0.0000
+    0.9048    0.3928    0.0000
+    0.9118    0.3839    0.0000
+    0.9187    0.3749    0.0000
+    0.9252    0.3658    0.0000
+    0.9315    0.3566    0.0000
+    0.9376    0.3473    0.0000
+    0.9433    0.3379    0.0000
+    0.9488    0.3283    0.0000
+    0.9540    0.3187    0.0000
+    0.9590    0.3089    0.0000
+    0.9636    0.2990    0.0000
+    0.9680    0.2891    0.0000
+    0.9721    0.2790    0.0000
+    0.9760    0.2689    0.0000
+    0.9795    0.2586    0.0000
+    0.9828    0.2483    0.0083
+    0.9858    0.2379    0.0219
+    0.9885    0.2274    0.0354
+    0.9909    0.2169    0.0489
+    0.9931    0.2063    0.0625
+    0.9949    0.1956    0.0760
+    0.9965    0.1848    0.0896
+    0.9978    0.1740    0.1031
+    0.9987    0.1632    0.1167
+    0.9995    0.1522    0.1303
+    0.9999    0.1413    0.1439
+    1.0000    0.1302    0.1575
+    1.0000    0.1712    0.1712
+    1.0000    0.1848    0.1848
+    1.0000    0.1986    0.1986
+    1.0000    0.2123    0.2123
+    1.0000    0.2261    0.2261
+    1.0000    0.2400    0.2400
+    1.0000    0.2539    0.2539
+    1.0000    0.2678    0.2678
+    1.0000    0.2819    0.2819
+    1.0000    0.2960    0.2960
+    1.0000    0.3102    0.3102
+    1.0000    0.3245    0.3245
+    1.0000    0.3389    0.3389
+    1.0000    0.3535    0.3535
+    1.0000    0.3681    0.3681
+    1.0000    0.3829    0.3829
+    1.0000    0.3978    0.3978
+    1.0000    0.4129    0.4129
+    1.0000    0.4282    0.4282
+    1.0000    0.4436    0.4436
+    1.0000    0.4592    0.4592
+    1.0000    0.4750    0.4750
+    1.0000    0.4910    0.4910
+    1.0000    0.5072    0.5072
+    1.0000    0.5237    0.5237
+    1.0000    0.5405    0.5405
+    1.0000    0.5574    0.5574
+    1.0000    0.5747    0.5747
+    1.0000    0.5923    0.5923
+    1.0000    0.6102    0.6102
+    1.0000    0.6284    0.6284
+    1.0000    0.6469    0.6469
+    1.0000    0.6658    0.6658
+    1.0000    0.6851    0.6851
+    1.0000    0.7047    0.7047
+    1.0000    0.7248    0.7248
+    1.0000    0.7453    0.7453
+    1.0000    0.7662    0.7662
+    1.0000    0.7876    0.7876
+    1.0000    0.8095    0.8095
+    1.0000    0.8319    0.8319
+    1.0000    0.8548    0.8548
+    1.0000    0.8782    0.8782
+    1.0000    0.9022    0.9022
+    1.0000    0.9268    0.9268
+    1.0000    0.9519    0.9519
+    1.0000    0.9777    0.9777
+    1.0000    1.0000    1.0000
+    1.0000    1.0000    1.0000
+    1.0000    1.0000    1.0000
+    1.0000    1.0000    1.0000
+    1.0000    1.0000    1.0000
+    1.0000    1.0000    1.0000
+    1.0000    1.0000    1.0000
+    1.0000    1.0000    1.0000
+    1.0       0.0       0.0
+    1.0       1.0       0.0
+    0.0       1.000     0.0
+&quot;&quot;&quot;
+
+#----------------------------------------------------- Colormap2Palette
+def Colormap2Palette(colormap=colormapLinrad):
+    &quot;&quot;&quot; convert a matlab type colormap to a PIL palette &quot;&quot;&quot;
+    x = map(lambda x,colormap=colormap: int(string.atof(x)*255), string.split(colormap))
+    palette = [(0,0,0)] * 256
+    for i in range(len(x)/3):
+	palette[i] = (x[i*3], x[i*3+1], x[i*3+2])
+    palette = map(lambda a: chr(a[0])+chr(a[1])+chr(a[2]), palette)
+    palette = string.join(palette, &quot;&quot;)
+    g.palette=palette
+    return palette

Added: branches/wspr/tkrep.py
===================================================================
--- branches/wspr/tkrep.py	                        (rev 0)
+++ branches/wspr/tkrep.py	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,29 @@
+#replacement for Tk classes
+
+NONE=None
+
+class IntVar:
+    def __init__(self):
+        self.i = 0
+    def set(self, i):
+        self.i = int(i)
+    def get(self):
+        return self.i
+
+class StringVar:
+    def __init__(self):
+        self.i = ''
+    def set(self, i):
+        self.i = i
+    def get(self):
+        return self.i
+
+# Sivan: seems that newly created DoubleVar's contain a string, not a float 0.0. Strange
+class DoubleVar:
+    def __init__(self):
+        self.i = 0.0
+    def set(self, i):
+        self.i = float(i)
+    def get(self):
+        return self.i
+

Added: branches/wspr/wspr_nogui.py
===================================================================
--- branches/wspr/wspr_nogui.py	                        (rev 0)
+++ branches/wspr/wspr_nogui.py	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,1912 @@
+#------------------------------------------------------------------ WSPR
+# $Date: 2008-03-17 08:29:04 -0400 (Mon, 17 Mar 2008) $ $Revision: 2326 $
+#
+#from Tkinter import *
+#from tkFileDialog import *
+#import tkMessageBox
+from tkrep import *
+import os,time,sys
+#from WsprMod import g,Pmw
+from WsprMod import palettes
+from WsprModNoGui import g
+#from WsprModNoGui import tkrep 
+from math import log10
+try:
+    from numpy.oldnumeric import zeros
+except: 
+    from Numeric import zeros
+import array
+import dircache
+#import Image, ImageTk, ImageDraw
+import Image, ImageDraw
+from WsprMod.palettes import colormapblue, colormapgray0, colormapHot, \
+     colormapAFMHot, colormapgray1, colormapLinrad, Colormap2Palette
+from types import *
+import array
+import random
+import math
+import string
+from WsprMod import w
+# from WsprMod import smeter
+import socket
+import urllib
+import thread
+import webbrowser
+
+# root = Tk()
+Version=&quot;3.00_r&quot; + &quot;$Rev: 2326 $&quot;[6:-2]
+print &quot;******************************************************************&quot;
+print &quot;WSPR Version &quot; + Version + &quot;, by K1JT&quot;
+print &quot;Run date:   &quot; + time.asctime(time.gmtime()) + &quot; UTC&quot;
+
+#See if we are running in Windows
+print 'setting g.Win32'
+g.Win32=0
+if sys.platform==&quot;win32&quot;:
+    g.Win32=1
+    try:
+        root.option_readfile('wsprrc.win')
+    except:
+        pass
+else:
+    try:
+        root.option_readfile('wsprrc')
+    except:
+        pass
+root_geom=&quot;&quot;
+appdir=os.getcwd()
+w.acom1.nappdir=len(appdir)
+w.acom1.appdir=(appdir+(' '*80))[:80]
+i1,i2=w.audiodev(0,2)
+from WsprModNoGui import options
+from WsprModNoGui import advanced
+from WsprModNoGui import iq
+from WsprModNoGui import hopping
+
+#------------------------------------------------------ Global variables
+band=[-1,600,160,80,60,40,30,20,17,15,12,10,6,4,2,0]
+bandmap=[]
+bm={}
+f0=DoubleVar()
+ftx=DoubleVar()
+ftx0=0.
+ft=[]
+fileopened=&quot;&quot;
+fmid=0.0
+fmid0=0.0
+font1='Helvetica'
+iband=IntVar()
+iband0=0
+idle=IntVar()
+ierr=0
+ipctx=IntVar()
+isec0=0
+isync=1
+itx0=0
+loopall=0
+modpixmap0=0
+mrudir=os.getcwd()
+ndbm0=-999
+ncall=0
+ndebug=IntVar()
+nin0=0
+nout0=0
+newdat=1
+newspec=1
+no_beep=IntVar()
+npal=IntVar()
+npal.set(2)
+nparam=0
+nsave=IntVar()
+nscroll=0
+nsec0=0
+nspeed0=IntVar()
+ntr0=0
+ntxfirst=IntVar()
+NX=500
+NY=160
+param20=&quot;&quot;
+sf0=StringVar()
+sftx=StringVar()
+start_idle=IntVar()
+t0=&quot;&quot;
+timer1=0
+txmsg=StringVar()
+nreject=0
+gain=1.0
+phdeg=0.0
+
+a=array.array('h')
+im=Image.new('P',(NX,NY))
+draw=ImageDraw.Draw(im)
+im.putpalette(Colormap2Palette(colormapLinrad),&quot;RGB&quot;)
+#pim=ImageTk.PhotoImage(im)
+receiving=0
+scale0=1.0
+offset0=0.0
+s0=0.0
+c0=0.0
+slabel=&quot;MinSync  &quot;
+transmitting=0
+tw=[]
+fw=[] # band labels for spectrum display
+upload=IntVar()
+#balloon=Pmw.Balloon(root)
+
+g.appdir=appdir
+g.cmap=&quot;Linrad&quot;
+g.cmap0=&quot;Linrad&quot;
+g.ndevin=IntVar()
+g.ndevout=IntVar()
+g.DevinName=StringVar()
+g.DevoutName=StringVar()
+
+pwrlist=(-30,-27,-23,-20,-17,-13,-10,-7,-3,   \
+         0,3,7,10,13,17,20,23,27,30,33,37,40,43,47,50,53,57,60)
+freq0=[0,0.5024,1.8366,3.5926,5.2872,7.0386,10.1387,14.0956,18.1046,\
+       21.0946,24.9246,28.1246,50.2930,70.0286,144.4890,0.1360]
+freqtx=[0,0.5024,1.8366,3.5926,5.2872,7.0386,10.1387,14.0956,18.1046,\
+       21.0946,24.9246,28.1246,50.2930,70.0301,144.4890,0.1375]
+
+for i in range(15):
+    freqtx[i]=freq0[i]+0.001500
+
+socktimeout = 10
+socket.setdefaulttimeout(socktimeout)
+
+def pal_gray0():
+    g.cmap=&quot;gray0&quot;
+    im.putpalette(Colormap2Palette(colormapgray0),&quot;RGB&quot;)
+def pal_gray1():
+    g.cmap=&quot;gray1&quot;
+    im.putpalette(Colormap2Palette(colormapgray1),&quot;RGB&quot;)
+def pal_linrad():
+    g.cmap=&quot;Linrad&quot;
+    im.putpalette(Colormap2Palette(colormapLinrad),&quot;RGB&quot;)
+def pal_blue():
+    g.cmap=&quot;blue&quot;
+    im.putpalette(Colormap2Palette(colormapblue),&quot;RGB&quot;)
+def pal_Hot():
+    g.cmap=&quot;Hot&quot;
+    im.putpalette(Colormap2Palette(colormapHot),&quot;RGB&quot;)
+def pal_AFMHot():
+    g.cmap=&quot;AFMHot&quot;
+    im.putpalette(Colormap2Palette(colormapAFMHot),&quot;RGB&quot;)
+
+#------------------------------------------------------ quit
+def quit(event=NONE):
+    root.destroy()
+
+#------------------------------------------------------ openfile
+def openfile(event=NONE):
+    global mrudir,fileopened,nopen,tw
+    nopen=1                         #Work-around for &quot;click feedthrough&quot; bug
+    upload.set(0)
+    try:
+        os.chdir(mrudir)
+    except:
+        pass
+    fname=askopenfilename(filetypes=[(&quot;Wave files&quot;,&quot;*.wav *.WAV&quot;)])
+    if fname:
+        w.getfile(fname,len(fname))
+        mrudir=os.path.dirname(fname)
+        fileopened=os.path.basename(fname)
+        i1=fileopened.find('.')
+        t=fileopened[i1-4:i1]
+        t=t[0:2] + ':' + t[2:4]
+        n=len(tw)
+        if n&gt;12: tw=tw[:n-1]
+        tw=[t,] + tw
+    os.chdir(appdir)
+    idle.set(1)
+
+#------------------------------------------------------ stop_loopall
+def stop_loopall(event=NONE):
+    global loopall
+    loopall=0
+    
+#------------------------------------------------------ opennext
+def opennext(event=NONE):
+    global ncall,fileopened,loopall,mrudir,tw
+    upload.set(0)
+    if fileopened==&quot;&quot; and ncall==0:
+        openfile()
+        ncall=1
+    else:
+# Make a list of *.wav files in mrudir
+        la=os.listdir(mrudir)
+        la.sort()
+        lb=[]
+        for i in range(len(la)):
+            j=la[i].find(&quot;.wav&quot;) + la[i].find(&quot;.WAV&quot;)
+            if j&gt;0: lb.append(la[i])
+        for i in range(len(lb)):
+            if lb[i]==fileopened:
+                break
+        if i&lt;len(lb)-1:
+            fname=mrudir+&quot;/&quot;+lb[i+1]
+            w.getfile(fname,len(fname))
+            mrudir=os.path.dirname(fname)
+            fileopened=os.path.basename(fname)
+            i1=fileopened.find('.')
+            t=fileopened[i1-4:i1]
+            t=t[0:2] + ':' + t[2:4]
+            n=len(tw)
+            if n&gt;12: tw=tw[:n-1]
+            tw=[t,] + tw
+        else:
+            t=&quot;No more *.wav files in this directory.&quot;
+            result=tkMessageBox.showwarning(message=t)
+            ncall=0
+            loopall=0
+            
+#------------------------------------------------------ decodeall
+def decodeall(event=NONE):
+    global loopall
+    loopall=1
+    opennext()
+
+#------------------------------------------------------ hopping1
+def hopping1(event=NONE):
+    t=''
+    if root_geom.find('+')&gt;=0:
+        t=root_geom[root_geom.index('+'):]
+    hopping.hopping2(t)
+
+#------------------------------------------------------ options1
+def options1(event=NONE):
+    t=''
+    if root_geom.find('+')&gt;=0:
+        t=root_geom[root_geom.index('+'):]
+    options.options2(t)
+
+#------------------------------------------------------ advanced1
+def advanced1(event=NONE):
+    t=&quot;&quot;
+    if root_geom.find(&quot;+&quot;)&gt;=0:
+        t=root_geom[root_geom.index(&quot;+&quot;):]
+    advanced.advanced2(t)
+
+#------------------------------------------------------ iq1
+def iq1(event=NONE):
+    t=&quot;&quot;
+    if root_geom.find(&quot;+&quot;)&gt;=0:
+        t=root_geom[root_geom.index(&quot;+&quot;):]
+    iq.iq2(t)
+
+#------------------------------------------------------ stub
+def stub(event=NONE):
+    MsgBox(&quot;Sorry, this function is not yet implemented.&quot;)
+
+#------------------------------------------------------ MsgBox
+def MsgBox(t):
+    result=tkMessageBox.showwarning(message=t)
+
+#------------------------------------------------------ msgpos
+def msgpos():
+    g=root_geom[root_geom.index(&quot;+&quot;):]
+    t=g[1:]
+    x=int(t[:t.index(&quot;+&quot;)])          # + 70
+    y=int(t[t.index(&quot;+&quot;)+1:])        # + 70
+    return &quot;+%d+%d&quot; % (x,y)    
+
+#------------------------------------------------------ about
+def about(event=NONE):
+    global Version
+    about=Toplevel(root)
+    about.geometry(msgpos())
+    if g.Win32: about.iconbitmap(&quot;wsjt.ico&quot;)
+    t=&quot;WSPR Version &quot; + Version + &quot;, by K1JT&quot;
+    Label(about,text=t,font=(font1,16)).pack(padx=20,pady=5)
+    t=&quot;&quot;&quot;
+WSPR (pronounced &quot;whisper&quot;) stands for &quot;Weak Signal
+Propagation Reporter&quot;.  The program generates and decodes
+a digital soundcard mode optimized for beacon-like
+transmissions on the LF, MF, and HF bands.
+
+Copyright (c) 2008-2010 by Joseph H. Taylor, Jr., K1JT, with
+contributions from VA3DB, G4KLA, W1BW, and 4X6IZ.  WSPR is
+Open Source software, licensed under the GNU General Public
+License (GPL).  Source code and programming information may
+be found at <A HREF="http://developer.berlios.de/projects/wsjt/.">http://developer.berlios.de/projects/wsjt/.</A>
+&quot;&quot;&quot;
+    Label(about,text=t,justify=LEFT).pack(padx=20)
+    t=&quot;Revision date: &quot; + \
+      &quot;$Date: 2010-09-17 13:03:38 -0400 (Fri, 17 Sep 2010) $&quot;[7:-1]
+    Label(about,text=t,justify=LEFT).pack(padx=20)
+    about.focus_set()
+
+#------------------------------------------------------ 
+def help(event=NONE):
+    about=Toplevel(root)
+    about.geometry(msgpos())
+    if g.Win32: about.iconbitmap(&quot;wsjt.ico&quot;)
+    t=&quot;Basic Operating Instructions&quot;
+    Label(about,text=t,font=(font1,14)).pack(padx=20,pady=5)
+    t=&quot;&quot;&quot;
+1. Open the Setup | Station Parameters screen and enter
+   your callsign and grid locator 6 characters).  Select
+   desired devices for Audio In and Audio Out, and your
+   power level in dBm.
+   
+2. Select your PTT method (CAT control, DTR, or RTS).  If
+   you choose DTR or RTS, select a PTT port.  If T/R
+   switching or frequency setting will be done by CAT
+   control, select a CAT port and be sure that &quot;Enable CAT&quot;
+   is checked.  You will need to enter a Rig number and
+   correct parameters for the serial connection.
+
+3. Select the desired band from the Band menu and if
+   necessary correct your USB dial frequency on the main
+   screen.  Select a Tx frequency by double-clicking
+   somewhere on the waterfall display.
+
+4. Select a desired 'Tx fraction' using the large slider. Zero
+   percent means Rx only; 100% means Tx only.
+   
+5. Be sure that your computer clock is correct to +/- 1 s.
+   Many people like to use an automatic internet-based
+   clock-setting utility.
+
+6. WSPR will begin a Tx or Rx sequence at the start of each
+   even-numbered minute.  The waterfall will update and
+   decoding will take place at the end of each Rx sequence.
+   During reception, you can adjust the Rx noise level to get
+   something close to 0 dB.  Use the operating system's audio
+   mixer control or change your receiver's output level.
+&quot;&quot;&quot;
+    Label(about,text=t,justify=LEFT).pack(padx=20)
+    about.focus_set()
+
+#------------------------------------------------------ usersguide
+def usersguide(event=NONE):
+    url='<A HREF="http://physics.princeton.edu/pulsar/K1JT/WSPR_3.0_User.pdf">http://physics.princeton.edu/pulsar/K1JT/WSPR_3.0_User.pdf</A>'
+    thread.start_new_thread(browser,(url,))
+
+#------------------------------------------------------ fmtguide
+def fmtguide(event=NONE):
+    url='<A HREF="http://physics.princeton.edu/pulsar/K1JT/FMT_User.pdf">http://physics.princeton.edu/pulsar/K1JT/FMT_User.pdf</A>'
+    thread.start_new_thread(browser,(url,))
+
+#------------------------------------------------------ wsprnet
+def wsprnet(event=NONE):
+    url='<A HREF="http://wsprnet.org/">http://wsprnet.org/</A>'
+    thread.start_new_thread(browser,(url,))
+
+#------------------------------------------------------ homepage
+def homepage(event=NONE):
+    url='<A HREF="http://physics.princeton.edu/pulsar/K1JT/">http://physics.princeton.edu/pulsar/K1JT/</A>'
+    thread.start_new_thread(browser,(url,))
+
+#------------------------------------------------------- browser
+def browser(url):
+    webbrowser.open(url)
+
+#------------------------------------------------------ erase
+def erase(event=NONE):
+    global bandmap,bm
+    text.configure(state=NORMAL)
+    text.delete('1.0',END)
+    text.configure(state=DISABLED)
+    text1.configure(state=NORMAL)
+    text1.delete('1.0',END)
+    text1.configure(state=DISABLED)
+    bandmap=[]
+    bm={}
+
+#------------------------------------------------------ tune
+def tune(event=NONE):
+    idle.set(1)
+    w.acom1.ntune=1
+    btune.configure(bg='yellow')
+#    balloon.configure(state='none')
+
+#------------------------------------------------------ txnext
+def txnext(event=NONE):
+    if ipctx.get()&gt;0:
+        w.acom1.ntxnext=1
+        btxnext.configure(bg=&quot;green&quot;)
+
+###------------------------------------------------------ stoptx
+##def stoptx(event=NONE):
+##    w.acom1.nstoptx=1
+##    w.acom1.ntxnext=0
+
+#----------------------------------------------------- df_readout
+# Readout of graphical cursor location
+def df_readout(event):
+    global fmid
+    nhz=1000000*fmid + (80.0-event.y) * 12000/8192.0
+    nhz=int(nhz%1000)
+    t=&quot;%3d Hz&quot; % nhz
+    lab02.configure(text=t,bg='red')
+
+#----------------------------------------------------- set_tx_freq
+def set_tx_freq(event):
+    global fmid
+    nftx=int(1000000.0*fmid + (80.0-event.y) * 12000/8192.0)
+    fmhz=0.000001*nftx
+    t=&quot;Please confirm setting Tx frequency to &quot; + &quot;%.06f MHz&quot; % fmhz
+    result=tkMessageBox.askyesno(message=t)
+    if result:
+        ftx.set(0.000001*nftx)
+        sftx.set('%.06f' % ftx.get())
+
+#-------------------------------------------------------- draw_axis
+def draw_axis():
+    global fmid
+    c.delete(ALL)
+    df=12000.0/8192.0
+    nfmid=int(1.0e6*fmid + 0.5)%1000
+# Draw and label tick marks
+    for iy in range(-120,120,10):
+        j=80 - iy/df
+        i1=7
+        if (iy%50)==0:
+            i1=12
+            if (iy%100)==0: i1=15
+            n=nfmid+iy
+            if n&lt;0: n=n+1000
+            c.create_text(27,j,text=str(n))
+        c.create_line(0,j,i1,j,fill='black')
+    iy=1000000.0*(ftx.get()-f0.get()) - 1500
+    if abs(iy)&lt;=100:
+        j=80 - iy/df
+        c.create_line(0,j,13,j,fill='red',width=3)
+
+#------------------------------------------------------ del_all
+def del_all():
+    fname=appdir+'/ALL_WSPR.TXT'
+    try:
+        os.remove(fname)
+    except:
+        pass
+
+#------------------------------------------------------ delwav
+def delwav():
+    t=&quot;Are you sure you want to delete\nall *.WAV files in the Save directory?&quot;
+    result=tkMessageBox.askyesno(message=t)
+    if result:
+# Make a list of *.wav files in Save
+        la=dircache.listdir(appdir+'/save')
+        lb=[]
+        for i in range(len(la)):
+            j=la[i].find(&quot;.wav&quot;) + la[i].find(&quot;.WAV&quot;)
+            if j&gt;0: lb.append(la[i])
+# Now delete them all.
+        for i in range(len(lb)):
+            fname=appdir+'/save/'+lb[i]
+            os.remove(fname)
+
+#--------------------------------------------------- rx_volume
+def rx_volume():
+    for path in string.split(os.environ[&quot;PATH&quot;], os.pathsep):
+        file = os.path.join(path, &quot;sndvol32&quot;) + &quot;.exe&quot;
+        try:
+            return os.spawnv(os.P_NOWAIT, file, (file,) + (&quot; -r&quot;,))
+        except os.error:
+            pass
+    raise os.error, &quot;Cannot find &quot;+file
+
+#--------------------------------------------------- tx_volume
+def tx_volume():
+    for path in string.split(os.environ[&quot;PATH&quot;], os.pathsep):
+        file = os.path.join(path, &quot;sndvol32&quot;) + &quot;.exe&quot;
+        try:
+            return os.spawnv(os.P_NOWAIT, file, (file,))
+        except os.error:
+            pass
+    raise os.error, &quot;Cannot find &quot;+file
+
+#------------------------------------------------------ get_decoded
+def get_decoded():
+    global bandmap,bm,newdat,loopall
+    
+# Get lines from decoded.txt and parse each into an associative array
+    try:
+        f=open(appdir+'/decoded.txt',mode='r')
+        decodes = []
+        for line in f:
+            fields = line.split()
+            if len(fields) &lt; 10: continue
+            msg = fields[6:-3]
+            d = {}
+            d['date'] = fields[0]
+            d['time'] = fields[1]
+            d['sync'] = fields[2]
+            d['snr'] = fields[3]
+            d['dt'] = fields[4]
+            d['freq'] = fields[5]
+            d['msg'] = msg
+            d['drift'] = fields[-3]
+            d['cycles'] = fields[-2]
+            d['ii'] = fields[-1]
+
+# Determine message type
+            d['type1'] = True
+            d['type2'] = False
+            d['type3'] = False
+            if len(msg) != 3 or len(msg[1]) != 4 or len(msg[0]) &lt; 3 or \
+                len(msg[0]) &gt; 6 or not msg[2].isdigit():
+                d['type1'] = False
+            else:
+                dbm = int(msg[2])
+                if dbm &lt; 0 or dbm &gt; 60:
+                    d['type1'] = False
+                n=dbm%10
+                if n!=0 and n!=3 and n!=7:
+                    d['type1'] = False
+            if not d['type1']:
+                if len(msg)==2:
+                    d['type2']=True
+                else:
+                    d['type3']=True
+# Get callsign
+            callsign = d['msg'][0]
+            if callsign[0]=='&lt;':
+                n=callsign.find('&gt;')
+                callsign=callsign[1:n]
+            d['call'] = callsign
+            decodes.append(d)
+        f.close()
+    except:
+        decodes = []
+
+    if len(decodes) &gt; 0:
+#  Write data to text box; append freqs and calls to bandmap.
+        #text.configure(state=NORMAL)
+        nseq=0
+        nfmid=int(1.0e6*fmid)%1000
+        for d in decodes:
+            #text.insert(END, &quot;%4s %3s %4s %10s %2s %s\n&quot; % \
+            #    (d['time'],d['snr'],d['dt'],d['freq'],d['drift'],' '.join(d['msg'])))
+            print &quot;%4s %3s %4s %10s %2s %s\n&quot; % \
+                 (d['time'],d['snr'],d['dt'],d['freq'],d['drift'],' '.join(d['msg']))
+            try:
+                callsign=d['call']
+                tmin=60*int(d['time'][0:2]) + int(d['time'][2:4])
+                ndf=int(d['freq'][-3:])
+                bandmap.append((ndf,callsign,tmin))
+            except:
+                pass
+        #text.configure(state=DISABLED)
+        #text.see(END)
+
+# Erase the bm{} dictionary, then repopulate it from &quot;bandmap&quot;.
+# Most recent info for each callsign should be saved.
+    bm={}
+    iz=len(bandmap)
+    for i in range(iz):
+        bm[bandmap[i][1]]=(bandmap[i][0],bandmap[i][2])
+
+# Erase bandmap entirely
+    bandmap=[]
+# Repopulate &quot;bandmap&quot; from &quot;bm&quot;, which should not contain dupes.
+    for callsign,ft in bm.iteritems():
+        if callsign!='...':
+            ndf,tdecoded=ft
+            tmin=int((time.time()%86400)/60)
+            tdiff=tmin-tdecoded
+            if tdiff&lt;0: tdiff=tdiff+1440
+# Insert info in &quot;bandmap&quot; only if age is less than one hour
+            if w.acom1.ndiskdat==1: tdiff=2
+            if tdiff &lt; 60:                        #60 minutes 
+                bandmap.append((ndf,callsign,tdecoded))
+    
+# Once more, erase the bm{} dictionary, then repopulate it from &quot;bandmap&quot;
+    bm={}
+    iz=len(bandmap)
+    for i in range(iz):
+        bm[bandmap[i][1]]=(bandmap[i][0],bandmap[i][2])
+
+#  Sort bandmap in reverse frequency order, then display it
+    bandmap.sort()
+    bandmap.reverse()
+    #text1.configure(state=NORMAL)
+    #text1.delete('1.0',END)
+    for i in range(iz):
+        t=&quot;%4d&quot; % (bandmap[i][0],) + &quot; &quot; + bandmap[i][1]
+        nage=int((tmin - bandmap[i][2])/15)
+        if nage&lt;0: nage=nage+96
+        attr='age0'
+        if nage==1: attr='age1'
+        if nage==2: attr='age2'
+        if nage&gt;=3: attr='age3'
+        if w.acom1.ndiskdat==1: attr='age0'
+        #text1.insert(END,t+&quot;\n&quot;,attr)
+    #text1.configure(state=DISABLED)
+    #text1.see(END)
+
+    if upload.get():
+        #Dispatch autologger thread.
+        thread.start_new_thread(autolog, (decodes,))
+
+    if loopall: opennext()
+
+#------------------------------------------------------ autologger
+def autolog(decodes):
+    # Random delay of up to 20 seconds to spread load out on server --W1BW
+    time.sleep(random.random() * 20.0)
+    try:
+        # This code originally by W6CQZ ... modified by W1BW
+        # TODO:  Cache entries for later uploading if net is down.
+        # TODO:  (Maybe??) Allow for stations wishing to collect spot data but
+        #       only upload in batch form vs real-time.
+        # Any spots to upload?
+        if len(decodes) &gt; 0:
+            for d in decodes:
+                # now to format as a string to use for autologger upload using urlencode
+                # so we get a string formatted for http get/put operations:
+                m=d['msg']
+                tcall=m[0]
+                if d['type2']:
+                    tgrid=''
+                    dbm=m[1]
+                else:
+                    tgrid=m[1]
+                    dbm=m[2]
+                if tcall[0]=='&lt;':
+                    n=tcall.find('&gt;')
+                    tcall=tcall[1:n]
+                if tcall=='...': continue
+                dfreq=float(d['freq'])-w.acom1.f0b-0.001500
+                if abs(dfreq)&gt;0.0001:
+                    print 'Frequency changed, no upload of spots'
+                    continue
+                reportparams = urllib.urlencode({'function': 'wspr',
+                                                 'rcall': options.MyCall.get(),
+                                                 'rgrid': options.MyGrid.get(),
+                                                 'rqrg': str(f0.get()),
+                                                 'date': d['date'],
+                                                 'time': d['time'],
+                                                 'sig': d['snr'],
+                                                 'dt': d['dt'],
+                                                 'tqrg': d['freq'],
+                                                 'drift': d['drift'],
+                                                 'tcall': tcall,
+                                                 'tgrid': tgrid,
+                                                 'dbm': dbm,
+                                                 'version': Version})
+                # reportparams now contains a properly formed http request string for
+                # the agreed upon format between W6CQZ and N8FQ.
+                # any other data collection point can be added as desired if it conforms
+                # to the 'standard format' defined above.
+                # The following opens a url and passes the reception report to the database
+                # insertion handler for W6CQZ:
+                #                urlf = urllib.urlopen(&quot;<A HREF="http://jt65.w6cqz.org/rbc.php?%s">http://jt65.w6cqz.org/rbc.php?%s</A>&quot; % reportparams)
+                # The following opens a url and passes the reception report to the
+                # database insertion handler from W1BW:
+                urlf = urllib.urlopen(&quot;<A HREF="http://wsprnet.org/post?%s">http://wsprnet.org/post?%s</A>&quot; \
+                                  % reportparams)
+                reply = urlf.readlines()
+                urlf.close()
+        else:
+            # No spots to report, so upload status message instead. --W1BW
+            reportparams = urllib.urlencode({'function': 'wsprstat',
+                                             'rcall': options.MyCall.get(),
+                                             'rgrid': options.MyGrid.get(),
+                                             'rqrg': str(fmid),
+                                             'tpct': str(ipctx.get()), 
+                                             'tqrg': sftx.get(),
+                                             'dbm': str(options.dBm.get()),
+                                             'version': Version})
+            urlf = urllib.urlopen(&quot;<A HREF="http://wsprnet.org/post?%s">http://wsprnet.org/post?%s</A>&quot; \
+                                  % reportparams)
+            reply = urlf.readlines()
+            urlf.close()
+    except:
+        t=&quot; UTC: attempted access to WSPRnet failed.&quot;
+        if not no_beep.get(): t=t + &quot;\a&quot;
+        print time.asctime(time.gmtime()) + t
+
+#------------------------------------------------------ put_params
+def put_params(param3=NONE):
+    global param20
+
+##    try:
+##        w.acom1.f0=f0.get()
+##        w.acom1.ftx=ftx.get()
+##    except:
+##        pass
+    w.acom1.callsign=(options.MyCall.get().strip().upper()+'            ')[:12]
+    w.acom1.grid=(options.MyGrid.get().strip().upper()+'    ')[:4]
+    w.acom1.grid6=(options.MyGrid.get().strip().upper()+'      ')[:6]
+    w.acom1.ctxmsg=(txmsg.get().strip().upper()+'                      ')[:22]
+
+    # numeric port ==&gt; COM%d, else string of device.  --W1BW
+    port = options.PttPort.get()
+    if port=='None': port='0'
+    if port[:3]=='COM': port=port[3:]
+    if port.isdigit():
+        w.acom1.nport = int(port)
+        port = &quot;COM%d&quot; % (int(port))
+    else:
+        w.acom1.nport = 0
+    w.acom1.pttport = (port + 80*' ')[:80]
+
+    try:
+        dbm=int(options.dBm.get())
+    except:
+        dbm=37
+    i1=options.MyCall.get().find('/')
+    if dbm&lt;0 and (i1&gt;0 or advanced.igrid6.get()):
+        MsgBox(&quot;Negative dBm values are permitted\n only for Type 1 messages.&quot;)
+        dbm=0
+        options.dBm.set(0)
+    mindiff=9999
+    for i in range(len(pwrlist)):
+        if abs(dbm-pwrlist[i])&lt;mindiff:
+            mindiff=abs(dbm-pwrlist[i])
+            ibest=i
+    dbm=pwrlist[ibest]
+    options.dBm.set(dbm)
+    w.acom1.ndbm=dbm
+        
+    w.acom1.ntxfirst=ntxfirst.get()
+    w.acom1.nsave=nsave.get()
+    try:
+        w.acom1.nbfo=advanced.bfofreq.get()
+    except:
+        w.acom1.nbfo=1500
+    try:
+        w.acom1.idint=advanced.idint.get()
+    except:
+        w.acom1.idint=0
+    w.acom1.igrid6=advanced.igrid6.get()
+    w.acom1.iqmode=iq.iqmode.get()
+    w.acom1.iqrx=iq.iqrx.get()
+    w.acom1.iqrxapp=iq.iqrxapp.get()
+    w.acom1.iqrxadj=iq.iqrxadj.get()
+    w.acom1.iqtx=iq.iqtx.get()
+    w.acom1.ntxdb=advanced.isc1.get()
+    bal=iq.isc2.get() + 0.02*iq.isc2a.get()
+    w.acom1.txbal=bal
+    pha=iq.isc3.get() + 0.02*iq.isc3a.get()
+    w.acom1.txpha=pha
+    try:
+        w.acom1.nfiq=iq.fiq.get()
+    except:
+        w.acom1.nfiq=0
+    w.acom1.ndevin=g.ndevin.get()
+    w.acom1.ndevout=g.ndevout.get()
+    w.acom1.nbaud=options.serial_rate.get()
+    w.acom1.ndatabits=options.databits.get()
+    w.acom1.nstopbits=options.stopbits.get()
+    w.acom1.chs=(options.serial_handshake.get() + \
+                 '                                        ')[:40]
+    w.acom1.catport=(options.CatPort.get()+'            ')[:12]
+    try:
+        w.acom1.nrig=options.rignum.get()
+    except:
+        pass
+
+#------------------------------------------------------ update
+def update():
+    global root_geom,isec0,im,pim,ndbm0,nsec0,a,ftx0,nin0,nout0, \
+        receiving,transmitting,newdat,nscroll,newspec,scale0,offset0, \
+        modpixmap0,tw,s0,c0,fmid,fmid0,loopall,ntr0,txmsg,iband0, \
+        bandmap,bm,t0,nreject,gain,phdeg,ierr,itx0,timer1
+
+    tsec=time.time()
+    utc=time.gmtime(tsec)
+    nsec=int(tsec)
+    nsec0=nsec
+    ns120=nsec % 120
+
+    if hopping.hoppingconfigured.get()==1:
+      bhopping.configure(state=NORMAL)
+    else:
+      bhopping.configure(state=DISABLED)
+
+    hopped=0
+    if not idle.get():
+        if hopping.hopping.get()==1:
+            w.acom1.nfhopping=1        
+            
+            if w.acom1.nfhopok:
+                w.acom1.nfhopok=0
+                b=-1
+                if hopping.coord_bands.get()==1:
+                    ns=nsec % 86400
+                    ns1=ns % (10*120)
+                    b=ns1/120 + 3
+                    if b==12: b=2
+                    if hopping.hoppingflag[b].get()==0: b=-1
+                if b&lt;0:                
+                    found=False
+                    while not found:
+                        b = random.randint(1,len(hopping.bandlabels)-1)
+                        if hopping.hoppingflag[b].get()!=0:
+                            found=True
+                ipctx.set(hopping.hoppingpctx[b].get())
+                if b!=iband.get(): hopped=1
+                iband.set(b)
+
+        else:
+            w.acom1.nfhopping=0
+            ns=nsec % 86400
+            ns1=ns % (10*120)
+            b=ns1/120 + 3
+            if b==12: b=2
+            if iband.get()==b and random.randint(1,2)==1 and ipctx.get()&gt;0:
+                w.acom1.ntxnext=1
+
+    try:
+        f0.set(float(sf0.get()))
+        ftx.set(float(sftx.get()))
+    except:
+        pass
+    isec=utc[5]
+    twait=120.0 - (tsec % 120.0)
+
+    if iband.get()!=iband0 or advanced.fset.get():
+        advanced.fset.set(0)
+        f0.set(freq0[iband.get()])
+        t=&quot;%.6f&quot; % (f0.get(),)
+        sf0.set(t)
+        ftx.set(freqtx[iband.get()])
+        t=&quot;%.6f&quot; % (ftx.get(),)
+        sftx.set(t)
+        if options.cat_enable.get():
+            if advanced.encal.get():
+                nHz=int(advanced.Acal.get() + \
+                    f0.get()*(1000000.0 + advanced.Bcal.get()) + 0.5)
+            else:
+                nHz=int(1000000.0*f0.get() + 0.5)
+            if options.rignum.get()==2509 or options.rignum.get()==2511:
+                nHzLO=nHz - iq.fiq.get()
+                cmd=&quot;rigctl -m %d -r %s F %d&quot; % \
+                     (options.rignum.get(),options.CatPort.get(),nHzLO)
+            else:
+                cmd=&quot;rigctl -m %d -r %s -s %d -C data_bits=%s -C stop_bits=%s -C serial_handshake=%s F %d&quot; % \
+                     (options.rignum.get(),options.CatPort.get(), \
+                      options.serial_rate.get(),options.databits.get(), \
+                      options.stopbits.get(),options.serial_handshake.get(), nHz)
+            ierr=os.system(cmd)
+            if ierr==0:
+                ierr2=0
+                bandmap=[]
+                bm={}
+                text1.configure(state=NORMAL)
+                text1.delete('1.0',END)
+                text1.configure(state=DISABLED)
+                iband0=iband.get()
+                f=open(appdir+'/fmt.ini',mode='w')
+                f.write(cmd+'\n')
+                f.write(str(g.ndevin.get())+'\n')
+                f.close()
+
+                cmd2=''
+                if os.path.exists('.\user_hardware.bat') or \
+                   os.path.exists('.\user_hardware.cmd') or \
+                   os.path.exists('.\user_hardware.exe'):
+                    cmd2='.\user_hardware ' + str(band[iband0])
+                elif os.path.exists('./user_hardware'):
+                    cmd2='./user_hardware ' + str(band[iband0])
+                if cmd2!='':
+                    try:
+                        ierr2=os.system(cmd2)
+                    except:
+                        ierr2=-1
+                    if ierr2!=0:
+                        print 'Execution of &quot;'+cmd2+'&quot; failed.'
+                        MsgBox('Execution of &quot;'+cmd2+'&quot; failed.\nEntering Idle mode.')
+            else:
+                print 'Error attempting to set rig frequency.\a'
+                print cmd + '\a'
+                iband.set(iband0)
+                f0.set(freq0[iband.get()])
+                t=&quot;%.6f&quot; % (f0.get(),)
+                sf0.set(t)
+                ftx.set(freqtx[iband.get()])
+                t=&quot;%.6f&quot; % (ftx.get(),)
+                sftx.set(t)
+##            if ierr==0 and ierr2==0 and w.acom1.nfhopping==1 and hopped==1:
+            if ierr==0 and ierr2==0 and w.acom1.nfhopping==1 and hopped==1 \
+                   and hopping.tuneupflag[iband.get()].get(): w.acom1.ntune=-3
+        else:
+            iband0=iband.get()
+        iq.ib.set(iband.get())
+        iq.newband()
+
+    freq0[iband.get()]=f0.get()
+    freqtx[iband.get()]=ftx.get()
+    w.acom1.iband=iband.get()
+    try:
+        w.acom1.f0=f0.get()
+        w.acom1.ftx=ftx.get()
+    except:
+        pass
+
+    if isec != isec0:                           #Do once per second
+        isec0=isec
+        t=time.strftime('%Y %b %d\n%H:%M:%S',utc)
+        ldate.configure(text=t)
+        root_geom=root.geometry()
+        utchours=utc[3]+utc[4]/60.0 + utc[5]/3600.0
+        try:
+            if options.dBm.get()!=ndbm0:
+                ndbm0=options.dBm.get()
+                options.dbm_balloon()
+        except:
+            pass
+        put_params()
+        nndf=int(1000000.0*(ftx.get()-f0.get()) + 0.5) - 1500
+        gain=w.acom1.gain
+        phdeg=57.2957795*w.acom1.phase
+        nreject=int(w.acom1.reject)
+        t='Bal: %6.4f  Pha: %6.1f      &gt;%3d dB' % (gain,phdeg,nreject)
+        iq.lab1.configure(text=t)
+        ndb=int(w.acom1.xdb1-41.0)
+        if ndb&lt;-30: ndb=-30
+        dbave=w.acom1.xdb1
+        if iq.iqmode.get():
+            ndb2=int(w.acom1.xdb2-41.0)
+            if ndb2&lt;-30: ndb2=-30
+            dbave=0.5*(w.acom1.xdb1 + w.acom1.xdb2)
+            t='Rx Noise: %3d %3d  dB' % (ndb,ndb2)
+        else:
+            t='Rx Noise: %3d  dB' % (ndb,)
+        bg='gray85'
+        r=SUNKEN
+        smcolor=&quot;green&quot;
+        if w.acom1.receiving:
+            if ndb&gt;10 and ndb&lt;=20:
+                bg='yellow'
+                smcolor='yellow'
+            elif ndb&lt;-20 or ndb&gt;20:
+                bg='red'
+                smcolor='red'
+        else:
+            t=''
+            r=FLAT
+        msg1.configure(text=t,bg=bg,relief=r)
+        if not receiving: dbave=0
+        sm.updateProgress(newValue=dbave,newColor=smcolor)
+
+# If T/R status has changed, get new info
+    ntr=int(w.acom1.ntr)
+    itx=w.acom1.transmitting
+    if ntr!=ntr0 or itx!=itx0:
+        ntr0=ntr
+        itx0=int(itx)
+        if ntr==-1 or itx==1:
+            transmitting=1
+            receiving=0
+        elif ntr==0:
+            transmitting=0
+            receiving=0
+        else:
+            transmitting=0
+            receiving=1
+            n=len(tw)
+            if n&gt;12: tw=tw[:n-1]
+            rxtime=g.ftnstr(w.acom1.rxtime)
+            rxtime=rxtime[:2] + ':' + rxtime[2:]
+            tw=[rxtime,] + tw
+ 
+            global fw
+            if n&gt;12: fw=fw[:n-1]
+            fw=[hopping.bandlabels[ iband.get()][:-2],] + fw
+        if receiving:
+            filemenu.entryconfig(0,state=DISABLED)
+            filemenu.entryconfig(1,state=DISABLED)
+            filemenu.entryconfig(2,state=DISABLED)
+        else:
+            filemenu.entryconfig(0,state=NORMAL)
+            filemenu.entryconfig(1,state=NORMAL)
+            filemenu.entryconfig(2,state=NORMAL)
+        if transmitting:
+            btxnext.configure(bg=&quot;gray85&quot;)
+            for i in range(15):
+                bandmenu.entryconfig(i,state=DISABLED)
+        else:
+            for i in range(15):
+                bandmenu.entryconfig(i,state=NORMAL)
+        
+    bgcolor='gray85'
+    t='Waiting to start'
+    bgcolor='pink'
+    if transmitting:
+        t='Txing: '+g.ftnstr(w.acom1.sending)
+        bgcolor='yellow'
+    if receiving:
+        t='Receiving'
+        bgcolor='green'
+    if t!=t0:
+        msg6.configure(text=t,bg=bgcolor)
+        t0=t
+    if w.acom1.ntune==0:
+        btune.configure(bg='gray85')
+        pctscale.configure(state=NORMAL)
+    else:
+        pctscale.configure(state=DISABLED)
+    if w.acom1.ncal==0:
+        advanced.bmeas.configure(bg='gray85')
+    else:
+        idle.set(1)
+    if ierr==0:
+      w.acom1.pctx=ipctx.get()
+    else:
+      w.acom1.pctx=0
+    w.acom1.idle=idle.get()
+    if idle.get()==0:
+        bidle.configure(bg='gray85')
+    else:
+        bidle.configure(bg='yellow')
+    if w.acom1.transmitting or w.acom1.receiving or options.outbad.get():
+        btune.configure(state=DISABLED)
+    else:
+        btune.configure(state=NORMAL)
+    if w.acom1.transmitting or w.acom1.receiving or twait &lt; 6.0:
+        advanced.bmeas.configure(state=DISABLED)
+    else:
+        advanced.bmeas.configure(state=NORMAL)
+
+    if upload.get()==1:
+        bupload.configure(bg='gray85')
+    else:
+        bupload.configure(bg='yellow')
+
+# If new decoded text has appeared, display it.
+    if w.acom1.ndecdone:
+        get_decoded()
+        w.acom1.ndecdone=0
+        w.acom1.ndiskdat=0
+
+# Display the waterfall
+    try:
+        modpixmap=os.stat('pixmap.dat')[8]
+        if modpixmap!=modpixmap0:
+            f=open('pixmap.dat','rb')
+            a=array.array('h')
+            a.fromfile(f,NX*NY)
+            f.close()
+            newdat=1
+            modpixmap0=modpixmap
+    except:
+        newdat=0
+    scale=math.pow(10.0,0.003*sc1.get())
+    offset=0.3*sc2.get()
+    if newdat or scale!= scale0 or offset!=offset0 or g.cmap!=g.cmap0:
+        im.putdata(a,scale,offset)              #Compute whole new image
+        if newdat:
+            n=len(tw)
+            for i in range(n-1,-1,-1):
+                x=465-39*i
+                draw.text((x,148),tw[i],fill=253)        #Insert time label
+                if i&lt;len(fw):
+                    draw.text((x+10,1),fw[i],fill=253)   #Insert band label
+                               
+        pim=ImageTk.PhotoImage(im)              #Convert Image to PhotoImage
+        graph1.delete(ALL)
+        graph1.create_image(0,0+2,anchor='nw',image=pim)
+        g.ndecphase=2
+        newMinute=0
+        scale0=scale
+        offset0=offset
+        g.cmap0=g.cmap
+        newdat=0
+
+    s0=sc1.get()
+    c0=sc2.get()
+    try:
+        fmid=f0.get() + 0.001500
+    except:
+        pass
+
+    if fmid!=fmid0 or ftx.get()!=ftx0:
+        draw_axis()
+        lftx.configure(validate={'validator':'real',
+            'min':f0.get()+0.001500-0.000100,'minstrict':0,
+            'max':f0.get()+0.001500+0.000100,'maxstrict':0})
+    w.acom1.ndebug=ndebug.get()
+
+    if options.rignum.get()==2509 or options.rignum.get()==2511:
+        options.pttmode.set('CAT')
+        options.CatPort.set('USB')
+    if options.pttmode.get()=='CAT':
+        options.cat_enable.set(1)
+    if options.pttmode.get()=='CAT' or options.pttmode.get()=='VOX':
+        options.PttPort.set('None')
+        options.ptt_port._entryWidget['state']=DISABLED
+    else:
+        options.ptt_port._entryWidget['state']=NORMAL
+    if options.cat_enable.get():
+        options.lrignum._entryWidget['state']=NORMAL
+        if options.cat_port.get() != 'USB':
+            options.cat_port._entryWidget['state']=NORMAL
+            options.cbbaud._entryWidget['state']=NORMAL
+            options.cbdata._entryWidget['state']=NORMAL
+            options.cbstop._entryWidget['state']=NORMAL
+            options.cbhs._entryWidget['state']=NORMAL
+        else:
+            options.cat_port._entryWidget['state']=DISABLED
+            options.cbbaud._entryWidget['state']=DISABLED
+            options.cbdata._entryWidget['state']=DISABLED
+            options.cbstop._entryWidget['state']=DISABLED
+            options.cbhs._entryWidget['state']=DISABLED
+        advanced.bsetfreq.configure(state=NORMAL)
+        advanced.breadab.configure(state=NORMAL)
+        advanced.enable_cal.configure(state=NORMAL)
+    else:
+        options.cat_port._entryWidget['state']=DISABLED
+        options.lrignum._entryWidget['state']=DISABLED
+        options.cbbaud._entryWidget['state']=DISABLED
+        options.cbdata._entryWidget['state']=DISABLED
+        options.cbstop._entryWidget['state']=DISABLED
+        options.cbhs._entryWidget['state']=DISABLED
+        advanced.bsetfreq.configure(state=DISABLED)
+        advanced.breadab.configure(state=DISABLED)
+        advanced.enable_cal.configure(state=DISABLED)
+        advanced.encal.set(0)
+    w.acom1.pttmode=(options.pttmode.get().strip()+'   ')[:3]
+    w.acom1.ncat=options.cat_enable.get()
+    w.acom1.ncoord=hopping.coord_bands.get()
+
+    if g.ndevin.get()!= nin0 or g.ndevout.get()!=nout0:
+        audio_config()
+        nin0=g.ndevin.get()
+        nout0=g.ndevout.get()
+    if options.inbad.get()==0:
+        msg2.configure(text='',bg='gray85')
+    else:
+        msg2.configure(text='Invalid audio input device.',bg='red')
+    if options.outbad.get()==0:
+        msg3.configure(text='',bg='gray85')
+    else:
+        msg3.configure(text='Invalid audio output device.',bg='red')
+    if w.acom1.ndecoding:
+        msg5.configure(text='Decoding',bg='#66FFFF',relief=SUNKEN)
+    else:
+        msg5.configure(text='',bg='gray85',relief=FLAT)
+
+    if advanced.encal.get():
+        advanced.A_entry.configure(entry_state=NORMAL,label_state=NORMAL)
+        advanced.B_entry.configure(entry_state=NORMAL,label_state=NORMAL)
+    else:
+        advanced.A_entry.configure(entry_state=DISABLED,label_state=DISABLED)
+        advanced.B_entry.configure(entry_state=DISABLED,label_state=DISABLED)
+  
+    timer1=ldate.after(200,update)
+   
+#------------------------------------------------------ update
+def update_nogui():
+  global root_geom,isec0,im,pim,ndbm0,nsec0,a,ftx0,nin0,nout0, \
+        receiving,transmitting,newdat,nscroll,newspec,scale0,offset0, \
+        modpixmap0,tw,s0,c0,fmid,fmid0,loopall,ntr0,txmsg,iband0, \
+        bandmap,bm,t0,nreject,gain,phdeg,ierr,itx0,timer1
+  while True:
+
+    #if hopping.hoppingconfigured.get()==1:
+    #  bhopping.configure(state=NORMAL)
+    #else:
+    #  bhopping.configure(state=DISABLED)
+
+    tsec=time.time()
+    utc=time.gmtime(tsec)
+    nsec=int(tsec)
+    nsec0=nsec
+    ns120=nsec % 120
+
+    hopped=0
+    if not idle.get():
+        if hopping.hopping.get()==1:
+            w.acom1.nfhopping=1        
+            
+            if w.acom1.nfhopok:
+                w.acom1.nfhopok=0
+                b=-1
+                if hopping.coord_bands.get()==1:
+                    ns=nsec % 86400
+                    ns1=ns % (10*120)
+                    b=ns1/120 + 3
+                    if b==12: b=2
+                    if hopping.hoppingflag[b].get()==0: b=-1
+                if b&lt;0:                
+                    found=False
+                    while not found:
+                        b = random.randint(1,len(hopping.bandlabels)-1)
+                        if hopping.hoppingflag[b].get()!=0:
+                            found=True
+                ipctx.set(hopping.hoppingpctx[b].get())
+                if b!=iband.get(): hopped=1
+                iband.set(b)
+
+        else:
+            w.acom1.nfhopping=0
+            ns=nsec % 86400
+            ns1=ns % (10*120)
+            b=ns1/120 + 3
+            if b==12: b=2
+            if iband.get()==b and random.randint(1,2)==1 and ipctx.get()&gt;0:
+                w.acom1.ntxnext=1
+
+    try:
+        f0.set(float(sf0.get()))
+        ftx.set(float(sftx.get()))
+    except:
+        pass
+    isec=utc[5]
+    twait=120.0 - (tsec % 120.0)
+
+    if iband.get()!=iband0 or advanced.fset.get():
+        advanced.fset.set(0)
+        f0.set(freq0[iband.get()])
+        t=&quot;%.6f&quot; % (f0.get(),)
+        sf0.set(t)
+        ftx.set(freqtx[iband.get()])
+        t=&quot;%.6f&quot; % (ftx.get(),)
+        sftx.set(t)
+        if options.cat_enable.get():
+            if advanced.encal.get():
+                nHz=int(advanced.Acal.get() + \
+                    f0.get()*(1000000.0 + advanced.Bcal.get()) + 0.5)
+            else:
+                nHz=int(1000000.0*f0.get() + 0.5)
+            if options.rignum.get()==2509 or options.rignum.get()==2511:
+                nHzLO=nHz - iq.fiq.get()
+                cmd=&quot;rigctl -m %d -r %s F %d&quot; % \
+                     (options.rignum.get(),options.CatPort.get(),nHzLO)
+            else:
+                cmd=&quot;rigctl -m %d -r %s -s %d -C data_bits=%s -C stop_bits=%s -C serial_handshake=%s F %d&quot; % \
+                     (options.rignum.get(),options.CatPort.get(), \
+                      options.serial_rate.get(),options.databits.get(), \
+                      options.stopbits.get(),options.serial_handshake.get(), nHz)
+            ierr=os.system(cmd)
+            if ierr==0:
+                ierr2=0
+                bandmap=[]
+                bm={}
+                #text1.configure(state=NORMAL)
+                #text1.delete('1.0',END)
+                #text1.configure(state=DISABLED)
+                iband0=iband.get()
+                f=open(appdir+'/fmt.ini',mode='w')
+                f.write(cmd+'\n')
+                f.write(str(g.ndevin.get())+'\n')
+                f.close()
+
+                cmd2=''
+                if os.path.exists('.\user_hardware.bat') or \
+                   os.path.exists('.\user_hardware.cmd') or \
+                   os.path.exists('.\user_hardware.exe'):
+                    cmd2='.\user_hardware ' + str(band[iband0])
+                elif os.path.exists('./user_hardware'):
+                    cmd2='./user_hardware ' + str(band[iband0])
+                if cmd2!='':
+                    try:
+                        ierr2=os.system(cmd2)
+                    except:
+                        ierr2=-1
+                    if ierr2!=0:
+                        print 'Execution of &quot;'+cmd2+'&quot; failed.'
+                        MsgBox('Execution of &quot;'+cmd2+'&quot; failed.\nEntering Idle mode.')
+            else:
+                print 'Error attempting to set rig frequency.\a'
+                print cmd + '\a'
+                iband.set(iband0)
+                f0.set(freq0[iband.get()])
+                t=&quot;%.6f&quot; % (f0.get(),)
+                sf0.set(t)
+                ftx.set(freqtx[iband.get()])
+                t=&quot;%.6f&quot; % (ftx.get(),)
+                sftx.set(t)
+##            if ierr==0 and ierr2==0 and w.acom1.nfhopping==1 and hopped==1:
+            if ierr==0 and ierr2==0 and w.acom1.nfhopping==1 and hopped==1 \
+                   and hopping.tuneupflag[iband.get()].get(): w.acom1.ntune=-3
+        else:
+            iband0=iband.get()
+        iq.ib.set(iband.get())
+        iq.newband()
+
+    freq0[iband.get()]=f0.get()
+    freqtx[iband.get()]=ftx.get()
+    w.acom1.iband=iband.get()
+    try:
+        w.acom1.f0=f0.get()
+        w.acom1.ftx=ftx.get()
+    except:
+        pass
+
+    if isec != isec0:                           #Do once per second
+        isec0=isec
+        t=time.strftime('%Y %b %d\n%H:%M:%S',utc)
+        #ldate.configure(text=t)
+        print t
+        #root_geom=root.geometry()
+        utchours=utc[3]+utc[4]/60.0 + utc[5]/3600.0
+        try:
+            if options.dBm.get()!=ndbm0:
+                ndbm0=options.dBm.get()
+                options.dbm_balloon()
+        except:
+            pass
+        put_params()
+        nndf=int(1000000.0*(ftx.get()-f0.get()) + 0.5) - 1500
+        gain=w.acom1.gain
+        phdeg=57.2957795*w.acom1.phase
+        nreject=int(w.acom1.reject)
+        t='Bal: %6.4f  Pha: %6.1f      &gt;%3d dB' % (gain,phdeg,nreject)
+        #iq.lab1.configure(text=t)
+        #print t
+        ndb=int(w.acom1.xdb1-41.0)
+        if ndb&lt;-30: ndb=-30
+        dbave=w.acom1.xdb1
+        if iq.iqmode.get():
+            ndb2=int(w.acom1.xdb2-41.0)
+            if ndb2&lt;-30: ndb2=-30
+            dbave=0.5*(w.acom1.xdb1 + w.acom1.xdb2)
+            t='Rx Noise: %3d %3d  dB' % (ndb,ndb2)
+        else:
+            t='Rx Noise: %3d  dB' % (ndb,)
+        bg='gray85'
+        #r=SUNKEN
+        #smcolor=&quot;green&quot;
+        #if w.acom1.receiving:
+        #    if ndb&gt;10 and ndb&lt;=20:
+        #        bg='yellow'
+        #        smcolor='yellow'
+        #        bg='red'
+        #        smcolor='red'
+        #else:
+        #    t=''
+        #    r=FLAT
+        #msg1.configure(text=t,bg=bg,relief=r)
+        print t
+        if not receiving: dbave=0
+        #sm.updateProgress(newValue=dbave,newColor=smcolor)
+
+# If T/R status has changed, get new info
+    ntr=int(w.acom1.ntr)
+    itx=w.acom1.transmitting
+    if ntr!=ntr0 or itx!=itx0:
+        ntr0=ntr
+        itx0=int(itx)
+        if ntr==-1 or itx==1:
+            transmitting=1
+            receiving=0
+        elif ntr==0:
+            transmitting=0
+            receiving=0
+        else:
+            transmitting=0
+            receiving=1
+            n=len(tw)
+            if n&gt;12: tw=tw[:n-1]
+            rxtime=g.ftnstr(w.acom1.rxtime)
+            rxtime=rxtime[:2] + ':' + rxtime[2:]
+            tw=[rxtime,] + tw
+ 
+            global fw
+            if n&gt;12: fw=fw[:n-1]
+            fw=[hopping.bandlabels[ iband.get()][:-2],] + fw
+        #if receiving:
+            #filemenu.entryconfig(0,state=DISABLED)
+            #filemenu.entryconfig(1,state=DISABLED)
+            #filemenu.entryconfig(2,state=DISABLED)
+        #else:
+            #filemenu.entryconfig(0,state=NORMAL)
+            #filemenu.entryconfig(1,state=NORMAL)
+            #filemenu.entryconfig(2,state=NORMAL)
+        #if transmitting:
+            #btxnext.configure(bg=&quot;gray85&quot;)
+            #for i in range(15):
+            #    bandmenu.entryconfig(i,state=DISABLED)
+        #else:
+            #for i in range(15):
+            #    bandmenu.entryconfig(i,state=NORMAL)
+        
+    bgcolor='gray85'
+    t='Waiting to start'
+    bgcolor='pink'
+    if transmitting:
+        t='Txing: '+g.ftnstr(w.acom1.sending)
+        bgcolor='yellow'
+    if receiving:
+        t='Receiving'
+        bgcolor='green'
+    if t!=t0:
+        #msg6.configure(text=t,bg=bgcolor)
+        print t
+        t0=t
+    #if w.acom1.ntune==0:
+        #btune.configure(bg='gray85')
+        #pctscale.configure(state=NORMAL)
+    #else:
+    #    pctscale.configure(state=DISABLED)
+    if w.acom1.ncal==0:
+        #advanced.bmeas.configure(bg='gray85')
+        None
+    else:
+        idle.set(1)
+    if ierr==0:
+      w.acom1.pctx=ipctx.get()
+    else:
+      w.acom1.pctx=0
+    w.acom1.idle=idle.get()
+    #if idle.get()==0:
+    #    bidle.configure(bg='gray85')
+    #else:
+    #    bidle.configure(bg='yellow')
+    #if w.acom1.transmitting or w.acom1.receiving or options.outbad.get():
+    #    btune.configure(state=DISABLED)
+    #else:
+    #    btune.configure(state=NORMAL)
+    #if w.acom1.transmitting or w.acom1.receiving or twait &lt; 6.0:
+    #    advanced.bmeas.configure(state=DISABLED)
+    #else:
+    #    advanced.bmeas.configure(state=NORMAL)
+
+    #if upload.get()==1:
+    #    bupload.configure(bg='gray85')
+    #else:
+    #    bupload.configure(bg='yellow')
+
+# If new decoded text has appeared, display it.
+    if w.acom1.ndecdone:
+        get_decoded()
+        w.acom1.ndecdone=0
+        w.acom1.ndiskdat=0
+
+# Display the waterfall
+    try:
+        modpixmap=os.stat('pixmap.dat')[8]
+        if modpixmap!=modpixmap0:
+            f=open('pixmap.dat','rb')
+            a=array.array('h')
+            a.fromfile(f,NX*NY)
+            f.close()
+            newdat=1
+            modpixmap0=modpixmap
+    except:
+        newdat=0
+    #scale=math.pow(10.0,0.003*sc1.get())
+    #offset=0.3*sc2.get()
+    #if newdat or scale!= scale0 or offset!=offset0 or g.cmap!=g.cmap0:
+    #    im.putdata(a,scale,offset)              #Compute whole new image
+    #    if newdat:
+    #        n=len(tw)
+    #        for i in range(n-1,-1,-1):
+    #            x=465-39*i
+    #            draw.text((x,148),tw[i],fill=253)        #Insert time label
+    #            if i&lt;len(fw):
+    #                draw.text((x+10,1),fw[i],fill=253)   #Insert band label
+    #                           
+    #    pim=ImageTk.PhotoImage(im)              #Convert Image to PhotoImage
+    #    graph1.delete(ALL)
+    #    graph1.create_image(0,0+2,anchor='nw',image=pim)
+    #    g.ndecphase=2
+    #    newMinute=0
+    #    scale0=scale
+    #    offset0=offset
+    #    g.cmap0=g.cmap
+    #    newdat=0
+
+    #s0=sc1.get()
+    #c0=sc2.get()
+    #try:
+    #    fmid=f0.get() + 0.001500
+    #except:
+    #    pass
+
+    #if fmid!=fmid0 or ftx.get()!=ftx0:
+    #    draw_axis()
+    #    lftx.configure(validate={'validator':'real',
+    #        'min':f0.get()+0.001500-0.000100,'minstrict':0,
+    #        'max':f0.get()+0.001500+0.000100,'maxstrict':0})
+    w.acom1.ndebug=ndebug.get()
+
+    if options.rignum.get()==2509 or options.rignum.get()==2511:
+        options.pttmode.set('CAT')
+        options.CatPort.set('USB')
+    if options.pttmode.get()=='CAT':
+        options.cat_enable.set(1)
+    #if options.pttmode.get()=='CAT' or options.pttmode.get()=='VOX':
+    #    options.PttPort.set('None')
+    #    options.ptt_port._entryWidget['state']=DISABLED
+    #else:
+    #    options.ptt_port._entryWidget['state']=NORMAL
+    #if options.cat_enable.get():
+    #    options.lrignum._entryWidget['state']=NORMAL
+    #    if options.cat_port.get() != 'USB':
+    #        options.cat_port._entryWidget['state']=NORMAL
+    #        options.cbbaud._entryWidget['state']=NORMAL
+    #        options.cbdata._entryWidget['state']=NORMAL
+    #        options.cbstop._entryWidget['state']=NORMAL
+    #        options.cbhs._entryWidget['state']=NORMAL
+    #    else:
+    #        options.cat_port._entryWidget['state']=DISABLED
+    #        options.cbbaud._entryWidget['state']=DISABLED
+    #        options.cbdata._entryWidget['state']=DISABLED
+    #        options.cbstop._entryWidget['state']=DISABLED
+    #        options.cbhs._entryWidget['state']=DISABLED
+    #    advanced.bsetfreq.configure(state=NORMAL)
+    #    advanced.breadab.configure(state=NORMAL)
+    #    advanced.enable_cal.configure(state=NORMAL)
+    #else:
+    #    options.cat_port._entryWidget['state']=DISABLED
+    #    options.lrignum._entryWidget['state']=DISABLED
+    #    options.cbbaud._entryWidget['state']=DISABLED
+    #    options.cbdata._entryWidget['state']=DISABLED
+    #    options.cbstop._entryWidget['state']=DISABLED
+    #    options.cbhs._entryWidget['state']=DISABLED
+    #    advanced.bsetfreq.configure(state=DISABLED)
+    #    advanced.breadab.configure(state=DISABLED)
+    #    advanced.enable_cal.configure(state=DISABLED)
+    #    advanced.encal.set(0)
+    w.acom1.pttmode=(options.pttmode.get().strip()+'   ')[:3]
+    w.acom1.ncat=options.cat_enable.get()
+    w.acom1.ncoord=hopping.coord_bands.get()
+
+    if g.ndevin.get()!= nin0 or g.ndevout.get()!=nout0:
+        audio_config()
+        nin0=g.ndevin.get()
+        nout0=g.ndevout.get()
+    if options.inbad.get()==0:
+        #msg2.configure(text='',bg='gray85')
+        None
+    else:
+        #msg2.configure(text='Invalid audio input device.',bg='red')
+        print 'Invalid audio input device.'
+    if options.outbad.get()==0:
+        #msg3.configure(text='',bg='gray85')
+        None
+    else:
+        #msg3.configure(text='Invalid audio output device.',bg='red')
+        print 'Invalid audio output device.'
+    if w.acom1.ndecoding:
+        #msg5.configure(text='Decoding',bg='#66FFFF',relief=SUNKEN)
+        print 'Decoding'
+    else:
+        #msg5.configure(text='',bg='gray85',relief=FLAT)
+        None
+
+    #if advanced.encal.get():
+    #    advanced.A_entry.configure(entry_state=NORMAL,label_state=NORMAL)
+    #    advanced.B_entry.configure(entry_state=NORMAL,label_state=NORMAL)
+    #else:
+    #    advanced.A_entry.configure(entry_state=DISABLED,label_state=DISABLED)
+    #    advanced.B_entry.configure(entry_state=DISABLED,label_state=DISABLED)
+  
+    #timer1=ldate.after(200,update)
+    time.sleep(0.2)
+ 
+#------------------------------------------------------ audio_config
+def audio_config():
+    inbad,outbad=w.audiodev(g.ndevin.get(),g.ndevout.get())
+    options.inbad.set(inbad)
+    options.outbad.set(outbad)
+    if inbad or outbad:
+        w.acom1.ndevsok=0
+        print 'Bad audio devices!'
+        #options1()
+    else:
+        print 'Audio config ok'
+        w.acom1.ndevsok=1
+
+#------------------------------------------------------ save_params
+def save_params():
+    return # for no gui
+    f=open(appdir+'/WSPR.INI',mode='w')
+    f.write(&quot;WSPRGeometry &quot; + root_geom + &quot;\n&quot;)
+    if options.MyCall.get()=='': options.MyCall.set('##')
+    f.write(&quot;MyCall &quot; + options.MyCall.get() + &quot;\n&quot;)
+    if options.MyGrid.get()=='': options.MyGrid.set('##')
+    f.write(&quot;MyGrid &quot; + options.MyGrid.get() + &quot;\n&quot;)
+    f.write(&quot;CWID &quot; + str(advanced.idint.get()) + &quot;\n&quot;)
+    f.write(&quot;dBm &quot; + str(options.dBm.get()) + &quot;\n&quot;)
+    f.write(&quot;PttPort &quot; + str(options.PttPort.get()) + &quot;\n&quot;)
+    f.write(&quot;CatPort &quot; + str(options.CatPort.get()) + &quot;\n&quot;)
+    if options.DevinName.get()=='': options.DevinName.set('0')
+    f.write(&quot;AudioIn &quot;  + options.DevinName.get().replace(&quot; &quot;,&quot;#&quot;) + &quot;\n&quot;)
+    if options.DevoutName.get()=='': options.DevoutName.set('2')
+    f.write(&quot;AudioOut &quot; + options.DevoutName.get().replace(&quot; &quot;,&quot;#&quot;) + &quot;\n&quot;)
+    f.write(&quot;BFOfreq &quot; + str(advanced.bfofreq.get()) + &quot;\n&quot;)
+    f.write(&quot;PTTmode &quot; + options.pttmode.get() + &quot;\n&quot;)
+    f.write(&quot;CATenable &quot; + str(options.cat_enable.get()) + &quot;\n&quot;)
+    f.write(&quot;Acal &quot; + str(advanced.Acal.get()) + &quot;\n&quot;)
+    f.write(&quot;Bcal &quot; + str(advanced.Bcal.get()) + &quot;\n&quot;)
+    f.write(&quot;CalEnable &quot; + str(advanced.encal.get()) + &quot;\n&quot;)
+    f.write(&quot;IQmode &quot; + str(iq.iqmode.get()) + &quot;\n&quot;)
+    f.write(&quot;IQrx &quot; + str(iq.iqrx.get()) + &quot;\n&quot;)
+    f.write(&quot;IQtx &quot; + str(iq.iqtx.get()) + &quot;\n&quot;)
+    f.write(&quot;FIQ &quot; + str(iq.fiq.get()) + &quot;\n&quot;)
+    f.write(&quot;Ntxdb &quot; + str(advanced.isc1.get()) + &quot;\n&quot;)
+    f.write(&quot;SerialRate &quot; + str(options.serial_rate.get()) + &quot;\n&quot;)
+    f.write(&quot;DataBits &quot; + str(options.databits.get()) + &quot;\n&quot;)
+    f.write(&quot;StopBits &quot; + str(options.stopbits.get()) + &quot;\n&quot;)
+    f.write(&quot;Handshake &quot; + options.serial_handshake.get().replace(&quot; &quot;,&quot;#&quot;)  + &quot;\n&quot;)
+    t=str(options.rig.get().replace(&quot; &quot;,&quot;#&quot;))
+    f.write(&quot;Rig &quot; + str(t.replace(&quot;\t&quot;,&quot;#&quot;))[:46] + &quot;\n&quot;)
+    f.write(&quot;Nsave &quot; + str(nsave.get()) + &quot;\n&quot;)
+    f.write(&quot;PctTx &quot; + str(ipctx.get()) + &quot;\n&quot;)
+    f.write(&quot;Upload &quot; + str(upload.get()) + &quot;\n&quot;)
+    f.write(&quot;Idle &quot; + str(idle.get()) + &quot;\n&quot;)
+    f.write(&quot;Debug &quot; + str(ndebug.get()) + &quot;\n&quot;)
+    f.write(&quot;WatScale &quot; + str(s0) + &quot;\n&quot;)
+    f.write(&quot;WatOffset &quot; + str(c0) + &quot;\n&quot;)
+    f.write(&quot;Palette &quot; + g.cmap + &quot;\n&quot;)
+    mrudir2=mrudir.replace(&quot; &quot;,&quot;#&quot;)
+    f.write(&quot;MRUdir &quot; + mrudir2 + &quot;\n&quot;)
+    f.write(&quot;freq0_600 &quot; + str( freq0[1]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_600 &quot; + str(freqtx[1]) + &quot;\n&quot;)
+    f.write(&quot;freq0_160 &quot; + str( freq0[2]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_160 &quot; + str(freqtx[2]) + &quot;\n&quot;)
+    f.write(&quot;freq0_80 &quot;  + str( freq0[3]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_80 &quot; + str(freqtx[3]) + &quot;\n&quot;)
+    f.write(&quot;freq0_60 &quot;  + str( freq0[4]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_60 &quot; + str(freqtx[4]) + &quot;\n&quot;)
+    f.write(&quot;freq0_40 &quot;  + str( freq0[5]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_40 &quot; + str(freqtx[5]) + &quot;\n&quot;)
+    f.write(&quot;freq0_30 &quot;  + str( freq0[6]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_30 &quot; + str(freqtx[6]) + &quot;\n&quot;)
+    f.write(&quot;freq0_20 &quot;  + str( freq0[7]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_20 &quot; + str(freqtx[7]) + &quot;\n&quot;)
+    f.write(&quot;freq0_17 &quot;  + str( freq0[8]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_17 &quot; + str(freqtx[8]) + &quot;\n&quot;)
+    f.write(&quot;freq0_15 &quot;  + str( freq0[9]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_15 &quot; + str(freqtx[9]) + &quot;\n&quot;)
+    f.write(&quot;freq0_12 &quot;  + str( freq0[10]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_12 &quot; + str(freqtx[10]) + &quot;\n&quot;)
+    f.write(&quot;freq0_10 &quot;  + str( freq0[11]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_10 &quot; + str(freqtx[11]) + &quot;\n&quot;)
+    f.write(&quot;freq0_6 &quot;  + str( freq0[12]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_6 &quot; + str(freqtx[12]) + &quot;\n&quot;)
+    f.write(&quot;freq0_4 &quot;  + str( freq0[13]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_4 &quot; + str(freqtx[13]) + &quot;\n&quot;)
+    f.write(&quot;freq0_2 &quot;  + str( freq0[14]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_2 &quot; + str(freqtx[14]) + &quot;\n&quot;)
+    f.write(&quot;freq0_other &quot;  + str( freq0[15]) + &quot;\n&quot;)
+    f.write(&quot;freqtx_other &quot; + str(freqtx[15]) + &quot;\n&quot;)
+    f.write(&quot;iband &quot; + str(iband.get()) + &quot;\n&quot;)
+    f.write(&quot;StartIdle &quot; + str(start_idle.get()) + &quot;\n&quot;)
+    f.write(&quot;NoBeep &quot; + str(no_beep.get()) + &quot;\n&quot;)
+    f.write(&quot;Reject &quot; + str(nreject) + &quot;\n&quot;)
+    f.write(&quot;RxApply &quot; + str(iq.iqrxapp.get()) + &quot;\n&quot;)
+    f.close()
+    hopping.save_params(appdir)
+
+#------------------------------------------------------ Top level frame
+# ... all gui setup deleted
+
+isync=1
+iband.set(6)
+idle.set(1)
+ipctx.set(20)
+
+#---------------------------------------------------------- Process INI file
+try:
+    f=open(appdir+'/WSPR.INI',mode='r')
+    params=f.readlines()
+except:
+    params=&quot;&quot;
+
+badlist=[]
+#----------------------------------------------------------- readinit
+def readinit():
+    global nparam,mrudir
+    try:
+        for i in range(len(params)):
+            if badlist.count(i)&gt;0:
+                print 'Skipping bad entry in WSPR.INI:\a',params[i]
+                continue
+            key,value=params[i].split()
+            if   key == 'WSPRGeometry': root.geometry(value)
+            elif key == 'MyCall': options.MyCall.set(value)
+            elif key == 'MyGrid': options.MyGrid.set(value)
+            elif key == 'CWID': advanced.idint.set(value)
+            elif key == 'dBm': options.dBm.set(value)
+            elif key == 'PctTx': ipctx.set(value)
+            elif key == 'PttPort': options.PttPort.set(value)
+            elif key == 'CatPort': options.CatPort.set(value)
+            elif key == 'AudioIn':
+                value=value.replace(&quot;#&quot;,&quot; &quot;)
+                g.DevinName.set(value)
+                try:
+                    g.ndevin.set(int(value[:2]))
+                except:
+                    g.ndevin.set(0)
+                options.DevinName.set(value)
+
+
+            elif key == 'AudioOut':
+                value=value.replace(&quot;#&quot;,&quot; &quot;)
+                g.DevoutName.set(value)
+                try:
+                    g.ndevout.set(int(value[:2]))
+                except:
+                    g.ndevout.set(0)
+                options.DevoutName.set(value)
+
+            elif key == 'BFOfreq': advanced.bfofreq.set(value)
+            elif key == 'Acal': advanced.Acal.set(value)
+            elif key == 'Bcal': advanced.Bcal.set(value)
+            elif key == 'CalEnable': advanced.encal.set(value)
+            elif key == 'IQmode': iq.iqmode.set(value)
+            elif key == 'IQrx': iq.iqrx.set(value)
+            elif key == 'IQtx': iq.iqtx.set(value)
+            elif key == 'FIQ': iq.fiq.set(value)
+            elif key == 'Ntxphaf': iq.isc3a.set(value)
+            elif key == 'PTTmode': options.pttmode.set(value)
+            elif key == 'CATenable': options.cat_enable.set(value)
+            elif key == 'SerialRate': options.serial_rate.set(int(value))
+            elif key == 'DataBits': options.databits.set(int(value))
+            elif key == 'StopBits': options.stopbits.set(int(value))
+            elif key == 'Handshake': options.serial_handshake.set(value.replace(&quot;#&quot;,&quot; &quot;) )
+            elif key == 'Rig':
+                t=value.replace(&quot;#&quot;,&quot; &quot;)
+                options.rig.set(t)
+                options.rignum.set(int(t[:4]))
+            elif key == 'Nsave': nsave.set(value)
+            elif key == 'Upload': upload.set(value)
+            elif key == 'Idle': idle.set(value)
+            elif key == 'Debug': ndebug.set(value)
+            elif key == 'WatScale': sc1.set(value)
+            elif key == 'WatOffset': sc2.set(value)
+            elif key == 'Palette': g.cmap=value
+            elif key == 'freq0_600': freq0[1]=float(value)
+            elif key == 'freq0_160': freq0[2]=float(value)
+            elif key == 'freq0_80': freq0[3]=float(value)
+            elif key == 'freq0_60': freq0[4]=float(value)
+            elif key == 'freq0_40': freq0[5]=float(value)
+            elif key == 'freq0_30': freq0[6]=float(value)
+            elif key == 'freq0_20': freq0[7]=float(value)
+            elif key == 'freq0_17': freq0[8]=float(value)
+            elif key == 'freq0_15': freq0[9]=float(value)
+            elif key == 'freq0_12': freq0[10]=float(value)
+            elif key == 'freq0_10': freq0[11]=float(value)
+            elif key == 'freq0_6': freq0[12]=float(value)
+            elif key == 'freq0_4': freq0[13]=float(value)
+            elif key == 'freq0_2': freq0[14]=float(value)
+            elif key == 'freq0_other': freq0[15]=float(value)
+            elif key == 'freqtx_600': freqtx[1]=float(value)
+            elif key == 'freqtx_160': freqtx[2]=float(value)
+            elif key == 'freqtx_80': freqtx[3]=float(value)
+            elif key == 'freqtx_60': freqtx[4]=float(value)
+            elif key == 'freqtx_40': freqtx[5]=float(value)
+            elif key == 'freqtx_30': freqtx[6]=float(value)
+            elif key == 'freqtx_20': freqtx[7]=float(value)
+            elif key == 'freqtx_17': freqtx[8]=float(value)
+            elif key == 'freqtx_15': freqtx[9]=float(value)
+            elif key == 'freqtx_12': freqtx[10]=float(value)
+            elif key == 'freqtx_10': freqtx[11]=float(value)
+            elif key == 'freqtx_6': freqtx[12]=float(value)
+            elif key == 'freqtx_4': freqtx[13]=float(value)
+            elif key == 'freqtx_2': freqtx[14]=float(value)
+            elif key == 'freqtx_other': freqtx[15]=float(value)
+            elif key == 'iband': iband.set(value)
+            elif key == 'StartIdle': start_idle.set(value)
+            elif key == 'NoBeep': no_beep.set(value)
+            elif key == 'Reject': w.acom1.reject=float(value)
+            elif key == 'RxApply': iq.iqrxapp.set(value)
+
+            elif key == 'MRUdir':
+                mrudir=value.replace(&quot;#&quot;,&quot; &quot;)
+            nparam=i            
+            
+    except:
+        badlist.append(i)
+        nparam=i
+    
+
+w.acom1.gain=1.0
+w.acom1.phase=0.0
+w.acom1.reject=0.
+while nparam &lt; len(params)-1:
+    readinit()
+hopping.restore_params(appdir)
+iq.ib.set(iband.get())
+iq.restore()
+
+r=options.chkcall(options.MyCall.get())
+#if r&lt;0:
+#    options.lcall._entryFieldEntry['background']='pink'
+#    options1()
+#else:
+#    options.lcall._entryFieldEntry['background']='white'
+    
+r=options.chkgrid(options.MyGrid.get())
+#if r&lt;0:
+#    options.lgrid._entryFieldEntry['background']='pink'
+#    options1()
+#else:
+#    options.lgrid._entryFieldEntry['background']='white'
+
+if g.DevinName.get()==&quot;&quot;:
+    g.ndevin.set(-1)
+    
+clearlyint=9
+f0.set(freq0[iband.get()])
+ftx.set(freqtx[iband.get()])
+
+if start_idle.get():
+    idle.set(1)
+
+#------------------------------------------------------  Select palette
+if g.cmap == &quot;gray0&quot;:
+    pal_gray0()
+    npal.set(0)
+if g.cmap == &quot;gray1&quot;:
+    pal_gray1()
+    npal.set(1)
+if g.cmap == &quot;Linrad&quot;:
+    pal_linrad()
+    npal.set(2)
+if g.cmap == &quot;blue&quot;:
+    pal_blue()
+    npal.set(3)
+if g.cmap == &quot;Hot&quot;:
+    pal_Hot()
+    npal.set(4)
+if g.cmap == &quot;AFMHot&quot;:
+    pal_AFMHot()
+    npal.set(5)
+
+# gui related: 
+#options.dbm_balloon()
+fmid=f0.get() + 0.001500
+sftx.set('%.06f' % ftx.get())
+#draw_axis()
+#erase()
+#if g.Win32: root.iconbitmap(&quot;wsjt.ico&quot;)
+#root.title('  WSPR 3.0     by K1JT')
+
+put_params()
+try:
+    os.remove('decoded.txt')
+except:
+    pass
+try:
+    os.remove('pixmap.dat')
+except:
+    pass
+
+##if hopping.hopping.get() and hopping.coord_bands.get() and not idle.get():
+##    tsec=time.time()
+##    utc=time.gmtime(tsec)
+##    ns1=int(tsec) % 1200
+##    b=ns1/120 + 3
+##    if b==12: b=2
+##    if hopping.hoppingflag[b].get():
+##        iband.set(b)
+## Issue rigctl command here
+
+iband0=iband.get()
+#graph1.focus_set()
+w.acom1.ndevsok=0
+w.acom1.ntxnext=0
+w.acom1.nstoptx=0
+w.wspr1()
+t=&quot;%.6f&quot; % (f0.get(),)
+sf0.set(t)
+t=&quot;%.6f&quot; % (ftx.get(),)
+sftx.set(t)
+
+time.sleep(0.1)
+audio_config()
+time.sleep(0.1)
+update_nogui()
+
+#ldate.after(100,update)
+#ldate.after(100,audio_config)
+
+##from WsprMod import specjt
+#root.mainloop()
+
+#ldate.after_cancel(timer1)
+
+# Clean up and save user options, then terminate.
+if options.pttmode.get()=='CAT':
+    if options.rignum.get()==2509 or options.rignum.get()==2511:
+        cmd=&quot;rigctl -m %d -r %s T 0&quot; % \
+             (options.rignum.get(),options.CatPort.get())
+    else:
+        cmd=&quot;rigctl -m %d -r %s -s %d -C data_bits=%s -C stop_bits=%s -C serial_handshake=%s T 0&quot; % \
+             (options.rignum.get(),options.CatPort.get(), \
+              options.serial_rate.get(),options.databits.get(), \
+              options.stopbits.get(),options.serial_handshake.get())
+    ierr=os.system(cmd)
+# don't save different params save_params()
+w.paterminate()
+time.sleep(0.5)

Added: branches/wspr/wspr_nogui.txt
===================================================================
--- branches/wspr/wspr_nogui.txt	                        (rev 0)
+++ branches/wspr/wspr_nogui.txt	2010-12-29 05:58:18 UTC (rev 2327)
@@ -0,0 +1,25 @@
+A very preliminary prototype of no-GUI WSPR
+Sivan Toledo 4X6IZ
+
+This prototype consist of:
+  wspr_nogui.py         This is a version of wspr.py with all the GUI calls stipped out
+  tkrep.py              replacement for 3 classes that are not just GUI related
+                        but come from Tkinter, the GUI library
+  WsprmModNoGui/*.py    __init__, advanced, g, hopping, iq, options, and palettes
+                        These are versions of the files in WsprMod but with the GUI stipped out
+                        
+To build and run this, run the makefile at least up to the point that it builds w.pyd.
+Copy WsprMod/w.pyd to WsprModNoGui (I am sure there's a way to avoid this, probably by setting
+PYTHONPATH or something like that).
+
+Now just run &quot;python -O wspr_nogui.py&quot; instead of running wspr.py.
+
+The code uses the same wspr.ini and hopping.ini, so running it should be equivalent to starting up WSPR
+and letting it run without touching the GUI.
+
+I tested it in hopping and no-hopping modes, but RX only. Bugs typically show up as remaining calls
+to GUI functions.
+
+This is just a prototype; it can't be supported this way. one way make this maintainable is to refactor
+the Python codes into a functional part (scheduling, reading files, etc) and a control part. The
+controller could be GUI or text-based.
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002018.html">[WSJT-SVN] r2326 - branches/wspr
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2019">[ date ]</a>
              <a href="thread.html#2019">[ thread ]</a>
              <a href="subject.html#2019">[ subject ]</a>
              <a href="author.html#2019">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/wsjt-svn">More information about the wsjt-svn
mailing list</a><br>
</body></html>
