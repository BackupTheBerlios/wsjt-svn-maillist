<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [WSJT-SVN] r322 - branches/map65
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/wsjt-svn/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r322%20-%20branches/map65&In-Reply-To=%3C200701082058.l08KwinS010513%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000006.html">
   <LINK REL="Next"  HREF="000008.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[WSJT-SVN] r322 - branches/map65</H1>
    <B>k1jt at mail.berlios.de</B> 
    <A HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r322%20-%20branches/map65&In-Reply-To=%3C200701082058.l08KwinS010513%40sheep.berlios.de%3E"
       TITLE="[WSJT-SVN] r322 - branches/map65">k1jt at mail.berlios.de
       </A><BR>
    <I>Mon Jan  8 21:58:44 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000006.html">[WSJT-SVN] r321 - branches/map65
</A></li>
        <LI>Next message: <A HREF="000008.html">[WSJT-SVN] r323 - branches/map65
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7">[ date ]</a>
              <a href="thread.html#7">[ thread ]</a>
              <a href="subject.html#7">[ subject ]</a>
              <a href="author.html#7">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: k1jt
Date: 2007-01-08 21:58:40 +0100 (Mon, 08 Jan 2007)
New Revision: 322

Added:
   branches/map65/map65.py
Removed:
   branches/map65/wsjt.py
Modified:
   branches/map65/Makefile.win
Log:
Changed name of wsjt.py to map65.py.  Initial Compile of MAP65.EXE.


Modified: branches/map65/Makefile.win
===================================================================
--- branches/map65/Makefile.win	2007-01-08 20:54:34 UTC (rev 321)
+++ branches/map65/Makefile.win	2007-01-08 20:58:40 UTC (rev 322)
@@ -7,20 +7,8 @@
 #FFLAGS = /traceback /check:all
 FFLAGS = /traceback /fast /nologo
 
-all:    JT65code.exe WSJT6.EXE
+all:    MAP65.EXE
 
-OBJS1 = JT65code.obj nchar.obj grid2deg.obj packmsg.obj packtext.obj \
-	packcall.obj packgrid.obj unpackmsg.obj unpacktext.obj \
-	unpackcall.obj unpackgrid.obj deg2grid.obj packdxcc.obj \
-	chkmsg.obj getpfx1.obj getpfx2.obj k2grid.obj grid2k.obj \
-	interleave63.obj graycode.obj set.obj igray.obj \
-	init_rs.obj encode_rs.obj decode_rs.obj \
-	wrapkarn.obj
-
-JT65code.exe: $(OBJS1)
-	$(FC) $(FFLAGS) /exe:JT65code.exe $(OBJS1)
-
-
 OBJS2C   = init_rs.o encode_rs.o decode_rs.o jtaudio.o
 F2PYONLY = ftn_init ftn_quit audio_init spec getfile azdist0 astro0
 SRCS2F90 = a2d.f90 abc441.f90 astro0.f90 audio_init.f90 azdist0.f90 \
@@ -45,10 +33,8 @@
 
 SRCS2C   = resample.c ptt.c igray.c wrapkarn.c
 
-WSJT6.EXE: Audio.pyd wsjt.spec
-	python c:\python23\installer\Build.py wsjt.spec
-	-del WSJT6.EXE
-	REN wsjt.exe WSJT6.EXE
+MAP65.EXE: Audio.pyd map65.spec
+	python c:\python23\installer\Build.py map65.spec
 
 Audio.pyd: $(OBJS2C) $(SRCS2F90) $(SRCS2F77) $(SRCS2C) 
 	python f2py.py -c \
@@ -61,9 +47,9 @@
 	only: $(F2PYONLY) : \
 	$(SRCS2F90) $(SRCS2F77) $(SRCS2C)
 
-wsjt.spec: wsjt.py astro.py g.py options.py palettes.py smeter.py specjt.py
+map65.spec: map65.py astro.py g.py options.py palettes.py smeter.py specjt.py
 	python c:\python23\installer\makespec.py --icon wsjt.ico \
-	--tk --onefile wsjt.py
+	--tk --onefile map65.py
 
 jtaudio.o: jtaudio.c
 	$(CC) /nologo /c /DWin32 /Fojtaudio.o jtaudio.c
@@ -95,6 +81,6 @@
 .PHONY : clean
 
 clean:
-    -del *.o *.obj JT65code.exe wsjt6.exe Audio.pyd
+    -del *.o *.obj MAP65.EXE Audio.pyd
 
 

Copied: branches/map65/map65.py (from rev 321, branches/map65/wsjt.py)
===================================================================
--- branches/map65/wsjt.py	2007-01-08 20:54:34 UTC (rev 321)
+++ branches/map65/map65.py	2007-01-08 20:58:40 UTC (rev 322)
@@ -0,0 +1,2269 @@
+#------------------------------------------------------------------ MAP65
+# $Date$ $Revision$
+#
+from Tkinter import *
+from tkFileDialog import *
+import Pmw
+from tkMessageBox import showwarning
+import g,os,time
+import Audio
+from math import log10
+from Numeric import zeros
+import dircache
+import Image,ImageTk  #, ImageDraw
+from palettes import colormapblue, colormapgray0, colormapHot, \
+     colormapAFMHot, colormapgray1, colormapLinrad, Colormap2Palette
+from types import *
+import array
+
+root = Tk()
+Version=&quot;0.1 r&quot; + &quot;$Rev$&quot;[6:-1]
+print &quot;******************************************************************&quot;
+print &quot;MAP65 Version &quot; + Version + &quot;, by K1JT&quot;
+print &quot;Revision date: &quot; + \
+      &quot;$Date$&quot;[7:-1]
+print &quot;Run date:   &quot; + time.asctime(time.gmtime()) + &quot; UTC&quot;
+
+#See if we are running in Windows
+g.Win32=0
+if sys.platform==&quot;win32&quot;:
+    g.Win32=1
+    try:
+        root.option_readfile('map65rc.win')
+    except:
+        pass
+else:
+    try:
+        root.option_readfile('map65rc')
+    except:
+        pass
+root_geom=&quot;&quot;
+
+
+#------------------------------------------------------ Global variables
+appdir=os.getcwd()
+isync=0
+isync441=2
+isync6m=-10
+isync65=1
+isync_save=0
+iclip=0
+itol=5                                       #Default tol=400 Hz
+ntol=(10,25,50,100,200,400,600)              #List of available tolerances
+idsec=0
+#irdsec=0
+lauto=0
+altmsg=0
+bm_geom=&quot;&quot;
+cmap0=&quot;Linrad&quot;
+fileopened=&quot;&quot;
+font1='Helvetica'
+hiscall=&quot;&quot;
+hisgrid=&quot;&quot;
+isec0=-99
+k2txb=IntVar()
+kb8rq=IntVar()
+loopall=0
+mode=StringVar()
+mode.set(&quot;&quot;)
+mrudir=os.getcwd()
+nafc=IntVar()
+naz=0
+ndepth=IntVar()
+nel=0
+nblank=IntVar()
+ncall=0
+ncwtrperiod=120
+ndmiles=0
+ndkm=0
+ndebug=IntVar()
+neme=IntVar()
+nfreeze=IntVar()
+nhotaz=0
+nhotabetter=0
+nopen=0
+nosh441=IntVar()
+noshjt65=IntVar()
+nsked=IntVar()
+setseq=IntVar()
+ShOK=IntVar()
+slabel=&quot;Sync   &quot;
+textheight=7
+tx6alt=&quot;&quot;
+txsnrdb=99.
+TxFirst=IntVar()
+green=zeros(500,'f')
+im=Image.new('P',(500,120))
+im.putpalette(Colormap2Palette(colormapLinrad),&quot;RGB&quot;)
+pim=ImageTk.PhotoImage(im)
+balloon=Pmw.Balloon(root)
+
+g.freeze_decode=0
+g.mode=&quot;&quot;
+g.ndevin=IntVar()
+g.ndevout=IntVar()
+g.DevinName=StringVar()
+g.DevoutName=StringVar()
+#------------------------------------------------------ showspecjt
+def showspecjt(event=NONE):
+    if g.showspecjt==0: g.showspecjt=1
+
+#------------------------------------------------------ restart
+def restart():
+    Audio.gcom2.nrestart=1
+    Audio.gcom2.mantx=1
+
+#------------------------------------------------------ restart2
+def restart2():
+    Audio.gcom2.shok=ShOK.get()
+    Audio.gcom2.nrestart=1
+
+#------------------------------------------------------ toggle_freeze
+def toggle_freeze(event=NONE):
+    nfreeze.set(1-nfreeze.get())
+
+#------------------------------------------------------ toggle_zap
+def toggle_zap(event=NONE):
+    nzap.set(1-nzap.get())
+
+#------------------------------------------------------ btx (1-6)
+def btx1(event=NONE):
+    ntx.set(1)
+    Audio.gcom2.txmsg=(tx1.get()+'                            ')[:28]
+    Audio.gcom2.ntxreq=1
+    restart()
+def btx2(event=NONE):
+    ntx.set(2)
+    Audio.gcom2.txmsg=(tx2.get()+'                            ')[:28]
+    Audio.gcom2.ntxreq=2
+    restart()
+def btx3(event=NONE):
+    ntx.set(3)
+    Audio.gcom2.txmsg=(tx3.get()+'                            ')[:28]
+    Audio.gcom2.ntxreq=3
+    restart()
+def btx4(event=NONE):
+    ntx.set(4)
+    Audio.gcom2.txmsg=(tx4.get()+'                            ')[:28]
+    Audio.gcom2.ntxreq=4
+    restart()
+def btx5(event=NONE):
+    ntx.set(5)
+    Audio.gcom2.txmsg=(tx5.get()+'                            ')[:28]
+    Audio.gcom2.ntxreq=5
+    restart()
+def btx6(event=NONE):
+    ntx.set(6)
+    Audio.gcom2.txmsg=(tx6.get()+'                            ')[:28]
+    Audio.gcom2.ntxreq=6
+    restart()
+
+#------------------------------------------------------ quit
+def quit():
+    root.destroy()
+
+#------------------------------------------------------ testmsgs
+def testmsgs():
+    for m in (tx1, tx2, tx3, tx4, tx5, tx6):
+        m.delete(0,99)
+    tx1.insert(0,&quot;@A&quot;)
+    tx2.insert(0,&quot;@B&quot;)
+    tx3.insert(0,&quot;@C&quot;)
+    tx4.insert(0,&quot;@D&quot;)
+    tx5.insert(0,&quot;@1000&quot;)
+    tx6.insert(0,&quot;@2000&quot;)
+
+
+#------------------------------------------------------ textsize
+def textsize():
+    global textheight
+    if textheight &lt;= 9:
+        textheight=21
+    else:
+        if mode.get()[:4]=='JT65':
+            textheight=7
+        else:
+            textheight=9
+    text.configure(height=textheight)
+
+#------------------------------------------------------ logqso
+def logqso(event=NONE):
+    t=time.strftime(&quot;%Y-%b-%d,%H:%M&quot;,time.gmtime())
+    t=t+&quot;,&quot;+hiscall+&quot;,&quot;+hisgrid+&quot;,&quot;+str(g.nfreq)+&quot;,&quot;+g.mode+&quot;\n&quot;
+    t2=&quot;Please confirm making the following entry in MAP65.LOG:\n\n&quot; + t
+    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),message_text=t2)
+    msg.geometry(msgpos())
+    if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
+    msg.focus_set()
+    result=msg.activate()
+    if result == 'Yes':
+        f=open(appdir+'/WSJT.LOG','a')
+        f.write(t)
+        f.close()
+    
+#------------------------------------------------------ monitor
+def monitor(event=NONE):
+    bmonitor.configure(bg='green')
+    Audio.gcom2.monitoring=1
+
+#------------------------------------------------------ stopmon
+def stopmon(event=NONE):
+    global loopall
+    loopall=0
+    bmonitor.configure(bg='gray85')
+    Audio.gcom2.monitoring=0
+
+#------------------------------------------------------ dbl_click_text
+def dbl_click_text(event):
+    t=text.get('1.0',END)           #Entire contents of text box
+    t1=text.get('1.0',CURRENT)      #Contents from start to mouse pointer
+    dbl_click_call(t,t1,event)
+#------------------------------------------------------ dbl_click_ave
+def dbl_click_ave(event):
+    t=avetext.get('1.0',END)           #Entire contents of text box
+    t1=avetext.get('1.0',CURRENT)      #Contents from start to mouse pointer
+    dbl_click_call(t,t1,event)
+#------------------------------------------------------ dbl_click_call
+def dbl_click_call(t,t1,event):
+    global hiscall
+    i=len(t1)                       #Length to mouse pointer
+    i1=t1.rfind(' ')+1              #index of preceding space
+    i2=i1+t[i1:].find(' ')          #index of next space
+    hiscall=t[i1:i2]                #selected word, assumed as callsign
+    ToRadio.delete(0,END)
+    ToRadio.insert(0,hiscall)
+    i3=t1.rfind('\n')+1             #start of selected line
+    if i&gt;6 and i2&gt;i1:
+        try:
+            nsec=60*int(t1[i3+2:i3+4]) + int(t1[i3+4:i3+6])
+        except:
+            nsec=0
+        if setseq.get(): TxFirst.set((nsec/Audio.gcom1.trperiod)%2)
+        lookup()
+        GenStdMsgs()
+        i3=t[:i1].strip().rfind(' ')+1
+        if t[i3:i1].strip() == 'CQ':
+            ntx.set(1)
+        else:
+            ntx.set(2)
+        if event.num==3 and not lauto: toggleauto()
+
+def textkey(event=NONE):
+    text.configure(state=DISABLED)
+def avetextkey(event=NONE):
+    avetext.configure(state=DISABLED)
+
+#------------------------------------------------------ decode
+def decode(event=NONE):
+    if Audio.gcom2.ndecoding==0:        #If already busy, ignore request
+        Audio.gcom2.nagain=1
+        Audio.gcom2.npingtime=0         #Decode whole record
+        n=1
+        Audio.gcom2.mousebutton=0
+        if Audio.gcom2.ndecoding0==4: n=4
+        Audio.gcom2.ndecoding=n         #Standard decode, full file (d2a)
+
+#------------------------------------------------------ decode_include
+def decode_include(event=NONE):
+    global isync,isync_save
+    isync_save=isync
+    isync=-99
+    Audio.gcom2.minsigdb=-99
+    decode()
+
+#------------------------------------------------------ decode_exclude
+def decode_exclude(event=NONE):
+    global isync,isync_save
+    isync_save=isync
+    isync=99
+    Audio.gcom2.minsigdb=99
+    decode()
+
+#------------------------------------------------------ openfile
+def openfile(event=NONE):
+    global mrudir,fileopened,nopen
+    nopen=1                         #Work-around for &quot;click feedthrough&quot; bug
+    try:
+        os.chdir(mrudir)
+    except:
+        pass
+    fname=askopenfilename(filetypes=[(&quot;Wave files&quot;,&quot;*.wav *.WAV&quot;)])
+    if fname:
+        Audio.getfile(fname,len(fname))
+        if Audio.gcom2.ierr: print 'Error ',Audio.gcom2.ierr, \
+           'when trying to read file',fname
+        mrudir=os.path.dirname(fname)
+        fileopened=os.path.basename(fname)
+    os.chdir(appdir)
+ 
+#------------------------------------------------------ opennext
+def opennext(event=NONE):
+    global ncall,fileopened,loopall,mrudir
+    if fileopened==&quot;&quot; and ncall==0:
+        openfile()
+        ncall=1
+    else:
+# Make a list of *.wav files in mrudir
+        la=os.listdir(mrudir)
+        la.sort()
+        lb=[]
+        for i in range(len(la)):
+            j=la[i].find(&quot;.wav&quot;) + la[i].find(&quot;.WAV&quot;)
+            if j&gt;0: lb.append(la[i])
+        for i in range(len(lb)):
+            if lb[i]==fileopened:
+                break
+        if i&lt;len(lb)-1:
+            fname=mrudir+&quot;/&quot;+lb[i+1]
+#            if not lauto: stopmon()
+            Audio.getfile(fname,len(fname))
+            if Audio.gcom2.ierr: print 'Error ',Audio.gcom2.ierr, \
+               'when trying to read file',fname
+            mrudir=os.path.dirname(fname)
+            fileopened=os.path.basename(fname)
+        else:
+            t=&quot;No more *.wav files in this directory.&quot;
+            msg=Pmw.MessageDialog(root,buttons=('OK',),message_text=t)
+            msg.geometry(msgpos())
+            if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
+            msg.focus_set()
+            ncall=0
+            loopall=0
+
+#------------------------------------------------------ decodeall
+def decodeall(event=NONE):
+    global loopall
+    loopall=1
+    opennext()
+
+#------------------------------------------------------ astro1
+def astro1(event=NONE):
+    astro.astro2(g.astro_geom0)
+
+#------------------------------------------------------ options1
+def options1(event=NONE):
+    options.options2(root_geom[root_geom.index(&quot;+&quot;):])
+
+#------------------------------------------------------ txmute
+def txmute(event=NONE):
+    Audio.gcom1.mute=1-Audio.gcom1.mute
+    if Audio.gcom1.mute:
+        lab7.configure(bg='red',fg='black')
+    else:
+        lab7.configure(bg='gray85',fg='gray85')
+
+#------------------------------------------------------ savelast
+def savelast(event=NONE):
+    Audio.gcom2.nsavelast=1
+
+#------------------------------------------------------ stub
+def stub(event=NONE):
+    MsgBox(&quot;Sorry, this function is not yet implemented.&quot;)
+
+#------------------------------------------------------ MsgBox
+def MsgBox(t):
+    msg=Pmw.MessageDialog(root,buttons=('OK',),message_text=t)
+    result=msg.activate()
+    msg.focus_set()
+
+#------------------------------------------------------ txstop
+def txstop(event=NONE):
+    if lauto: toggleauto()
+    Audio.gcom1.txok=0
+    Audio.gcom2.mantx=0
+    
+#------------------------------------------------------ lookup
+def lookup(event=NONE):
+    global hiscall,hisgrid
+    hiscall=ToRadio.get().upper().strip()
+    ToRadio.delete(0,END)
+    ToRadio.insert(0,hiscall)
+    s=whois(hiscall)
+    balloon.bind(ToRadio,s[:-1])
+    hisgrid=&quot;&quot;
+    if s:
+        i1=s.find(',')
+        i2=s.find(',',i1+1)
+        hisgrid=s[i1+1:i2]
+        hisgrid=hisgrid[:2].upper()+hisgrid[2:4]+hisgrid[4:6].lower()
+    if len(hisgrid)==4: hisgrid=hisgrid+&quot;mm&quot;
+    if len(hisgrid)==5: hisgrid=hisgrid+&quot;m&quot;
+    HisGrid.delete(0,99)
+    HisGrid.insert(0,hisgrid)
+
+def lookup_gen(event):
+    lookup()
+    GenStdMsgs()
+
+#-------------------------------------------------------- addtodb
+def addtodb():
+    global hiscall
+    if HisGrid.get()==&quot;&quot;:
+        MsgBox(&quot;Please enter a valid grid locator.&quot;)
+    else:
+        modified=0
+        hiscall=ToRadio.get().upper().strip()
+        hisgrid=HisGrid.get().strip()
+        hc=hiscall
+        NewEntry=hc + &quot;,&quot; + hisgrid
+        msg=Pmw.MessageDialog(root,buttons=('Yes','No'),
+            message_text=&quot;Is this station known to be active on EME?&quot;)
+        result=msg.activate()
+        msg.focus_set()
+        if result==&quot;Yes&quot;:
+            NewEntry=NewEntry + &quot;,EME,,&quot;
+        else:
+            NewEntry=NewEntry + &quot;,,,&quot;
+        try:
+            f=open(appdir+'/CALL3.TXT','r')
+            s=f.readlines()
+        except:
+            print 'Error opening CALL3.TXT'
+            s=&quot;&quot;
+        f.close()
+        hc2=&quot;&quot;
+        stmp=[]
+        for i in range(len(s)):
+            hc1=hc2
+            if s[i][:2]==&quot;//&quot;:
+                stmp.append(s[i])
+            else:
+                i1=s[i].find(&quot;,&quot;)
+                hc2=s[i][:i1]
+                if hc&gt;hc1 and hc&lt;hc2:
+                    stmp.append(NewEntry+&quot;\n&quot;)
+                    modified=1
+                elif hc==hc2:
+                    t=s[i] + &quot;\n\n is already in CALL3.TXT\nDo you wish to replace this entry?&quot;
+                    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),
+                        message_text=t)
+                    result=msg.activate()
+                    msg.focus_set()
+                    if result==&quot;Yes&quot;:
+                        i1=s[i].find(&quot;,&quot;)
+                        i2=s[i].find(&quot;,&quot;,i1+1)
+                        i3=s[i].find(&quot;,&quot;,i2+1)
+                        i4=len(NewEntry)
+                        s[i]=NewEntry[:i4-1] + s[i][i3+1:]
+                        modified=1
+                stmp.append(s[i])
+        if hc&gt;hc1 and modified==0:
+            stmp.append(NewEntry+&quot;\n&quot;)
+        try:
+            f=open(appdir+'/CALL3.TMP','w')
+            f.writelines(stmp)
+            f.close()
+        except:
+            print 'Error in opening or writing to CALL3.TMP'
+
+        if modified:
+            if os.path.exists(&quot;CALL3.OLD&quot;): os.remove(&quot;CALL3.OLD&quot;)
+            os.rename(&quot;CALL3.TXT&quot;,&quot;CALL3.OLD&quot;)
+            os.rename(&quot;CALL3.TMP&quot;,&quot;CALL3.TXT&quot;)
+
+#-------------------------------------------------------- clrToRadio
+def clrToRadio(event):
+    ToRadio.delete(0,END)
+    HisGrid.delete(0,99)
+    ToRadio.focus_set()
+    if kb8rq.get():
+        ntx.set(6)
+        nfreeze.set(0)
+
+#------------------------------------------------------ whois
+def whois(hiscall):
+    whodat=&quot;&quot;
+    try:
+        f=open(appdir+'/CALL3.TXT','r')
+        s=f.readlines()
+        f.close()
+    except:
+        print 'Error when searching CALL3.TXT, or no such file present'
+        s=&quot;&quot;
+    for i in range(len(s)):
+        if s[i][:2] != '//':
+            i1=s[i].find(',')
+            if s[i][:i1] == hiscall:
+                return s[i]
+    return &quot;&quot;
+
+#------------------------------------------------------ cleartext
+def cleartext():
+    f=open(appdir+'/decoded.txt',mode='w')
+    f.truncate(0)                           #Delete contents of decoded.txt
+    f.close()
+    f=open(appdir+'/decoded.ave',mode='w')
+    f.truncate(0)                           #Delete contents of decoded.ave
+    f.close()
+
+#------------------------------------------------------ ModeFSK441
+def ModeFSK441(event=NONE):
+    global slabel,isync,isync441,textheight,itol
+    if g.mode != &quot;FSK441&quot;:
+        if lauto: toggleauto()
+        mode.set(&quot;FSK441&quot;)
+        cleartext()
+        Audio.gcom1.trperiod=30
+        lab2.configure(text='FileID            T      Width    dB  Rpt       DF')
+        lab1.configure(text='Time (s)',bg=&quot;green&quot;)
+        lab4.configure(fg='black')
+        lab5.configure(fg='black')
+        lab6.configure(bg=&quot;green&quot;)
+        isync=isync441
+        slabel=&quot;S      &quot;
+        lsync.configure(text=slabel+str(isync))
+        iframe4b.pack_forget()
+        textheight=9
+        text.configure(height=textheight)
+        bclravg.configure(state=DISABLED)
+        binclude.configure(state=DISABLED)
+        bexclude.configure(state=DISABLED)
+        cbfreeze.configure(state=DISABLED)
+        cbafc.configure(state=DISABLED)
+        sked.configure(state=DISABLED)
+        report.configure(state=NORMAL)
+        shmsg.configure(state=NORMAL)
+        graph2.configure(bg='black')
+        itol=4
+        inctol()
+        ntx.set(1)
+        GenStdMsgs()
+        erase()
+
+#------------------------------------------------------ ModeJT65
+def ModeJT65():
+    global slabel,isync,isync65,textheight,itol
+    cleartext()
+    lab2.configure(text='FileID      Sync      dB        DT       DF    W')
+    lab4.configure(fg='gray85')
+    lab5.configure(fg='gray85')
+    Audio.gcom1.trperiod=60
+    iframe4b.pack(after=iframe4,expand=1, fill=X, padx=4)
+    textheight=7
+    text.configure(height=textheight)
+    isync=isync65
+    slabel=&quot;Sync   &quot;
+    lsync.configure(text=slabel+str(isync))
+    bclravg.configure(state=NORMAL)
+    binclude.configure(state=NORMAL)
+    bexclude.configure(state=NORMAL)
+    cbfreeze.configure(state=NORMAL)
+    cbafc.configure(state=NORMAL)
+    sked.configure(state=NORMAL)
+    report.configure(state=DISABLED)
+    shmsg.configure(state=DISABLED)
+    graph2.configure(bg='#66FFFF')
+    itol=4
+    inctol()
+    nfreeze.set(0)
+    ntx.set(1)
+    GenStdMsgs()
+    erase()
+#    graph2.pack_forget()
+
+#------------------------------------------------------ ModeJT65A
+def ModeJT65A(event=NONE):
+    if g.mode != &quot;JT65A&quot;:
+        if lauto: toggleauto()
+        mode.set(&quot;JT65A&quot;)
+        ModeJT65()
+
+#------------------------------------------------------ ModeJT65B
+def ModeJT65B(event=NONE):
+    if g.mode != &quot;JT65B&quot;:
+        if lauto: toggleauto()
+        mode.set(&quot;JT65B&quot;)
+        ModeJT65()
+
+#------------------------------------------------------ ModeJT65C
+def ModeJT65C(event=NONE):
+    if g.mode != &quot;JT65C&quot;:
+        if lauto: toggleauto()
+        mode.set(&quot;JT65C&quot;)
+        ModeJT65()
+
+#------------------------------------------------------ ModeJT6M
+def ModeJT6M(event=NONE):
+    global slabel,isync,isync6m,itol
+    if g.mode != &quot;JT6M&quot;:
+        if lauto: toggleauto()
+        cleartext()
+        ModeFSK441()
+        lab2.configure(text='FileID            T      Width      dB        DF')
+        mode.set(&quot;JT6M&quot;)
+        isync=isync6m
+        lsync.configure(text=slabel+str(isync))
+        shmsg.configure(state=DISABLED)
+        cbfreeze.configure(state=NORMAL)
+        itol=3
+        ltol.configure(text='Tol    '+str(ntol[itol]))
+        inctol()
+        nfreeze.set(1)
+        ntx.set(1)
+        Audio.gcom2.mousedf=0
+        GenStdMsgs()
+        erase()
+        
+
+#------------------------------------------------------ ModeCW
+def ModeCW(event=NONE):
+    if g.mode != &quot;CW&quot;:
+        if lauto: toggleauto()
+        cleartext()
+        mode.set(&quot;CW&quot;)
+        Audio.gcom1.trperiod=ncwtrperiod
+        iframe4b.pack_forget()
+        text.configure(height=9)
+        bclravg.configure(state=DISABLED)
+        binclude.configure(state=DISABLED)
+        bexclude.configure(state=DISABLED)
+        cbfreeze.configure(state=DISABLED)
+        cbafc.configure(state=DISABLED)
+        sked.configure(state=DISABLED)
+        report.configure(state=NORMAL)
+        ntx.set(1)
+        GenStdMsgs()
+        erase()
+
+#------------------------------------------------------ ModeEcho
+#def ModeEcho(event=NONE):
+#    mode.set(&quot;Echo&quot;)
+#    stub()
+    
+#------------------------------------------------------ msgpos
+def msgpos():
+    g=root_geom[root_geom.index(&quot;+&quot;):]
+    t=g[1:]
+    x=int(t[:t.index(&quot;+&quot;)])          # + 70
+    y=int(t[t.index(&quot;+&quot;)+1:])        # + 70
+    return &quot;+%d+%d&quot; % (x,y)    
+
+#------------------------------------------------------ about
+def about(event=NONE):
+    global Version
+    about=Toplevel(root)
+    about.geometry(msgpos())
+    if g.Win32: about.iconbitmap(&quot;wsjt.ico&quot;)
+    t=&quot;MAP65 Version &quot; + Version + &quot;, by K1JT&quot;
+    Label(about,text=t,font=(font1,16)).pack(padx=20,pady=5)
+    t=&quot;&quot;&quot;
+MAP65 is a weak signal communications program designed primarily
+for the Earth-Moon-Earth (EME) propagation path.
+
+Copyright (c) 2001-2006 by Joseph H. Taylor, Jr., K1JT, with
+contributions from additional authors.  MAP65 is Open Source 
+software, licensed under the GNU General Public License (GPL).
+Source code and programming information may be found at 
+<A HREF="http://developer.berlios.de/projects/wsjt/.">http://developer.berlios.de/projects/wsjt/.</A>
+&quot;&quot;&quot;
+    Label(about,text=t,justify=LEFT).pack(padx=20)
+    t=&quot;Revision date: &quot; + \
+      &quot;$Date$&quot;[7:-1]
+    Label(about,text=t,justify=LEFT).pack(padx=20)
+    about.focus_set()
+
+#------------------------------------------------------ shortcuts
+def shortcuts(event=NONE):
+    scwid=Toplevel(root)
+    scwid.geometry(msgpos())
+    if g.Win32: scwid.iconbitmap(&quot;wsjt.ico&quot;)
+    t=&quot;&quot;&quot;
+F1	List keyboard shortcuts
+Shift+F1	List special mouse commands
+Ctrl+F1	About MAP65
+F2	Options
+F3	Tx Mute
+F4	Clear &quot;To Radio&quot;
+F5	What message to send?
+F6	Open next file in directory
+Shift+F6	Decode all wave files in directory
+F7	Set FSK441 mode
+Shift+F7	Set JT6M mode
+F8	Set JT65A mode
+Shift+F8	Set JT65B mode
+Ctrl+F8	Set JT65C mode
+Shift+Ctrl+F8	Set CW mode
+F10	Show SpecJT
+Shift+F10   Show astronomical data
+Alt+1 to Alt+6	Tx1 to Tx6
+Alt+A	Toggle Auto On/Off
+Alt+D	Decode
+Alt+E	Erase
+Alt+F	Toggle Freeze
+Alt+G	Generate Standard Messages
+Ctrl+G	Generate Alternate JT65 Messages
+Alt+I	Include
+Alt+L	Lookup
+Ctrl+L	Lookup, then Generate Standard Messages
+Alt+M	Monitor
+Alt+O	Tx Stop
+Alt+Q	Log QSO
+Alt+S	Stop Monitoring or Decoding
+Alt+V	Save Last
+Alt+X	Exclude
+Alt+Z	Toggle Zap
+Right/Left Arrow	Increase/decrease Freeze DF
+&quot;&quot;&quot;
+    Label(scwid,text=t,justify=LEFT).pack(padx=20)
+    scwid.focus_set()
+
+#------------------------------------------------------ mouse_commands
+def mouse_commands(event=NONE):
+    scwid=Toplevel(root)
+    scwid.geometry(msgpos())
+    if g.Win32: scwid.iconbitmap(&quot;wsjt.ico&quot;)
+    t=&quot;&quot;&quot;
+Click on          Action
+--------------------------------------------------------
+Waterfall        FSK441/JT6M: click to decode ping
+                      JT65: Click to set DF for Freeze
+                       Double-click to Freeze and Decode
+
+Main screen,     FSK441/JT6M: click to decode ping
+graphics area    JT65: Click to set DF for Freeze
+                           Double-click to Freeze and Decode
+
+Main screen,     Double-click puts callsign in Tx messages
+text area           Right-double-click also sets Auto ON
+
+Sync, Clip,      Left/Right click to increase/decrease
+Tol, ...
+&quot;&quot;&quot;
+    Label(scwid,text=t,justify=LEFT).pack(padx=20)
+    scwid.focus_set()
+
+#------------------------------------------------------ what2send
+def what2send(event=NONE):
+    screenf5=Toplevel(root)
+    screenf5.geometry(root_geom[root_geom.index(&quot;+&quot;):])
+    if g.Win32: screenf5.iconbitmap(&quot;wsjt.ico&quot;)
+    t=&quot;&quot;&quot;
+To optimize your chances of completing a valid QSO using WSJT,
+use the following standard procedures and *do not* exchange pertinent
+information by other means (e.g., internet, telephone, ...) while the
+QSO is in progress!
+
+FSK441 or JT6M:   If you have received
+    ... less than both calls from the other station, send both calls.
+    ... both calls, send both calls and your signal report.
+    ... both calls and signal report, send R and your report.
+    ... R plus signal report, send RRR.
+    ... RRR, the QSO is complete.  However, the other station may not
+know this, so it is conventional to send 73 to signify that you are done.
+
+(Outside of North America, the customary procedures for FSK441
+and JT6M may be slightly different.)
+
+
+JT65:   If you have received
+    ... less than both calls, send both calls and your grid locator.
+    ... both calls, send both calls, your grid locator, and OOO.
+    ... both calls and OOO, send RO.
+    ... RO, send RRR.
+    ... RRR, the QSO is complete.  However, the other station may not
+know this, so it is conventional to send 73 to signify that you are done.
+
+(Sending grid locators is conventional in JT65, but numerical signal
+reports may be substituted.)
+&quot;&quot;&quot;
+    Label(screenf5,text=t,justify=LEFT).pack(padx=20)
+    screenf5.focus_set()
+
+#------------------------------------------------------ prefixes
+def prefixes(event=NONE):
+    pfx=Toplevel(root)
+    pfx.geometry(msgpos())
+    if g.Win32: pfx.iconbitmap(&quot;wsjt.ico&quot;)
+    f=open(appdir+'/prefixes.txt','r')
+    s=f.readlines()
+    t2=&quot;&quot;
+    for i in range(4):
+        t2=t2+s[i]
+    t=&quot;&quot;
+    for i in range(len(s)-4):
+        t=t+s[i+4]
+    t=t.split()
+    t.sort()
+    t1=&quot;&quot;
+    n=0
+    for i in range(len(t)):
+        t1=t1+t[i]+&quot;  &quot;
+        n=n+len(t[i])+2
+        if n&gt;60:
+            t1=t1+&quot;\n&quot;
+            n=0
+    t1=t1+&quot;\n&quot;
+    if options.addpfx.get().lstrip():
+        t1=t1+&quot;\nOptional prefix:  &quot;+(options.addpfx.get().lstrip()+'    ')[:8]
+    t2=t2+&quot;\n&quot;+t1
+    Label(pfx,text=t2,justify=LEFT).pack(padx=20)
+    pfx.focus_set()
+
+#------------------------------------------------------ azdist
+def azdist():
+    if len(HisGrid.get().strip())&lt;4:
+        labAz.configure(text=&quot;&quot;)
+        labHotAB.configure(text=&quot;&quot;,bg='gray85')
+        labDist.configure(text=&quot;&quot;)
+    else:
+        if mode.get()[:4]==&quot;JT65&quot; or mode.get()[:2]==&quot;CW&quot;:
+            labAz.configure(text=&quot;Az: %d&quot; % (naz,))
+            labHotAB.configure(text=&quot;&quot;,bg='gray85')
+        else:
+            labAz.configure(text=&quot;Az: %d   El: %d&quot; % (naz,nel))
+            if nhotabetter:
+                labHotAB.configure(text=&quot;Hot A: &quot;+str(nhotaz),bg='#FF9900')
+            else:
+                labHotAB.configure(text=&quot;Hot B: &quot;+str(nhotaz),bg='#FF9900')
+        if options.mileskm.get()==0:
+            labDist.configure(text=str(ndmiles)+&quot; mi&quot;)
+        else:
+            labDist.configure(text=str(int(1.609344*ndmiles))+&quot; km&quot;)
+    
+#------------------------------------------------------ incsync
+def incsync(event):
+    global isync
+    if isync&lt;10:
+        isync=isync+1
+        lsync.configure(text=slabel+str(isync))
+
+#------------------------------------------------------ decsync
+def decsync(event):
+    global isync
+    if isync&gt;-30:
+        isync=isync-1
+        lsync.configure(text=slabel+str(isync))
+
+#------------------------------------------------------ incclip
+def incclip(event):
+    global iclip
+    if iclip&lt;5:
+        iclip=iclip+1
+        if iclip==5: iclip=99
+        lclip.configure(text='Clip   '+str(iclip))
+
+#------------------------------------------------------ decclip
+def decclip(event):
+    global iclip
+    if iclip&gt;-5:
+        iclip=iclip-1
+        if iclip==98: iclip=4
+        lclip.configure(text='Clip   '+str(iclip))
+
+#------------------------------------------------------ inctol
+def inctol(event=NONE):
+    global itol
+    maxitol=5
+    if mode.get()[:4]=='JT65':
+        maxitol=6
+    if itol&lt;maxitol: itol=itol+1
+    ltol.configure(text='Tol    '+str(ntol[itol]))
+
+#------------------------------------------------------ dectol
+def dectol(event):
+    global itol
+    if itol&gt;0 : itol=itol-1
+    ltol.configure(text='Tol    '+str(ntol[itol]))
+
+#------------------------------------------------------ incdsec
+def incdsec(event):
+    global idsec
+    idsec=idsec+5
+    bg='red'
+    if idsec==0: bg='white'
+    ldsec.configure(text='Dsec  '+str(0.1*idsec),bg=bg)
+    Audio.gcom1.ndsec=idsec
+
+#------------------------------------------------------ decdsec
+def decdsec(event):
+    global idsec
+    idsec=idsec-5
+    bg='red'
+    if idsec==0: bg='white'
+    ldsec.configure(text='Dsec  '+str(0.1*idsec),bg=bg)
+    Audio.gcom1.ndsec=idsec
+
+#------------------------------------------------------ toggle_shift
+def toggle_shift(event):
+    Audio.gcom2.nadd5=1-Audio.gcom2.nadd5
+    if Audio.gcom2.nadd5:
+        bg='red'
+        lshift.configure(text='Shift 5.0',bg=bg)
+    else:
+        bg='white'
+        lshift.configure(text='Shift 0.0',bg=bg)
+
+#------------------------------------------------------ inctrperiod
+def inctrperiod(event):
+    global ncwtrperiod
+    if mode.get()[:2]==&quot;CW&quot;:
+        if ncwtrperiod==120: ncwtrperiod=150
+        if ncwtrperiod==60:  ncwtrperiod=120
+        Audio.gcom1.trperiod=ncwtrperiod
+
+#------------------------------------------------------ dectrperiod
+def dectrperiod(event):
+    global ncwtrperiod
+    if mode.get()[:2]==&quot;CW&quot;:
+        if ncwtrperiod==120: ncwtrperiod=60
+        if ncwtrperiod==150: ncwtrperiod=120
+        Audio.gcom1.trperiod=ncwtrperiod
+
+#------------------------------------------------------ erase
+def erase(event=NONE):
+    graph1.delete(ALL)
+    if mode.get()[:4]!=&quot;JT65&quot; and mode.get()[:2]!=&quot;CW&quot;: graph2.delete(ALL)
+    text.configure(state=NORMAL)
+    text.delete('1.0',END)
+    text.configure(state=DISABLED)
+    avetext.configure(state=NORMAL)
+    avetext.delete('1.0',END)
+    avetext.configure(state=DISABLED)
+    lab3.configure(text=&quot; &quot;)
+    Audio.gcom2.decodedfile=&quot;                        &quot;
+#------------------------------------------------------ clear_avg
+def clear_avg(event=NONE):
+    avetext.configure(state=NORMAL)
+    avetext.delete('1.0',END)
+    avetext.configure(state=DISABLED)
+    f=open(appdir+'/decoded.ave',mode='w')
+    f.truncate(0)                           #Delete contents of decoded.ave
+    f.close()
+    Audio.gcom2.nclearave=1
+
+#------------------------------------------------------ defaults
+def defaults():
+    global slabel,isync,iclip,itol,idsec
+    isync=1
+    if g.mode==&quot;FSK441&quot;: isync=2
+    iclip=0
+    lclip.configure(text='Clip   '+str(iclip))
+    itol=5
+    ltol.configure(text='Tol    '+str(ntol[itol]))
+    if g.mode==&quot;JT6M&quot;:
+        isync=-10
+        itol=4
+        ltol.configure(text='Tol    '+str(ntol[itol]))
+    lsync.configure(text=slabel+str(isync))
+
+#------------------------------------------------------ delwav
+def delwav():
+    t=&quot;Are you sure you want to delete\nall *.WAV files in the RxWav directory?&quot;
+    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),message_text=t)
+    msg.geometry(msgpos())
+    if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
+    msg.focus_set()
+    result=msg.activate()
+    if result == 'Yes':
+# Make a list of *.wav files in RxWav
+        la=dircache.listdir(appdir+'/RxWav')
+        lb=[]
+        for i in range(len(la)):
+            j=la[i].find(&quot;.wav&quot;) + la[i].find(&quot;.WAV&quot;)
+            if j&gt;0: lb.append(la[i])
+# Now delete them all.
+        for i in range(len(lb)):
+            fname=appdir+'/RxWav/'+lb[i]
+            os.remove(fname)
+
+#------------------------------------------------------ del_all
+def del_all():
+    Audio.gcom1.ns0=-999999
+
+#------------------------------------------------------ toggleauto
+def toggleauto(event=NONE):
+    global lauto
+    lauto=1-lauto
+    Audio.gcom2.lauto=lauto
+    if lauto:
+        monitor()
+    else:
+        Audio.gcom1.txok=0
+        Audio.gcom2.mantx=0
+    if lauto==0: auto.configure(text='Auto is OFF',bg='gray85',relief=RAISED)
+    if lauto==1: auto.configure(text='Auto is ON',bg='red',relief=SOLID)
+    
+#----------------------------------------------------- dtdf_change
+# Readout of graphical cursor location
+def dtdf_change(event):
+    if mode.get()[:4]!=&quot;JT65&quot;:
+        t=&quot;%.1f&quot; % (event.x*30.0/500.0,)
+        lab6.configure(text=t,bg='green')
+    else:
+        if event.y&lt;40 and Audio.gcom2.nspecial==0:
+            lab1.configure(text='Time (s)',bg=&quot;#33FFFF&quot;)   #light blue
+            t=&quot;%.1f&quot; % (12.0*event.x/500.0-2.0,)
+            lab6.configure(text=t,bg=&quot;#33FFFF&quot;)
+        elif (event.y&gt;=40 and event.y&lt;95) or \
+                 (event.y&lt;95 and Audio.gcom2.nspecial&gt;0):
+            lab1.configure(text='DF (Hz)',bg='red')
+            idf=Audio.gcom2.idf
+            t=&quot;%d&quot; % int(idf+1200.0*event.x/500.0-600.0,)
+            lab6.configure(text=t,bg=&quot;red&quot;)
+        else:
+            lab1.configure(text='Time (s)',bg='green')
+            t=&quot;%.1f&quot; % (53.0*event.x/500.0,)
+            lab6.configure(text=t,bg=&quot;green&quot;)
+
+#---------------------------------------------------- mouse_click_g1
+def mouse_click_g1(event):
+    global nopen
+    if not nopen:
+        if mode.get()[:4]==&quot;JT65&quot;:
+            Audio.gcom2.mousedf=int(Audio.gcom2.idf+(event.x-250)*2.4)
+        else:
+            if Audio.gcom2.ndecoding==0:              #If decoder is busy, ignore
+                Audio.gcom2.nagain=1
+                Audio.gcom2.mousebutton=event.num     #Left=1, Right=3
+                Audio.gcom2.npingtime=int(195+60*event.x) #Time (ms) of mouse-picked ping
+                if Audio.gcom2.ndecoding0==4:
+                    Audio.gcom2.ndecoding=4           #Decode from recorded file
+                elif Audio.gcom2.ndecoding0==1:
+                    Audio.gcom2.ndecoding=5        #Decode data in main screen
+    nopen=0
+
+#------------------------------------------------------ double-click_g1
+def double_click_g1(event):
+    if g.mode[:4]=='JT65' and Audio.gcom2.ndecoding==0:
+        g.freeze_decode=1
+    
+#------------------------------------------------------ mouse_up_g1
+def mouse_up_g1(event):
+#    print event.x
+    pass
+
+#------------------------------------------------------ right_arrow
+def right_arrow(event=NONE):
+    n=5*int(Audio.gcom2.mousedf/5) + 5
+    if n==Audio.gcom2.mousedf: n=n+5
+    Audio.gcom2.mousedf=n
+
+#------------------------------------------------------ left_arrow
+def left_arrow(event=NONE):
+    n=5*int(Audio.gcom2.mousedf/5)
+    if n==Audio.gcom2.mousedf: n=n-5
+    Audio.gcom2.mousedf=n
+    
+#------------------------------------------------------ GenStdMsgs
+def GenStdMsgs(event=NONE):
+    global altmsg
+    t=ToRadio.get().upper().strip()
+    ToRadio.delete(0,99)
+    ToRadio.insert(0,t)
+    if k2txb.get()!=0: ntx.set(1)
+    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
+    for m in (tx1, tx2, tx3, tx4, tx5, tx6):
+        m.delete(0,99)
+    if mode.get()==&quot;FSK441&quot; or mode.get()==&quot;JT6M&quot;:
+        r=report.get()
+        tx1.insert(0,setmsg(options.tx1.get(),r))
+        tx2.insert(0,setmsg(options.tx2.get(),r))
+        tx3.insert(0,setmsg(options.tx3.get(),r))
+        tx4.insert(0,setmsg(options.tx4.get(),r))
+        tx5.insert(0,setmsg(options.tx5.get(),r))
+        tx6.insert(0,setmsg(options.tx6.get(),r))
+    elif mode.get()[:4]==&quot;JT65&quot;:
+        if ToRadio.get().find(&quot;/&quot;) == -1 and \
+               options.MyCall.get().find(&quot;/&quot;) == -1:
+            t=ToRadio.get() + &quot; &quot;+options.MyCall.get() + &quot; &quot;+options.MyGrid.get()[:4]
+            tx1.insert(0,t.upper())
+        else:
+            tx1.insert(0,ToRadio.get() + &quot; &quot;+options.MyCall.get())
+        tx2.insert(0,tx1.get()+&quot; OOO&quot;)
+        tx3.insert(0,&quot;RO&quot;)
+        tx4.insert(0,&quot;RRR&quot;)
+        tx5.insert(0,&quot;73&quot;)
+        t=&quot;CQ &quot; + options.MyCall.get()+ &quot; &quot;+options.MyGrid.get()[:4]
+        tx6.insert(0,t.upper())
+        altmsg=0
+    elif mode.get()[:2]==&quot;CW&quot;:
+        tx1.insert(0,ToRadio.get() + &quot; &quot;+options.MyCall.get())
+        tx2.insert(0,tx1.get()+&quot; OOO&quot;)
+        tx3.insert(0,tx1.get()+&quot; RO&quot;)
+        tx4.insert(0,tx1.get()+&quot; RRR&quot;)
+        tx5.insert(0,tx1.get()+&quot; 73&quot;)
+        tx6.insert(0,&quot;CQ &quot; + options.MyCall.get())
+    
+#------------------------------------------------------ GenAltMsgs
+def GenAltMsgs(event=NONE):
+    global altmsg,tx6alt
+    t=ToRadio.get().upper().strip()
+    ToRadio.delete(0,99)
+    ToRadio.insert(0,t)
+    if k2txb.get()!=0: ntx.set(1)
+    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
+    if mode.get()[:4]==&quot;JT65&quot; and ToRadio.get().find(&quot;/&quot;) == -1 and \
+               options.MyCall.get().find(&quot;/&quot;) == -1:
+        for m in (tx1, tx2, tx3, tx4, tx5, tx6):
+            m.delete(0,99)
+        t=ToRadio.get() + &quot; &quot;+options.MyCall.get()
+        tx1.insert(0,t.upper())
+        tx2.insert(0,tx1.get()+&quot; OOO&quot;)
+        tx3.insert(0,tx1.get()+&quot; RO&quot;)
+        tx4.insert(0,tx1.get()+&quot; RRR&quot;)
+        tx5.insert(0,&quot;TNX 73 GL &quot;)
+        tx6.insert(0,tx6alt.upper())
+        altmsg=1
+
+#------------------------------------------------------ setmsg
+def setmsg(template,r):
+    msg=&quot;&quot;
+    npct=0
+    for i in range(len(template)):
+        if npct:
+            if template[i]==&quot;M&quot;: msg=msg+options.MyCall.get().upper().strip()
+            if template[i]==&quot;T&quot;: msg=msg+ToRadio.get().upper().strip()
+            if template[i]==&quot;R&quot;: msg=msg+r
+            if template[i]==&quot;G&quot;: msg=msg+options.MyGrid.get()[:4]
+            if template[i]==&quot;L&quot;: msg=msg+options.MyGrid.get()
+            npct=0
+        else:
+            npct=0
+            if template[i]==&quot;%&quot;:
+                npct=1
+            else:
+                msg=msg+template[i]            
+    return msg.upper()
+    
+#------------------------------------------------------ plot_large
+def plot_large():
+    &quot;Plot the green, red, and blue curves in JT65 mode.&quot;
+    graph1.delete(ALL)
+    y=[]
+    ngreen=Audio.gcom2.ngreen
+    if ngreen&gt;0:
+        for i in range(ngreen):             #Find ymax for green curve
+            green=Audio.gcom2.green[i]
+            y.append(green)
+        ymax=max(y)
+        if ymax&lt;1: ymax=1
+        yfac=4.0
+        if ymax&gt;75.0/yfac: yfac=75.0/ymax
+        xy=[]
+        for i in range(ngreen):             #Make xy list for green curve
+            green=Audio.gcom2.green[i]
+            n=int(105.0-yfac*green)
+            xy.append(i)
+            xy.append(n)
+        graph1.create_line(xy,fill=&quot;green&quot;)
+
+        if Audio.gcom2.nspecial==0:
+            y=[]
+            for i in range(446):                #Find ymax for red curve
+                psavg=Audio.gcom2.psavg[i+1]
+                y.append(psavg)
+            ymax=max(y)
+            yfac=30.0
+            if ymax&gt;85.0/yfac: yfac=85.0/ymax
+            xy=[]
+            fac=500.0/446.0
+            for i in range(446):                #Make xy list for red curve
+                x=i*fac
+                psavg=Audio.gcom2.psavg[i+1]
+                n=int(90.0-yfac*psavg)
+                xy.append(x)
+                xy.append(n)
+            graph1.create_line(xy,fill=&quot;red&quot;)
+        else:
+            y1=[]
+            y2=[]
+            for i in range(446):        #Find ymax for magenta/orange curves
+                ss1=Audio.gcom2.ss1[i+1]
+                y1.append(ss1)
+                ss2=Audio.gcom2.ss2[i+1]
+                y2.append(ss2)
+            ymax=max(y1+y2)
+            yfac=30.0
+            if ymax&gt;85.0/yfac: yfac=85.0/ymax
+            xy1=[]
+            xy2=[]
+            fac=500.0/446.0
+            for i in range(446):        #Make xy list for magenta/orange curves
+                x=i*fac
+                ss1=Audio.gcom2.ss1[i+1]
+                n=int(90.0-yfac*ss1)
+                xy1.append(x)
+                xy1.append(n)
+                ss2=Audio.gcom2.ss2[i+1]
+                n=int(90.0-yfac*ss2) - 20
+                xy2.append(x)
+                xy2.append(n)
+            graph1.create_line(xy1,fill=&quot;magenta&quot;)
+            graph1.create_line(xy2,fill=&quot;orange&quot;)
+
+            x1 = 250.0 + fac*Audio.gcom2.ndf/2.6916504
+            x2 = x1 + Audio.gcom2.mode65*Audio.gcom2.nspecial*10*fac
+            graph1.create_line([x1,85,x1,95],fill=&quot;yellow&quot;)
+            graph1.create_line([x2,85,x2,95],fill=&quot;yellow&quot;)
+            t=&quot;RO&quot;
+            if Audio.gcom2.nspecial==3: t=&quot;RRR&quot;
+            if Audio.gcom2.nspecial==4: t=&quot;73&quot;
+            graph1.create_text(x2+3,93,anchor=W,text=t,fill=&quot;yellow&quot;)
+
+        if Audio.gcom2.ccf[0] != -9999.0:
+            y=[]
+            for i in range(65):             #Find ymax for blue curve
+                ccf=Audio.gcom2.ccf[i]
+                y.append(ccf)
+            ymax=max(y)
+            yfac=40.0
+            if ymax&gt;55.0/yfac: yfac=55.0/ymax
+            xy2=[]
+            fac=500.0/64.6
+            for i in range(65):             #Make xy list for blue curve
+                x=(i+0.5)*fac
+                ccf=Audio.gcom2.ccf[i]
+                n=int(60.0-yfac*ccf)
+                xy2.append(x)
+                xy2.append(n)
+            graph1.create_line(xy2,fill='#33FFFF')
+
+#  Put in the tick marks
+        for i in range(13):
+            x=int(i*41.667)
+            j2=115
+            if i==1 or i==6 or i==11: j2=110
+            graph1.create_line([x,j2,x,125],fill=&quot;red&quot;)
+            if Audio.gcom2.nspecial==0:
+#                x=int((i-0.8)*41.667)
+                j1=9
+                if i==2 or i==7 or i==12: j1=14
+                graph1.create_line([x,0,x,j1],fill=&quot;#33FFFF&quot;)  #light blue
+            else:
+                graph1.create_line([x,0,x,125-j2],fill=&quot;red&quot;)
+
+#------------------------------------------------------ plot_small
+def plot_small():        
+    graph2.delete(ALL)
+    xy=[]
+    xy2=[]
+    df=11025.0/256.0
+    fac=150.0/3500.0
+    for i in range(81):
+        x=int(i*df*fac)
+        xy.append(x)
+        psavg=Audio.gcom2.psavg[i]
+        if mode.get()==&quot;JT6M&quot;: psavg=psavg + 27.959
+        n=int(150.0-2*psavg)
+        xy.append(n)
+        if mode.get()=='FSK441':    
+            ps0=Audio.gcom2.ps0[i]
+            n=int(150.0-2*ps0)
+            xy2.append(x)
+            xy2.append(n)
+    graph2.create_line(xy,fill=&quot;magenta&quot;)
+    if mode.get()=='JT6M':
+        plot_yellow()
+    elif mode.get()=='FSK441':
+        graph2.create_line(xy2,fill=&quot;red&quot;)
+        for i in range(4):
+            x=(i+2)*441*fac
+            graph2.create_line([x,0,x,20],fill=&quot;yellow&quot;)
+    for i in range(7):
+        x=i*500*fac
+        ytop=110
+        if i%2: ytop=115
+        graph2.create_line([x,120,x,ytop],fill=&quot;white&quot;)
+
+#------------------------------------------------------ plot_yellow
+def plot_yellow():
+    nz=int(Audio.gcom2.ps0[215])
+    if nz&gt;10:
+        y=[]
+        for i in range(nz):             #Find ymax for yellow curve
+            n=Audio.gcom2.ps0[i]
+            y.append(n)
+        ymax=max(y)
+        fac=1.0
+        if ymax&gt;60: fac=60.0/ymax
+        xy2=[]
+        for i in range(nz):
+            x=int(2.34*i)
+            y=fac*Audio.gcom2.ps0[i] + 8
+            n=int(85.0-y)
+            xy2.append(x)
+            xy2.append(n)
+        graph1.create_line(xy2,fill=&quot;yellow&quot;)
+
+#------------------------------------------------------ bandmap
+def bandmap(event=NONE):
+    global Version,bm,bm_geom
+    bm=Toplevel(root)
+    bm.geometry(bm_geom)
+    if g.Win32: bm.iconbitmap(&quot;wsjt.ico&quot;)
+    iframe_bm1 = Frame(bm, bd=1, relief=SUNKEN)
+    text=Text(iframe_bm1, height=35, width=30, bg=&quot;Navy&quot;)
+    text.pack(side=LEFT, fill=X, padx=1)
+    text.pack(side=LEFT, fill=X, padx=1)
+    sb = Scrollbar(iframe_bm1, orient=VERTICAL, command=text.yview)
+    sb.pack(side=RIGHT, fill=Y)
+    text.configure(yscrollcommand=sb.set)
+    iframe_bm1.pack(expand=1, fill=X, padx=4)
+
+#------------------------------------------------------ update
+def update():
+    global root_geom,isec0,naz,nel,ndmiles,ndkm,nhotaz,nhotabetter,nopen, \
+           im,pim,cmap0,isync,isync441,isync6m,isync65,isync_save,idsec, \
+           first,itol,txsnrdb,tx6alt,bm_geom
+    
+    utc=time.gmtime(time.time()+0.1*idsec)
+    isec=utc[5]
+
+    if isec != isec0:                           #Do once per second
+        isec0=isec
+        t=time.strftime('%Y %b %d\n%H:%M:%S',utc)
+        Audio.gcom2.utcdate=t[:12]
+        ldate.configure(text=t)
+        root_geom=root.geometry()
+        bm_geom=bm.geometry()
+        utchours=utc[3]+utc[4]/60.0 + utc[5]/3600.0
+        naz,nel,ndmiles,ndkm,nhotaz,nhotabetter=Audio.azdist0( \
+            options.MyGrid.get().upper(),HisGrid.get().upper(),utchours)
+        azdist()
+        g.nfreq=nfreq.get()
+
+        if Audio.gcom2.ndecoding==0:
+            g.AzSun,g.ElSun,g.AzMoon,g.ElMoon,g.AzMoonB,g.ElMoonB,g.ntsky, \
+                g.ndop,g.ndop00,g.dbMoon,g.RAMoon,g.DecMoon,g.HA8,g.Dgrd,  \
+                g.sd,g.poloffset,g.MaxNR,g.dfdt,g.dfdt0,g.RaAux,g.DecAux, \
+                g.AzAux,g.ElAux = Audio.astro0(utc[0],utc[1],utc[2],  \
+                utchours,nfreq.get(),options.MyGrid.get().upper(), \
+                    options.auxra.get()+'         '[:9],     \
+                    options.auxdec.get()+'         '[:9])
+
+            if len(HisGrid.get().strip())&lt;4:
+                g.ndop=g.ndop00
+                g.dfdt=g.dfdt0
+
+        if mode.get()[:4]=='JT65' or mode.get()[:2]=='CW' :
+            graph2.delete(ALL)
+            graph2.create_text(80,13,anchor=CENTER,text=&quot;Moon&quot;,font=g2font)
+            graph2.create_text(13,37,anchor=W, text=&quot;Az: %6.2f&quot; % g.AzMoon,font=g2font)
+            graph2.create_text(13,61,anchor=W, text=&quot;El: %6.2f&quot; % g.ElMoon,font=g2font)
+            graph2.create_text(13,85,anchor=W, text=&quot;Dop:%6d&quot; % g.ndop,font=g2font)
+            graph2.create_text(13,109,anchor=W,text=&quot;Dgrd:%5.1f&quot; % g.Dgrd,font=g2font)
+
+    if g.freeze_decode and mode.get()[:4]=='JT65':
+        itol=2
+        ltol.configure(text='Tol    '+str(50))
+        Audio.gcom2.dftolerance=50
+        nfreeze.set(1)
+        Audio.gcom2.nfreeze=1
+        if Audio.gcom2.monitoring:
+            Audio.gcom2.ndecoding=1
+            Audio.gcom2.nagain=0
+        else:
+            Audio.gcom2.ndecoding=4
+            Audio.gcom2.nagain=1
+        g.freeze_decode=0
+        
+    n=int(20.0*log10(g.rms/770.0+0.01))
+    t=&quot;Rx noise:%3d dB&quot; % (n,)
+    if n&gt;=-10 and n&lt;=10:
+        msg4.configure(text=t,bg='gray85')
+    else:
+        msg4.configure(text=t,bg='red')
+
+    t=g.ftnstr(Audio.gcom2.decodedfile)
+#    i=t.rfind(&quot;.&quot;)
+    i=g.rfnd(t,&quot;.&quot;)
+    t=t[:i]
+    lab3.configure(text=t)
+    if mode.get() != g.mode or first:
+        if mode.get()==&quot;FSK441&quot;:
+            msg2.configure(bg='yellow')
+        elif mode.get()==&quot;JT65A&quot; or mode.get()==&quot;JT65B&quot; or mode.get()==&quot;JT65C&quot;:
+            msg2.configure(bg='#00FFFF')
+        elif mode.get()==&quot;JT6M&quot;:
+            msg2.configure(bg='#FF00FF')
+        elif mode.get()==&quot;CW&quot;:
+            msg2.configure(bg='#00FF00')
+#        elif mode.get()==&quot;Echo&quot;:
+#            msg2.configure(bg='#FF0000')
+        g.mode=mode.get()
+        first=0
+
+    samfac_in=Audio.gcom1.mfsample/110250.0
+    samfac_out=Audio.gcom1.mfsample2/110250.0
+    xin=1
+    xout=1
+    try:
+        xin=samfac_in/options.samfacin.get()
+        xout=samfac_out/options.samfacout.get()
+        if xin&lt;0.999 or xin&gt;1.001 or xout&lt;0.999 or xout&gt;1.001:
+            lab8.configure(text=&quot;%6.4f   %6.4f&quot; \
+                % (options.samfacin.get(),options.samfacout.get()), \
+                fg='black',bg='red')
+        else:
+            lab8.configure(fg='gray85',bg='gray85')
+    except:
+        pass
+
+    msg1.configure(text=&quot;%6.4f %6.4f&quot; % (samfac_in,samfac_out))
+    msg2.configure(text=mode.get())
+    t=&quot;Freeze DF:%4d&quot; % (int(Audio.gcom2.mousedf),)
+    if abs(int(Audio.gcom2.mousedf))&gt;600:
+        msg3.configure(text=t,fg='black',bg='red')
+    else:
+        msg3.configure(text=t,fg='black',bg='gray85')    
+    bdecode.configure(bg='gray85',activebackground='gray95')
+    if Audio.gcom2.ndecoding:       #Set button bg=light_blue while decoding
+        bdecode.configure(bg='#66FFFF',activebackground='#66FFFF')
+    if mode.get()[:2]==&quot;CW&quot;:
+        msg5.configure(text=&quot;TR Period: %d s&quot; % (Audio.gcom1.trperiod,), \
+                       bg='white')
+    else:
+        msg5.configure(text=&quot;TR Period: %d s&quot; % (Audio.gcom1.trperiod,), \
+                       bg='gray85')
+
+    tx1.configure(bg='white')
+    tx2.configure(bg='white')
+    tx3.configure(bg='white')
+    tx4.configure(bg='white')
+    tx5.configure(bg='white')
+    tx6.configure(bg='white')
+    if tx6.get()[:1]=='#':
+        try:
+            txsnrdb=float(tx6.get()[1:])
+            if txsnrdb&gt;-99.0 and txsnrdb&lt;40.0:
+                Audio.gcom1.txsnrdb=txsnrdb
+                tx6.configure(bg='orange')
+        except:
+            txsnrdb=99.0
+    else:
+        txsnrdb=99.0
+        Audio.gcom1.txsnrdb=txsnrdb
+    if Audio.gcom2.monitoring and not Audio.gcom1.transmitting:
+        bmonitor.configure(bg='green')
+    else:
+        bmonitor.configure(bg='gray85')    
+    if Audio.gcom1.transmitting:
+        nmsg=int(Audio.gcom2.nmsg)
+        t=g.ftnstr(Audio.gcom2.sending)
+        if t[:3]==&quot;CQ &quot;: nsked.set(0)
+        t=&quot;Txing:  &quot;+t[:nmsg]
+        bgcolor='yellow'
+        if Audio.gcom2.sendingsh==1:  bgcolor='#66FFFF'    #Shorthand (lt blue)
+        if Audio.gcom2.sendingsh==-1: bgcolor='red'        #Plain Text
+        if Audio.gcom2.sendingsh==2: bgcolor='pink'        #Test file
+        if txsnrdb&lt;90.0: bgcolor='orange'                  #Simulation mode
+        if Audio.gcom2.ntxnow==1: tx1.configure(bg=bgcolor)
+        elif Audio.gcom2.ntxnow==2: tx2.configure(bg=bgcolor)
+        elif Audio.gcom2.ntxnow==3: tx3.configure(bg=bgcolor)
+        elif Audio.gcom2.ntxnow==4: tx4.configure(bg=bgcolor)
+        elif Audio.gcom2.ntxnow==5: tx5.configure(bg=bgcolor)
+        else: tx6.configure(bg=bgcolor)
+    else:
+        bgcolor='green'
+        t='Receiving'
+    msg7.configure(text=t,bg=bgcolor)
+
+    if Audio.gcom2.ndecdone==1 or g.cmap != cmap0:
+        if Audio.gcom2.ndecdone==1:
+            if isync==-99 or isync==99:
+                isync=isync_save
+                Audio.gcom2.minsigdb=isync
+            try:
+                f=open(appdir+'/decoded.txt',mode='r')
+                lines=f.readlines()
+                f.close()
+            except:
+                lines=&quot;&quot;
+            text.configure(state=NORMAL)
+            for i in range(len(lines)):
+                text.insert(END,lines[i])
+            text.see(END)
+#            text.configure(state=DISABLED)
+
+            if mode.get()[:4]=='JT65':
+                try:
+                    f=open(appdir+'/decoded.ave',mode='r')
+                    lines=f.readlines()
+                    f.close()
+                except:
+                    lines[0]=&quot;&quot;
+                    lines[1]=&quot;&quot;
+                avetext.configure(state=NORMAL)
+                avetext.delete('1.0',END)
+                if len(lines)&gt;1:
+                    avetext.insert(END,lines[0])
+                    avetext.insert(END,lines[1])
+#                avetext.configure(state=DISABLED)
+            Audio.gcom2.ndecdone=2
+        
+        if g.cmap != cmap0:
+            im.putpalette(g.palette)
+            cmap0=g.cmap
+
+        if mode.get()[:4]=='JT65':
+            plot_large()
+        else:    
+            im.putdata(Audio.gcom2.b)
+            pim=ImageTk.PhotoImage(im)          #Convert Image to PhotoImage
+            graph1.delete(ALL)
+# NB: top two lines are probably invisible ...
+            graph1.create_image(0,0,anchor='nw',image=pim)
+            t=g.filetime(g.ftnstr(Audio.gcom2.decodedfile))
+            graph1.create_text(100,80,anchor=W,text=t,fill=&quot;white&quot;)
+            plot_small()
+        if loopall: opennext()
+        nopen=0
+
+# Save some parameters
+    g.mode=mode.get()
+    g.report=report.get()
+    if mode.get()=='FSK441': isync441=isync
+    elif mode.get()=='JT6M': isync6m=isync
+    elif mode.get()[:4]=='JT65': isync65=isync
+    Audio.gcom1.txfirst=TxFirst.get()
+    try:
+        Audio.gcom1.samfacin=options.samfacin.get()
+    except:
+        Audio.gcom1.samfacin=1.0
+    try:
+        Audio.gcom1.samfacout=options.samfacout.get()
+    except:
+        Audio.gcom1.samfacout=1.0
+#    if Audio.gcom1.samfacin&gt;1.01: Audio.gcom1.samfacin=1.01
+# ... etc.
+    Audio.gcom2.mycall=(options.MyCall.get()+'            ')[:12]
+    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
+    Audio.gcom2.hisgrid=(HisGrid.get()+'      ')[:6]
+    Audio.gcom4.addpfx=(options.addpfx.get().lstrip()+'        ')[:8]
+    Audio.gcom2.ntxreq=ntx.get()
+    tx=(tx1,tx2,tx3,tx4,tx5,tx6)
+    Audio.gcom2.txmsg=(tx[ntx.get()-1].get()+'                            ')[:28]
+    Audio.gcom2.mode=(mode.get()+'      ')[:6]
+    Audio.gcom2.shok=ShOK.get()
+    Audio.gcom2.nsave=nsave.get()
+    Audio.gcom2.nzap=nzap.get()
+    Audio.gcom2.ndebug=ndebug.get()
+    Audio.gcom2.minsigdb=isync
+    Audio.gcom2.nclip=iclip
+    Audio.gcom2.nblank=nblank.get()
+    Audio.gcom2.nafc=nafc.get()
+    Audio.gcom2.nfreeze=nfreeze.get()
+    Audio.gcom2.dftolerance=ntol[itol]
+    Audio.gcom2.neme=neme.get()
+    Audio.gcom2.ndepth=ndepth.get()
+    Audio.gcom2.nsked=nsked.get()
+    try:
+        Audio.gcom2.idinterval=options.IDinterval.get()
+    except:
+        Audio.gcom2.idinterval=0
+    Audio.gcom2.ntx2=0
+#    Audio.gcom1.rxdelay=float('0'+options.RxDelay.get())
+#    Audio.gcom1.txdelay=float('0'+options.TxDelay.get())
+    if ntx.get()==1 and noshjt65.get()==1: Audio.gcom2.ntx2=1
+    Audio.gcom2.nslim2=isync-4
+    if nosh441.get()==1 and mode.get()=='FSK441': Audio.gcom2.nslim2=99
+    try:
+        Audio.gcom2.nport=int(options.PttPort.get())
+    except:
+        Audio.gcom2.nport=0
+
+#    print 'About to init Audio.gcom2.PttPort in save some parameters'
+    Audio.gcom2.pttport=(options.PttPort.get() + '            ')[:12]
+#    print Audio.gcom2.pttport
+
+    if altmsg: tx6alt=tx6.get()    
+# Queue up the next update
+    ldate.after(100,update)
+    
+#------------------------------------------------------ Top level frame
+frame = Frame(root)
+
+#------------------------------------------------------ Menu Bar
+mbar = Frame(frame)
+mbar.pack(fill = X)
+
+#------------------------------------------------------ File Menu
+filebutton = Menubutton(mbar, text = 'File')
+filebutton.pack(side = LEFT)
+filemenu = Menu(filebutton, tearoff=0)
+filebutton['menu'] = filemenu
+filemenu.add('command', label = 'Open', command = openfile, \
+             accelerator='Ctrl+O')
+filemenu.add('command', label = 'Open next in directory', command = opennext, \
+             accelerator='F6')
+filemenu.add('command', label = 'Decode remaining files in directory', \
+             command = decodeall, accelerator='Shift+F6')
+filemenu.add_separator()
+filemenu.add('command', label = 'Delete all *.WAV files in RxWav', \
+             command = delwav)
+filemenu.add_separator()
+filemenu.add('command', label = 'Erase ALL.TXT', command = del_all)
+filemenu.add_separator()
+filemenu.add('command', label = 'Exit', command = quit)
+
+#------------------------------------------------------ Setup menu
+setupbutton = Menubutton(mbar, text = 'Setup')
+setupbutton.pack(side = LEFT)
+setupmenu = Menu(setupbutton, tearoff=0)
+setupbutton['menu'] = setupmenu
+setupmenu.add('command', label = 'Options', command = options1, \
+              accelerator='F2')
+setupmenu.add_separator()
+setupmenu.add('command', label = 'Toggle size of text window', command=textsize)
+setupmenu.add('command', label = 'Generate messages for test tones', command=testmsgs)
+setupmenu.add_separator()
+setupmenu.add_checkbutton(label = 'F4 sets Tx6',variable=kb8rq)
+setupmenu.add_checkbutton(label = 'Double-click on callsign sets TxFirst',
+                          variable=setseq)
+setupmenu.add_checkbutton(label = 'GenStdMsgs sets Tx1',variable=k2txb)
+setupmenu.add_separator()
+setupmenu.add_checkbutton(label = 'Enable diagnostics',variable=ndebug)
+
+#------------------------------------------------------ View menu
+viewbutton=Menubutton(mbar,text='View')
+viewbutton.pack(side=LEFT)
+viewmenu=Menu(viewbutton,tearoff=0)
+viewbutton['menu']=viewmenu
+viewmenu.add('command', label = 'SpecJT', command = showspecjt, \
+             accelerator='F10')
+viewmenu.add('command', label = 'Astronomical data', command = astro1, \
+             accelerator='Shift+F10')
+
+#------------------------------------------------------ Mode menu
+modebutton = Menubutton(mbar, text = 'Mode')
+modebutton.pack(side = LEFT)
+modemenu = Menu(modebutton, tearoff=0)
+modebutton['menu'] = modemenu
+modemenu.add_radiobutton(label = 'FSK441', variable=mode, \
+    command = ModeFSK441, state=NORMAL, accelerator='F7')
+
+# To enable menu item 0:
+# modemenu.entryconfig(0,state=NORMAL)
+# Can use the following to retrieve the state:
+# state=modemenu.entrycget(0,&quot;state&quot;)
+
+modemenu.add_radiobutton(label = 'JT6M', variable=mode, command = ModeJT6M, \
+                        accelerator='Shift+F7')
+modemenu.add_radiobutton(label = 'JT65A', variable=mode, command = ModeJT65A, \
+                         accelerator='F8')
+modemenu.add_radiobutton(label = 'JT65B', variable=mode, command = ModeJT65B, \
+                         accelerator='Shift+F8')
+modemenu.add_radiobutton(label = 'JT65C', variable=mode, command = ModeJT65C, \
+                         accelerator='Ctrl+F8')
+modemenu.add_radiobutton(label = 'CW', variable=mode, command = ModeCW, \
+                         accelerator='Shift+Ctrl+F8')
+#modemenu.add_radiobutton(label = 'Echo', variable=mode, command = ModeEcho,
+#                         state=DISABLED)
+
+#------------------------------------------------------ Decode menu
+decodebutton = Menubutton(mbar, text = 'Decode')
+decodebutton.pack(side = LEFT)
+decodemenu = Menu(decodebutton, tearoff=1)
+decodebutton['menu'] = decodemenu
+decodemenu.FSK441=Menu(decodemenu,tearoff=0)
+decodemenu.FSK441.add_checkbutton(label='No shorthands',variable=nosh441)
+decodemenu.JT65=Menu(decodemenu,tearoff=0)
+decodemenu.JT65.add_checkbutton(label='Only EME calls',variable=neme)
+decodemenu.JT65.add_checkbutton(label='No Shorthands if Tx 1',variable=noshjt65)
+decodemenu.JT65.add_separator()
+decodemenu.JT65.add_radiobutton(label = 'No Deep Search',
+                                variable=ndepth, value=0)
+decodemenu.JT65.add_radiobutton(label = 'Normal Deep Search',
+                                variable=ndepth, value=1)
+decodemenu.JT65.add_radiobutton(label = 'Aggressive Deep Search',
+                                variable=ndepth, value=2)
+decodemenu.JT65.add_radiobutton(label ='Include Average in Aggressive Deep Search',
+                                variable=ndepth, value=3)
+decodemenu.add_cascade(label = 'FSK441',menu=decodemenu.FSK441)
+decodemenu.add_cascade(label = 'JT65',menu=decodemenu.JT65)
+
+#------------------------------------------------------ Save menu
+savebutton = Menubutton(mbar, text = 'Save')
+savebutton.pack(side = LEFT)
+savemenu = Menu(savebutton, tearoff=1)
+savebutton['menu'] = savemenu
+nsave=IntVar()
+savemenu.add_radiobutton(label = 'None', variable=nsave,value=0)
+savemenu.add_radiobutton(label = 'Save decoded', variable=nsave,value=1)
+savemenu.add_radiobutton(label = 'Save if Auto On', variable=nsave,value=2)
+savemenu.add_radiobutton(label = 'Save all', variable=nsave,value=3)
+nsave.set(0)
+
+#------------------------------------------------------ Band menu
+bandbutton = Menubutton(mbar, text = 'Band')
+bandbutton.pack(side = LEFT)
+bandmenu = Menu(bandbutton, tearoff=1)
+bandbutton['menu'] = bandmenu
+nfreq=IntVar()
+bandmenu.add_radiobutton(label = '50', variable=nfreq,value=50)
+bandmenu.add_radiobutton(label = '144', variable=nfreq,value=144)
+bandmenu.add_radiobutton(label = '222', variable=nfreq,value=222)
+bandmenu.add_radiobutton(label = '432', variable=nfreq,value=432)
+bandmenu.add_radiobutton(label = '1296', variable=nfreq,value=1296)
+nfreq.set(144)
+#------------------------------------------------------ Help menu
+helpbutton = Menubutton(mbar, text = 'Help')
+helpbutton.pack(side = LEFT)
+helpmenu = Menu(helpbutton, tearoff=0)
+helpbutton['menu'] = helpmenu
+helpmenu.add('command', label = 'Keyboard shortcuts', command = shortcuts, \
+             accelerator='F1')
+helpmenu.add('command', label = 'Special mouse commands', \
+             command = mouse_commands, accelerator='Shift+F1')
+helpmenu.add('command', label = 'What message to send?', \
+             command = what2send, accelerator='F5')
+helpmenu.add('command', label = 'Available suffixes and add-on prefixes', \
+             command = prefixes)
+helpmenu.add('command', label = 'About MAP65', command = about, \
+             accelerator='Ctrl+F1')
+
+#------------------------------------------------------ Graphics areas
+iframe1 = Frame(frame, bd=1, relief=SUNKEN)
+graph1=Canvas(iframe1, bg='black', width=500, height=120,cursor='crosshair')
+Widget.bind(graph1,&quot;&lt;Motion&gt;&quot;,dtdf_change)
+Widget.bind(graph1,&quot;&lt;Button-1&gt;&quot;,mouse_click_g1)
+Widget.bind(graph1,&quot;&lt;Double-Button-1&gt;&quot;,double_click_g1)
+Widget.bind(graph1,&quot;&lt;ButtonRelease-1&gt;&quot;,mouse_up_g1)
+Widget.bind(graph1,&quot;&lt;Button-3&gt;&quot;,mouse_click_g1)
+graph1.pack(side=LEFT)
+graph2=Canvas(iframe1, bg='black', width=150, height=120,cursor='crosshair')
+graph2.pack(side=LEFT)
+g2font=graph2.option_get(&quot;font&quot;,&quot;font&quot;)
+if g2font!=&quot;&quot;: g.g2font=g2font
+iframe1.pack(expand=1, fill=X, padx=4)
+
+#------------------------------------------------------ Labels under graphics
+iframe2a = Frame(frame, bd=1, relief=FLAT, height=15)
+lab1=Label(iframe2a, text='Time (s)')
+lab1.place(x=250, y=6, anchor=CENTER)
+lab3=Label(iframe2a, text=' ')
+lab3.place(x=400,y=6, anchor=CENTER)
+lab4=Label(iframe2a, text='1             2            3')
+lab4.place(x=593,y=6, anchor=CENTER)
+iframe2a.pack(expand=1, fill=X, padx=1)
+iframe2 = Frame(frame, bd=1, relief=FLAT,height=15)
+lab2=Label(iframe2, text='FileID     Sync     dB        DT        DF      W')
+lab2.place(x=3,y=6, anchor='w')
+lab5=Label(iframe2, text='Freq (kHz)')
+lab5.place(x=580,y=6, anchor=CENTER)
+lab6=Label(iframe2a,text='0.0',bg='green')
+lab6.place(x=40,y=6, anchor=CENTER)
+lab7=Label(iframe2a,text='F3',fg='gray85')
+lab7.place(x=495,y=6, anchor=CENTER)
+lab8=Label(iframe2a,text='1.0000  1.0000',fg='gray85')
+lab8.place(x=135,y=6, anchor=CENTER)
+iframe2.pack(expand=1, fill=X, padx=4)
+
+#-------------------------------------------------------- Decoded text
+iframe4 = Frame(frame, bd=1, relief=SUNKEN)
+text=Text(iframe4, height=6, width=80)
+text.bind('&lt;Double-Button-1&gt;',dbl_click_text)
+#text.bind('&lt;Double-Button-3&gt;',dbl_click_text)
+text.bind('&lt;Key&gt;',textkey)
+
+root.bind_all('&lt;F1&gt;', shortcuts)
+root.bind_all('&lt;Shift-F1&gt;', mouse_commands)
+root.bind_all('&lt;Control-F1&gt;', about)
+root.bind_all('&lt;F2&gt;', options1)
+root.bind_all('&lt;F3&gt;', txmute)
+root.bind_all('&lt;F4&gt;', clrToRadio)
+root.bind_all('&lt;F5&gt;', what2send)
+root.bind_all('&lt;F6&gt;', opennext)
+root.bind_all('&lt;Shift-F6&gt;', decodeall)
+root.bind_all('&lt;F7&gt;', ModeFSK441)
+root.bind_all('&lt;F8&gt;', ModeJT65A)
+root.bind_all('&lt;Shift-F8&gt;', ModeJT65B)
+root.bind_all('&lt;Control-F8&gt;', ModeJT65C)
+root.bind_all('&lt;Shift-F7&gt;', ModeJT6M)
+root.bind_all('&lt;Shift-Control-F8&gt;', ModeCW)
+#root.bind_all('&lt;F9&gt;', ModeEcho)
+root.bind_all('&lt;F10&gt;', showspecjt)
+root.bind_all('&lt;Shift-F10&gt;', astro1)
+
+root.bind_all('&lt;Alt-Key-1&gt;',btx1)
+root.bind_all('&lt;Alt-Key-2&gt;',btx2)
+root.bind_all('&lt;Alt-Key-3&gt;',btx3)
+root.bind_all('&lt;Alt-Key-4&gt;',btx4)
+root.bind_all('&lt;Alt-Key-5&gt;',btx5)
+root.bind_all('&lt;Alt-Key-6&gt;',btx6)
+
+root.bind_all('&lt;Alt-a&gt;',toggleauto)
+root.bind_all('&lt;Alt-A&gt;',toggleauto)
+root.bind_all('&lt;Alt-c&gt;',clear_avg)
+root.bind_all('&lt;Alt-C&gt;',clear_avg)
+root.bind_all('&lt;Alt-d&gt;',decode)
+root.bind_all('&lt;Alt-D&gt;',decode)
+root.bind_all('&lt;Alt-e&gt;',erase)
+root.bind_all('&lt;Alt-E&gt;',erase)
+root.bind_all('&lt;Alt-f&gt;',toggle_freeze)
+root.bind_all('&lt;Alt-F&gt;',toggle_freeze)
+root.bind_all('&lt;Alt-g&gt;',GenStdMsgs)
+root.bind_all('&lt;Alt-G&gt;',GenStdMsgs)
+root.bind_all('&lt;Control-g&gt;', GenAltMsgs)
+root.bind_all('&lt;Control-G&gt;', GenAltMsgs)
+root.bind_all('&lt;Alt-i&gt;',decode_include)
+root.bind_all('&lt;Alt-I&gt;',decode_include)
+root.bind_all('&lt;Alt-l&gt;',lookup)
+root.bind_all('&lt;Alt-L&gt;',lookup)
+root.bind_all('&lt;Alt-m&gt;',monitor)
+root.bind_all('&lt;Alt-M&gt;',monitor)
+root.bind_all('&lt;Alt-o&gt;',txstop)
+root.bind_all('&lt;Alt-O&gt;',txstop)
+root.bind_all('&lt;Control-o&gt;',openfile)
+root.bind_all('&lt;Control-O&gt;',openfile)
+root.bind_all('&lt;Alt-q&gt;',logqso)
+root.bind_all('&lt;Alt-Q&gt;',logqso)
+root.bind_all('&lt;Alt-s&gt;',stopmon)
+root.bind_all('&lt;Alt-S&gt;',stopmon)
+root.bind_all('&lt;Alt-v&gt;',savelast)
+root.bind_all('&lt;Alt-V&gt;',savelast)
+root.bind_all('&lt;Alt-x&gt;',decode_exclude)
+root.bind_all('&lt;Alt-X&gt;',decode_exclude)
+root.bind_all('&lt;Alt-z&gt;',toggle_zap)
+root.bind_all('&lt;Alt-Z&gt;',toggle_zap)
+root.bind_all('&lt;Control-l&gt;',lookup_gen)
+root.bind_all('&lt;Control-L&gt;',lookup_gen)
+root.bind_all('&lt;Left&gt;',left_arrow)
+root.bind_all('&lt;Right&gt;',right_arrow)
+
+text.pack(side=LEFT, fill=X, padx=1)
+sb = Scrollbar(iframe4, orient=VERTICAL, command=text.yview)
+sb.pack(side=RIGHT, fill=Y)
+text.configure(yscrollcommand=sb.set)
+iframe4.pack(expand=1, fill=X, padx=4)
+iframe4b = Frame(frame, bd=1, relief=SUNKEN)
+avetext=Text(iframe4b, height=2, width=80)
+avetext.bind('&lt;Double-Button-1&gt;',dbl_click_ave)
+#avetext.bind('&lt;Double-Button-3&gt;',dbl_click_ave)
+avetext.bind('&lt;Key&gt;',avetextkey)
+avetext.pack(side=LEFT, fill=X, padx=1)
+iframe4b.pack(expand=1, fill=X, padx=4)
+
+#------------------------------------------------------- Button Bar
+iframe4c = Frame(frame, bd=1, relief=SUNKEN)
+blogqso=Button(iframe4c, text='Log QSO',underline=4,command=logqso,
+                padx=1,pady=1)
+bstop=Button(iframe4c, text='Stop',underline=0,command=stopmon,
+                padx=1,pady=1)
+bmonitor=Button(iframe4c, text='Monitor',underline=0,command=monitor,
+                padx=1,pady=1)
+bsavelast=Button(iframe4c, text='Save',underline=2,command=savelast,
+                padx=1,pady=1)
+bdecode=Button(iframe4c, text='Decode',underline=0,command=decode,
+                padx=1,pady=1)
+berase=Button(iframe4c, text='Erase',underline=0,command=erase,
+                padx=1,pady=1)
+bclravg=Button(iframe4c, text='Clear Avg',underline=0,command=clear_avg,
+                padx=1,pady=1)
+binclude=Button(iframe4c, text='Include',underline=0,
+                command=decode_include,padx=1,pady=1)
+bexclude=Button(iframe4c, text='Exclude',underline=1,
+                command=decode_exclude,padx=1,pady=1)
+btxstop=Button(iframe4c,text='TxStop',underline=4,command=txstop,
+                padx=1,pady=1)
+
+blogqso.pack(side=LEFT,expand=1,fill=X)
+#bplay.pack(side=LEFT,expand=1,fill=X)
+bstop.pack(side=LEFT,expand=1,fill=X)
+bmonitor.pack(side=LEFT,expand=1,fill=X)
+bsavelast.pack(side=LEFT,expand=1,fill=X)
+bdecode.pack(side=LEFT,expand=1,fill=X)
+berase.pack(side=LEFT,expand=1,fill=X)
+bclravg.pack(side=LEFT,expand=1,fill=X)
+binclude.pack(side=LEFT,expand=1,fill=X)
+bexclude.pack(side=LEFT,expand=1,fill=X)
+btxstop.pack(side=LEFT,expand=1,fill=X)
+iframe4c.pack(expand=1, fill=X, padx=4)
+
+#-----------------------------------------------------General control area
+iframe5 = Frame(frame, bd=1, relief=FLAT,height=180)
+
+#------------------------------------------------------ &quot;Other station&quot; info
+f5a=Frame(iframe5,height=170,bd=2,relief=GROOVE)
+labToRadio=Label(f5a,text='To radio:', width=9, relief=FLAT)
+labToRadio.grid(column=0,row=0)
+ToRadio=Entry(f5a,width=9)
+ToRadio.insert(0,'W8WN')
+ToRadio.grid(column=1,row=0,pady=3)
+bLookup=Button(f5a, text='Lookup',underline=0,command=lookup,padx=1,pady=1)
+bLookup.grid(column=2,row=0,sticky='EW',padx=4)
+labGrid=Label(f5a,text='Grid:', width=9, relief=FLAT)
+labGrid.grid(column=0,row=1)
+HisGrid=Entry(f5a,width=9)
+HisGrid.grid(column=1,row=1,pady=1)
+bAdd=Button(f5a, text='Add',command=addtodb,padx=1,pady=1)
+bAdd.grid(column=2,row=1,sticky='EW',padx=4)
+labAz=Label(f5a,text='Az 257  El 15',width=11)
+labAz.grid(column=1,row=2)
+labHotAB=Label(f5a,bg='#FFCCFF',text='HotA: 247')
+labHotAB.grid(column=0,row=2,sticky='EW',padx=4,pady=3)
+labDist=Label(f5a,text='16753 km')
+labDist.grid(column=2,row=2)
+
+#------------------------------------------------------ Date and Time
+ldate=Label(f5a, bg='black', fg='yellow', width=11, bd=4,
+        text='2005 Apr 22\n01:23:45', relief=RIDGE,
+        justify=CENTER, font=(font1,16))
+ldate.grid(column=0,columnspan=3,row=3,rowspan=2,pady=2)
+f5a.pack(side=LEFT,expand=1,fill=BOTH)
+
+#------------------------------------------------------ Receiving parameters
+f5b=Frame(iframe5,bd=2,relief=GROOVE)
+lsync=Label(f5b, bg='white', fg='black', text='Sync   1', width=8, relief=RIDGE)
+lsync.grid(column=0,row=0,padx=2,pady=1,sticky='EW')
+Widget.bind(lsync,'&lt;Button-1&gt;',incsync)
+Widget.bind(lsync,'&lt;Button-3&gt;',decsync)
+nzap=IntVar()
+cbzap=Checkbutton(f5b,text='Zap',underline=0,variable=nzap)
+cbzap.grid(column=1,row=0,padx=2,pady=1,sticky='W')
+cbnb=Checkbutton(f5b,text='NB',variable=nblank)
+cbnb.grid(column=1,row=1,padx=2,pady=1,sticky='W')
+cbfreeze=Checkbutton(f5b,text='Freeze',underline=0,variable=nfreeze)
+cbfreeze.grid(column=1,row=2,padx=2,sticky='W')
+cbafc=Checkbutton(f5b,text='AFC',variable=nafc)
+cbafc.grid(column=1,row=3,padx=2,pady=1,sticky='W')
+lclip=Label(f5b, bg='white', fg='black', text='Clip   0', width=8, relief=RIDGE)
+lclip.grid(column=0,row=1,padx=2,sticky='EW')
+Widget.bind(lclip,'&lt;Button-1&gt;',incclip)
+Widget.bind(lclip,'&lt;Button-3&gt;',decclip)
+ltol=Label(f5b, bg='white', fg='black', text='Tol    400', width=8, relief=RIDGE)
+ltol.grid(column=0,row=2,padx=2,pady=1,sticky='EW')
+Widget.bind(ltol,'&lt;Button-1&gt;',inctol)
+Widget.bind(ltol,'&lt;Button-3&gt;',dectol)
+Button(f5b,text='Defaults',command=defaults,padx=1,pady=1).grid(column=0,
+                              row=3,sticky='EW')
+ldsec=Label(f5b, bg='white', fg='black', text='Dsec  0.0', width=8, relief=RIDGE)
+ldsec.grid(column=0,row=4,ipadx=3,padx=2,pady=5,sticky='EW')
+lshift=Label(f5b, bg='white', fg='black', text='Shift 0.0', width=8, relief=RIDGE)
+lshift.grid(column=1,row=4,ipadx=3,padx=2,pady=5,sticky='EW')
+Widget.bind(ldsec,'&lt;Button-1&gt;',incdsec)
+Widget.bind(ldsec,'&lt;Button-3&gt;',decdsec)
+Widget.bind(lshift,'&lt;Button-1&gt;',toggle_shift)
+
+f5b.pack(side=LEFT,expand=0,fill=BOTH)
+
+#------------------------------------------------------ Tx params and msgs
+f5c=Frame(iframe5,bd=2,relief=GROOVE)
+txfirst=Checkbutton(f5c,text='Tx First',justify=RIGHT,variable=TxFirst)
+f5c2=Frame(f5c,bd=0)
+labreport=Label(f5c2,text='Rpt',width=4)
+report=Entry(f5c2, width=4)
+report.insert(0,'26')
+labreport.pack(side=RIGHT,expand=1,fill=BOTH)
+report.pack(side=RIGHT,expand=1,fill=BOTH)
+shmsg=Checkbutton(f5c,text='Sh Msg',justify=RIGHT,variable=ShOK,
+            command=restart2)
+sked=Checkbutton(f5c,text='Sked',justify=RIGHT,variable=nsked)
+genmsg=Button(f5c,text='GenStdMsgs',underline=0,command=GenStdMsgs,
+            padx=1,pady=1)
+auto=Button(f5c,text='Auto is Off',underline=0,command=toggleauto,
+            padx=1,pady=1)
+auto.focus_set()
+
+txfirst.grid(column=0,row=0,sticky='W',padx=4)
+f5c2.grid(column=0,row=1,sticky='W',padx=4)
+shmsg.grid(column=0,row=2,sticky='W',padx=4)
+sked.grid(column=0,row=3,sticky='W',padx=4)
+genmsg.grid(column=0,row=4,sticky='W',padx=4)
+auto.grid(column=0,row=5,sticky='EW',padx=4)
+#txstop.grid(column=0,row=6,sticky='EW',padx=4)
+
+ntx=IntVar()
+tx1=Entry(f5c,width=24)
+rb1=Radiobutton(f5c,value=1,variable=ntx)
+b1=Button(f5c, text='Tx1',underline=2,command=btx1,padx=1,pady=1)
+tx1.grid(column=1,row=0)
+rb1.grid(column=2,row=0)
+b1.grid(column=3,row=0)
+
+tx2=Entry(f5c,width=24)
+rb2=Radiobutton(f5c,value=2,variable=ntx)
+b2=Button(f5c, text='Tx2',underline=2,command=btx2,padx=1,pady=1)
+tx2.grid(column=1,row=1)
+rb2.grid(column=2,row=1)
+b2.grid(column=3,row=1)
+
+tx3=Entry(f5c,width=24)
+rb3=Radiobutton(f5c,value=3,variable=ntx)
+b3=Button(f5c, text='Tx3',underline=2,command=btx3,padx=1,pady=1)
+tx3.grid(column=1,row=2)
+rb3.grid(column=2,row=2)
+b3.grid(column=3,row=2)
+
+tx4=Entry(f5c,width=24)
+rb4=Radiobutton(f5c,value=4,variable=ntx)
+b4=Button(f5c, text='Tx4',underline=2,command=btx4,padx=1,pady=1)
+tx4.grid(column=1,row=3)
+rb4.grid(column=2,row=3)
+b4.grid(column=3,row=3)
+
+tx5=Entry(f5c,width=24)
+rb5=Radiobutton(f5c,value=5,variable=ntx)
+b5=Button(f5c, text='Tx5',underline=2,command=btx5,padx=1,pady=1)
+tx5.grid(column=1,row=4)
+rb5.grid(column=2,row=4)
+b5.grid(column=3,row=4)
+
+tx6=Entry(f5c,width=24)
+rb6=Radiobutton(f5c,value=6,variable=ntx)
+b6=Button(f5c, text='Tx6',underline=2,command=btx6,padx=1,pady=1)
+tx6.grid(column=1,row=5)
+rb6.grid(column=2,row=5)
+b6.grid(column=3,row=5)
+
+f5c.pack(side=LEFT,fill=BOTH)
+iframe5.pack(expand=1, fill=X, padx=4)
+
+#------------------------------------------------------------ Status Bar
+iframe6 = Frame(frame, bd=1, relief=SUNKEN)
+msg1=Message(iframe6, text='                    ', width=300,relief=SUNKEN)
+msg1.pack(side=LEFT, fill=X, padx=1)
+msg2=Message(iframe6, text='Message #2', width=300,relief=SUNKEN)
+msg2.pack(side=LEFT, fill=X, padx=1)
+msg3=Message(iframe6,width=300,relief=SUNKEN)
+msg3.pack(side=LEFT, fill=X, padx=1)
+msg4=Message(iframe6, text='Message #4', width=300,relief=SUNKEN)
+msg4.pack(side=LEFT, fill=X, padx=1)
+msg5=Message(iframe6, text='Message #5', width=300,relief=SUNKEN)
+msg5.pack(side=LEFT, fill=X, padx=1)
+Widget.bind(msg5,'&lt;Button-1&gt;',inctrperiod)
+Widget.bind(msg5,'&lt;Button-3&gt;',dectrperiod)
+msg7=Message(iframe6, text='                        ', width=300,relief=SUNKEN)
+msg7.pack(side=RIGHT, fill=X, padx=1)
+iframe6.pack(expand=1, fill=X, padx=4)
+frame.pack()
+
+ldate.after(100,update)
+lauto=0
+isync=1
+ntx.set(1)
+ndepth.set(1)
+import options
+options.defaults()
+ModeFSK441()
+lookup()
+balloon.unbind(ToRadio)
+g.astro_geom0=&quot;+0+0&quot;
+Audio.gcom1.mute=0
+
+#---------------------------------------------------------- Process INI file
+try:
+    f=open(appdir+'/MAP65.INI',mode='r')
+    params=f.readlines()
+except:
+    params=&quot;&quot;
+    if g.Win32:
+        options.PttPort.set(&quot;0&quot;)
+    else:
+        options.PttPort.set(&quot;/dev/ttyS0&quot;)
+    Audio.gcom2.nport=0
+
+try:
+    for i in range(len(params)):
+        key,value=params[i].split()
+        if   key == 'MAP65Geometry': root.geometry(value)
+        elif key == 'BMGeometry': bm_geom=value
+        elif key == 'Mode':
+            mode.set(value)
+            if value=='FSK441':
+                ModeFSK441()
+            elif value=='JT65A':
+                ModeJT65A()
+            elif value=='JT65B':
+                ModeJT65B()
+            elif value=='JT65C':
+                ModeJT65C()
+            elif value=='JT6M':
+                ModeJT6M()
+            elif value=='CW':
+                ModeCW()
+        elif key == 'MyCall': options.MyCall.set(value)
+        elif key == 'MyGrid': options.MyGrid.set(value)
+        elif key == 'HisCall':
+            hiscall=value
+            if hiscall==&quot;______&quot;: hiscall=&quot;&quot;
+            ToRadio.delete(0,END)
+            ToRadio.insert(0,hiscall)
+        elif key == 'HisGrid':
+            hisgrid=value
+            if hisgrid == &quot;XX00xx&quot;:
+                lookup()
+            HisGrid.delete(0,END)
+            HisGrid.insert(0,hisgrid)
+#        elif key == 'RxDelay': options.RxDelay.set(value)
+#        elif key == 'TxDelay': options.TxDelay.set(value)
+        elif key == 'IDinterval': options.IDinterval.set(value)
+        elif key == 'PttPort':
+            try:
+                options.PttPort.set(value)
+                try:
+                    Audio.gcom2.nport=int(options.PttPort.get())
+                except:
+                    Audio.gcom2.nport=0
+            except:
+                if g.Win32:
+                    options.PttPort.set(&quot;0&quot;)
+                else:
+                    options.PttPort.set(&quot;/dev/ttyS0&quot;)
+                Audio.gcom2.nport=0
+            Audio.gcom2.pttport=(options.PttPort.get()+'            ')[:12]
+        elif key == 'Mileskm': options.mileskm.set(value)
+        elif key == 'MsgStyle': options.ireport.set(value)
+        elif key == 'Region': options.iregion.set(value)
+        elif key == 'AudioIn':
+            try:
+                g.ndevin.set(value)
+            except:
+                g.ndevin.set(0)
+            g.DevinName.set(value)
+            options.DevinName.set(value)
+            Audio.gcom1.devin_name=(options.DevinName.get()+'            ')[:12]
+        elif key == 'AudioOut':
+            try:
+                g.ndevout.set(value)
+            except:
+                g.ndevout.set(0)
+            g.DevoutName.set(value)
+            options.DevoutName.set(value)
+            Audio.gcom1.devout_name=(options.DevoutName.get()+'            ')[:12]
+        elif key == 'SamFacIn': options.samfacin.set(value)
+        elif key == 'SamFacOut': options.samfacout.set(value)
+        elif key == 'Template1': options.Template1.set(value.replace(&quot;_&quot;,&quot; &quot;))
+        elif key == 'Template2': options.Template2.set(value.replace(&quot;_&quot;,&quot; &quot;))
+        elif key == 'Template3': options.Template3.set(value.replace(&quot;_&quot;,&quot; &quot;))
+        elif key == 'Template4': options.Template4.set(value.replace(&quot;_&quot;,&quot; &quot;))
+        elif key == 'Template5': options.Template5.set(value.replace(&quot;_&quot;,&quot; &quot;))
+        elif key == 'Template6':
+            options.Template6.set(value.replace(&quot;_&quot;,&quot; &quot;))
+            if options.Template6.get()==&quot; &quot;: options.Template6.set(&quot;&quot;)
+        elif key == 'AddPrefix': options.addpfx.set(value.replace(&quot;_&quot;,&quot; &quot;).lstrip())
+        elif key == 'AuxRA': options.auxra.set(value)
+        elif key == 'AuxDEC': options.auxdec.set(value)
+        elif key == 'TxFirst': TxFirst.set(value)
+        elif key == 'KB8RQ': kb8rq.set(value)
+        elif key == 'K2TXB': k2txb.set(value)
+        elif key == 'SetSeq': setseq.set(value)
+        elif key == 'Report':
+            report.delete(0,99)
+            report.insert(0,value)
+        elif key == 'ShOK': ShOK.set(value)
+        elif key == 'Nsave': nsave.set(value)
+        elif key == 'Band': nfreq.set(value)
+        elif key == 'S441': isync441=int(value)
+        elif key == 'S6m': isync6m=int(value)
+        elif key == 'Sync': isync65=int(value)
+        elif key == 'Clip': iclip=int(value)
+        elif key == 'Zap': nzap.set(value)
+        elif key == 'NB': nblank.set(value)
+        elif key == 'NAFC': nafc.set(value)
+        elif key == 'Sked': nsked.set(value)
+        elif key == 'NoSh441': nosh441.set(value)
+        elif key == 'NoShJT65': noshjt65.set(value)
+        elif key == 'NEME': neme.set(value)
+        elif key == 'NDepth': ndepth.set(value)
+        elif key == 'Debug': ndebug.set(value)
+        elif key == 'HisCall':
+            Audio.gcom2.hiscall=(value+'            ')[:12]
+            ToRadio.delete(0,99)
+            ToRadio.insert(0,value)
+            lookup()                       #Maybe should save HisGrid, instead?
+        elif key == 'MRUDir': mrudir=value.replace(&quot;#&quot;,&quot; &quot;)
+        elif key == 'AstroGeometry': g.astro_geom0 =value
+        elif key == 'CWTRPeriod':
+            ncwtrperiod=int(value)
+            if mode.get()[:2]==&quot;CW&quot;: Audio.gcom1.trperiod=ncwtrperiod
+        else: pass
+except:
+    print 'Error reading MAP65.INI, continuing with defaults.'
+    print key,value
+
+g.mode=mode.get()
+if mode.get()=='FSK441': isync=isync441
+elif mode.get()=='JT6M': isync=isync6m
+elif mode.get()[:4]=='JT65': isync=isync65
+lsync.configure(text=slabel+str(isync))
+lclip.configure(text='Clip   '+str(iclip))
+Audio.gcom2.appdir=(appdir+'                                                                                          ')[:80]
+Audio.gcom2.ndepth=ndepth.get()
+Audio.ftn_init()
+GenStdMsgs()
+Audio.gcom4.addpfx=(options.addpfx.get().lstrip()+'        ')[:8]
+stopmon()
+first=1
+if g.Win32: root.iconbitmap(&quot;wsjt.ico&quot;)
+root.title('  MAP65     by K1JT')
+bandmap()
+import astro
+import specjt
+
+# SpecJT has a &quot;mainloop&quot;, so does not return until it is terminated.
+#root.mainloop()   #Superseded by mainloop in SpecJT
+
+# Clean up and save user options before terminating
+f=open(appdir+'/MAP65.INI',mode='a')
+root_geom=root_geom[root_geom.index(&quot;+&quot;):]
+f.write(&quot;MAP65Geometry &quot; + root_geom + &quot;\n&quot;)
+bm_geom=bm_geom[bm_geom.index(&quot;+&quot;):]
+f.write(&quot;BMGeometry &quot; + bm_geom + &quot;\n&quot;)
+f.write(&quot;Mode &quot; + g.mode + &quot;\n&quot;)
+f.write(&quot;MyCall &quot; + options.MyCall.get() + &quot;\n&quot;)
+f.write(&quot;MyGrid &quot; + options.MyGrid.get() + &quot;\n&quot;)
+t=g.ftnstr(Audio.gcom2.hiscall)
+if t[:1]==&quot; &quot;: t=&quot;______&quot;
+f.write(&quot;HisCall &quot; + t + &quot;\n&quot;)
+t=g.ftnstr(Audio.gcom2.hisgrid)
+if t==&quot;      &quot;: t=&quot;XX00xx&quot;
+f.write(&quot;HisGrid &quot; + t + &quot;\n&quot;)
+#f.write(&quot;RxDelay &quot; + str(options.RxDelay.get()) + &quot;\n&quot;)
+#f.write(&quot;TxDelay &quot; + str(options.TxDelay.get()) + &quot;\n&quot;)
+f.write(&quot;IDinterval &quot; + str(options.IDinterval.get()) + &quot;\n&quot;)
+f.write(&quot;PttPort &quot; + str(options.PttPort.get()) + &quot;\n&quot;)
+f.write(&quot;Mileskm &quot; + str(options.mileskm.get()) + &quot;\n&quot;)
+f.write(&quot;MsgStyle &quot; + str(options.ireport.get()) + &quot;\n&quot;)
+f.write(&quot;Region &quot; + str(options.iregion.get()) + &quot;\n&quot;)
+f.write(&quot;AudioIn &quot; + options.DevinName.get() + &quot;\n&quot;)
+f.write(&quot;AudioOut &quot; + options.DevoutName.get() + &quot;\n&quot;)
+f.write(&quot;SamFacIn &quot; + str(options.samfacin.get()) + &quot;\n&quot;)
+f.write(&quot;SamFacOut &quot; + str(options.samfacout.get()) + &quot;\n&quot;)
+if options.Template6.get()==&quot;&quot;: options.Template6.set(&quot;_&quot;)
+f.write(&quot;Template1 &quot; + options.Template1.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
+f.write(&quot;Template2 &quot; + options.Template2.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
+f.write(&quot;Template3 &quot; + options.Template3.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
+f.write(&quot;Template4 &quot; + options.Template4.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
+f.write(&quot;Template5 &quot; + options.Template5.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
+f.write(&quot;Template6 &quot; + options.Template6.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
+if options.addpfx.get().lstrip()==&quot;&quot;: options.addpfx.set(&quot;_&quot;)
+f.write(&quot;AddPrefix &quot; + options.addpfx.get().lstrip() + &quot;\n&quot;)
+if options.auxra.get()==&quot;&quot;: options.auxra.set(&quot;0&quot;)
+if options.auxdec.get()==&quot;&quot;: options.auxdec.set(&quot;0&quot;)
+f.write(&quot;AuxRA &quot; + options.auxra.get() + &quot;\n&quot;)
+f.write(&quot;AuxDEC &quot; + options.auxdec.get() + &quot;\n&quot;)
+f.write(&quot;TxFirst &quot; + str(TxFirst.get()) + &quot;\n&quot;)
+f.write(&quot;KB8RQ &quot; + str(kb8rq.get()) + &quot;\n&quot;)
+f.write(&quot;K2TXB &quot; + str(k2txb.get()) + &quot;\n&quot;)
+f.write(&quot;SetSeq &quot; + str(setseq.get()) + &quot;\n&quot;)
+f.write(&quot;Report &quot; + g.report + &quot;\n&quot;)
+f.write(&quot;ShOK &quot; + str(ShOK.get()) + &quot;\n&quot;)
+f.write(&quot;Nsave &quot; + str(nsave.get()) + &quot;\n&quot;)
+f.write(&quot;Band &quot; + str(nfreq.get()) + &quot;\n&quot;)
+f.write(&quot;S441 &quot; + str(isync441) + &quot;\n&quot;)
+f.write(&quot;S6m &quot; + str(isync6m) + &quot;\n&quot;)
+f.write(&quot;Sync &quot; + str(isync65) + &quot;\n&quot;)
+f.write(&quot;Clip &quot; + str(iclip) + &quot;\n&quot;)
+f.write(&quot;Zap &quot; + str(nzap.get()) + &quot;\n&quot;)
+f.write(&quot;NB &quot; + str(nblank.get()) + &quot;\n&quot;)
+f.write(&quot;NAFC &quot; + str(nafc.get()) + &quot;\n&quot;)
+f.write(&quot;Sked &quot; + str(nsked.get()) + &quot;\n&quot;)
+f.write(&quot;NoSh441 &quot; + str(nosh441.get()) + &quot;\n&quot;)
+f.write(&quot;NoShJT65 &quot; + str(noshjt65.get()) + &quot;\n&quot;)
+f.write(&quot;NEME &quot; + str(neme.get()) + &quot;\n&quot;)
+f.write(&quot;NDepth &quot; + str(ndepth.get()) + &quot;\n&quot;)
+f.write(&quot;Debug &quot; + str(ndebug.get()) + &quot;\n&quot;)
+#f.write(&quot;TRPeriod &quot; + str(Audio.gcom1.trperiod) + &quot;\n&quot;)
+mrudir2=mrudir.replace(&quot; &quot;,&quot;#&quot;)
+f.write(&quot;MRUDir &quot; + mrudir2 + &quot;\n&quot;)
+if g.astro_geom[:7]==&quot;200x200&quot;: g.astro_geom=&quot;316x373&quot; + g.astro_geom[7:]
+f.write(&quot;AstroGeometry &quot; + g.astro_geom + &quot;\n&quot;)
+f.write(&quot;CWTRPeriod &quot; + str(ncwtrperiod) + &quot;\n&quot;)
+f.close()
+
+Audio.ftn_quit()
+Audio.gcom1.ngo=0                         #Terminate audio streams
+Audio.gcom2.lauto=0
+Audio.gcom1.txok=0
+time.sleep(0.5)

Deleted: branches/map65/wsjt.py
===================================================================
--- branches/map65/wsjt.py	2007-01-08 20:54:34 UTC (rev 321)
+++ branches/map65/wsjt.py	2007-01-08 20:58:40 UTC (rev 322)
@@ -1,2269 +0,0 @@
-#------------------------------------------------------------------- MAP65
-# $Date$ $Revision$
-#
-from Tkinter import *
-from tkFileDialog import *
-import Pmw
-from tkMessageBox import showwarning
-import g,os,time
-import Audio
-from math import log10
-from Numeric import zeros
-import dircache
-import Image,ImageTk  #, ImageDraw
-from palettes import colormapblue, colormapgray0, colormapHot, \
-     colormapAFMHot, colormapgray1, colormapLinrad, Colormap2Palette
-from types import *
-import array
-
-root = Tk()
-Version=&quot;0.1 r&quot; + &quot;$Rev$&quot;[6:-1]
-print &quot;******************************************************************&quot;
-print &quot;MAP65 Version &quot; + Version + &quot;, by K1JT&quot;
-print &quot;Revision date: &quot; + \
-      &quot;$Date$&quot;[7:-1]
-print &quot;Run date:   &quot; + time.asctime(time.gmtime()) + &quot; UTC&quot;
-
-#See if we are running in Windows
-g.Win32=0
-if sys.platform==&quot;win32&quot;:
-    g.Win32=1
-    try:
-        root.option_readfile('map65rc.win')
-    except:
-        pass
-else:
-    try:
-        root.option_readfile('map65rc')
-    except:
-        pass
-root_geom=&quot;&quot;
-
-
-#------------------------------------------------------ Global variables
-appdir=os.getcwd()
-isync=0
-isync441=2
-isync6m=-10
-isync65=1
-isync_save=0
-iclip=0
-itol=5                                       #Default tol=400 Hz
-ntol=(10,25,50,100,200,400,600)              #List of available tolerances
-idsec=0
-#irdsec=0
-lauto=0
-altmsg=0
-bm_geom=&quot;&quot;
-cmap0=&quot;Linrad&quot;
-fileopened=&quot;&quot;
-font1='Helvetica'
-hiscall=&quot;&quot;
-hisgrid=&quot;&quot;
-isec0=-99
-k2txb=IntVar()
-kb8rq=IntVar()
-loopall=0
-mode=StringVar()
-mode.set(&quot;&quot;)
-mrudir=os.getcwd()
-nafc=IntVar()
-naz=0
-ndepth=IntVar()
-nel=0
-nblank=IntVar()
-ncall=0
-ncwtrperiod=120
-ndmiles=0
-ndkm=0
-ndebug=IntVar()
-neme=IntVar()
-nfreeze=IntVar()
-nhotaz=0
-nhotabetter=0
-nopen=0
-nosh441=IntVar()
-noshjt65=IntVar()
-nsked=IntVar()
-setseq=IntVar()
-ShOK=IntVar()
-slabel=&quot;Sync   &quot;
-textheight=7
-tx6alt=&quot;&quot;
-txsnrdb=99.
-TxFirst=IntVar()
-green=zeros(500,'f')
-im=Image.new('P',(500,120))
-im.putpalette(Colormap2Palette(colormapLinrad),&quot;RGB&quot;)
-pim=ImageTk.PhotoImage(im)
-balloon=Pmw.Balloon(root)
-
-g.freeze_decode=0
-g.mode=&quot;&quot;
-g.ndevin=IntVar()
-g.ndevout=IntVar()
-g.DevinName=StringVar()
-g.DevoutName=StringVar()
-#------------------------------------------------------ showspecjt
-def showspecjt(event=NONE):
-    if g.showspecjt==0: g.showspecjt=1
-
-#------------------------------------------------------ restart
-def restart():
-    Audio.gcom2.nrestart=1
-    Audio.gcom2.mantx=1
-
-#------------------------------------------------------ restart2
-def restart2():
-    Audio.gcom2.shok=ShOK.get()
-    Audio.gcom2.nrestart=1
-
-#------------------------------------------------------ toggle_freeze
-def toggle_freeze(event=NONE):
-    nfreeze.set(1-nfreeze.get())
-
-#------------------------------------------------------ toggle_zap
-def toggle_zap(event=NONE):
-    nzap.set(1-nzap.get())
-
-#------------------------------------------------------ btx (1-6)
-def btx1(event=NONE):
-    ntx.set(1)
-    Audio.gcom2.txmsg=(tx1.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=1
-    restart()
-def btx2(event=NONE):
-    ntx.set(2)
-    Audio.gcom2.txmsg=(tx2.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=2
-    restart()
-def btx3(event=NONE):
-    ntx.set(3)
-    Audio.gcom2.txmsg=(tx3.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=3
-    restart()
-def btx4(event=NONE):
-    ntx.set(4)
-    Audio.gcom2.txmsg=(tx4.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=4
-    restart()
-def btx5(event=NONE):
-    ntx.set(5)
-    Audio.gcom2.txmsg=(tx5.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=5
-    restart()
-def btx6(event=NONE):
-    ntx.set(6)
-    Audio.gcom2.txmsg=(tx6.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=6
-    restart()
-
-#------------------------------------------------------ quit
-def quit():
-    root.destroy()
-
-#------------------------------------------------------ testmsgs
-def testmsgs():
-    for m in (tx1, tx2, tx3, tx4, tx5, tx6):
-        m.delete(0,99)
-    tx1.insert(0,&quot;@A&quot;)
-    tx2.insert(0,&quot;@B&quot;)
-    tx3.insert(0,&quot;@C&quot;)
-    tx4.insert(0,&quot;@D&quot;)
-    tx5.insert(0,&quot;@1000&quot;)
-    tx6.insert(0,&quot;@2000&quot;)
-
-
-#------------------------------------------------------ textsize
-def textsize():
-    global textheight
-    if textheight &lt;= 9:
-        textheight=21
-    else:
-        if mode.get()[:4]=='JT65':
-            textheight=7
-        else:
-            textheight=9
-    text.configure(height=textheight)
-
-#------------------------------------------------------ logqso
-def logqso(event=NONE):
-    t=time.strftime(&quot;%Y-%b-%d,%H:%M&quot;,time.gmtime())
-    t=t+&quot;,&quot;+hiscall+&quot;,&quot;+hisgrid+&quot;,&quot;+str(g.nfreq)+&quot;,&quot;+g.mode+&quot;\n&quot;
-    t2=&quot;Please confirm making the following entry in MAP65.LOG:\n\n&quot; + t
-    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),message_text=t2)
-    msg.geometry(msgpos())
-    if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
-    msg.focus_set()
-    result=msg.activate()
-    if result == 'Yes':
-        f=open(appdir+'/WSJT.LOG','a')
-        f.write(t)
-        f.close()
-    
-#------------------------------------------------------ monitor
-def monitor(event=NONE):
-    bmonitor.configure(bg='green')
-    Audio.gcom2.monitoring=1
-
-#------------------------------------------------------ stopmon
-def stopmon(event=NONE):
-    global loopall
-    loopall=0
-    bmonitor.configure(bg='gray85')
-    Audio.gcom2.monitoring=0
-
-#------------------------------------------------------ dbl_click_text
-def dbl_click_text(event):
-    t=text.get('1.0',END)           #Entire contents of text box
-    t1=text.get('1.0',CURRENT)      #Contents from start to mouse pointer
-    dbl_click_call(t,t1,event)
-#------------------------------------------------------ dbl_click_ave
-def dbl_click_ave(event):
-    t=avetext.get('1.0',END)           #Entire contents of text box
-    t1=avetext.get('1.0',CURRENT)      #Contents from start to mouse pointer
-    dbl_click_call(t,t1,event)
-#------------------------------------------------------ dbl_click_call
-def dbl_click_call(t,t1,event):
-    global hiscall
-    i=len(t1)                       #Length to mouse pointer
-    i1=t1.rfind(' ')+1              #index of preceding space
-    i2=i1+t[i1:].find(' ')          #index of next space
-    hiscall=t[i1:i2]                #selected word, assumed as callsign
-    ToRadio.delete(0,END)
-    ToRadio.insert(0,hiscall)
-    i3=t1.rfind('\n')+1             #start of selected line
-    if i&gt;6 and i2&gt;i1:
-        try:
-            nsec=60*int(t1[i3+2:i3+4]) + int(t1[i3+4:i3+6])
-        except:
-            nsec=0
-        if setseq.get(): TxFirst.set((nsec/Audio.gcom1.trperiod)%2)
-        lookup()
-        GenStdMsgs()
-        i3=t[:i1].strip().rfind(' ')+1
-        if t[i3:i1].strip() == 'CQ':
-            ntx.set(1)
-        else:
-            ntx.set(2)
-        if event.num==3 and not lauto: toggleauto()
-
-def textkey(event=NONE):
-    text.configure(state=DISABLED)
-def avetextkey(event=NONE):
-    avetext.configure(state=DISABLED)
-
-#------------------------------------------------------ decode
-def decode(event=NONE):
-    if Audio.gcom2.ndecoding==0:        #If already busy, ignore request
-        Audio.gcom2.nagain=1
-        Audio.gcom2.npingtime=0         #Decode whole record
-        n=1
-        Audio.gcom2.mousebutton=0
-        if Audio.gcom2.ndecoding0==4: n=4
-        Audio.gcom2.ndecoding=n         #Standard decode, full file (d2a)
-
-#------------------------------------------------------ decode_include
-def decode_include(event=NONE):
-    global isync,isync_save
-    isync_save=isync
-    isync=-99
-    Audio.gcom2.minsigdb=-99
-    decode()
-
-#------------------------------------------------------ decode_exclude
-def decode_exclude(event=NONE):
-    global isync,isync_save
-    isync_save=isync
-    isync=99
-    Audio.gcom2.minsigdb=99
-    decode()
-
-#------------------------------------------------------ openfile
-def openfile(event=NONE):
-    global mrudir,fileopened,nopen
-    nopen=1                         #Work-around for &quot;click feedthrough&quot; bug
-    try:
-        os.chdir(mrudir)
-    except:
-        pass
-    fname=askopenfilename(filetypes=[(&quot;Wave files&quot;,&quot;*.wav *.WAV&quot;)])
-    if fname:
-        Audio.getfile(fname,len(fname))
-        if Audio.gcom2.ierr: print 'Error ',Audio.gcom2.ierr, \
-           'when trying to read file',fname
-        mrudir=os.path.dirname(fname)
-        fileopened=os.path.basename(fname)
-    os.chdir(appdir)
- 
-#------------------------------------------------------ opennext
-def opennext(event=NONE):
-    global ncall,fileopened,loopall,mrudir
-    if fileopened==&quot;&quot; and ncall==0:
-        openfile()
-        ncall=1
-    else:
-# Make a list of *.wav files in mrudir
-        la=os.listdir(mrudir)
-        la.sort()
-        lb=[]
-        for i in range(len(la)):
-            j=la[i].find(&quot;.wav&quot;) + la[i].find(&quot;.WAV&quot;)
-            if j&gt;0: lb.append(la[i])
-        for i in range(len(lb)):
-            if lb[i]==fileopened:
-                break
-        if i&lt;len(lb)-1:
-            fname=mrudir+&quot;/&quot;+lb[i+1]
-#            if not lauto: stopmon()
-            Audio.getfile(fname,len(fname))
-            if Audio.gcom2.ierr: print 'Error ',Audio.gcom2.ierr, \
-               'when trying to read file',fname
-            mrudir=os.path.dirname(fname)
-            fileopened=os.path.basename(fname)
-        else:
-            t=&quot;No more *.wav files in this directory.&quot;
-            msg=Pmw.MessageDialog(root,buttons=('OK',),message_text=t)
-            msg.geometry(msgpos())
-            if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
-            msg.focus_set()
-            ncall=0
-            loopall=0
-
-#------------------------------------------------------ decodeall
-def decodeall(event=NONE):
-    global loopall
-    loopall=1
-    opennext()
-
-#------------------------------------------------------ astro1
-def astro1(event=NONE):
-    astro.astro2(g.astro_geom0)
-
-#------------------------------------------------------ options1
-def options1(event=NONE):
-    options.options2(root_geom[root_geom.index(&quot;+&quot;):])
-
-#------------------------------------------------------ txmute
-def txmute(event=NONE):
-    Audio.gcom1.mute=1-Audio.gcom1.mute
-    if Audio.gcom1.mute:
-        lab7.configure(bg='red',fg='black')
-    else:
-        lab7.configure(bg='gray85',fg='gray85')
-
-#------------------------------------------------------ savelast
-def savelast(event=NONE):
-    Audio.gcom2.nsavelast=1
-
-#------------------------------------------------------ stub
-def stub(event=NONE):
-    MsgBox(&quot;Sorry, this function is not yet implemented.&quot;)
-
-#------------------------------------------------------ MsgBox
-def MsgBox(t):
-    msg=Pmw.MessageDialog(root,buttons=('OK',),message_text=t)
-    result=msg.activate()
-    msg.focus_set()
-
-#------------------------------------------------------ txstop
-def txstop(event=NONE):
-    if lauto: toggleauto()
-    Audio.gcom1.txok=0
-    Audio.gcom2.mantx=0
-    
-#------------------------------------------------------ lookup
-def lookup(event=NONE):
-    global hiscall,hisgrid
-    hiscall=ToRadio.get().upper().strip()
-    ToRadio.delete(0,END)
-    ToRadio.insert(0,hiscall)
-    s=whois(hiscall)
-    balloon.bind(ToRadio,s[:-1])
-    hisgrid=&quot;&quot;
-    if s:
-        i1=s.find(',')
-        i2=s.find(',',i1+1)
-        hisgrid=s[i1+1:i2]
-        hisgrid=hisgrid[:2].upper()+hisgrid[2:4]+hisgrid[4:6].lower()
-    if len(hisgrid)==4: hisgrid=hisgrid+&quot;mm&quot;
-    if len(hisgrid)==5: hisgrid=hisgrid+&quot;m&quot;
-    HisGrid.delete(0,99)
-    HisGrid.insert(0,hisgrid)
-
-def lookup_gen(event):
-    lookup()
-    GenStdMsgs()
-
-#-------------------------------------------------------- addtodb
-def addtodb():
-    global hiscall
-    if HisGrid.get()==&quot;&quot;:
-        MsgBox(&quot;Please enter a valid grid locator.&quot;)
-    else:
-        modified=0
-        hiscall=ToRadio.get().upper().strip()
-        hisgrid=HisGrid.get().strip()
-        hc=hiscall
-        NewEntry=hc + &quot;,&quot; + hisgrid
-        msg=Pmw.MessageDialog(root,buttons=('Yes','No'),
-            message_text=&quot;Is this station known to be active on EME?&quot;)
-        result=msg.activate()
-        msg.focus_set()
-        if result==&quot;Yes&quot;:
-            NewEntry=NewEntry + &quot;,EME,,&quot;
-        else:
-            NewEntry=NewEntry + &quot;,,,&quot;
-        try:
-            f=open(appdir+'/CALL3.TXT','r')
-            s=f.readlines()
-        except:
-            print 'Error opening CALL3.TXT'
-            s=&quot;&quot;
-        f.close()
-        hc2=&quot;&quot;
-        stmp=[]
-        for i in range(len(s)):
-            hc1=hc2
-            if s[i][:2]==&quot;//&quot;:
-                stmp.append(s[i])
-            else:
-                i1=s[i].find(&quot;,&quot;)
-                hc2=s[i][:i1]
-                if hc&gt;hc1 and hc&lt;hc2:
-                    stmp.append(NewEntry+&quot;\n&quot;)
-                    modified=1
-                elif hc==hc2:
-                    t=s[i] + &quot;\n\n is already in CALL3.TXT\nDo you wish to replace this entry?&quot;
-                    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),
-                        message_text=t)
-                    result=msg.activate()
-                    msg.focus_set()
-                    if result==&quot;Yes&quot;:
-                        i1=s[i].find(&quot;,&quot;)
-                        i2=s[i].find(&quot;,&quot;,i1+1)
-                        i3=s[i].find(&quot;,&quot;,i2+1)
-                        i4=len(NewEntry)
-                        s[i]=NewEntry[:i4-1] + s[i][i3+1:]
-                        modified=1
-                stmp.append(s[i])
-        if hc&gt;hc1 and modified==0:
-            stmp.append(NewEntry+&quot;\n&quot;)
-        try:
-            f=open(appdir+'/CALL3.TMP','w')
-            f.writelines(stmp)
-            f.close()
-        except:
-            print 'Error in opening or writing to CALL3.TMP'
-
-        if modified:
-            if os.path.exists(&quot;CALL3.OLD&quot;): os.remove(&quot;CALL3.OLD&quot;)
-            os.rename(&quot;CALL3.TXT&quot;,&quot;CALL3.OLD&quot;)
-            os.rename(&quot;CALL3.TMP&quot;,&quot;CALL3.TXT&quot;)
-
-#-------------------------------------------------------- clrToRadio
-def clrToRadio(event):
-    ToRadio.delete(0,END)
-    HisGrid.delete(0,99)
-    ToRadio.focus_set()
-    if kb8rq.get():
-        ntx.set(6)
-        nfreeze.set(0)
-
-#------------------------------------------------------ whois
-def whois(hiscall):
-    whodat=&quot;&quot;
-    try:
-        f=open(appdir+'/CALL3.TXT','r')
-        s=f.readlines()
-        f.close()
-    except:
-        print 'Error when searching CALL3.TXT, or no such file present'
-        s=&quot;&quot;
-    for i in range(len(s)):
-        if s[i][:2] != '//':
-            i1=s[i].find(',')
-            if s[i][:i1] == hiscall:
-                return s[i]
-    return &quot;&quot;
-
-#------------------------------------------------------ cleartext
-def cleartext():
-    f=open(appdir+'/decoded.txt',mode='w')
-    f.truncate(0)                           #Delete contents of decoded.txt
-    f.close()
-    f=open(appdir+'/decoded.ave',mode='w')
-    f.truncate(0)                           #Delete contents of decoded.ave
-    f.close()
-
-#------------------------------------------------------ ModeFSK441
-def ModeFSK441(event=NONE):
-    global slabel,isync,isync441,textheight,itol
-    if g.mode != &quot;FSK441&quot;:
-        if lauto: toggleauto()
-        mode.set(&quot;FSK441&quot;)
-        cleartext()
-        Audio.gcom1.trperiod=30
-        lab2.configure(text='FileID            T      Width    dB  Rpt       DF')
-        lab1.configure(text='Time (s)',bg=&quot;green&quot;)
-        lab4.configure(fg='black')
-        lab5.configure(fg='black')
-        lab6.configure(bg=&quot;green&quot;)
-        isync=isync441
-        slabel=&quot;S      &quot;
-        lsync.configure(text=slabel+str(isync))
-        iframe4b.pack_forget()
-        textheight=9
-        text.configure(height=textheight)
-        bclravg.configure(state=DISABLED)
-        binclude.configure(state=DISABLED)
-        bexclude.configure(state=DISABLED)
-        cbfreeze.configure(state=DISABLED)
-        cbafc.configure(state=DISABLED)
-        sked.configure(state=DISABLED)
-        report.configure(state=NORMAL)
-        shmsg.configure(state=NORMAL)
-        graph2.configure(bg='black')
-        itol=4
-        inctol()
-        ntx.set(1)
-        GenStdMsgs()
-        erase()
-
-#------------------------------------------------------ ModeJT65
-def ModeJT65():
-    global slabel,isync,isync65,textheight,itol
-    cleartext()
-    lab2.configure(text='FileID      Sync      dB        DT       DF    W')
-    lab4.configure(fg='gray85')
-    lab5.configure(fg='gray85')
-    Audio.gcom1.trperiod=60
-    iframe4b.pack(after=iframe4,expand=1, fill=X, padx=4)
-    textheight=7
-    text.configure(height=textheight)
-    isync=isync65
-    slabel=&quot;Sync   &quot;
-    lsync.configure(text=slabel+str(isync))
-    bclravg.configure(state=NORMAL)
-    binclude.configure(state=NORMAL)
-    bexclude.configure(state=NORMAL)
-    cbfreeze.configure(state=NORMAL)
-    cbafc.configure(state=NORMAL)
-    sked.configure(state=NORMAL)
-    report.configure(state=DISABLED)
-    shmsg.configure(state=DISABLED)
-    graph2.configure(bg='#66FFFF')
-    itol=4
-    inctol()
-    nfreeze.set(0)
-    ntx.set(1)
-    GenStdMsgs()
-    erase()
-#    graph2.pack_forget()
-
-#------------------------------------------------------ ModeJT65A
-def ModeJT65A(event=NONE):
-    if g.mode != &quot;JT65A&quot;:
-        if lauto: toggleauto()
-        mode.set(&quot;JT65A&quot;)
-        ModeJT65()
-
-#------------------------------------------------------ ModeJT65B
-def ModeJT65B(event=NONE):
-    if g.mode != &quot;JT65B&quot;:
-        if lauto: toggleauto()
-        mode.set(&quot;JT65B&quot;)
-        ModeJT65()
-
-#------------------------------------------------------ ModeJT65C
-def ModeJT65C(event=NONE):
-    if g.mode != &quot;JT65C&quot;:
-        if lauto: toggleauto()
-        mode.set(&quot;JT65C&quot;)
-        ModeJT65()
-
-#------------------------------------------------------ ModeJT6M
-def ModeJT6M(event=NONE):
-    global slabel,isync,isync6m,itol
-    if g.mode != &quot;JT6M&quot;:
-        if lauto: toggleauto()
-        cleartext()
-        ModeFSK441()
-        lab2.configure(text='FileID            T      Width      dB        DF')
-        mode.set(&quot;JT6M&quot;)
-        isync=isync6m
-        lsync.configure(text=slabel+str(isync))
-        shmsg.configure(state=DISABLED)
-        cbfreeze.configure(state=NORMAL)
-        itol=3
-        ltol.configure(text='Tol    '+str(ntol[itol]))
-        inctol()
-        nfreeze.set(1)
-        ntx.set(1)
-        Audio.gcom2.mousedf=0
-        GenStdMsgs()
-        erase()
-        
-
-#------------------------------------------------------ ModeCW
-def ModeCW(event=NONE):
-    if g.mode != &quot;CW&quot;:
-        if lauto: toggleauto()
-        cleartext()
-        mode.set(&quot;CW&quot;)
-        Audio.gcom1.trperiod=ncwtrperiod
-        iframe4b.pack_forget()
-        text.configure(height=9)
-        bclravg.configure(state=DISABLED)
-        binclude.configure(state=DISABLED)
-        bexclude.configure(state=DISABLED)
-        cbfreeze.configure(state=DISABLED)
-        cbafc.configure(state=DISABLED)
-        sked.configure(state=DISABLED)
-        report.configure(state=NORMAL)
-        ntx.set(1)
-        GenStdMsgs()
-        erase()
-
-#------------------------------------------------------ ModeEcho
-#def ModeEcho(event=NONE):
-#    mode.set(&quot;Echo&quot;)
-#    stub()
-    
-#------------------------------------------------------ msgpos
-def msgpos():
-    g=root_geom[root_geom.index(&quot;+&quot;):]
-    t=g[1:]
-    x=int(t[:t.index(&quot;+&quot;)])          # + 70
-    y=int(t[t.index(&quot;+&quot;)+1:])        # + 70
-    return &quot;+%d+%d&quot; % (x,y)    
-
-#------------------------------------------------------ about
-def about(event=NONE):
-    global Version
-    about=Toplevel(root)
-    about.geometry(msgpos())
-    if g.Win32: about.iconbitmap(&quot;wsjt.ico&quot;)
-    t=&quot;MAP65 Version &quot; + Version + &quot;, by K1JT&quot;
-    Label(about,text=t,font=(font1,16)).pack(padx=20,pady=5)
-    t=&quot;&quot;&quot;
-MAP65 is a weak signal communications program designed primarily
-for the Earth-Moon-Earth (EME) propagation path.
-
-Copyright (c) 2001-2006 by Joseph H. Taylor, Jr., K1JT, with
-contributions from additional authors.  MAP65 is Open Source 
-software, licensed under the GNU General Public License (GPL).
-Source code and programming information may be found at 
-<A HREF="http://developer.berlios.de/projects/wsjt/.">http://developer.berlios.de/projects/wsjt/.</A>
-&quot;&quot;&quot;
-    Label(about,text=t,justify=LEFT).pack(padx=20)
-    t=&quot;Revision date: &quot; + \
-      &quot;$Date$&quot;[7:-1]
-    Label(about,text=t,justify=LEFT).pack(padx=20)
-    about.focus_set()
-
-#------------------------------------------------------ shortcuts
-def shortcuts(event=NONE):
-    scwid=Toplevel(root)
-    scwid.geometry(msgpos())
-    if g.Win32: scwid.iconbitmap(&quot;wsjt.ico&quot;)
-    t=&quot;&quot;&quot;
-F1	List keyboard shortcuts
-Shift+F1	List special mouse commands
-Ctrl+F1	About MAP65
-F2	Options
-F3	Tx Mute
-F4	Clear &quot;To Radio&quot;
-F5	What message to send?
-F6	Open next file in directory
-Shift+F6	Decode all wave files in directory
-F7	Set FSK441 mode
-Shift+F7	Set JT6M mode
-F8	Set JT65A mode
-Shift+F8	Set JT65B mode
-Ctrl+F8	Set JT65C mode
-Shift+Ctrl+F8	Set CW mode
-F10	Show SpecJT
-Shift+F10   Show astronomical data
-Alt+1 to Alt+6	Tx1 to Tx6
-Alt+A	Toggle Auto On/Off
-Alt+D	Decode
-Alt+E	Erase
-Alt+F	Toggle Freeze
-Alt+G	Generate Standard Messages
-Ctrl+G	Generate Alternate JT65 Messages
-Alt+I	Include
-Alt+L	Lookup
-Ctrl+L	Lookup, then Generate Standard Messages
-Alt+M	Monitor
-Alt+O	Tx Stop
-Alt+Q	Log QSO
-Alt+S	Stop Monitoring or Decoding
-Alt+V	Save Last
-Alt+X	Exclude
-Alt+Z	Toggle Zap
-Right/Left Arrow	Increase/decrease Freeze DF
-&quot;&quot;&quot;
-    Label(scwid,text=t,justify=LEFT).pack(padx=20)
-    scwid.focus_set()
-
-#------------------------------------------------------ mouse_commands
-def mouse_commands(event=NONE):
-    scwid=Toplevel(root)
-    scwid.geometry(msgpos())
-    if g.Win32: scwid.iconbitmap(&quot;wsjt.ico&quot;)
-    t=&quot;&quot;&quot;
-Click on          Action
---------------------------------------------------------
-Waterfall        FSK441/JT6M: click to decode ping
-                      JT65: Click to set DF for Freeze
-                       Double-click to Freeze and Decode
-
-Main screen,     FSK441/JT6M: click to decode ping
-graphics area    JT65: Click to set DF for Freeze
-                           Double-click to Freeze and Decode
-
-Main screen,     Double-click puts callsign in Tx messages
-text area           Right-double-click also sets Auto ON
-
-Sync, Clip,      Left/Right click to increase/decrease
-Tol, ...
-&quot;&quot;&quot;
-    Label(scwid,text=t,justify=LEFT).pack(padx=20)
-    scwid.focus_set()
-
-#------------------------------------------------------ what2send
-def what2send(event=NONE):
-    screenf5=Toplevel(root)
-    screenf5.geometry(root_geom[root_geom.index(&quot;+&quot;):])
-    if g.Win32: screenf5.iconbitmap(&quot;wsjt.ico&quot;)
-    t=&quot;&quot;&quot;
-To optimize your chances of completing a valid QSO using WSJT,
-use the following standard procedures and *do not* exchange pertinent
-information by other means (e.g., internet, telephone, ...) while the
-QSO is in progress!
-
-FSK441 or JT6M:   If you have received
-    ... less than both calls from the other station, send both calls.
-    ... both calls, send both calls and your signal report.
-    ... both calls and signal report, send R and your report.
-    ... R plus signal report, send RRR.
-    ... RRR, the QSO is complete.  However, the other station may not
-know this, so it is conventional to send 73 to signify that you are done.
-
-(Outside of North America, the customary procedures for FSK441
-and JT6M may be slightly different.)
-
-
-JT65:   If you have received
-    ... less than both calls, send both calls and your grid locator.
-    ... both calls, send both calls, your grid locator, and OOO.
-    ... both calls and OOO, send RO.
-    ... RO, send RRR.
-    ... RRR, the QSO is complete.  However, the other station may not
-know this, so it is conventional to send 73 to signify that you are done.
-
-(Sending grid locators is conventional in JT65, but numerical signal
-reports may be substituted.)
-&quot;&quot;&quot;
-    Label(screenf5,text=t,justify=LEFT).pack(padx=20)
-    screenf5.focus_set()
-
-#------------------------------------------------------ prefixes
-def prefixes(event=NONE):
-    pfx=Toplevel(root)
-    pfx.geometry(msgpos())
-    if g.Win32: pfx.iconbitmap(&quot;wsjt.ico&quot;)
-    f=open(appdir+'/prefixes.txt','r')
-    s=f.readlines()
-    t2=&quot;&quot;
-    for i in range(4):
-        t2=t2+s[i]
-    t=&quot;&quot;
-    for i in range(len(s)-4):
-        t=t+s[i+4]
-    t=t.split()
-    t.sort()
-    t1=&quot;&quot;
-    n=0
-    for i in range(len(t)):
-        t1=t1+t[i]+&quot;  &quot;
-        n=n+len(t[i])+2
-        if n&gt;60:
-            t1=t1+&quot;\n&quot;
-            n=0
-    t1=t1+&quot;\n&quot;
-    if options.addpfx.get().lstrip():
-        t1=t1+&quot;\nOptional prefix:  &quot;+(options.addpfx.get().lstrip()+'    ')[:8]
-    t2=t2+&quot;\n&quot;+t1
-    Label(pfx,text=t2,justify=LEFT).pack(padx=20)
-    pfx.focus_set()
-
-#------------------------------------------------------ azdist
-def azdist():
-    if len(HisGrid.get().strip())&lt;4:
-        labAz.configure(text=&quot;&quot;)
-        labHotAB.configure(text=&quot;&quot;,bg='gray85')
-        labDist.configure(text=&quot;&quot;)
-    else:
-        if mode.get()[:4]==&quot;JT65&quot; or mode.get()[:2]==&quot;CW&quot;:
-            labAz.configure(text=&quot;Az: %d&quot; % (naz,))
-            labHotAB.configure(text=&quot;&quot;,bg='gray85')
-        else:
-            labAz.configure(text=&quot;Az: %d   El: %d&quot; % (naz,nel))
-            if nhotabetter:
-                labHotAB.configure(text=&quot;Hot A: &quot;+str(nhotaz),bg='#FF9900')
-            else:
-                labHotAB.configure(text=&quot;Hot B: &quot;+str(nhotaz),bg='#FF9900')
-        if options.mileskm.get()==0:
-            labDist.configure(text=str(ndmiles)+&quot; mi&quot;)
-        else:
-            labDist.configure(text=str(int(1.609344*ndmiles))+&quot; km&quot;)
-    
-#------------------------------------------------------ incsync
-def incsync(event):
-    global isync
-    if isync&lt;10:
-        isync=isync+1
-        lsync.configure(text=slabel+str(isync))
-
-#------------------------------------------------------ decsync
-def decsync(event):
-    global isync
-    if isync&gt;-30:
-        isync=isync-1
-        lsync.configure(text=slabel+str(isync))
-
-#------------------------------------------------------ incclip
-def incclip(event):
-    global iclip
-    if iclip&lt;5:
-        iclip=iclip+1
-        if iclip==5: iclip=99
-        lclip.configure(text='Clip   '+str(iclip))
-
-#------------------------------------------------------ decclip
-def decclip(event):
-    global iclip
-    if iclip&gt;-5:
-        iclip=iclip-1
-        if iclip==98: iclip=4
-        lclip.configure(text='Clip   '+str(iclip))
-
-#------------------------------------------------------ inctol
-def inctol(event=NONE):
-    global itol
-    maxitol=5
-    if mode.get()[:4]=='JT65':
-        maxitol=6
-    if itol&lt;maxitol: itol=itol+1
-    ltol.configure(text='Tol    '+str(ntol[itol]))
-
-#------------------------------------------------------ dectol
-def dectol(event):
-    global itol
-    if itol&gt;0 : itol=itol-1
-    ltol.configure(text='Tol    '+str(ntol[itol]))
-
-#------------------------------------------------------ incdsec
-def incdsec(event):
-    global idsec
-    idsec=idsec+5
-    bg='red'
-    if idsec==0: bg='white'
-    ldsec.configure(text='Dsec  '+str(0.1*idsec),bg=bg)
-    Audio.gcom1.ndsec=idsec
-
-#------------------------------------------------------ decdsec
-def decdsec(event):
-    global idsec
-    idsec=idsec-5
-    bg='red'
-    if idsec==0: bg='white'
-    ldsec.configure(text='Dsec  '+str(0.1*idsec),bg=bg)
-    Audio.gcom1.ndsec=idsec
-
-#------------------------------------------------------ toggle_shift
-def toggle_shift(event):
-    Audio.gcom2.nadd5=1-Audio.gcom2.nadd5
-    if Audio.gcom2.nadd5:
-        bg='red'
-        lshift.configure(text='Shift 5.0',bg=bg)
-    else:
-        bg='white'
-        lshift.configure(text='Shift 0.0',bg=bg)
-
-#------------------------------------------------------ inctrperiod
-def inctrperiod(event):
-    global ncwtrperiod
-    if mode.get()[:2]==&quot;CW&quot;:
-        if ncwtrperiod==120: ncwtrperiod=150
-        if ncwtrperiod==60:  ncwtrperiod=120
-        Audio.gcom1.trperiod=ncwtrperiod
-
-#------------------------------------------------------ dectrperiod
-def dectrperiod(event):
-    global ncwtrperiod
-    if mode.get()[:2]==&quot;CW&quot;:
-        if ncwtrperiod==120: ncwtrperiod=60
-        if ncwtrperiod==150: ncwtrperiod=120
-        Audio.gcom1.trperiod=ncwtrperiod
-
-#------------------------------------------------------ erase
-def erase(event=NONE):
-    graph1.delete(ALL)
-    if mode.get()[:4]!=&quot;JT65&quot; and mode.get()[:2]!=&quot;CW&quot;: graph2.delete(ALL)
-    text.configure(state=NORMAL)
-    text.delete('1.0',END)
-    text.configure(state=DISABLED)
-    avetext.configure(state=NORMAL)
-    avetext.delete('1.0',END)
-    avetext.configure(state=DISABLED)
-    lab3.configure(text=&quot; &quot;)
-    Audio.gcom2.decodedfile=&quot;                        &quot;
-#------------------------------------------------------ clear_avg
-def clear_avg(event=NONE):
-    avetext.configure(state=NORMAL)
-    avetext.delete('1.0',END)
-    avetext.configure(state=DISABLED)
-    f=open(appdir+'/decoded.ave',mode='w')
-    f.truncate(0)                           #Delete contents of decoded.ave
-    f.close()
-    Audio.gcom2.nclearave=1
-
-#------------------------------------------------------ defaults
-def defaults():
-    global slabel,isync,iclip,itol,idsec
-    isync=1
-    if g.mode==&quot;FSK441&quot;: isync=2
-    iclip=0
-    lclip.configure(text='Clip   '+str(iclip))
-    itol=5
-    ltol.configure(text='Tol    '+str(ntol[itol]))
-    if g.mode==&quot;JT6M&quot;:
-        isync=-10
-        itol=4
-        ltol.configure(text='Tol    '+str(ntol[itol]))
-    lsync.configure(text=slabel+str(isync))
-
-#------------------------------------------------------ delwav
-def delwav():
-    t=&quot;Are you sure you want to delete\nall *.WAV files in the RxWav directory?&quot;
-    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),message_text=t)
-    msg.geometry(msgpos())
-    if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
-    msg.focus_set()
-    result=msg.activate()
-    if result == 'Yes':
-# Make a list of *.wav files in RxWav
-        la=dircache.listdir(appdir+'/RxWav')
-        lb=[]
-        for i in range(len(la)):
-            j=la[i].find(&quot;.wav&quot;) + la[i].find(&quot;.WAV&quot;)
-            if j&gt;0: lb.append(la[i])
-# Now delete them all.
-        for i in range(len(lb)):
-            fname=appdir+'/RxWav/'+lb[i]
-            os.remove(fname)
-
-#------------------------------------------------------ del_all
-def del_all():
-    Audio.gcom1.ns0=-999999
-
-#------------------------------------------------------ toggleauto
-def toggleauto(event=NONE):
-    global lauto
-    lauto=1-lauto
-    Audio.gcom2.lauto=lauto
-    if lauto:
-        monitor()
-    else:
-        Audio.gcom1.txok=0
-        Audio.gcom2.mantx=0
-    if lauto==0: auto.configure(text='Auto is OFF',bg='gray85',relief=RAISED)
-    if lauto==1: auto.configure(text='Auto is ON',bg='red',relief=SOLID)
-    
-#----------------------------------------------------- dtdf_change
-# Readout of graphical cursor location
-def dtdf_change(event):
-    if mode.get()[:4]!=&quot;JT65&quot;:
-        t=&quot;%.1f&quot; % (event.x*30.0/500.0,)
-        lab6.configure(text=t,bg='green')
-    else:
-        if event.y&lt;40 and Audio.gcom2.nspecial==0:
-            lab1.configure(text='Time (s)',bg=&quot;#33FFFF&quot;)   #light blue
-            t=&quot;%.1f&quot; % (12.0*event.x/500.0-2.0,)
-            lab6.configure(text=t,bg=&quot;#33FFFF&quot;)
-        elif (event.y&gt;=40 and event.y&lt;95) or \
-                 (event.y&lt;95 and Audio.gcom2.nspecial&gt;0):
-            lab1.configure(text='DF (Hz)',bg='red')
-            idf=Audio.gcom2.idf
-            t=&quot;%d&quot; % int(idf+1200.0*event.x/500.0-600.0,)
-            lab6.configure(text=t,bg=&quot;red&quot;)
-        else:
-            lab1.configure(text='Time (s)',bg='green')
-            t=&quot;%.1f&quot; % (53.0*event.x/500.0,)
-            lab6.configure(text=t,bg=&quot;green&quot;)
-
-#---------------------------------------------------- mouse_click_g1
-def mouse_click_g1(event):
-    global nopen
-    if not nopen:
-        if mode.get()[:4]==&quot;JT65&quot;:
-            Audio.gcom2.mousedf=int(Audio.gcom2.idf+(event.x-250)*2.4)
-        else:
-            if Audio.gcom2.ndecoding==0:              #If decoder is busy, ignore
-                Audio.gcom2.nagain=1
-                Audio.gcom2.mousebutton=event.num     #Left=1, Right=3
-                Audio.gcom2.npingtime=int(195+60*event.x) #Time (ms) of mouse-picked ping
-                if Audio.gcom2.ndecoding0==4:
-                    Audio.gcom2.ndecoding=4           #Decode from recorded file
-                elif Audio.gcom2.ndecoding0==1:
-                    Audio.gcom2.ndecoding=5        #Decode data in main screen
-    nopen=0
-
-#------------------------------------------------------ double-click_g1
-def double_click_g1(event):
-    if g.mode[:4]=='JT65' and Audio.gcom2.ndecoding==0:
-        g.freeze_decode=1
-    
-#------------------------------------------------------ mouse_up_g1
-def mouse_up_g1(event):
-#    print event.x
-    pass
-
-#------------------------------------------------------ right_arrow
-def right_arrow(event=NONE):
-    n=5*int(Audio.gcom2.mousedf/5) + 5
-    if n==Audio.gcom2.mousedf: n=n+5
-    Audio.gcom2.mousedf=n
-
-#------------------------------------------------------ left_arrow
-def left_arrow(event=NONE):
-    n=5*int(Audio.gcom2.mousedf/5)
-    if n==Audio.gcom2.mousedf: n=n-5
-    Audio.gcom2.mousedf=n
-    
-#------------------------------------------------------ GenStdMsgs
-def GenStdMsgs(event=NONE):
-    global altmsg
-    t=ToRadio.get().upper().strip()
-    ToRadio.delete(0,99)
-    ToRadio.insert(0,t)
-    if k2txb.get()!=0: ntx.set(1)
-    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
-    for m in (tx1, tx2, tx3, tx4, tx5, tx6):
-        m.delete(0,99)
-    if mode.get()==&quot;FSK441&quot; or mode.get()==&quot;JT6M&quot;:
-        r=report.get()
-        tx1.insert(0,setmsg(options.tx1.get(),r))
-        tx2.insert(0,setmsg(options.tx2.get(),r))
-        tx3.insert(0,setmsg(options.tx3.get(),r))
-        tx4.insert(0,setmsg(options.tx4.get(),r))
-        tx5.insert(0,setmsg(options.tx5.get(),r))
-        tx6.insert(0,setmsg(options.tx6.get(),r))
-    elif mode.get()[:4]==&quot;JT65&quot;:
-        if ToRadio.get().find(&quot;/&quot;) == -1 and \
-               options.MyCall.get().find(&quot;/&quot;) == -1:
-            t=ToRadio.get() + &quot; &quot;+options.MyCall.get() + &quot; &quot;+options.MyGrid.get()[:4]
-            tx1.insert(0,t.upper())
-        else:
-            tx1.insert(0,ToRadio.get() + &quot; &quot;+options.MyCall.get())
-        tx2.insert(0,tx1.get()+&quot; OOO&quot;)
-        tx3.insert(0,&quot;RO&quot;)
-        tx4.insert(0,&quot;RRR&quot;)
-        tx5.insert(0,&quot;73&quot;)
-        t=&quot;CQ &quot; + options.MyCall.get()+ &quot; &quot;+options.MyGrid.get()[:4]
-        tx6.insert(0,t.upper())
-        altmsg=0
-    elif mode.get()[:2]==&quot;CW&quot;:
-        tx1.insert(0,ToRadio.get() + &quot; &quot;+options.MyCall.get())
-        tx2.insert(0,tx1.get()+&quot; OOO&quot;)
-        tx3.insert(0,tx1.get()+&quot; RO&quot;)
-        tx4.insert(0,tx1.get()+&quot; RRR&quot;)
-        tx5.insert(0,tx1.get()+&quot; 73&quot;)
-        tx6.insert(0,&quot;CQ &quot; + options.MyCall.get())
-    
-#------------------------------------------------------ GenAltMsgs
-def GenAltMsgs(event=NONE):
-    global altmsg,tx6alt
-    t=ToRadio.get().upper().strip()
-    ToRadio.delete(0,99)
-    ToRadio.insert(0,t)
-    if k2txb.get()!=0: ntx.set(1)
-    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
-    if mode.get()[:4]==&quot;JT65&quot; and ToRadio.get().find(&quot;/&quot;) == -1 and \
-               options.MyCall.get().find(&quot;/&quot;) == -1:
-        for m in (tx1, tx2, tx3, tx4, tx5, tx6):
-            m.delete(0,99)
-        t=ToRadio.get() + &quot; &quot;+options.MyCall.get()
-        tx1.insert(0,t.upper())
-        tx2.insert(0,tx1.get()+&quot; OOO&quot;)
-        tx3.insert(0,tx1.get()+&quot; RO&quot;)
-        tx4.insert(0,tx1.get()+&quot; RRR&quot;)
-        tx5.insert(0,&quot;TNX 73 GL &quot;)
-        tx6.insert(0,tx6alt.upper())
-        altmsg=1
-
-#------------------------------------------------------ setmsg
-def setmsg(template,r):
-    msg=&quot;&quot;
-    npct=0
-    for i in range(len(template)):
-        if npct:
-            if template[i]==&quot;M&quot;: msg=msg+options.MyCall.get().upper().strip()
-            if template[i]==&quot;T&quot;: msg=msg+ToRadio.get().upper().strip()
-            if template[i]==&quot;R&quot;: msg=msg+r
-            if template[i]==&quot;G&quot;: msg=msg+options.MyGrid.get()[:4]
-            if template[i]==&quot;L&quot;: msg=msg+options.MyGrid.get()
-            npct=0
-        else:
-            npct=0
-            if template[i]==&quot;%&quot;:
-                npct=1
-            else:
-                msg=msg+template[i]            
-    return msg.upper()
-    
-#------------------------------------------------------ plot_large
-def plot_large():
-    &quot;Plot the green, red, and blue curves in JT65 mode.&quot;
-    graph1.delete(ALL)
-    y=[]
-    ngreen=Audio.gcom2.ngreen
-    if ngreen&gt;0:
-        for i in range(ngreen):             #Find ymax for green curve
-            green=Audio.gcom2.green[i]
-            y.append(green)
-        ymax=max(y)
-        if ymax&lt;1: ymax=1
-        yfac=4.0
-        if ymax&gt;75.0/yfac: yfac=75.0/ymax
-        xy=[]
-        for i in range(ngreen):             #Make xy list for green curve
-            green=Audio.gcom2.green[i]
-            n=int(105.0-yfac*green)
-            xy.append(i)
-            xy.append(n)
-        graph1.create_line(xy,fill=&quot;green&quot;)
-
-        if Audio.gcom2.nspecial==0:
-            y=[]
-            for i in range(446):                #Find ymax for red curve
-                psavg=Audio.gcom2.psavg[i+1]
-                y.append(psavg)
-            ymax=max(y)
-            yfac=30.0
-            if ymax&gt;85.0/yfac: yfac=85.0/ymax
-            xy=[]
-            fac=500.0/446.0
-            for i in range(446):                #Make xy list for red curve
-                x=i*fac
-                psavg=Audio.gcom2.psavg[i+1]
-                n=int(90.0-yfac*psavg)
-                xy.append(x)
-                xy.append(n)
-            graph1.create_line(xy,fill=&quot;red&quot;)
-        else:
-            y1=[]
-            y2=[]
-            for i in range(446):        #Find ymax for magenta/orange curves
-                ss1=Audio.gcom2.ss1[i+1]
-                y1.append(ss1)
-                ss2=Audio.gcom2.ss2[i+1]
-                y2.append(ss2)
-            ymax=max(y1+y2)
-            yfac=30.0
-            if ymax&gt;85.0/yfac: yfac=85.0/ymax
-            xy1=[]
-            xy2=[]
-            fac=500.0/446.0
-            for i in range(446):        #Make xy list for magenta/orange curves
-                x=i*fac
-                ss1=Audio.gcom2.ss1[i+1]
-                n=int(90.0-yfac*ss1)
-                xy1.append(x)
-                xy1.append(n)
-                ss2=Audio.gcom2.ss2[i+1]
-                n=int(90.0-yfac*ss2) - 20
-                xy2.append(x)
-                xy2.append(n)
-            graph1.create_line(xy1,fill=&quot;magenta&quot;)
-            graph1.create_line(xy2,fill=&quot;orange&quot;)
-
-            x1 = 250.0 + fac*Audio.gcom2.ndf/2.6916504
-            x2 = x1 + Audio.gcom2.mode65*Audio.gcom2.nspecial*10*fac
-            graph1.create_line([x1,85,x1,95],fill=&quot;yellow&quot;)
-            graph1.create_line([x2,85,x2,95],fill=&quot;yellow&quot;)
-            t=&quot;RO&quot;
-            if Audio.gcom2.nspecial==3: t=&quot;RRR&quot;
-            if Audio.gcom2.nspecial==4: t=&quot;73&quot;
-            graph1.create_text(x2+3,93,anchor=W,text=t,fill=&quot;yellow&quot;)
-
-        if Audio.gcom2.ccf[0] != -9999.0:
-            y=[]
-            for i in range(65):             #Find ymax for blue curve
-                ccf=Audio.gcom2.ccf[i]
-                y.append(ccf)
-            ymax=max(y)
-            yfac=40.0
-            if ymax&gt;55.0/yfac: yfac=55.0/ymax
-            xy2=[]
-            fac=500.0/64.6
-            for i in range(65):             #Make xy list for blue curve
-                x=(i+0.5)*fac
-                ccf=Audio.gcom2.ccf[i]
-                n=int(60.0-yfac*ccf)
-                xy2.append(x)
-                xy2.append(n)
-            graph1.create_line(xy2,fill='#33FFFF')
-
-#  Put in the tick marks
-        for i in range(13):
-            x=int(i*41.667)
-            j2=115
-            if i==1 or i==6 or i==11: j2=110
-            graph1.create_line([x,j2,x,125],fill=&quot;red&quot;)
-            if Audio.gcom2.nspecial==0:
-#                x=int((i-0.8)*41.667)
-                j1=9
-                if i==2 or i==7 or i==12: j1=14
-                graph1.create_line([x,0,x,j1],fill=&quot;#33FFFF&quot;)  #light blue
-            else:
-                graph1.create_line([x,0,x,125-j2],fill=&quot;red&quot;)
-
-#------------------------------------------------------ plot_small
-def plot_small():        
-    graph2.delete(ALL)
-    xy=[]
-    xy2=[]
-    df=11025.0/256.0
-    fac=150.0/3500.0
-    for i in range(81):
-        x=int(i*df*fac)
-        xy.append(x)
-        psavg=Audio.gcom2.psavg[i]
-        if mode.get()==&quot;JT6M&quot;: psavg=psavg + 27.959
-        n=int(150.0-2*psavg)
-        xy.append(n)
-        if mode.get()=='FSK441':    
-            ps0=Audio.gcom2.ps0[i]
-            n=int(150.0-2*ps0)
-            xy2.append(x)
-            xy2.append(n)
-    graph2.create_line(xy,fill=&quot;magenta&quot;)
-    if mode.get()=='JT6M':
-        plot_yellow()
-    elif mode.get()=='FSK441':
-        graph2.create_line(xy2,fill=&quot;red&quot;)
-        for i in range(4):
-            x=(i+2)*441*fac
-            graph2.create_line([x,0,x,20],fill=&quot;yellow&quot;)
-    for i in range(7):
-        x=i*500*fac
-        ytop=110
-        if i%2: ytop=115
-        graph2.create_line([x,120,x,ytop],fill=&quot;white&quot;)
-
-#------------------------------------------------------ plot_yellow
-def plot_yellow():
-    nz=int(Audio.gcom2.ps0[215])
-    if nz&gt;10:
-        y=[]
-        for i in range(nz):             #Find ymax for yellow curve
-            n=Audio.gcom2.ps0[i]
-            y.append(n)
-        ymax=max(y)
-        fac=1.0
-        if ymax&gt;60: fac=60.0/ymax
-        xy2=[]
-        for i in range(nz):
-            x=int(2.34*i)
-            y=fac*Audio.gcom2.ps0[i] + 8
-            n=int(85.0-y)
-            xy2.append(x)
-            xy2.append(n)
-        graph1.create_line(xy2,fill=&quot;yellow&quot;)
-
-#------------------------------------------------------ bandmap
-def bandmap(event=NONE):
-    global Version,bm,bm_geom
-    bm=Toplevel(root)
-    bm.geometry(bm_geom)
-    if g.Win32: bm.iconbitmap(&quot;wsjt.ico&quot;)
-    iframe_bm1 = Frame(bm, bd=1, relief=SUNKEN)
-    text=Text(iframe_bm1, height=35, width=30, bg=&quot;Navy&quot;)
-    text.pack(side=LEFT, fill=X, padx=1)
-    text.pack(side=LEFT, fill=X, padx=1)
-    sb = Scrollbar(iframe_bm1, orient=VERTICAL, command=text.yview)
-    sb.pack(side=RIGHT, fill=Y)
-    text.configure(yscrollcommand=sb.set)
-    iframe_bm1.pack(expand=1, fill=X, padx=4)
-
-#------------------------------------------------------ update
-def update():
-    global root_geom,isec0,naz,nel,ndmiles,ndkm,nhotaz,nhotabetter,nopen, \
-           im,pim,cmap0,isync,isync441,isync6m,isync65,isync_save,idsec, \
-           first,itol,txsnrdb,tx6alt,bm_geom
-    
-    utc=time.gmtime(time.time()+0.1*idsec)
-    isec=utc[5]
-
-    if isec != isec0:                           #Do once per second
-        isec0=isec
-        t=time.strftime('%Y %b %d\n%H:%M:%S',utc)
-        Audio.gcom2.utcdate=t[:12]
-        ldate.configure(text=t)
-        root_geom=root.geometry()
-        bm_geom=bm.geometry()
-        utchours=utc[3]+utc[4]/60.0 + utc[5]/3600.0
-        naz,nel,ndmiles,ndkm,nhotaz,nhotabetter=Audio.azdist0( \
-            options.MyGrid.get().upper(),HisGrid.get().upper(),utchours)
-        azdist()
-        g.nfreq=nfreq.get()
-
-        if Audio.gcom2.ndecoding==0:
-            g.AzSun,g.ElSun,g.AzMoon,g.ElMoon,g.AzMoonB,g.ElMoonB,g.ntsky, \
-                g.ndop,g.ndop00,g.dbMoon,g.RAMoon,g.DecMoon,g.HA8,g.Dgrd,  \
-                g.sd,g.poloffset,g.MaxNR,g.dfdt,g.dfdt0,g.RaAux,g.DecAux, \
-                g.AzAux,g.ElAux = Audio.astro0(utc[0],utc[1],utc[2],  \
-                utchours,nfreq.get(),options.MyGrid.get().upper(), \
-                    options.auxra.get()+'         '[:9],     \
-                    options.auxdec.get()+'         '[:9])
-
-            if len(HisGrid.get().strip())&lt;4:
-                g.ndop=g.ndop00
-                g.dfdt=g.dfdt0
-
-        if mode.get()[:4]=='JT65' or mode.get()[:2]=='CW' :
-            graph2.delete(ALL)
-            graph2.create_text(80,13,anchor=CENTER,text=&quot;Moon&quot;,font=g2font)
-            graph2.create_text(13,37,anchor=W, text=&quot;Az: %6.2f&quot; % g.AzMoon,font=g2font)
-            graph2.create_text(13,61,anchor=W, text=&quot;El: %6.2f&quot; % g.ElMoon,font=g2font)
-            graph2.create_text(13,85,anchor=W, text=&quot;Dop:%6d&quot; % g.ndop,font=g2font)
-            graph2.create_text(13,109,anchor=W,text=&quot;Dgrd:%5.1f&quot; % g.Dgrd,font=g2font)
-
-    if g.freeze_decode and mode.get()[:4]=='JT65':
-        itol=2
-        ltol.configure(text='Tol    '+str(50))
-        Audio.gcom2.dftolerance=50
-        nfreeze.set(1)
-        Audio.gcom2.nfreeze=1
-        if Audio.gcom2.monitoring:
-            Audio.gcom2.ndecoding=1
-            Audio.gcom2.nagain=0
-        else:
-            Audio.gcom2.ndecoding=4
-            Audio.gcom2.nagain=1
-        g.freeze_decode=0
-        
-    n=int(20.0*log10(g.rms/770.0+0.01))
-    t=&quot;Rx noise:%3d dB&quot; % (n,)
-    if n&gt;=-10 and n&lt;=10:
-        msg4.configure(text=t,bg='gray85')
-    else:
-        msg4.configure(text=t,bg='red')
-
-    t=g.ftnstr(Audio.gcom2.decodedfile)
-#    i=t.rfind(&quot;.&quot;)
-    i=g.rfnd(t,&quot;.&quot;)
-    t=t[:i]
-    lab3.configure(text=t)
-    if mode.get() != g.mode or first:
-        if mode.get()==&quot;FSK441&quot;:
-            msg2.configure(bg='yellow')
-        elif mode.get()==&quot;JT65A&quot; or mode.get()==&quot;JT65B&quot; or mode.get()==&quot;JT65C&quot;:
-            msg2.configure(bg='#00FFFF')
-        elif mode.get()==&quot;JT6M&quot;:
-            msg2.configure(bg='#FF00FF')
-        elif mode.get()==&quot;CW&quot;:
-            msg2.configure(bg='#00FF00')
-#        elif mode.get()==&quot;Echo&quot;:
-#            msg2.configure(bg='#FF0000')
-        g.mode=mode.get()
-        first=0
-
-    samfac_in=Audio.gcom1.mfsample/110250.0
-    samfac_out=Audio.gcom1.mfsample2/110250.0
-    xin=1
-    xout=1
-    try:
-        xin=samfac_in/options.samfacin.get()
-        xout=samfac_out/options.samfacout.get()
-        if xin&lt;0.999 or xin&gt;1.001 or xout&lt;0.999 or xout&gt;1.001:
-            lab8.configure(text=&quot;%6.4f   %6.4f&quot; \
-                % (options.samfacin.get(),options.samfacout.get()), \
-                fg='black',bg='red')
-        else:
-            lab8.configure(fg='gray85',bg='gray85')
-    except:
-        pass
-
-    msg1.configure(text=&quot;%6.4f %6.4f&quot; % (samfac_in,samfac_out))
-    msg2.configure(text=mode.get())
-    t=&quot;Freeze DF:%4d&quot; % (int(Audio.gcom2.mousedf),)
-    if abs(int(Audio.gcom2.mousedf))&gt;600:
-        msg3.configure(text=t,fg='black',bg='red')
-    else:
-        msg3.configure(text=t,fg='black',bg='gray85')    
-    bdecode.configure(bg='gray85',activebackground='gray95')
-    if Audio.gcom2.ndecoding:       #Set button bg=light_blue while decoding
-        bdecode.configure(bg='#66FFFF',activebackground='#66FFFF')
-    if mode.get()[:2]==&quot;CW&quot;:
-        msg5.configure(text=&quot;TR Period: %d s&quot; % (Audio.gcom1.trperiod,), \
-                       bg='white')
-    else:
-        msg5.configure(text=&quot;TR Period: %d s&quot; % (Audio.gcom1.trperiod,), \
-                       bg='gray85')
-
-    tx1.configure(bg='white')
-    tx2.configure(bg='white')
-    tx3.configure(bg='white')
-    tx4.configure(bg='white')
-    tx5.configure(bg='white')
-    tx6.configure(bg='white')
-    if tx6.get()[:1]=='#':
-        try:
-            txsnrdb=float(tx6.get()[1:])
-            if txsnrdb&gt;-99.0 and txsnrdb&lt;40.0:
-                Audio.gcom1.txsnrdb=txsnrdb
-                tx6.configure(bg='orange')
-        except:
-            txsnrdb=99.0
-    else:
-        txsnrdb=99.0
-        Audio.gcom1.txsnrdb=txsnrdb
-    if Audio.gcom2.monitoring and not Audio.gcom1.transmitting:
-        bmonitor.configure(bg='green')
-    else:
-        bmonitor.configure(bg='gray85')    
-    if Audio.gcom1.transmitting:
-        nmsg=int(Audio.gcom2.nmsg)
-        t=g.ftnstr(Audio.gcom2.sending)
-        if t[:3]==&quot;CQ &quot;: nsked.set(0)
-        t=&quot;Txing:  &quot;+t[:nmsg]
-        bgcolor='yellow'
-        if Audio.gcom2.sendingsh==1:  bgcolor='#66FFFF'    #Shorthand (lt blue)
-        if Audio.gcom2.sendingsh==-1: bgcolor='red'        #Plain Text
-        if Audio.gcom2.sendingsh==2: bgcolor='pink'        #Test file
-        if txsnrdb&lt;90.0: bgcolor='orange'                  #Simulation mode
-        if Audio.gcom2.ntxnow==1: tx1.configure(bg=bgcolor)
-        elif Audio.gcom2.ntxnow==2: tx2.configure(bg=bgcolor)
-        elif Audio.gcom2.ntxnow==3: tx3.configure(bg=bgcolor)
-        elif Audio.gcom2.ntxnow==4: tx4.configure(bg=bgcolor)
-        elif Audio.gcom2.ntxnow==5: tx5.configure(bg=bgcolor)
-        else: tx6.configure(bg=bgcolor)
-    else:
-        bgcolor='green'
-        t='Receiving'
-    msg7.configure(text=t,bg=bgcolor)
-
-    if Audio.gcom2.ndecdone==1 or g.cmap != cmap0:
-        if Audio.gcom2.ndecdone==1:
-            if isync==-99 or isync==99:
-                isync=isync_save
-                Audio.gcom2.minsigdb=isync
-            try:
-                f=open(appdir+'/decoded.txt',mode='r')
-                lines=f.readlines()
-                f.close()
-            except:
-                lines=&quot;&quot;
-            text.configure(state=NORMAL)
-            for i in range(len(lines)):
-                text.insert(END,lines[i])
-            text.see(END)
-#            text.configure(state=DISABLED)
-
-            if mode.get()[:4]=='JT65':
-                try:
-                    f=open(appdir+'/decoded.ave',mode='r')
-                    lines=f.readlines()
-                    f.close()
-                except:
-                    lines[0]=&quot;&quot;
-                    lines[1]=&quot;&quot;
-                avetext.configure(state=NORMAL)
-                avetext.delete('1.0',END)
-                if len(lines)&gt;1:
-                    avetext.insert(END,lines[0])
-                    avetext.insert(END,lines[1])
-#                avetext.configure(state=DISABLED)
-            Audio.gcom2.ndecdone=2
-        
-        if g.cmap != cmap0:
-            im.putpalette(g.palette)
-            cmap0=g.cmap
-
-        if mode.get()[:4]=='JT65':
-            plot_large()
-        else:    
-            im.putdata(Audio.gcom2.b)
-            pim=ImageTk.PhotoImage(im)          #Convert Image to PhotoImage
-            graph1.delete(ALL)
-# NB: top two lines are probably invisible ...
-            graph1.create_image(0,0,anchor='nw',image=pim)
-            t=g.filetime(g.ftnstr(Audio.gcom2.decodedfile))
-            graph1.create_text(100,80,anchor=W,text=t,fill=&quot;white&quot;)
-            plot_small()
-        if loopall: opennext()
-        nopen=0
-
-# Save some parameters
-    g.mode=mode.get()
-    g.report=report.get()
-    if mode.get()=='FSK441': isync441=isync
-    elif mode.get()=='JT6M': isync6m=isync
-    elif mode.get()[:4]=='JT65': isync65=isync
-    Audio.gcom1.txfirst=TxFirst.get()
-    try:
-        Audio.gcom1.samfacin=options.samfacin.get()
-    except:
-        Audio.gcom1.samfacin=1.0
-    try:
-        Audio.gcom1.samfacout=options.samfacout.get()
-    except:
-        Audio.gcom1.samfacout=1.0
-#    if Audio.gcom1.samfacin&gt;1.01: Audio.gcom1.samfacin=1.01
-# ... etc.
-    Audio.gcom2.mycall=(options.MyCall.get()+'            ')[:12]
-    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
-    Audio.gcom2.hisgrid=(HisGrid.get()+'      ')[:6]
-    Audio.gcom4.addpfx=(options.addpfx.get().lstrip()+'        ')[:8]
-    Audio.gcom2.ntxreq=ntx.get()
-    tx=(tx1,tx2,tx3,tx4,tx5,tx6)
-    Audio.gcom2.txmsg=(tx[ntx.get()-1].get()+'                            ')[:28]
-    Audio.gcom2.mode=(mode.get()+'      ')[:6]
-    Audio.gcom2.shok=ShOK.get()
-    Audio.gcom2.nsave=nsave.get()
-    Audio.gcom2.nzap=nzap.get()
-    Audio.gcom2.ndebug=ndebug.get()
-    Audio.gcom2.minsigdb=isync
-    Audio.gcom2.nclip=iclip
-    Audio.gcom2.nblank=nblank.get()
-    Audio.gcom2.nafc=nafc.get()
-    Audio.gcom2.nfreeze=nfreeze.get()
-    Audio.gcom2.dftolerance=ntol[itol]
-    Audio.gcom2.neme=neme.get()
-    Audio.gcom2.ndepth=ndepth.get()
-    Audio.gcom2.nsked=nsked.get()
-    try:
-        Audio.gcom2.idinterval=options.IDinterval.get()
-    except:
-        Audio.gcom2.idinterval=0
-    Audio.gcom2.ntx2=0
-#    Audio.gcom1.rxdelay=float('0'+options.RxDelay.get())
-#    Audio.gcom1.txdelay=float('0'+options.TxDelay.get())
-    if ntx.get()==1 and noshjt65.get()==1: Audio.gcom2.ntx2=1
-    Audio.gcom2.nslim2=isync-4
-    if nosh441.get()==1 and mode.get()=='FSK441': Audio.gcom2.nslim2=99
-    try:
-        Audio.gcom2.nport=int(options.PttPort.get())
-    except:
-        Audio.gcom2.nport=0
-
-#    print 'About to init Audio.gcom2.PttPort in save some parameters'
-    Audio.gcom2.pttport=(options.PttPort.get() + '            ')[:12]
-#    print Audio.gcom2.pttport
-
-    if altmsg: tx6alt=tx6.get()    
-# Queue up the next update
-    ldate.after(100,update)
-    
-#------------------------------------------------------ Top level frame
-frame = Frame(root)
-
-#------------------------------------------------------ Menu Bar
-mbar = Frame(frame)
-mbar.pack(fill = X)
-
-#------------------------------------------------------ File Menu
-filebutton = Menubutton(mbar, text = 'File')
-filebutton.pack(side = LEFT)
-filemenu = Menu(filebutton, tearoff=0)
-filebutton['menu'] = filemenu
-filemenu.add('command', label = 'Open', command = openfile, \
-             accelerator='Ctrl+O')
-filemenu.add('command', label = 'Open next in directory', command = opennext, \
-             accelerator='F6')
-filemenu.add('command', label = 'Decode remaining files in directory', \
-             command = decodeall, accelerator='Shift+F6')
-filemenu.add_separator()
-filemenu.add('command', label = 'Delete all *.WAV files in RxWav', \
-             command = delwav)
-filemenu.add_separator()
-filemenu.add('command', label = 'Erase ALL.TXT', command = del_all)
-filemenu.add_separator()
-filemenu.add('command', label = 'Exit', command = quit)
-
-#------------------------------------------------------ Setup menu
-setupbutton = Menubutton(mbar, text = 'Setup')
-setupbutton.pack(side = LEFT)
-setupmenu = Menu(setupbutton, tearoff=0)
-setupbutton['menu'] = setupmenu
-setupmenu.add('command', label = 'Options', command = options1, \
-              accelerator='F2')
-setupmenu.add_separator()
-setupmenu.add('command', label = 'Toggle size of text window', command=textsize)
-setupmenu.add('command', label = 'Generate messages for test tones', command=testmsgs)
-setupmenu.add_separator()
-setupmenu.add_checkbutton(label = 'F4 sets Tx6',variable=kb8rq)
-setupmenu.add_checkbutton(label = 'Double-click on callsign sets TxFirst',
-                          variable=setseq)
-setupmenu.add_checkbutton(label = 'GenStdMsgs sets Tx1',variable=k2txb)
-setupmenu.add_separator()
-setupmenu.add_checkbutton(label = 'Enable diagnostics',variable=ndebug)
-
-#------------------------------------------------------ View menu
-viewbutton=Menubutton(mbar,text='View')
-viewbutton.pack(side=LEFT)
-viewmenu=Menu(viewbutton,tearoff=0)
-viewbutton['menu']=viewmenu
-viewmenu.add('command', label = 'SpecJT', command = showspecjt, \
-             accelerator='F10')
-viewmenu.add('command', label = 'Astronomical data', command = astro1, \
-             accelerator='Shift+F10')
-
-#------------------------------------------------------ Mode menu
-modebutton = Menubutton(mbar, text = 'Mode')
-modebutton.pack(side = LEFT)
-modemenu = Menu(modebutton, tearoff=0)
-modebutton['menu'] = modemenu
-modemenu.add_radiobutton(label = 'FSK441', variable=mode, \
-    command = ModeFSK441, state=NORMAL, accelerator='F7')
-
-# To enable menu item 0:
-# modemenu.entryconfig(0,state=NORMAL)
-# Can use the following to retrieve the state:
-# state=modemenu.entrycget(0,&quot;state&quot;)
-
-modemenu.add_radiobutton(label = 'JT6M', variable=mode, command = ModeJT6M, \
-                        accelerator='Shift+F7')
-modemenu.add_radiobutton(label = 'JT65A', variable=mode, command = ModeJT65A, \
-                         accelerator='F8')
-modemenu.add_radiobutton(label = 'JT65B', variable=mode, command = ModeJT65B, \
-                         accelerator='Shift+F8')
-modemenu.add_radiobutton(label = 'JT65C', variable=mode, command = ModeJT65C, \
-                         accelerator='Ctrl+F8')
-modemenu.add_radiobutton(label = 'CW', variable=mode, command = ModeCW, \
-                         accelerator='Shift+Ctrl+F8')
-#modemenu.add_radiobutton(label = 'Echo', variable=mode, command = ModeEcho,
-#                         state=DISABLED)
-
-#------------------------------------------------------ Decode menu
-decodebutton = Menubutton(mbar, text = 'Decode')
-decodebutton.pack(side = LEFT)
-decodemenu = Menu(decodebutton, tearoff=1)
-decodebutton['menu'] = decodemenu
-decodemenu.FSK441=Menu(decodemenu,tearoff=0)
-decodemenu.FSK441.add_checkbutton(label='No shorthands',variable=nosh441)
-decodemenu.JT65=Menu(decodemenu,tearoff=0)
-decodemenu.JT65.add_checkbutton(label='Only EME calls',variable=neme)
-decodemenu.JT65.add_checkbutton(label='No Shorthands if Tx 1',variable=noshjt65)
-decodemenu.JT65.add_separator()
-decodemenu.JT65.add_radiobutton(label = 'No Deep Search',
-                                variable=ndepth, value=0)
-decodemenu.JT65.add_radiobutton(label = 'Normal Deep Search',
-                                variable=ndepth, value=1)
-decodemenu.JT65.add_radiobutton(label = 'Aggressive Deep Search',
-                                variable=ndepth, value=2)
-decodemenu.JT65.add_radiobutton(label ='Include Average in Aggressive Deep Search',
-                                variable=ndepth, value=3)
-decodemenu.add_cascade(label = 'FSK441',menu=decodemenu.FSK441)
-decodemenu.add_cascade(label = 'JT65',menu=decodemenu.JT65)
-
-#------------------------------------------------------ Save menu
-savebutton = Menubutton(mbar, text = 'Save')
-savebutton.pack(side = LEFT)
-savemenu = Menu(savebutton, tearoff=1)
-savebutton['menu'] = savemenu
-nsave=IntVar()
-savemenu.add_radiobutton(label = 'None', variable=nsave,value=0)
-savemenu.add_radiobutton(label = 'Save decoded', variable=nsave,value=1)
-savemenu.add_radiobutton(label = 'Save if Auto On', variable=nsave,value=2)
-savemenu.add_radiobutton(label = 'Save all', variable=nsave,value=3)
-nsave.set(0)
-
-#------------------------------------------------------ Band menu
-bandbutton = Menubutton(mbar, text = 'Band')
-bandbutton.pack(side = LEFT)
-bandmenu = Menu(bandbutton, tearoff=1)
-bandbutton['menu'] = bandmenu
-nfreq=IntVar()
-bandmenu.add_radiobutton(label = '50', variable=nfreq,value=50)
-bandmenu.add_radiobutton(label = '144', variable=nfreq,value=144)
-bandmenu.add_radiobutton(label = '222', variable=nfreq,value=222)
-bandmenu.add_radiobutton(label = '432', variable=nfreq,value=432)
-bandmenu.add_radiobutton(label = '1296', variable=nfreq,value=1296)
-nfreq.set(144)
-#------------------------------------------------------ Help menu
-helpbutton = Menubutton(mbar, text = 'Help')
-helpbutton.pack(side = LEFT)
-helpmenu = Menu(helpbutton, tearoff=0)
-helpbutton['menu'] = helpmenu
-helpmenu.add('command', label = 'Keyboard shortcuts', command = shortcuts, \
-             accelerator='F1')
-helpmenu.add('command', label = 'Special mouse commands', \
-             command = mouse_commands, accelerator='Shift+F1')
-helpmenu.add('command', label = 'What message to send?', \
-             command = what2send, accelerator='F5')
-helpmenu.add('command', label = 'Available suffixes and add-on prefixes', \
-             command = prefixes)
-helpmenu.add('command', label = 'About MAP65', command = about, \
-             accelerator='Ctrl+F1')
-
-#------------------------------------------------------ Graphics areas
-iframe1 = Frame(frame, bd=1, relief=SUNKEN)
-graph1=Canvas(iframe1, bg='black', width=500, height=120,cursor='crosshair')
-Widget.bind(graph1,&quot;&lt;Motion&gt;&quot;,dtdf_change)
-Widget.bind(graph1,&quot;&lt;Button-1&gt;&quot;,mouse_click_g1)
-Widget.bind(graph1,&quot;&lt;Double-Button-1&gt;&quot;,double_click_g1)
-Widget.bind(graph1,&quot;&lt;ButtonRelease-1&gt;&quot;,mouse_up_g1)
-Widget.bind(graph1,&quot;&lt;Button-3&gt;&quot;,mouse_click_g1)
-graph1.pack(side=LEFT)
-graph2=Canvas(iframe1, bg='black', width=150, height=120,cursor='crosshair')
-graph2.pack(side=LEFT)
-g2font=graph2.option_get(&quot;font&quot;,&quot;font&quot;)
-if g2font!=&quot;&quot;: g.g2font=g2font
-iframe1.pack(expand=1, fill=X, padx=4)
-
-#------------------------------------------------------ Labels under graphics
-iframe2a = Frame(frame, bd=1, relief=FLAT, height=15)
-lab1=Label(iframe2a, text='Time (s)')
-lab1.place(x=250, y=6, anchor=CENTER)
-lab3=Label(iframe2a, text=' ')
-lab3.place(x=400,y=6, anchor=CENTER)
-lab4=Label(iframe2a, text='1             2            3')
-lab4.place(x=593,y=6, anchor=CENTER)
-iframe2a.pack(expand=1, fill=X, padx=1)
-iframe2 = Frame(frame, bd=1, relief=FLAT,height=15)
-lab2=Label(iframe2, text='FileID     Sync     dB        DT        DF      W')
-lab2.place(x=3,y=6, anchor='w')
-lab5=Label(iframe2, text='Freq (kHz)')
-lab5.place(x=580,y=6, anchor=CENTER)
-lab6=Label(iframe2a,text='0.0',bg='green')
-lab6.place(x=40,y=6, anchor=CENTER)
-lab7=Label(iframe2a,text='F3',fg='gray85')
-lab7.place(x=495,y=6, anchor=CENTER)
-lab8=Label(iframe2a,text='1.0000  1.0000',fg='gray85')
-lab8.place(x=135,y=6, anchor=CENTER)
-iframe2.pack(expand=1, fill=X, padx=4)
-
-#-------------------------------------------------------- Decoded text
-iframe4 = Frame(frame, bd=1, relief=SUNKEN)
-text=Text(iframe4, height=6, width=80)
-text.bind('&lt;Double-Button-1&gt;',dbl_click_text)
-#text.bind('&lt;Double-Button-3&gt;',dbl_click_text)
-text.bind('&lt;Key&gt;',textkey)
-
-root.bind_all('&lt;F1&gt;', shortcuts)
-root.bind_all('&lt;Shift-F1&gt;', mouse_commands)
-root.bind_all('&lt;Control-F1&gt;', about)
-root.bind_all('&lt;F2&gt;', options1)
-root.bind_all('&lt;F3&gt;', txmute)
-root.bind_all('&lt;F4&gt;', clrToRadio)
-root.bind_all('&lt;F5&gt;', what2send)
-root.bind_all('&lt;F6&gt;', opennext)
-root.bind_all('&lt;Shift-F6&gt;', decodeall)
-root.bind_all('&lt;F7&gt;', ModeFSK441)
-root.bind_all('&lt;F8&gt;', ModeJT65A)
-root.bind_all('&lt;Shift-F8&gt;', ModeJT65B)
-root.bind_all('&lt;Control-F8&gt;', ModeJT65C)
-root.bind_all('&lt;Shift-F7&gt;', ModeJT6M)
-root.bind_all('&lt;Shift-Control-F8&gt;', ModeCW)
-#root.bind_all('&lt;F9&gt;', ModeEcho)
-root.bind_all('&lt;F10&gt;', showspecjt)
-root.bind_all('&lt;Shift-F10&gt;', astro1)
-
-root.bind_all('&lt;Alt-Key-1&gt;',btx1)
-root.bind_all('&lt;Alt-Key-2&gt;',btx2)
-root.bind_all('&lt;Alt-Key-3&gt;',btx3)
-root.bind_all('&lt;Alt-Key-4&gt;',btx4)
-root.bind_all('&lt;Alt-Key-5&gt;',btx5)
-root.bind_all('&lt;Alt-Key-6&gt;',btx6)
-
-root.bind_all('&lt;Alt-a&gt;',toggleauto)
-root.bind_all('&lt;Alt-A&gt;',toggleauto)
-root.bind_all('&lt;Alt-c&gt;',clear_avg)
-root.bind_all('&lt;Alt-C&gt;',clear_avg)
-root.bind_all('&lt;Alt-d&gt;',decode)
-root.bind_all('&lt;Alt-D&gt;',decode)
-root.bind_all('&lt;Alt-e&gt;',erase)
-root.bind_all('&lt;Alt-E&gt;',erase)
-root.bind_all('&lt;Alt-f&gt;',toggle_freeze)
-root.bind_all('&lt;Alt-F&gt;',toggle_freeze)
-root.bind_all('&lt;Alt-g&gt;',GenStdMsgs)
-root.bind_all('&lt;Alt-G&gt;',GenStdMsgs)
-root.bind_all('&lt;Control-g&gt;', GenAltMsgs)
-root.bind_all('&lt;Control-G&gt;', GenAltMsgs)
-root.bind_all('&lt;Alt-i&gt;',decode_include)
-root.bind_all('&lt;Alt-I&gt;',decode_include)
-root.bind_all('&lt;Alt-l&gt;',lookup)
-root.bind_all('&lt;Alt-L&gt;',lookup)
-root.bind_all('&lt;Alt-m&gt;',monitor)
-root.bind_all('&lt;Alt-M&gt;',monitor)
-root.bind_all('&lt;Alt-o&gt;',txstop)
-root.bind_all('&lt;Alt-O&gt;',txstop)
-root.bind_all('&lt;Control-o&gt;',openfile)
-root.bind_all('&lt;Control-O&gt;',openfile)
-root.bind_all('&lt;Alt-q&gt;',logqso)
-root.bind_all('&lt;Alt-Q&gt;',logqso)
-root.bind_all('&lt;Alt-s&gt;',stopmon)
-root.bind_all('&lt;Alt-S&gt;',stopmon)
-root.bind_all('&lt;Alt-v&gt;',savelast)
-root.bind_all('&lt;Alt-V&gt;',savelast)
-root.bind_all('&lt;Alt-x&gt;',decode_exclude)
-root.bind_all('&lt;Alt-X&gt;',decode_exclude)
-root.bind_all('&lt;Alt-z&gt;',toggle_zap)
-root.bind_all('&lt;Alt-Z&gt;',toggle_zap)
-root.bind_all('&lt;Control-l&gt;',lookup_gen)
-root.bind_all('&lt;Control-L&gt;',lookup_gen)
-root.bind_all('&lt;Left&gt;',left_arrow)
-root.bind_all('&lt;Right&gt;',right_arrow)
-
-text.pack(side=LEFT, fill=X, padx=1)
-sb = Scrollbar(iframe4, orient=VERTICAL, command=text.yview)
-sb.pack(side=RIGHT, fill=Y)
-text.configure(yscrollcommand=sb.set)
-iframe4.pack(expand=1, fill=X, padx=4)
-iframe4b = Frame(frame, bd=1, relief=SUNKEN)
-avetext=Text(iframe4b, height=2, width=80)
-avetext.bind('&lt;Double-Button-1&gt;',dbl_click_ave)
-#avetext.bind('&lt;Double-Button-3&gt;',dbl_click_ave)
-avetext.bind('&lt;Key&gt;',avetextkey)
-avetext.pack(side=LEFT, fill=X, padx=1)
-iframe4b.pack(expand=1, fill=X, padx=4)
-
-#------------------------------------------------------- Button Bar
-iframe4c = Frame(frame, bd=1, relief=SUNKEN)
-blogqso=Button(iframe4c, text='Log QSO',underline=4,command=logqso,
-                padx=1,pady=1)
-bstop=Button(iframe4c, text='Stop',underline=0,command=stopmon,
-                padx=1,pady=1)
-bmonitor=Button(iframe4c, text='Monitor',underline=0,command=monitor,
-                padx=1,pady=1)
-bsavelast=Button(iframe4c, text='Save',underline=2,command=savelast,
-                padx=1,pady=1)
-bdecode=Button(iframe4c, text='Decode',underline=0,command=decode,
-                padx=1,pady=1)
-berase=Button(iframe4c, text='Erase',underline=0,command=erase,
-                padx=1,pady=1)
-bclravg=Button(iframe4c, text='Clear Avg',underline=0,command=clear_avg,
-                padx=1,pady=1)
-binclude=Button(iframe4c, text='Include',underline=0,
-                command=decode_include,padx=1,pady=1)
-bexclude=Button(iframe4c, text='Exclude',underline=1,
-                command=decode_exclude,padx=1,pady=1)
-btxstop=Button(iframe4c,text='TxStop',underline=4,command=txstop,
-                padx=1,pady=1)
-
-blogqso.pack(side=LEFT,expand=1,fill=X)
-#bplay.pack(side=LEFT,expand=1,fill=X)
-bstop.pack(side=LEFT,expand=1,fill=X)
-bmonitor.pack(side=LEFT,expand=1,fill=X)
-bsavelast.pack(side=LEFT,expand=1,fill=X)
-bdecode.pack(side=LEFT,expand=1,fill=X)
-berase.pack(side=LEFT,expand=1,fill=X)
-bclravg.pack(side=LEFT,expand=1,fill=X)
-binclude.pack(side=LEFT,expand=1,fill=X)
-bexclude.pack(side=LEFT,expand=1,fill=X)
-btxstop.pack(side=LEFT,expand=1,fill=X)
-iframe4c.pack(expand=1, fill=X, padx=4)
-
-#-----------------------------------------------------General control area
-iframe5 = Frame(frame, bd=1, relief=FLAT,height=180)
-
-#------------------------------------------------------ &quot;Other station&quot; info
-f5a=Frame(iframe5,height=170,bd=2,relief=GROOVE)
-labToRadio=Label(f5a,text='To radio:', width=9, relief=FLAT)
-labToRadio.grid(column=0,row=0)
-ToRadio=Entry(f5a,width=9)
-ToRadio.insert(0,'W8WN')
-ToRadio.grid(column=1,row=0,pady=3)
-bLookup=Button(f5a, text='Lookup',underline=0,command=lookup,padx=1,pady=1)
-bLookup.grid(column=2,row=0,sticky='EW',padx=4)
-labGrid=Label(f5a,text='Grid:', width=9, relief=FLAT)
-labGrid.grid(column=0,row=1)
-HisGrid=Entry(f5a,width=9)
-HisGrid.grid(column=1,row=1,pady=1)
-bAdd=Button(f5a, text='Add',command=addtodb,padx=1,pady=1)
-bAdd.grid(column=2,row=1,sticky='EW',padx=4)
-labAz=Label(f5a,text='Az 257  El 15',width=11)
-labAz.grid(column=1,row=2)
-labHotAB=Label(f5a,bg='#FFCCFF',text='HotA: 247')
-labHotAB.grid(column=0,row=2,sticky='EW',padx=4,pady=3)
-labDist=Label(f5a,text='16753 km')
-labDist.grid(column=2,row=2)
-
-#------------------------------------------------------ Date and Time
-ldate=Label(f5a, bg='black', fg='yellow', width=11, bd=4,
-        text='2005 Apr 22\n01:23:45', relief=RIDGE,
-        justify=CENTER, font=(font1,16))
-ldate.grid(column=0,columnspan=3,row=3,rowspan=2,pady=2)
-f5a.pack(side=LEFT,expand=1,fill=BOTH)
-
-#------------------------------------------------------ Receiving parameters
-f5b=Frame(iframe5,bd=2,relief=GROOVE)
-lsync=Label(f5b, bg='white', fg='black', text='Sync   1', width=8, relief=RIDGE)
-lsync.grid(column=0,row=0,padx=2,pady=1,sticky='EW')
-Widget.bind(lsync,'&lt;Button-1&gt;',incsync)
-Widget.bind(lsync,'&lt;Button-3&gt;',decsync)
-nzap=IntVar()
-cbzap=Checkbutton(f5b,text='Zap',underline=0,variable=nzap)
-cbzap.grid(column=1,row=0,padx=2,pady=1,sticky='W')
-cbnb=Checkbutton(f5b,text='NB',variable=nblank)
-cbnb.grid(column=1,row=1,padx=2,pady=1,sticky='W')
-cbfreeze=Checkbutton(f5b,text='Freeze',underline=0,variable=nfreeze)
-cbfreeze.grid(column=1,row=2,padx=2,sticky='W')
-cbafc=Checkbutton(f5b,text='AFC',variable=nafc)
-cbafc.grid(column=1,row=3,padx=2,pady=1,sticky='W')
-lclip=Label(f5b, bg='white', fg='black', text='Clip   0', width=8, relief=RIDGE)
-lclip.grid(column=0,row=1,padx=2,sticky='EW')
-Widget.bind(lclip,'&lt;Button-1&gt;',incclip)
-Widget.bind(lclip,'&lt;Button-3&gt;',decclip)
-ltol=Label(f5b, bg='white', fg='black', text='Tol    400', width=8, relief=RIDGE)
-ltol.grid(column=0,row=2,padx=2,pady=1,sticky='EW')
-Widget.bind(ltol,'&lt;Button-1&gt;',inctol)
-Widget.bind(ltol,'&lt;Button-3&gt;',dectol)
-Button(f5b,text='Defaults',command=defaults,padx=1,pady=1).grid(column=0,
-                              row=3,sticky='EW')
-ldsec=Label(f5b, bg='white', fg='black', text='Dsec  0.0', width=8, relief=RIDGE)
-ldsec.grid(column=0,row=4,ipadx=3,padx=2,pady=5,sticky='EW')
-lshift=Label(f5b, bg='white', fg='black', text='Shift 0.0', width=8, relief=RIDGE)
-lshift.grid(column=1,row=4,ipadx=3,padx=2,pady=5,sticky='EW')
-Widget.bind(ldsec,'&lt;Button-1&gt;',incdsec)
-Widget.bind(ldsec,'&lt;Button-3&gt;',decdsec)
-Widget.bind(lshift,'&lt;Button-1&gt;',toggle_shift)
-
-f5b.pack(side=LEFT,expand=0,fill=BOTH)
-
-#------------------------------------------------------ Tx params and msgs
-f5c=Frame(iframe5,bd=2,relief=GROOVE)
-txfirst=Checkbutton(f5c,text='Tx First',justify=RIGHT,variable=TxFirst)
-f5c2=Frame(f5c,bd=0)
-labreport=Label(f5c2,text='Rpt',width=4)
-report=Entry(f5c2, width=4)
-report.insert(0,'26')
-labreport.pack(side=RIGHT,expand=1,fill=BOTH)
-report.pack(side=RIGHT,expand=1,fill=BOTH)
-shmsg=Checkbutton(f5c,text='Sh Msg',justify=RIGHT,variable=ShOK,
-            command=restart2)
-sked=Checkbutton(f5c,text='Sked',justify=RIGHT,variable=nsked)
-genmsg=Button(f5c,text='GenStdMsgs',underline=0,command=GenStdMsgs,
-            padx=1,pady=1)
-auto=Button(f5c,text='Auto is Off',underline=0,command=toggleauto,
-            padx=1,pady=1)
-auto.focus_set()
-
-txfirst.grid(column=0,row=0,sticky='W',padx=4)
-f5c2.grid(column=0,row=1,sticky='W',padx=4)
-shmsg.grid(column=0,row=2,sticky='W',padx=4)
-sked.grid(column=0,row=3,sticky='W',padx=4)
-genmsg.grid(column=0,row=4,sticky='W',padx=4)
-auto.grid(column=0,row=5,sticky='EW',padx=4)
-#txstop.grid(column=0,row=6,sticky='EW',padx=4)
-
-ntx=IntVar()
-tx1=Entry(f5c,width=24)
-rb1=Radiobutton(f5c,value=1,variable=ntx)
-b1=Button(f5c, text='Tx1',underline=2,command=btx1,padx=1,pady=1)
-tx1.grid(column=1,row=0)
-rb1.grid(column=2,row=0)
-b1.grid(column=3,row=0)
-
-tx2=Entry(f5c,width=24)
-rb2=Radiobutton(f5c,value=2,variable=ntx)
-b2=Button(f5c, text='Tx2',underline=2,command=btx2,padx=1,pady=1)
-tx2.grid(column=1,row=1)
-rb2.grid(column=2,row=1)
-b2.grid(column=3,row=1)
-
-tx3=Entry(f5c,width=24)
-rb3=Radiobutton(f5c,value=3,variable=ntx)
-b3=Button(f5c, text='Tx3',underline=2,command=btx3,padx=1,pady=1)
-tx3.grid(column=1,row=2)
-rb3.grid(column=2,row=2)
-b3.grid(column=3,row=2)
-
-tx4=Entry(f5c,width=24)
-rb4=Radiobutton(f5c,value=4,variable=ntx)
-b4=Button(f5c, text='Tx4',underline=2,command=btx4,padx=1,pady=1)
-tx4.grid(column=1,row=3)
-rb4.grid(column=2,row=3)
-b4.grid(column=3,row=3)
-
-tx5=Entry(f5c,width=24)
-rb5=Radiobutton(f5c,value=5,variable=ntx)
-b5=Button(f5c, text='Tx5',underline=2,command=btx5,padx=1,pady=1)
-tx5.grid(column=1,row=4)
-rb5.grid(column=2,row=4)
-b5.grid(column=3,row=4)
-
-tx6=Entry(f5c,width=24)
-rb6=Radiobutton(f5c,value=6,variable=ntx)
-b6=Button(f5c, text='Tx6',underline=2,command=btx6,padx=1,pady=1)
-tx6.grid(column=1,row=5)
-rb6.grid(column=2,row=5)
-b6.grid(column=3,row=5)
-
-f5c.pack(side=LEFT,fill=BOTH)
-iframe5.pack(expand=1, fill=X, padx=4)
-
-#------------------------------------------------------------ Status Bar
-iframe6 = Frame(frame, bd=1, relief=SUNKEN)
-msg1=Message(iframe6, text='                    ', width=300,relief=SUNKEN)
-msg1.pack(side=LEFT, fill=X, padx=1)
-msg2=Message(iframe6, text='Message #2', width=300,relief=SUNKEN)
-msg2.pack(side=LEFT, fill=X, padx=1)
-msg3=Message(iframe6,width=300,relief=SUNKEN)
-msg3.pack(side=LEFT, fill=X, padx=1)
-msg4=Message(iframe6, text='Message #4', width=300,relief=SUNKEN)
-msg4.pack(side=LEFT, fill=X, padx=1)
-msg5=Message(iframe6, text='Message #5', width=300,relief=SUNKEN)
-msg5.pack(side=LEFT, fill=X, padx=1)
-Widget.bind(msg5,'&lt;Button-1&gt;',inctrperiod)
-Widget.bind(msg5,'&lt;Button-3&gt;',dectrperiod)
-msg7=Message(iframe6, text='                        ', width=300,relief=SUNKEN)
-msg7.pack(side=RIGHT, fill=X, padx=1)
-iframe6.pack(expand=1, fill=X, padx=4)
-frame.pack()
-
-ldate.after(100,update)
-lauto=0
-isync=1
-ntx.set(1)
-ndepth.set(1)
-import options
-options.defaults()
-ModeFSK441()
-lookup()
-balloon.unbind(ToRadio)
-g.astro_geom0=&quot;+0+0&quot;
-Audio.gcom1.mute=0
-
-#---------------------------------------------------------- Process INI file
-try:
-    f=open(appdir+'/MAP65.INI',mode='r')
-    params=f.readlines()
-except:
-    params=&quot;&quot;
-    if g.Win32:
-        options.PttPort.set(&quot;0&quot;)
-    else:
-        options.PttPort.set(&quot;/dev/ttyS0&quot;)
-    Audio.gcom2.nport=0
-
-try:
-    for i in range(len(params)):
-        key,value=params[i].split()
-        if   key == 'MAP65Geometry': root.geometry(value)
-        elif key == 'BMGeometry': bm_geom=value
-        elif key == 'Mode':
-            mode.set(value)
-            if value=='FSK441':
-                ModeFSK441()
-            elif value=='JT65A':
-                ModeJT65A()
-            elif value=='JT65B':
-                ModeJT65B()
-            elif value=='JT65C':
-                ModeJT65C()
-            elif value=='JT6M':
-                ModeJT6M()
-            elif value=='CW':
-                ModeCW()
-        elif key == 'MyCall': options.MyCall.set(value)
-        elif key == 'MyGrid': options.MyGrid.set(value)
-        elif key == 'HisCall':
-            hiscall=value
-            if hiscall==&quot;______&quot;: hiscall=&quot;&quot;
-            ToRadio.delete(0,END)
-            ToRadio.insert(0,hiscall)
-        elif key == 'HisGrid':
-            hisgrid=value
-            if hisgrid == &quot;XX00xx&quot;:
-                lookup()
-            HisGrid.delete(0,END)
-            HisGrid.insert(0,hisgrid)
-#        elif key == 'RxDelay': options.RxDelay.set(value)
-#        elif key == 'TxDelay': options.TxDelay.set(value)
-        elif key == 'IDinterval': options.IDinterval.set(value)
-        elif key == 'PttPort':
-            try:
-                options.PttPort.set(value)
-                try:
-                    Audio.gcom2.nport=int(options.PttPort.get())
-                except:
-                    Audio.gcom2.nport=0
-            except:
-                if g.Win32:
-                    options.PttPort.set(&quot;0&quot;)
-                else:
-                    options.PttPort.set(&quot;/dev/ttyS0&quot;)
-                Audio.gcom2.nport=0
-            Audio.gcom2.pttport=(options.PttPort.get()+'            ')[:12]
-        elif key == 'Mileskm': options.mileskm.set(value)
-        elif key == 'MsgStyle': options.ireport.set(value)
-        elif key == 'Region': options.iregion.set(value)
-        elif key == 'AudioIn':
-            try:
-                g.ndevin.set(value)
-            except:
-                g.ndevin.set(0)
-            g.DevinName.set(value)
-            options.DevinName.set(value)
-            Audio.gcom1.devin_name=(options.DevinName.get()+'            ')[:12]
-        elif key == 'AudioOut':
-            try:
-                g.ndevout.set(value)
-            except:
-                g.ndevout.set(0)
-            g.DevoutName.set(value)
-            options.DevoutName.set(value)
-            Audio.gcom1.devout_name=(options.DevoutName.get()+'            ')[:12]
-        elif key == 'SamFacIn': options.samfacin.set(value)
-        elif key == 'SamFacOut': options.samfacout.set(value)
-        elif key == 'Template1': options.Template1.set(value.replace(&quot;_&quot;,&quot; &quot;))
-        elif key == 'Template2': options.Template2.set(value.replace(&quot;_&quot;,&quot; &quot;))
-        elif key == 'Template3': options.Template3.set(value.replace(&quot;_&quot;,&quot; &quot;))
-        elif key == 'Template4': options.Template4.set(value.replace(&quot;_&quot;,&quot; &quot;))
-        elif key == 'Template5': options.Template5.set(value.replace(&quot;_&quot;,&quot; &quot;))
-        elif key == 'Template6':
-            options.Template6.set(value.replace(&quot;_&quot;,&quot; &quot;))
-            if options.Template6.get()==&quot; &quot;: options.Template6.set(&quot;&quot;)
-        elif key == 'AddPrefix': options.addpfx.set(value.replace(&quot;_&quot;,&quot; &quot;).lstrip())
-        elif key == 'AuxRA': options.auxra.set(value)
-        elif key == 'AuxDEC': options.auxdec.set(value)
-        elif key == 'TxFirst': TxFirst.set(value)
-        elif key == 'KB8RQ': kb8rq.set(value)
-        elif key == 'K2TXB': k2txb.set(value)
-        elif key == 'SetSeq': setseq.set(value)
-        elif key == 'Report':
-            report.delete(0,99)
-            report.insert(0,value)
-        elif key == 'ShOK': ShOK.set(value)
-        elif key == 'Nsave': nsave.set(value)
-        elif key == 'Band': nfreq.set(value)
-        elif key == 'S441': isync441=int(value)
-        elif key == 'S6m': isync6m=int(value)
-        elif key == 'Sync': isync65=int(value)
-        elif key == 'Clip': iclip=int(value)
-        elif key == 'Zap': nzap.set(value)
-        elif key == 'NB': nblank.set(value)
-        elif key == 'NAFC': nafc.set(value)
-        elif key == 'Sked': nsked.set(value)
-        elif key == 'NoSh441': nosh441.set(value)
-        elif key == 'NoShJT65': noshjt65.set(value)
-        elif key == 'NEME': neme.set(value)
-        elif key == 'NDepth': ndepth.set(value)
-        elif key == 'Debug': ndebug.set(value)
-        elif key == 'HisCall':
-            Audio.gcom2.hiscall=(value+'            ')[:12]
-            ToRadio.delete(0,99)
-            ToRadio.insert(0,value)
-            lookup()                       #Maybe should save HisGrid, instead?
-        elif key == 'MRUDir': mrudir=value.replace(&quot;#&quot;,&quot; &quot;)
-        elif key == 'AstroGeometry': g.astro_geom0 =value
-        elif key == 'CWTRPeriod':
-            ncwtrperiod=int(value)
-            if mode.get()[:2]==&quot;CW&quot;: Audio.gcom1.trperiod=ncwtrperiod
-        else: pass
-except:
-    print 'Error reading MAP65.INI, continuing with defaults.'
-    print key,value
-
-g.mode=mode.get()
-if mode.get()=='FSK441': isync=isync441
-elif mode.get()=='JT6M': isync=isync6m
-elif mode.get()[:4]=='JT65': isync=isync65
-lsync.configure(text=slabel+str(isync))
-lclip.configure(text='Clip   '+str(iclip))
-Audio.gcom2.appdir=(appdir+'                                                                                          ')[:80]
-Audio.gcom2.ndepth=ndepth.get()
-Audio.ftn_init()
-GenStdMsgs()
-Audio.gcom4.addpfx=(options.addpfx.get().lstrip()+'        ')[:8]
-stopmon()
-first=1
-if g.Win32: root.iconbitmap(&quot;wsjt.ico&quot;)
-root.title('  MAP65     by K1JT')
-bandmap()
-import astro
-import specjt
-
-# SpecJT has a &quot;mainloop&quot;, so does not return until it is terminated.
-#root.mainloop()   #Superseded by mainloop in SpecJT
-
-# Clean up and save user options before terminating
-f=open(appdir+'/MAP65.INI',mode='a')
-root_geom=root_geom[root_geom.index(&quot;+&quot;):]
-f.write(&quot;MAP65Geometry &quot; + root_geom + &quot;\n&quot;)
-bm_geom=bm_geom[bm_geom.index(&quot;+&quot;):]
-f.write(&quot;BMGeometry &quot; + bm_geom + &quot;\n&quot;)
-f.write(&quot;Mode &quot; + g.mode + &quot;\n&quot;)
-f.write(&quot;MyCall &quot; + options.MyCall.get() + &quot;\n&quot;)
-f.write(&quot;MyGrid &quot; + options.MyGrid.get() + &quot;\n&quot;)
-t=g.ftnstr(Audio.gcom2.hiscall)
-if t[:1]==&quot; &quot;: t=&quot;______&quot;
-f.write(&quot;HisCall &quot; + t + &quot;\n&quot;)
-t=g.ftnstr(Audio.gcom2.hisgrid)
-if t==&quot;      &quot;: t=&quot;XX00xx&quot;
-f.write(&quot;HisGrid &quot; + t + &quot;\n&quot;)
-#f.write(&quot;RxDelay &quot; + str(options.RxDelay.get()) + &quot;\n&quot;)
-#f.write(&quot;TxDelay &quot; + str(options.TxDelay.get()) + &quot;\n&quot;)
-f.write(&quot;IDinterval &quot; + str(options.IDinterval.get()) + &quot;\n&quot;)
-f.write(&quot;PttPort &quot; + str(options.PttPort.get()) + &quot;\n&quot;)
-f.write(&quot;Mileskm &quot; + str(options.mileskm.get()) + &quot;\n&quot;)
-f.write(&quot;MsgStyle &quot; + str(options.ireport.get()) + &quot;\n&quot;)
-f.write(&quot;Region &quot; + str(options.iregion.get()) + &quot;\n&quot;)
-f.write(&quot;AudioIn &quot; + options.DevinName.get() + &quot;\n&quot;)
-f.write(&quot;AudioOut &quot; + options.DevoutName.get() + &quot;\n&quot;)
-f.write(&quot;SamFacIn &quot; + str(options.samfacin.get()) + &quot;\n&quot;)
-f.write(&quot;SamFacOut &quot; + str(options.samfacout.get()) + &quot;\n&quot;)
-if options.Template6.get()==&quot;&quot;: options.Template6.set(&quot;_&quot;)
-f.write(&quot;Template1 &quot; + options.Template1.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
-f.write(&quot;Template2 &quot; + options.Template2.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
-f.write(&quot;Template3 &quot; + options.Template3.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
-f.write(&quot;Template4 &quot; + options.Template4.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
-f.write(&quot;Template5 &quot; + options.Template5.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
-f.write(&quot;Template6 &quot; + options.Template6.get().replace(&quot; &quot;,&quot;_&quot;) + &quot;\n&quot;)
-if options.addpfx.get().lstrip()==&quot;&quot;: options.addpfx.set(&quot;_&quot;)
-f.write(&quot;AddPrefix &quot; + options.addpfx.get().lstrip() + &quot;\n&quot;)
-if options.auxra.get()==&quot;&quot;: options.auxra.set(&quot;0&quot;)
-if options.auxdec.get()==&quot;&quot;: options.auxdec.set(&quot;0&quot;)
-f.write(&quot;AuxRA &quot; + options.auxra.get() + &quot;\n&quot;)
-f.write(&quot;AuxDEC &quot; + options.auxdec.get() + &quot;\n&quot;)
-f.write(&quot;TxFirst &quot; + str(TxFirst.get()) + &quot;\n&quot;)
-f.write(&quot;KB8RQ &quot; + str(kb8rq.get()) + &quot;\n&quot;)
-f.write(&quot;K2TXB &quot; + str(k2txb.get()) + &quot;\n&quot;)
-f.write(&quot;SetSeq &quot; + str(setseq.get()) + &quot;\n&quot;)
-f.write(&quot;Report &quot; + g.report + &quot;\n&quot;)
-f.write(&quot;ShOK &quot; + str(ShOK.get()) + &quot;\n&quot;)
-f.write(&quot;Nsave &quot; + str(nsave.get()) + &quot;\n&quot;)
-f.write(&quot;Band &quot; + str(nfreq.get()) + &quot;\n&quot;)
-f.write(&quot;S441 &quot; + str(isync441) + &quot;\n&quot;)
-f.write(&quot;S6m &quot; + str(isync6m) + &quot;\n&quot;)
-f.write(&quot;Sync &quot; + str(isync65) + &quot;\n&quot;)
-f.write(&quot;Clip &quot; + str(iclip) + &quot;\n&quot;)
-f.write(&quot;Zap &quot; + str(nzap.get()) + &quot;\n&quot;)
-f.write(&quot;NB &quot; + str(nblank.get()) + &quot;\n&quot;)
-f.write(&quot;NAFC &quot; + str(nafc.get()) + &quot;\n&quot;)
-f.write(&quot;Sked &quot; + str(nsked.get()) + &quot;\n&quot;)
-f.write(&quot;NoSh441 &quot; + str(nosh441.get()) + &quot;\n&quot;)
-f.write(&quot;NoShJT65 &quot; + str(noshjt65.get()) + &quot;\n&quot;)
-f.write(&quot;NEME &quot; + str(neme.get()) + &quot;\n&quot;)
-f.write(&quot;NDepth &quot; + str(ndepth.get()) + &quot;\n&quot;)
-f.write(&quot;Debug &quot; + str(ndebug.get()) + &quot;\n&quot;)
-#f.write(&quot;TRPeriod &quot; + str(Audio.gcom1.trperiod) + &quot;\n&quot;)
-mrudir2=mrudir.replace(&quot; &quot;,&quot;#&quot;)
-f.write(&quot;MRUDir &quot; + mrudir2 + &quot;\n&quot;)
-if g.astro_geom[:7]==&quot;200x200&quot;: g.astro_geom=&quot;316x373&quot; + g.astro_geom[7:]
-f.write(&quot;AstroGeometry &quot; + g.astro_geom + &quot;\n&quot;)
-f.write(&quot;CWTRPeriod &quot; + str(ncwtrperiod) + &quot;\n&quot;)
-f.close()
-
-Audio.ftn_quit()
-Audio.gcom1.ngo=0                         #Terminate audio streams
-Audio.gcom2.lauto=0
-Audio.gcom1.txok=0
-time.sleep(0.5)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000006.html">[WSJT-SVN] r321 - branches/map65
</A></li>
	<LI>Next message: <A HREF="000008.html">[WSJT-SVN] r323 - branches/map65
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7">[ date ]</a>
              <a href="thread.html#7">[ thread ]</a>
              <a href="subject.html#7">[ subject ]</a>
              <a href="author.html#7">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/wsjt-svn">More information about the wsjt-svn
mailing list</a><br>
</body></html>
