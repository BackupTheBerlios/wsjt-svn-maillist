<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [WSJT-SVN] r2461 - in branches/map65: . libm65
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/wsjt-svn/2012-May/index.html" >
   <LINK REL="made" HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r2461%20-%20in%20branches/map65%3A%20.%20libm65&In-Reply-To=%3C20120522142842.9FBEBBF401%40scm.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002152.html">
   <LINK REL="Next"  HREF="002153.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[WSJT-SVN] r2461 - in branches/map65: . libm65</H1>
    <B>k1jt at scm.berlios.de</B> 
    <A HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r2461%20-%20in%20branches/map65%3A%20.%20libm65&In-Reply-To=%3C20120522142842.9FBEBBF401%40scm.berlios.de%3E"
       TITLE="[WSJT-SVN] r2461 - in branches/map65: . libm65">k1jt at scm.berlios.de
       </A><BR>
    <I>Tue May 22 16:28:41 CEST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="002152.html">[WSJT-SVN] r2460 - branches/wspr
</A></li>
        <LI>Next message: <A HREF="002153.html">[WSJT-SVN] r2462 - in branches/map65: . libm65
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2154">[ date ]</a>
              <a href="thread.html#2154">[ thread ]</a>
              <a href="subject.html#2154">[ subject ]</a>
              <a href="author.html#2154">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: k1jt
Date: 2012-05-22 16:28:39 +0200 (Tue, 22 May 2012)
New Revision: 2461

Added:
   branches/map65/LICENSE_WHEATLEY.TXT
   branches/map65/MAP65_Beta_Release.docx
   branches/map65/QtSupport.iss
   branches/map65/about.cpp
   branches/map65/about.h
   branches/map65/about.ui
   branches/map65/afmhot.dat
   branches/map65/astro.cpp
   branches/map65/astro.h
   branches/map65/astro.ui
   branches/map65/bandmap.cpp
   branches/map65/bandmap.h
   branches/map65/bandmap.ui
   branches/map65/blue.dat
   branches/map65/commons.h
   branches/map65/devsetup.cpp
   branches/map65/devsetup.h
   branches/map65/devsetup.ui
   branches/map65/displaytext.cpp
   branches/map65/displaytext.h
   branches/map65/ffft.f
   branches/map65/fftw3.f
   branches/map65/getdev.cpp
   branches/map65/getfile.cpp
   branches/map65/getfile.h
   branches/map65/in.dat
   branches/map65/killbyname.cpp
   branches/map65/kvasd2.exe
   branches/map65/libfftw3f_win.a
   branches/map65/libm65/
   branches/map65/libm65/JT65code.f90
   branches/map65/libm65/Makefile.MinGW
   branches/map65/libm65/Makefile.linux
   branches/map65/libm65/afc65b.f
   branches/map65/libm65/astro.f
   branches/map65/libm65/astro0.f90
   branches/map65/libm65/astrosub.f90
   branches/map65/libm65/ccf2.f
   branches/map65/libm65/ccf65.f90
   branches/map65/libm65/chkhist.f
   branches/map65/libm65/chkmsg.f
   branches/map65/libm65/coord.f
   branches/map65/libm65/cutil.c
   branches/map65/libm65/dcoord.f
   branches/map65/libm65/decode0.f90
   branches/map65/libm65/decode1a.f
   branches/map65/libm65/decode65b.f
   branches/map65/libm65/decode_rs.c
   branches/map65/libm65/deep65.f90
   branches/map65/libm65/deg2grid.f
   branches/map65/libm65/demod64a.f
   branches/map65/libm65/display.f90
   branches/map65/libm65/dot.f
   branches/map65/libm65/dpol.f90
   branches/map65/libm65/encode65.f
   branches/map65/libm65/encode_rs.c
   branches/map65/libm65/extract.F
   branches/map65/libm65/f77_wisdom.f
   branches/map65/libm65/fchisq.f
   branches/map65/libm65/fftw3.f
   branches/map65/libm65/fil6521.f
   branches/map65/libm65/filbig.f
   branches/map65/libm65/four2a.f90
   branches/map65/libm65/ftninit.f90
   branches/map65/libm65/ftnquit.f90
   branches/map65/libm65/gen65.f90
   branches/map65/libm65/geocentric.f
   branches/map65/libm65/getdphi.f90
   branches/map65/libm65/getpfx1.f
   branches/map65/libm65/getpfx2.f
   branches/map65/libm65/graycode.f
   branches/map65/libm65/grid2deg.f
   branches/map65/libm65/grid2k.f
   branches/map65/libm65/igray.c
   branches/map65/libm65/indexx.f
   branches/map65/libm65/init_rs.c
   branches/map65/libm65/int.h
   branches/map65/libm65/interleave63.f
   branches/map65/libm65/ipcomm.cpp
   branches/map65/libm65/iqcal.f90
   branches/map65/libm65/iqfix.f90
   branches/map65/libm65/k2grid.f
   branches/map65/libm65/kvasd.exe
   branches/map65/libm65/m65.f90
   branches/map65/libm65/m65a.F90
   branches/map65/libm65/map65a.f90
   branches/map65/libm65/moon2.f
   branches/map65/libm65/moondop.f
   branches/map65/libm65/nchar.f
   branches/map65/libm65/packcall.f
   branches/map65/libm65/packdxcc.f
   branches/map65/libm65/packgrid.f
   branches/map65/libm65/packmsg.f
   branches/map65/libm65/packtext.f
   branches/map65/libm65/pctile.f
   branches/map65/libm65/pfx.f
   branches/map65/libm65/pfxdump.f
   branches/map65/libm65/ptt.c
   branches/map65/libm65/ptt_unix.c
   branches/map65/libm65/recvpkt.f90
   branches/map65/libm65/rfile3a.f90
   branches/map65/libm65/rs.h
   branches/map65/libm65/s3avg.f90
   branches/map65/libm65/sec_midn.f90
   branches/map65/libm65/set.f
   branches/map65/libm65/setup65.f
   branches/map65/libm65/sleep.h
   branches/map65/libm65/sleep_msec.f90
   branches/map65/libm65/sort.f
   branches/map65/libm65/ssort.f
   branches/map65/libm65/sun.f
   branches/map65/libm65/symspec.f90
   branches/map65/libm65/tastro.f90
   branches/map65/libm65/timer.f90
   branches/map65/libm65/timeval.h
   branches/map65/libm65/timf2.f90
   branches/map65/libm65/tm2.f90
   branches/map65/libm65/tmoonsub.c
   branches/map65/libm65/toxyz.f
   branches/map65/libm65/trimlist.f
   branches/map65/libm65/twkfreq.f
   branches/map65/libm65/unpackcall.f
   branches/map65/libm65/unpackgrid.f
   branches/map65/libm65/unpackmsg.f
   branches/map65/libm65/unpacktext.f
   branches/map65/libm65/wrapkarn.c
   branches/map65/main.cpp
   branches/map65/mainwindow.cpp
   branches/map65/mainwindow.h
   branches/map65/mainwindow.ui
   branches/map65/map65.iss
   branches/map65/map65.pro
   branches/map65/map65.rc
   branches/map65/messages.cpp
   branches/map65/messages.h
   branches/map65/messages.ui
   branches/map65/paInputDevice.c
   branches/map65/pa_get_device_info.c
   branches/map65/plotter.cpp
   branches/map65/plotter.h
   branches/map65/set570.cpp
   branches/map65/sleep.h
   branches/map65/soundin.cpp
   branches/map65/soundin.h
   branches/map65/soundout.cpp
   branches/map65/soundout.h
   branches/map65/ss.bat
   branches/map65/sss.bat
   branches/map65/widegraph.cpp
   branches/map65/widegraph.h
   branches/map65/widegraph.ui
   branches/map65/wsjt.ico
Removed:
   branches/map65/DFINC.MAK
   branches/map65/GeoDist.f
   branches/map65/KVASD.EXE
   branches/map65/KVASD_g95.EXE
   branches/map65/LICENSE.TXT
   branches/map65/Makefile.CVF
   branches/map65/Makefile.MinGW
   branches/map65/Makefile.ifort
   branches/map65/Makefile.in
   branches/map65/Makefile.linux.g95
   branches/map65/Makefile.linux.gfortran
   branches/map65/MoonDop.f
   branches/map65/Pmw.py
   branches/map65/PmwBlt.py
   branches/map65/PmwColor.py
   branches/map65/RxWav/
   branches/map65/TSKY.DAT
   branches/map65/a2d.f90
   branches/map65/aclocal.m4
   branches/map65/afc65b.f
   branches/map65/astro.f
   branches/map65/astro.py
   branches/map65/astro0.f90
   branches/map65/astropak.f
   branches/map65/audio_init.f90
   branches/map65/avecom.h
   branches/map65/avemsg65.f
   branches/map65/azdist.f
   branches/map65/azdist0.f90
   branches/map65/ccf2.f
   branches/map65/ccf65.f
   branches/map65/char.h
   branches/map65/chkhist.f
   branches/map65/chkmsg.f
   branches/map65/configure
   branches/map65/configure.ac
   branches/map65/coord.f
   branches/map65/cutil.c
   branches/map65/datcom.f90
   branches/map65/db.f
   branches/map65/dcoord.f
   branches/map65/decode1.f90
   branches/map65/decode1a.f
   branches/map65/decode65b.f
   branches/map65/decode_rs.c
   branches/map65/deep65.f
   branches/map65/deg2grid.f
   branches/map65/demod64a.f
   branches/map65/detect.f
   branches/map65/display.f90
   branches/map65/dot.f
   branches/map65/encode65.f
   branches/map65/encode_rs.c
   branches/map65/extract.f
   branches/map65/f2py.py
   branches/map65/f77_wisdom.f
   branches/map65/fchisq.f
   branches/map65/fftw3.f
   branches/map65/fftw3single.lib
   branches/map65/fil651.f
   branches/map65/fil652.f
   branches/map65/fil6521.f
   branches/map65/fil653.f
   branches/map65/filbig.f
   branches/map65/files.txt
   branches/map65/fivehz.f90
   branches/map65/fivehz.h
   branches/map65/flat1.f
   branches/map65/flat2.f
   branches/map65/flatten.f
   branches/map65/flushqqq.f90
   branches/map65/four2.f
   branches/map65/four2a.f
   branches/map65/fstatqqq.f90
   branches/map65/fthread.c
   branches/map65/ftn_init.f90
   branches/map65/ftn_quit.f90
   branches/map65/ftsky.f
   branches/map65/g.py
   branches/map65/gcom1.f90
   branches/map65/gcom2.f90
   branches/map65/gcom3.f90
   branches/map65/gcom4.f90
   branches/map65/gen65.f
   branches/map65/gencwid.f
   branches/map65/gentone.f
   branches/map65/geocentric.f
   branches/map65/getdphi.f90
   branches/map65/getfile.f90
   branches/map65/getfile2.f90
   branches/map65/getpfx1.f
   branches/map65/getpfx2.f
   branches/map65/getsnr.f
   branches/map65/go.py
   branches/map65/gp.bat
   branches/map65/graycode.f
   branches/map65/grid2deg.f
   branches/map65/grid2k.f
   branches/map65/i1tor4.f90
   branches/map65/igray.c
   branches/map65/indexx.f
   branches/map65/init_rs.c
   branches/map65/install-sh
   branches/map65/int.h
   branches/map65/interleave63.f
   branches/map65/jtaudio.c
   branches/map65/k2grid.f
   branches/map65/kvasd
   branches/map65/kvasd_g95
   branches/map65/kvasd_gfortran
   branches/map65/libfftw3f.a
   branches/map65/libfftw3f_win.a
   branches/map65/libsamplerate.lib
   branches/map65/loc.c
   branches/map65/map65.iss
   branches/map65/map65.py
   branches/map65/map65a.f90
   branches/map65/map65rc
   branches/map65/map65rc.win
   branches/map65/moon2.f
   branches/map65/morse.f
   branches/map65/msgtrim.f90
   branches/map65/nchar.f
   branches/map65/options.py
   branches/map65/pa.lib
   branches/map65/packcall.f
   branches/map65/packdxcc.f
   branches/map65/packgrid.f
   branches/map65/packmsg.f
   branches/map65/packtext.f
   branches/map65/palettes.py
   branches/map65/pctile.f
   branches/map65/peakup.f
   branches/map65/pfx.f
   branches/map65/pfxdump.f
   branches/map65/pix2d65.f90
   branches/map65/plrr.F90
   branches/map65/plrr.exe
   branches/map65/plrr_subs.c
   branches/map65/plrr_subs_win.c
   branches/map65/plrs.F90
   branches/map65/plrs_subs.c
   branches/map65/plrs_subs_win.c
   branches/map65/portaudio.h
   branches/map65/prcom.h
   branches/map65/ptt.c
   branches/map65/ptt_unix.c
   branches/map65/pulsar.f90
   branches/map65/recvpkt.f90
   branches/map65/rfile.f90
   branches/map65/rfile2.f
   branches/map65/rfile3.c
   branches/map65/rfile3a.f90
   branches/map65/rs.h
   branches/map65/runqqq.f90
   branches/map65/samplerate.h
   branches/map65/savetf2.f90
   branches/map65/sec_midn.f90
   branches/map65/set.f
   branches/map65/setup65.f
   branches/map65/short65.f
   branches/map65/sleep.h
   branches/map65/slope.f
   branches/map65/smeter.py
   branches/map65/smooth.f
   branches/map65/sort.f
   branches/map65/spcom.f90
   branches/map65/spec.f90
   branches/map65/specjt.py
   branches/map65/ssort.f
   branches/map65/start_portaudio.c
   branches/map65/sun.f
   branches/map65/symspec.f90
   branches/map65/symsync65.f
   branches/map65/sysqqq.f90
   branches/map65/thcvf.f90
   branches/map65/thnix.f90
   branches/map65/timeval.h
   branches/map65/toxyz.f
   branches/map65/trimlist.f
   branches/map65/twkfreq.f
   branches/map65/unpackcall.f
   branches/map65/unpackgrid.f
   branches/map65/unpackmsg.f
   branches/map65/unpacktext.f
   branches/map65/wrapkarn.c
   branches/map65/wsjt
   branches/map65/wsjt.ico
   branches/map65/wsjtgen.f90
Log:
Major changes to the MAP65 branch.  This branch is now a copy of 
MAP65 v2.3.0, r631, as checked out from the SVN repository on
pulsar.princeton.edu.  If all goes well with this commit, subsequent
MAP65 development will use the Berlios repository.


Deleted: branches/map65/DFINC.MAK
===================================================================
--- branches/map65/DFINC.MAK	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/DFINC.MAK	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,87 +0,0 @@
-#+
-# DFINC.MAK - Visual Fortran application master NMAKE definitions file
-#
-# This software DFINC.MAK is part of the Visual Fortran kit.
-# 
-# This file should be included at the top of all MAKEFILEs as follows:
-#  !include &lt;dfinc.mak&gt;
-# 
-# NMAKE Options:
-#
-# Use the table below to determine the additional options for NMAKE
-# Application Information Type         Invoke NMAKE
-# ----------------------------         ------------
-# For Debugging Info                   nmake debug=1
-# For linker map                       nmake linkmap=1
-# For linking with the DLLs            nmake linkdll=1
-#-
-
-# Set the defaults for all the MSVCxx versions
-
-crtimplib=msvcrt.lib
-
-!IFNDEF link
-link = link
-!ENDIF
-!IFNDEF libr
-libr = lib
-!ENDIF
-
-# Define the compiler verbs.
-FOR = df
-
-# Macros for the compiler
-!IFDEF DEBUG
-df_debug =  /debug:full
-lnk_debug = /debug:full /debugtype:both
-!ELSE
-df_debug =
-lnk_debug = /debug:none
-!ENDIF
-
-!IFDEF LINKDLL
-df_dll   = /call_dll
-dflibs   = dfordll.lib $(crtimplib) kernel32.lib
-!ELSE
-df_dll   =
-dflibs   = dfor.lib libc.lib kernel32.lib
-!ENDIF
-
-fflags    = $(df_debug) $(df_dll) 
-
-# Macros for the FPP Preprocesor 
-fppflags =
-fpp = $(FOR) $(fflags) /fpp=&quot;$(fppflags)&quot;
-
-# Macros for the linker.
-!IFDEF LINKMAP
-lflags = /map:$(*B).map $(lflags)
-!ELSE
-lflags = $(lflags)
-!ENDIF
-
-# SUFFIXES list
-.SUFFIXES: .exe .obj .asm .c .bas .cbl .fpp .for .f90 .pas .res .rc 
-
-# Define the inference rules
-.obj.exe:
-   $(FOR) $(df_dll) $(df_debug) /link $(lflags) $(lnk_debug) $*.obj 
-
-.for.exe:
-   $(FOR) $(fflags) $*.for /link $(lflags)
-
-.f90.exe:
-   $(FOR) $(fflags) $*.f90 /link $(lflags)
-
-.fpp.exe:
-   $(fpp) $*.fpp /link $(lflags)
-
-.for.obj:
-   $(FOR) $(df_debug) $*.for /nolink /object:$@
-
-.f90.obj:
-   $(FOR) $(df_debug) $*.f90 /nolink /object:$@
-
-.fpp.obj:
-   $(FOR) $(df_debug) /nolink /object:$@ /fpp:&quot;$(fppflags)&quot; $*.fpp
-

Deleted: branches/map65/GeoDist.f
===================================================================
--- branches/map65/GeoDist.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/GeoDist.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,102 +0,0 @@
-	subroutine geodist(Eplat, Eplon, Stlat, Stlon,
-     +	  Az, Baz, Dist)
-	implicit none
-	real eplat, eplon, stlat, stlon, az, baz, dist
-
-C JHT: In actual fact, I use the first two arguments for &quot;My Location&quot;,
-C      the second two for &quot;His location&quot;; West longitude is positive.
-
-c
-c
-c	Taken directly from:
-c	Thomas, P.D., 1970, Spheroidal geodesics, reference systems,
-c	&amp; local geometry, U.S. Naval Oceanographic Office SP-138,
-c	165 pp.
-c
-c	assumes North Latitude and East Longitude are positive
-c
-c	EpLat, EpLon = End point Lat/Long
-c	Stlat, Stlon = Start point lat/long
-c	Az, BAz = direct &amp; reverse azimuith
-c	Dist = Dist (km); Deg = central angle, discarded
-c
-
-	real BOA, F, P1R, P2R, L1R, L2R, DLR, T1R, T2R, TM,
-     +    DTM, STM, CTM, SDTM,CDTM, KL, KK, SDLMR, L,
-     +    CD, DL, SD, T, U, V, D, X, E, Y, A, FF64, TDLPM,
-     +    HAPBR, HAMBR, A1M2, A2M1
-
-	real AL,BL,D2R,Pi2
-
-	data AL/6378206.4/		! Clarke 1866 ellipsoid
-	data BL/6356583.8/
-c	real pi /3.14159265359/
-	data D2R/0.01745329251994/	! degrees to radians conversion factor
-	data Pi2/6.28318530718/
-
-        BOA = BL/AL
-        F = 1.0 - BOA
-c convert st/end pts to radians
-        P1R = Eplat * D2R
-        P2R = Stlat * D2R
-        L1R = Eplon * D2R
-        L2R = StLon * D2R
-        DLR = L2R - L1R			! DLR = Delta Long in Rads
-        T1R = ATan(BOA * Tan(P1R))
-        T2R = ATan(BOA * Tan(P2R))
-        TM = (T1R + T2R) / 2.0
-        DTM = (T2R - T1R) / 2.0
-        STM = Sin(TM)
-        CTM = Cos(TM)
-        SDTM = Sin(DTM)
-        CDTM = Cos(DTM)
-        KL = STM * CDTM
-        KK = SDTM * CTM
-        SDLMR = Sin(DLR/2.0)
-        L = SDTM * SDTM + SDLMR * SDLMR * (CDTM * CDTM - STM * STM)
-        CD = 1.0 - 2.0 * L
-        DL = ACos(CD)
-        SD = Sin(DL)
-        T = DL/SD
-        U = 2.0 * KL * KL / (1.0 - L)
-        V = 2.0 * KK * KK / L
-        D = 4.0 * T * T
-        X = U + V
-        E = -2.0 * CD
-        Y = U - V
-        A = -D * E
-        FF64 = F * F / 64.0
-        Dist = AL*SD*(T -(F/4.0)*(T*X-Y)+FF64*(X*(A+(T-(A+E)
-     +    /2.0)*X)+Y*(-2.0*D+E*Y)+D*X*Y))/1000.0
-        TDLPM = Tan((DLR+(-((E*(4.0-X)+2.0*Y)*((F/2.0)*T+FF64*
-     +    (32.0*T+(A-20.0*T)*X-2.0*(D+2.0)*Y))/4.0)*Tan(DLR)))/2.0)
-        HAPBR = ATan2(SDTM,(CTM*TDLPM))
-        HAMBR = Atan2(CDTM,(STM*TDLPM))
-        A1M2 = Pi2 + HAMBR - HAPBR
-        A2M1 = Pi2 - HAMBR - HAPBR
-
-1	If ((A1M2 .ge. 0.0) .AND. (A1M2 .lt. Pi2)) GOTO 5
- 	If (A1M2 .lt. Pi2) GOTO 4
- 	A1M2 = A1M2 - Pi2
-        GOTO 1
-4	A1M2 = A1M2 + Pi2
-        GOTO 1
-c
-c all of this gens the proper az, baz (forward and back azimuth)
-c
-
-5	If ((A2M1 .ge. 0.0) .AND. (A2M1 .lt. Pi2)) GOTO 9
- 	If (A2M1 .lt. Pi2) GOTO 8
-	A2M1 = A2M1 - Pi2
-        GOTO 5
-8	A2M1 = A2M1 + Pi2
-        GOTO 5
-
-9	Az = A1M2 / D2R
-	BAZ = A2M1 / D2R
-c
-c Fix the mirrored coords here.
-c
-	az = 360.0 - az
-	baz = 360.0 - baz
-	end

Deleted: branches/map65/KVASD.EXE
===================================================================
(Binary files differ)

Deleted: branches/map65/KVASD_g95.EXE
===================================================================
(Binary files differ)

Deleted: branches/map65/LICENSE.TXT
===================================================================
--- branches/map65/LICENSE.TXT	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/LICENSE.TXT	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,344 +0,0 @@
-The source code for WSJT is made available under the GNU General
-Public License.
-
-#####################################################################
-		    GNU GENERAL PUBLIC LICENSE
-		       Version 2, June 1991
-
- Copyright (C) 1989, 1991 Free Software Foundation, Inc.
-                       51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
- Everyone is permitted to copy and distribute verbatim copies
- of this license document, but changing it is not allowed.
-
-			    Preamble
-
-  The licenses for most software are designed to take away your
-freedom to share and change it.  By contrast, the GNU General Public
-License is intended to guarantee your freedom to share and change free
-software--to make sure the software is free for all its users.  This
-General Public License applies to most of the Free Software
-Foundation's software and to any other program whose authors commit to
-using it.  (Some other Free Software Foundation software is covered by
-the GNU Library General Public License instead.)  You can apply it to
-your programs, too.
-
-  When we speak of free software, we are referring to freedom, not
-price.  Our General Public Licenses are designed to make sure that you
-have the freedom to distribute copies of free software (and charge for
-this service if you wish), that you receive source code or can get it
-if you want it, that you can change the software or use pieces of it
-in new free programs; and that you know you can do these things.
-
-  To protect your rights, we need to make restrictions that forbid
-anyone to deny you these rights or to ask you to surrender the rights.
-These restrictions translate to certain responsibilities for you if you
-distribute copies of the software, or if you modify it.
-
-  For example, if you distribute copies of such a program, whether
-gratis or for a fee, you must give the recipients all the rights that
-you have.  You must make sure that they, too, receive or can get the
-source code.  And you must show them these terms so they know their
-rights.
-
-  We protect your rights with two steps: (1) copyright the software, and
-(2) offer you this license which gives you legal permission to copy,
-distribute and/or modify the software.
-
-  Also, for each author's protection and ours, we want to make certain
-that everyone understands that there is no warranty for this free
-software.  If the software is modified by someone else and passed on, we
-want its recipients to know that what they have is not the original, so
-that any problems introduced by others will not reflect on the original
-authors' reputations.
-
-  Finally, any free program is threatened constantly by software
-patents.  We wish to avoid the danger that redistributors of a free
-program will individually obtain patent licenses, in effect making the
-program proprietary.  To prevent this, we have made it clear that any
-patent must be licensed for everyone's free use or not licensed at all.
-
-  The precise terms and conditions for copying, distribution and
-modification follow.
-
-		    GNU GENERAL PUBLIC LICENSE
-   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
-
-  0. This License applies to any program or other work which contains
-a notice placed by the copyright holder saying it may be distributed
-under the terms of this General Public License.  The &quot;Program&quot;, below,
-refers to any such program or work, and a &quot;work based on the Program&quot;
-means either the Program or any derivative work under copyright law:
-that is to say, a work containing the Program or a portion of it,
-either verbatim or with modifications and/or translated into another
-language.  (Hereinafter, translation is included without limitation in
-the term &quot;modification&quot;.)  Each licensee is addressed as &quot;you&quot;.
-
-Activities other than copying, distribution and modification are not
-covered by this License; they are outside its scope.  The act of
-running the Program is not restricted, and the output from the Program
-is covered only if its contents constitute a work based on the
-Program (independent of having been made by running the Program).
-Whether that is true depends on what the Program does.
-
-  1. You may copy and distribute verbatim copies of the Program's
-source code as you receive it, in any medium, provided that you
-conspicuously and appropriately publish on each copy an appropriate
-copyright notice and disclaimer of warranty; keep intact all the
-notices that refer to this License and to the absence of any warranty;
-and give any other recipients of the Program a copy of this License
-along with the Program.
-
-You may charge a fee for the physical act of transferring a copy, and
-you may at your option offer warranty protection in exchange for a fee.
-
-  2. You may modify your copy or copies of the Program or any portion
-of it, thus forming a work based on the Program, and copy and
-distribute such modifications or work under the terms of Section 1
-above, provided that you also meet all of these conditions:
-
-    a) You must cause the modified files to carry prominent notices
-    stating that you changed the files and the date of any change.
-
-    b) You must cause any work that you distribute or publish, that in
-    whole or in part contains or is derived from the Program or any
-    part thereof, to be licensed as a whole at no charge to all third
-    parties under the terms of this License.
-
-    c) If the modified program normally reads commands interactively
-    when run, you must cause it, when started running for such
-    interactive use in the most ordinary way, to print or display an
-    announcement including an appropriate copyright notice and a
-    notice that there is no warranty (or else, saying that you provide
-    a warranty) and that users may redistribute the program under
-    these conditions, and telling the user how to view a copy of this
-    License.  (Exception: if the Program itself is interactive but
-    does not normally print such an announcement, your work based on
-    the Program is not required to print an announcement.)
-
-These requirements apply to the modified work as a whole.  If
-identifiable sections of that work are not derived from the Program,
-and can be reasonably considered independent and separate works in
-themselves, then this License, and its terms, do not apply to those
-sections when you distribute them as separate works.  But when you
-distribute the same sections as part of a whole which is a work based
-on the Program, the distribution of the whole must be on the terms of
-this License, whose permissions for other licensees extend to the
-entire whole, and thus to each and every part regardless of who wrote it.
-
-Thus, it is not the intent of this section to claim rights or contest
-your rights to work written entirely by you; rather, the intent is to
-exercise the right to control the distribution of derivative or
-collective works based on the Program.
-
-In addition, mere aggregation of another work not based on the Program
-with the Program (or with a work based on the Program) on a volume of
-a storage or distribution medium does not bring the other work under
-the scope of this License.
-
-  3. You may copy and distribute the Program (or a work based on it,
-under Section 2) in object code or executable form under the terms of
-Sections 1 and 2 above provided that you also do one of the following:
-
-    a) Accompany it with the complete corresponding machine-readable
-    source code, which must be distributed under the terms of Sections
-    1 and 2 above on a medium customarily used for software interchange; or,
-
-    b) Accompany it with a written offer, valid for at least three
-    years, to give any third party, for a charge no more than your
-    cost of physically performing source distribution, a complete
-    machine-readable copy of the corresponding source code, to be
-    distributed under the terms of Sections 1 and 2 above on a medium
-    customarily used for software interchange; or,
-
-    c) Accompany it with the information you received as to the offer
-    to distribute corresponding source code.  (This alternative is
-    allowed only for noncommercial distribution and only if you
-    received the program in object code or executable form with such
-    an offer, in accord with Subsection b above.)
-
-The source code for a work means the preferred form of the work for
-making modifications to it.  For an executable work, complete source
-code means all the source code for all modules it contains, plus any
-associated interface definition files, plus the scripts used to
-control compilation and installation of the executable.  However, as a
-special exception, the source code distributed need not include
-anything that is normally distributed (in either source or binary
-form) with the major components (compiler, kernel, and so on) of the
-operating system on which the executable runs, unless that component
-itself accompanies the executable.
-
-If distribution of executable or object code is made by offering
-access to copy from a designated place, then offering equivalent
-access to copy the source code from the same place counts as
-distribution of the source code, even though third parties are not
-compelled to copy the source along with the object code.
-
-  4. You may not copy, modify, sublicense, or distribute the Program
-except as expressly provided under this License.  Any attempt
-otherwise to copy, modify, sublicense or distribute the Program is
-void, and will automatically terminate your rights under this License.
-However, parties who have received copies, or rights, from you under
-this License will not have their licenses terminated so long as such
-parties remain in full compliance.
-
-  5. You are not required to accept this License, since you have not
-signed it.  However, nothing else grants you permission to modify or
-distribute the Program or its derivative works.  These actions are
-prohibited by law if you do not accept this License.  Therefore, by
-modifying or distributing the Program (or any work based on the
-Program), you indicate your acceptance of this License to do so, and
-all its terms and conditions for copying, distributing or modifying
-the Program or works based on it.
-
-  6. Each time you redistribute the Program (or any work based on the
-Program), the recipient automatically receives a license from the
-original licensor to copy, distribute or modify the Program subject to
-these terms and conditions.  You may not impose any further
-restrictions on the recipients' exercise of the rights granted herein.
-You are not responsible for enforcing compliance by third parties to
-this License.
-
-  7. If, as a consequence of a court judgment or allegation of patent
-infringement or for any other reason (not limited to patent issues),
-conditions are imposed on you (whether by court order, agreement or
-otherwise) that contradict the conditions of this License, they do not
-excuse you from the conditions of this License.  If you cannot
-distribute so as to satisfy simultaneously your obligations under this
-License and any other pertinent obligations, then as a consequence you
-may not distribute the Program at all.  For example, if a patent
-license would not permit royalty-free redistribution of the Program by
-all those who receive copies directly or indirectly through you, then
-the only way you could satisfy both it and this License would be to
-refrain entirely from distribution of the Program.
-
-If any portion of this section is held invalid or unenforceable under
-any particular circumstance, the balance of the section is intended to
-apply and the section as a whole is intended to apply in other
-circumstances.
-
-It is not the purpose of this section to induce you to infringe any
-patents or other property right claims or to contest validity of any
-such claims; this section has the sole purpose of protecting the
-integrity of the free software distribution system, which is
-implemented by public license practices.  Many people have made
-generous contributions to the wide range of software distributed
-through that system in reliance on consistent application of that
-system; it is up to the author/donor to decide if he or she is willing
-to distribute software through any other system and a licensee cannot
-impose that choice.
-
-This section is intended to make thoroughly clear what is believed to
-be a consequence of the rest of this License.
-
-  8. If the distribution and/or use of the Program is restricted in
-certain countries either by patents or by copyrighted interfaces, the
-original copyright holder who places the Program under this License
-may add an explicit geographical distribution limitation excluding
-those countries, so that distribution is permitted only in or among
-countries not thus excluded.  In such case, this License incorporates
-the limitation as if written in the body of this License.
-
-  9. The Free Software Foundation may publish revised and/or new versions
-of the General Public License from time to time.  Such new versions will
-be similar in spirit to the present version, but may differ in detail to
-address new problems or concerns.
-
-Each version is given a distinguishing version number.  If the Program
-specifies a version number of this License which applies to it and &quot;any
-later version&quot;, you have the option of following the terms and conditions
-either of that version or of any later version published by the Free
-Software Foundation.  If the Program does not specify a version number of
-this License, you may choose any version ever published by the Free Software
-Foundation.
-
-  10. If you wish to incorporate parts of the Program into other free
-programs whose distribution conditions are different, write to the author
-to ask for permission.  For software which is copyrighted by the Free
-Software Foundation, write to the Free Software Foundation; we sometimes
-make exceptions for this.  Our decision will be guided by the two goals
-of preserving the free status of all derivatives of our free software and
-of promoting the sharing and reuse of software generally.
-
-			    NO WARRANTY
-
-  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
-FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
-OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
-PROVIDE THE PROGRAM &quot;AS IS&quot; WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
-OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
-TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
-PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
-REPAIR OR CORRECTION.
-
-  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
-WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
-REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
-INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
-OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
-TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
-YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
-PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
-POSSIBILITY OF SUCH DAMAGES.
-
-		     END OF TERMS AND CONDITIONS
-
-	    How to Apply These Terms to Your New Programs
-
-  If you develop a new program, and you want it to be of the greatest
-possible use to the public, the best way to achieve this is to make it
-free software which everyone can redistribute and change under these terms.
-
-  To do so, attach the following notices to the program.  It is safest
-to attach them to the start of each source file to most effectively
-convey the exclusion of warranty; and each file should have at least
-the &quot;copyright&quot; line and a pointer to where the full notice is found.
-
-    &lt;one line to give the program's name and a brief idea of what it does.&gt;
-    Copyright (C) &lt;year&gt;  &lt;name of author&gt;
-
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-
-
-Also add information on how to contact you by electronic and paper mail.
-
-If the program is interactive, make it output a short notice like this
-when it starts in an interactive mode:
-
-    Gnomovision version 69, Copyright (C) year name of author
-    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
-    This is free software, and you are welcome to redistribute it
-    under certain conditions; type `show c' for details.
-
-The hypothetical commands `show w' and `show c' should show the appropriate
-parts of the General Public License.  Of course, the commands you use may
-be called something other than `show w' and `show c'; they could even be
-mouse-clicks or menu items--whatever suits your program.
-
-You should also get your employer (if you work as a programmer) or your
-school, if any, to sign a &quot;copyright disclaimer&quot; for the program, if
-necessary.  Here is a sample; alter the names:
-
-  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
-  `Gnomovision' (which makes passes at compilers) written by James Hacker.
-
-  &lt;signature of Ty Coon&gt;, 1 April 1989
-  Ty Coon, President of Vice
-
-This General Public License does not permit incorporating your program into
-proprietary programs.  If your program is a subroutine library, you may
-consider it more useful to permit linking proprietary applications with the
-library.  If this is what you want to do, use the GNU Library General
-Public License instead of this License.

Added: branches/map65/LICENSE_WHEATLEY.TXT
===================================================================
--- branches/map65/LICENSE_WHEATLEY.TXT	                        (rev 0)
+++ branches/map65/LICENSE_WHEATLEY.TXT	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,30 @@
++ + + This Software is released under the &quot;Simplified BSD License&quot;  + + +
+Copyright 2010 Moe Wheatley. All rights reserved.
+
+Redistribution and use in source and binary forms, with or without 
+modification, are permitted provided that the following conditions are 
+met:
+
+  1. Redistributions of source code must retain the above copyright 
+     notice, this list of conditions and the following disclaimer.
+
+  2. Redistributions in binary form must reproduce the above copyright 
+     notice, this list of conditions and the following disclaimer in 
+     the documentation and/or other materials provided with the 
+     distribution.
+
+THIS SOFTWARE IS PROVIDED BY Moe Wheatley ``AS IS'' AND ANY EXPRESS OR 
+IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
+WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
+DISCLAIMED. IN NO EVENT SHALL Moe Wheatley OR CONTRIBUTORS BE LIABLE 
+FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
+CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
+SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR 
+BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, 
+WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
+OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, 
+EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+The views and conclusions contained in the software and documentation 
+are those of the authors and should not be interpreted as representing 
+official policies, either expressed or implied, of Moe Wheatley.

Added: branches/map65/MAP65_Beta_Release.docx
===================================================================
(Binary files differ)


Property changes on: branches/map65/MAP65_Beta_Release.docx
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Deleted: branches/map65/Makefile.CVF
===================================================================
--- branches/map65/Makefile.CVF	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/Makefile.CVF	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,96 +0,0 @@
-#Makefile for Windows
-!include &lt;dfinc.mak&gt;   #Some definitions for Compaq Visual Fortran
-gcc = cl
-FC = df
-#To do bounds checking (with useless reports) put &quot;/check:all&quot; in the
-# --opt= line below (line 56, more or less ...)
-#FFLAGS = /traceback /check:all
-FFLAGS = /traceback /fast /nologo /check:all
-
-all:    MAP65.EXE plrs.exe
-
-OBJS2C   = init_rs.o encode_rs.o decode_rs.o jtaudio.o plrr_subs.o
-
-F2PYONLY = ftn_init ftn_quit audio_init getfile azdist0 astro0 spec
-
-SRCS2F90 = a2d.f90 astro0.f90 audio_init.f90 azdist0.f90 \
-	decode1.f90 ftn_init.f90 ftn_quit.f90 wsjtgen.f90 \
-	runqqq.f90 fivehz.f90 flushqqq.f90 \
-	rfile.f90 rfile3a.f90 spec.f90 map65a.F90 display.F90 \
-	getfile.f90 getfile2.f90 recvpkt.f90 savetf2.F90 \
-	symspec.f90 sec_midn.F90 getdphi.f90 thcvf.f90
-
-SRCSCOM = datcom.f90 gcom1.f90 gcom2.f90 gcom3.f90 gcom4.f90 spcom.f90
-
-SRCS2F77 = indexx.f gen65.f chkmsg.f \
-	gentone.f gencwid.f set.f db.f pctile.f sort.f ssort.f \
-	avemsg65.f demod64a.f encode65.f extract.f four2a.f getpfx1.f \
-	getpfx2.f graycode.f grid2k.f interleave63.f k2grid.f \
-	deep65.f morse.f nchar.f packcall.f packgrid.f \
-	packmsg.f packtext.f setup65.f unpackcall.f unpackgrid.f \
-	unpackmsg.f unpacktext.f astro.f azdist.f coord.f dcoord.f \
-	deg2grid.f dot.f ftsky.f geocentric.f GeoDist.f grid2deg.f \
-	moon2.f MoonDop.f sun.f toxyz.f pfxdump.f \
-	ccf65.f trimlist.f chkhist.f decode1a.f \
-	filbig.f fil6521.f twkfreq.f decode65b.f \
-	afc65b.f fchisq.f ccf2.f
-
-SRCS2C   = ptt.c igray.c wrapkarn.c rfile3.c
-
-MAP65.EXE: Audio.pyd map65.spec
-	python c:\python23\installer\Build.py map65.spec
-
-plrs.exe: plrs.f90 sec_midn.F90 plrs_subs_win.c
-	cl /c /Foplrs_subs.obj plrs_subs_win.c
-	df /fpp /define:CVF plrs.f90 sec_midn.F90 plrs_subs.obj  \
-	  /link ws2_32.lib
-
-Audio.pyd: $(OBJS2C) $(SRCS2F90) $(SRCS2F77) $(SRCS2C) $(SRCSCOM)
-	python f2py.py -c \
-	--quiet --&quot;fcompiler=compaqv&quot; \
-	--opt=&quot;/nologo /traceback /warn:errors /fast /fpp /define:CVF \
-	      /define:USE_PORTAUDIO&quot; \
-	$(OBJS2C) \
-	-lwinmm -lws2_32 -lpa -lfftw3single \
-	-m Audio \
-	only: $(F2PYONLY) : \
-	$(SRCS2F90) $(SRCS2F77) $(SRCS2C)
-
-map65.spec: map65.py astro.py g.py options.py palettes.py smeter.py specjt.py
-	python c:\python23\installer\makespec.py --icon wsjt.ico \
-	--tk --onefile map65.py
-
-jtaudio.o: jtaudio.c
-	$(CC) /nologo /c /DWin32 /Fojtaudio.o jtaudio.c
-
-init_rs.obj: init_rs.c
-	$(CC) /nologo /c /DBIGSYM=1 init_rs.c
-
-init_rs.o: init_rs.c
-	$(CC) /nologo /c /DBIGSYM=1 /Foinit_rs.o init_rs.c
-
-encode_rs.obj: encode_rs.c
-	$(CC) /nologo /c /DBIGSYM=1 encode_rs.c
-
-encode_rs.o: encode_rs.c
-	$(CC) /nologo /c /DBIGSYM=1 /Foencode_rs.o encode_rs.c
-
-decode_rs.obj: decode_rs.c
-	$(CC) /nologo /c /DBIGSYM=1 decode_rs.c
-
-decode_rs.o: decode_rs.c
-	$(CC) /nologo /c /DBIGSYM=1 /Ox /Zd /Fodecode_rs.o decode_rs.c
-
-wrapkarn.obj: wrapkarn.c
-	$(CC) /nologo /c /DCVF=1 wrapkarn.c
-
-igray.obj: igray.c
-	$(CC) /nologo /c /DCVF=1 igray.c
-
-plrr_subs.o: plrr_subs_win.c
-	$(CC) /nologo /c plrr_subs_win.c /Foplrr_subs.o
-
-.PHONY : clean
-
-clean:
-    -del *.o *.obj MAP65.EXE Audio.pyd map65.spec

Deleted: branches/map65/Makefile.MinGW
===================================================================
--- branches/map65/Makefile.MinGW	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/Makefile.MinGW	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,100 +0,0 @@
-#Makefile to compile MAP65.EXE for Windows.
-#!include &lt;dfinc.mak&gt;   #Some definitions for Compaq Visual Fortran
-CC = /mingw/bin/gcc
-FC = g95
-CFLAGS = -I. -fPIC
-FFLAGS = -Wall -Wno-precision-loss -fbounds-check -fPIC -fno-second-underscore
-
-.f.o:
-	${FC} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.f=.o} $&lt;
-
-all:    MAP65.EXE
-
-OBJC1 = init_rs.o encode_rs.o decode_rs.o jtaudio.o plrr_subs.o deep65.o
-
-F2PYONLY = ftn_init ftn_quit audio_init getfile azdist0 astro0 spec
-
-SRCF90 = a2d.f90 astro0.f90 audio_init.f90 azdist0.f90 \
-	decode1.f90 ftn_init.f90 ftn_quit.f90 wsjtgen.f90 \
-	runqqq.f90 fivehz.f90 flushqqq.f90 \
-	rfile.f90 rfile3a.f90 spec.f90 map65a.f90 display.f90 \
-	getfile.f90 getfile2.f90 recvpkt.f90 savetf2.f90 \
-	symspec.f90 sec_midn.f90 getdphi.f90 thnix.f90 msgtrim.f90
-
-SRCCOM = datcom.f90 gcom1.f90 gcom2.f90 gcom3.f90 gcom4.f90 spcom.f90
-
-SRCF77 = indexx.f gen65.f chkmsg.f \
-	gentone.f gencwid.f set.f db.f pctile.f sort.f ssort.f \
-	avemsg65.f demod64a.f encode65.f extract.f getpfx1.f \
-	getpfx2.f graycode.f grid2k.f interleave63.f k2grid.f \
-	morse.f nchar.f packcall.f packgrid.f \
-	packmsg.f packtext.f setup65.f unpackcall.f unpackgrid.f \
-	unpackmsg.f unpacktext.f astro.f azdist.f coord.f dcoord.f \
-	deg2grid.f dot.f ftsky.f geocentric.f GeoDist.f grid2deg.f \
-	moon2.f MoonDop.f sun.f toxyz.f pfxdump.f \
-	ccf65.f trimlist.f chkhist.f decode1a.f f77_wisdom.f \
-	fil6521.f twkfreq.f decode65b.f afc65b.f fchisq.f ccf2.f 
-
-SRC2F77 = four2a.f filbig.f
-
-SRCS2C   = ptt.c igray.c wrapkarn.c cutil.c start_portaudio.c fthread.c
-
-OBJF77 = ${SRCF77:.f=.o}
-
-MAP65.EXE: Audio.pyd map65.spec
-	c:/python25/python c:/python25/pyinstaller-1.3/Build.py map65.spec
-
-Audio.pyd: $(OBJC1) $(OBJF77) $(SRCF90) $(SRC2F77) $(SRCS2C) $(SRCCOM) Makefile
-	c:/Python25/python C:/python25/scripts/f2py.py -c -I. \
-	--quiet --fcompiler=g95 \
-	--opt=&quot;-fbounds-check -O0 -cpp&quot; \
-	--compiler=mingw32 \
-	$(OBJC1) $(OBJF77) libfftw3f_win.a \
-	libportaudio.a libpthreadGC2.a -lwinmm -lws2_32 \
-	-m Audio \
-	only: $(F2PYONLY) : \
-	$(SRCF90) $(SRC2F77) $(SRCS2C)
-
-map65.spec: map65.py astro.py g.py options.py palettes.py smeter.py specjt.py
-	C:/Python25/python C:/Python25/pyinstaller-1.3/makespec.py \
-	--icon wsjt.ico --tk --onefile map65.py
-
-deep65.o: deep65.f
-	$(FC) -c -O0 -Wall -fPIC -fno-second-underscore deep65.f
-
-jtaudio.o: jtaudio.c
-	$(CC) -c -DWin32 -o jtaudio.o jtaudio.c
-
-init_rs.obj: init_rs.c
-	$(CC) -c -DBIGSYM=1 init_rs.c
-
-init_rs.o: init_rs.c
-	$(CC) -c -DBIGSYM=1 -o init_rs.o init_rs.c
-
-encode_rs.obj: encode_rs.c
-	$(CC) -c -DBIGSYM=1 encode_rs.c
-
-encode_rs.o: encode_rs.c
-	$(CC) -c -DBIGSYM=1 -o encode_rs.o encode_rs.c
-
-decode_rs.obj: decode_rs.c
-	$(CC) -c -DBIGSYM=1 decode_rs.c
-
-decode_rs.o: decode_rs.c
-	$(CC) -c -DBIGSYM=1 -o decode_rs.o decode_rs.c
-
-wrapkarn.obj: wrapkarn.c
-	$(CC) -c -DWin32=1 wrapkarn.c
-
-igray.obj: igray.c
-	$(CC) -c -DWin32=1 igray.c
-
-plrr_subs.o: plrr_subs_win.c
-	$(CC) -c plrr_subs_win.c -o plrr_subs.o
-
-.PHONY : clean
-
-clean:
-	rm -f *.o Audio.pyd map65.spec MAP65.EXE 
-
-

Deleted: branches/map65/Makefile.ifort
===================================================================
--- branches/map65/Makefile.ifort	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/Makefile.ifort	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,112 +0,0 @@
-MV ?= mv
-CC ?= gcc
-MKDIR ?= mkdir
-INSTALL=	install
-FFLAGS	= -O2 -C -threads -reentrancy threaded -traceback -static 
-LDFLAGS	= -L/usr/lib -L/usr/local/lib 
-LIBS	=  -lpthread  -lportaudio -lsamplerate -lfftw3f
-CPPFLAGS = -I/usr/include -I/usr/local/include 
-CFLAGS	=  -Wall -O0 -g
-PREFIX	= /usr/local/
-# Map65 specific C flags
-CFLAGS	+= -DBIGSYM=1 -fPIC
-DEFS = -DPACKAGE_NAME=\&quot;map65\&quot; -DPACKAGE_TARNAME=\&quot;map65\&quot; -DPACKAGE_VERSION=\&quot;0.9\&quot; -DPACKAGE_STRING=\&quot;map65\ 0.9\&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DFC_LIB_PATH=\&quot;/opt/g95-install/bin/../lib/gcc-lib/i686-pc-linux-gnu/4.1.3//\&quot; -DFC=\&quot;g95\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_SYS_RESOURCE_H=1 -DHAVE_SYS_PARAM_H=1 -DHAVE_ERRNO_H=1 -DHAVE_SYS_SYSLOG_H=1 -DHAVE_STDDEF_H=1 -DHAVE_LIBGEN_H=1 -DHAVE_SYS_WAIT_H=1 -DHAVE_WAIT_H=1 -DHAVE_STDIO_H=1 -DHAVE_TERMIOS_H=1 -DHAVE_SYS_RESOURCE_H=1 -DHAVE_LINUX_PPDEV_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_FCNTL_H=1 -DHAVE_SYS_IOCTL_H=1 -DTIME_WITH_SYS_TIME=1 -DSTRING_WITH_STRINGS=1 -DNDEBUG=1 -DHAS_SAMPLERATE_H=1 -DHAS_PORTAUDIO=1 -DHAS_PORTAUDIO_H=1 -DHAS_PORTAUDIO_LIB=1 -DHAS_FFTW3_H=1 -DHAS_FFTW3FLIBS=1
-CFLAGS += ${DEFS}
-CPPFLAGS += ${DEFS} -I.
-
-# MAP65 specific Fortran flags
-# gfortran has no -Wno-precission-loss
-#FFLAGS += -Wall -fbounds-check -fno-second-underscore -fPIC#FFLAGS += -Wall -Wno-precision-loss -fbounds-check -fno-second-underscore -fPIC
-#FFLAGS += -Wall -fbounds-check -fno-second-underscore -ffixed-line-length-none -fPIC
-#FFLAGS += -Wall -fbounds-check -fno-second-underscore -fPIC
-#FFLAGS += -cpp -fno-second-underscore
-
-all:    Audio.so plrs plrr
-
-# The default rules
-.c.o:
-	${CC} ${CPPFLAGS} ${CFLAGS} -c -o ${&lt;:.c=.o} $&lt;
-
-.f.o:
-	${FC} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.f=.o} $&lt;
-
-.F90.o:
-	${FC} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.F90=.o} $&lt;
-
-OS=Linux
-FC=ifort
-FCV=intel
-COMPILER += /opt/g95-install/bin/../lib/gcc-lib/i686-pc-linux-gnu/4.1.3//
-
-LDFLAGS	+= -L${COMPILER}
-
-PYTHON	?= /usr/bin/python
-RM	?= /bin/rm
-F2PY	= /usr/bin/f2py
-
-###
-
-OBJS2C   = init_rs.o encode_rs.o decode_rs.o plrr_subs.o loc.o deep65.o
-
-F2PYONLY = ftn_init ftn_quit audio_init getfile azdist0 astro0 spec
-
-SRCS2F90 = astro0.F90 audio_init.F90 azdist0.f90 \
-	decode1.F90 ftn_init.F90 ftn_quit.f90 wsjtgen.F90 \
-	runqqq.F90 fivehz.F90 flushqqq.F90 \
-	rfile.f90 rfile3a.F90 spec.f90 map65a.F90 display.F90 \
-	getfile.F90 getfile2.F90 recvpkt.F90 savetf2.F90 \
-	symspec.f90 sec_midn.F90 getdphi.f90 thnix.f90
-
-SRCS2F77 = indexx.f gen65.f chkmsg.f \
-	gentone.f gencwid.f set.f db.f pctile.f sort.f ssort.f \
-	avemsg65.f demod64a.f encode65.f extract.f four2a.f getpfx1.f \
-	getpfx2.f graycode.f grid2k.f interleave63.f k2grid.f \
-	morse.f nchar.f packcall.f packgrid.f \
-	packmsg.f packtext.f setup65.f unpackcall.f unpackgrid.f \
-	unpackmsg.f unpacktext.f astro.f azdist.f coord.f dcoord.f \
-	deg2grid.f dot.f ftsky.f geocentric.f GeoDist.f grid2deg.f \
-	moon2.f MoonDop.f sun.f toxyz.f pfxdump.f \
-	ccf65.f trimlist.f chkhist.f decode1a.f \
-	filbig.f fil6521.f twkfreq.f decode65b.f \
-	afc65b.f fchisq.f ccf2.f rfile2.f
-
-OBJS2F77 = ${SRCS2F77:.f=.o}
-
-SRCS3C = ptt_unix.c igray.c wrapkarn.c cutil.c fthread.c
-OBJS3C = ${SRCS3C:.c=.o}
-
-AUDIOSRCS = a2d.f90 jtaudio.c start_portaudio.c
-
-deep65.o: deep65.F
-	$(FC) -c -O0 -Wall -fno-second-underscore -fPIC deep65.F
-
-Audio.so: $(OBJS2C) $(OBJS3C) $(OBJS2F77) $(SRCS2F90) $(AUDIOSRCS)
-	 ${F2PY} -c --quiet --opt=&quot;-O ${CFLAGS} \
-	${FFLAGS}&quot;	$(OBJS2C) $(OBJS2F77) -m Audio \
-	--f77exec=${FC} --f90exec=${FC} ${CPPFLAGS} ${LDFLAGS} ${LIBS} \
-	only: $(F2PYONLY) \
-	: $(SRCS2F90) \
-	${SRCS3C} ${AUDIOSRCS}
-
-
-init_rs_int.o: init_rs.c
-	$(CC) $(CFLAGS) -c -DBIGSYM=1 -o init_rs_int.o init_rs.c
-encode_rs_int.o: encode_rs.c
-	$(CC) $(CFLAGS) -c -DBIGSYM=1 -o encode_rs_int.o encode_rs.c
-decode_rs_int.o: decode_rs.c
-	$(CC) $(CFLAGS) -c -DBIGSYM=1 -o decode_rs_int.o decode_rs.c
-
-plrr:   plrr.F90 sec_midn.F90 plrr_subs.c cutil.c
-	$(CC) -c plrs_subs.c cutil.c
-	$(FC) -o plrr -fno-second-underscore plrr.F90 sec_midn.F90 plrr_subs.o cutil.o
-
-plrs:   plrs.F90 sec_midn.F90 plrs_subs.c cutil.c
-	$(CC) -c plrs_subs.c cutil.c
-	$(FC) -o plrs -fno-second-underscore plrs.F90 sec_midn.F90 plrs_subs.o cutil.o
-
-.PHONY : clean
-clean:
-	${RM} -f *.o *.pyc *.so *~ map65 map65.spec
-
-distclean: clean
-	${RM} -f config.log config.status Makefile

Deleted: branches/map65/Makefile.in
===================================================================
--- branches/map65/Makefile.in	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/Makefile.in	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,112 +0,0 @@
-MV ?= mv
-CC ?= @CC@
-MKDIR ?= mkdir
-INSTALL=	install
-FFLAGS	= @FFLAGS@
-LDFLAGS	= @LDFLAGS@
-LIBS	= @LIBS@
-CPPFLAGS = @CPPFLAGS@
-CFLAGS	= @CFLAGS@
-PREFIX	= @PREFIX@
-# Map65 specific C flags
-CFLAGS	+= -DBIGSYM=1 -fPIC
-DEFS = @DEFS@
-CFLAGS += ${DEFS}
-CPPFLAGS += ${DEFS} -I.
-
-# MAP65 specific Fortran flags
-# gfortran has no -Wno-precission-loss
-#FFLAGS += -Wall -fbounds-check -fno-second-underscore -fPIC#FFLAGS += -Wall -Wno-precision-loss -fbounds-check -fno-second-underscore -fPIC
-#FFLAGS += -Wall -fbounds-check -fno-second-underscore -ffixed-line-length-none -fPIC
-#FFLAGS += -Wall -fbounds-check -fno-second-underscore -fPIC
-#FFLAGS += -cpp -fno-second-underscore
-
-all:    Audio.so plrs plrr
-
-# The default rules
-.c.o:
-	${CC} ${CPPFLAGS} ${CFLAGS} -c -o ${&lt;:.c=.o} $&lt;
-
-.f.o:
-	${FC} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.f=.o} $&lt;
-
-.F90.o:
-	${FC} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.F90=.o} $&lt;
-
-OS=@OS@
-FC=@FC@
-FCV=@FCV@
-COMPILER += @FC_LIB_PATH@
-
-LDFLAGS	+= -L${COMPILER}
-
-PYTHON	?= @PYTHON@
-RM	?= @RM@
-F2PY	= @F2PY@
-
-###
-
-OBJS2C   = init_rs.o encode_rs.o decode_rs.o plrr_subs.o loc.o deep65.o
-
-F2PYONLY = ftn_init ftn_quit audio_init getfile azdist0 astro0 spec
-
-SRCS2F90 = astro0.F90 audio_init.F90 azdist0.f90 \
-	decode1.F90 ftn_init.F90 ftn_quit.f90 wsjtgen.F90 \
-	runqqq.F90 fivehz.F90 flushqqq.F90 \
-	rfile.f90 rfile3a.F90 spec.f90 map65a.F90 display.F90 \
-	getfile.F90 getfile2.F90 recvpkt.F90 savetf2.F90 \
-	symspec.f90 sec_midn.F90 getdphi.f90 thnix.f90
-
-SRCS2F77 = indexx.f gen65.f chkmsg.f \
-	gentone.f gencwid.f set.f db.f pctile.f sort.f ssort.f \
-	avemsg65.f demod64a.f encode65.f extract.f four2a.f getpfx1.f \
-	getpfx2.f graycode.f grid2k.f interleave63.f k2grid.f \
-	morse.f nchar.f packcall.f packgrid.f \
-	packmsg.f packtext.f setup65.f unpackcall.f unpackgrid.f \
-	unpackmsg.f unpacktext.f astro.f azdist.f coord.f dcoord.f \
-	deg2grid.f dot.f ftsky.f geocentric.f GeoDist.f grid2deg.f \
-	moon2.f MoonDop.f sun.f toxyz.f pfxdump.f f77_wisdom.f \
-	ccf65.f trimlist.f chkhist.f decode1a.f \
-	filbig.f fil6521.f twkfreq.f decode65b.f \
-	afc65b.f fchisq.f ccf2.f rfile2.f
-
-OBJS2F77 = ${SRCS2F77:.f=.o}
-
-SRCS3C = ptt_unix.c igray.c wrapkarn.c cutil.c fthread.c
-OBJS3C = ${SRCS3C:.c=.o}
-
-AUDIOSRCS = a2d.f90 jtaudio.c start_portaudio.c
-
-deep65.o: deep65.F
-	$(FC) -c -O0 -Wall -fno-second-underscore -fPIC deep65.F
-
-Audio.so: $(OBJS2C) $(OBJS3C) $(OBJS2F77) $(SRCS2F90) $(AUDIOSRCS)
-	${F2PY} -c --quiet --noopt --debug \
-	--f77flags=&quot;${FFLAGS}&quot; --f90flags=&quot;${FFLAGS}&quot; \
-	$(OBJS2C) $(OBJS2F77) -m Audio \
-	--fcompiler=${FCV} --f77exec=${FC} --f90exec=${FC} \
-	${CPPFLAGS} ${LDFLAGS} ${LIBS} \
-	only: $(F2PYONLY) : $(SRCS2F90) \
-	${SRCS3C} ${AUDIOSRCS}
-
-init_rs_int.o: init_rs.c
-	$(CC) $(CFLAGS) -c -DBIGSYM=1 -o init_rs_int.o init_rs.c
-encode_rs_int.o: encode_rs.c
-	$(CC) $(CFLAGS) -c -DBIGSYM=1 -o encode_rs_int.o encode_rs.c
-decode_rs_int.o: decode_rs.c
-	$(CC) $(CFLAGS) -c -DBIGSYM=1 -o decode_rs_int.o decode_rs.c
-
-plrr:   plrr.F90 sec_midn.F90 plrr_subs.c cutil.c
-	$(CC) -c plrs_subs.c cutil.c
-	$(FC) -o plrr -fno-second-underscore plrr.F90 sec_midn.F90 plrr_subs.o cutil.o
-
-plrs:   plrs.F90 sec_midn.F90 plrs_subs.c cutil.c
-	$(CC) -c plrs_subs.c cutil.c
-	$(FC) -o plrs -fno-second-underscore plrs.F90 sec_midn.F90 plrs_subs.o cutil.o
-
-.PHONY : clean
-clean:
-	${RM} -f *.o *.pyc *.so *~ map65 map65.spec
-
-distclean: clean
-	${RM} -f config.log config.status Makefile

Deleted: branches/map65/Makefile.linux.g95
===================================================================
--- branches/map65/Makefile.linux.g95	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/Makefile.linux.g95	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,121 +0,0 @@
-CC ?= gcc
-FFLAGS	= -g -O2
-LDFLAGS	= -L/usr/local/lib -lpthread  -lasound
-CPPFLAGS = -I/usr/local/include -I/usr/include/alsa 
-CFLAGS	=  -Wall -O0 -g  -Wall -O0 -g
-# WSJT specific C flags
-CFLAGS	+= -DBIGSYM=1
-DEFS = -DPACKAGE_NAME=\&quot;wsjt\&quot; -DPACKAGE_TARNAME=\&quot;wsjt\&quot; -DPACKAGE_VERSION=\&quot;5.9.2\&quot; -DPACKAGE_STRING=\&quot;wsjt\ 5.9.2\&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DG95_LIB_PATH=\&quot;/u/g95/g95-install/bin/../lib/gcc-lib/i686-pc-linux-gnu/4.0.1//\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_SYS_RESOURCE_H=1 -DHAVE_SYS_PARAM_H=1 -DHAVE_ERRNO_H=1 -DHAVE_SYS_SYSLOG_H=1 -DHAVE_STDDEF_H=1 -DHAVE_LIBGEN_H=1 -DHAVE_SYS_WAIT_H=1 -DHAVE_WAIT_H=1 -DHAVE_STDIO_H=1 -DHAVE_TERMIOS_H=1 -DHAVE_SYS_RESOURCE_H=1 -DHAVE_LINUX_PPDEV_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_FCNTL_H=1 -DHAVE_SYS_IOCTL_H=1 -DTIME_WITH_SYS_TIME=1 -DSTRING_WITH_STRINGS=1 -DSIZEOF_INT64_T=8 -DSIZEOF_LONG_LONG=8 -DNDEBUG=1 -DPREFIX=\&quot;/usr/local/\&quot; -DUSE_SERIAL=1 -DUSE_ALSA=1 -DHAS_ASOUNDLIB_H=1 -DHAS_SOUNDCARD_H=1 -DHAS_SAMPLERATE_H=1 
-CFLAGS += ${DEFS}
-CPPFLAGS += ${DEFS}
-
-# WSJT specific Fortran flags
-#FFLAGS += -Wall -fbounds-check -fno-second-underscore -ffixed-line-length-none
-FFLAGS += -Wall -fbounds-check -fno-second-underscore 
-#FFLAGS += -cpp -fno-second-underscore
-# The default rules
-.c.o:
-	${CC} ${CPPFLAGS} ${CFLAGS} -c -o ${&lt;:.c=.o} $&lt;
-
-.f.o:
-	${G95} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.f=.o} $&lt;
-
-.F90.o:
-	${G95} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.F90=.o} $&lt;
-
-OS=Linux
-G95=/usr/X11R6/bin/g95
-COMPILER=/usr/lib/gcc/i686-pc-linux-gnu/3.4.6//
-#COMPILER=/u/g95/g95-install/bin/../lib/gcc-lib/i686-pc-linux-gnu/4.0.1//
-FC=/usr/X11R6/bin/g95
-
-LDFLAGS	+= -L${COMPILER}
-LDFLAGS	+= -lg2c
-
-PYTHON	?= /usr/X11R6/bin/python
-RM	?= /usr/X11R6/bin/rm
-F2PY	= /usr/X11R6/bin/f2py
-
-
-OBJS1 = JT65code.o nchar.o grid2deg.o packmsg.o packtext.o \
-	packcall.o packgrid.o unpackmsg.o unpacktext.o unpackcall.o \
-	unpackgrid.o deg2grid.o packdxcc.o chkmsg.o getpfx1.o \
-	getpfx2.o k2grid.o grid2k.o interleave63.o graycode.o set.o \
-	igray.o init_rs_int.o encode_rs_int.o decode_rs_int.o \
-	wrapkarn.o
-
-F2PYONLY = ftn_init ftn_quit audio_init spec getfile azdist0 astro0
-
-SRCS2F90 = abc441.F90 astro0.F90 audio_init.F90 azdist0.f90 \
-	blanker.f90 decode1.F90 decode2.f90 decode3.F90 ftn_init.F90 \
-	ftn_quit.f90 get_fname.F90 getfile.F90 horizspec.f90 hscroll.f90 \
-	i1tor4.f90 pix2d.f90 pix2d65.f90 rfile.f90 savedata.F90 spec.f90 \
-	wsjtgen.F90 runqqq.F90 fivehz.F90
-OBJS2F90 = ${SRCS2F90:.f90=.o}
-
-SRCS2F77 = wsjt1.f astro.f azdist.f coord.f dcoord.f deg2grid.f \
-	dot.f ftsky.f geocentric.f GeoDist.f grid2deg.f moon2.f \
-	MoonDop.f sun.f toxyz.f pfxdump.f \
-        avesp2.f bzap.f spec441.f spec2d.f mtdecode.f stdecode.f \
-        indexx.f s2shape.f flat2.f gen65.f chkmsg.f gen6m.f gentone.f \
-        syncf0.f syncf1.f synct.f decode6m.f avemsg6m.f \
-        set.f flatten.f db.f pctile.f sort.f ssort.f ps.f smooth.f \
-        ping.f longx.f peakup.f sync.f detect.f avemsg65.f decode65.f \
-        demod64a.f encode65.f extract.f flat1.f four2.f rfile2.f \
-        gencw.f getpfx1.f getpfx2.f getsnr.f graycode.f grid2k.f \
-        interleave63.f k2grid.f limit.f lpf1.f deep65.f morse.f \
-        nchar.f packcall.f packgrid.f packmsg.f packtext.f setup65.f \
-        short65.f slope.f spec2d65.f sync65.f unpackcall.f \
-        unpackgrid.f unpackmsg.f unpacktext.f xcor.f xfft.f xfft2.f wsjt65.f
-OBJS2F77 = ${SRCS2F77:.f=.o}
-
-SRCS2C	= init_rs.c encode_rs.c decode_rs.c
-OBJS2C  = ${SRCS2C:.c=.o}
-
-# ok, so far for now
-# Windows start_alsa.c will be a2d.f90 jtaudio.c since it uses portaudio
-#            for *nix start_alsa.c will also be a2d.f90, jtaudio.c
-#               and start_portaudio.c for systems using portaudio
-#            for *nix start_alsa.c will be start_alsa.c for alsa
-#            for *nix start_alsa.c will be start_oss.c for oss
-#
-# ptt_unix.c vs. ptt.c I'll sort out later. 
-# ditto for cutil.c (only used on *nix)
-# --db
-# jtaudio.c/start_threads.c mess will have to be sorted out later
-# to minimise #ifdef's 
-# --db
-# and mostly sorted
-# --db
-#
-SRCS3C	= ptt_unix.c igray.c wrapkarn.c cutil.c
-OBJS3C  = ${SRCS3C:.c=.o}
-AUDIOSRCS = start_alsa.c
-
-all:	wsjt6
-JT65code: $(OBJS1)
-	$(FC) -o JT65code $(OBJS1)
-
-wsjt6:	Audio.so #wsjt.spec
-#	${PYTHON} c:\python23\installer\Build.py wsjt.spec
-#	${RM} wsjt6
-
-# 
-#
-Audio.so: $(OBJS2C) $(OBJS3C) $(OBJS2F77) $(SRCS2F90) $(AUDIOSRCS)
-	 ${F2PY} -c --quiet --opt=&quot;-O -D${CFLAGS} \
-	-fno-second-underscore&quot;	$(OBJS2C) $(OBJS2F77) -m Audio \
-	--f77exec=${G95} --f90exec=${G95} ${CPPFLAGS} ${LDFLAGS} \
-	only: $(F2PYONLY) \
-	: $(SRCS2F90) \
-	${SRCS3C} ${AUDIOSRCS}
-
-wsjt.spec: wsjt.py astro.py g.py options.py palettes.py smeter.py specjt.py
-#	${PYTHON} c:\python23\installer\makespec.py --icon wsjt.ico \
-#	--tk --onefile wsjt.py
-
-
-.PHONY : clean
-clean:
-	${RM} -f *.o *.so *~ JT65code wsjt6
-

Deleted: branches/map65/Makefile.linux.gfortran
===================================================================
--- branches/map65/Makefile.linux.gfortran	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/Makefile.linux.gfortran	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,120 +0,0 @@
-CC ?= gcc
-FFLAGS	= -g -O2 -fPIC
-LDFLAGS	= -L/usr/local/lib -lpthread  -lasound
-CPPFLAGS = -I/usr/local/include -I/usr/include/alsa -I.
-CFLAGS	=  -Wall -O0 -g  -Wall -O0 -g -fPIC
-# WSJT specific C flags
-CFLAGS	+= -DBIGSYM=1
-DEFS = -DPACKAGE_NAME=\&quot;wsjt\&quot; -DPACKAGE_TARNAME=\&quot;wsjt\&quot; -DPACKAGE_VERSION=\&quot;5.9.2\&quot; -DPACKAGE_STRING=\&quot;wsjt\ 5.9.2\&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DG95_LIB_PATH=\&quot;/usr/lib/gcc/x86_64-linux-gnu/4.0.3/\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_SYS_RESOURCE_H=1 -DHAVE_SYS_PARAM_H=1 -DHAVE_ERRNO_H=1 -DHAVE_SYS_SYSLOG_H=1 -DHAVE_STDDEF_H=1 -DHAVE_LIBGEN_H=1 -DHAVE_SYS_WAIT_H=1 -DHAVE_WAIT_H=1 -DHAVE_STDIO_H=1 -DHAVE_TERMIOS_H=1 -DHAVE_SYS_RESOURCE_H=1 -DHAVE_LINUX_PPDEV_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_FCNTL_H=1 -DHAVE_SYS_IOCTL_H=1 -DTIME_WITH_SYS_TIME=1 -DSTRING_WITH_STRINGS=1 -DSIZEOF_INT64_T=8 -DSIZEOF_LONG_LONG=8 -DNDEBUG=1 -DPREFIX=\&quot;/usr/local/\&quot; -DUSE_SERIAL=1 -DUSE_ALSA=1 -DHAS_ASOUNDLIB_H=1 -DHAS_SOUNDCARD_H=1 
-CFLAGS += ${DEFS}
-CPPFLAGS += ${DEFS}
-
-# WSJT specific Fortran flags
-FFLAGS += -Wall -fbounds-check -fno-second-underscore -ffixed-line-length-none
-#FFLAGS += -Wall -fbounds-check -fno-second-underscore 
-#FFLAGS += -cpp -fno-second-underscore
-# The default rules
-.c.o:
-	${CC} ${CPPFLAGS} ${CFLAGS} -c -o ${&lt;:.c=.o} $&lt;
-
-.f.o:
-	${G95} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.f=.o} $&lt;
-
-.F90.o:
-	${G95} ${CPPFLAGS} ${FFLAGS} -c -o ${&lt;:.F90=.o} $&lt;
-
-OS=Linux
-G95=/usr/bin/g95
-COMPILER=/usr/lib/gcc/x86_64-linux-gnu/4.0.3/
-FC=/usr/bin/g95
-
-LDFLAGS	+= -L${COMPILER}
-LDFLAGS	+= -lg2c
-
-PYTHON	?= /usr/bin/python
-RM	?= /bin/rm
-F2PY	= /usr/bin/f2py
-
-
-OBJS1 = JT65code.o nchar.o grid2deg.o packmsg.o packtext.o \
-	packcall.o packgrid.o unpackmsg.o unpacktext.o unpackcall.o \
-	unpackgrid.o deg2grid.o packdxcc.o chkmsg.o getpfx1.o \
-	getpfx2.o k2grid.o grid2k.o interleave63.o graycode.o set.o \
-	igray.o init_rs_int.o encode_rs_int.o decode_rs_int.o \
-	wrapkarn.o
-
-F2PYONLY = ftn_init ftn_quit audio_init spec getfile azdist0 astro0
-
-SRCS2F90 = abc441.F90 astro0.F90 audio_init.F90 azdist0.f90 \
-	blanker.f90 decode1.F90 decode2.f90 decode3.F90 ftn_init.F90 \
-	ftn_quit.f90 get_fname.F90 getfile.F90 horizspec.f90 hscroll.f90 \
-	i1tor4.f90 pix2d.f90 pix2d65.f90 rfile.f90 savedata.F90 spec.f90 \
-	wsjtgen.F90 runqqq.F90 fivehz.F90
-OBJS2F90 = ${SRCS2F90:.f90=.o}
-
-SRCS2F77 = wsjt1.f astro.f azdist.f coord.f dcoord.f deg2grid.f \
-	dot.f ftsky.f geocentric.f GeoDist.f grid2deg.f moon2.f \
-	MoonDop.f sun.f toxyz.f pfxdump.f \
-        avesp2.f bzap.f spec441.f spec2d.f mtdecode.f stdecode.f \
-        indexx.f s2shape.f flat2.f gen65.f chkmsg.f gen6m.f gentone.f \
-        syncf0.f syncf1.f synct.f decode6m.f avemsg6m.f \
-        set.f flatten.f db.f pctile.f sort.f ssort.f ps.f smooth.f \
-        ping.f longx.f peakup.f sync.f detect.f avemsg65.f decode65.f \
-        demod64a.f encode65.f extract.f flat1.f four2.f rfile2.f \
-        gencw.f getpfx1.f getpfx2.f getsnr.f graycode.f grid2k.f \
-        interleave63.f k2grid.f limit.f lpf1.f deep65.f morse.f \
-        nchar.f packcall.f packgrid.f packmsg.f packtext.f setup65.f \
-        short65.f slope.f spec2d65.f sync65.f unpackcall.f \
-        unpackgrid.f unpackmsg.f unpacktext.f xcor.f xfft.f xfft2.f wsjt65.f
-OBJS2F77 = ${SRCS2F77:.f=.o}
-
-SRCS2C	= init_rs.c encode_rs.c decode_rs.c
-OBJS2C  = ${SRCS2C:.c=.o}
-
-# ok, so far for now
-# Windows start_alsa.c will be a2d.f90 jtaudio.c since it uses portaudio
-#            for *nix start_alsa.c will also be a2d.f90, jtaudio.c
-#               and start_portaudio.c for systems using portaudio
-#            for *nix start_alsa.c will be start_alsa.c for alsa
-#            for *nix start_alsa.c will be start_oss.c for oss
-#
-# ptt_unix.c vs. ptt.c I'll sort out later. 
-# ditto for cutil.c (only used on *nix)
-# --db
-# jtaudio.c/start_threads.c mess will have to be sorted out later
-# to minimise #ifdef's 
-# --db
-# and mostly sorted
-# --db
-#
-SRCS3C	= ptt_unix.c igray.c wrapkarn.c cutil.c
-OBJS3C  = ${SRCS3C:.c=.o}
-AUDIOSRCS = start_alsa.c
-
-all:	wsjt6
-JT65code: $(OBJS1)
-	$(FC) -o JT65code $(OBJS1)
-
-wsjt6:	Audio.so #wsjt.spec
-#	${PYTHON} c:\python23\installer\Build.py wsjt.spec
-#	${RM} wsjt6
-
-# 
-#
-Audio.so: $(OBJS2C) $(OBJS3C) $(OBJS2F77) $(SRCS2F90) $(AUDIOSRCS)
-	 ${F2PY} -c --opt=&quot;-O ${CFLAGS} -fPIC \
-	-fno-second-underscore&quot;	$(OBJS2C) $(OBJS2F77) -m Audio \
-	--f77exec=${G95} --f90exec=${G95} ${CPPFLAGS} ${LDFLAGS} \
-	only: $(F2PYONLY) \
-	: $(SRCS2F90) \
-	${SRCS3C} ${AUDIOSRCS}
-
-wsjt.spec: wsjt.py astro.py g.py options.py palettes.py smeter.py specjt.py
-#	${PYTHON} c:\python23\installer\makespec.py --icon wsjt.ico \
-#	--tk --onefile wsjt.py
-
-
-.PHONY : clean
-clean:
-	${RM} -f *.o *.so *~ JT65code wsjt6
-

Deleted: branches/map65/MoonDop.f
===================================================================
--- branches/map65/MoonDop.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/MoonDop.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,84 +0,0 @@
-      subroutine MoonDop(nyear,month,nday,uth4,lon4,lat4,RAMoon4,
-     +  DecMoon4,LST4,HA4,AzMoon4,ElMoon4,ldeg4,bdeg4,vr4,dist4)
-
-      implicit real*8 (a-h,o-z)
-      real*4 uth4                    !UT in hours
-      real*4 lon4                    !West longitude, degrees
-      real*4 lat4                    !Latitude, degrees
-      real*4 RAMoon4                 !Topocentric RA of moon, hours
-      real*4 DecMoon4                !Topocentric Dec of Moon, degrees
-      real*4 LST4                    !Locat sidereal time, hours
-      real*4 HA4                     !Local Hour angle, degrees
-      real*4 AzMoon4                 !Topocentric Azimuth of moon, degrees
-      real*4 ElMoon4                 !Topocentric Elevation of moon, degrees
-      real*4 ldeg4                   !Galactic longitude of moon, degrees
-      real*4 bdeg4                   !Galactic latitude of moon, degrees
-      real*4 vr4                     !Radial velocity of moon wrt obs, km/s
-      real*4 dist4                   !Echo time, seconds
-
-      real*8 LST
-      real*8 RME(6)                  !Vector from Earth center to Moon
-      real*8 RAE(6)                  !Vector from Earth center to Obs
-      real*8 RMA(6)                  !Vector from Obs to Moon
-      real*8 pvsun(6)
-      real*8 rme0(6)
-      real*8 lrad
-      logical km,bary
-
-      common/stcomx/km,bary,pvsun
-      data rad/57.2957795130823d0/,twopi/6.28310530717959d0/
-
-      km=.true.
-      dlat=lat4/rad
-      dlong1=lon4/rad
-      elev1=200.d0
-      call geocentric(dlat,elev1,dlat1,erad1)
-
-      dt=100.d0                       !For numerical derivative, in seconds
-      UT=uth4
-
-C  NB: geodetic latitude used here, but geocentric latitude used when 
-C  determining Earth-rotation contribution to Doppler.
-
-      call moon2(nyear,month,nDay,UT-dt/3600.d0,dlong1*rad,dlat*rad,
-     +  RA,Dec,topRA,topDec,LST,HA,Az0,El0,dist)
-      call toxyz(RA/rad,Dec/rad,dist,rme0)      !Convert to rectangular coords
-
-      call moon2(nyear,month,nDay,UT,dlong1*rad,dlat*rad,
-     +  RA,Dec,topRA,topDec,LST,HA,Az,El,dist)
-      call toxyz(RA/rad,Dec/rad,dist,rme)       !Convert to rectangular coords
-
-      phi=LST*twopi/24.d0
-      call toxyz(phi,dlat1,erad1,rae)           !Gencentric numbers used here!
-      radps=twopi/(86400.d0/1.002737909d0)
-      rae(4)=-rae(2)*radps                      !Vel of Obs wrt Earth center
-      rae(5)=rae(1)*radps
-      rae(6)=0.d0
-
-      do i=1,3
-         rme(i+3)=(rme(i)-rme0(i))/dt
-         rma(i)=rme(i)-rae(i)
-         rma(i+3)=rme(i+3)-rae(i+3)
-      enddo
-
-      call fromxyz(rma,alpha1,delta1,dtopo0)     !Get topocentric coords
-      vr=dot(rma(4),rma)/dtopo0
-
-      rarad=RA/rad
-      decrad=Dec/rad
-      call dcoord(4.635594495d0,-0.504691042d0,3.355395488d0,
-     +  0.478220215d0,rarad,decrad,lrad,brad)
-
-      RAMoon4=topRA
-      DecMoon4=topDec
-      LST4=LST
-      HA4=HA
-      AzMoon4=Az
-      ElMoon4=El
-      ldeg4=lrad*rad
-      bdeg4=brad*rad
-      vr4=vr
-      dist4=dist
-
-      return
-      end

Deleted: branches/map65/Pmw.py
===================================================================
--- branches/map65/Pmw.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/Pmw.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,9233 +0,0 @@
-
-import PmwColor
-Color = PmwColor
-del PmwColor
-
-import PmwBlt
-Blt = PmwBlt
-del PmwBlt
-
-
-### Loader functions:
-
-_VERSION = '1.2'
-
-def setversion(version):
-    if version != _VERSION:
-        raise ValueError, 'Dynamic versioning not available'
-
-def setalphaversions(*alpha_versions):
-    if alpha_versions != ():
-	raise ValueError, 'Dynamic versioning not available'
-
-def version(alpha = 0):
-    if alpha:
-        return ()
-    else:
-        return _VERSION
-
-def installedversions(alpha = 0):
-    if alpha:
-        return ()
-    else:
-        return (_VERSION,)
-
-
-######################################################################
-### File: PmwBase.py
-# Pmw megawidget base classes.
-
-# This module provides a foundation for building megawidgets.  It
-# contains the MegaArchetype class which manages component widgets and
-# configuration options.  Also provided are the MegaToplevel and
-# MegaWidget classes, derived from the MegaArchetype class.  The
-# MegaToplevel class contains a Tkinter Toplevel widget to act as the
-# container of the megawidget.  This is used as the base class of all
-# megawidgets that are contained in their own top level window, such
-# as a Dialog window.  The MegaWidget class contains a Tkinter Frame
-# to act as the container of the megawidget.  This is used as the base
-# class of all other megawidgets, such as a ComboBox or ButtonBox.
-#
-# Megawidgets are built by creating a class that inherits from either
-# the MegaToplevel or MegaWidget class.
-
-import os
-import string
-import sys
-import traceback
-import types
-import Tkinter
-
-# Special values used in index() methods of several megawidgets.
-END = ['end']
-SELECT = ['select']
-DEFAULT = ['default']
-
-# Constant used to indicate that an option can only be set by a call
-# to the constructor.
-INITOPT = ['initopt']
-_DEFAULT_OPTION_VALUE = ['default_option_value']
-_useTkOptionDb = 0
-
-# Symbolic constants for the indexes into an optionInfo list.
-_OPT_DEFAULT         = 0
-_OPT_VALUE           = 1
-_OPT_FUNCTION        = 2
-
-# Stacks
-
-_busyStack = []
-    # Stack which tracks nested calls to show/hidebusycursor (called
-    # either directly or from activate()/deactivate()).  Each element
-    # is a dictionary containing:
-    #   'newBusyWindows' :  List of windows which had busy_hold called
-    #                       on them during a call to showbusycursor(). 
-    #                       The corresponding call to hidebusycursor()
-    #                       will call busy_release on these windows.
-    #   'busyFocus' :       The blt _Busy window which showbusycursor()
-    #                       set the focus to.
-    #   'previousFocus' :   The focus as it was when showbusycursor()
-    #                       was called.  The corresponding call to
-    #                       hidebusycursor() will restore this focus if
-    #                       the focus has not been changed from busyFocus.
-
-_grabStack = []
-    # Stack of grabbed windows.  It tracks calls to push/popgrab()
-    # (called either directly or from activate()/deactivate()).  The
-    # window on the top of the stack is the window currently with the
-    # grab.  Each element is a dictionary containing:
-    #   'grabWindow' :      The window grabbed by pushgrab().  The
-    #                       corresponding call to popgrab() will release
-    #                       the grab on this window and restore the grab
-    #                       on the next window in the stack (if there is one).
-    #   'globalMode' :      True if the grabWindow was grabbed with a
-    #                       global grab, false if the grab was local
-    #                       and 'nograb' if no grab was performed.
-    #   'previousFocus' :   The focus as it was when pushgrab()
-    #                       was called.  The corresponding call to
-    #                       popgrab() will restore this focus.
-    #   'deactivateFunction' :
-    #       The function to call (usually grabWindow.deactivate) if
-    #       popgrab() is called (usually from a deactivate() method)
-    #       on a window which is not at the top of the stack (that is,
-    #       does not have the grab or focus).  For example, if a modal
-    #       dialog is deleted by the window manager or deactivated by
-    #       a timer.  In this case, all dialogs above and including
-    #       this one are deactivated, starting at the top of the
-    #       stack.
-
-    # Note that when dealing with focus windows, the name of the Tk
-    # widget is used, since it may be the '_Busy' window, which has no
-    # python instance associated with it.
-
-#=============================================================================
-
-# Functions used to forward methods from a class to a component.
-
-# Fill in a flattened method resolution dictionary for a class (attributes are 
-# filtered out). Flattening honours the MI method resolution rules 
-# (depth-first search of bases in order). The dictionary has method names
-# for keys and functions for values.
-def __methodDict(cls, dict):
-
-    # the strategy is to traverse the class in the _reverse_ of the normal
-    # order, and overwrite any duplicates.
-    baseList = list(cls.__bases__)
-    baseList.reverse()
-    
-    # do bases in reverse order, so first base overrides last base
-    for super in baseList:
-	__methodDict(super, dict)
-
-    # do my methods last to override base classes
-    for key, value in cls.__dict__.items():
-	# ignore class attributes
-	if type(value) == types.FunctionType:
-	    dict[key] = value
-
-def __methods(cls):
-    # Return all method names for a class.
-
-    # Return all method names for a class (attributes are filtered
-    # out).  Base classes are searched recursively.
-
-    dict = {}
-    __methodDict(cls, dict)
-    return dict.keys()
-	
-# Function body to resolve a forwarding given the target method name and the 
-# attribute name. The resulting lambda requires only self, but will forward 
-# any other parameters.
-__stringBody = (
-    'def %(method)s(this, *args, **kw): return ' +
-    'apply(this.%(attribute)s.%(method)s, args, kw)')
-
-# Get a unique id
-__counter = 0
-def __unique():
-  global __counter
-  __counter = __counter + 1
-  return str(__counter)
-
-# Function body to resolve a forwarding given the target method name and the
-# index of the resolution function. The resulting lambda requires only self, 
-# but will forward any other parameters. The target instance is identified 
-# by invoking the resolution function.
-__funcBody = (
-    'def %(method)s(this, *args, **kw): return ' +
-    'apply(this.%(forwardFunc)s().%(method)s, args, kw)')
-
-def forwardmethods(fromClass, toClass, toPart, exclude = ()):
-    # Forward all methods from one class to another.
-
-    # Forwarders will be created in fromClass to forward method
-    # invocations to toClass.  The methods to be forwarded are
-    # identified by flattening the interface of toClass, and excluding
-    # methods identified in the exclude list.  Methods already defined
-    # in fromClass, or special methods with one or more leading or
-    # trailing underscores will not be forwarded.
-
-    # For a given object of class fromClass, the corresponding toClass
-    # object is identified using toPart.  This can either be a String
-    # denoting an attribute of fromClass objects, or a function taking
-    # a fromClass object and returning a toClass object.
-
-    # Example:
-    #     class MyClass:
-    #     ...
-    #         def __init__(self):
-    #             ...
-    #             self.__target = TargetClass()
-    #             ...
-    #         def findtarget(self):
-    #             return self.__target
-    #     forwardmethods(MyClass, TargetClass, '__target', ['dangerous1', 'dangerous2'])
-    #     # ...or...
-    #     forwardmethods(MyClass, TargetClass, MyClass.findtarget, 
-    #             ['dangerous1', 'dangerous2'])
-
-    # In both cases, all TargetClass methods will be forwarded from
-    # MyClass except for dangerous1, dangerous2, special methods like
-    # __str__, and pre-existing methods like findtarget.
-
-
-    # Allow an attribute name (String) or a function to determine the instance
-    if type(toPart) != types.StringType:
-
-	# check that it is something like a function
-	if callable(toPart):
-
-	    # If a method is passed, use the function within it
-	    if hasattr(toPart, 'im_func'):
-		toPart = toPart.im_func
-		
-	    # After this is set up, forwarders in this class will use
-	    # the forwarding function. The forwarding function name is
-	    # guaranteed to be unique, so that it can't be hidden by subclasses
-	    forwardName = '__fwdfunc__' + __unique()
-	    fromClass.__dict__[forwardName] = toPart
-
-	# It's not a valid type
-	else:
-	    raise TypeError, 'toPart must be attribute name, function or method'
-
-    # get the full set of candidate methods
-    dict = {}
-    __methodDict(toClass, dict)
-
-    # discard special methods
-    for ex in dict.keys():
-	if ex[:1] == '_' or ex[-1:] == '_':
-	    del dict[ex]
-    # discard dangerous methods supplied by the caller
-    for ex in exclude:
-	if dict.has_key(ex):
-	    del dict[ex]
-    # discard methods already defined in fromClass
-    for ex in __methods(fromClass):
-	if dict.has_key(ex):
-	    del dict[ex]
-
-    for method, func in dict.items():
-	d = {'method': method, 'func': func}
-	if type(toPart) == types.StringType:
-	    execString = \
-		__stringBody % {'method' : method, 'attribute' : toPart}
-	else:
-	    execString = \
-		__funcBody % {'forwardFunc' : forwardName, 'method' : method}
-
-	exec execString in d
-
-	# this creates a method
-	fromClass.__dict__[method] = d[method]
-
-#=============================================================================
-
-def setgeometryanddeiconify(window, geom):
-    # To avoid flashes on X and to position the window correctly on NT
-    # (caused by Tk bugs).
-
-    if os.name == 'nt' or \
-            (os.name == 'posix' and sys.platform[:6] == 'cygwin'):
-        # Require overrideredirect trick to stop window frame
-        # appearing momentarily.
-        redirect = window.overrideredirect()
-        if not redirect:
-            window.overrideredirect(1)
-        window.deiconify()
-        if geom is not None:
-            window.geometry(geom)
-        # Call update_idletasks to ensure NT moves the window to the
-        # correct position it is raised.
-        window.update_idletasks()
-        window.tkraise()
-        if not redirect:
-            window.overrideredirect(0)
-    else:
-        if geom is not None:
-            window.geometry(geom)
-
-        # Problem!?  Which way around should the following two calls
-        # go?  If deiconify() is called first then I get complaints
-        # from people using the enlightenment or sawfish window
-        # managers that when a dialog is activated it takes about 2
-        # seconds for the contents of the window to appear.  But if
-        # tkraise() is called first then I get complaints from people
-        # using the twm window manager that when a dialog is activated
-        # it appears in the top right corner of the screen and also
-        # takes about 2 seconds to appear.
-
-        #window.tkraise()
-        # Call update_idletasks to ensure certain window managers (eg: 
-        # enlightenment and sawfish) do not cause Tk to delay for
-        # about two seconds before displaying window.
-        #window.update_idletasks()
-        #window.deiconify()
-
-        window.deiconify()
-        if window.overrideredirect():
-            # The window is not under the control of the window manager
-            # and so we need to raise it ourselves.
-            window.tkraise()
-
-#=============================================================================
-
-class MegaArchetype:
-    # Megawidget abstract root class.
-
-    # This class provides methods which are inherited by classes
-    # implementing useful bases (this class doesn't provide a
-    # container widget inside which the megawidget can be built).
-
-    def __init__(self, parent = None, hullClass = None):
-
-	# Mapping from each megawidget option to a list of information
-	# about the option
-	#   - default value
-	#   - current value
-	#   - function to call when the option is initialised in the
-	#     call to initialiseoptions() in the constructor or
-	#     modified via configure().  If this is INITOPT, the
-	#     option is an initialisation option (an option that can
-	#     be set by the call to the constructor but can not be
-	#     used with configure).
-	# This mapping is not initialised here, but in the call to
-	# defineoptions() which precedes construction of this base class.
-	#
-	# self._optionInfo = {}
-
-	# Mapping from each component name to a tuple of information
-	# about the component.
-	#   - component widget instance
-	#   - configure function of widget instance
-	#   - the class of the widget (Frame, EntryField, etc)
-	#   - cget function of widget instance
-	#   - the name of the component group of this component, if any
-	self.__componentInfo = {}
-
-	# Mapping from alias names to the names of components or
-	# sub-components.
-	self.__componentAliases = {}
-
-	# Contains information about the keywords provided to the
-	# constructor.  It is a mapping from the keyword to a tuple
-	# containing:
-	#    - value of keyword
-	#    - a boolean indicating if the keyword has been used.
-	# A keyword is used if, during the construction of a megawidget,
-	#    - it is defined in a call to defineoptions() or addoptions(), or
-	#    - it references, by name, a component of the megawidget, or
-	#    - it references, by group, at least one component
-	# At the end of megawidget construction, a call is made to
-	# initialiseoptions() which reports an error if there are
-	# unused options given to the constructor.
-        #
-        # After megawidget construction, the dictionary contains
-        # keywords which refer to a dynamic component group, so that
-        # these components can be created after megawidget
-        # construction and still use the group options given to the
-        # constructor.
-	#
-	# self._constructorKeywords = {}
-
-        # List of dynamic component groups.  If a group is included in
-        # this list, then it not an error if a keyword argument for
-        # the group is given to the constructor or to configure(), but
-        # no components with this group have been created.
-        # self._dynamicGroups = ()
-
-	if hullClass is None:
-	    self._hull = None
-	else:
-	    if parent is None:
-		parent = Tkinter._default_root
-
-	    # Create the hull.
-	    self._hull = self.createcomponent('hull',
-		    (), None,
-		    hullClass, (parent,))
-	    _hullToMegaWidget[self._hull] = self
-
-	    if _useTkOptionDb:
-		# Now that a widget has been created, query the Tk
-		# option database to get the default values for the
-		# options which have not been set in the call to the
-		# constructor.  This assumes that defineoptions() is
-		# called before the __init__().
-		option_get = self.option_get
-		_VALUE = _OPT_VALUE
-		_DEFAULT = _OPT_DEFAULT
-		for name, info in self._optionInfo.items():
-		    value = info[_VALUE]
-		    if value is _DEFAULT_OPTION_VALUE:
-			resourceClass = string.upper(name[0]) + name[1:]
-			value = option_get(name, resourceClass)
-			if value != '':
-			    try:
-				# Convert the string to int/float/tuple, etc
-				value = eval(value, {'__builtins__': {}})
-			    except:
-				pass
-			    info[_VALUE] = value
-			else:
-			    info[_VALUE] = info[_DEFAULT]
-
-    def destroy(self):
-        # Clean up optionInfo in case it contains circular references
-        # in the function field, such as self._settitle in class
-        # MegaToplevel.
-
-	self._optionInfo = {}
-        if self._hull is not None:
-            del _hullToMegaWidget[self._hull]
-            self._hull.destroy()
-
-    #======================================================================
-    # Methods used (mainly) during the construction of the megawidget.
-
-    def defineoptions(self, keywords, optionDefs, dynamicGroups = ()):
-	# Create options, providing the default value and the method
-	# to call when the value is changed.  If any option created by
-	# base classes has the same name as one in &lt;optionDefs&gt;, the
-	# base class's value and function will be overriden.
-
-	# This should be called before the constructor of the base
-	# class, so that default values defined in the derived class
-	# override those in the base class.
-
-	if not hasattr(self, '_constructorKeywords'):
-            # First time defineoptions has been called.
-	    tmp = {}
-	    for option, value in keywords.items():
-		tmp[option] = [value, 0]
-	    self._constructorKeywords = tmp
-	    self._optionInfo = {}
-	    self._initialiseoptions_counter = 0
-        self._initialiseoptions_counter = self._initialiseoptions_counter + 1
-
-        if not hasattr(self, '_dynamicGroups'):
-            self._dynamicGroups = ()
-        self._dynamicGroups = self._dynamicGroups + tuple(dynamicGroups)
-	self.addoptions(optionDefs)
-
-    def addoptions(self, optionDefs):
-	# Add additional options, providing the default value and the
-	# method to call when the value is changed.  See
-	# &quot;defineoptions&quot; for more details
-
-	# optimisations:
-	optionInfo = self._optionInfo
-	optionInfo_has_key = optionInfo.has_key
-	keywords = self._constructorKeywords
-	keywords_has_key = keywords.has_key
-	FUNCTION = _OPT_FUNCTION
-
-	for name, default, function in optionDefs:
-	    if '_' not in name:
-		# The option will already exist if it has been defined
-		# in a derived class.  In this case, do not override the
-		# default value of the option or the callback function
-		# if it is not None.
-		if not optionInfo_has_key(name):
-		    if keywords_has_key(name):
-			value = keywords[name][0]
-			optionInfo[name] = [default, value, function]
-			del keywords[name]
-		    else:
-			if _useTkOptionDb:
-			    optionInfo[name] = \
-				    [default, _DEFAULT_OPTION_VALUE, function]
-			else:
-			    optionInfo[name] = [default, default, function]
-		elif optionInfo[name][FUNCTION] is None:
-		    optionInfo[name][FUNCTION] = function
-	    else:
-		# This option is of the form &quot;component_option&quot;.  If this is
-		# not already defined in self._constructorKeywords add it.
-		# This allows a derived class to override the default value
-		# of an option of a component of a base class.
-		if not keywords_has_key(name):
-		    keywords[name] = [default, 0]
-
-    def createcomponent(self, componentName, componentAliases,
-            componentGroup, widgetClass, *widgetArgs, **kw):
-	# Create a component (during construction or later).
-
-	if self.__componentInfo.has_key(componentName):
-	    raise ValueError, 'Component &quot;%s&quot; already exists' % componentName
-
-	if '_' in componentName:
-	    raise ValueError, \
-                    'Component name &quot;%s&quot; must not contain &quot;_&quot;' % componentName
-
-	if hasattr(self, '_constructorKeywords'):
-	    keywords = self._constructorKeywords
-	else:
-	    keywords = {}
-	for alias, component in componentAliases:
-	    # Create aliases to the component and its sub-components.
-	    index = string.find(component, '_')
-	    if index &lt; 0:
-		self.__componentAliases[alias] = (component, None)
-	    else:
-		mainComponent = component[:index]
-		subComponent = component[(index + 1):]
-		self.__componentAliases[alias] = (mainComponent, subComponent)
-
-	    # Remove aliases from the constructor keyword arguments by
-	    # replacing any keyword arguments that begin with *alias*
-	    # with corresponding keys beginning with *component*.
-
-	    alias = alias + '_'
-	    aliasLen = len(alias)
-	    for option in keywords.keys():
-		if len(option) &gt; aliasLen and option[:aliasLen] == alias:
-		    newkey = component + '_' + option[aliasLen:]
-		    keywords[newkey] = keywords[option]
-		    del keywords[option]
-
-	componentPrefix = componentName + '_'
-	nameLen = len(componentPrefix)
-	for option in keywords.keys():
-	    if len(option) &gt; nameLen and option[:nameLen] == componentPrefix:
-		# The keyword argument refers to this component, so add
-		# this to the options to use when constructing the widget.
-		kw[option[nameLen:]] = keywords[option][0]
-		del keywords[option]
-	    else:
-		# Check if this keyword argument refers to the group
-		# of this component.  If so, add this to the options
-		# to use when constructing the widget.  Mark the
-		# keyword argument as being used, but do not remove it
-		# since it may be required when creating another
-		# component.
-		index = string.find(option, '_')
-		if index &gt;= 0 and componentGroup == option[:index]:
-		    rest = option[(index + 1):]
-		    kw[rest] = keywords[option][0]
-		    keywords[option][1] = 1
-
-	if kw.has_key('pyclass'):
-	    widgetClass = kw['pyclass']
-	    del kw['pyclass']
-	if widgetClass is None:
-	    return None
-        if len(widgetArgs) == 1 and type(widgetArgs[0]) == types.TupleType:
-            # Arguments to the constructor can be specified as either
-            # multiple trailing arguments to createcomponent() or as a
-            # single tuple argument.
-            widgetArgs = widgetArgs[0]
-	widget = apply(widgetClass, widgetArgs, kw)
-	componentClass = widget.__class__.__name__
-	self.__componentInfo[componentName] = (widget, widget.configure,
-		componentClass, widget.cget, componentGroup)
-
-	return widget
-
-    def destroycomponent(self, name):
-	# Remove a megawidget component.
-
-	# This command is for use by megawidget designers to destroy a
-	# megawidget component.
-
-	self.__componentInfo[name][0].destroy()
-	del self.__componentInfo[name]
-
-    def createlabel(self, parent, childCols = 1, childRows = 1):
-
-	labelpos = self['labelpos']
-	labelmargin = self['labelmargin']
-	if labelpos is None:
-	    return
-
-	label = self.createcomponent('label',
-		(), None,
-		Tkinter.Label, (parent,))
-
-	if labelpos[0] in 'ns':
-	    # vertical layout
-	    if labelpos[0] == 'n':
-		row = 0
-		margin = 1
-	    else:
-		row = childRows + 3
-		margin = row - 1
-	    label.grid(column=2, row=row, columnspan=childCols, sticky=labelpos)
-	    parent.grid_rowconfigure(margin, minsize=labelmargin)
-	else:
-	    # horizontal layout
-	    if labelpos[0] == 'w':
-		col = 0
-		margin = 1
-	    else:
-		col = childCols + 3
-		margin = col - 1
-	    label.grid(column=col, row=2, rowspan=childRows, sticky=labelpos)
-	    parent.grid_columnconfigure(margin, minsize=labelmargin)
-
-    def initialiseoptions(self, dummy = None):
-        self._initialiseoptions_counter = self._initialiseoptions_counter - 1
-	if self._initialiseoptions_counter == 0:
-	    unusedOptions = []
-	    keywords = self._constructorKeywords
-	    for name in keywords.keys():
-		used = keywords[name][1]
-		if not used:
-                    # This keyword argument has not been used.  If it
-                    # does not refer to a dynamic group, mark it as
-                    # unused.
-                    index = string.find(name, '_')
-                    if index &lt; 0 or name[:index] not in self._dynamicGroups:
-                        unusedOptions.append(name)
-	    if len(unusedOptions) &gt; 0:
-		if len(unusedOptions) == 1:
-		    text = 'Unknown option &quot;'
-		else:
-		    text = 'Unknown options &quot;'
-		raise KeyError, text + string.join(unusedOptions, ', ') + \
-			'&quot; for ' + self.__class__.__name__
-
-	    # Call the configuration callback function for every option.
-	    FUNCTION = _OPT_FUNCTION
-	    for info in self._optionInfo.values():
-		func = info[FUNCTION]
-		if func is not None and func is not INITOPT:
-		    func()
-
-    #======================================================================
-    # Method used to configure the megawidget.
-
-    def configure(self, option=None, **kw):
-	# Query or configure the megawidget options.
-	#
-	# If not empty, *kw* is a dictionary giving new
-	# values for some of the options of this megawidget or its
-	# components.  For options defined for this megawidget, set
-	# the value of the option to the new value and call the
-	# configuration callback function, if any.  For options of the
-	# form &lt;component&gt;_&lt;option&gt;, where &lt;component&gt; is a component
-	# of this megawidget, call the configure method of the
-	# component giving it the new value of the option.  The
-	# &lt;component&gt; part may be an alias or a component group name.
-	#
-	# If *option* is None, return all megawidget configuration
-	# options and settings.  Options are returned as standard 5
-	# element tuples
-	#
-	# If *option* is a string, return the 5 element tuple for the
-	# given configuration option.
-
-	# First, deal with the option queries.
-	if len(kw) == 0:
-	    # This configure call is querying the values of one or all options.
-	    # Return 5-tuples:
-	    #     (optionName, resourceName, resourceClass, default, value)
-	    if option is None:
-		rtn = {}
-		for option, config in self._optionInfo.items():
-		    resourceClass = string.upper(option[0]) + option[1:]
-		    rtn[option] = (option, option, resourceClass,
-			    config[_OPT_DEFAULT], config[_OPT_VALUE])
-		return rtn
-	    else:
-		config = self._optionInfo[option]
-		resourceClass = string.upper(option[0]) + option[1:]
-		return (option, option, resourceClass, config[_OPT_DEFAULT],
-			config[_OPT_VALUE])
-
-	# optimisations:
-	optionInfo = self._optionInfo
-	optionInfo_has_key = optionInfo.has_key
-	componentInfo = self.__componentInfo
-	componentInfo_has_key = componentInfo.has_key
-	componentAliases = self.__componentAliases
-	componentAliases_has_key = componentAliases.has_key
-	VALUE = _OPT_VALUE
-	FUNCTION = _OPT_FUNCTION
-
-	# This will contain a list of options in *kw* which
-	# are known to this megawidget.
-	directOptions = []
-
-	# This will contain information about the options in
-	# *kw* of the form &lt;component&gt;_&lt;option&gt;, where
-	# &lt;component&gt; is a component of this megawidget.  It is a
-	# dictionary whose keys are the configure method of each
-	# component and whose values are a dictionary of options and
-	# values for the component.
-	indirectOptions = {}
-	indirectOptions_has_key = indirectOptions.has_key
-
-	for option, value in kw.items():
-	    if optionInfo_has_key(option):
-		# This is one of the options of this megawidget. 
-		# Make sure it is not an initialisation option.
-		if optionInfo[option][FUNCTION] is INITOPT:
-		    raise KeyError, \
-			    'Cannot configure initialisation option &quot;' \
-			    + option + '&quot; for ' + self.__class__.__name__
-		optionInfo[option][VALUE] = value
-		directOptions.append(option)
-	    else:
-		index = string.find(option, '_')
-		if index &gt;= 0:
-		    # This option may be of the form &lt;component&gt;_&lt;option&gt;.
-		    component = option[:index]
-		    componentOption = option[(index + 1):]
-
-		    # Expand component alias
-		    if componentAliases_has_key(component):
-			component, subComponent = componentAliases[component]
-			if subComponent is not None:
-			    componentOption = subComponent + '_' \
-				    + componentOption
-
-			# Expand option string to write on error
-			option = component + '_' + componentOption
-
-		    if componentInfo_has_key(component):
-			# Configure the named component
-			componentConfigFuncs = [componentInfo[component][1]]
-		    else:
-			# Check if this is a group name and configure all
-			# components in the group.
-			componentConfigFuncs = []
-			for info in componentInfo.values():
-			    if info[4] == component:
-			        componentConfigFuncs.append(info[1])
-
-                        if len(componentConfigFuncs) == 0 and \
-                                component not in self._dynamicGroups:
-			    raise KeyError, 'Unknown option &quot;' + option + \
-				    '&quot; for ' + self.__class__.__name__
-
-		    # Add the configure method(s) (may be more than
-		    # one if this is configuring a component group)
-		    # and option/value to dictionary.
-		    for componentConfigFunc in componentConfigFuncs:
-			if not indirectOptions_has_key(componentConfigFunc):
-			    indirectOptions[componentConfigFunc] = {}
-			indirectOptions[componentConfigFunc][componentOption] \
-				= value
-		else:
-		    raise KeyError, 'Unknown option &quot;' + option + \
-			    '&quot; for ' + self.__class__.__name__
-
-	# Call the configure methods for any components.
-	map(apply, indirectOptions.keys(),
-		((),) * len(indirectOptions), indirectOptions.values())
-
-	# Call the configuration callback function for each option.
-	for option in directOptions:
-	    info = optionInfo[option]
-	    func = info[_OPT_FUNCTION]
-	    if func is not None:
-	      func()
-
-    def __setitem__(self, key, value):
-        apply(self.configure, (), {key: value})
-
-    #======================================================================
-    # Methods used to query the megawidget.
-
-    def component(self, name):
-	# Return a component widget of the megawidget given the
-	# component's name
-	# This allows the user of a megawidget to access and configure
-	# widget components directly.
-
-	# Find the main component and any subcomponents
-	index = string.find(name, '_')
-	if index &lt; 0:
-	    component = name
-	    remainingComponents = None
-	else:
-	    component = name[:index]
-	    remainingComponents = name[(index + 1):]
-
-	# Expand component alias
-	if self.__componentAliases.has_key(component):
-	    component, subComponent = self.__componentAliases[component]
-	    if subComponent is not None:
-		if remainingComponents is None:
-		    remainingComponents = subComponent
-		else:
-		    remainingComponents = subComponent + '_' \
-			    + remainingComponents
-
-	widget = self.__componentInfo[component][0]
-	if remainingComponents is None:
-	    return widget
-	else:
-	    return widget.component(remainingComponents)
-
-    def interior(self):
-	return self._hull
-
-    def hulldestroyed(self):
-	return not _hullToMegaWidget.has_key(self._hull)
-
-    def __str__(self):
-	return str(self._hull)
-
-    def cget(self, option):
-	# Get current configuration setting.
-
-	# Return the value of an option, for example myWidget['font']. 
-
-	if self._optionInfo.has_key(option):
-	    return self._optionInfo[option][_OPT_VALUE]
-	else:
-	    index = string.find(option, '_')
-	    if index &gt;= 0:
-		component = option[:index]
-		componentOption = option[(index + 1):]
-
-		# Expand component alias
-		if self.__componentAliases.has_key(component):
-		    component, subComponent = self.__componentAliases[component]
-		    if subComponent is not None:
-			componentOption = subComponent + '_' + componentOption
-
-		    # Expand option string to write on error
-		    option = component + '_' + componentOption
-
-		if self.__componentInfo.has_key(component):
-		    # Call cget on the component.
-		    componentCget = self.__componentInfo[component][3]
-		    return componentCget(componentOption)
-		else:
-		    # If this is a group name, call cget for one of
-		    # the components in the group.
-		    for info in self.__componentInfo.values():
-			if info[4] == component:
-			    componentCget = info[3]
-			    return componentCget(componentOption)
-
-	raise KeyError, 'Unknown option &quot;' + option + \
-		'&quot; for ' + self.__class__.__name__
-
-    __getitem__ = cget
-
-    def isinitoption(self, option):
-	return self._optionInfo[option][_OPT_FUNCTION] is INITOPT
-
-    def options(self):
-	options = []
-	if hasattr(self, '_optionInfo'):
-	    for option, info in self._optionInfo.items():
-		isinit = info[_OPT_FUNCTION] is INITOPT
-		default = info[_OPT_DEFAULT]
-		options.append((option, default, isinit))
-	    options.sort()
-	return options
-
-    def components(self):
-	# Return a list of all components.
-
-	# This list includes the 'hull' component and all widget subcomponents
-
-	names = self.__componentInfo.keys()
-	names.sort()
-	return names
-
-    def componentaliases(self):
-	# Return a list of all component aliases.
-
-	componentAliases = self.__componentAliases
-
-	names = componentAliases.keys()
-	names.sort()
-	rtn = []
-	for alias in names:
-	    (mainComponent, subComponent) = componentAliases[alias]
-	    if subComponent is None:
-		rtn.append((alias, mainComponent))
-	    else:
-		rtn.append((alias, mainComponent + '_' + subComponent))
-	    
-	return rtn
-
-    def componentgroup(self, name):
-	return self.__componentInfo[name][4]
-
-#=============================================================================
-
-# The grab functions are mainly called by the activate() and
-# deactivate() methods.
-#
-# Use pushgrab() to add a new window to the grab stack.  This
-# releases the grab by the window currently on top of the stack (if
-# there is one) and gives the grab and focus to the new widget.
-#
-# To remove the grab from the window on top of the grab stack, call
-# popgrab().
-#
-# Use releasegrabs() to release the grab and clear the grab stack.
-
-def pushgrab(grabWindow, globalMode, deactivateFunction):
-    prevFocus = grabWindow.tk.call('focus')
-    grabInfo = {
-        'grabWindow' : grabWindow,
-        'globalMode' : globalMode,
-        'previousFocus' : prevFocus,
-        'deactivateFunction' : deactivateFunction,
-    }
-    _grabStack.append(grabInfo)
-    _grabtop()
-    grabWindow.focus_set()
-
-def popgrab(window):
-    # Return the grab to the next window in the grab stack, if any.
-
-    # If this window is not at the top of the grab stack, then it has
-    # just been deleted by the window manager or deactivated by a
-    # timer.  Call the deactivate method for the modal dialog above
-    # this one on the stack. 
-    if _grabStack[-1]['grabWindow'] != window:
-        for index in range(len(_grabStack)):
-            if _grabStack[index]['grabWindow'] == window:
-                _grabStack[index + 1]['deactivateFunction']()
-                break
-
-    grabInfo = _grabStack[-1]
-    del _grabStack[-1]
-
-    topWidget = grabInfo['grabWindow']
-    prevFocus = grabInfo['previousFocus']
-    globalMode = grabInfo['globalMode']
-
-    if globalMode != 'nograb':
-        topWidget.grab_release()
-
-    if len(_grabStack) &gt; 0:
-        _grabtop()
-    if prevFocus != '':
-        try:
-            topWidget.tk.call('focus', prevFocus)
-        except Tkinter.TclError:
-            # Previous focus widget has been deleted. Set focus
-            # to root window.
-            Tkinter._default_root.focus_set()
-    else:
-        # Make sure that focus does not remain on the released widget.
-        if len(_grabStack) &gt; 0:
-            topWidget = _grabStack[-1]['grabWindow']
-            topWidget.focus_set()
-        else:
-            Tkinter._default_root.focus_set()
-
-def grabstacktopwindow():
-    if len(_grabStack) == 0:
-        return None
-    else:
-        return _grabStack[-1]['grabWindow']
-
-def releasegrabs():
-    # Release grab and clear the grab stack.
-
-    current = Tkinter._default_root.grab_current()
-    if current is not None:
-        current.grab_release()
-    _grabStack[:] = []
-
-def _grabtop():
-    grabInfo = _grabStack[-1]
-    topWidget = grabInfo['grabWindow']
-    globalMode = grabInfo['globalMode']
-
-    if globalMode == 'nograb':
-        return
-
-    while 1:
-        try:
-            if globalMode:
-                topWidget.grab_set_global()
-            else:
-                topWidget.grab_set()
-            break
-        except Tkinter.TclError:
-            # Another application has grab.  Keep trying until
-            # grab can succeed.
-            topWidget.after(100)
-
-#=============================================================================
-
-class MegaToplevel(MegaArchetype):
-
-    def __init__(self, parent = None, **kw):
-	# Define the options for this megawidget.
-	optiondefs = (
-            ('activatecommand',   None,                     None),
-            ('deactivatecommand', None,                     None),
-            ('master',            None,                     None),
-            ('title',             None,                     self._settitle),
-            ('hull_class',        self.__class__.__name__,  None),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaArchetype.__init__(self, parent, Tkinter.Toplevel)
-
-	# Initialise instance.
-
-        # Set WM_DELETE_WINDOW protocol, deleting any old callback, so
-        # memory does not leak.
-        if hasattr(self._hull, '_Pmw_WM_DELETE_name'):
-            self._hull.tk.deletecommand(self._hull._Pmw_WM_DELETE_name)
-        self._hull._Pmw_WM_DELETE_name = \
-                self.register(self._userDeleteWindow, needcleanup = 0)
-	self.protocol('WM_DELETE_WINDOW', self._hull._Pmw_WM_DELETE_name)
-
-	# Initialise instance variables.
-
-	self._firstShowing = 1
-	# Used by show() to ensure window retains previous position on screen.
-
-	# The IntVar() variable to wait on during a modal dialog.
-	self._wait = None
-
-	self._active = 0
-	self._userDeleteFunc = self.destroy
-	self._userModalDeleteFunc = self.deactivate
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def _settitle(self):
-	title = self['title']
-	if title is not None:
-	    self.title(title)
-
-    def userdeletefunc(self, func=None):
-        if func:
-	    self._userDeleteFunc = func
-	else:
-	    return self._userDeleteFunc
-
-    def usermodaldeletefunc(self, func=None):
-        if func:
-	    self._userModalDeleteFunc = func
-	else:
-	    return self._userModalDeleteFunc
-
-    def _userDeleteWindow(self):
-	if self.active():
-	    self._userModalDeleteFunc()
-	else:
-	    self._userDeleteFunc()
-
-    def destroy(self):
-	# Allow this to be called more than once.
-	if _hullToMegaWidget.has_key(self._hull):
-	    self.deactivate()
-
-            # Remove circular references, so that object can get cleaned up.
-            del self._userDeleteFunc
-            del self._userModalDeleteFunc
-
-            MegaArchetype.destroy(self)
-
-    def show(self, master = None):
-	if self.state() != 'normal':
-	    if self._firstShowing:
-		# Just let the window manager determine the window
-		# position for the first time.
-		geom = None
-	    else:
-		# Position the window at the same place it was last time.
-		geom = self._sameposition()
-            setgeometryanddeiconify(self, geom)
-
-        if self._firstShowing:
-            self._firstShowing = 0
-        else:
-            if self.transient() == '':
-                self.tkraise()
-
-        # Do this last, otherwise get flashing on NT:
-        if master is not None:
-            if master == 'parent':
-                parent = self.winfo_parent()
-                # winfo_parent() should return the parent widget, but the
-                # the current version of Tkinter returns a string.
-                if type(parent) == types.StringType:
-                    parent = self._hull._nametowidget(parent)
-                master = parent.winfo_toplevel()
-            self.transient(master)
-
-        self.focus()
-
-    def _centreonscreen(self):
-	# Centre the window on the screen.  (Actually halfway across
-	# and one third down.)
-
-        parent = self.winfo_parent()
-        if type(parent) == types.StringType:
-            parent = self._hull._nametowidget(parent)
-
-        # Find size of window.
-	self.update_idletasks()
-        width = self.winfo_width()
-        height = self.winfo_height()
-        if width == 1 and height == 1:
-            # If the window has not yet been displayed, its size is
-            # reported as 1x1, so use requested size.
-            width = self.winfo_reqwidth()
-            height = self.winfo_reqheight()
-
-        # Place in centre of screen:
-	x = (self.winfo_screenwidth() - width) / 2 - parent.winfo_vrootx()
-	y = (self.winfo_screenheight() - height) / 3 - parent.winfo_vrooty()
-	if x &lt; 0:
-	    x = 0
-	if y &lt; 0:
-	    y = 0
-        return '+%d+%d' % (x, y)
-
-    def _sameposition(self):
-	# Position the window at the same place it was last time.
-
-	geometry = self.geometry()
-	index = string.find(geometry, '+')
-	if index &gt;= 0:
-	    return geometry[index:]
-        else:
-	    return None
-
-    def activate(self, globalMode = 0, geometry = 'centerscreenfirst'):
-	if self._active:
-	    raise ValueError, 'Window is already active'
-	if self.state() == 'normal':
-	    self.withdraw()
-
-	self._active = 1
-
-	showbusycursor()
-
-	if self._wait is None:
-	    self._wait = Tkinter.IntVar()
-	self._wait.set(0)
-
-	if geometry == 'centerscreenalways':
-	    geom = self._centreonscreen()
-	elif geometry == 'centerscreenfirst':
-	    if self._firstShowing:
-		# Centre the window the first time it is displayed.
-		geom = self._centreonscreen()
-	    else:
-		# Position the window at the same place it was last time.
-		geom = self._sameposition()
-	elif geometry[:5] == 'first':
-	    if self._firstShowing:
-                geom = geometry[5:]
-	    else:
-		# Position the window at the same place it was last time.
-		geom = self._sameposition()
-        else:
-            geom = geometry
-
-	self._firstShowing = 0
-
-        setgeometryanddeiconify(self, geom)
-
-        # Do this last, otherwise get flashing on NT:
-        master = self['master']
-        if master is not None:
-            if master == 'parent':
-                parent = self.winfo_parent()
-                # winfo_parent() should return the parent widget, but the
-                # the current version of Tkinter returns a string.
-                if type(parent) == types.StringType:
-                    parent = self._hull._nametowidget(parent)
-                master = parent.winfo_toplevel()
-            self.transient(master)
-
-        pushgrab(self._hull, globalMode, self.deactivate)
-	command = self['activatecommand']
-	if callable(command):
-	    command()
-	self.wait_variable(self._wait)
-
-	return self._result
-
-    def deactivate(self, result=None):
-	if not self._active:
-	    return
-	self._active = 0
-
-        # Restore the focus before withdrawing the window, since
-        # otherwise the window manager may take the focus away so we
-        # can't redirect it.  Also, return the grab to the next active
-        # window in the stack, if any.
-        popgrab(self._hull)
-
-        command = self['deactivatecommand']
-        if callable(command):
-            command()
-
-        self.withdraw()
-        hidebusycursor(forceFocusRestore = 1)
-
-        self._result = result
-        self._wait.set(1)
-
-    def active(self):
-	return self._active
-
-forwardmethods(MegaToplevel, Tkinter.Toplevel, '_hull')
-
-#=============================================================================
-
-class MegaWidget(MegaArchetype):
-    def __init__(self, parent = None, **kw):
-	# Define the options for this megawidget.
-	optiondefs = (
-	    ('hull_class',       self.__class__.__name__,  None),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaArchetype.__init__(self, parent, Tkinter.Frame)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-forwardmethods(MegaWidget, Tkinter.Frame, '_hull')
-
-#=============================================================================
-
-# Public functions
-#-----------------
-
-_traceTk = 0
-def tracetk(root = None, on = 1, withStackTrace = 0, file=None):
-    global _withStackTrace
-    global _traceTkFile
-    global _traceTk
-
-    if root is None:
-        root = Tkinter._default_root
-
-    _withStackTrace = withStackTrace
-    _traceTk = on
-    if on:
-	if hasattr(root.tk, '__class__'):
-	    # Tracing already on
-	    return
-	if file is None:
-	    _traceTkFile = sys.stderr
-	else:
-	    _traceTkFile = file
-	tk = _TraceTk(root.tk)
-    else:
-	if not hasattr(root.tk, '__class__'):
-	    # Tracing already off
-	    return
-	tk = root.tk.getTclInterp()
-    _setTkInterps(root, tk)
-
-def showbusycursor():
-
-    _addRootToToplevelBusyInfo()
-    root = Tkinter._default_root
-
-    busyInfo = {
-        'newBusyWindows' : [],
-        'previousFocus' : None,
-        'busyFocus' : None,
-    }
-    _busyStack.append(busyInfo)
-
-    if _disableKeyboardWhileBusy:
-        # Remember the focus as it is now, before it is changed.
-        busyInfo['previousFocus'] = root.tk.call('focus')
-
-    if not _havebltbusy(root):
-        # No busy command, so don't call busy hold on any windows.
-        return
-
-    for (window, winInfo) in _toplevelBusyInfo.items():
-	if (window.state() != 'withdrawn' and not winInfo['isBusy']
-                and not winInfo['excludeFromBusy']):
-            busyInfo['newBusyWindows'].append(window)
-            winInfo['isBusy'] = 1
-            _busy_hold(window, winInfo['busyCursorName'])
-
-            # Make sure that no events for the busy window get
-            # through to Tkinter, otherwise it will crash in
-            # _nametowidget with a 'KeyError: _Busy' if there is
-            # a binding on the toplevel window.
-            window.tk.call('bindtags', winInfo['busyWindow'], 'Pmw_Dummy_Tag')
-
-            if _disableKeyboardWhileBusy:
-                # Remember previous focus widget for this toplevel window
-                # and set focus to the busy window, which will ignore all
-                # keyboard events.
-                winInfo['windowFocus'] = \
-                        window.tk.call('focus', '-lastfor', window._w)
-                window.tk.call('focus', winInfo['busyWindow'])
-                busyInfo['busyFocus'] = winInfo['busyWindow']
-
-    if len(busyInfo['newBusyWindows']) &gt; 0:
-        if os.name == 'nt':
-            # NT needs an &quot;update&quot; before it will change the cursor.
-            window.update()
-        else:
-            window.update_idletasks()
-
-def hidebusycursor(forceFocusRestore = 0):
-
-    # Remember the focus as it is now, before it is changed.
-    root = Tkinter._default_root
-    if _disableKeyboardWhileBusy:
-        currentFocus = root.tk.call('focus')
-
-    # Pop the busy info off the stack.
-    busyInfo = _busyStack[-1]
-    del _busyStack[-1]
-
-    for window in busyInfo['newBusyWindows']:
-        # If this window has not been deleted, release the busy cursor.
-        if _toplevelBusyInfo.has_key(window):
-            winInfo = _toplevelBusyInfo[window]
-            winInfo['isBusy'] = 0
-            _busy_release(window)
-
-            if _disableKeyboardWhileBusy:
-                # Restore previous focus window for this toplevel window,
-                # but only if is still set to the busy window (it may have
-                # been changed).
-                windowFocusNow = window.tk.call('focus', '-lastfor', window._w)
-                if windowFocusNow == winInfo['busyWindow']:
-                    try:
-                        window.tk.call('focus', winInfo['windowFocus'])
-                    except Tkinter.TclError:
-                        # Previous focus widget has been deleted. Set focus
-                        # to toplevel window instead (can't leave focus on
-                        # busy window).
-                        window.focus_set()
-
-    if _disableKeyboardWhileBusy:
-        # Restore the focus, depending on whether the focus had changed
-        # between the calls to showbusycursor and hidebusycursor.
-        if forceFocusRestore or busyInfo['busyFocus'] == currentFocus:
-            # The focus had not changed, so restore it to as it was before
-            # the call to showbusycursor,
-            previousFocus = busyInfo['previousFocus']
-            if previousFocus is not None:
-                try:
-                    root.tk.call('focus', previousFocus)
-                except Tkinter.TclError:
-                    # Previous focus widget has been deleted; forget it.
-                    pass
-        else:
-            # The focus had changed, so restore it to what it had been
-            # changed to before the call to hidebusycursor.
-            root.tk.call('focus', currentFocus)
-
-def clearbusycursor():
-    while len(_busyStack) &gt; 0:
-        hidebusycursor()
-
-def setbusycursorattributes(window, **kw):
-    _addRootToToplevelBusyInfo()
-    for name, value in kw.items():
-        if name == 'exclude':
-            _toplevelBusyInfo[window]['excludeFromBusy'] = value
-        elif name == 'cursorName':
-            _toplevelBusyInfo[window]['busyCursorName'] = value
-        else:
-            raise KeyError, 'Unknown busycursor attribute &quot;' + name + '&quot;'
-
-def _addRootToToplevelBusyInfo():
-    # Include the Tk root window in the list of toplevels.  This must
-    # not be called before Tkinter has had a chance to be initialised by
-    # the application.
-
-    root = Tkinter._default_root
-    if root == None:
-        root = Tkinter.Tk()
-    if not _toplevelBusyInfo.has_key(root):
-        _addToplevelBusyInfo(root)
-
-def busycallback(command, updateFunction = None):
-    if not callable(command):
-	raise ValueError, \
-	    'cannot register non-command busy callback %s %s' % \
-	        (repr(command), type(command))
-    wrapper = _BusyWrapper(command, updateFunction)
-    return wrapper.callback
-
-_errorReportFile = None
-_errorWindow = None
-
-def reporterrorstofile(file = None):
-    global _errorReportFile
-    _errorReportFile = file
-
-def displayerror(text):
-    global _errorWindow
-
-    if _errorReportFile is not None:
-	_errorReportFile.write(text + '\n')
-    else:
-        # Print error on standard error as well as to error window. 
-        # Useful if error window fails to be displayed, for example
-        # when exception is triggered in a &lt;Destroy&gt; binding for root
-        # window.
-        sys.stderr.write(text + '\n')
-
-	if _errorWindow is None:
-	    # The error window has not yet been created.
-	    _errorWindow = _ErrorWindow()
-
-	_errorWindow.showerror(text)
-
-_root = None
-_disableKeyboardWhileBusy = 1
-
-def initialise(
-        root = None,
-        size = None,
-        fontScheme = None,
-        useTkOptionDb = 0,
-        noBltBusy = 0,
-        disableKeyboardWhileBusy = None,
-):
-    # Remember if show/hidebusycursor should ignore keyboard events.
-    global _disableKeyboardWhileBusy
-    if disableKeyboardWhileBusy is not None:
-        _disableKeyboardWhileBusy = disableKeyboardWhileBusy
-
-    # Do not use blt busy command if noBltBusy is set.  Otherwise,
-    # use blt busy if it is available.
-    global _haveBltBusy
-    if noBltBusy:
-        _haveBltBusy = 0
-
-    # Save flag specifying whether the Tk option database should be
-    # queried when setting megawidget option default values.
-    global _useTkOptionDb
-    _useTkOptionDb = useTkOptionDb
-
-    # If we haven't been given a root window, use the default or
-    # create one.
-    if root is None:
-	if Tkinter._default_root is None:
-	    root = Tkinter.Tk()
-	else:
-	    root = Tkinter._default_root
-
-    # If this call is initialising a different Tk interpreter than the
-    # last call, then re-initialise all global variables.  Assume the
-    # last interpreter has been destroyed - ie:  Pmw does not (yet)
-    # support multiple simultaneous interpreters.
-    global _root
-    if _root is not None and _root != root:
-        global _busyStack
-        global _errorWindow
-        global _grabStack
-        global _hullToMegaWidget
-        global _toplevelBusyInfo
-        _busyStack = []
-        _errorWindow = None
-        _grabStack = []
-        _hullToMegaWidget = {}
-        _toplevelBusyInfo = {}
-    _root = root
-
-    # Trap Tkinter Toplevel constructors so that a list of Toplevels
-    # can be maintained.
-    Tkinter.Toplevel.title = __TkinterToplevelTitle
-
-    # Trap Tkinter widget destruction so that megawidgets can be
-    # destroyed when their hull widget is destoyed and the list of
-    # Toplevels can be pruned.
-    Tkinter.Toplevel.destroy = __TkinterToplevelDestroy
-    Tkinter.Widget.destroy = __TkinterWidgetDestroy
-
-    # Modify Tkinter's CallWrapper class to improve the display of
-    # errors which occur in callbacks.
-    Tkinter.CallWrapper = __TkinterCallWrapper
-
-    # Make sure we get to know when the window manager deletes the
-    # root window.  Only do this if the protocol has not yet been set. 
-    # This is required if there is a modal dialog displayed and the
-    # window manager deletes the root window.  Otherwise the
-    # application will not exit, even though there are no windows.
-    if root.protocol('WM_DELETE_WINDOW') == '':
-	root.protocol('WM_DELETE_WINDOW', root.destroy)
-
-    # Set the base font size for the application and set the
-    # Tk option database font resources.
-    
-    _font_initialise(root, size, fontScheme)
-
-    return root
-
-def alignlabels(widgets, sticky = None):
-    if len(widgets) == 0:
-    	return
-
-    widgets[0].update_idletasks()
-
-    # Determine the size of the maximum length label string.
-    maxLabelWidth = 0
-    for iwid in widgets:
-	labelWidth = iwid.grid_bbox(0, 1)[2]
-	if labelWidth &gt; maxLabelWidth:
-	    maxLabelWidth = labelWidth
-
-    # Adjust the margins for the labels such that the child sites and
-    # labels line up.
-    for iwid in widgets:
-	if sticky is not None:
-	    iwid.component('label').grid(sticky=sticky)
-	iwid.grid_columnconfigure(0, minsize = maxLabelWidth)
-#=============================================================================
-
-# Private routines
-#-----------------
-_callToTkReturned = 1
-_recursionCounter = 1
-
-class _TraceTk:
-    def __init__(self, tclInterp):
-        self.tclInterp = tclInterp
-
-    def getTclInterp(self):
-        return self.tclInterp
-
-    # Calling from python into Tk.
-    def call(self, *args, **kw):
-        global _callToTkReturned
-        global _recursionCounter
-
-        _callToTkReturned = 0
-        if len(args) == 1 and type(args[0]) == types.TupleType:
-            argStr = str(args[0])
-        else:
-            argStr = str(args)
-	_traceTkFile.write('CALL  TK&gt; %d:%s%s' %
-                (_recursionCounter, '  ' * _recursionCounter, argStr))
-	_recursionCounter = _recursionCounter + 1
-        try:
-            result = apply(self.tclInterp.call, args, kw)
-	except Tkinter.TclError, errorString:
-            _callToTkReturned = 1
-            _recursionCounter = _recursionCounter - 1
-            _traceTkFile.write('\nTK ERROR&gt; %d:%s-&gt; %s\n' %
-                    (_recursionCounter, '  ' * _recursionCounter,
-                            repr(errorString)))
-            if _withStackTrace:
-                _traceTkFile.write('CALL  TK&gt; stack:\n')
-                traceback.print_stack()
-            raise Tkinter.TclError, errorString
-
-        _recursionCounter = _recursionCounter - 1
-        if _callToTkReturned:
-            _traceTkFile.write('CALL RTN&gt; %d:%s-&gt; %s' %
-                    (_recursionCounter, '  ' * _recursionCounter, repr(result)))
-        else:
-            _callToTkReturned = 1
-            if result:
-                _traceTkFile.write(' -&gt; %s' % repr(result))
-        _traceTkFile.write('\n')
-        if _withStackTrace:
-            _traceTkFile.write('CALL  TK&gt; stack:\n')
-            traceback.print_stack()
-
-        _traceTkFile.flush()
-        return result
-
-    def __getattr__(self, key):
-        return getattr(self.tclInterp, key)
-
-def _setTkInterps(window, tk):
-    window.tk = tk
-    for child in window.children.values():
-      _setTkInterps(child, tk)
-
-#=============================================================================
-
-# Functions to display a busy cursor.  Keep a list of all toplevels
-# and display the busy cursor over them.  The list will contain the Tk
-# root toplevel window as well as all other toplevel windows.
-# Also keep a list of the widget which last had focus for each
-# toplevel.
-
-# Map from toplevel windows to
-#     {'isBusy', 'windowFocus', 'busyWindow',
-#         'excludeFromBusy', 'busyCursorName'}
-_toplevelBusyInfo = {}
-
-# Pmw needs to know all toplevel windows, so that it can call blt busy
-# on them.  This is a hack so we get notified when a Tk topevel is
-# created.  Ideally, the __init__ 'method' should be overridden, but
-# it is a 'read-only special attribute'.  Luckily, title() is always
-# called from the Tkinter Toplevel constructor.
-
-def _addToplevelBusyInfo(window):
-    if window._w == '.':
-        busyWindow = '._Busy'
-    else:
-        busyWindow = window._w + '._Busy'
-
-    _toplevelBusyInfo[window] = {
-        'isBusy' : 0,
-        'windowFocus' : None,
-        'busyWindow' : busyWindow,
-        'excludeFromBusy' : 0,
-        'busyCursorName' : None,
-    }
-
-def __TkinterToplevelTitle(self, *args):
-    # If this is being called from the constructor, include this
-    # Toplevel in the list of toplevels and set the initial
-    # WM_DELETE_WINDOW protocol to destroy() so that we get to know
-    # about it.
-    if not _toplevelBusyInfo.has_key(self):
-        _addToplevelBusyInfo(self)
-        self._Pmw_WM_DELETE_name = self.register(self.destroy, None, 0)
-	self.protocol('WM_DELETE_WINDOW', self._Pmw_WM_DELETE_name)
-
-    return apply(Tkinter.Wm.title, (self,) + args)
-
-_haveBltBusy = None
-def _havebltbusy(window):
-    global _busy_hold, _busy_release, _haveBltBusy
-    if _haveBltBusy is None:
-        import PmwBlt
-        _haveBltBusy = PmwBlt.havebltbusy(window)
-        _busy_hold = PmwBlt.busy_hold
-        if os.name == 'nt':
-            # There is a bug in Blt 2.4i on NT where the busy window
-            # does not follow changes in the children of a window.
-            # Using forget works around the problem.
-            _busy_release = PmwBlt.busy_forget
-        else:
-            _busy_release = PmwBlt.busy_release
-    return _haveBltBusy
-
-class _BusyWrapper:
-    def __init__(self, command, updateFunction):
-	self._command = command
-	self._updateFunction = updateFunction
-
-    def callback(self, *args):
-	showbusycursor()
-	rtn = apply(self._command, args)
-
-	# Call update before hiding the busy windows to clear any
-	# events that may have occurred over the busy windows.
-	if callable(self._updateFunction):
-	    self._updateFunction()
-
-	hidebusycursor()
-	return rtn
-
-#=============================================================================
-
-def drawarrow(canvas, color, direction, tag, baseOffset = 0.25, edgeOffset = 0.15):
-    canvas.delete(tag)
-
-    bw = (string.atoi(canvas['borderwidth']) + 
-            string.atoi(canvas['highlightthickness']))
-    width = string.atoi(canvas['width'])
-    height = string.atoi(canvas['height'])
-
-    if direction in ('up', 'down'):
-        majorDimension = height
-        minorDimension = width
-    else:
-        majorDimension = width
-        minorDimension = height
-
-    offset = round(baseOffset * majorDimension)
-    if direction in ('down', 'right'):
-        base = bw + offset
-        apex = bw + majorDimension - offset
-    else:
-        base = bw + majorDimension - offset
-        apex = bw + offset
-
-    if minorDimension &gt; 3 and minorDimension % 2 == 0:
-        minorDimension = minorDimension - 1
-    half = int(minorDimension * (1 - 2 * edgeOffset)) / 2
-    low = round(bw + edgeOffset * minorDimension)
-    middle = low + half
-    high = low + 2 * half
-
-    if direction in ('up', 'down'):
-        coords = (low, base, high, base, middle, apex)
-    else:
-        coords = (base, low, base, high, apex, middle)
-    kw = {'fill' : color, 'outline' : color, 'tag' : tag}
-    apply(canvas.create_polygon, coords, kw)
-
-#=============================================================================
-
-# Modify the Tkinter destroy methods so that it notifies us when a Tk
-# toplevel or frame is destroyed.
-
-# A map from the 'hull' component of a megawidget to the megawidget. 
-# This is used to clean up a megawidget when its hull is destroyed.
-_hullToMegaWidget = {}
-
-def __TkinterToplevelDestroy(tkWidget):
-    if _hullToMegaWidget.has_key(tkWidget):
-        mega = _hullToMegaWidget[tkWidget]
-        try:
-	    mega.destroy()
-        except:
-	    _reporterror(mega.destroy, ())
-    else:
-        # Delete the busy info structure for this toplevel (if the
-        # window was created before initialise() was called, it
-        # will not have any.
-        if _toplevelBusyInfo.has_key(tkWidget):
-            del _toplevelBusyInfo[tkWidget]
-        if hasattr(tkWidget, '_Pmw_WM_DELETE_name'):
-            tkWidget.tk.deletecommand(tkWidget._Pmw_WM_DELETE_name)
-            del tkWidget._Pmw_WM_DELETE_name
-        Tkinter.BaseWidget.destroy(tkWidget)
-
-def __TkinterWidgetDestroy(tkWidget):
-    if _hullToMegaWidget.has_key(tkWidget):
-        mega = _hullToMegaWidget[tkWidget]
-        try:
-	    mega.destroy()
-        except:
-	    _reporterror(mega.destroy, ())
-    else:
-        Tkinter.BaseWidget.destroy(tkWidget)
-
-#=============================================================================
-
-# Add code to Tkinter to improve the display of errors which occur in
-# callbacks.
-
-class __TkinterCallWrapper:
-    def __init__(self, func, subst, widget):
-	self.func = func
-	self.subst = subst
-	self.widget = widget
-
-    # Calling back from Tk into python.
-    def __call__(self, *args):
-	try:
-	    if self.subst:
-		args = apply(self.subst, args)
-            if _traceTk:
-                if not _callToTkReturned:
-                    _traceTkFile.write('\n')
-                if hasattr(self.func, 'im_class'):
-                    name = self.func.im_class.__name__ + '.' + \
-                        self.func.__name__
-                else:
-                    name = self.func.__name__
-                if len(args) == 1 and hasattr(args[0], 'type'):
-                    # The argument to the callback is an event.
-                    eventName = _eventTypeToName[string.atoi(args[0].type)]
-                    if eventName in ('KeyPress', 'KeyRelease',):
-                        argStr = '(%s %s Event: %s)' % \
-                            (eventName, args[0].keysym, args[0].widget)
-                    else:
-                        argStr = '(%s Event, %s)' % (eventName, args[0].widget)
-                else:
-                    argStr = str(args)
-                _traceTkFile.write('CALLBACK&gt; %d:%s%s%s\n' %
-                    (_recursionCounter, '  ' * _recursionCounter, name, argStr))
-                _traceTkFile.flush()
-	    return apply(self.func, args)
-	except SystemExit, msg:
-	    raise SystemExit, msg
-	except:
-	    _reporterror(self.func, args)
-
-_eventTypeToName = {
-    2 : 'KeyPress',         15 : 'VisibilityNotify',   28 : 'PropertyNotify',
-    3 : 'KeyRelease',       16 : 'CreateNotify',       29 : 'SelectionClear',
-    4 : 'ButtonPress',      17 : 'DestroyNotify',      30 : 'SelectionRequest',
-    5 : 'ButtonRelease',    18 : 'UnmapNotify',        31 : 'SelectionNotify',
-    6 : 'MotionNotify',     19 : 'MapNotify',          32 : 'ColormapNotify',
-    7 : 'EnterNotify',      20 : 'MapRequest',         33 : 'ClientMessage',
-    8 : 'LeaveNotify',      21 : 'ReparentNotify',     34 : 'MappingNotify',
-    9 : 'FocusIn',          22 : 'ConfigureNotify',    35 : 'VirtualEvents',
-    10 : 'FocusOut',        23 : 'ConfigureRequest',   36 : 'ActivateNotify',
-    11 : 'KeymapNotify',    24 : 'GravityNotify',      37 : 'DeactivateNotify',
-    12 : 'Expose',          25 : 'ResizeRequest',      38 : 'MouseWheelEvent',
-    13 : 'GraphicsExpose',  26 : 'CirculateNotify',
-    14 : 'NoExpose',        27 : 'CirculateRequest',
-}
-
-def _reporterror(func, args):
-    # Fetch current exception values.
-    exc_type, exc_value, exc_traceback = sys.exc_info()
-
-    # Give basic information about the callback exception.
-    if type(exc_type) == types.ClassType:
-	# Handle python 1.5 class exceptions.
-	exc_type = exc_type.__name__
-    msg = exc_type + ' Exception in Tk callback\n'
-    msg = msg + '  Function: %s (type: %s)\n' % (repr(func), type(func))
-    msg = msg + '  Args: %s\n' % str(args)
-
-    if type(args) == types.TupleType and len(args) &gt; 0 and \
-	    hasattr(args[0], 'type'):
-        eventArg = 1
-    else:
-        eventArg = 0
-
-    # If the argument to the callback is an event, add the event type.
-    if eventArg:
-	eventNum = string.atoi(args[0].type)
-        if eventNum in _eventTypeToName.keys():
-            msg = msg + '  Event type: %s (type num: %d)\n' % \
-                    (_eventTypeToName[eventNum], eventNum)
-        else:
-            msg = msg + '  Unknown event type (type num: %d)\n' % eventNum
-
-    # Add the traceback.
-    msg = msg + 'Traceback (innermost last):\n'
-    for tr in traceback.extract_tb(exc_traceback):
-	msg = msg + '  File &quot;%s&quot;, line %s, in %s\n' % (tr[0], tr[1], tr[2])
-	msg = msg + '    %s\n' % tr[3]
-    msg = msg + '%s: %s\n' % (exc_type, exc_value)
-
-    # If the argument to the callback is an event, add the event contents.
-    if eventArg:
-	msg = msg + '\n================================================\n'
-	msg = msg + '  Event contents:\n'
-	keys = args[0].__dict__.keys()
-	keys.sort()
-	for key in keys:
-	    msg = msg + '    %s: %s\n' % (key, args[0].__dict__[key])
-
-    clearbusycursor()
-    try:
-	displayerror(msg)
-    except:
-        pass
-
-class _ErrorWindow:
-    def __init__(self):
-
-	self._errorQueue = []
-	self._errorCount = 0
-	self._open = 0
-        self._firstShowing = 1
-
-	# Create the toplevel window
-	self._top = Tkinter.Toplevel()
-	self._top.protocol('WM_DELETE_WINDOW', self._hide)
-	self._top.title('Error in background function')
-	self._top.iconname('Background error')
-
-	# Create the text widget and scrollbar in a frame
-	upperframe = Tkinter.Frame(self._top)
-
-	scrollbar = Tkinter.Scrollbar(upperframe, orient='vertical')
-	scrollbar.pack(side = 'right', fill = 'y')
-
-	self._text = Tkinter.Text(upperframe, yscrollcommand=scrollbar.set)
-	self._text.pack(fill = 'both', expand = 1)
-	scrollbar.configure(command=self._text.yview)
-
-	# Create the buttons and label in a frame
-	lowerframe = Tkinter.Frame(self._top)
-
-	ignore = Tkinter.Button(lowerframe,
-	        text = 'Ignore remaining errors', command = self._hide)
-	ignore.pack(side='left')
-
-	self._nextError = Tkinter.Button(lowerframe,
-	        text = 'Show next error', command = self._next)
-	self._nextError.pack(side='left')
-
-	self._label = Tkinter.Label(lowerframe, relief='ridge')
-	self._label.pack(side='left', fill='x', expand=1)
-
-	# Pack the lower frame first so that it does not disappear
-	# when the window is resized.
-	lowerframe.pack(side = 'bottom', fill = 'x')
-	upperframe.pack(side = 'bottom', fill = 'both', expand = 1)
-
-    def showerror(self, text):
-	if self._open:
-	    self._errorQueue.append(text)
-	else:
-	    self._display(text)
-	    self._open = 1
-
-	# Display the error window in the same place it was before.
-	if self._top.state() == 'normal':
-	    # If update_idletasks is not called here, the window may
-	    # be placed partially off the screen.  Also, if it is not
-	    # called and many errors are generated quickly in
-	    # succession, the error window may not display errors
-	    # until the last one is generated and the interpreter
-	    # becomes idle.
-	    # XXX: remove this, since it causes omppython to go into an
-	    # infinite loop if an error occurs in an omp callback.
-	    # self._top.update_idletasks()
-
-            pass
-	else:
-	    if self._firstShowing:
-		geom = None
-	    else:
-                geometry = self._top.geometry()
-                index = string.find(geometry, '+')
-                if index &gt;= 0:
-                    geom = geometry[index:]
-                else:
-                    geom = None
-            setgeometryanddeiconify(self._top, geom)
-
-        if self._firstShowing:
-            self._firstShowing = 0
-        else:
-            self._top.tkraise()
-
-        self._top.focus()
-
-	self._updateButtons()
-
-	# Release any grab, so that buttons in the error window work.
-        releasegrabs()
-
-    def _hide(self):
-	self._errorCount = self._errorCount + len(self._errorQueue)
-	self._errorQueue = []
-	self._top.withdraw()
-	self._open = 0
-
-    def _next(self):
-	# Display the next error in the queue. 
-
-	text = self._errorQueue[0]
-	del self._errorQueue[0]
-
-	self._display(text)
-	self._updateButtons()
-
-    def _display(self, text):
-	self._errorCount = self._errorCount + 1
-	text = 'Error: %d\n%s' % (self._errorCount, text)
-	self._text.delete('1.0', 'end')
-	self._text.insert('end', text)
-
-    def _updateButtons(self):
-	numQueued = len(self._errorQueue)
-	if numQueued &gt; 0:
-	    self._label.configure(text='%d more errors' % numQueued)
-	    self._nextError.configure(state='normal')
-	else:
-	    self._label.configure(text='No more errors')
-	    self._nextError.configure(state='disabled')
-
-######################################################################
-### File: PmwDialog.py
-# Based on iwidgets2.2.0/dialog.itk and iwidgets2.2.0/dialogshell.itk code.
-
-# Convention:
-#   Each dialog window should have one of these as the rightmost button:
-#     Close         Close a window which only displays information.
-#     Cancel        Close a window which may be used to change the state of
-#                   the application.
-
-import sys
-import types
-import Tkinter
-
-
-# A Toplevel with a ButtonBox and child site.
-
-class Dialog(MegaToplevel):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('buttonbox_hull_borderwidth',   1,         None),
-	    ('buttonbox_hull_relief',        'raised',  None),
-	    ('buttonboxpos',                 's',       INITOPT),
-	    ('buttons',                      ('OK',),   self._buttons),
-	    ('command',                      None,      None),
-	    ('dialogchildsite_borderwidth',  1,         None),
-	    ('dialogchildsite_relief',       'raised',  None),
-	    ('defaultbutton',                None,      self._defaultButton),
-            ('master',                       'parent',  None),
-	    ('separatorwidth',               0,         INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaToplevel.__init__(self, parent)
-
-	# Create the components.
-
-	oldInterior = MegaToplevel.interior(self)
-
-	# Set up pack options according to the position of the button box.
-        pos = self['buttonboxpos']
-	if pos not in 'nsew':
-	    raise ValueError, \
-	        'bad buttonboxpos option &quot;%s&quot;:  should be n, s, e, or w' \
-		    % pos
-
-	if pos in 'ns':
-	    orient = 'horizontal'
-	    fill = 'x'
-	    if pos == 'n':
-	        side = 'top'
-	    else:
-	        side = 'bottom'
-	else:
-	    orient = 'vertical'
-	    fill = 'y'
-	    if pos == 'w':
-	        side = 'left'
-	    else:
-	        side = 'right'
-
-	# Create the button box.
-	self._buttonBox = self.createcomponent('buttonbox',
-		(), None,
-		ButtonBox, (oldInterior,), orient = orient)
-	self._buttonBox.pack(side = side, fill = fill)
-
-	# Create the separating line.
-	width = self['separatorwidth']
-	if width &gt; 0:
-	    self._separator = self.createcomponent('separator',
-		    (), None,
-		    Tkinter.Frame, (oldInterior,), relief = 'sunken',
-		    height = width, width = width, borderwidth = width / 2)
-	    self._separator.pack(side = side, fill = fill)
-	
-	# Create the child site.
-	self.__dialogChildSite = self.createcomponent('dialogchildsite',
-		(), None,
-		Tkinter.Frame, (oldInterior,))
-	self.__dialogChildSite.pack(side=side, fill='both', expand=1)
-
-	self.oldButtons = ()
-	self.oldDefault = None
-
-	self.bind('&lt;Return&gt;', self._invokeDefault)
-        self.userdeletefunc(self._doCommand)
-        self.usermodaldeletefunc(self._doCommand)
-	
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def interior(self):
-	return self.__dialogChildSite
-
-    def invoke(self, index = DEFAULT):
-	return self._buttonBox.invoke(index)
-
-    def _invokeDefault(self, event):
-	try:
-	    self._buttonBox.index(DEFAULT)
-	except ValueError:
-	    return
-	self._buttonBox.invoke()
-
-    def _doCommand(self, name = None):
-        if name is not None and self.active() and \
-                grabstacktopwindow() != self.component('hull'):
-            # This is a modal dialog but is not on the top of the grab
-            # stack (ie:  should not have the grab), so ignore this
-            # event.  This seems to be a bug in Tk and may occur in
-            # nested modal dialogs.
-            #
-            # An example is the PromptDialog demonstration.  To
-            # trigger the problem, start the demo, then move the mouse
-            # to the main window, hit &lt;TAB&gt; and then &lt;TAB&gt; again.  The
-            # highlight border of the &quot;Show prompt dialog&quot; button
-            # should now be displayed.  Now hit &lt;SPACE&gt;, &lt;RETURN&gt;,
-            # &lt;RETURN&gt; rapidly several times.  Eventually, hitting the
-            # return key invokes the password dialog &quot;OK&quot; button even
-            # though the confirm dialog is active (and therefore
-            # should have the keyboard focus).  Observed under Solaris
-            # 2.5.1, python 1.5.2 and Tk8.0.
-
-            # TODO:  Give focus to the window on top of the grabstack.
-            return
-
-	command = self['command']
-	if callable(command):
-	    return command(name)
-	else:
-	    if self.active():
-	        self.deactivate(name)
-	    else:
-	        self.withdraw()
-
-    def _buttons(self):
-	buttons = self['buttons']
-	if type(buttons) != types.TupleType and type(buttons) != types.ListType:
-	    raise ValueError, \
-	        'bad buttons option &quot;%s&quot;: should be a tuple' % str(buttons)
-	if self.oldButtons == buttons:
-	  return
-
-	self.oldButtons = buttons
-
-	for index in range(self._buttonBox.numbuttons()):
-	    self._buttonBox.delete(0)
-	for name in buttons:
-	    self._buttonBox.add(name,
-		command=lambda self=self, name=name: self._doCommand(name))
-
-	if len(buttons) &gt; 0:
-	    defaultbutton = self['defaultbutton']
-	    if defaultbutton is None:
-		self._buttonBox.setdefault(None)
-	    else:
-		try:
-		    self._buttonBox.index(defaultbutton)
-		except ValueError:
-		    pass
-		else:
-		    self._buttonBox.setdefault(defaultbutton)
-	self._buttonBox.alignbuttons()
-
-    def _defaultButton(self):
-	defaultbutton = self['defaultbutton']
-	if self.oldDefault == defaultbutton:
-	  return
-
-	self.oldDefault = defaultbutton
-
-	if len(self['buttons']) &gt; 0:
-	    if defaultbutton is None:
-		self._buttonBox.setdefault(None)
-	    else:
-		try:
-		    self._buttonBox.index(defaultbutton)
-		except ValueError:
-		    pass
-		else:
-		    self._buttonBox.setdefault(defaultbutton)
-
-######################################################################
-### File: PmwTimeFuncs.py
-# Functions for dealing with dates and times.
-
-import re
-import string
-
-def timestringtoseconds(text, separator = ':'):
-  inputList = string.split(string.strip(text), separator)
-  if len(inputList) != 3:
-    raise ValueError, 'invalid value: ' + text
-
-  sign = 1
-  if len(inputList[0]) &gt; 0 and inputList[0][0] in ('+', '-'):
-    if inputList[0][0] == '-':
-      sign = -1
-    inputList[0] = inputList[0][1:]
-
-  if re.search('[^0-9]', string.join(inputList, '')) is not None:
-    raise ValueError, 'invalid value: ' + text
-
-  hour = string.atoi(inputList[0])
-  minute = string.atoi(inputList[1])
-  second = string.atoi(inputList[2])
-
-  if minute &gt;= 60 or second &gt;= 60:
-    raise ValueError, 'invalid value: ' + text
-  return sign * (hour * 60 * 60 + minute * 60 + second)
-
-_year_pivot = 50
-_century = 2000
-
-def setyearpivot(pivot, century = None):
-    global _year_pivot
-    global _century
-    oldvalues = (_year_pivot, _century)
-    _year_pivot = pivot
-    if century is not None:
-	_century = century
-    return oldvalues
-
-def datestringtojdn(text, format = 'ymd', separator = '/'):
-  inputList = string.split(string.strip(text), separator)
-  if len(inputList) != 3:
-    raise ValueError, 'invalid value: ' + text
-
-  if re.search('[^0-9]', string.join(inputList, '')) is not None:
-    raise ValueError, 'invalid value: ' + text
-  formatList = list(format)
-  day = string.atoi(inputList[formatList.index('d')])
-  month = string.atoi(inputList[formatList.index('m')])
-  year = string.atoi(inputList[formatList.index('y')])
-
-  if _year_pivot is not None:
-    if year &gt;= 0 and year &lt; 100:
-      if year &lt;= _year_pivot:
-	year = year + _century
-      else:
-	year = year + _century - 100
-
-  jdn = ymdtojdn(year, month, day)
-  if jdntoymd(jdn) != (year, month, day):
-    raise ValueError, 'invalid value: ' + text
-  return jdn
-
-def _cdiv(a, b):
-    # Return a / b as calculated by most C language implementations,
-    # assuming both a and b are integers.
-
-    if a * b &gt; 0:
-	return a / b
-    else:
-	return -(abs(a) / abs(b))
-
-def ymdtojdn(year, month, day, julian = -1, papal = 1):
-
-    # set Julian flag if auto set
-    if julian &lt; 0:
-	if papal:                          # Pope Gregory XIII's decree
-	    lastJulianDate = 15821004L     # last day to use Julian calendar
-	else:                              # British-American usage
-	    lastJulianDate = 17520902L     # last day to use Julian calendar
-
-	julian = ((year * 100L) + month) * 100 + day  &lt;=  lastJulianDate
-
-    if year &lt; 0:
-	# Adjust BC year
-	year = year + 1
-
-    if julian:
-	return 367L * year - _cdiv(7 * (year + 5001L + _cdiv((month - 9), 7)), 4) + \
-	    _cdiv(275 * month, 9) + day + 1729777L
-    else:
-	return (day - 32076L) + \
-	    _cdiv(1461L * (year + 4800L + _cdiv((month - 14), 12)), 4) + \
-	    _cdiv(367 * (month - 2 - _cdiv((month - 14), 12) * 12), 12) - \
-	    _cdiv((3 * _cdiv((year + 4900L + _cdiv((month - 14), 12)), 100)), 4) + \
-	    1            # correction by rdg
-
-def jdntoymd(jdn, julian = -1, papal = 1):
-
-    # set Julian flag if auto set
-    if julian &lt; 0:
-	if papal:                          # Pope Gregory XIII's decree
-	    lastJulianJdn = 2299160L       # last jdn to use Julian calendar
-	else:                              # British-American usage
-	    lastJulianJdn = 2361221L       # last jdn to use Julian calendar
-
-	julian = (jdn &lt;= lastJulianJdn);
-
-    x = jdn + 68569L
-    if julian:
-	x = x + 38
-	daysPer400Years = 146100L
-	fudgedDaysPer4000Years = 1461000L + 1
-    else:
-	daysPer400Years = 146097L
-	fudgedDaysPer4000Years = 1460970L + 31
-
-    z = _cdiv(4 * x, daysPer400Years)
-    x = x - _cdiv((daysPer400Years * z + 3), 4)
-    y = _cdiv(4000 * (x + 1), fudgedDaysPer4000Years)
-    x = x - _cdiv(1461 * y, 4) + 31
-    m = _cdiv(80 * x, 2447)
-    d = x - _cdiv(2447 * m, 80)
-    x = _cdiv(m, 11)
-    m = m + 2 - 12 * x
-    y = 100 * (z - 49) + y + x
-
-    # Convert from longs to integers.
-    yy = int(y)
-    mm = int(m)
-    dd = int(d)
-
-    if yy &lt;= 0:
-	# Adjust BC years.
-	    yy = yy - 1
-
-    return (yy, mm, dd)
-
-def stringtoreal(text, separator = '.'):
-    if separator != '.':
-	if string.find(text, '.') &gt;= 0:
-	    raise ValueError, 'invalid value: ' + text
-	index = string.find(text, separator)
-	if index &gt;= 0:
-	    text = text[:index] + '.' + text[index + 1:]
-    return string.atof(text)
-
-######################################################################
-### File: PmwBalloon.py
-import os
-import string
-import Tkinter
-
-
-class Balloon(MegaToplevel):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	optiondefs = (
-            ('initwait',                 500,            None), # milliseconds
-            ('label_background',         'lightyellow',  None),
-            ('label_foreground',         'black',        None),
-            ('label_justify',            'left',         None),
-            ('master',                   'parent',       None),
-            ('relmouse',                 'none',         self._relmouse),
-            ('state',                    'both',         self._state),
-            ('statuscommand',            None,           None),
-            ('xoffset',                  20,             None), # pixels
-            ('yoffset',                  1,              None), # pixels
-	    ('hull_highlightthickness',  1,              None),
-	    ('hull_highlightbackground', 'black',        None),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaToplevel.__init__(self, parent)
-
-	self.withdraw()
-	self.overrideredirect(1)
-
-	# Create the components.
-	interior = self.interior()
-	self._label = self.createcomponent('label',
-		(), None,
-		Tkinter.Label, (interior,))
-	self._label.pack()
-
-        # The default hull configuration options give a black border
-        # around the balloon, but avoids a black 'flash' when the
-        # balloon is deiconified, before the text appears.
-        if not kw.has_key('hull_background'):
-            self.configure(hull_background = \
-                    str(self._label.cget('background')))
-
-	# Initialise instance variables.
-	self._timer = None
-
-        # The widget or item that is currently triggering the balloon. 
-        # It is None if the balloon is not being displayed.  It is a
-        # one-tuple if the balloon is being displayed in response to a
-        # widget binding (value is the widget).  It is a two-tuple if
-        # the balloon is being displayed in response to a canvas or
-        # text item binding (value is the widget and the item).
-        self._currentTrigger = None
-	
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	if self._timer is not None:
-	    self.after_cancel(self._timer)
-	    self._timer = None
-	MegaToplevel.destroy(self)
-
-    def bind(self, widget, balloonHelp, statusHelp = None):
-
-        # If a previous bind for this widget exists, remove it.
-        self.unbind(widget)
-
-	if balloonHelp is None and statusHelp is None:
-	    return
-
-	if statusHelp is None:
-	    statusHelp = balloonHelp
-	enterId = widget.bind('&lt;Enter&gt;', 
-		lambda event, self = self, w = widget,
-			sHelp = statusHelp, bHelp = balloonHelp:
-				self._enter(event, w, sHelp, bHelp, 0))
-
-        # Set Motion binding so that if the pointer remains at rest
-        # within the widget until the status line removes the help and
-        # then the pointer moves again, then redisplay the help in the
-        # status line.
-	# Note:  The Motion binding only works for basic widgets, and
-        # the hull of megawidgets but not for other megawidget components.
-	motionId = widget.bind('&lt;Motion&gt;', 
-		lambda event = None, self = self, statusHelp = statusHelp:
-			self.showstatus(statusHelp))
-
-	leaveId = widget.bind('&lt;Leave&gt;', self._leave)
-	buttonId = widget.bind('&lt;ButtonPress&gt;', self._buttonpress)
-
-        # Set Destroy binding so that the balloon can be withdrawn and
-        # the timer can be cancelled if the widget is destroyed.
-	destroyId = widget.bind('&lt;Destroy&gt;', self._destroy)
-
-        # Use the None item in the widget's private Pmw dictionary to
-        # store the widget's bind callbacks, for later clean up.
-        if not hasattr(widget, '_Pmw_BalloonBindIds'):
-            widget._Pmw_BalloonBindIds = {}
-        widget._Pmw_BalloonBindIds[None] = \
-                (enterId, motionId, leaveId, buttonId, destroyId)
-
-    def unbind(self, widget):
-        if hasattr(widget, '_Pmw_BalloonBindIds'):
-            if widget._Pmw_BalloonBindIds.has_key(None):
-                (enterId, motionId, leaveId, buttonId, destroyId) = \
-                        widget._Pmw_BalloonBindIds[None]
-                # Need to pass in old bindings, so that Tkinter can
-                # delete the commands.  Otherwise, memory is leaked.
-                widget.unbind('&lt;Enter&gt;', enterId)
-                widget.unbind('&lt;Motion&gt;', motionId)
-                widget.unbind('&lt;Leave&gt;', leaveId)
-                widget.unbind('&lt;ButtonPress&gt;', buttonId)
-                widget.unbind('&lt;Destroy&gt;', destroyId)
-                del widget._Pmw_BalloonBindIds[None]
-
-        if self._currentTrigger is not None and len(self._currentTrigger) == 1:
-            # The balloon is currently being displayed and the current
-            # trigger is a widget.
-            triggerWidget = self._currentTrigger[0]
-            if triggerWidget == widget:
-                if self._timer is not None:
-                    self.after_cancel(self._timer)
-                    self._timer = None
-                self.withdraw()
-                self.clearstatus()
-                self._currentTrigger = None
-
-    def tagbind(self, widget, tagOrItem, balloonHelp, statusHelp = None):
-
-        # If a previous bind for this widget's tagOrItem exists, remove it.
-        self.tagunbind(widget, tagOrItem)
-
-	if balloonHelp is None and statusHelp is None:
-	    return
-
-	if statusHelp is None:
-	    statusHelp = balloonHelp
-	enterId = widget.tag_bind(tagOrItem, '&lt;Enter&gt;', 
-		lambda event, self = self, w = widget,
-			sHelp = statusHelp, bHelp = balloonHelp:
-				self._enter(event, w, sHelp, bHelp, 1))
-	motionId = widget.tag_bind(tagOrItem, '&lt;Motion&gt;', 
-		lambda event = None, self = self, statusHelp = statusHelp:
-			self.showstatus(statusHelp))
-	leaveId = widget.tag_bind(tagOrItem, '&lt;Leave&gt;', self._leave)
-	buttonId = widget.tag_bind(tagOrItem, '&lt;ButtonPress&gt;', self._buttonpress)
-
-        # Use the tagOrItem item in the widget's private Pmw dictionary to
-        # store the tagOrItem's bind callbacks, for later clean up.
-        if not hasattr(widget, '_Pmw_BalloonBindIds'):
-            widget._Pmw_BalloonBindIds = {}
-        widget._Pmw_BalloonBindIds[tagOrItem] = \
-                (enterId, motionId, leaveId, buttonId)
-
-    def tagunbind(self, widget, tagOrItem):
-        if hasattr(widget, '_Pmw_BalloonBindIds'):
-            if widget._Pmw_BalloonBindIds.has_key(tagOrItem):
-                (enterId, motionId, leaveId, buttonId) = \
-                        widget._Pmw_BalloonBindIds[tagOrItem]
-                widget.tag_unbind(tagOrItem, '&lt;Enter&gt;', enterId)
-                widget.tag_unbind(tagOrItem, '&lt;Motion&gt;', motionId)
-                widget.tag_unbind(tagOrItem, '&lt;Leave&gt;', leaveId)
-                widget.tag_unbind(tagOrItem, '&lt;ButtonPress&gt;', buttonId)
-                del widget._Pmw_BalloonBindIds[tagOrItem]
-
-        if self._currentTrigger is None:
-            # The balloon is not currently being displayed.
-            return
-
-        if len(self._currentTrigger) == 1:
-            # The current trigger is a widget.
-            return
-
-        if len(self._currentTrigger) == 2:
-            # The current trigger is a canvas item.
-            (triggerWidget, triggerItem) = self._currentTrigger
-            if triggerWidget == widget and triggerItem == tagOrItem:
-                if self._timer is not None:
-                    self.after_cancel(self._timer)
-                    self._timer = None
-                self.withdraw()
-                self.clearstatus()
-                self._currentTrigger = None
-        else: # The current trigger is a text item.
-            (triggerWidget, x, y) = self._currentTrigger
-            if triggerWidget == widget:
-                currentPos = widget.index('@%d,%d' % (x, y))
-                currentTags = widget.tag_names(currentPos)
-                if tagOrItem in currentTags:
-                    if self._timer is not None:
-                        self.after_cancel(self._timer)
-                        self._timer = None
-                    self.withdraw()
-                    self.clearstatus()
-                    self._currentTrigger = None
-
-    def showstatus(self, statusHelp):
-	if self['state'] in ('status', 'both'):
-	    cmd = self['statuscommand']
-	    if callable(cmd):
-		cmd(statusHelp)
-
-    def clearstatus(self):
-        self.showstatus(None)
-
-    def _state(self):
-	if self['state'] not in ('both', 'balloon', 'status', 'none'):
-	    raise ValueError, 'bad state option ' + repr(self['state']) + \
-		': should be one of \'both\', \'balloon\', ' + \
-		'\'status\' or \'none\''
-
-    def _relmouse(self):
-	if self['relmouse'] not in ('both', 'x', 'y', 'none'):
-	    raise ValueError, 'bad relmouse option ' + repr(self['relmouse'])+ \
-		': should be one of \'both\', \'x\', ' + '\'y\' or \'none\''
-
-    def _enter(self, event, widget, statusHelp, balloonHelp, isItem):
-
-        # Do not display balloon if mouse button is pressed.  This
-        # will only occur if the button was pressed inside a widget,
-        # then the mouse moved out of and then back into the widget,
-        # with the button still held down.  The number 0x1f00 is the
-        # button mask for the 5 possible buttons in X.
-        buttonPressed = (event.state &amp; 0x1f00) != 0
-
-	if not buttonPressed and balloonHelp is not None and \
-                self['state'] in ('balloon', 'both'):
-	    if self._timer is not None:
-		self.after_cancel(self._timer)
-		self._timer = None
-
-	    self._timer = self.after(self['initwait'], 
-		    lambda self = self, widget = widget, help = balloonHelp,
-			    isItem = isItem:
-			    self._showBalloon(widget, help, isItem))
-
-        if isItem:
-            if hasattr(widget, 'canvasx'):
-		# The widget is a canvas.
-                item = widget.find_withtag('current')
-                if len(item) &gt; 0:
-                    item = item[0]
-                else:
-                    item = None
-                self._currentTrigger = (widget, item)
-            else:
-		# The widget is a text widget.
-                self._currentTrigger = (widget, event.x, event.y)
-        else:
-            self._currentTrigger = (widget,)
-
-	self.showstatus(statusHelp)
-
-    def _leave(self, event):
-	if self._timer is not None:
-	    self.after_cancel(self._timer)
-	    self._timer = None
-	self.withdraw()
-	self.clearstatus()
-        self._currentTrigger = None
-
-    def _destroy(self, event):
-
-        # Only withdraw the balloon and cancel the timer if the widget
-        # being destroyed is the widget that triggered the balloon. 
-        # Note that in a Tkinter Destroy event, the widget field is a
-        # string and not a widget as usual.
-
-        if self._currentTrigger is None:
-            # The balloon is not currently being displayed
-            return
-
-        if len(self._currentTrigger) == 1:
-            # The current trigger is a widget (not an item)
-            triggerWidget = self._currentTrigger[0]
-            if str(triggerWidget) == event.widget:
-                if self._timer is not None:
-                    self.after_cancel(self._timer)
-                    self._timer = None
-                self.withdraw()
-                self.clearstatus()
-                self._currentTrigger = None
-
-    def _buttonpress(self, event):
-	if self._timer is not None:
-	    self.after_cancel(self._timer)
-	    self._timer = None
-	self.withdraw()
-        self._currentTrigger = None
-
-    def _showBalloon(self, widget, balloonHelp, isItem):
-
-	self._label.configure(text = balloonHelp)
-
-        # First, display the balloon offscreen to get dimensions.
-        screenWidth = self.winfo_screenwidth()
-        screenHeight = self.winfo_screenheight()
-        self.geometry('+%d+0' % (screenWidth + 1))
-        self.update_idletasks()
-
-	if isItem:
-            # Get the bounding box of the current item.
-            bbox = widget.bbox('current')
-            if bbox is None:
-                # The item that triggered the balloon has disappeared,
-                # perhaps by a user's timer event that occured between
-                # the &lt;Enter&gt; event and the 'initwait' timer calling
-                # this method.
-                return
-
-	    # The widget is either a text or canvas.  The meaning of
-	    # the values returned by the bbox method is different for
-	    # each, so use the existence of the 'canvasx' method to
-	    # distinguish between them.
-	    if hasattr(widget, 'canvasx'):
-		# The widget is a canvas.  Place balloon under canvas
-                # item.  The positions returned by bbox are relative
-                # to the entire canvas, not just the visible part, so
-                # need to convert to window coordinates.
-                leftrel = bbox[0] - widget.canvasx(0)
-                toprel = bbox[1] - widget.canvasy(0)
-                bottomrel = bbox[3] - widget.canvasy(0)
-	    else:
-		# The widget is a text widget.  Place balloon under
-                # the character closest to the mouse.  The positions
-                # returned by bbox are relative to the text widget
-                # window (ie the visible part of the text only).
-		leftrel = bbox[0]
-                toprel = bbox[1]
-		bottomrel = bbox[1] + bbox[3]
-	else:
-	    leftrel = 0
-            toprel = 0
-	    bottomrel = widget.winfo_height()
-
-        xpointer, ypointer = widget.winfo_pointerxy()   # -1 if off screen
-
-        if xpointer &gt;= 0 and self['relmouse'] in ('both', 'x'):
-            x = xpointer
-        else:
-            x = leftrel + widget.winfo_rootx()
-        x = x + self['xoffset']
-
-        if ypointer &gt;= 0 and self['relmouse'] in ('both', 'y'):
-            y = ypointer
-        else:
-            y = bottomrel + widget.winfo_rooty()
-        y = y + self['yoffset']
-
-        edges = (string.atoi(str(self.cget('hull_highlightthickness'))) +
-            string.atoi(str(self.cget('hull_borderwidth')))) * 2
-        if x + self._label.winfo_reqwidth() + edges &gt; screenWidth:
-            x = screenWidth - self._label.winfo_reqwidth() - edges
-
-        if y + self._label.winfo_reqheight() + edges &gt; screenHeight:
-            if ypointer &gt;= 0 and self['relmouse'] in ('both', 'y'):
-                y = ypointer
-            else:
-                y = toprel + widget.winfo_rooty()
-            y = y - self._label.winfo_reqheight() - self['yoffset'] - edges
-
-        setgeometryanddeiconify(self, '+%d+%d' % (x, y))
-
-######################################################################
-### File: PmwButtonBox.py
-# Based on iwidgets2.2.0/buttonbox.itk code.
-
-import types
-import Tkinter
-
-
-class ButtonBox(MegaWidget):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('labelmargin',       0,              INITOPT),
-	    ('labelpos',          None,           INITOPT),
-	    ('orient',            'horizontal',   INITOPT),
-	    ('padx',              3,              INITOPT),
-	    ('pady',              3,              INITOPT),
-	)
-	self.defineoptions(kw, optiondefs, dynamicGroups = ('Button',))
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-	if self['labelpos'] is None:
-	    self._buttonBoxFrame = self._hull
-	    columnOrRow = 0
-	else:
-	    self._buttonBoxFrame = self.createcomponent('frame',
-		    (), None,
-		    Tkinter.Frame, (interior,))
-	    self._buttonBoxFrame.grid(column=2, row=2, sticky='nsew')
-	    columnOrRow = 2
-
-	    self.createlabel(interior)
-
-	orient = self['orient']
-	if orient == 'horizontal':
-	    interior.grid_columnconfigure(columnOrRow, weight = 1)
-	elif orient == 'vertical':
-	    interior.grid_rowconfigure(columnOrRow, weight = 1)
-	else:
-	    raise ValueError, 'bad orient option ' + repr(orient) + \
-		': must be either \'horizontal\' or \'vertical\''
-
-	# Initialise instance variables.
-
-	# List of tuples describing the buttons:
-	#   - name
-	#   - button widget
-	self._buttonList = []
-
-	# The index of the default button.
-	self._defaultButton = None
-
-	self._timerId = None
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	if self._timerId:
-	    self.after_cancel(self._timerId)
-	    self._timerId = None
-	MegaWidget.destroy(self)
-
-    def numbuttons(self):
-        return len(self._buttonList)
-
-    def index(self, index, forInsert = 0):
-	listLength = len(self._buttonList)
-	if type(index) == types.IntType:
-	    if forInsert and index &lt;= listLength:
-		return index
-	    elif not forInsert and index &lt; listLength:
-		return index
-	    else:
-		raise ValueError, 'index &quot;%s&quot; is out of range' % index
-	elif index is END:
-	    if forInsert:
-		return listLength
-	    elif listLength &gt; 0:
-		return listLength - 1
-	    else:
-		raise ValueError, 'ButtonBox has no buttons'
-	elif index is DEFAULT:
-	    if self._defaultButton is not None:
-		return self._defaultButton
-	    raise ValueError, 'ButtonBox has no default'
-	else:
-            names = map(lambda t: t[0], self._buttonList)
-            if index in names:
-                return names.index(index)
-	    validValues = 'a name, a number, END or DEFAULT'
-	    raise ValueError, \
-		'bad index &quot;%s&quot;: must be %s' % (index, validValues)
-
-    def insert(self, componentName, beforeComponent = 0, **kw):
-	if componentName in self.components():
-	    raise ValueError, 'button &quot;%s&quot; already exists' % componentName
-	if not kw.has_key('text'):
-	    kw['text'] = componentName
-        kw['default'] = 'normal'
-	button = apply(self.createcomponent, (componentName,
-		(), 'Button',
-		Tkinter.Button, (self._buttonBoxFrame,)), kw)
-
-	index = self.index(beforeComponent, 1)
-	horizontal = self['orient'] == 'horizontal'
-	numButtons = len(self._buttonList)
-
-	# Shift buttons up one position.
-	for i in range(numButtons - 1, index - 1, -1):
-	    widget = self._buttonList[i][1]
-	    pos = i * 2 + 3
-	    if horizontal:
-		widget.grid(column = pos, row = 0)
-	    else:
-		widget.grid(column = 0, row = pos)
-
-	# Display the new button.
-	if horizontal:
-	    button.grid(column = index * 2 + 1, row = 0, sticky = 'ew',
-		    padx = self['padx'], pady = self['pady'])
-	    self._buttonBoxFrame.grid_columnconfigure(
-		    numButtons * 2 + 2, weight = 1)
-	else:
-	    button.grid(column = 0, row = index * 2 + 1, sticky = 'ew',
-		    padx = self['padx'], pady = self['pady'])
-	    self._buttonBoxFrame.grid_rowconfigure(
-		    numButtons * 2 + 2, weight = 1)
-	self._buttonList.insert(index, (componentName, button))
-
-	return button
-
-    def add(self, componentName, **kw):
-        return apply(self.insert, (componentName, len(self._buttonList)), kw)
-
-    def delete(self, index):
-        index = self.index(index)
-	(name, widget) = self._buttonList[index]
-	widget.grid_forget()
-	self.destroycomponent(name)
-
-	numButtons = len(self._buttonList)
-
-	# Shift buttons down one position.
-	horizontal = self['orient'] == 'horizontal'
-	for i in range(index + 1, numButtons):
-	    widget = self._buttonList[i][1]
-	    pos = i * 2 - 1
-	    if horizontal:
-		widget.grid(column = pos, row = 0)
-	    else:
-		widget.grid(column = 0, row = pos)
-
-	if horizontal:
-	    self._buttonBoxFrame.grid_columnconfigure(numButtons * 2 - 1,
-		    minsize = 0)
-	    self._buttonBoxFrame.grid_columnconfigure(numButtons * 2, weight = 0)
-	else:
-	    self._buttonBoxFrame.grid_rowconfigure(numButtons * 2, weight = 0)
-	del self._buttonList[index]
-
-    def setdefault(self, index):
-	# Turn off the default ring around the current default button.
-	if self._defaultButton is not None:
-	    button = self._buttonList[self._defaultButton][1]
-	    button.configure(default = 'normal')
-	    self._defaultButton = None
-
-	# Turn on the default ring around the new default button.
-	if index is not None:
-	    index = self.index(index)
-	    self._defaultButton = index
-	    button = self._buttonList[index][1]
-	    button.configure(default = 'active')
-
-    def invoke(self, index = DEFAULT, noFlash = 0):
-	# Invoke the callback associated with the *index* button.  If
-	# *noFlash* is not set, flash the button to indicate to the
-	# user that something happened.
-
-	button = self._buttonList[self.index(index)][1]
-	if not noFlash:
-	    state = button.cget('state')
-	    relief = button.cget('relief')
-	    button.configure(state = 'active', relief = 'sunken')
-	    self.update_idletasks()
-	    self.after(100)
-	    button.configure(state = state, relief = relief)
-	return button.invoke()
-
-    def button(self, buttonIndex):
-	return self._buttonList[self.index(buttonIndex)][1]
-
-    def alignbuttons(self, when = 'later'):
-	if when == 'later':
-	    if not self._timerId:
-		self._timerId = self.after_idle(self.alignbuttons, 'now')
-	    return
-	self.update_idletasks()
-	self._timerId = None
-
-        # Determine the width of the maximum length button.
-        max = 0
-        horizontal = (self['orient'] == 'horizontal')
-        for index in range(len(self._buttonList)):
-            gridIndex = index * 2 + 1
-            if horizontal:
-                width = self._buttonBoxFrame.grid_bbox(gridIndex, 0)[2]
-            else:
-                width = self._buttonBoxFrame.grid_bbox(0, gridIndex)[2]
-            if width &gt; max:
-                max = width
-
-        # Set the width of all the buttons to be the same.
-	if horizontal:
-	    for index in range(len(self._buttonList)):
-		self._buttonBoxFrame.grid_columnconfigure(index * 2 + 1,
-			minsize = max)
-	else:
-	    self._buttonBoxFrame.grid_columnconfigure(0, minsize = max)
-
-######################################################################
-### File: PmwEntryField.py
-# Based on iwidgets2.2.0/entryfield.itk code.
-
-import re
-import string
-import types
-import Tkinter
-
-
-# Possible return values of validation functions.
-OK = 1
-ERROR = 0
-PARTIAL = -1
-
-class EntryField(MegaWidget):
-    _classBindingsDefinedFor = 0
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('command',           None,        None),
-	    ('errorbackground',   'pink',      None),
-	    ('invalidcommand',    self.bell,   None),
-	    ('labelmargin',       0,           INITOPT),
-	    ('labelpos',          None,        INITOPT),
-	    ('modifiedcommand',   None,        None),
-	    ('sticky',            'ew',        INITOPT),
-	    ('validate',          None,        self._validate),
-	    ('extravalidators',   {},          None),
-	    ('value',             '',          INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-	self._entryFieldEntry = self.createcomponent('entry',
-		(), None,
-		Tkinter.Entry, (interior,))
-	self._entryFieldEntry.grid(column=2, row=2, sticky=self['sticky'])
-	if self['value'] != '':
-	    self.__setEntry(self['value'])
-	interior.grid_columnconfigure(2, weight=1)
-	interior.grid_rowconfigure(2, weight=1)
-
-	self.createlabel(interior)
-
-	# Initialise instance variables.
-
-	self.normalBackground = None
-        self._previousText = None
-
-	# Initialise instance.
-
-	_registerEntryField(self._entryFieldEntry, self)
-
-        # Establish the special class bindings if not already done.
-        # Also create bindings if the Tkinter default interpreter has
-        # changed.  Use Tkinter._default_root to create class
-        # bindings, so that a reference to root is created by
-        # bind_class rather than a reference to self, which would
-        # prevent object cleanup.
-        if EntryField._classBindingsDefinedFor != Tkinter._default_root:
-	    tagList = self._entryFieldEntry.bindtags()
-            root  = Tkinter._default_root
-	    	    
-	    allSequences = {}
-	    for tag in tagList:
-
-                sequences = root.bind_class(tag)
-                if type(sequences) is types.StringType:
-                    # In old versions of Tkinter, bind_class returns a string
-                    sequences = root.tk.splitlist(sequences)
-
-		for sequence in sequences:
-		    allSequences[sequence] = None
-	    for sequence in allSequences.keys():
-		root.bind_class('EntryFieldPre', sequence, _preProcess)
-		root.bind_class('EntryFieldPost', sequence, _postProcess)
-
-	    EntryField._classBindingsDefinedFor = root
-
-	self._entryFieldEntry.bindtags(('EntryFieldPre',) +
-		self._entryFieldEntry.bindtags() + ('EntryFieldPost',))
-	self._entryFieldEntry.bind('&lt;Return&gt;', self._executeCommand)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	_deregisterEntryField(self._entryFieldEntry)
-        MegaWidget.destroy(self)
-
-    def _getValidatorFunc(self, validator, index):
-	# Search the extra and standard validator lists for the
-	# given 'validator'.  If 'validator' is an alias, then
-	# continue the search using the alias.  Make sure that
-	# self-referencial aliases do not cause infinite loops.
-
-	extraValidators = self['extravalidators']
-	traversedValidators = []
-
-	while 1:
-	    traversedValidators.append(validator)
-	    if extraValidators.has_key(validator):
-		validator = extraValidators[validator][index]
-	    elif _standardValidators.has_key(validator):
-		validator = _standardValidators[validator][index]
-	    else:
-		return validator
-	    if validator in traversedValidators:
-		return validator
-
-    def _validate(self):
-	dict = {
-	    'validator' : None,
-	    'min' : None,
-	    'max' : None,
-	    'minstrict' : 1,
-	    'maxstrict' : 1,
-	}
-	opt = self['validate']
-	if type(opt) is types.DictionaryType:
-	    dict.update(opt)
-	else:
-	    dict['validator'] = opt
-
-	# Look up validator maps and replace 'validator' field with
-	# the corresponding function.
-	validator = dict['validator']
-	valFunction = self._getValidatorFunc(validator, 0)
-	self._checkValidateFunction(valFunction, 'validate', validator)
-	dict['validator'] = valFunction
-
-	# Look up validator maps and replace 'stringtovalue' field
-	# with the corresponding function.
-	if dict.has_key('stringtovalue'):
-	    stringtovalue = dict['stringtovalue'] 
-	    strFunction = self._getValidatorFunc(stringtovalue, 1)
-	    self._checkValidateFunction(
-		    strFunction, 'stringtovalue', stringtovalue)
-	else:
-	    strFunction = self._getValidatorFunc(validator, 1)
-	    if strFunction == validator:
-		strFunction = len
-	dict['stringtovalue'] = strFunction
-
-	self._validationInfo = dict
-	args = dict.copy()
-	del args['validator']
-	del args['min']
-	del args['max']
-	del args['minstrict']
-	del args['maxstrict']
-	del args['stringtovalue']
-	self._validationArgs = args
-        self._previousText = None
-
-	if type(dict['min']) == types.StringType and strFunction is not None:
-	    dict['min'] = apply(strFunction, (dict['min'],), args)
-	if type(dict['max']) == types.StringType and strFunction is not None:
-	    dict['max'] = apply(strFunction, (dict['max'],), args)
-
-	self._checkValidity()
-
-    def _checkValidateFunction(self, function, option, validator):
-	# Raise an error if 'function' is not a function or None.
-
-	if function is not None and not callable(function):
-	    extraValidators = self['extravalidators']
-	    extra = extraValidators.keys()
-	    extra.sort()
-	    extra = tuple(extra)
-	    standard = _standardValidators.keys()
-	    standard.sort()
-	    standard = tuple(standard)
-	    msg = 'bad %s value &quot;%s&quot;:  must be a function or one of ' \
-		'the standard validators %s or extra validators %s'
-	    raise ValueError, msg % (option, validator, standard, extra)
-
-    def _executeCommand(self, event = None):
-	cmd = self['command']
-	if callable(cmd):
-            if event is None:
-                # Return result of command for invoke() method.
-                return cmd()
-            else:
-                cmd()
-	    
-    def _preProcess(self):
-
-        self._previousText = self._entryFieldEntry.get()
-        self._previousICursor = self._entryFieldEntry.index('insert')
-        self._previousXview = self._entryFieldEntry.index('@0')
-	if self._entryFieldEntry.selection_present():
-	    self._previousSel= (self._entryFieldEntry.index('sel.first'),
-		self._entryFieldEntry.index('sel.last'))
-	else:
-	    self._previousSel = None
-
-    def _postProcess(self):
-
-	# No need to check if text has not changed.
-	previousText = self._previousText
-	if previousText == self._entryFieldEntry.get():
-	    return self.valid()
-
-	valid = self._checkValidity()
-        if self.hulldestroyed():
-            # The invalidcommand called by _checkValidity() destroyed us.
-            return valid
-
-	cmd = self['modifiedcommand']
-	if callable(cmd) and previousText != self._entryFieldEntry.get():
-	    cmd()
-	return valid
-	    
-    def checkentry(self):
-	# If there is a variable specified by the entry_textvariable
-	# option, checkentry() should be called after the set() method
-	# of the variable is called.
-
-	self._previousText = None
-	return self._postProcess()
-
-    def _getValidity(self):
-	text = self._entryFieldEntry.get()
-	dict = self._validationInfo
-	args = self._validationArgs
-
-	if dict['validator'] is not None:
-	    status = apply(dict['validator'], (text,), args)
-	    if status != OK:
-		return status
-
-	# Check for out of (min, max) range.
-	if dict['stringtovalue'] is not None:
-	    min = dict['min']
-	    max = dict['max']
-	    if min is None and max is None:
-		return OK
-	    val = apply(dict['stringtovalue'], (text,), args)
-	    if min is not None and val &lt; min:
-		if dict['minstrict']:
-		    return ERROR
-		else:
-		    return PARTIAL
-	    if max is not None and val &gt; max:
-		if dict['maxstrict']:
-		    return ERROR
-		else:
-		    return PARTIAL
-	return OK
-
-    def _checkValidity(self):
-	valid = self._getValidity()
-	oldValidity = valid
-
-	if valid == ERROR:
-	    # The entry is invalid.
-	    cmd = self['invalidcommand']
-	    if callable(cmd):
-		cmd()
-            if self.hulldestroyed():
-                # The invalidcommand destroyed us.
-                return oldValidity
-
-	    # Restore the entry to its previous value.
-	    if self._previousText is not None:
-		self.__setEntry(self._previousText)
-		self._entryFieldEntry.icursor(self._previousICursor)
-		self._entryFieldEntry.xview(self._previousXview)
-		if self._previousSel is not None:
-		    self._entryFieldEntry.selection_range(self._previousSel[0],
-			self._previousSel[1])
-
-		# Check if the saved text is valid as well.
-		valid = self._getValidity()
-
-	self._valid = valid
-
-        if self.hulldestroyed():
-            # The validator or stringtovalue commands called by
-            # _checkValidity() destroyed us.
-            return oldValidity
-
-	if valid == OK:
-	    if self.normalBackground is not None:
-		self._entryFieldEntry.configure(
-			background = self.normalBackground)
-		self.normalBackground = None
-	else:
-	    if self.normalBackground is None:
-		self.normalBackground = self._entryFieldEntry.cget('background')
-		self._entryFieldEntry.configure(
-			background = self['errorbackground'])
-
-        return oldValidity
-
-    def invoke(self):
-	return self._executeCommand()
-
-    def valid(self):
-        return self._valid == OK
-
-    def clear(self):
-        self.setentry('')
-
-    def __setEntry(self, text):
-	oldState = str(self._entryFieldEntry.cget('state'))
-	if oldState != 'normal':
-	    self._entryFieldEntry.configure(state='normal')
-	self._entryFieldEntry.delete(0, 'end')
-	self._entryFieldEntry.insert(0, text)
-	if oldState != 'normal':
-	    self._entryFieldEntry.configure(state=oldState)
-
-    def setentry(self, text):
-	self._preProcess()
-        self.__setEntry(text)
-	return self._postProcess()
-
-    def getvalue(self):
-        return self._entryFieldEntry.get()
-
-    def setvalue(self, text):
-        return self.setentry(text)
-
-forwardmethods(EntryField, Tkinter.Entry, '_entryFieldEntry')
-
-# ======================================================================
-
-
-# Entry field validation functions
-
-_numericregex = re.compile('^[0-9]*$')
-_alphabeticregex = re.compile('^[a-z]*$', re.IGNORECASE)
-_alphanumericregex = re.compile('^[0-9a-z]*$', re.IGNORECASE)
-
-def numericvalidator(text):
-    if text == '':
-        return PARTIAL
-    else:
-	if _numericregex.match(text) is None:
-	    return ERROR
-	else:
-	    return OK
-    
-def integervalidator(text):
-    if text in ('', '-', '+'):
-        return PARTIAL
-    try:
-	string.atol(text)
-	return OK
-    except ValueError:
-	return ERROR
-    
-def alphabeticvalidator(text):
-    if _alphabeticregex.match(text) is None:
-	return ERROR
-    else:
-	return OK
-    
-def alphanumericvalidator(text):
-    if _alphanumericregex.match(text) is None:
-	return ERROR
-    else:
-	return OK
-    
-def hexadecimalvalidator(text):
-    if text in ('', '0x', '0X', '+', '+0x', '+0X', '-', '-0x', '-0X'):
-        return PARTIAL
-    try:
-	string.atol(text, 16)
-	return OK
-    except ValueError:
-	return ERROR
-    
-def realvalidator(text, separator = '.'):
-    if separator != '.':
-	if string.find(text, '.') &gt;= 0:
-	    return ERROR
-	index = string.find(text, separator)
-	if index &gt;= 0:
-	    text = text[:index] + '.' + text[index + 1:]
-    try:
-	string.atof(text)
-	return OK
-    except ValueError:
-	# Check if the string could be made valid by appending a digit
-	# eg ('-', '+', '.', '-.', '+.', '1.23e', '1E-').
-	if len(text) == 0:
-	    return PARTIAL
-	if text[-1] in string.digits:
-	    return ERROR
-	try:
-	    string.atof(text + '0')
-	    return PARTIAL
-	except ValueError:
-	    return ERROR
-    
-def timevalidator(text, separator = ':'):
-    try:
-	timestringtoseconds(text, separator)
-	return OK
-    except ValueError:
-	if len(text) &gt; 0 and text[0] in ('+', '-'):
-	    text = text[1:]
-	if re.search('[^0-9' + separator + ']', text) is not None:
-	    return ERROR
-	return PARTIAL
-
-def datevalidator(text, format = 'ymd', separator = '/'):
-    try:
-	datestringtojdn(text, format, separator)
-	return OK
-    except ValueError:
-	if re.search('[^0-9' + separator + ']', text) is not None:
-	    return ERROR
-	return PARTIAL
-
-_standardValidators = {
-    'numeric'      : (numericvalidator,      string.atol),
-    'integer'      : (integervalidator,      string.atol),
-    'hexadecimal'  : (hexadecimalvalidator,  lambda s: string.atol(s, 16)),
-    'real'         : (realvalidator,         stringtoreal),
-    'alphabetic'   : (alphabeticvalidator,   len),
-    'alphanumeric' : (alphanumericvalidator, len),
-    'time'         : (timevalidator,         timestringtoseconds),
-    'date'         : (datevalidator,         datestringtojdn),
-}
-
-_entryCache = {}
-
-def _registerEntryField(entry, entryField):
-    # Register an EntryField widget for an Entry widget
-
-    _entryCache[entry] = entryField
-
-def _deregisterEntryField(entry):
-    # Deregister an Entry widget
-    del _entryCache[entry]
-
-def _preProcess(event):
-    # Forward preprocess events for an Entry to it's EntryField
-
-    _entryCache[event.widget]._preProcess()
-
-def _postProcess(event):
-    # Forward postprocess events for an Entry to it's EntryField
-
-    # The function specified by the 'command' option may have destroyed
-    # the megawidget in a binding earlier in bindtags, so need to check.
-    if _entryCache.has_key(event.widget):
-        _entryCache[event.widget]._postProcess()
-
-######################################################################
-### File: PmwGroup.py
-import string
-import Tkinter
-
-
-def aligngrouptags(groups):
-    # Adjust the y position of the tags in /groups/ so that they all
-    # have the height of the highest tag.
-
-    maxTagHeight = 0
-    for group in groups:
-	if group._tag is None:
-	    height = (string.atoi(str(group._ring.cget('borderwidth'))) +
-		    string.atoi(str(group._ring.cget('highlightthickness'))))
-	else:
-	    height = group._tag.winfo_reqheight()
-	if maxTagHeight &lt; height:
-	    maxTagHeight = height
-
-    for group in groups:
-	ringBorder = (string.atoi(str(group._ring.cget('borderwidth'))) +
-		string.atoi(str(group._ring.cget('highlightthickness'))))
-	topBorder = maxTagHeight / 2 - ringBorder / 2
-	group._hull.grid_rowconfigure(0, minsize = topBorder)
-	group._ring.grid_rowconfigure(0,
-		minsize = maxTagHeight - topBorder - ringBorder)
-	if group._tag is not None:
-	    group._tag.place(y = maxTagHeight / 2)
-
-class Group( MegaWidget ):
-    def __init__(self, parent = None, **kw):
-
-        # Define the megawidget options.
-	
-        optiondefs = (
-	    ('collapsedsize',    6,         INITOPT),
-	    ('ring_borderwidth', 2,         None),
-	    ('ring_relief',      'groove',  None),
-	    ('tagindent',        10,        INITOPT),
-        )
-        self.defineoptions(kw, optiondefs)
-
-        # Initialise the base class (after defining the options).
-        MegaWidget.__init__(self, parent)
-
-        # Create the components.
-        interior = MegaWidget.interior(self)
-
-	self._ring = self.createcomponent(
-	    'ring', 
-	    (), None,
-	    Tkinter.Frame, (interior,), 
-	    )
-
-	self._groupChildSite = self.createcomponent(
-	    'groupchildsite',
-	    (), None,
-	    Tkinter.Frame, (self._ring,)
-	    )
-
-        self._tag = self.createcomponent(
-	    'tag',
-	    (), None,
-	    Tkinter.Label, (interior,),
-	    )
-
-	ringBorder = (string.atoi(str(self._ring.cget('borderwidth'))) +
-		string.atoi(str(self._ring.cget('highlightthickness'))))
-	if self._tag is None:
-	    tagHeight = ringBorder
-	else:
-	    tagHeight = self._tag.winfo_reqheight()
-	    self._tag.place(
-		    x = ringBorder + self['tagindent'],
-		    y = tagHeight / 2,
-		    anchor = 'w')
-
-	topBorder = tagHeight / 2 - ringBorder / 2
-	self._ring.grid(column = 0, row = 1, sticky = 'nsew')
-	interior.grid_columnconfigure(0, weight = 1)
-	interior.grid_rowconfigure(1, weight = 1)
-	interior.grid_rowconfigure(0, minsize = topBorder)
-
-	self._groupChildSite.grid(column = 0, row = 1, sticky = 'nsew')
-	self._ring.grid_columnconfigure(0, weight = 1)
-	self._ring.grid_rowconfigure(1, weight = 1)
-	self._ring.grid_rowconfigure(0,
-		minsize = tagHeight - topBorder - ringBorder)
-
-        self.showing = 1
-
-        # Check keywords and initialise options.
-        self.initialiseoptions()
-
-    def toggle(self):
-        if self.showing:
-            self.collapse()
-        else:
-            self.expand()
-        self.showing = not self.showing
-
-    def expand(self):
-        self._groupChildSite.grid(column = 0, row = 1, sticky = 'nsew')
-
-    def collapse(self):
-        self._groupChildSite.grid_forget()
-	if self._tag is None:
-	    tagHeight = 0
-	else:
-            tagHeight = self._tag.winfo_reqheight()
-        self._ring.configure(height=(tagHeight / 2) + self['collapsedsize'])
-
-    def interior(self):
-        return self._groupChildSite
-
-######################################################################
-### File: PmwLabeledWidget.py
-import Tkinter
-
-
-class LabeledWidget(MegaWidget):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('labelmargin',            0,      INITOPT),
-	    ('labelpos',               None,   INITOPT),
-	    ('sticky',                 'nsew', INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = MegaWidget.interior(self)
-	self._labelChildSite = self.createcomponent('labelchildsite',
-		(), None,
-		Tkinter.Frame, (interior,))
-	self._labelChildSite.grid(column=2, row=2, sticky=self['sticky'])
-	interior.grid_columnconfigure(2, weight=1)
-	interior.grid_rowconfigure(2, weight=1)
-
-	self.createlabel(interior)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def interior(self):
-	return self._labelChildSite
-
-######################################################################
-### File: PmwMainMenuBar.py
-# Main menubar
-
-import string
-import types
-import Tkinter
-
-
-class MainMenuBar(MegaArchetype):
-
-    def __init__(self, parent = None, **kw):
-
-        # Define the megawidget options.
-        
-        optiondefs = (
-            ('balloon',      None,       None),
-            ('hotkeys',      1,          INITOPT),
-            ('hull_tearoff', 0,          None),
-        )
-        self.defineoptions(kw, optiondefs, dynamicGroups = ('Menu',))
-
-        # Initialise the base class (after defining the options).
-        MegaArchetype.__init__(self, parent, Tkinter.Menu)
-
-        self._menuInfo = {}
-        self._menuInfo[None] = (None, [])
-        # Map from a menu name to a tuple of information about the menu.
-        # The first item in the tuple is the name of the parent menu (for
-        # toplevel menus this is None). The second item in the tuple is
-        # a list of status help messages for each item in the menu.
-        # The key for the information for the main menubar is None.
-
-        self._menu = self.interior()
-        self._menu.bind('&lt;Leave&gt;', self._resetHelpmessage)
-        self._menu.bind('&lt;Motion&gt;',
-            lambda event=None, self=self: self._menuHelp(event, None))
-
-        # Check keywords and initialise options.
-        self.initialiseoptions()
-
-    def deletemenuitems(self, menuName, start, end = None):
-        self.component(menuName).delete(start, end)
-        if end is None:
-            del self._menuInfo[menuName][1][start]
-        else:
-            self._menuInfo[menuName][1][start:end+1] = []
-
-    def deletemenu(self, menuName):
-        &quot;&quot;&quot;Delete should be called for cascaded menus before main menus.
-        &quot;&quot;&quot;
-
-        parentName = self._menuInfo[menuName][0]
-        del self._menuInfo[menuName]
-        if parentName is None:
-            parentMenu = self._menu
-        else:
-            parentMenu = self.component(parentName)
-
-        menu = self.component(menuName)
-        menuId = str(menu)
-        for item in range(parentMenu.index('end') + 1):
-            if parentMenu.type(item) == 'cascade':
-                itemMenu = str(parentMenu.entrycget(item, 'menu'))
-                if itemMenu == menuId:
-                    parentMenu.delete(item)
-                    del self._menuInfo[parentName][1][item]
-                    break
-
-        self.destroycomponent(menuName)
-
-    def disableall(self):
-        for index in range(len(self._menuInfo[None][1])):
-            self.entryconfigure(index, state = 'disabled')
-
-    def enableall(self):
-        for index in range(len(self._menuInfo[None][1])):
-            self.entryconfigure(index, state = 'normal')
-
-    def addmenu(self, menuName, balloonHelp, statusHelp = None,
-            traverseSpec = None, **kw):
-        if statusHelp is None:
-            statusHelp = balloonHelp
-        self._addmenu(None, menuName, balloonHelp, statusHelp,
-            traverseSpec, kw)
-
-    def addcascademenu(self, parentMenuName, menuName, statusHelp='',
-            traverseSpec = None, **kw):
-        self._addmenu(parentMenuName, menuName, None, statusHelp,
-            traverseSpec, kw)
-
-    def _addmenu(self, parentMenuName, menuName, balloonHelp, statusHelp,
-            traverseSpec, kw):
-
-        if (menuName) in self.components():
-            raise ValueError, 'menu &quot;%s&quot; already exists' % menuName
-
-        menukw = {}
-        if kw.has_key('tearoff'):
-            menukw['tearoff'] = kw['tearoff']
-            del kw['tearoff']
-        else:
-            menukw['tearoff'] = 0
-        if kw.has_key('name'):
-            menukw['name'] = kw['name']
-            del kw['name']
-
-        if not kw.has_key('label'):
-            kw['label'] = menuName
-
-        self._addHotkeyToOptions(parentMenuName, kw, traverseSpec)
-
-        if parentMenuName is None:
-            parentMenu = self._menu
-            balloon = self['balloon']
-            # Bug in Tk: balloon help not implemented
-            # if balloon is not None:
-            #     balloon.mainmenubind(parentMenu, balloonHelp, statusHelp)
-        else:
-            parentMenu = self.component(parentMenuName)
-
-        apply(parentMenu.add_cascade, (), kw)
-
-        menu = apply(self.createcomponent, (menuName,
-                (), 'Menu',
-                Tkinter.Menu, (parentMenu,)), menukw)
-        parentMenu.entryconfigure('end', menu = menu)
-
-        self._menuInfo[parentMenuName][1].append(statusHelp)
-        self._menuInfo[menuName] = (parentMenuName, [])
-
-        menu.bind('&lt;Leave&gt;', self._resetHelpmessage)
-        menu.bind('&lt;Motion&gt;', 
-            lambda event=None, self=self, menuName=menuName:
-                    self._menuHelp(event, menuName))
-
-    def addmenuitem(self, menuName, itemType, statusHelp = '',
-            traverseSpec = None, **kw):
-
-        menu = self.component(menuName)
-        if itemType != 'separator':
-            self._addHotkeyToOptions(menuName, kw, traverseSpec)
-
-        if itemType == 'command':
-            command = menu.add_command
-        elif itemType == 'separator':
-            command = menu.add_separator
-        elif itemType == 'checkbutton':
-            command = menu.add_checkbutton
-        elif itemType == 'radiobutton':
-            command = menu.add_radiobutton
-        elif itemType == 'cascade':
-            command = menu.add_cascade
-        else:
-            raise ValueError, 'unknown menuitem type &quot;%s&quot;' % itemType
-
-        self._menuInfo[menuName][1].append(statusHelp)
-        apply(command, (), kw)
-
-    def _addHotkeyToOptions(self, menuName, kw, traverseSpec):
-
-        if (not self['hotkeys'] or kw.has_key('underline') or
-                not kw.has_key('label')):
-            return
-
-        if type(traverseSpec) == types.IntType:
-            kw['underline'] = traverseSpec
-            return
-
-        if menuName is None:
-            menu = self._menu
-        else:
-            menu = self.component(menuName)
-        hotkeyList = []
-        end = menu.index('end')
-        if end is not None:
-            for item in range(end + 1):
-                if menu.type(item) not in ('separator', 'tearoff'):
-                    underline = \
-                            string.atoi(str(menu.entrycget(item, 'underline')))
-                    if underline != -1:
-                        label = str(menu.entrycget(item, 'label'))
-                        if underline &lt; len(label):
-                            hotkey = string.lower(label[underline])
-                            if hotkey not in hotkeyList:
-                                hotkeyList.append(hotkey)
-
-        name = kw['label']
-
-        if type(traverseSpec) == types.StringType:
-            lowerLetter = string.lower(traverseSpec)
-            if traverseSpec in name and lowerLetter not in hotkeyList:
-                kw['underline'] = string.index(name, traverseSpec)
-        else:
-            targets = string.digits + string.letters
-            lowerName = string.lower(name)
-            for letter_index in range(len(name)):
-                letter = lowerName[letter_index]
-                if letter in targets and letter not in hotkeyList:
-                    kw['underline'] = letter_index
-                    break
-
-    def _menuHelp(self, event, menuName):
-        if menuName is None:
-            menu = self._menu
-            index = menu.index('@%d'% event.x)
-        else:
-            menu = self.component(menuName)
-            index = menu.index('@%d'% event.y)
-
-        balloon = self['balloon']
-        if balloon is not None:
-            if index is None:
-                balloon.showstatus('')
-            else:
-                if str(menu.cget('tearoff')) == '1':
-                    index = index - 1
-                if index &gt;= 0:
-                    help = self._menuInfo[menuName][1][index]
-                    balloon.showstatus(help)
-
-    def _resetHelpmessage(self, event=None):
-        balloon = self['balloon']
-        if balloon is not None:
-            balloon.clearstatus()
-
-forwardmethods(MainMenuBar, Tkinter.Menu, '_hull')
-
-######################################################################
-### File: PmwMenuBar.py
-# Manager widget for menus.
-
-import string
-import types
-import Tkinter
-
-
-class MenuBar(MegaWidget):
-
-    def __init__(self, parent = None, **kw):
-
-        # Define the megawidget options.
-        
-        optiondefs = (
-            ('balloon',      None,       None),
-            ('hotkeys',      1,          INITOPT),
-            ('padx',         0,          INITOPT),
-        )
-        self.defineoptions(kw, optiondefs, dynamicGroups = ('Menu', 'Button'))
-
-        # Initialise the base class (after defining the options).
-        MegaWidget.__init__(self, parent)
-
-        self._menuInfo = {}
-        # Map from a menu name to a tuple of information about the menu.
-        # The first item in the tuple is the name of the parent menu (for
-        # toplevel menus this is None). The second item in the tuple is
-        # a list of status help messages for each item in the menu.
-        # The third item in the tuple is the id of the binding used
-        # to detect mouse motion to display status help.
-        # Information for the toplevel menubuttons is not stored here.
-
-        self._mydeletecommand = self.component('hull').tk.deletecommand
-        # Cache this method for use later.
-
-        # Check keywords and initialise options.
-        self.initialiseoptions()
-
-    def deletemenuitems(self, menuName, start, end = None):
-        self.component(menuName + '-menu').delete(start, end)
-        if end is None:
-            del self._menuInfo[menuName][1][start]
-        else:
-            self._menuInfo[menuName][1][start:end+1] = []
-
-    def deletemenu(self, menuName):
-        &quot;&quot;&quot;Delete should be called for cascaded menus before main menus.
-        &quot;&quot;&quot;
-
-        # Clean up binding for this menu.
-        parentName = self._menuInfo[menuName][0]
-        bindId = self._menuInfo[menuName][2]
-        _bindtag = 'PmwMenuBar' + str(self) + menuName
-        self.unbind_class(_bindtag, '&lt;Motion&gt;')
-        self._mydeletecommand(bindId) # unbind_class does not clean up
-        del self._menuInfo[menuName]
-
-        if parentName is None:
-            self.destroycomponent(menuName + '-button')
-        else:
-            parentMenu = self.component(parentName + '-menu')
-
-            menu = self.component(menuName + '-menu')
-            menuId = str(menu)
-            for item in range(parentMenu.index('end') + 1):
-                if parentMenu.type(item) == 'cascade':
-                    itemMenu = str(parentMenu.entrycget(item, 'menu'))
-                    if itemMenu == menuId:
-                        parentMenu.delete(item)
-                        del self._menuInfo[parentName][1][item]
-                        break
-
-        self.destroycomponent(menuName + '-menu')
-
-    def disableall(self):
-        for menuName in self._menuInfo.keys():
-            if self._menuInfo[menuName][0] is None:
-                menubutton = self.component(menuName + '-button')
-                menubutton.configure(state = 'disabled')
-
-    def enableall(self):
-        for menuName in self._menuInfo.keys():
-            if self._menuInfo[menuName][0] is None:
-                menubutton = self.component(menuName + '-button')
-                menubutton.configure(state = 'normal')
-
-    def addmenu(self, menuName, balloonHelp, statusHelp = None,
-            side = 'left', traverseSpec = None, **kw):
-
-        self._addmenu(None, menuName, balloonHelp, statusHelp,
-            traverseSpec, side, 'text', kw)
-
-    def addcascademenu(self, parentMenuName, menuName, statusHelp = '',
-            traverseSpec = None, **kw):
-
-        self._addmenu(parentMenuName, menuName, None, statusHelp,
-            traverseSpec, None, 'label', kw)
-
-    def _addmenu(self, parentMenuName, menuName, balloonHelp, statusHelp,
-            traverseSpec, side, textKey, kw):
-
-        if (menuName + '-menu') in self.components():
-            raise ValueError, 'menu &quot;%s&quot; already exists' % menuName
-
-        menukw = {}
-        if kw.has_key('tearoff'):
-            menukw['tearoff'] = kw['tearoff']
-            del kw['tearoff']
-        else:
-            menukw['tearoff'] = 0
-
-        if not kw.has_key(textKey):
-            kw[textKey] = menuName
-
-        self._addHotkeyToOptions(parentMenuName, kw, textKey, traverseSpec)
-
-        if parentMenuName is None:
-            button = apply(self.createcomponent, (menuName + '-button',
-                    (), 'Button',
-                    Tkinter.Menubutton, (self.interior(),)), kw)
-            button.pack(side=side, padx = self['padx'])
-            balloon = self['balloon']
-            if balloon is not None:
-                balloon.bind(button, balloonHelp, statusHelp)
-            parentMenu = button
-        else:
-            parentMenu = self.component(parentMenuName + '-menu')
-            apply(parentMenu.add_cascade, (), kw)
-            self._menuInfo[parentMenuName][1].append(statusHelp)
-
-        menu = apply(self.createcomponent, (menuName + '-menu',
-                (), 'Menu',
-                Tkinter.Menu, (parentMenu,)), menukw)
-        if parentMenuName is None:
-            button.configure(menu = menu)
-        else:
-            parentMenu.entryconfigure('end', menu = menu)
-
-        # Need to put this binding after the class bindings so that
-        # menu.index() does not lag behind.
-        _bindtag = 'PmwMenuBar' + str(self) + menuName
-        bindId = self.bind_class(_bindtag, '&lt;Motion&gt;',
-            lambda event=None, self=self, menuName=menuName:
-                    self._menuHelp(menuName))
-        menu.bindtags(menu.bindtags() + (_bindtag,))
-        menu.bind('&lt;Leave&gt;', self._resetHelpmessage)
-
-        self._menuInfo[menuName] = (parentMenuName, [], bindId)
-
-    def addmenuitem(self, menuName, itemType, statusHelp = '',
-            traverseSpec = None, **kw):
-
-        menu = self.component(menuName + '-menu')
-        if itemType != 'separator':
-            self._addHotkeyToOptions(menuName, kw, 'label', traverseSpec)
-
-        if itemType == 'command':
-            command = menu.add_command
-        elif itemType == 'separator':
-            command = menu.add_separator
-        elif itemType == 'checkbutton':
-            command = menu.add_checkbutton
-        elif itemType == 'radiobutton':
-            command = menu.add_radiobutton
-        elif itemType == 'cascade':
-            command = menu.add_cascade
-        else:
-            raise ValueError, 'unknown menuitem type &quot;%s&quot;' % itemType
-
-        self._menuInfo[menuName][1].append(statusHelp)
-        apply(command, (), kw)
-
-    def _addHotkeyToOptions(self, menuName, kw, textKey, traverseSpec):
-
-        if (not self['hotkeys'] or kw.has_key('underline') or
-                not kw.has_key(textKey)):
-            return
-
-        if type(traverseSpec) == types.IntType:
-            kw['underline'] = traverseSpec
-            return
-
-        hotkeyList = []
-        if menuName is None:
-            for menuName in self._menuInfo.keys():
-                if self._menuInfo[menuName][0] is None:
-                    menubutton = self.component(menuName + '-button')
-                    underline = string.atoi(str(menubutton.cget('underline')))
-                    if underline != -1:
-                        label = str(menubutton.cget(textKey))
-                        if underline &lt; len(label):
-                            hotkey = string.lower(label[underline])
-                            if hotkey not in hotkeyList:
-                                hotkeyList.append(hotkey)
-        else:
-            menu = self.component(menuName + '-menu')
-            end = menu.index('end')
-            if end is not None:
-                for item in range(end + 1):
-                    if menu.type(item) not in ('separator', 'tearoff'):
-                        underline = string.atoi(
-                            str(menu.entrycget(item, 'underline')))
-                        if underline != -1:
-                            label = str(menu.entrycget(item, textKey))
-                            if underline &lt; len(label):
-                                hotkey = string.lower(label[underline])
-                                if hotkey not in hotkeyList:
-                                    hotkeyList.append(hotkey)
-
-        name = kw[textKey]
-
-        if type(traverseSpec) == types.StringType:
-            lowerLetter = string.lower(traverseSpec)
-            if traverseSpec in name and lowerLetter not in hotkeyList:
-                kw['underline'] = string.index(name, traverseSpec)
-        else:
-            targets = string.digits + string.letters
-            lowerName = string.lower(name)
-            for letter_index in range(len(name)):
-                letter = lowerName[letter_index]
-                if letter in targets and letter not in hotkeyList:
-                    kw['underline'] = letter_index
-                    break
-
-    def _menuHelp(self, menuName):
-        menu = self.component(menuName + '-menu')
-        index = menu.index('active')
-
-        balloon = self['balloon']
-        if balloon is not None:
-            if index is None:
-                balloon.showstatus('')
-            else:
-                if str(menu.cget('tearoff')) == '1':
-                    index = index - 1
-                if index &gt;= 0:
-                    help = self._menuInfo[menuName][1][index]
-                    balloon.showstatus(help)
-
-    def _resetHelpmessage(self, event=None):
-        balloon = self['balloon']
-        if balloon is not None:
-            balloon.clearstatus()
-
-######################################################################
-### File: PmwMessageBar.py
-# Class to display messages in an information line.
-
-import string
-import Tkinter
-
-
-class MessageBar(MegaWidget):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	defaultMessageTypes = {
-			   # (priority, showtime, bells, logmessage)
-	    'systemerror'  : (5, 10, 2, 1),
-	    'usererror'    : (4, 5, 1, 0),
-	    'busy'         : (3, 0, 0, 0),
-	    'systemevent'  : (2, 5, 0, 0),
-	    'userevent'    : (2, 5, 0, 0),
-	    'help'         : (1, 5, 0, 0),
-	    'state'        : (0, 0, 0, 0),
-	}
-	optiondefs = (
-	    ('labelmargin',    0,                     INITOPT),
-	    ('labelpos',       None,                  INITOPT),
-	    ('messagetypes',   defaultMessageTypes,   INITOPT),
-	    ('silent',         0,                     None),
-	    ('sticky',         'ew',                  INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-	self._messageBarEntry = self.createcomponent('entry',
-		(), None,
-		Tkinter.Entry, (interior,))
-
-        # Can't always use 'disabled', since this greys out text in Tk 8.4.2
-        try:
-            self._messageBarEntry.configure(state = 'readonly')
-        except Tkinter.TclError:
-            self._messageBarEntry.configure(state = 'disabled')
-
-	self._messageBarEntry.grid(column=2, row=2, sticky=self['sticky'])
-	interior.grid_columnconfigure(2, weight=1)
-	interior.grid_rowconfigure(2, weight=1)
-
-	self.createlabel(interior)
-
-	# Initialise instance variables.
-	self._numPriorities = 0
-	for info in self['messagetypes'].values():
-	    if self._numPriorities &lt; info[0]:
-		self._numPriorities = info[0]
-
-	self._numPriorities = self._numPriorities + 1
-	self._timer = [None] * self._numPriorities
-	self._messagetext = [''] * self._numPriorities
-	self._activemessage = [0] * self._numPriorities
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	for timerId in self._timer:
-	    if timerId is not None:
-		self.after_cancel(timerId)
-	self._timer = [None] * self._numPriorities
-	MegaWidget.destroy(self)
-
-    def message(self, type, text):
-        # Display a message in the message bar.
-
-	(priority, showtime, bells, logmessage) = self['messagetypes'][type]
-
-	if not self['silent']:
-	    for i in range(bells):
-		if i != 0:
-		    self.after(100)
-		self.bell()
-
-	self._activemessage[priority] = 1
-	if text is None:
-	    text = ''
-	self._messagetext[priority] = string.replace(text, '\n', ' ')
-	self._redisplayInfoMessage()
-
-	if logmessage:
-	    # Should log this text to a text widget.
-	    pass
-
-	if showtime &gt; 0:
-	    if self._timer[priority] is not None:
-		self.after_cancel(self._timer[priority])
-
-	    # Define a callback to clear this message after a time.
-	    def _clearmessage(self=self, priority=priority):
-		self._clearActivemessage(priority)
-
-	    mseconds = int(showtime * 1000)
-	    self._timer[priority] = self.after(mseconds, _clearmessage)
-
-    def helpmessage(self, text):
-        if text is None:
-            self.resetmessages('help')
-        else:
-            self.message('help', text)
-
-    def resetmessages(self, type):
-	priority = self['messagetypes'][type][0]
-	self._clearActivemessage(priority)
-	for messagetype, info in self['messagetypes'].items():
-	    thisPriority = info[0]
-	    showtime = info[1]
-	    if thisPriority &lt; priority and showtime != 0:
-		self._clearActivemessage(thisPriority)
-
-    def _clearActivemessage(self, priority):
-	self._activemessage[priority] = 0
-	if self._timer[priority] is not None:
-	    self.after_cancel(self._timer[priority])
-	    self._timer[priority] = None
-	self._redisplayInfoMessage()
-
-    def _redisplayInfoMessage(self):
-	text = ''
-        for priority in range(self._numPriorities - 1, -1, -1):
-	    if self._activemessage[priority]:
-		text = self._messagetext[priority]
-	        break
-	self._messageBarEntry.configure(state = 'normal')
-	self._messageBarEntry.delete(0, 'end')
-	self._messageBarEntry.insert('end', text)
-
-        # Can't always use 'disabled', since this greys out text in Tk 8.4.2
-        try:
-            self._messageBarEntry.configure(state = 'readonly')
-        except Tkinter.TclError:
-            self._messageBarEntry.configure(state = 'disabled')
-
-forwardmethods(MessageBar, Tkinter.Entry, '_messageBarEntry')
-
-######################################################################
-### File: PmwMessageDialog.py
-# Based on iwidgets2.2.0/messagedialog.itk code.
-
-import Tkinter
-
-
-class MessageDialog(Dialog):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderx',       20,    INITOPT),
-	    ('bordery',       20,    INITOPT),
-	    ('iconmargin',    20,    INITOPT),
-	    ('iconpos',       None,  INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	Dialog.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-
-	self._message = self.createcomponent('message',
-		(), None,
-		Tkinter.Label, (interior,))
-
-        iconpos = self['iconpos']
-	iconmargin = self['iconmargin']
-	borderx = self['borderx']
-	bordery = self['bordery']
-	border_right = 2
-	border_bottom = 2
-	if iconpos is None:
-	    self._message.grid(column = 1, row = 1)
-	else:
-	    self._icon = self.createcomponent('icon',
-		    (), None,
-		    Tkinter.Label, (interior,))
-	    if iconpos not in 'nsew':
-		raise ValueError, \
-		    'bad iconpos option &quot;%s&quot;:  should be n, s, e, or w' \
-			% iconpos
-
-	    if iconpos in 'nw':
-		icon = 1
-		message = 3
-	    else:
-		icon = 3
-		message = 1
-
-	    if iconpos in 'ns':
-		# vertical layout
-		self._icon.grid(column = 1, row = icon)
-		self._message.grid(column = 1, row = message)
-		interior.grid_rowconfigure(2, minsize = iconmargin)
-		border_bottom = 4
-	    else:
-		# horizontal layout
-		self._icon.grid(column = icon, row = 1)
-		self._message.grid(column = message, row = 1)
-		interior.grid_columnconfigure(2, minsize = iconmargin)
-		border_right = 4
-
-	interior.grid_columnconfigure(0, minsize = borderx)
-	interior.grid_rowconfigure(0, minsize = bordery)
-	interior.grid_columnconfigure(border_right, minsize = borderx)
-	interior.grid_rowconfigure(border_bottom, minsize = bordery)
-
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-######################################################################
-### File: PmwNoteBook.py
-import string
-import types
-import Tkinter
-
-
-class NoteBook(MegaArchetype):
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-        optiondefs = (
-	    ('hull_highlightthickness',  0,           None),
-	    ('hull_borderwidth',         0,           None),
-            ('arrownavigation',          1,           INITOPT),
-            ('borderwidth',              2,           INITOPT),
-            ('createcommand',            None,        None),
-            ('lowercommand',             None,        None),
-            ('pagemargin',               4,           INITOPT),
-            ('raisecommand',             None,        None),
-	    ('tabpos',                   'n',         INITOPT),
-        )
-	self.defineoptions(kw, optiondefs, dynamicGroups = ('Page', 'Tab'))
-
-	# Initialise the base class (after defining the options).
-	MegaArchetype.__init__(self, parent, Tkinter.Canvas)
-
-        self.bind('&lt;Map&gt;', self._handleMap)
-        self.bind('&lt;Configure&gt;', self._handleConfigure)
-
-        tabpos = self['tabpos']
-	if tabpos is not None and tabpos != 'n':
-            raise ValueError, \
-                'bad tabpos option %s:  should be n or None' % repr(tabpos)
-        self._withTabs = (tabpos is not None)
-        self._pageMargin = self['pagemargin']
-        self._borderWidth = self['borderwidth']
-
-        # Use a dictionary as a set of bits indicating what needs to
-        # be redisplayed the next time _layout() is called.  If
-        # dictionary contains 'topPage' key, the value is the new top
-        # page to be displayed.  None indicates that all pages have
-        # been deleted and that _layout() should draw a border under where
-        # the tabs should be.
-        self._pending = {}
-        self._pending['size'] = 1
-        self._pending['borderColor'] = 1
-        self._pending['topPage'] = None
-        if self._withTabs:
-            self._pending['tabs'] = 1
-
-        self._canvasSize = None       # This gets set by &lt;Configure&gt; events
-
-        # Set initial height of space for tabs
-        if self._withTabs:
-            self.tabBottom = 35
-        else:
-            self.tabBottom = 0
-
-        self._lightBorderColor, self._darkBorderColor = \
-                Color.bordercolors(self, self['hull_background'])
-
-	self._pageNames   = []        # List of page names
-
-        # Map from page name to page info.  Each item is itself a
-        # dictionary containing the following items:
-        #   page           the Tkinter.Frame widget for the page
-        #   created        set to true the first time the page is raised
-        #   tabbutton      the Tkinter.Button widget for the button (if any)
-        #   tabreqwidth    requested width of the tab
-        #   tabreqheight   requested height of the tab
-        #   tabitems       the canvas items for the button: the button
-        #                  window item, the lightshadow and the darkshadow
-        #   left           the left and right canvas coordinates of the tab
-        #   right
-	self._pageAttrs   = {}
-
-        # Name of page currently on top (actually displayed, using
-        # create_window, not pending).  Ignored if current top page
-        # has been deleted or new top page is pending.  None indicates
-        # no pages in notebook.
-	self._topPageName = None
-
-        # Canvas items used:
-        #   Per tab: 
-        #       top and left shadow
-        #       right shadow
-        #       button
-        #   Per notebook: 
-        #       page
-        #       top page
-        #       left shadow
-        #       bottom and right shadow
-        #       top (one or two items)
-
-        # Canvas tags used:
-        #   lighttag      - top and left shadows of tabs and page
-        #   darktag       - bottom and right shadows of tabs and page
-        #                   (if no tabs then these are reversed)
-        #                   (used to color the borders by recolorborders)
-
-        # Create page border shadows.
-        if self._withTabs:
-            self._pageLeftBorder = self.create_polygon(0, 0, 0, 0, 0, 0,
-                fill = self._lightBorderColor, tags = 'lighttag')
-            self._pageBottomRightBorder = self.create_polygon(0, 0, 0, 0, 0, 0,
-                fill = self._darkBorderColor, tags = 'darktag')
-            self._pageTop1Border = self.create_polygon(0, 0, 0, 0, 0, 0,
-                fill = self._darkBorderColor, tags = 'lighttag')
-            self._pageTop2Border = self.create_polygon(0, 0, 0, 0, 0, 0,
-                fill = self._darkBorderColor, tags = 'lighttag')
-        else:
-            self._pageLeftBorder = self.create_polygon(0, 0, 0, 0, 0, 0,
-                fill = self._darkBorderColor, tags = 'darktag')
-            self._pageBottomRightBorder = self.create_polygon(0, 0, 0, 0, 0, 0,
-                fill = self._lightBorderColor, tags = 'lighttag')
-            self._pageTopBorder = self.create_polygon(0, 0, 0, 0, 0, 0,
-                fill = self._darkBorderColor, tags = 'darktag')
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def insert(self, pageName, before = 0, **kw):
-	if self._pageAttrs.has_key(pageName):
-	    msg = 'Page &quot;%s&quot; already exists.' % pageName
-	    raise ValueError, msg
-
-        # Do this early to catch bad &lt;before&gt; spec before creating any items.
-	beforeIndex = self.index(before, 1)
-
-        pageOptions = {}
-        if self._withTabs:
-            # Default tab button options.
-            tabOptions = {
-                'text' : pageName,
-                'borderwidth' : 0,
-            }
-
-        # Divide the keyword options into the 'page_' and 'tab_' options.
-        for key in kw.keys():
-            if key[:5] == 'page_':
-                pageOptions[key[5:]] = kw[key]
-                del kw[key]
-            elif self._withTabs and key[:4] == 'tab_':
-                tabOptions[key[4:]] = kw[key]
-                del kw[key]
-            else:
-		raise KeyError, 'Unknown option &quot;' + key + '&quot;'
-
-        # Create the frame to contain the page.
-	page = apply(self.createcomponent, (pageName,
-		(), 'Page',
-		Tkinter.Frame, self._hull), pageOptions)
-
-        attributes = {}
-        attributes['page'] = page
-        attributes['created'] = 0
-
-        if self._withTabs:
-            # Create the button for the tab.
-            def raiseThisPage(self = self, pageName = pageName):
-                self.selectpage(pageName)
-            tabOptions['command'] = raiseThisPage
-            tab = apply(self.createcomponent, (pageName + '-tab',
-                    (), 'Tab',
-                    Tkinter.Button, self._hull), tabOptions)
-
-            if self['arrownavigation']:
-                # Allow the use of the arrow keys for Tab navigation:
-                def next(event, self = self, pageName = pageName):
-                    self.nextpage(pageName)
-                def prev(event, self = self, pageName = pageName):
-                    self.previouspage(pageName)
-                tab.bind('&lt;Left&gt;', prev)
-                tab.bind('&lt;Right&gt;', next)
-
-            attributes['tabbutton'] = tab
-            attributes['tabreqwidth'] = tab.winfo_reqwidth()
-            attributes['tabreqheight'] = tab.winfo_reqheight()
-
-            # Create the canvas item to manage the tab's button and the items
-            # for the tab's shadow.
-            windowitem = self.create_window(0, 0, window = tab, anchor = 'nw')
-            lightshadow = self.create_polygon(0, 0, 0, 0, 0, 0,
-                tags = 'lighttag', fill = self._lightBorderColor)
-            darkshadow = self.create_polygon(0, 0, 0, 0, 0, 0,
-                tags = 'darktag', fill = self._darkBorderColor)
-            attributes['tabitems'] = (windowitem, lightshadow, darkshadow)
-            self._pending['tabs'] = 1
-
-        self._pageAttrs[pageName] = attributes
-	self._pageNames.insert(beforeIndex, pageName)
-
-        # If this is the first page added, make it the new top page
-        # and call the create and raise callbacks.
-        if self.getcurselection() is None:
-            self._pending['topPage'] = pageName
-            self._raiseNewTop(pageName)
-
-        self._layout()
-        return page
-  		
-    def add(self, pageName, **kw):
-        return apply(self.insert, (pageName, len(self._pageNames)), kw)
-
-    def delete(self, *pageNames):
-        newTopPage = 0
-        for page in pageNames:
-            pageIndex = self.index(page)
-            pageName = self._pageNames[pageIndex]
-            pageInfo = self._pageAttrs[pageName]
-
-            if self.getcurselection() == pageName:
-                if len(self._pageNames) == 1:
-                    newTopPage = 0
-                    self._pending['topPage'] = None
-                elif pageIndex == len(self._pageNames) - 1:
-                    newTopPage = 1
-                    self._pending['topPage'] = self._pageNames[pageIndex - 1]
-                else:
-                    newTopPage = 1
-                    self._pending['topPage'] = self._pageNames[pageIndex + 1]
-
-            if self._topPageName == pageName:
-                self._hull.delete(self._topPageItem)
-                self._topPageName = None
-                                
-            if self._withTabs:
-                self.destroycomponent(pageName + '-tab')
-                apply(self._hull.delete, pageInfo['tabitems'])
-            self.destroycomponent(pageName)
-            del self._pageAttrs[pageName]
-            del self._pageNames[pageIndex]
-
-        # If the old top page was deleted and there are still pages
-        # left in the notebook, call the create and raise callbacks.
-        if newTopPage:
-            pageName = self._pending['topPage']
-            self._raiseNewTop(pageName)
-
-        if self._withTabs:
-            self._pending['tabs'] = 1
-        self._layout()
-
-    def page(self, pageIndex):
-        pageName = self._pageNames[self.index(pageIndex)]
-	return self._pageAttrs[pageName]['page']
-
-    def pagenames(self):
-	return list(self._pageNames)
-
-    def getcurselection(self):
-        if self._pending.has_key('topPage'):
-            return self._pending['topPage']
-        else:
-            return self._topPageName
-
-    def tab(self, pageIndex):
-        if self._withTabs:
-            pageName = self._pageNames[self.index(pageIndex)]
-            return self._pageAttrs[pageName]['tabbutton']
-        else:
-            return None
-
-    def index(self, index, forInsert = 0):
-	listLength = len(self._pageNames)
-	if type(index) == types.IntType:
-	    if forInsert and index &lt;= listLength:
-		return index
-	    elif not forInsert and index &lt; listLength:
-		return index
-	    else:
-		raise ValueError, 'index &quot;%s&quot; is out of range' % index
-	elif index is END:
-	    if forInsert:
-		return listLength
-	    elif listLength &gt; 0:
-		return listLength - 1
-	    else:
-		raise ValueError, 'NoteBook has no pages'
-	elif index is SELECT:
-	    if listLength == 0:
-		raise ValueError, 'NoteBook has no pages'
-            return self._pageNames.index(self.getcurselection())
-	else:
-            if index in self._pageNames:
-                return self._pageNames.index(index)
-	    validValues = 'a name, a number, END or SELECT'
-	    raise ValueError, \
-                'bad index &quot;%s&quot;: must be %s' % (index, validValues)
-
-    def selectpage(self, page):
-        pageName = self._pageNames[self.index(page)]
-        oldTopPage = self.getcurselection()
-        if pageName != oldTopPage:
-            self._pending['topPage'] = pageName
-            if oldTopPage == self._topPageName:
-                self._hull.delete(self._topPageItem)
-            cmd = self['lowercommand']
-            if cmd is not None:
-                cmd(oldTopPage)
-            self._raiseNewTop(pageName)
-
-            self._layout()
-
-        # Set focus to the tab of new top page:
-        if self._withTabs and self['arrownavigation']:
-            self._pageAttrs[pageName]['tabbutton'].focus_set()
-
-    def previouspage(self, pageIndex = None):
-        if pageIndex is None:
-            curpage = self.index(SELECT)
-        else:
-            curpage = self.index(pageIndex)
-	if curpage &gt; 0:
-	    self.selectpage(curpage - 1)
-
-    def nextpage(self, pageIndex = None):
-        if pageIndex is None:
-            curpage = self.index(SELECT)
-        else:
-            curpage = self.index(pageIndex)
-	if curpage &lt; len(self._pageNames) - 1:
-	    self.selectpage(curpage + 1)
-
-    def setnaturalsize(self, pageNames = None):
-        self.update_idletasks()
-        maxPageWidth = 1
-        maxPageHeight = 1
-        if pageNames is None:
-            pageNames = self.pagenames()
-        for pageName in pageNames:
-            pageInfo = self._pageAttrs[pageName]
-            page = pageInfo['page']
-            w = page.winfo_reqwidth()
-            h = page.winfo_reqheight()
-            if maxPageWidth &lt; w:
-                maxPageWidth = w
-            if maxPageHeight &lt; h:
-                maxPageHeight = h
-        pageBorder = self._borderWidth + self._pageMargin
-        width = maxPageWidth + pageBorder * 2
-        height = maxPageHeight + pageBorder * 2
-
-        if self._withTabs:
-            maxTabHeight = 0
-            for pageInfo in self._pageAttrs.values():
-                if maxTabHeight &lt; pageInfo['tabreqheight']:
-                    maxTabHeight = pageInfo['tabreqheight']
-            height = height + maxTabHeight + self._borderWidth * 1.5
-
-        # Note that, since the hull is a canvas, the width and height
-        # options specify the geometry *inside* the borderwidth and
-        # highlightthickness.
-        self.configure(hull_width = width, hull_height = height)
-
-    def recolorborders(self):
-        self._pending['borderColor'] = 1
-        self._layout()
-
-    def _handleMap(self, event):
-        self._layout()
-
-    def _handleConfigure(self, event):
-        self._canvasSize = (event.width, event.height)
-        self._pending['size'] = 1
-        self._layout()
-
-    def _raiseNewTop(self, pageName):
-        if not self._pageAttrs[pageName]['created']:
-            self._pageAttrs[pageName]['created'] = 1
-            cmd = self['createcommand']
-            if cmd is not None:
-                cmd(pageName)
-        cmd = self['raisecommand']
-        if cmd is not None:
-            cmd(pageName)
-
-    # This is the vertical layout of the notebook, from top (assuming
-    # tabpos is 'n'):
-    #     hull highlightthickness (top)
-    #     hull borderwidth (top)
-    #     borderwidth (top border of tabs)
-    #     borderwidth * 0.5 (space for bevel)
-    #     tab button (maximum of requested height of all tab buttons)
-    #     borderwidth (border between tabs and page)
-    #     pagemargin (top)
-    #     the page itself
-    #     pagemargin (bottom)
-    #     borderwidth (border below page)
-    #     hull borderwidth (bottom)
-    #     hull highlightthickness (bottom)
-    #
-    # canvasBorder is sum of top two elements.
-    # tabBottom is sum of top five elements.
-    #
-    # Horizontal layout (and also vertical layout when tabpos is None):
-    #     hull highlightthickness
-    #     hull borderwidth
-    #     borderwidth
-    #     pagemargin
-    #     the page itself
-    #     pagemargin
-    #     borderwidth
-    #     hull borderwidth
-    #     hull highlightthickness
-    #
-    def _layout(self):
-        if not self.winfo_ismapped() or self._canvasSize is None:
-            # Don't layout if the window is not displayed, or we
-            # haven't yet received a &lt;Configure&gt; event.
-            return
-
-        hullWidth, hullHeight = self._canvasSize
-        borderWidth = self._borderWidth
-        canvasBorder = string.atoi(self._hull['borderwidth']) + \
-            string.atoi(self._hull['highlightthickness'])
-        if not self._withTabs:
-            self.tabBottom = canvasBorder
-        oldTabBottom = self.tabBottom
-
-        if self._pending.has_key('borderColor'):
-            self._lightBorderColor, self._darkBorderColor = \
-                    Color.bordercolors(self, self['hull_background'])
-
-        # Draw all the tabs.
-        if self._withTabs and (self._pending.has_key('tabs') or
-                self._pending.has_key('size')):
-            # Find total requested width and maximum requested height
-            # of tabs.
-            sumTabReqWidth = 0
-            maxTabHeight = 0
-            for pageInfo in self._pageAttrs.values():
-                sumTabReqWidth = sumTabReqWidth + pageInfo['tabreqwidth']
-                if maxTabHeight &lt; pageInfo['tabreqheight']:
-                    maxTabHeight = pageInfo['tabreqheight']
-            if maxTabHeight != 0:
-                # Add the top tab border plus a bit for the angled corners
-                self.tabBottom = canvasBorder + maxTabHeight + borderWidth * 1.5
-
-            # Prepare for drawing the border around each tab button.
-            tabTop = canvasBorder
-            tabTop2 = tabTop + borderWidth
-            tabTop3 = tabTop + borderWidth * 1.5
-            tabBottom2 = self.tabBottom
-            tabBottom = self.tabBottom + borderWidth
-
-            numTabs = len(self._pageNames)
-            availableWidth = hullWidth - 2 * canvasBorder - \
-                numTabs * 2 * borderWidth
-            x = canvasBorder
-            cumTabReqWidth = 0
-            cumTabWidth = 0
-
-            # Position all the tabs.
-            for pageName in self._pageNames:
-                pageInfo = self._pageAttrs[pageName]
-                (windowitem, lightshadow, darkshadow) = pageInfo['tabitems']
-                if sumTabReqWidth &lt;= availableWidth:
-                    tabwidth = pageInfo['tabreqwidth']
-                else:
-                    # This ugly calculation ensures that, when the
-                    # notebook is not wide enough for the requested
-                    # widths of the tabs, the total width given to
-                    # the tabs exactly equals the available width,
-                    # without rounding errors.
-                    cumTabReqWidth = cumTabReqWidth + pageInfo['tabreqwidth']
-                    tmp = (2*cumTabReqWidth*availableWidth + sumTabReqWidth) \
-                            / (2 * sumTabReqWidth)
-                    tabwidth = tmp - cumTabWidth
-                    cumTabWidth = tmp
-
-                # Position the tab's button canvas item.
-                self.coords(windowitem, x + borderWidth, tabTop3)
-                self.itemconfigure(windowitem,
-                    width = tabwidth, height = maxTabHeight)
-
-                # Make a beautiful border around the tab.
-                left = x
-                left2 = left + borderWidth
-                left3 = left + borderWidth * 1.5
-                right = left + tabwidth + 2 * borderWidth
-                right2 = left + tabwidth + borderWidth
-                right3 = left + tabwidth + borderWidth * 0.5
-
-                self.coords(lightshadow, 
-                    left, tabBottom2, left, tabTop2, left2, tabTop,
-                    right2, tabTop, right3, tabTop2, left3, tabTop2,
-                    left2, tabTop3, left2, tabBottom,
-                    )
-                self.coords(darkshadow, 
-                    right2, tabTop, right, tabTop2, right, tabBottom2,
-                    right2, tabBottom, right2, tabTop3, right3, tabTop2,
-                    )
-                pageInfo['left'] = left
-                pageInfo['right'] = right
-
-                x = x + tabwidth + 2 * borderWidth
-
-        # Redraw shadow under tabs so that it appears that tab for old
-        # top page is lowered and that tab for new top page is raised.
-        if self._withTabs and (self._pending.has_key('topPage') or
-                self._pending.has_key('tabs') or self._pending.has_key('size')):
-
-            if self.getcurselection() is None:
-                # No pages, so draw line across top of page area.
-                self.coords(self._pageTop1Border,
-                    canvasBorder, self.tabBottom,
-                    hullWidth - canvasBorder, self.tabBottom,
-                    hullWidth - canvasBorder - borderWidth,
-                        self.tabBottom + borderWidth,
-                    borderWidth + canvasBorder, self.tabBottom + borderWidth,
-                    )
-
-                # Ignore second top border.
-                self.coords(self._pageTop2Border, 0, 0, 0, 0, 0, 0)
-            else:
-                # Draw two lines, one on each side of the tab for the
-                # top page, so that the tab appears to be raised.
-                pageInfo = self._pageAttrs[self.getcurselection()]
-                left = pageInfo['left']
-                right = pageInfo['right']
-                self.coords(self._pageTop1Border,
-                    canvasBorder, self.tabBottom,
-                    left, self.tabBottom,
-                    left + borderWidth, self.tabBottom + borderWidth,
-                    canvasBorder + borderWidth, self.tabBottom + borderWidth,
-                    )
-
-                self.coords(self._pageTop2Border,
-                    right, self.tabBottom,
-                    hullWidth - canvasBorder, self.tabBottom,
-                    hullWidth - canvasBorder - borderWidth,
-                        self.tabBottom + borderWidth,
-                    right - borderWidth, self.tabBottom + borderWidth,
-                    )
-
-            # Prevent bottom of dark border of tabs appearing over
-            # page top border.
-            self.tag_raise(self._pageTop1Border)
-            self.tag_raise(self._pageTop2Border)
-
-        # Position the page border shadows.
-        if self._pending.has_key('size') or oldTabBottom != self.tabBottom:
-
-            self.coords(self._pageLeftBorder,
-                canvasBorder, self.tabBottom,
-                borderWidth + canvasBorder,
-                    self.tabBottom + borderWidth,
-                borderWidth + canvasBorder,
-                    hullHeight - canvasBorder - borderWidth,
-                canvasBorder, hullHeight - canvasBorder,
-                )
-
-            self.coords(self._pageBottomRightBorder,
-                hullWidth - canvasBorder, self.tabBottom,
-                hullWidth - canvasBorder, hullHeight - canvasBorder,
-                canvasBorder, hullHeight - canvasBorder,
-                borderWidth + canvasBorder,
-                    hullHeight - canvasBorder - borderWidth,
-                hullWidth - canvasBorder - borderWidth,
-                    hullHeight - canvasBorder - borderWidth,
-                hullWidth - canvasBorder - borderWidth,
-                    self.tabBottom + borderWidth,
-                )
-
-            if not self._withTabs:
-                self.coords(self._pageTopBorder,
-                    canvasBorder, self.tabBottom,
-                    hullWidth - canvasBorder, self.tabBottom,
-                    hullWidth - canvasBorder - borderWidth,
-                        self.tabBottom + borderWidth,
-                    borderWidth + canvasBorder, self.tabBottom + borderWidth,
-                    )
-
-        # Color borders.
-        if self._pending.has_key('borderColor'):
-            self.itemconfigure('lighttag', fill = self._lightBorderColor)
-            self.itemconfigure('darktag', fill = self._darkBorderColor)
-
-        newTopPage = self._pending.get('topPage')
-        pageBorder = borderWidth + self._pageMargin
-
-        # Raise new top page.
-        if newTopPage is not None:
-            self._topPageName = newTopPage
-            self._topPageItem = self.create_window(
-                pageBorder + canvasBorder, self.tabBottom + pageBorder,
-                window = self._pageAttrs[newTopPage]['page'],
-                anchor = 'nw',
-                )
-
-        # Change position of top page if tab height has changed.
-        if self._topPageName is not None and oldTabBottom != self.tabBottom:
-            self.coords(self._topPageItem,
-                    pageBorder + canvasBorder, self.tabBottom + pageBorder)
-
-        # Change size of top page if,
-        #   1) there is a new top page.
-        #   2) canvas size has changed, but not if there is no top
-        #      page (eg:  initially or when all pages deleted).
-        #   3) tab height has changed, due to difference in the height of a tab
-        if (newTopPage is not None or \
-                self._pending.has_key('size') and self._topPageName is not None
-                or oldTabBottom != self.tabBottom):
-            self.itemconfigure(self._topPageItem,
-                width = hullWidth - 2 * canvasBorder - pageBorder * 2,
-                height = hullHeight - 2 * canvasBorder - pageBorder * 2 -
-                    (self.tabBottom - canvasBorder),
-                )
-
-        self._pending = {}
-
-# Need to do forwarding to get the pack, grid, etc methods. 
-# Unfortunately this means that all the other canvas methods are also
-# forwarded.
-forwardmethods(NoteBook, Tkinter.Canvas, '_hull')
-
-######################################################################
-### File: PmwOptionMenu.py
-import types
-import Tkinter
-
-
-class OptionMenu(MegaWidget):
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('command',        None,       None),
-            ('items',          (),         INITOPT),
-            ('initialitem',    None,       INITOPT),
-	    ('labelmargin',    0,          INITOPT),
-	    ('labelpos',       None,       INITOPT),
-	    ('sticky',         'ew',       INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-
-	self._menubutton = self.createcomponent('menubutton',
-		(), None,
-		Tkinter.Menubutton, (interior,),
-		borderwidth = 2,
-		indicatoron = 1,
-		relief = 'raised',
-		anchor = 'c',
-		highlightthickness = 2,
-		direction = 'flush',
-                takefocus = 1,
-	)
-	self._menubutton.grid(column = 2, row = 2, sticky = self['sticky'])
-
-	self._menu = self.createcomponent('menu',
-		(), None,
-		Tkinter.Menu, (self._menubutton,),
-		tearoff=0
-	)
-	self._menubutton.configure(menu = self._menu)
-
-	interior.grid_columnconfigure(2, weight = 1)
-	interior.grid_rowconfigure(2, weight = 1)
-
-        # Create the label.
-        self.createlabel(interior)
-
-        # Add the items specified by the initialisation option.
-	self._itemList = []
-        self.setitems(self['items'], self['initialitem'])
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def setitems(self, items, index = None):
-
-        # Clean up old items and callback commands.
-        for oldIndex in range(len(self._itemList)):
-            tclCommandName = str(self._menu.entrycget(oldIndex, 'command'))
-            if tclCommandName != '':   
-                self._menu.deletecommand(tclCommandName)
-        self._menu.delete(0, 'end')
-	self._itemList = list(items)
-
-	# Set the items in the menu component.
-        for item in items:
-            self._menu.add_command(label = item,
-		command = lambda self = self, item = item: self._invoke(item))
-
-	# Set the currently selected value.
-	if index is None:
-            var = str(self._menubutton.cget('textvariable'))
-	    if var != '':
-		# None means do not change text variable.
-		return
-	    if len(items) == 0:
-		text = ''
-	    elif str(self._menubutton.cget('text')) in items:
-                # Do not change selection if it is still valid
-		return
-	    else:
-		text = items[0]
-	else:
-	    index = self.index(index)
-	    text = self._itemList[index]
-
-        self.setvalue(text)
-
-    def getcurselection(self):
-	var = str(self._menubutton.cget('textvariable'))
-	if var == '':
-	    return str(self._menubutton.cget('text'))
-	else:
-	    return self._menu.tk.globalgetvar(var)
-
-    def getvalue(self):
-        return self.getcurselection()
-
-    def setvalue(self, text):
-	var = str(self._menubutton.cget('textvariable'))
-	if var == '':
-	    self._menubutton.configure(text = text)
-	else:
-	    self._menu.tk.globalsetvar(var, text)
-
-    def index(self, index):
-	listLength = len(self._itemList)
-	if type(index) == types.IntType:
-	    if index &lt; listLength:
-		return index
-	    else:
-		raise ValueError, 'index &quot;%s&quot; is out of range' % index
-	elif index is END:
-	    if listLength &gt; 0:
-		return listLength - 1
-	    else:
-		raise ValueError, 'OptionMenu has no items'
-	else:
-	    if index is SELECT:
-		if listLength &gt; 0:
-		    index = self.getcurselection()
-		else:
-		    raise ValueError, 'OptionMenu has no items'
-            if index in self._itemList:
-                return self._itemList.index(index)
-	    raise ValueError, \
-		    'bad index &quot;%s&quot;: must be a ' \
-                    'name, a number, END or SELECT' % (index,)
-
-    def invoke(self, index = SELECT):
-	index = self.index(index)
-	text = self._itemList[index]
-
-        return self._invoke(text)
-
-    def _invoke(self, text):
-        self.setvalue(text)
-
-	command = self['command']
-	if callable(command):
-	    return command(text)
-
-######################################################################
-### File: PmwPanedWidget.py
-# PanedWidget
-# a frame which may contain several resizable sub-frames
-
-import string
-import sys
-import types
-import Tkinter
-
-
-class PanedWidget(MegaWidget):
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-            ('command',            None,         None),
-            ('orient',             'vertical',   INITOPT),
-            ('separatorrelief',    'sunken',     INITOPT),
-            ('separatorthickness', 2,            INITOPT),
-            ('handlesize',         8,            INITOPT),
-            ('hull_width',         400,          None),
-            ('hull_height',        400,          None),
-	)
-	self.defineoptions(kw, optiondefs,
-                dynamicGroups = ('Frame', 'Separator', 'Handle'))
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	self.bind('&lt;Configure&gt;', self._handleConfigure)
-
-	if self['orient'] not in ('horizontal', 'vertical'):
-	    raise ValueError, 'bad orient option ' + repr(self['orient']) + \
-		': must be either \'horizontal\' or \'vertical\''
-
-        self._separatorThickness = self['separatorthickness']
-        self._handleSize = self['handlesize']
-	self._paneNames = []            # List of pane names
-	self._paneAttrs = {}            # Map from pane name to pane info
-
-	self._timerId = None
-	self._frame = {}
-	self._separator = []
-	self._button = []
-	self._totalSize = 0
-	self._movePending = 0
-	self._relsize = {}
-	self._relmin = {}
-	self._relmax = {}
-	self._size = {}
-	self._min = {}
-	self._max = {}
-	self._rootp = None
-	self._curSize = None
-	self._beforeLimit = None
-	self._afterLimit = None
-	self._buttonIsDown = 0
-	self._majorSize = 100
-	self._minorSize = 100
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def insert(self, name, before = 0, **kw):
-	# Parse &lt;kw&gt; for options.
-        self._initPaneOptions(name)
-	self._parsePaneOptions(name, kw)
-
-	insertPos = self._nameToIndex(before)
-	atEnd = (insertPos == len(self._paneNames))
-
-	# Add the frame.
-	self._paneNames[insertPos:insertPos] = [name]
-	self._frame[name] = self.createcomponent(name,
-		(), 'Frame',
-		Tkinter.Frame, (self.interior(),))
-
-	# Add separator, if necessary.
-	if len(self._paneNames) &gt; 1:
-	    self._addSeparator()
-	else:
-	    self._separator.append(None)
-	    self._button.append(None)
-
-	# Add the new frame and adjust the PanedWidget
-	if atEnd:
-	    size = self._size[name]
-	    if size &gt; 0 or self._relsize[name] is not None:
-		if self['orient'] == 'vertical':
-		    self._frame[name].place(x=0, relwidth=1,
-					    height=size, y=self._totalSize)
-		else:
-		    self._frame[name].place(y=0, relheight=1,
-					    width=size, x=self._totalSize)
-	    else:
-		if self['orient'] == 'vertical':
-		    self._frame[name].place(x=0, relwidth=1,
-					    y=self._totalSize)
-		else:
-		    self._frame[name].place(y=0, relheight=1,
-					    x=self._totalSize)
-	else:
-	    self._updateSizes()
-
-	self._totalSize = self._totalSize + self._size[name]
-	return self._frame[name]
-
-    def add(self, name, **kw):
-        return apply(self.insert, (name, len(self._paneNames)), kw)
-
-    def delete(self, name):
-	deletePos = self._nameToIndex(name)
-	name = self._paneNames[deletePos]
-	self.destroycomponent(name)
-	del self._paneNames[deletePos]
-	del self._frame[name]
-	del self._size[name]
-	del self._min[name]
-	del self._max[name]
-	del self._relsize[name]
-	del self._relmin[name]
-	del self._relmax[name]
-
-	last = len(self._paneNames)
-	del self._separator[last]
-	del self._button[last]
-        if last &gt; 0:
-            self.destroycomponent(self._sepName(last))
-            self.destroycomponent(self._buttonName(last))
-
-	self._plotHandles()
-
-    def setnaturalsize(self):
-        self.update_idletasks()
-        totalWidth = 0
-        totalHeight = 0
-        maxWidth = 0
-        maxHeight = 0
-	for name in self._paneNames:
-            frame = self._frame[name]
-            w = frame.winfo_reqwidth()
-            h = frame.winfo_reqheight()
-            totalWidth = totalWidth + w
-            totalHeight = totalHeight + h
-            if maxWidth &lt; w:
-                maxWidth = w
-            if maxHeight &lt; h:
-                maxHeight = h
-
-        # Note that, since the hull is a frame, the width and height
-        # options specify the geometry *outside* the borderwidth and
-        # highlightthickness.
-        bw = string.atoi(str(self.cget('hull_borderwidth')))
-        hl = string.atoi(str(self.cget('hull_highlightthickness')))
-        extra = (bw + hl) * 2
-        if str(self.cget('orient')) == 'horizontal':
-            totalWidth = totalWidth + extra
-            maxHeight = maxHeight + extra
-            self.configure(hull_width = totalWidth, hull_height = maxHeight)
-        else:
-            totalHeight = (totalHeight + extra +
-                    (len(self._paneNames) - 1) * self._separatorThickness)
-            maxWidth = maxWidth + extra
-            self.configure(hull_width = maxWidth, hull_height = totalHeight)
-
-    def move(self, name, newPos, newPosOffset = 0):
-
-        # see if we can spare ourselves some work
-        numPanes = len(self._paneNames)
-        if numPanes &lt; 2:
-            return
-
-        newPos = self._nameToIndex(newPos) + newPosOffset
-        if newPos &lt; 0 or newPos &gt;=numPanes:
-            return
-
-        deletePos = self._nameToIndex(name)
-
-        if deletePos == newPos:
-            # inserting over ourself is a no-op
-            return
-
-        # delete name from old position in list
-        name = self._paneNames[deletePos]
-        del self._paneNames[deletePos]
-
-        # place in new position
-        self._paneNames[newPos:newPos] = [name]
-
-        # force everything to redraw
-        self._plotHandles()
-        self._updateSizes()
-
-    def _nameToIndex(self, nameOrIndex):
-	try:
-	    pos = self._paneNames.index(nameOrIndex)
-	except ValueError:
-	    pos = nameOrIndex
-
-	return pos
-
-    def _initPaneOptions(self, name):
-	# Set defaults.
-	self._size[name] = 0
-	self._relsize[name] = None
-	self._min[name] = 0
-	self._relmin[name] = None
-	self._max[name] = 100000
-	self._relmax[name] = None
-
-    def _parsePaneOptions(self, name, args):
-	# Parse &lt;args&gt; for options.
-	for arg, value in args.items():
-	    if type(value) == types.FloatType:
-		relvalue = value
-		value = self._absSize(relvalue)
-	    else:
-		relvalue = None
-
-	    if arg == 'size':
-		self._size[name], self._relsize[name] = value, relvalue
-	    elif arg == 'min':
-		self._min[name], self._relmin[name] = value, relvalue
-	    elif arg == 'max':
-		self._max[name], self._relmax[name] = value, relvalue
-	    else:
-		raise ValueError, 'keyword must be &quot;size&quot;, &quot;min&quot;, or &quot;max&quot;'
-
-    def _absSize(self, relvalue):
-	return int(round(relvalue * self._majorSize))
-
-    def _sepName(self, n):
-	return 'separator-%d' % n
-
-    def _buttonName(self, n):
-	return 'handle-%d' % n
-
-    def _addSeparator(self):
-	n = len(self._paneNames) - 1
-
-	downFunc = lambda event, s = self, num=n: s._btnDown(event, num)
-	upFunc = lambda event, s = self, num=n: s._btnUp(event, num)
-	moveFunc = lambda event, s = self, num=n: s._btnMove(event, num)
-
-	# Create the line dividing the panes.
-	sep = self.createcomponent(self._sepName(n),
-		(), 'Separator',
-		Tkinter.Frame, (self.interior(),),
-		borderwidth = 1,
-		relief = self['separatorrelief'])
-	self._separator.append(sep)
-
-	sep.bind('&lt;ButtonPress-1&gt;', downFunc)
-	sep.bind('&lt;Any-ButtonRelease-1&gt;', upFunc)
-	sep.bind('&lt;B1-Motion&gt;', moveFunc)
-
-	if self['orient'] == 'vertical':
-	    cursor = 'sb_v_double_arrow'
-	    sep.configure(height = self._separatorThickness,
-                    width = 10000, cursor = cursor)
-	else:
-	    cursor = 'sb_h_double_arrow'
-	    sep.configure(width = self._separatorThickness,
-                    height = 10000, cursor = cursor)
-
-	self._totalSize = self._totalSize + self._separatorThickness
-
-	# Create the handle on the dividing line.
-	handle = self.createcomponent(self._buttonName(n),
-		(), 'Handle',
-		Tkinter.Frame, (self.interior(),),
-		    relief = 'raised',
-		    borderwidth = 1,
-		    width = self._handleSize,
-		    height = self._handleSize,
-		    cursor = cursor,
-		)
-	self._button.append(handle)
-
-	handle.bind('&lt;ButtonPress-1&gt;', downFunc)
-	handle.bind('&lt;Any-ButtonRelease-1&gt;', upFunc)
-	handle.bind('&lt;B1-Motion&gt;', moveFunc)
-
-	self._plotHandles()
-
-	for i in range(1, len(self._paneNames)):
-	    self._separator[i].tkraise()
-	for i in range(1, len(self._paneNames)):
-	    self._button[i].tkraise()
-
-    def _btnUp(self, event, item):
-	self._buttonIsDown = 0
-	self._updateSizes()
-	try:
-	    self._button[item].configure(relief='raised')
-	except:
-	    pass
-
-    def _btnDown(self, event, item):
-	self._button[item].configure(relief='sunken')
-	self._getMotionLimit(item)
-	self._buttonIsDown = 1
-	self._movePending = 0
-
-    def _handleConfigure(self, event = None):
-	self._getNaturalSizes()
-	if self._totalSize == 0:
-	    return
-
-	iterRange = list(self._paneNames)
-	iterRange.reverse()
-	if self._majorSize &gt; self._totalSize:
-	    n = self._majorSize - self._totalSize
-	    self._iterate(iterRange, self._grow, n)
-	elif self._majorSize &lt; self._totalSize:
-	    n = self._totalSize - self._majorSize
-	    self._iterate(iterRange, self._shrink, n)
-
-	self._plotHandles()
-	self._updateSizes()
-
-    def _getNaturalSizes(self):
-	# Must call this in order to get correct winfo_width, winfo_height
-	self.update_idletasks()
-
-	self._totalSize = 0
-
-	if self['orient'] == 'vertical':
-	    self._majorSize = self.winfo_height()
-	    self._minorSize = self.winfo_width()
-	    majorspec = Tkinter.Frame.winfo_reqheight
-	else:
-	    self._majorSize = self.winfo_width()
-	    self._minorSize = self.winfo_height()
-	    majorspec = Tkinter.Frame.winfo_reqwidth
-
-        bw = string.atoi(str(self.cget('hull_borderwidth')))
-        hl = string.atoi(str(self.cget('hull_highlightthickness')))
-        extra = (bw + hl) * 2
-        self._majorSize = self._majorSize - extra
-        self._minorSize = self._minorSize - extra
-
-	if self._majorSize &lt; 0:
-	    self._majorSize = 0
-	if self._minorSize &lt; 0:
-	    self._minorSize = 0
-
-	for name in self._paneNames:
-	    # adjust the absolute sizes first...
-	    if self._relsize[name] is None:
-		#special case
-		if self._size[name] == 0:
-		    self._size[name] = apply(majorspec, (self._frame[name],))
-		    self._setrel(name)
-	    else:
-		self._size[name] = self._absSize(self._relsize[name])
-
-	    if self._relmin[name] is not None:
-		self._min[name] = self._absSize(self._relmin[name])
-	    if self._relmax[name] is not None:
-		self._max[name] = self._absSize(self._relmax[name])
-
-	    # now adjust sizes
-	    if self._size[name] &lt; self._min[name]:
-		self._size[name] = self._min[name]
-		self._setrel(name)
-
-	    if self._size[name] &gt; self._max[name]:
-		self._size[name] = self._max[name]
-		self._setrel(name)
-
-	    self._totalSize = self._totalSize + self._size[name]
-
-	# adjust for separators
-	self._totalSize = (self._totalSize +
-                (len(self._paneNames) - 1) * self._separatorThickness)
-
-    def _setrel(self, name):
-	if self._relsize[name] is not None:
-	    if self._majorSize != 0:
-		self._relsize[name] = round(self._size[name]) / self._majorSize
-
-    def _iterate(self, names, proc, n):
-	for i in names:
-	    n = apply(proc, (i, n))
-	    if n == 0:
-		break
-
-    def _grow(self, name, n):
-	canGrow = self._max[name] - self._size[name]
-
-	if canGrow &gt; n:
-	    self._size[name] = self._size[name] + n
-	    self._setrel(name)
-	    return 0
-	elif canGrow &gt; 0:
-	    self._size[name] = self._max[name]
-	    self._setrel(name)
-	    n = n - canGrow
-
-	return n
-
-    def _shrink(self, name, n):
-	canShrink = self._size[name] - self._min[name]
-
-	if canShrink &gt; n:
-	    self._size[name] = self._size[name] - n
-	    self._setrel(name)
-	    return 0
-	elif canShrink &gt; 0:
-	    self._size[name] = self._min[name]
-	    self._setrel(name)
-	    n = n - canShrink
-
-	return n
-
-    def _updateSizes(self):
-	totalSize = 0
-
-	for name in self._paneNames:
-	    size = self._size[name]
-	    if self['orient'] == 'vertical':
-		self._frame[name].place(x = 0, relwidth = 1,
-					y = totalSize,
-					height = size)
-	    else:
-		self._frame[name].place(y = 0, relheight = 1,
-					x = totalSize,
-					width = size)
-
-	    totalSize = totalSize + size + self._separatorThickness
-
-	# Invoke the callback command
-	cmd = self['command']
-	if callable(cmd):
-	    cmd(map(lambda x, s = self: s._size[x], self._paneNames))
-
-    def _plotHandles(self):
-	if len(self._paneNames) == 0:
-	    return
-
-	if self['orient'] == 'vertical':
-	    btnp = self._minorSize - 13
-	else:
-	    h = self._minorSize
-
-	    if h &gt; 18:
-		btnp = 9
-	    else:
-		btnp = h - 9
-
-	firstPane = self._paneNames[0]
-	totalSize = self._size[firstPane]
-
-	first = 1
-	last = len(self._paneNames) - 1
-
-	# loop from first to last, inclusive
-	for i in range(1, last + 1):
-
-	    handlepos = totalSize - 3
-	    prevSize = self._size[self._paneNames[i - 1]]
-	    nextSize = self._size[self._paneNames[i]]
-
-	    offset1 = 0
-
-	    if i == first:
-		if prevSize &lt; 4:
-		    offset1 = 4 - prevSize
-	    else:
-		if prevSize &lt; 8:
-		    offset1 = (8 - prevSize) / 2
-
-	    offset2 = 0
-
-	    if i == last:
-		if nextSize &lt; 4:
-		    offset2 = nextSize - 4
-	    else:
-		if nextSize &lt; 8:
-		    offset2 = (nextSize - 8) / 2
-
-	    handlepos = handlepos + offset1
-
-	    if self['orient'] == 'vertical':
-		height = 8 - offset1 + offset2
-
-		if height &gt; 1:
-		    self._button[i].configure(height = height)
-		    self._button[i].place(x = btnp, y = handlepos)
-		else:
-		    self._button[i].place_forget()
-
-		self._separator[i].place(x = 0, y = totalSize,
-					 relwidth = 1)
-	    else:
-		width = 8 - offset1 + offset2
-
-		if width &gt; 1:
-		    self._button[i].configure(width = width)
-		    self._button[i].place(y = btnp, x = handlepos)
-		else:
-		    self._button[i].place_forget()
-
-		self._separator[i].place(y = 0, x = totalSize,
-					 relheight = 1)
-
-	    totalSize = totalSize + nextSize + self._separatorThickness
-
-    def pane(self, name):
-	return self._frame[self._paneNames[self._nameToIndex(name)]]
-
-    # Return the name of all panes
-    def panes(self):
-	return list(self._paneNames)
-
-    def configurepane(self, name, **kw):
-	name = self._paneNames[self._nameToIndex(name)]
-	self._parsePaneOptions(name, kw)
-	self._handleConfigure()
-
-    def updatelayout(self):
-	self._handleConfigure()
-
-    def _getMotionLimit(self, item):
-	curBefore = (item - 1) * self._separatorThickness
-	minBefore, maxBefore = curBefore, curBefore
-
-	for name in self._paneNames[:item]:
-	    curBefore = curBefore + self._size[name]
-	    minBefore = minBefore + self._min[name]
-	    maxBefore = maxBefore + self._max[name]
-
-	curAfter = (len(self._paneNames) - item) * self._separatorThickness
-	minAfter, maxAfter = curAfter, curAfter
-	for name in self._paneNames[item:]:
-	    curAfter = curAfter + self._size[name]
-	    minAfter = minAfter + self._min[name]
-	    maxAfter = maxAfter + self._max[name]
-
-	beforeToGo = min(curBefore - minBefore, maxAfter - curAfter)
-	afterToGo = min(curAfter - minAfter, maxBefore - curBefore)
-
-	self._beforeLimit = curBefore - beforeToGo
-	self._afterLimit = curBefore + afterToGo
-	self._curSize = curBefore
-
-	self._plotHandles()
-
-    # Compress the motion so that update is quick even on slow machines
-    #
-    # theRootp = root position (either rootx or rooty)
-    def _btnMove(self, event, item):
-	self._rootp = event
-
-	if self._movePending == 0:
-	    self._timerId = self.after_idle(
-		    lambda s = self, i = item: s._btnMoveCompressed(i))
-	    self._movePending = 1
-
-    def destroy(self):
-        if self._timerId is not None:
-          self.after_cancel(self._timerId)
-	  self._timerId = None
-        MegaWidget.destroy(self)
-
-    def _btnMoveCompressed(self, item):
-	if not self._buttonIsDown:
-	    return
-
-	if self['orient'] == 'vertical':
-	    p = self._rootp.y_root - self.winfo_rooty()
-	else:
-	    p = self._rootp.x_root - self.winfo_rootx()
-
-	if p == self._curSize:
-	    self._movePending = 0
-	    return
-
-	if p &lt; self._beforeLimit:
-	    p = self._beforeLimit
-
-	if p &gt;= self._afterLimit:
-	    p = self._afterLimit
-
-	self._calculateChange(item, p)
-	self.update_idletasks()
-	self._movePending = 0
-
-    # Calculate the change in response to mouse motions
-    def _calculateChange(self, item, p):
-
-	if p &lt; self._curSize:
-	    self._moveBefore(item, p)
-	elif p &gt; self._curSize:
-	    self._moveAfter(item, p)
-
-	self._plotHandles()
-
-    def _moveBefore(self, item, p):
-	n = self._curSize - p
-
-	# Shrink the frames before
-	iterRange = list(self._paneNames[:item])
-	iterRange.reverse()
-	self._iterate(iterRange, self._shrink, n)
-
-	# Adjust the frames after
-	iterRange = self._paneNames[item:]
-	self._iterate(iterRange, self._grow, n)
-
-	self._curSize = p
-
-    def _moveAfter(self, item, p):
-	n = p - self._curSize
-
-	# Shrink the frames after
-	iterRange = self._paneNames[item:]
-	self._iterate(iterRange, self._shrink, n)
-
-	# Adjust the frames before
-	iterRange = list(self._paneNames[:item])
-	iterRange.reverse()
-	self._iterate(iterRange, self._grow, n)
-
-	self._curSize = p
-
-######################################################################
-### File: PmwPromptDialog.py
-# Based on iwidgets2.2.0/promptdialog.itk code.
-
-
-
-# A Dialog with an entryfield
-
-class PromptDialog(Dialog):
-    def __init__(self, parent = None, **kw):
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderx',     20,    INITOPT),
-	    ('bordery',     20,    INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	Dialog.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-	aliases = (
-	    ('entry', 'entryfield_entry'),
-	    ('label', 'entryfield_label'),
-	)
-	self._promptDialogEntry = self.createcomponent('entryfield',
-		aliases, None,
-		EntryField, (interior,))
-	self._promptDialogEntry.pack(fill='x', expand=1,
-		padx = self['borderx'], pady = self['bordery'])
-	
-        if not kw.has_key('activatecommand'):
-            # Whenever this dialog is activated, set the focus to the
-            # EntryField's entry widget.
-            tkentry = self.component('entry')
-            self.configure(activatecommand = tkentry.focus_set)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    # Supply aliases to some of the entry component methods.
-    def insertentry(self, index, text):
-	self._promptDialogEntry.insert(index, text)
-
-    def deleteentry(self, first, last=None):
-	self._promptDialogEntry.delete(first, last)
-
-    def indexentry(self, index):
-	return self._promptDialogEntry.index(index)
-
-forwardmethods(PromptDialog, EntryField, '_promptDialogEntry')
-
-######################################################################
-### File: PmwRadioSelect.py
-import types
-import Tkinter
-
-
-class RadioSelect(MegaWidget):
-    # A collection of several buttons.  In single mode, only one
-    # button may be selected.  In multiple mode, any number of buttons
-    # may be selected.
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('buttontype',    'button',      INITOPT),
-	    ('command',       None,          None),
-	    ('labelmargin',   0,             INITOPT),
-	    ('labelpos',      None,          INITOPT),
-	    ('orient',       'horizontal',   INITOPT),
-	    ('padx',          5,             INITOPT),
-	    ('pady',          5,             INITOPT),
-	    ('selectmode',    'single',      INITOPT),
-	)
-	self.defineoptions(kw, optiondefs, dynamicGroups = ('Button',))
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-	if self['labelpos'] is None:
-	    self._radioSelectFrame = self._hull
-	else:
-	    self._radioSelectFrame = self.createcomponent('frame',
-		    (), None,
-		    Tkinter.Frame, (interior,))
-	    self._radioSelectFrame.grid(column=2, row=2, sticky='nsew')
-	    interior.grid_columnconfigure(2, weight=1)
-	    interior.grid_rowconfigure(2, weight=1)
-
-	    self.createlabel(interior)
-
-	# Initialise instance variables.
-	self._buttonList = []
-	if self['selectmode'] == 'single':
-	    self._singleSelect = 1
-	elif self['selectmode'] == 'multiple':
-	    self._singleSelect = 0
-	else: 
-	    raise ValueError, 'bad selectmode option &quot;' + \
-		    self['selectmode'] + '&quot;: should be single or multiple'
-
-	if self['buttontype'] == 'button':
-	    self.buttonClass = Tkinter.Button
-	elif self['buttontype'] == 'radiobutton':
-	    self._singleSelect = 1
-	    self.var = Tkinter.StringVar()
-	    self.buttonClass = Tkinter.Radiobutton
-	elif self['buttontype'] == 'checkbutton':
-	    self._singleSelect = 0
-	    self.buttonClass = Tkinter.Checkbutton
-	else:
-	    raise ValueError, 'bad buttontype option &quot;' + \
-		    self['buttontype'] + \
-		    '&quot;: should be button, radiobutton or checkbutton'
-
-	if self._singleSelect:
-	    self.selection = None
-	else:
-	    self.selection = []
-
-	if self['orient'] not in ('horizontal', 'vertical'):
-	    raise ValueError, 'bad orient option ' + repr(self['orient']) + \
-		': must be either \'horizontal\' or \'vertical\''
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def getcurselection(self):
-	if self._singleSelect:
-            return self.selection
-        else:
-            return tuple(self.selection)
-
-    def getvalue(self):
-        return self.getcurselection()
-
-    def setvalue(self, textOrList):
-	if self._singleSelect:
-            self.__setSingleValue(textOrList)
-        else:
-	    # Multiple selections
-            oldselection = self.selection
-            self.selection = textOrList
-            for button in self._buttonList:
-                if button in oldselection:
-                    if button not in self.selection:
-                        # button is currently selected but should not be
-                        widget = self.component(button)
-                        if self['buttontype'] == 'checkbutton':
-                            widget.deselect()
-                        else:  # Button
-                            widget.configure(relief='raised')
-                else:
-                    if button in self.selection:
-                        # button is not currently selected but should be
-                        widget = self.component(button)
-                        if self['buttontype'] == 'checkbutton':
-                            widget.select()
-                        else:  # Button
-                            widget.configure(relief='sunken')
-
-    def numbuttons(self):
-        return len(self._buttonList)
-
-    def index(self, index):
-	# Return the integer index of the button with the given index.
-
-	listLength = len(self._buttonList)
-	if type(index) == types.IntType:
-	    if index &lt; listLength:
-		return index
-	    else:
-		raise ValueError, 'index &quot;%s&quot; is out of range' % index
-	elif index is END:
-	    if listLength &gt; 0:
-		return listLength - 1
-	    else:
-		raise ValueError, 'RadioSelect has no buttons'
-	else:
-	    for count in range(listLength):
-		name = self._buttonList[count]
-		if index == name:
-		    return count
-	    validValues = 'a name, a number or END'
-	    raise ValueError, \
-		    'bad index &quot;%s&quot;: must be %s' % (index, validValues)
-
-    def button(self, buttonIndex):
-	name = self._buttonList[self.index(buttonIndex)]
-        return self.component(name)
-
-    def add(self, componentName, **kw):
-	if componentName in self._buttonList:
-	    raise ValueError, 'button &quot;%s&quot; already exists' % componentName
-
-	kw['command'] = \
-                lambda self=self, name=componentName: self.invoke(name)
-	if not kw.has_key('text'):
-	    kw['text'] = componentName
-
-	if self['buttontype'] == 'radiobutton':
-	    if not kw.has_key('anchor'):
-		kw['anchor'] = 'w'
-	    if not kw.has_key('variable'):
-		kw['variable'] = self.var
-	    if not kw.has_key('value'):
-		kw['value'] = kw['text']
-	elif self['buttontype'] == 'checkbutton':
-	    if not kw.has_key('anchor'):
-		kw['anchor'] = 'w'
-
-	button = apply(self.createcomponent, (componentName,
-		(), 'Button',
-		self.buttonClass, (self._radioSelectFrame,)), kw)
-
-	if self['orient'] == 'horizontal':
-	    self._radioSelectFrame.grid_rowconfigure(0, weight=1)
-	    col = len(self._buttonList)
-	    button.grid(column=col, row=0, padx = self['padx'],
-		    pady = self['pady'], sticky='nsew')
-	    self._radioSelectFrame.grid_columnconfigure(col, weight=1)
-	else:
-	    self._radioSelectFrame.grid_columnconfigure(0, weight=1)
-	    row = len(self._buttonList)
-	    button.grid(column=0, row=row, padx = self['padx'],
-		    pady = self['pady'], sticky='ew')
-	    self._radioSelectFrame.grid_rowconfigure(row, weight=1)
-
-	self._buttonList.append(componentName)
-	return button
-
-    def deleteall(self):
-	for name in self._buttonList:
-	    self.destroycomponent(name)
-	self._buttonList = []
-	if self._singleSelect:
-	    self.selection = None
-	else: 
-	    self.selection = []
-
-    def __setSingleValue(self, value):
-            self.selection = value
-            if self['buttontype'] == 'radiobutton':
-                widget = self.component(value)
-                widget.select()
-            else:  # Button
-                for button in self._buttonList:
-                    widget = self.component(button)
-                    if button == value:
-                        widget.configure(relief='sunken')
-                    else:
-                        widget.configure(relief='raised')
-
-    def invoke(self, index):
-	index = self.index(index)
-	name = self._buttonList[index]
-
-	if self._singleSelect:
-            self.__setSingleValue(name)
-	    command = self['command']
-	    if callable(command):
-		return command(name)
-        else:
-	    # Multiple selections
-	    widget = self.component(name)
-	    if name in self.selection:
-		if self['buttontype'] == 'checkbutton':
-		    widget.deselect()
-		else:
-		    widget.configure(relief='raised')
-		self.selection.remove(name)
-		state = 0
-	    else:
-		if self['buttontype'] == 'checkbutton':
-		    widget.select()
-		else:
-		    widget.configure(relief='sunken')
-		self.selection.append(name)
-		state = 1
-
-	    command = self['command']
-	    if callable(command):
-	      return command(name, state)
-
-######################################################################
-### File: PmwScrolledCanvas.py
-import Tkinter
-
-
-class ScrolledCanvas(MegaWidget):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderframe',    0,            INITOPT),
-	    ('canvasmargin',   0,            INITOPT),
-	    ('hscrollmode',    'dynamic',    self._hscrollMode),
-	    ('labelmargin',    0,            INITOPT),
-	    ('labelpos',       None,         INITOPT),
-	    ('scrollmargin',   2,            INITOPT),
-	    ('usehullsize',    0,            INITOPT),
-	    ('vscrollmode',    'dynamic',    self._vscrollMode),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	self.origInterior = MegaWidget.interior(self)
-
-	if self['usehullsize']:
-	    self.origInterior.grid_propagate(0)
-
-	if self['borderframe']:
-	    # Create a frame widget to act as the border of the canvas. 
-	    self._borderframe = self.createcomponent('borderframe',
-		    (), None,
-		    Tkinter.Frame, (self.origInterior,),
-		    relief = 'sunken',
-		    borderwidth = 2,
-	    )
-	    self._borderframe.grid(row = 2, column = 2, sticky = 'news')
-
-	    # Create the canvas widget.
-	    self._canvas = self.createcomponent('canvas',
-		    (), None,
-		    Tkinter.Canvas, (self._borderframe,),
-		    highlightthickness = 0,
-		    borderwidth = 0,
-	    )
-	    self._canvas.pack(fill = 'both', expand = 1)
-	else:
-	    # Create the canvas widget.
-	    self._canvas = self.createcomponent('canvas',
-		    (), None,
-		    Tkinter.Canvas, (self.origInterior,),
-		    relief = 'sunken',
-		    borderwidth = 2,
-	    )
-	    self._canvas.grid(row = 2, column = 2, sticky = 'news')
-
-	self.origInterior.grid_rowconfigure(2, weight = 1, minsize = 0)
-	self.origInterior.grid_columnconfigure(2, weight = 1, minsize = 0)
-	
-	# Create the horizontal scrollbar
-	self._horizScrollbar = self.createcomponent('horizscrollbar',
-		(), 'Scrollbar',
-		Tkinter.Scrollbar, (self.origInterior,),
-	        orient='horizontal',
-		command=self._canvas.xview
-	)
-
-	# Create the vertical scrollbar
-	self._vertScrollbar = self.createcomponent('vertscrollbar',
-		(), 'Scrollbar',
-		Tkinter.Scrollbar, (self.origInterior,),
-		orient='vertical',
-		command=self._canvas.yview
-	)
-
-	self.createlabel(self.origInterior, childCols = 3, childRows = 3)
-
-	# Initialise instance variables.
-	self._horizScrollbarOn = 0
-	self._vertScrollbarOn = 0
-	self.scrollTimer = None
-        self._scrollRecurse = 0
-	self._horizScrollbarNeeded = 0
-	self._vertScrollbarNeeded = 0
-	self.setregionTimer = None
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	if self.scrollTimer is not None:
-	    self.after_cancel(self.scrollTimer)
-	    self.scrollTimer = None
-	if self.setregionTimer is not None:
-	    self.after_cancel(self.setregionTimer)
-	    self.setregionTimer = None
-	MegaWidget.destroy(self)
-
-    # ======================================================================
-
-    # Public methods.
-
-    def interior(self):
-	return self._canvas
-
-    def resizescrollregion(self):
-	if self.setregionTimer is None:
-	    self.setregionTimer = self.after_idle(self._setRegion)
-
-    # ======================================================================
-
-    # Configuration methods.
-
-    def _hscrollMode(self):
-	# The horizontal scroll mode has been configured.
-
-	mode = self['hscrollmode']
-
-	if mode == 'static':
-	    if not self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	elif mode == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	elif mode == 'none':
-	    if self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	else:
-	    message = 'bad hscrollmode option &quot;%s&quot;: should be static, dynamic, or none' % mode
-	    raise ValueError, message
-
-        self._configureScrollCommands()
-
-    def _vscrollMode(self):
-	# The vertical scroll mode has been configured.
-
-	mode = self['vscrollmode']
-
-	if mode == 'static':
-	    if not self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	elif mode == 'dynamic':
-	    if self._vertScrollbarNeeded != self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	elif mode == 'none':
-	    if self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	else:
-	    message = 'bad vscrollmode option &quot;%s&quot;: should be static, dynamic, or none' % mode
-	    raise ValueError, message
-
-        self._configureScrollCommands()
-
-    # ======================================================================
-
-    # Private methods.
-
-    def _configureScrollCommands(self):
-        # If both scrollmodes are not dynamic we can save a lot of
-        # time by not having to create an idle job to handle the
-        # scroll commands.
-
-        # Clean up previous scroll commands to prevent memory leak.
-        tclCommandName = str(self._canvas.cget('xscrollcommand'))
-        if tclCommandName != '':   
-            self._canvas.deletecommand(tclCommandName)
-        tclCommandName = str(self._canvas.cget('yscrollcommand'))
-        if tclCommandName != '':   
-            self._canvas.deletecommand(tclCommandName)
-
-	if self['hscrollmode'] == self['vscrollmode'] == 'dynamic':
-            self._canvas.configure(
-                    xscrollcommand=self._scrollBothLater,
-                    yscrollcommand=self._scrollBothLater
-            )
-        else:
-            self._canvas.configure(
-                    xscrollcommand=self._scrollXNow,
-                    yscrollcommand=self._scrollYNow
-            )
-
-    def _scrollXNow(self, first, last):
-        self._horizScrollbar.set(first, last)
-        self._horizScrollbarNeeded = ((first, last) != ('0', '1'))
-
-	if self['hscrollmode'] == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-
-    def _scrollYNow(self, first, last):
-        self._vertScrollbar.set(first, last)
-        self._vertScrollbarNeeded = ((first, last) != ('0', '1'))
-
-        if self['vscrollmode'] == 'dynamic':
-            if self._vertScrollbarNeeded != self._vertScrollbarOn:
-                self._toggleVertScrollbar()
-
-    def _scrollBothLater(self, first, last):
-	# Called by the canvas to set the horizontal or vertical
-	# scrollbar when it has scrolled or changed scrollregion.
-
-	if self.scrollTimer is None:
-	    self.scrollTimer = self.after_idle(self._scrollBothNow)
-
-    def _scrollBothNow(self):
-        # This performs the function of _scrollXNow and _scrollYNow.
-        # If one is changed, the other should be updated to match.
-	self.scrollTimer = None
-
-        # Call update_idletasks to make sure that the containing frame
-        # has been resized before we attempt to set the scrollbars. 
-        # Otherwise the scrollbars may be mapped/unmapped continuously.
-        self._scrollRecurse = self._scrollRecurse + 1
-        self.update_idletasks()
-        self._scrollRecurse = self._scrollRecurse - 1
-        if self._scrollRecurse != 0:
-            return
-
-	xview = self._canvas.xview()
-	yview = self._canvas.yview()
-	self._horizScrollbar.set(xview[0], xview[1])
-	self._vertScrollbar.set(yview[0], yview[1])
-
-	self._horizScrollbarNeeded = (xview != (0.0, 1.0))
-	self._vertScrollbarNeeded = (yview != (0.0, 1.0))
-
-	# If both horizontal and vertical scrollmodes are dynamic and
-	# currently only one scrollbar is mapped and both should be
-	# toggled, then unmap the mapped scrollbar.  This prevents a
-	# continuous mapping and unmapping of the scrollbars. 
-	if (self['hscrollmode'] == self['vscrollmode'] == 'dynamic' and
-		self._horizScrollbarNeeded != self._horizScrollbarOn and
-		self._vertScrollbarNeeded != self._vertScrollbarOn and
-		self._vertScrollbarOn != self._horizScrollbarOn):
-	    if self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	    else:
-		self._toggleVertScrollbar()
-	    return
-
-	if self['hscrollmode'] == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-
-	if self['vscrollmode'] == 'dynamic':
-	    if self._vertScrollbarNeeded != self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-
-    def _toggleHorizScrollbar(self):
-
-	self._horizScrollbarOn = not self._horizScrollbarOn
-
-	interior = self.origInterior
-	if self._horizScrollbarOn:
-	    self._horizScrollbar.grid(row = 4, column = 2, sticky = 'news')
-	    interior.grid_rowconfigure(3, minsize = self['scrollmargin'])
-	else:
-	    self._horizScrollbar.grid_forget()
-	    interior.grid_rowconfigure(3, minsize = 0)
-
-    def _toggleVertScrollbar(self):
-
-	self._vertScrollbarOn = not self._vertScrollbarOn
-
-	interior = self.origInterior
-	if self._vertScrollbarOn:
-	    self._vertScrollbar.grid(row = 2, column = 4, sticky = 'news')
-	    interior.grid_columnconfigure(3, minsize = self['scrollmargin'])
-	else:
-	    self._vertScrollbar.grid_forget()
-	    interior.grid_columnconfigure(3, minsize = 0)
-
-    def _setRegion(self):
-	self.setregionTimer = None
-
-	region = self._canvas.bbox('all')
-        if region is not None:
-	    canvasmargin = self['canvasmargin']
-	    region = (region[0] - canvasmargin, region[1] - canvasmargin,
-		region[2] + canvasmargin, region[3] + canvasmargin)
-	    self._canvas.configure(scrollregion = region)
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)bbox method inherited from Tkinter.Frame.Grid.
-    def bbox(self, *args):
-	return apply(self._canvas.bbox, args)
-
-forwardmethods(ScrolledCanvas, Tkinter.Canvas, '_canvas')
-
-######################################################################
-### File: PmwScrolledField.py
-import Tkinter
-
-
-class ScrolledField(MegaWidget):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('labelmargin',   0,      INITOPT),
-	    ('labelpos',      None,   INITOPT),
-	    ('sticky',        'ew',   INITOPT),
-	    ('text',          '',     self._text),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-	self._scrolledFieldEntry = self.createcomponent('entry',
-		(), None,
-		Tkinter.Entry, (interior,))
-
-        # Can't always use 'disabled', since this greys out text in Tk 8.4.2
-        try:
-            self._scrolledFieldEntry.configure(state = 'readonly')
-        except Tkinter.TclError:
-            self._scrolledFieldEntry.configure(state = 'disabled')
-
-	self._scrolledFieldEntry.grid(column=2, row=2, sticky=self['sticky'])
-	interior.grid_columnconfigure(2, weight=1)
-	interior.grid_rowconfigure(2, weight=1)
-
-	self.createlabel(interior)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def _text(self):
-        text = self['text']
-        self._scrolledFieldEntry.configure(state = 'normal')
-        self._scrolledFieldEntry.delete(0, 'end')
-        self._scrolledFieldEntry.insert('end', text)
-
-        # Can't always use 'disabled', since this greys out text in Tk 8.4.2
-        try:
-            self._scrolledFieldEntry.configure(state = 'readonly')
-        except Tkinter.TclError:
-            self._scrolledFieldEntry.configure(state = 'disabled')
-
-forwardmethods(ScrolledField, Tkinter.Entry, '_scrolledFieldEntry')
-
-######################################################################
-### File: PmwScrolledFrame.py
-import string
-import types
-import Tkinter
-
-
-class ScrolledFrame(MegaWidget):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderframe',    1,            INITOPT),
-	    ('horizflex',      'fixed',      self._horizflex),
-	    ('horizfraction',  0.05,         INITOPT),
-	    ('hscrollmode',    'dynamic',    self._hscrollMode),
-	    ('labelmargin',    0,            INITOPT),
-	    ('labelpos',       None,         INITOPT),
-	    ('scrollmargin',   2,            INITOPT),
-	    ('usehullsize',    0,            INITOPT),
-	    ('vertflex',       'fixed',      self._vertflex),
-	    ('vertfraction',   0.05,         INITOPT),
-	    ('vscrollmode',    'dynamic',    self._vscrollMode),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	self.origInterior = MegaWidget.interior(self)
-
-	if self['usehullsize']:
-	    self.origInterior.grid_propagate(0)
-
-	if self['borderframe']:
-	    # Create a frame widget to act as the border of the clipper. 
-	    self._borderframe = self.createcomponent('borderframe',
-		    (), None,
-		    Tkinter.Frame, (self.origInterior,),
-		    relief = 'sunken',
-		    borderwidth = 2,
-	    )
-	    self._borderframe.grid(row = 2, column = 2, sticky = 'news')
-
-	    # Create the clipping window.
-	    self._clipper = self.createcomponent('clipper',
-		    (), None,
-		    Tkinter.Frame, (self._borderframe,),
-		    width = 400,
-		    height = 300,
-		    highlightthickness = 0,
-		    borderwidth = 0,
-	    )
-	    self._clipper.pack(fill = 'both', expand = 1)
-	else:
-	    # Create the clipping window.
-	    self._clipper = self.createcomponent('clipper',
-		    (), None,
-		    Tkinter.Frame, (self.origInterior,),
-		    width = 400,
-		    height = 300,
-		    relief = 'sunken',
-		    borderwidth = 2,
-	    )
-	    self._clipper.grid(row = 2, column = 2, sticky = 'news')
-
-	self.origInterior.grid_rowconfigure(2, weight = 1, minsize = 0)
-	self.origInterior.grid_columnconfigure(2, weight = 1, minsize = 0)
-	
-	# Create the horizontal scrollbar
-	self._horizScrollbar = self.createcomponent('horizscrollbar',
-		(), 'Scrollbar',
-		Tkinter.Scrollbar, (self.origInterior,),
-	        orient='horizontal',
-		command=self.xview
-	)
-
-	# Create the vertical scrollbar
-	self._vertScrollbar = self.createcomponent('vertscrollbar',
-		(), 'Scrollbar',
-		Tkinter.Scrollbar, (self.origInterior,),
-		orient='vertical',
-		command=self.yview
-	)
-
-	self.createlabel(self.origInterior, childCols = 3, childRows = 3)
-
-	# Initialise instance variables.
-	self._horizScrollbarOn = 0
-	self._vertScrollbarOn = 0
-	self.scrollTimer = None
-	self._scrollRecurse = 0
-	self._horizScrollbarNeeded = 0
-	self._vertScrollbarNeeded = 0
-	self.startX = 0
-	self.startY = 0
-	self._flexoptions = ('fixed', 'expand', 'shrink', 'elastic')
-
-	# Create a frame in the clipper to contain the widgets to be
-	# scrolled.
-	self._frame = self.createcomponent('frame',
-		(), None,
-		Tkinter.Frame, (self._clipper,)
-	)
-
-	# Whenever the clipping window or scrolled frame change size,
-	# update the scrollbars.
-	self._frame.bind('&lt;Configure&gt;', self._reposition)
-	self._clipper.bind('&lt;Configure&gt;', self._reposition)
-
-        # Work around a bug in Tk where the value returned by the
-        # scrollbar get() method is (0.0, 0.0, 0.0, 0.0) rather than
-        # the expected 2-tuple.  This occurs if xview() is called soon
-        # after the ScrolledFrame has been created.
-        self._horizScrollbar.set(0.0, 1.0)
-        self._vertScrollbar.set(0.0, 1.0)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	if self.scrollTimer is not None:
-	    self.after_cancel(self.scrollTimer)
-	    self.scrollTimer = None
-	MegaWidget.destroy(self)
-
-    # ======================================================================
-
-    # Public methods.
-
-    def interior(self):
-	return self._frame
-
-    # Set timer to call real reposition method, so that it is not
-    # called multiple times when many things are reconfigured at the
-    # same time.
-    def reposition(self):
-	if self.scrollTimer is None:
-	    self.scrollTimer = self.after_idle(self._scrollBothNow)
-
-    # Called when the user clicks in the horizontal scrollbar. 
-    # Calculates new position of frame then calls reposition() to
-    # update the frame and the scrollbar.
-    def xview(self, mode = None, value = None, units = None):
-
-        if type(value) == types.StringType:
-            value = string.atof(value)
-        if mode is None:
-            return self._horizScrollbar.get()
-	elif mode == 'moveto':
-	    frameWidth = self._frame.winfo_reqwidth()
-	    self.startX = value * float(frameWidth)
-	else: # mode == 'scroll'
-	    clipperWidth = self._clipper.winfo_width()
-	    if units == 'units':
-		jump = int(clipperWidth * self['horizfraction'])
-	    else:
-		jump = clipperWidth
-            self.startX = self.startX + value * jump
-
-	self.reposition()
-
-    # Called when the user clicks in the vertical scrollbar. 
-    # Calculates new position of frame then calls reposition() to
-    # update the frame and the scrollbar.
-    def yview(self, mode = None, value = None, units = None):
-
-        if type(value) == types.StringType:
-            value = string.atof(value)
-        if mode is None:
-            return self._vertScrollbar.get()
-	elif mode == 'moveto':
-	    frameHeight = self._frame.winfo_reqheight()
-	    self.startY = value * float(frameHeight)
-	else: # mode == 'scroll'
-	    clipperHeight = self._clipper.winfo_height()
-	    if units == 'units':
-		jump = int(clipperHeight * self['vertfraction'])
-	    else:
-		jump = clipperHeight
-            self.startY = self.startY + value * jump
-
-	self.reposition()
-
-    # ======================================================================
-
-    # Configuration methods.
-
-    def _hscrollMode(self):
-	# The horizontal scroll mode has been configured.
-
-	mode = self['hscrollmode']
-
-	if mode == 'static':
-	    if not self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	elif mode == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	elif mode == 'none':
-	    if self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	else:
-	    message = 'bad hscrollmode option &quot;%s&quot;: should be static, dynamic, or none' % mode
-	    raise ValueError, message
-
-    def _vscrollMode(self):
-	# The vertical scroll mode has been configured.
-
-	mode = self['vscrollmode']
-
-	if mode == 'static':
-	    if not self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	elif mode == 'dynamic':
-	    if self._vertScrollbarNeeded != self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	elif mode == 'none':
-	    if self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	else:
-	    message = 'bad vscrollmode option &quot;%s&quot;: should be static, dynamic, or none' % mode
-	    raise ValueError, message
-
-    def _horizflex(self):
-	# The horizontal flex mode has been configured.
-
-	flex = self['horizflex']
-
-	if flex not in self._flexoptions:
-	    message = 'bad horizflex option &quot;%s&quot;: should be one of %s' % \
-		    (flex, str(self._flexoptions))
-	    raise ValueError, message
-
-	self.reposition()
-
-    def _vertflex(self):
-	# The vertical flex mode has been configured.
-
-	flex = self['vertflex']
-
-	if flex not in self._flexoptions:
-	    message = 'bad vertflex option &quot;%s&quot;: should be one of %s' % \
-		    (flex, str(self._flexoptions))
-	    raise ValueError, message
-
-	self.reposition()
-
-    # ======================================================================
-
-    # Private methods.
-
-    def _reposition(self, event):
-	self.reposition()
-
-    def _getxview(self):
-
-	# Horizontal dimension.
-	clipperWidth = self._clipper.winfo_width()
-	frameWidth = self._frame.winfo_reqwidth()
-	if frameWidth &lt;= clipperWidth:
-	    # The scrolled frame is smaller than the clipping window.
-
-	    self.startX = 0
-	    endScrollX = 1.0
-
-	    if self['horizflex'] in ('expand', 'elastic'):
-		relwidth = 1
-	    else:
-		relwidth = ''
-	else:
-	    # The scrolled frame is larger than the clipping window.
-
-	    if self['horizflex'] in ('shrink', 'elastic'):
-		self.startX = 0
-		endScrollX = 1.0
-		relwidth = 1
-	    else:
-		if self.startX + clipperWidth &gt; frameWidth:
-		    self.startX = frameWidth - clipperWidth
-		    endScrollX = 1.0
-		else:
-		    if self.startX &lt; 0:
-			self.startX = 0
-		    endScrollX = (self.startX + clipperWidth) / float(frameWidth)
-		relwidth = ''
-
-	# Position frame relative to clipper.
-	self._frame.place(x = -self.startX, relwidth = relwidth)
-	return (self.startX / float(frameWidth), endScrollX)
-
-    def _getyview(self):
-
-	# Vertical dimension.
-	clipperHeight = self._clipper.winfo_height()
-	frameHeight = self._frame.winfo_reqheight()
-	if frameHeight &lt;= clipperHeight:
-	    # The scrolled frame is smaller than the clipping window.
-
-	    self.startY = 0
-	    endScrollY = 1.0
-
-	    if self['vertflex'] in ('expand', 'elastic'):
-		relheight = 1
-	    else:
-		relheight = ''
-	else:
-	    # The scrolled frame is larger than the clipping window.
-
-	    if self['vertflex'] in ('shrink', 'elastic'):
-		self.startY = 0
-		endScrollY = 1.0
-		relheight = 1
-	    else:
-		if self.startY + clipperHeight &gt; frameHeight:
-		    self.startY = frameHeight - clipperHeight
-		    endScrollY = 1.0
-		else:
-		    if self.startY &lt; 0:
-			self.startY = 0
-		    endScrollY = (self.startY + clipperHeight) / float(frameHeight)
-		relheight = ''
-
-	# Position frame relative to clipper.
-	self._frame.place(y = -self.startY, relheight = relheight)
-	return (self.startY / float(frameHeight), endScrollY)
-
-    # According to the relative geometries of the frame and the
-    # clipper, reposition the frame within the clipper and reset the
-    # scrollbars.
-    def _scrollBothNow(self):
-	self.scrollTimer = None
-
-        # Call update_idletasks to make sure that the containing frame
-        # has been resized before we attempt to set the scrollbars. 
-        # Otherwise the scrollbars may be mapped/unmapped continuously.
-        self._scrollRecurse = self._scrollRecurse + 1
-        self.update_idletasks()
-        self._scrollRecurse = self._scrollRecurse - 1
-        if self._scrollRecurse != 0:
-            return
-
-	xview = self._getxview()
-	yview = self._getyview()
-	self._horizScrollbar.set(xview[0], xview[1])
-	self._vertScrollbar.set(yview[0], yview[1])
-
-	self._horizScrollbarNeeded = (xview != (0.0, 1.0))
-	self._vertScrollbarNeeded = (yview != (0.0, 1.0))
-
-	# If both horizontal and vertical scrollmodes are dynamic and
-	# currently only one scrollbar is mapped and both should be
-	# toggled, then unmap the mapped scrollbar.  This prevents a
-	# continuous mapping and unmapping of the scrollbars. 
-	if (self['hscrollmode'] == self['vscrollmode'] == 'dynamic' and
-		self._horizScrollbarNeeded != self._horizScrollbarOn and
-		self._vertScrollbarNeeded != self._vertScrollbarOn and
-		self._vertScrollbarOn != self._horizScrollbarOn):
-	    if self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	    else:
-		self._toggleVertScrollbar()
-	    return
-
-	if self['hscrollmode'] == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-
-	if self['vscrollmode'] == 'dynamic':
-	    if self._vertScrollbarNeeded != self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-
-    def _toggleHorizScrollbar(self):
-
-	self._horizScrollbarOn = not self._horizScrollbarOn
-
-	interior = self.origInterior
-	if self._horizScrollbarOn:
-	    self._horizScrollbar.grid(row = 4, column = 2, sticky = 'news')
-	    interior.grid_rowconfigure(3, minsize = self['scrollmargin'])
-	else:
-	    self._horizScrollbar.grid_forget()
-	    interior.grid_rowconfigure(3, minsize = 0)
-
-    def _toggleVertScrollbar(self):
-
-	self._vertScrollbarOn = not self._vertScrollbarOn
-
-	interior = self.origInterior
-	if self._vertScrollbarOn:
-	    self._vertScrollbar.grid(row = 2, column = 4, sticky = 'news')
-	    interior.grid_columnconfigure(3, minsize = self['scrollmargin'])
-	else:
-	    self._vertScrollbar.grid_forget()
-	    interior.grid_columnconfigure(3, minsize = 0)
-
-######################################################################
-### File: PmwScrolledListBox.py
-# Based on iwidgets2.2.0/scrolledlistbox.itk code.
-
-import types
-import Tkinter
-
-
-class ScrolledListBox(MegaWidget):
-    _classBindingsDefinedFor = 0
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('dblclickcommand',    None,            None),
-	    ('hscrollmode',        'dynamic',       self._hscrollMode),
-	    ('items',              (),              INITOPT),
-	    ('labelmargin',        0,               INITOPT),
-	    ('labelpos',           None,            INITOPT),
-	    ('scrollmargin',       2,               INITOPT),
-	    ('selectioncommand',   None,            None),
-	    ('usehullsize',        0,               INITOPT),
-	    ('vscrollmode',        'dynamic',       self._vscrollMode),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-
-	if self['usehullsize']:
-	    interior.grid_propagate(0)
-
-	# Create the listbox widget.
-	self._listbox = self.createcomponent('listbox',
-		(), None,
-		Tkinter.Listbox, (interior,))
-	self._listbox.grid(row = 2, column = 2, sticky = 'news')
-	interior.grid_rowconfigure(2, weight = 1, minsize = 0)
-	interior.grid_columnconfigure(2, weight = 1, minsize = 0)
-
-	# Create the horizontal scrollbar
-	self._horizScrollbar = self.createcomponent('horizscrollbar',
-		(), 'Scrollbar',
-		Tkinter.Scrollbar, (interior,),
-	        orient='horizontal',
-		command=self._listbox.xview
-	)
-
-	# Create the vertical scrollbar
-	self._vertScrollbar = self.createcomponent('vertscrollbar',
-		(), 'Scrollbar',
-		Tkinter.Scrollbar, (interior,),
-		orient='vertical',
-		command=self._listbox.yview
-	)
-
-	self.createlabel(interior, childCols = 3, childRows = 3)
-
-	# Add the items specified by the initialisation option.
-	items = self['items']
-	if type(items) != types.TupleType:
-	    items = tuple(items)
-	if len(items) &gt; 0:
-	    apply(self._listbox.insert, ('end',) + items)
-
-	_registerScrolledList(self._listbox, self)
-
-        # Establish the special class bindings if not already done.
-        # Also create bindings if the Tkinter default interpreter has
-        # changed.  Use Tkinter._default_root to create class
-        # bindings, so that a reference to root is created by
-        # bind_class rather than a reference to self, which would
-        # prevent object cleanup.
-        theTag = 'ScrolledListBoxTag'
-        if ScrolledListBox._classBindingsDefinedFor != Tkinter._default_root:
-            root  = Tkinter._default_root
-	    	    
-            def doubleEvent(event):
-                _handleEvent(event, 'double')
-            def keyEvent(event):
-                _handleEvent(event, 'key')
-            def releaseEvent(event):
-                _handleEvent(event, 'release')
-
-            # Bind space and return keys and button 1 to the selectioncommand.
-            root.bind_class(theTag, '&lt;Key-space&gt;', keyEvent)
-            root.bind_class(theTag, '&lt;Key-Return&gt;', keyEvent)
-            root.bind_class(theTag, '&lt;ButtonRelease-1&gt;', releaseEvent)
-
-            # Bind double button 1 click to the dblclickcommand.
-            root.bind_class(theTag, '&lt;Double-ButtonRelease-1&gt;', doubleEvent)
-
-	    ScrolledListBox._classBindingsDefinedFor = root
-
-	bindtags = self._listbox.bindtags()
-	self._listbox.bindtags(bindtags + (theTag,))
-
-	# Initialise instance variables.
-	self._horizScrollbarOn = 0
-	self._vertScrollbarOn = 0
-	self.scrollTimer = None
-        self._scrollRecurse = 0
-	self._horizScrollbarNeeded = 0
-	self._vertScrollbarNeeded = 0
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	if self.scrollTimer is not None:
-	    self.after_cancel(self.scrollTimer)
-	    self.scrollTimer = None
-	_deregisterScrolledList(self._listbox)
-	MegaWidget.destroy(self)
-
-    # ======================================================================
-
-    # Public methods.
-
-    def clear(self):
-	self.setlist(())
-
-    def getcurselection(self):
-	rtn = []
-	for sel in self.curselection():
-	    rtn.append(self._listbox.get(sel))
-	return tuple(rtn)
-
-    def getvalue(self):
-        return self.getcurselection()
-
-    def setvalue(self, textOrList):
-        self._listbox.selection_clear(0, 'end')
-        listitems = list(self._listbox.get(0, 'end'))
-        if type(textOrList) == types.StringType:
-            if textOrList in listitems:
-                self._listbox.selection_set(listitems.index(textOrList))
-            else:
-                raise ValueError, 'no such item &quot;%s&quot;' % textOrList
-        else:
-            for item in textOrList:
-                if item in listitems:
-                    self._listbox.selection_set(listitems.index(item))
-                else:
-                    raise ValueError, 'no such item &quot;%s&quot;' % item
-
-    def setlist(self, items):
-        self._listbox.delete(0, 'end')
-	if len(items) &gt; 0:
-	    if type(items) != types.TupleType:
-		items = tuple(items)
-	    apply(self._listbox.insert, (0,) + items)
-
-    # Override Tkinter.Listbox get method, so that if it is called with
-    # no arguments, return all list elements (consistent with other widgets).
-    def get(self, first=None, last=None):
-	if first is None:
-	    return self._listbox.get(0, 'end')
-	else:
-	    return self._listbox.get(first, last)
-
-    # ======================================================================
-
-    # Configuration methods.
-
-    def _hscrollMode(self):
-	# The horizontal scroll mode has been configured.
-
-	mode = self['hscrollmode']
-
-	if mode == 'static':
-	    if not self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	elif mode == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	elif mode == 'none':
-	    if self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	else:
-	    message = 'bad hscrollmode option &quot;%s&quot;: should be static, dynamic, or none' % mode
-	    raise ValueError, message
-
-        self._configureScrollCommands()
-
-    def _vscrollMode(self):
-	# The vertical scroll mode has been configured.
-
-	mode = self['vscrollmode']
-
-	if mode == 'static':
-	    if not self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	elif mode == 'dynamic':
-	    if self._vertScrollbarNeeded != self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	elif mode == 'none':
-	    if self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	else:
-	    message = 'bad vscrollmode option &quot;%s&quot;: should be static, dynamic, or none' % mode
-	    raise ValueError, message
-
-        self._configureScrollCommands()
-
-    # ======================================================================
-
-    # Private methods.
-
-    def _configureScrollCommands(self):
-        # If both scrollmodes are not dynamic we can save a lot of
-        # time by not having to create an idle job to handle the
-        # scroll commands.
-
-        # Clean up previous scroll commands to prevent memory leak.
-        tclCommandName = str(self._listbox.cget('xscrollcommand'))
-        if tclCommandName != '':   
-            self._listbox.deletecommand(tclCommandName)
-        tclCommandName = str(self._listbox.cget('yscrollcommand'))
-        if tclCommandName != '':   
-            self._listbox.deletecommand(tclCommandName)
-
-	if self['hscrollmode'] == self['vscrollmode'] == 'dynamic':
-            self._listbox.configure(
-                    xscrollcommand=self._scrollBothLater,
-                    yscrollcommand=self._scrollBothLater
-            )
-        else:
-            self._listbox.configure(
-                    xscrollcommand=self._scrollXNow,
-                    yscrollcommand=self._scrollYNow
-            )
-
-    def _scrollXNow(self, first, last):
-        self._horizScrollbar.set(first, last)
-        self._horizScrollbarNeeded = ((first, last) != ('0', '1'))
-
-	if self['hscrollmode'] == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-
-    def _scrollYNow(self, first, last):
-        self._vertScrollbar.set(first, last)
-        self._vertScrollbarNeeded = ((first, last) != ('0', '1'))
-
-        if self['vscrollmode'] == 'dynamic':
-            if self._vertScrollbarNeeded != self._vertScrollbarOn:
-                self._toggleVertScrollbar()
-
-    def _scrollBothLater(self, first, last):
-	# Called by the listbox to set the horizontal or vertical
-	# scrollbar when it has scrolled or changed size or contents.
-
-	if self.scrollTimer is None:
-	    self.scrollTimer = self.after_idle(self._scrollBothNow)
-
-    def _scrollBothNow(self):
-        # This performs the function of _scrollXNow and _scrollYNow.
-        # If one is changed, the other should be updated to match.
-	self.scrollTimer = None
-
-        # Call update_idletasks to make sure that the containing frame
-        # has been resized before we attempt to set the scrollbars. 
-        # Otherwise the scrollbars may be mapped/unmapped continuously.
-        self._scrollRecurse = self._scrollRecurse + 1
-        self.update_idletasks()
-        self._scrollRecurse = self._scrollRecurse - 1
-        if self._scrollRecurse != 0:
-            return
-
-	xview = self._listbox.xview()
-	yview = self._listbox.yview()
-	self._horizScrollbar.set(xview[0], xview[1])
-	self._vertScrollbar.set(yview[0], yview[1])
-
-	self._horizScrollbarNeeded = (xview != (0.0, 1.0))
-	self._vertScrollbarNeeded = (yview != (0.0, 1.0))
-
-	# If both horizontal and vertical scrollmodes are dynamic and
-	# currently only one scrollbar is mapped and both should be
-	# toggled, then unmap the mapped scrollbar.  This prevents a
-	# continuous mapping and unmapping of the scrollbars. 
-	if (self['hscrollmode'] == self['vscrollmode'] == 'dynamic' and
-		self._horizScrollbarNeeded != self._horizScrollbarOn and
-		self._vertScrollbarNeeded != self._vertScrollbarOn and
-		self._vertScrollbarOn != self._horizScrollbarOn):
-	    if self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	    else:
-		self._toggleVertScrollbar()
-	    return
-
-	if self['hscrollmode'] == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-
-	if self['vscrollmode'] == 'dynamic':
-	    if self._vertScrollbarNeeded != self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-
-    def _toggleHorizScrollbar(self):
-
-	self._horizScrollbarOn = not self._horizScrollbarOn
-
-	interior = self.interior()
-	if self._horizScrollbarOn:
-	    self._horizScrollbar.grid(row = 4, column = 2, sticky = 'news')
-	    interior.grid_rowconfigure(3, minsize = self['scrollmargin'])
-	else:
-	    self._horizScrollbar.grid_forget()
-	    interior.grid_rowconfigure(3, minsize = 0)
-
-    def _toggleVertScrollbar(self):
-
-	self._vertScrollbarOn = not self._vertScrollbarOn
-
-	interior = self.interior()
-	if self._vertScrollbarOn:
-	    self._vertScrollbar.grid(row = 2, column = 4, sticky = 'news')
-	    interior.grid_columnconfigure(3, minsize = self['scrollmargin'])
-	else:
-	    self._vertScrollbar.grid_forget()
-	    interior.grid_columnconfigure(3, minsize = 0)
-
-    def _handleEvent(self, event, eventType):
-        if eventType == 'double':
-            command = self['dblclickcommand']
-        elif eventType == 'key':
-            command = self['selectioncommand']
-        else: #eventType == 'release'
-            # Do not execute the command if the mouse was released
-            # outside the listbox.
-            if (event.x &lt; 0 or self._listbox.winfo_width() &lt;= event.x or
-                    event.y &lt; 0 or self._listbox.winfo_height() &lt;= event.y):
-                return
-
-            command = self['selectioncommand']
-
-        if callable(command):
-            command()
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)size method inherited from Tkinter.Frame.Grid.
-    def size(self):
-	return self._listbox.size()
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)bbox method inherited from Tkinter.Frame.Grid.
-    def bbox(self, index):
-	return self._listbox.bbox(index)
-
-forwardmethods(ScrolledListBox, Tkinter.Listbox, '_listbox')
-
-# ======================================================================
-
-_listboxCache = {}
-
-def _registerScrolledList(listbox, scrolledList):
-    # Register an ScrolledList widget for a Listbox widget
-
-    _listboxCache[listbox] = scrolledList
-
-def _deregisterScrolledList(listbox):
-    # Deregister a Listbox widget
-    del _listboxCache[listbox]
-
-def _handleEvent(event, eventType):
-    # Forward events for a Listbox to it's ScrolledListBox
-
-    # A binding earlier in the bindtags list may have destroyed the
-    # megawidget, so need to check.
-    if _listboxCache.has_key(event.widget):
-        _listboxCache[event.widget]._handleEvent(event, eventType)
-
-######################################################################
-### File: PmwScrolledText.py
-# Based on iwidgets2.2.0/scrolledtext.itk code.   
-
-import Tkinter
-
-
-class ScrolledText(MegaWidget):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderframe',    0,            INITOPT),
-	    ('columnheader',   0,            INITOPT),
-	    ('hscrollmode',    'dynamic',    self._hscrollMode),
-	    ('labelmargin',    0,            INITOPT),
-	    ('labelpos',       None,         INITOPT),
-	    ('rowcolumnheader',0,            INITOPT),
-	    ('rowheader',      0,            INITOPT),
-	    ('scrollmargin',   2,            INITOPT),
-	    ('usehullsize',    0,            INITOPT),
-	    ('vscrollmode',    'dynamic',    self._vscrollMode),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-
-	if self['usehullsize']:
-	    interior.grid_propagate(0)
-
-	if self['borderframe']:
-	    # Create a frame widget to act as the border of the text 
-	    # widget.  Later, pack the text widget so that it fills
-	    # the frame.  This avoids a problem in Tk, where window
-	    # items in a text widget may overlap the border of the
-	    # text widget.
-	    self._borderframe = self.createcomponent('borderframe',
-		    (), None,
-		    Tkinter.Frame, (interior,),
-		    relief = 'sunken',
-		    borderwidth = 2,
-	    )
-	    self._borderframe.grid(row = 4, column = 4, sticky = 'news')
-
-	    # Create the text widget.
-	    self._textbox = self.createcomponent('text',
-		    (), None,
-		    Tkinter.Text, (self._borderframe,),
-		    highlightthickness = 0,
-		    borderwidth = 0,
-	    )
-	    self._textbox.pack(fill = 'both', expand = 1)
-
-            bw = self._borderframe.cget('borderwidth'),
-            ht = self._borderframe.cget('highlightthickness'),
-	else:
-	    # Create the text widget.
-	    self._textbox = self.createcomponent('text',
-		    (), None,
-		    Tkinter.Text, (interior,),
-	    )
-	    self._textbox.grid(row = 4, column = 4, sticky = 'news')
-
-            bw = self._textbox.cget('borderwidth'),
-            ht = self._textbox.cget('highlightthickness'),
-
-        # Create the header text widgets
-        if self['columnheader']:
-            self._columnheader = self.createcomponent('columnheader',
-                    (), 'Header',
-                    Tkinter.Text, (interior,),
-                    height=1,
-                    wrap='none',
-                    borderwidth = bw,
-                    highlightthickness = ht,
-            )
-            self._columnheader.grid(row = 2, column = 4, sticky = 'ew')
-            self._columnheader.configure(
-                    xscrollcommand = self._columnheaderscrolled)
-
-        if self['rowheader']:
-            self._rowheader = self.createcomponent('rowheader',
-                    (), 'Header',
-                    Tkinter.Text, (interior,),
-                    wrap='none',
-                    borderwidth = bw,
-                    highlightthickness = ht,
-            )
-            self._rowheader.grid(row = 4, column = 2, sticky = 'ns')
-            self._rowheader.configure(
-                    yscrollcommand = self._rowheaderscrolled)
-
-        if self['rowcolumnheader']:
-            self._rowcolumnheader = self.createcomponent('rowcolumnheader',
-                    (), 'Header',
-                    Tkinter.Text, (interior,),
-                    height=1,
-                    wrap='none',
-                    borderwidth = bw,
-                    highlightthickness = ht,
-            )
-            self._rowcolumnheader.grid(row = 2, column = 2, sticky = 'nsew')
-
-	interior.grid_rowconfigure(4, weight = 1, minsize = 0)
-	interior.grid_columnconfigure(4, weight = 1, minsize = 0)
-
-	# Create the horizontal scrollbar
-	self._horizScrollbar = self.createcomponent('horizscrollbar',
-		(), 'Scrollbar',
-		Tkinter.Scrollbar, (interior,),
-	        orient='horizontal',
-		command=self._textbox.xview
-	)
-
-	# Create the vertical scrollbar
-	self._vertScrollbar = self.createcomponent('vertscrollbar',
-		(), 'Scrollbar',
-		Tkinter.Scrollbar, (interior,),
-		orient='vertical',
-		command=self._textbox.yview
-	)
-
-	self.createlabel(interior, childCols = 5, childRows = 5)
-
-	# Initialise instance variables.
-	self._horizScrollbarOn = 0
-	self._vertScrollbarOn = 0
-	self.scrollTimer = None
-        self._scrollRecurse = 0
-	self._horizScrollbarNeeded = 0
-	self._vertScrollbarNeeded = 0
-	self._textWidth = None
-
-        # These four variables avoid an infinite loop caused by the
-        # row or column header's scrollcommand causing the main text
-        # widget's scrollcommand to be called and vice versa.
-	self._textboxLastX = None
-	self._textboxLastY = None
-	self._columnheaderLastX = None
-	self._rowheaderLastY = None
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	if self.scrollTimer is not None:
-	    self.after_cancel(self.scrollTimer)
-	    self.scrollTimer = None
-	MegaWidget.destroy(self)
-
-    # ======================================================================
-
-    # Public methods.
-
-    def clear(self):
-	self.settext('')
-
-    def importfile(self, fileName, where = 'end'):
-	file = open(fileName, 'r')
-	self._textbox.insert(where, file.read())
-	file.close()
-
-    def exportfile(self, fileName):
-	file = open(fileName, 'w')
-	file.write(self._textbox.get('1.0', 'end'))
-	file.close()
-
-    def settext(self, text):
-	disabled = (str(self._textbox.cget('state')) == 'disabled')
-	if disabled:
-	    self._textbox.configure(state='normal')
-	self._textbox.delete('0.0', 'end')
-	self._textbox.insert('end', text)
-	if disabled:
-	    self._textbox.configure(state='disabled')
-
-    # Override Tkinter.Text get method, so that if it is called with
-    # no arguments, return all text (consistent with other widgets).
-    def get(self, first=None, last=None):
-	if first is None:
-	    return self._textbox.get('1.0', 'end')
-	else:
-	    return self._textbox.get(first, last)
-
-    def getvalue(self):
-        return self.get()
-
-    def setvalue(self, text):
-        return self.settext(text)
-
-    def appendtext(self, text):
-        oldTop, oldBottom = self._textbox.yview()
-     
-        disabled = (str(self._textbox.cget('state')) == 'disabled')
-        if disabled:
-            self._textbox.configure(state='normal')
-        self._textbox.insert('end', text)
-        if disabled:
-            self._textbox.configure(state='disabled')
-     
-        if oldBottom == 1.0:
-            self._textbox.yview('moveto', 1.0)
-
-    # ======================================================================
-
-    # Configuration methods.
-
-    def _hscrollMode(self):
-	# The horizontal scroll mode has been configured.
-
-	mode = self['hscrollmode']
-
-	if mode == 'static':
-	    if not self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	elif mode == 'dynamic':
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	elif mode == 'none':
-	    if self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	else:
-	    message = 'bad hscrollmode option &quot;%s&quot;: should be static, dynamic, or none' % mode
-	    raise ValueError, message
-
-        self._configureScrollCommands()
-
-    def _vscrollMode(self):
-	# The vertical scroll mode has been configured.
-
-	mode = self['vscrollmode']
-
-	if mode == 'static':
-	    if not self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	elif mode == 'dynamic':
-	    if self._vertScrollbarNeeded != self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	elif mode == 'none':
-	    if self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-	else:
-	    message = 'bad vscrollmode option &quot;%s&quot;: should be static, dynamic, or none' % mode
-	    raise ValueError, message
-
-        self._configureScrollCommands()
-
-    # ======================================================================
-
-    # Private methods.
-
-    def _configureScrollCommands(self):
-        # If both scrollmodes are not dynamic we can save a lot of
-        # time by not having to create an idle job to handle the
-        # scroll commands.
-
-        # Clean up previous scroll commands to prevent memory leak.
-        tclCommandName = str(self._textbox.cget('xscrollcommand'))
-        if tclCommandName != '':   
-            self._textbox.deletecommand(tclCommandName)
-        tclCommandName = str(self._textbox.cget('yscrollcommand'))
-        if tclCommandName != '':   
-            self._textbox.deletecommand(tclCommandName)
-
-	if self['hscrollmode'] == self['vscrollmode'] == 'dynamic':
-            self._textbox.configure(
-                    xscrollcommand=self._scrollBothLater,
-                    yscrollcommand=self._scrollBothLater
-            )
-        else:
-            self._textbox.configure(
-                    xscrollcommand=self._scrollXNow,
-                    yscrollcommand=self._scrollYNow
-            )
-
-    def _scrollXNow(self, first, last):
-        self._horizScrollbar.set(first, last)
-        self._horizScrollbarNeeded = ((first, last) != ('0', '1'))
-
-        # This code is the same as in _scrollBothNow.  Keep it that way.
-        if self['hscrollmode'] == 'dynamic':
-            currentWidth = self._textbox.winfo_width()
-            if self._horizScrollbarNeeded != self._horizScrollbarOn:
-                if self._horizScrollbarNeeded or \
-                        self._textWidth != currentWidth:
-                    self._toggleHorizScrollbar()
-            self._textWidth = currentWidth
-
-        if self['columnheader']:
-	    if self._columnheaderLastX != first:
-		self._columnheaderLastX = first
-		self._columnheader.xview('moveto', first)
-
-    def _scrollYNow(self, first, last):
-        if first == '0' and last == '0':
-            return
-        self._vertScrollbar.set(first, last)
-        self._vertScrollbarNeeded = ((first, last) != ('0', '1'))
-
-        if self['vscrollmode'] == 'dynamic':
-            if self._vertScrollbarNeeded != self._vertScrollbarOn:
-                self._toggleVertScrollbar()
-
-        if self['rowheader']:
-	    if self._rowheaderLastY != first:
-		self._rowheaderLastY = first
-		self._rowheader.yview('moveto', first)
-
-    def _scrollBothLater(self, first, last):
-	# Called by the text widget to set the horizontal or vertical
-	# scrollbar when it has scrolled or changed size or contents.
-
-	if self.scrollTimer is None:
-	    self.scrollTimer = self.after_idle(self._scrollBothNow)
-
-    def _scrollBothNow(self):
-        # This performs the function of _scrollXNow and _scrollYNow.
-        # If one is changed, the other should be updated to match.
-	self.scrollTimer = None
-
-        # Call update_idletasks to make sure that the containing frame
-        # has been resized before we attempt to set the scrollbars. 
-        # Otherwise the scrollbars may be mapped/unmapped continuously.
-        self._scrollRecurse = self._scrollRecurse + 1
-        self.update_idletasks()
-        self._scrollRecurse = self._scrollRecurse - 1
-        if self._scrollRecurse != 0:
-            return
-
-	xview = self._textbox.xview()
-	yview = self._textbox.yview()
-
-	# The text widget returns a yview of (0.0, 0.0) just after it
-	# has been created. Ignore this.
-	if yview == (0.0, 0.0):
-	    return
-
-        if self['columnheader']:
-	    if self._columnheaderLastX != xview[0]:
-		self._columnheaderLastX = xview[0]
-		self._columnheader.xview('moveto', xview[0])
-        if self['rowheader']:
-	    if self._rowheaderLastY != yview[0]:
-		self._rowheaderLastY = yview[0]
-		self._rowheader.yview('moveto', yview[0])
-
-	self._horizScrollbar.set(xview[0], xview[1])
-	self._vertScrollbar.set(yview[0], yview[1])
-
-	self._horizScrollbarNeeded = (xview != (0.0, 1.0))
-	self._vertScrollbarNeeded = (yview != (0.0, 1.0))
-
-	# If both horizontal and vertical scrollmodes are dynamic and
-	# currently only one scrollbar is mapped and both should be
-	# toggled, then unmap the mapped scrollbar.  This prevents a
-	# continuous mapping and unmapping of the scrollbars. 
-	if (self['hscrollmode'] == self['vscrollmode'] == 'dynamic' and
-		self._horizScrollbarNeeded != self._horizScrollbarOn and
-		self._vertScrollbarNeeded != self._vertScrollbarOn and
-		self._vertScrollbarOn != self._horizScrollbarOn):
-	    if self._horizScrollbarOn:
-		self._toggleHorizScrollbar()
-	    else:
-		self._toggleVertScrollbar()
-	    return
-
-	if self['hscrollmode'] == 'dynamic':
-
-	    # The following test is done to prevent continuous
-	    # mapping and unmapping of the horizontal scrollbar. 
-	    # This may occur when some event (scrolling, resizing
-	    # or text changes) modifies the displayed text such
-	    # that the bottom line in the window is the longest
-	    # line displayed.  If this causes the horizontal
-	    # scrollbar to be mapped, the scrollbar may &quot;cover up&quot;
-	    # the bottom line, which would mean that the scrollbar
-	    # is no longer required.  If the scrollbar is then
-	    # unmapped, the bottom line will then become visible
-	    # again, which would cause the scrollbar to be mapped
-	    # again, and so on...
-	    #
-	    # The idea is that, if the width of the text widget
-	    # has not changed and the scrollbar is currently
-	    # mapped, then do not unmap the scrollbar even if it
-	    # is no longer required.  This means that, during
-	    # normal scrolling of the text, once the horizontal
-	    # scrollbar has been mapped it will not be unmapped
-	    # (until the width of the text widget changes).
-
-	    currentWidth = self._textbox.winfo_width()
-	    if self._horizScrollbarNeeded != self._horizScrollbarOn:
-		if self._horizScrollbarNeeded or \
-			self._textWidth != currentWidth:
-		    self._toggleHorizScrollbar()
-	    self._textWidth = currentWidth
-
-	if self['vscrollmode'] == 'dynamic':
-	    if self._vertScrollbarNeeded != self._vertScrollbarOn:
-		self._toggleVertScrollbar()
-
-    def _columnheaderscrolled(self, first, last):
-	if self._textboxLastX != first:
-	    self._textboxLastX = first
-	    self._textbox.xview('moveto', first)
-
-    def _rowheaderscrolled(self, first, last):
-	if self._textboxLastY != first:
-	    self._textboxLastY = first
-	    self._textbox.yview('moveto', first)
-
-    def _toggleHorizScrollbar(self):
-
-	self._horizScrollbarOn = not self._horizScrollbarOn
-
-	interior = self.interior()
-	if self._horizScrollbarOn:
-	    self._horizScrollbar.grid(row = 6, column = 4, sticky = 'news')
-	    interior.grid_rowconfigure(5, minsize = self['scrollmargin'])
-	else:
-	    self._horizScrollbar.grid_forget()
-	    interior.grid_rowconfigure(5, minsize = 0)
-
-    def _toggleVertScrollbar(self):
-
-	self._vertScrollbarOn = not self._vertScrollbarOn
-
-	interior = self.interior()
-	if self._vertScrollbarOn:
-	    self._vertScrollbar.grid(row = 4, column = 6, sticky = 'news')
-	    interior.grid_columnconfigure(5, minsize = self['scrollmargin'])
-	else:
-	    self._vertScrollbar.grid_forget()
-	    interior.grid_columnconfigure(5, minsize = 0)
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)bbox method inherited from Tkinter.Frame.Grid.
-    def bbox(self, index):
-	return self._textbox.bbox(index)
-
-forwardmethods(ScrolledText, Tkinter.Text, '_textbox')
-
-######################################################################
-### File: PmwHistoryText.py
-
-
-_ORIGINAL = 0
-_MODIFIED = 1
-_DISPLAY = 2
-
-class HistoryText(ScrolledText):
-
-    def __init__(self, parent = None, **kw):
-
-        # Define the megawidget options.
-        optiondefs = (
-	    ('compressany',         1,          None),
-	    ('compresstail',        1,          None),
-            ('historycommand',      None,       None),
-        )
-        self.defineoptions(kw, optiondefs)
-
-        # Initialise the base class (after defining the options).
-        ScrolledText.__init__(self, parent)
-
-        # Initialise instance variables.
-	self._list = []
-	self._currIndex = 0
-	self._pastIndex = None
-	self._lastIndex = 0          # pointer to end of history list
-
-        # Check keywords and initialise options.
-        self.initialiseoptions()
-
-    def addhistory(self):
-	text = self.get()
-	if text[-1] == '\n':
-	    text = text[:-1]
-
-	if len(self._list) == 0:
-            # This is the first history entry.  Add it.
-	    self._list.append([text, text, _MODIFIED])
-            return
-
-        currentEntry =  self._list[self._currIndex]
-        if text == currentEntry[_ORIGINAL]:
-            # The current history entry has not been modified. Check if
-            # we need to add it again.
-
-            if self['compresstail'] and self._currIndex == self._lastIndex:
-                return
-
-            if self['compressany']:
-                return
-
-        # Undo any changes for the current history entry, since they
-        # will now be available in the new entry.
-        currentEntry[_MODIFIED] = currentEntry[_ORIGINAL]
-
-        historycommand = self['historycommand']
-        if self._currIndex == self._lastIndex:
-            # The last history entry is currently being displayed,
-            # so disable the special meaning of the 'Next' button.
-            self._pastIndex = None
-            nextState = 'disabled'
-        else:
-            # A previous history entry is currently being displayed,
-            # so allow the 'Next' button to go to the entry after this one.
-            self._pastIndex = self._currIndex
-            nextState = 'normal'
-        if callable(historycommand):
-            historycommand('normal', nextState)
-
-        # Create the new history entry.
-        self._list.append([text, text, _MODIFIED])
-
-        # Move the pointer into the history entry list to the end.
-        self._lastIndex = self._lastIndex + 1
-        self._currIndex = self._lastIndex
-
-    def next(self):
-	if self._currIndex == self._lastIndex and self._pastIndex is None:
-	    self.bell()
-        else:
-            self._modifyDisplay('next')
-
-    def prev(self):
-        self._pastIndex = None
-	if self._currIndex == 0:
-	    self.bell()
-        else:
-            self._modifyDisplay('prev')
-
-    def undo(self):
-	if len(self._list) != 0:
-            self._modifyDisplay('undo')
-
-    def redo(self):
-	if len(self._list) != 0:
-            self._modifyDisplay('redo')
-
-    def gethistory(self):
-        return self._list
-
-    def _modifyDisplay(self, command):
-        # Modify the display to show either the next or previous
-        # history entry (next, prev) or the original or modified
-        # version of the current history entry (undo, redo).
-
-        # Save the currently displayed text.
-        currentText = self.get()
-        if currentText[-1] == '\n':
-            currentText = currentText[:-1]
-
-        currentEntry =  self._list[self._currIndex]
-        if currentEntry[_DISPLAY] == _MODIFIED:
-            currentEntry[_MODIFIED] = currentText
-        elif currentEntry[_ORIGINAL] != currentText:
-            currentEntry[_MODIFIED] = currentText
-            if command in ('next', 'prev'):
-                currentEntry[_DISPLAY] = _MODIFIED
-
-        if command in ('next', 'prev'):
-            prevstate = 'normal'
-            nextstate = 'normal'
-            if command == 'next':
-                if self._pastIndex is not None:
-                    self._currIndex = self._pastIndex
-                    self._pastIndex = None
-                self._currIndex = self._currIndex + 1
-                if self._currIndex == self._lastIndex:
-                    nextstate = 'disabled'
-            elif command == 'prev':
-                self._currIndex = self._currIndex - 1
-                if self._currIndex == 0:
-                    prevstate = 'disabled'
-            historycommand = self['historycommand']
-            if callable(historycommand):
-                historycommand(prevstate, nextstate)
-            currentEntry =  self._list[self._currIndex]
-        else:
-            if command == 'undo':
-                currentEntry[_DISPLAY] = _ORIGINAL
-            elif command == 'redo':
-                currentEntry[_DISPLAY] = _MODIFIED
-
-        # Display the new text.
-        self.delete('1.0', 'end')
-        self.insert('end', currentEntry[currentEntry[_DISPLAY]])
-
-######################################################################
-### File: PmwSelectionDialog.py
-# Not Based on iwidgets version.
-
-
-
-class SelectionDialog(Dialog):
-    # Dialog window with selection list.
-    
-    # Dialog window displaying a list and requesting the user to
-    # select one.
-
-    def __init__(self, parent = None, **kw):
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderx',     10,    INITOPT),
-	    ('bordery',     10,    INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	Dialog.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-	aliases = (
-	    ('listbox', 'scrolledlist_listbox'),
-	    ('label', 'scrolledlist_label'),
-	)
-	self._list = self.createcomponent('scrolledlist',
-		aliases, None,
-		ScrolledListBox, (interior,),
-		dblclickcommand = self.invoke)
-	self._list.pack(side='top', expand='true', fill='both',
-		padx = self['borderx'], pady = self['bordery'])
-
-        if not kw.has_key('activatecommand'):
-            # Whenever this dialog is activated, set the focus to the
-            # ScrolledListBox's listbox widget.
-            listbox = self.component('listbox')
-            self.configure(activatecommand = listbox.focus_set)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)size method inherited from Tkinter.Toplevel.Grid.
-    def size(self):
-	return self.component('listbox').size()
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)bbox method inherited from Tkinter.Toplevel.Grid.
-    def bbox(self, index):
-	return self.component('listbox').size(index)
-
-forwardmethods(SelectionDialog, ScrolledListBox, '_list')
-
-######################################################################
-### File: PmwTextDialog.py
-# A Dialog with a ScrolledText widget.
-
-
-
-class TextDialog(Dialog):
-    def __init__(self, parent = None, **kw):
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderx',     10,    INITOPT),
-	    ('bordery',     10,    INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	Dialog.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-	aliases = (
-	    ('text', 'scrolledtext_text'),
-	    ('label', 'scrolledtext_label'),
-	)
-	self._text = self.createcomponent('scrolledtext',
-		aliases, None,
-		ScrolledText, (interior,))
-	self._text.pack(side='top', expand=1, fill='both',
-		padx = self['borderx'], pady = self['bordery'])
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)bbox method inherited from Tkinter.Toplevel.Grid.
-    def bbox(self, index):
-	return self._text.bbox(index)
-
-forwardmethods(TextDialog, ScrolledText, '_text')
-
-######################################################################
-### File: PmwTimeCounter.py
-# Authors: Joe VanAndel and Greg McFarlane
-
-import string
-import sys
-import time
-import Tkinter
-
-
-class TimeCounter(MegaWidget):
-    &quot;&quot;&quot;Up-down counter
-
-    A TimeCounter is a single-line entry widget with Up and Down arrows
-    which increment and decrement the Time value in the entry.  
-    &quot;&quot;&quot;
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('autorepeat',    1,    None),
-	    ('buttonaspect',  1.0,  INITOPT),
-	    ('command',       None, None),
-	    ('initwait',      300,  None),
-	    ('labelmargin',   0,    INITOPT),
-	    ('labelpos',      None, INITOPT),
-	    ('max',           None, self._max),
-	    ('min',           None, self._min),
-	    ('padx',          0,    INITOPT),
-	    ('pady',          0,    INITOPT),
-	    ('repeatrate',    50,   None),
-	    ('value',         None, INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-    	self.arrowDirection = {}
-	self._flag = 'stopped'
-	self._timerId = None
-
-	self._createComponents(kw)
-
-	value = self['value']
-	if value is None:
-	    now = time.time()
-	    value = time.strftime('%H:%M:%S', time.localtime(now))
-    	self.setvalue(value)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def _createComponents(self, kw):
-
-	# Create the components.
-	interior = self.interior()
-
-	# If there is no label, put the arrows and the entry directly
-	# into the interior, otherwise create a frame for them.  In
-	# either case the border around the arrows and the entry will
-	# be raised (but not around the label).
-	if self['labelpos'] is None:
-	    frame = interior
-            if not kw.has_key('hull_relief'):
-                frame.configure(relief = 'raised')
-            if not kw.has_key('hull_borderwidth'):
-                frame.configure(borderwidth = 1)
-	else:
-	    frame = self.createcomponent('frame',
-		    (), None,
-		    Tkinter.Frame, (interior,),
-                    relief = 'raised', borderwidth = 1)
-	    frame.grid(column=2, row=2, sticky='nsew')
-	    interior.grid_columnconfigure(2, weight=1)
-	    interior.grid_rowconfigure(2, weight=1)
-
-	# Create the down arrow buttons.
-
-	# Create the hour down arrow.
-	self._downHourArrowBtn = self.createcomponent('downhourarrow',
-		(), 'Arrow',
-		Tkinter.Canvas, (frame,),
-		width = 16, height = 16, relief = 'raised', borderwidth = 2)
-    	self.arrowDirection[self._downHourArrowBtn] = 'down'
-	self._downHourArrowBtn.grid(column = 0, row = 2)
-
-	# Create the minute down arrow.
-	self._downMinuteArrowBtn = self.createcomponent('downminutearrow',
-		(), 'Arrow',
-		Tkinter.Canvas, (frame,),
-		width = 16, height = 16, relief = 'raised', borderwidth = 2)
-    	self.arrowDirection[self._downMinuteArrowBtn] = 'down'
-	self._downMinuteArrowBtn.grid(column = 1, row = 2)
-
-	# Create the second down arrow.
-	self._downSecondArrowBtn = self.createcomponent('downsecondarrow',
-		(), 'Arrow',
-		Tkinter.Canvas, (frame,),
-		width = 16, height = 16, relief = 'raised', borderwidth = 2)
-    	self.arrowDirection[self._downSecondArrowBtn] = 'down'
-	self._downSecondArrowBtn.grid(column = 2, row = 2)
-
-	# Create the entry fields.
-
-	# Create the hour entry field.
-	self._hourCounterEntry = self.createcomponent('hourentryfield',
-		(('hourentry', 'hourentryfield_entry'),), None,
-		EntryField, (frame,), validate='integer', entry_width = 2)
-	self._hourCounterEntry.grid(column = 0, row = 1, sticky = 'news')
-
-	# Create the minute entry field.
-	self._minuteCounterEntry = self.createcomponent('minuteentryfield',
-		(('minuteentry', 'minuteentryfield_entry'),), None,
-		EntryField, (frame,), validate='integer', entry_width = 2)
-	self._minuteCounterEntry.grid(column = 1, row = 1, sticky = 'news')
-
-	# Create the second entry field.
-	self._secondCounterEntry = self.createcomponent('secondentryfield',
-		(('secondentry', 'secondentryfield_entry'),), None,
-		EntryField, (frame,), validate='integer', entry_width = 2)
-	self._secondCounterEntry.grid(column = 2, row = 1, sticky = 'news')
-
-	# Create the up arrow buttons.
-
-	# Create the hour up arrow.
-	self._upHourArrowBtn = self.createcomponent('uphourarrow',
-		(), 'Arrow',
-		Tkinter.Canvas, (frame,),
-		width = 16, height = 16, relief = 'raised', borderwidth = 2)
-    	self.arrowDirection[self._upHourArrowBtn] = 'up'
-	self._upHourArrowBtn.grid(column = 0, row = 0)
-
-	# Create the minute up arrow.
-	self._upMinuteArrowBtn = self.createcomponent('upminutearrow',
-		(), 'Arrow',
-		Tkinter.Canvas, (frame,),
-		width = 16, height = 16, relief = 'raised', borderwidth = 2)
-    	self.arrowDirection[self._upMinuteArrowBtn] = 'up'
-	self._upMinuteArrowBtn.grid(column = 1, row = 0)
-
-	# Create the second up arrow.
-	self._upSecondArrowBtn = self.createcomponent('upsecondarrow',
-		(), 'Arrow',
-		Tkinter.Canvas, (frame,),
-		width = 16, height = 16, relief = 'raised', borderwidth = 2)
-    	self.arrowDirection[self._upSecondArrowBtn] = 'up'
-	self._upSecondArrowBtn.grid(column = 2, row = 0)
-
-	# Make it resize nicely.
-	padx = self['padx']
-	pady = self['pady']
-	for col in range(3):
-	    frame.grid_columnconfigure(col, weight = 1, pad = padx)
-	frame.grid_rowconfigure(0, pad = pady)
-	frame.grid_rowconfigure(2, pad = pady)
-
-	frame.grid_rowconfigure(1, weight = 1)
-
-	# Create the label.
-	self.createlabel(interior)
-
-	# Set bindings.
-
-	# Up hour
-	self._upHourArrowBtn.bind('&lt;Configure&gt;', 
-		lambda  event, s=self,button=self._upHourArrowBtn: 
-		s._drawArrow(button, 'up'))
-
-	self._upHourArrowBtn.bind('&lt;1&gt;', 
-    	    	lambda event, s=self,button=self._upHourArrowBtn: 
-		s._countUp(button, 3600))
-
-	self._upHourArrowBtn.bind('&lt;Any-ButtonRelease-1&gt;', 
-		lambda event, s=self, button=self._upHourArrowBtn:
-		s._stopUpDown(button))
-
-	# Up minute
-	self._upMinuteArrowBtn.bind('&lt;Configure&gt;', 
-		lambda  event, s=self,button=self._upMinuteArrowBtn: 
-		s._drawArrow(button, 'up'))
-	    
-
-	self._upMinuteArrowBtn.bind('&lt;1&gt;', 
-    	    	lambda event, s=self,button=self._upMinuteArrowBtn: 
-		s._countUp(button, 60))
-
-	self._upMinuteArrowBtn.bind('&lt;Any-ButtonRelease-1&gt;', 
-		lambda event, s=self, button=self._upMinuteArrowBtn:
-		s._stopUpDown(button))
-
-	# Up second
-	self._upSecondArrowBtn.bind('&lt;Configure&gt;', 
-		lambda  event, s=self,button=self._upSecondArrowBtn: 
-		s._drawArrow(button, 'up'))
-	    
-
-	self._upSecondArrowBtn.bind('&lt;1&gt;', 
-    	    	lambda event, s=self,button=self._upSecondArrowBtn: 
-		s._countUp(button, 1))
-
-	self._upSecondArrowBtn.bind('&lt;Any-ButtonRelease-1&gt;', 
-		lambda event, s=self, button=self._upSecondArrowBtn:
-		s._stopUpDown(button))
-
-	# Down hour
-	self._downHourArrowBtn.bind('&lt;Configure&gt;', 
-		lambda  event, s=self,button=self._downHourArrowBtn: 
-		s._drawArrow(button, 'down'))
-
-	self._downHourArrowBtn.bind('&lt;1&gt;', 
-    	    	lambda event, s=self,button=self._downHourArrowBtn: 
-		s._countDown(button, 3600))
-	self._downHourArrowBtn.bind('&lt;Any-ButtonRelease-1&gt;', 
-		lambda event, s=self, button=self._downHourArrowBtn:
-		s._stopUpDown(button))
-
-
-	# Down minute
-	self._downMinuteArrowBtn.bind('&lt;Configure&gt;', 
-		lambda  event, s=self,button=self._downMinuteArrowBtn: 
-		s._drawArrow(button, 'down'))
-
-	self._downMinuteArrowBtn.bind('&lt;1&gt;', 
-    	    	lambda event, s=self,button=self._downMinuteArrowBtn:
-                s._countDown(button, 60))
-	self._downMinuteArrowBtn.bind('&lt;Any-ButtonRelease-1&gt;', 
-		lambda event, s=self, button=self._downMinuteArrowBtn:
-		s._stopUpDown(button))
-
-	# Down second
-	self._downSecondArrowBtn.bind('&lt;Configure&gt;', 
-		lambda  event, s=self,button=self._downSecondArrowBtn: 
-		s._drawArrow(button, 'down'))
-
-	self._downSecondArrowBtn.bind('&lt;1&gt;', 
-    	    	lambda event, s=self, button=self._downSecondArrowBtn: 
-		s._countDown(button,1))
-	self._downSecondArrowBtn.bind('&lt;Any-ButtonRelease-1&gt;', 
-		lambda event, s=self, button=self._downSecondArrowBtn:
-		s._stopUpDown(button))
-
-	self._hourCounterEntry.component('entry').bind(
-                '&lt;Return&gt;', self._invoke)
-	self._minuteCounterEntry.component('entry').bind(
-        	'&lt;Return&gt;', self._invoke)
-	self._secondCounterEntry.component('entry').bind(
-        	'&lt;Return&gt;', self._invoke)
-
-	self._hourCounterEntry.bind('&lt;Configure&gt;', self._resizeArrow)
-	self._minuteCounterEntry.bind('&lt;Configure&gt;', self._resizeArrow)
-	self._secondCounterEntry.bind('&lt;Configure&gt;', self._resizeArrow)
-
-    def _drawArrow(self, arrow, direction):
-        drawarrow(arrow, self['hourentry_foreground'], direction, 'arrow')
-
-    def _resizeArrow(self, event = None):
-	for btn in (self._upHourArrowBtn, self._upMinuteArrowBtn,
-		self._upSecondArrowBtn,
-		self._downHourArrowBtn,
-		self._downMinuteArrowBtn, self._downSecondArrowBtn):
-	    bw = (string.atoi(btn['borderwidth']) +
-		    string.atoi(btn['highlightthickness']))
-	    newHeight = self._hourCounterEntry.winfo_reqheight() - 2 * bw
-	    newWidth = int(newHeight * self['buttonaspect'])
-	    btn.configure(width=newWidth, height=newHeight)
-	    self._drawArrow(btn, self.arrowDirection[btn])
-
-    def _min(self):
-	min = self['min']
-        if min is None:
-	    self._minVal = 0
-	else:
-	    self._minVal = timestringtoseconds(min)
-
-    def _max(self):
-	max = self['max']
-	if max is None:
-	    self._maxVal = None
-	else:
-	    self._maxVal = timestringtoseconds(max)
-
-    def getvalue(self):
-        return self.getstring()
-
-    def setvalue(self, text):
-        list = string.split(text, ':')
-	if len(list) != 3:
-	    raise ValueError, 'invalid value: ' + text
-
-	self._hour = string.atoi(list[0])
-	self._minute = string.atoi(list[1])
-	self._second = string.atoi(list[2]) 
-
-    	self._setHMS()
-
-    def getstring(self):
-    	return '%02d:%02d:%02d' % (self._hour, self._minute, self._second)
-
-    def getint(self):
-    	return self._hour * 3600 + self._minute * 60 + self._second
-
-    def _countUp(self, button, increment):
-	self._relief = self._upHourArrowBtn.cget('relief')
-	button.configure(relief='sunken')
-	self._count(1, 'start', increment)
-
-    def _countDown(self, button, increment):
-
-	self._relief = self._downHourArrowBtn.cget('relief')
-	button.configure(relief='sunken')
-	self._count(-1, 'start', increment)
-
-    def increment(self, seconds = 1):
-	self._count(1, 'force', seconds)
-
-    def decrement(self, seconds = 1):
-	self._count(-1, 'force', seconds)
-
-    def _count(self, factor, newFlag = None, increment = 1):
-	if newFlag != 'force':
-	  if newFlag is not None:
-	    self._flag = newFlag
-
-	  if self._flag == 'stopped':
-	    return
-
-	value = (string.atoi(self._hourCounterEntry.get()) *3600) + \
-	      (string.atoi(self._minuteCounterEntry.get()) *60) + \
-	      string.atoi(self._secondCounterEntry.get()) + \
-	      factor * increment
-	min = self._minVal
-	max = self._maxVal
-	if value &lt; min:
-	  value = min
-	if max is not None and value &gt; max:
-	  value = max
-
-	self._hour = value /3600
-	self._minute = (value - (self._hour*3600)) / 60
-	self._second = value - (self._hour*3600) - (self._minute*60)
-	self._setHMS()
-
-	if newFlag != 'force':
-	  if self['autorepeat']:
-	    if self._flag == 'start':
-	      delay = self['initwait']
-	      self._flag = 'running'
-	    else:
-	      delay = self['repeatrate']
-	    self._timerId = self.after(
-		delay, lambda self=self, factor=factor,increment=increment: 
-		  self._count(factor,'running', increment))
-
-    def _setHMS(self):
-        self._hourCounterEntry.setentry('%02d' % self._hour)
-        self._minuteCounterEntry.setentry('%02d' % self._minute)
-        self._secondCounterEntry.setentry('%02d' % self._second)
-
-    def _stopUpDown(self, button):
-        if self._timerId is not None:
-            self.after_cancel(self._timerId)
-	    self._timerId = None
-        button.configure(relief=self._relief)
-        self._flag = 'stopped'
-
-    def _invoke(self, event):
-        cmd = self['command']
-        if callable(cmd):
-	    cmd()
-
-    def invoke(self):
-        cmd = self['command']
-        if callable(cmd):
-	    return cmd()
-
-    def destroy(self):
-        if self._timerId is not None:
-            self.after_cancel(self._timerId)
-	    self._timerId = None
-        MegaWidget.destroy(self)
-
-######################################################################
-### File: PmwAboutDialog.py
-
-
-class AboutDialog(MessageDialog):
-    # Window to display version and contact information.
-
-    # Class members containing resettable 'default' values:
-    _version = ''
-    _copyright = ''
-    _contact = ''
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('applicationname',   '',          INITOPT),
-	    ('iconpos',           'w',         None),
-	    ('icon_bitmap',       'info',      None),
-	    ('buttons',           ('Close',),  None),
-	    ('defaultbutton',     0,           None),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MessageDialog.__init__(self, parent)
-
-	applicationname = self['applicationname']
-        if not kw.has_key('title'):
-            self.configure(title = 'About ' + applicationname)
-
-        if not kw.has_key('message_text'):
-            text = applicationname + '\n\n'
-            if AboutDialog._version != '':
-              text = text + 'Version ' + AboutDialog._version + '\n'
-            if AboutDialog._copyright != '':
-              text = text + AboutDialog._copyright + '\n\n'
-            if AboutDialog._contact != '':
-              text = text + AboutDialog._contact
-
-            self.configure(message_text=text)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-def aboutversion(value):
-    AboutDialog._version = value
-
-def aboutcopyright(value):
-    AboutDialog._copyright = value
-
-def aboutcontact(value):
-    AboutDialog._contact = value
-
-######################################################################
-### File: PmwComboBox.py
-# Based on iwidgets2.2.0/combobox.itk code.
-
-import os
-import string
-import types
-import Tkinter
-
-
-class ComboBox(MegaWidget):
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('autoclear',          0,          INITOPT),
-	    ('buttonaspect',       1.0,        INITOPT),
-	    ('dropdown',           1,          INITOPT),
-	    ('fliparrow',          0,          INITOPT),
-	    ('history',            1,          INITOPT),
-	    ('labelmargin',        0,          INITOPT),
-	    ('labelpos',           None,       INITOPT),
-	    ('listheight',         200,        INITOPT),
-	    ('selectioncommand',   None,       None),
-	    ('sticky',            'ew',        INITOPT),
-	    ('unique',             1,          INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-
-	self._entryfield = self.createcomponent('entryfield',
-		(('entry', 'entryfield_entry'),), None,
-		EntryField, (interior,))
-	self._entryfield.grid(column=2, row=2, sticky=self['sticky'])
-	interior.grid_columnconfigure(2, weight = 1)
-	self._entryWidget = self._entryfield.component('entry')
-
-	if self['dropdown']:
-	    self._isPosted = 0
-            interior.grid_rowconfigure(2, weight = 1)
-
-	    # Create the arrow button.
-	    self._arrowBtn = self.createcomponent('arrowbutton',
-		    (), None,
-		    Tkinter.Canvas, (interior,), borderwidth = 2,
-		    relief = 'raised',
-		    width = 16, height = 16)
-            if 'n' in self['sticky']:
-                sticky = 'n'
-            else:
-                sticky = ''
-            if 's' in self['sticky']:
-                sticky = sticky + 's'
-	    self._arrowBtn.grid(column=3, row=2, sticky = sticky)
-	    self._arrowRelief = self._arrowBtn.cget('relief')
-
-	    # Create the label.
-	    self.createlabel(interior, childCols=2)
-
-	    # Create the dropdown window.
-	    self._popup = self.createcomponent('popup',
-		    (), None,
-		    Tkinter.Toplevel, (interior,))
-	    self._popup.withdraw()
-	    self._popup.overrideredirect(1)
-
-	    # Create the scrolled listbox inside the dropdown window.
-	    self._list = self.createcomponent('scrolledlist',
-		    (('listbox', 'scrolledlist_listbox'),), None,
-		    ScrolledListBox, (self._popup,),
-		    hull_borderwidth = 2,
-		    hull_relief = 'raised',
-		    hull_height = self['listheight'],
-		    usehullsize = 1,
-		    listbox_exportselection = 0)
-	    self._list.pack(expand=1, fill='both')
-	    self.__listbox = self._list.component('listbox')
-
-	    # Bind events to the arrow button.
-	    self._arrowBtn.bind('&lt;1&gt;', self._postList)
-	    self._arrowBtn.bind('&lt;Configure&gt;', self._drawArrow)
-	    self._arrowBtn.bind('&lt;3&gt;', self._next)
-	    self._arrowBtn.bind('&lt;Shift-3&gt;', self._previous)
-	    self._arrowBtn.bind('&lt;Down&gt;', self._next)
-	    self._arrowBtn.bind('&lt;Up&gt;', self._previous)
-	    self._arrowBtn.bind('&lt;Control-n&gt;', self._next)
-	    self._arrowBtn.bind('&lt;Control-p&gt;', self._previous)
-	    self._arrowBtn.bind('&lt;Shift-Down&gt;', self._postList)
-	    self._arrowBtn.bind('&lt;Shift-Up&gt;', self._postList)
-	    self._arrowBtn.bind('&lt;F34&gt;', self._postList)
-	    self._arrowBtn.bind('&lt;F28&gt;', self._postList)
-	    self._arrowBtn.bind('&lt;space&gt;', self._postList)
-
-	    # Bind events to the dropdown window.
-	    self._popup.bind('&lt;Escape&gt;', self._unpostList)
-	    self._popup.bind('&lt;space&gt;', self._selectUnpost)
-	    self._popup.bind('&lt;Return&gt;', self._selectUnpost)
-	    self._popup.bind('&lt;ButtonRelease-1&gt;', self._dropdownBtnRelease)
-	    self._popup.bind('&lt;ButtonPress-1&gt;', self._unpostOnNextRelease)
-
-	    # Bind events to the Tk listbox.
-	    self.__listbox.bind('&lt;Enter&gt;', self._unpostOnNextRelease)
-
-	    # Bind events to the Tk entry widget.
-	    self._entryWidget.bind('&lt;Configure&gt;', self._resizeArrow)
-	    self._entryWidget.bind('&lt;Shift-Down&gt;', self._postList)
-	    self._entryWidget.bind('&lt;Shift-Up&gt;', self._postList)
-	    self._entryWidget.bind('&lt;F34&gt;', self._postList)
-	    self._entryWidget.bind('&lt;F28&gt;', self._postList)
-
-            # Need to unpost the popup if the entryfield is unmapped (eg: 
-            # its toplevel window is withdrawn) while the popup list is
-            # displayed.
-            self._entryWidget.bind('&lt;Unmap&gt;', self._unpostList)
-
-	else:
-	    # Create the scrolled listbox below the entry field.
-	    self._list = self.createcomponent('scrolledlist',
-		    (('listbox', 'scrolledlist_listbox'),), None,
-		    ScrolledListBox, (interior,),
-                    selectioncommand = self._selectCmd)
-	    self._list.grid(column=2, row=3, sticky='nsew')
-	    self.__listbox = self._list.component('listbox')
-
-	    # The scrolled listbox should expand vertically.
-	    interior.grid_rowconfigure(3, weight = 1)
-
-	    # Create the label.
-	    self.createlabel(interior, childRows=2)
-
-	self._entryWidget.bind('&lt;Down&gt;', self._next)
-	self._entryWidget.bind('&lt;Up&gt;', self._previous)
-	self._entryWidget.bind('&lt;Control-n&gt;', self._next)
-	self._entryWidget.bind('&lt;Control-p&gt;', self._previous)
-	self.__listbox.bind('&lt;Control-n&gt;', self._next)
-	self.__listbox.bind('&lt;Control-p&gt;', self._previous)
-
-	if self['history']:
-	    self._entryfield.configure(command=self._addHistory)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def destroy(self):
-	if self['dropdown'] and self._isPosted:
-            popgrab(self._popup)
-        MegaWidget.destroy(self)
-
-    #======================================================================
-
-    # Public methods
-
-    def get(self, first = None, last=None):
-	if first is None:
-	    return self._entryWidget.get()
-	else:
-	    return self._list.get(first, last)
-
-    def invoke(self):
-	if self['dropdown']:
-	    self._postList()
-	else:
-	    return self._selectCmd()
-
-    def selectitem(self, index, setentry=1):
-	if type(index) == types.StringType:
-	    text = index
-	    items = self._list.get(0, 'end')
-	    if text in items:
-		index = list(items).index(text)
-	    else:
-	    	raise IndexError, 'index &quot;%s&quot; not found' % text
-	elif setentry:
-	    text = self._list.get(0, 'end')[index]
-
-	self._list.select_clear(0, 'end')
-	self._list.select_set(index, index)
-	self._list.activate(index)
-	self.see(index)
-	if setentry:
-	    self._entryfield.setentry(text)
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)size method inherited from Tkinter.Frame.Grid.
-    def size(self):
-	return self._list.size()
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)bbox method inherited from Tkinter.Frame.Grid.
-    def bbox(self, index):
-	return self._list.bbox(index)
-
-    def clear(self):
-	self._entryfield.clear()
-	self._list.clear()
-
-    #======================================================================
-
-    # Private methods for both dropdown and simple comboboxes.
-
-    def _addHistory(self):
-	input = self._entryWidget.get()
-
-	if input != '':
-	    index = None
-	    if self['unique']:
-		# If item is already in list, select it and return.
-		items = self._list.get(0, 'end')
-		if input in items:
-		    index = list(items).index(input)
-
-	    if index is None:
-		index = self._list.index('end')
-		self._list.insert('end', input)
-
-	    self.selectitem(index)
-	    if self['autoclear']:
-		self._entryWidget.delete(0, 'end')
-
-	    # Execute the selectioncommand on the new entry.
-	    self._selectCmd()
-
-    def _next(self, event):
-	size = self.size()
-	if size &lt;= 1:
-	    return
-
-	cursels = self.curselection()
-
-	if len(cursels) == 0:
-	    index = 0
-	else:
-	    index = string.atoi(cursels[0])
-	    if index == size - 1:
-		index = 0
-	    else:
-		index = index + 1
-
-	self.selectitem(index)
-
-    def _previous(self, event):
-	size = self.size()
-	if size &lt;= 1:
-	    return
-
-	cursels = self.curselection()
-
-	if len(cursels) == 0:
-	    index = size - 1
-	else:
-	    index = string.atoi(cursels[0])
-	    if index == 0:
-		index = size - 1
-	    else:
-		index = index - 1
-
-	self.selectitem(index)
-
-    def _selectCmd(self, event=None):
-
-	sels = self.getcurselection()
-	if len(sels) == 0:
-	    item = None
-	else:
-	    item = sels[0]
-	    self._entryfield.setentry(item)
-
-	cmd = self['selectioncommand']
-	if callable(cmd):
-            if event is None:
-                # Return result of selectioncommand for invoke() method.
-                return cmd(item)
-            else:
-                cmd(item)
-
-    #======================================================================
-
-    # Private methods for dropdown combobox.
-
-    def _drawArrow(self, event=None, sunken=0):
-        arrow = self._arrowBtn
-	if sunken:
-	    self._arrowRelief = arrow.cget('relief')
-	    arrow.configure(relief = 'sunken')
-	else:
-	    arrow.configure(relief = self._arrowRelief)
-
-	if self._isPosted and self['fliparrow']:
-            direction = 'up'
-        else:
-            direction = 'down'
-        drawarrow(arrow, self['entry_foreground'], direction, 'arrow')
-
-    def _postList(self, event = None):
-        self._isPosted = 1
-        self._drawArrow(sunken=1)
-
-        # Make sure that the arrow is displayed sunken.
-        self.update_idletasks()
-
-        x = self._entryfield.winfo_rootx()
-        y = self._entryfield.winfo_rooty() + \
-            self._entryfield.winfo_height()
-        w = self._entryfield.winfo_width() + self._arrowBtn.winfo_width()
-        h =  self.__listbox.winfo_height()
-        sh = self.winfo_screenheight()
-
-        if y + h &gt; sh and y &gt; sh / 2:
-            y = self._entryfield.winfo_rooty() - h
-
-        self._list.configure(hull_width=w)
-
-        setgeometryanddeiconify(self._popup, '+%d+%d' % (x, y))
-
-        # Grab the popup, so that all events are delivered to it, and
-        # set focus to the listbox, to make keyboard navigation
-        # easier.
-        pushgrab(self._popup, 1, self._unpostList)
-        self.__listbox.focus_set()
-
-        self._drawArrow()
-
-        # Ignore the first release of the mouse button after posting the
-        # dropdown list, unless the mouse enters the dropdown list.
-        self._ignoreRelease = 1
-
-    def _dropdownBtnRelease(self, event):
-	if (event.widget == self._list.component('vertscrollbar') or
-		event.widget == self._list.component('horizscrollbar')):
-	    return
-
-	if self._ignoreRelease:
-	    self._unpostOnNextRelease()
-	    return
-
-        self._unpostList()
-
-	if (event.x &gt;= 0 and event.x &lt; self.__listbox.winfo_width() and
-		event.y &gt;= 0 and event.y &lt; self.__listbox.winfo_height()):
-	    self._selectCmd()
-
-    def _unpostOnNextRelease(self, event = None):
-	self._ignoreRelease = 0
-
-    def _resizeArrow(self, event):
-	bw = (string.atoi(self._arrowBtn['borderwidth']) + 
-		string.atoi(self._arrowBtn['highlightthickness']))
-	newHeight = self._entryfield.winfo_reqheight() - 2 * bw
-	newWidth = int(newHeight * self['buttonaspect'])
-	self._arrowBtn.configure(width=newWidth, height=newHeight)
-	self._drawArrow()
-
-    def _unpostList(self, event=None):
-	if not self._isPosted:
-            # It is possible to get events on an unposted popup.  For
-            # example, by repeatedly pressing the space key to post
-            # and unpost the popup.  The &lt;space&gt; event may be
-            # delivered to the popup window even though
-            # popgrab() has set the focus away from the
-            # popup window.  (Bug in Tk?)
-            return
-
-        # Restore the focus before withdrawing the window, since
-        # otherwise the window manager may take the focus away so we
-        # can't redirect it.  Also, return the grab to the next active
-        # window in the stack, if any.
-        popgrab(self._popup)
-	self._popup.withdraw()
-
-	self._isPosted = 0
-	self._drawArrow()
-
-    def _selectUnpost(self, event):
-        self._unpostList()
-	self._selectCmd()
-
-forwardmethods(ComboBox, ScrolledListBox, '_list')
-forwardmethods(ComboBox, EntryField, '_entryfield')
-
-######################################################################
-### File: PmwComboBoxDialog.py
-# Not Based on iwidgets version.
-
-
-
-class ComboBoxDialog(Dialog):
-    # Dialog window with simple combobox.
-    
-    # Dialog window displaying a list and entry field and requesting
-    # the user to make a selection or enter a value
-
-    def __init__(self, parent = None, **kw):
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderx',    10,              INITOPT),
-	    ('bordery',    10,              INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	Dialog.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-
-	aliases = (
-	    ('listbox', 'combobox_listbox'),
-	    ('scrolledlist', 'combobox_scrolledlist'),
-	    ('entry', 'combobox_entry'),
-	    ('label', 'combobox_label'),
-	)
-	self._combobox = self.createcomponent('combobox',
-		aliases, None,
-		ComboBox, (interior,),
-		scrolledlist_dblclickcommand = self.invoke,
-		dropdown = 0,
-	)
-	self._combobox.pack(side='top', expand='true', fill='both',
-		padx = self['borderx'], pady = self['bordery'])
-
-        if not kw.has_key('activatecommand'):
-            # Whenever this dialog is activated, set the focus to the
-            # ComboBox's listbox widget.
-            listbox = self.component('listbox')
-            self.configure(activatecommand = listbox.focus_set)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)size method inherited from Tkinter.Toplevel.Grid.
-    def size(self):
-	return self._combobox.size()
-
-    # Need to explicitly forward this to override the stupid
-    # (grid_)bbox method inherited from Tkinter.Toplevel.Grid.
-    def bbox(self, index):
-	return self._combobox.bbox(index)
-
-forwardmethods(ComboBoxDialog, ComboBox, '_combobox')
-
-######################################################################
-### File: PmwCounter.py
-import string
-import sys
-import types
-import Tkinter
-
-
-class Counter(MegaWidget):
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('autorepeat',     1,             None),
-	    ('buttonaspect',   1.0,           INITOPT),
-	    ('datatype',       'numeric',     self._datatype),
-	    ('increment',      1,             None),
-	    ('initwait',       300,           None),
-	    ('labelmargin',    0,             INITOPT),
-	    ('labelpos',       None,          INITOPT),
-	    ('orient',         'horizontal',  INITOPT),
-	    ('padx',           0,             INITOPT),
-	    ('pady',           0,             INITOPT),
-	    ('repeatrate',     50,            None),
-	    ('sticky',         'ew',          INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	MegaWidget.__init__(self, parent)
-
-	# Initialise instance variables.
-	self._timerId = None
-	self._normalRelief = None
-
-	# Create the components.
-	interior = self.interior()
-
-	# If there is no label, put the arrows and the entry directly
-	# into the interior, otherwise create a frame for them.  In
-	# either case the border around the arrows and the entry will
-	# be raised (but not around the label).
-	if self['labelpos'] is None:
-	    frame = interior
-            if not kw.has_key('hull_relief'):
-                frame.configure(relief = 'raised')
-            if not kw.has_key('hull_borderwidth'):
-                frame.configure(borderwidth = 1)
-	else:
-	    frame = self.createcomponent('frame',
-		    (), None,
-		    Tkinter.Frame, (interior,),
-                    relief = 'raised', borderwidth = 1)
-	    frame.grid(column=2, row=2, sticky=self['sticky'])
-	    interior.grid_columnconfigure(2, weight=1)
-	    interior.grid_rowconfigure(2, weight=1)
-
-	# Create the down arrow.
-	self._downArrowBtn = self.createcomponent('downarrow',
-		(), 'Arrow',
-		Tkinter.Canvas, (frame,),
-		width = 16, height = 16, relief = 'raised', borderwidth = 2)
-
-	# Create the entry field.
-	self._counterEntry = self.createcomponent('entryfield',
-		(('entry', 'entryfield_entry'),), None,
-		EntryField, (frame,))
-
-	# Create the up arrow.
-	self._upArrowBtn = self.createcomponent('uparrow',
-		(), 'Arrow',
-		Tkinter.Canvas, (frame,),
-		width = 16, height = 16, relief = 'raised', borderwidth = 2)
-
-	padx = self['padx']
-	pady = self['pady']
-	orient = self['orient']
-	if orient == 'horizontal':
-	    self._downArrowBtn.grid(column = 0, row = 0)
-	    self._counterEntry.grid(column = 1, row = 0,
-                    sticky = self['sticky'])
-	    self._upArrowBtn.grid(column = 2, row = 0)
-	    frame.grid_columnconfigure(1, weight = 1)
-	    frame.grid_rowconfigure(0, weight = 1)
-	    if Tkinter.TkVersion &gt;= 4.2:
-		frame.grid_columnconfigure(0, pad = padx)
-		frame.grid_columnconfigure(2, pad = padx)
-		frame.grid_rowconfigure(0, pad = pady)
-	elif orient == 'vertical':
-	    self._upArrowBtn.grid(column = 0, row = 0, sticky = 's')
-	    self._counterEntry.grid(column = 0, row = 1,
-                    sticky = self['sticky'])
-	    self._downArrowBtn.grid(column = 0, row = 2, sticky = 'n')
-	    frame.grid_columnconfigure(0, weight = 1)
-	    frame.grid_rowconfigure(0, weight = 1)
-	    frame.grid_rowconfigure(2, weight = 1)
-	    if Tkinter.TkVersion &gt;= 4.2:
-		frame.grid_rowconfigure(0, pad = pady)
-		frame.grid_rowconfigure(2, pad = pady)
-		frame.grid_columnconfigure(0, pad = padx)
-	else:
-	    raise ValueError, 'bad orient option ' + repr(orient) + \
-		': must be either \'horizontal\' or \'vertical\''
-
-	self.createlabel(interior)
-
-	self._upArrowBtn.bind('&lt;Configure&gt;', self._drawUpArrow)
-	self._upArrowBtn.bind('&lt;1&gt;', self._countUp)
-	self._upArrowBtn.bind('&lt;Any-ButtonRelease-1&gt;', self._stopCounting)
-	self._downArrowBtn.bind('&lt;Configure&gt;', self._drawDownArrow)
-	self._downArrowBtn.bind('&lt;1&gt;', self._countDown)
-	self._downArrowBtn.bind('&lt;Any-ButtonRelease-1&gt;', self._stopCounting)
-	self._counterEntry.bind('&lt;Configure&gt;', self._resizeArrow)
-	entry = self._counterEntry.component('entry')
-	entry.bind('&lt;Down&gt;', lambda event, s = self: s._key_decrement(event))
-	entry.bind('&lt;Up&gt;', lambda event, s = self: s._key_increment(event))
-
-	# Need to cancel the timer if an arrow button is unmapped (eg: 
-	# its toplevel window is withdrawn) while the mouse button is
-	# held down.  The canvas will not get the ButtonRelease event
-	# if it is not mapped, since the implicit grab is cancelled.
-	self._upArrowBtn.bind('&lt;Unmap&gt;', self._stopCounting)
-	self._downArrowBtn.bind('&lt;Unmap&gt;', self._stopCounting)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    def _resizeArrow(self, event):
-	for btn in (self._upArrowBtn, self._downArrowBtn):
-	    bw = (string.atoi(btn['borderwidth']) +
-		    string.atoi(btn['highlightthickness']))
-	    newHeight = self._counterEntry.winfo_reqheight() - 2 * bw
-	    newWidth = int(newHeight * self['buttonaspect'])
-	    btn.configure(width=newWidth, height=newHeight)
-	    self._drawArrow(btn)
-
-    def _drawUpArrow(self, event):
-	self._drawArrow(self._upArrowBtn)
-
-    def _drawDownArrow(self, event):
-	self._drawArrow(self._downArrowBtn)
-
-    def _drawArrow(self, arrow):
-        if self['orient'] == 'vertical':
-            if arrow == self._upArrowBtn:
-                direction = 'up'
-            else:
-                direction = 'down'
-        else:
-            if arrow == self._upArrowBtn:
-                direction = 'right'
-            else:
-                direction = 'left'
-        drawarrow(arrow, self['entry_foreground'], direction, 'arrow')
-
-    def _stopCounting(self, event = None):
-        if self._timerId is not None:
-            self.after_cancel(self._timerId)
-	    self._timerId = None
-	if self._normalRelief is not None:
-	    button, relief = self._normalRelief
-	    button.configure(relief=relief)
-	    self._normalRelief = None
-
-    def _countUp(self, event):
-	self._normalRelief = (self._upArrowBtn, self._upArrowBtn.cget('relief'))
-	self._upArrowBtn.configure(relief='sunken')
-	# Force arrow down (it may come up immediately, if increment fails).
-	self._upArrowBtn.update_idletasks()
-	self._count(1, 1)
-
-    def _countDown(self, event):
-	self._normalRelief = (self._downArrowBtn, self._downArrowBtn.cget('relief'))
-	self._downArrowBtn.configure(relief='sunken')
-	# Force arrow down (it may come up immediately, if increment fails).
-	self._downArrowBtn.update_idletasks()
-	self._count(-1, 1)
-
-    def increment(self):
-	self._forceCount(1)
-
-    def decrement(self):
-	self._forceCount(-1)
-
-    def _key_increment(self, event):
-	self._forceCount(1)
-	self.update_idletasks()
-
-    def _key_decrement(self, event):
-	self._forceCount(-1)
-	self.update_idletasks()
-
-    def _datatype(self):
-	datatype = self['datatype']
-
-	if type(datatype) is types.DictionaryType:
-	    self._counterArgs = datatype.copy()
-	    if self._counterArgs.has_key('counter'):
-		datatype = self._counterArgs['counter']
-		del self._counterArgs['counter']
-	    else:
-		datatype = 'numeric'
-	else:
-	    self._counterArgs = {}
-
-	if _counterCommands.has_key(datatype):
-	    self._counterCommand = _counterCommands[datatype]
-	elif callable(datatype):
-	    self._counterCommand = datatype
-	else:
-	    validValues = _counterCommands.keys()
-	    validValues.sort()
-	    raise ValueError, ('bad datatype value &quot;%s&quot;:  must be a' +
-		    ' function or one of %s') % (datatype, validValues)
-
-    def _forceCount(self, factor):
-	if not self.valid():
-	    self.bell()
-	    return
-
-	text = self._counterEntry.get()
-	try:
-	    value = apply(self._counterCommand,
-		    (text, factor, self['increment']), self._counterArgs)
-	except ValueError:
-	    self.bell()
-	    return
-
-        previousICursor = self._counterEntry.index('insert')
-	if self._counterEntry.setentry(value) == OK:
-	    self._counterEntry.xview('end')
-	    self._counterEntry.icursor(previousICursor)
-
-    def _count(self, factor, first):
-	if not self.valid():
-	    self.bell()
-	    return
-
-	self._timerId = None
-	origtext = self._counterEntry.get()
-	try:
-	    value = apply(self._counterCommand,
-		    (origtext, factor, self['increment']), self._counterArgs)
-	except ValueError:
-	    # If text is invalid, stop counting.
-	    self._stopCounting()
-	    self.bell()
-	    return
-
-	# If incrementing produces an invalid value, restore previous
-	# text and stop counting.
-        previousICursor = self._counterEntry.index('insert')
-	valid = self._counterEntry.setentry(value)
-	if valid != OK:
-	    self._stopCounting()
-	    self._counterEntry.setentry(origtext)
-	    if valid == PARTIAL:
-		self.bell()
-	    return
-	self._counterEntry.xview('end')
-	self._counterEntry.icursor(previousICursor)
-
-	if self['autorepeat']:
-	    if first:
-		delay = self['initwait']
-	    else:
-		delay = self['repeatrate']
-	    self._timerId = self.after(delay,
-		    lambda self=self, factor=factor: self._count(factor, 0))
-
-    def destroy(self):
-	self._stopCounting()
-        MegaWidget.destroy(self)
-
-forwardmethods(Counter, EntryField, '_counterEntry')
-
-def _changeNumber(text, factor, increment):
-  value = string.atol(text)
-  if factor &gt; 0:
-    value = (value / increment) * increment + increment
-  else:
-    value = ((value - 1) / increment) * increment
-
-  # Get rid of the 'L' at the end of longs (in python up to 1.5.2).
-  rtn = str(value)
-  if rtn[-1] == 'L':
-      return rtn[:-1]
-  else:
-      return rtn
-
-def _changeReal(text, factor, increment, separator = '.'):
-  value = stringtoreal(text, separator)
-  div = value / increment
-
-  # Compare reals using str() to avoid problems caused by binary
-  # numbers being only approximations to decimal numbers.
-  # For example, if value is -0.3 and increment is 0.1, then
-  # int(value/increment) = -2, not -3 as one would expect.
-  if str(div)[-2:] == '.0':
-    # value is an even multiple of increment.
-    div = round(div) + factor
-  else:
-    # value is not an even multiple of increment.
-    div = int(div) * 1.0
-    if value &lt; 0:
-      div = div - 1
-    if factor &gt; 0:
-      div = (div + 1)
-
-  value = div * increment
-
-  text = str(value)
-  if separator != '.':
-      index = string.find(text, '.')
-      if index &gt;= 0:
-	text = text[:index] + separator + text[index + 1:]
-  return text
-
-def _changeDate(value, factor, increment, format = 'ymd',
-	separator = '/', yyyy = 0):
-
-  jdn = datestringtojdn(value, format, separator) + factor * increment
-
-  y, m, d = jdntoymd(jdn)
-  result = ''
-  for index in range(3):
-    if index &gt; 0:
-      result = result + separator
-    f = format[index]
-    if f == 'y':
-      if yyyy:
-        result = result + '%02d' % y
-      else:
-        result = result + '%02d' % (y % 100)
-    elif f == 'm':
-      result = result + '%02d' % m
-    elif f == 'd':
-      result = result + '%02d' % d
-
-  return result
-
-_SECSPERDAY = 24 * 60 * 60
-def _changeTime(value, factor, increment, separator = ':', time24 = 0):
-  unixTime = timestringtoseconds(value, separator)
-  if factor &gt; 0:
-    chunks = unixTime / increment + 1
-  else:
-    chunks = (unixTime - 1) / increment
-  unixTime = chunks * increment
-  if time24:
-      while unixTime &lt; 0:
-	  unixTime = unixTime + _SECSPERDAY
-      while unixTime &gt;= _SECSPERDAY:
-	  unixTime = unixTime - _SECSPERDAY
-  if unixTime &lt; 0:
-    unixTime = -unixTime
-    sign = '-'
-  else:
-    sign = ''
-  secs = unixTime % 60
-  unixTime = unixTime / 60
-  mins = unixTime % 60
-  hours = unixTime / 60
-  return '%s%02d%s%02d%s%02d' % (sign, hours, separator, mins, separator, secs)
-
-# hexadecimal, alphabetic, alphanumeric not implemented
-_counterCommands = {
-    'numeric'   : _changeNumber,      # } integer
-    'integer'   : _changeNumber,      # } these two use the same function
-    'real'      : _changeReal,        # real number
-    'time'      : _changeTime,
-    'date'      : _changeDate,
-}
-
-######################################################################
-### File: PmwCounterDialog.py
-
-
-# A Dialog with a counter
-
-class CounterDialog(Dialog):
-
-    def __init__(self, parent = None, **kw):
-
-	# Define the megawidget options.
-	
-	optiondefs = (
-	    ('borderx',    20,  INITOPT),
-	    ('bordery',    20,  INITOPT),
-	)
-	self.defineoptions(kw, optiondefs)
-
-	# Initialise the base class (after defining the options).
-	Dialog.__init__(self, parent)
-
-	# Create the components.
-	interior = self.interior()
-
-	# Create the counter.
-	aliases = (
-	    ('entryfield', 'counter_entryfield'),
-	    ('entry', 'counter_entryfield_entry'),
-	    ('label', 'counter_label')
-	)
-	self._cdCounter = self.createcomponent('counter',
-		aliases, None,
-		Counter, (interior,))
-	self._cdCounter.pack(fill='x', expand=1,
-		padx = self['borderx'], pady = self['bordery'])
-	
-        if not kw.has_key('activatecommand'):
-            # Whenever this dialog is activated, set the focus to the
-            # Counter's entry widget.
-            tkentry = self.component('entry')
-            self.configure(activatecommand = tkentry.focus_set)
-
-	# Check keywords and initialise options.
-	self.initialiseoptions()
-
-    # Supply aliases to some of the entry component methods.
-    def insertentry(self, index, text):
-	self._cdCounter.insert(index, text)
-
-    def deleteentry(self, first, last=None):
-	self._cdCounter.delete(first, last)
-
-    def indexentry(self, index):
-	return self._cdCounter.index(index)
-
-forwardmethods(CounterDialog, Counter, '_cdCounter')
-
-######################################################################
-### File: PmwLogicalFont.py
-import os
-import string
-
-def _font_initialise(root, size=None, fontScheme = None):
-    global _fontSize
-    if size is not None:
-        _fontSize = size
-
-    if fontScheme in ('pmw1', 'pmw2'):
-        if os.name == 'posix':
-            defaultFont = logicalfont('Helvetica')
-            menuFont = logicalfont('Helvetica', weight='bold', slant='italic')
-            scaleFont = logicalfont('Helvetica', slant='italic')
-            root.option_add('*Font',            defaultFont,  'userDefault')
-            root.option_add('*Menu*Font',       menuFont,     'userDefault')
-            root.option_add('*Menubutton*Font', menuFont,     'userDefault')
-            root.option_add('*Scale.*Font',     scaleFont,    'userDefault')
-
-            if fontScheme == 'pmw1':
-                balloonFont = logicalfont('Helvetica', -6, pixel = '12')
-            else: # fontScheme == 'pmw2'
-                balloonFont = logicalfont('Helvetica', -2)
-            root.option_add('*Balloon.*Font', balloonFont, 'userDefault')
-        else:
-            defaultFont = logicalfont('Helvetica')
-            root.option_add('*Font', defaultFont,  'userDefault')
-    elif fontScheme == 'default':
-        defaultFont = ('Helvetica', '-%d' % (_fontSize,), 'bold')
-        entryFont = ('Helvetica', '-%d' % (_fontSize,))
-        textFont = ('Courier', '-%d' % (_fontSize,))
-        root.option_add('*Font',            defaultFont,  'userDefault')
-        root.option_add('*Entry*Font',      entryFont,    'userDefault')
-        root.option_add('*Text*Font',       textFont,     'userDefault')
-
-def logicalfont(name='Helvetica', sizeIncr = 0, **kw):
-  if not _fontInfo.has_key(name):
-    raise ValueError, 'font %s does not exist' % name
-
-  rtn = []
-  for field in _fontFields:
-    if kw.has_key(field):
-      logicalValue = kw[field]
-    elif _fontInfo[name].has_key(field):
-      logicalValue = _fontInfo[name][field]
-    else:
-      logicalValue = '*'
-
-    if _propertyAliases[name].has_key((field, logicalValue)):
-      realValue = _propertyAliases[name][(field, logicalValue)]
-    elif _propertyAliases[name].has_key((field, None)):
-      realValue = _propertyAliases[name][(field, None)]
-    elif _propertyAliases[None].has_key((field, logicalValue)):
-      realValue = _propertyAliases[None][(field, logicalValue)]
-    elif _propertyAliases[None].has_key((field, None)):
-      realValue = _propertyAliases[None][(field, None)]
-    else:
-      realValue = logicalValue
-
-    if field == 'size':
-      if realValue == '*':
-	  realValue = _fontSize
-      realValue = str((realValue + sizeIncr) * 10)
-
-    rtn.append(realValue)
-
-  return string.join(rtn, '-')
-
-def logicalfontnames():
-  return _fontInfo.keys()
-
-if os.name == 'nt':
-    _fontSize = 16
-else:
-    _fontSize = 14
-
-_fontFields = (
-  'registry', 'foundry', 'family', 'weight', 'slant', 'width', 'style',
-  'pixel', 'size', 'xres', 'yres', 'spacing', 'avgwidth', 'charset', 'encoding')
-
-# &lt;_propertyAliases&gt; defines other names for which property values may
-# be known by.  This is required because italics in adobe-helvetica
-# are specified by 'o', while other fonts use 'i'.
-
-_propertyAliases = {}
-
-_propertyAliases[None] = {
-  ('slant', 'italic') : 'i',
-  ('slant', 'normal') : 'r',
-  ('weight', 'light') : 'normal',
-  ('width', 'wide') : 'normal',
-  ('width', 'condensed') : 'normal',
-}
-
-# &lt;_fontInfo&gt; describes a 'logical' font, giving the default values of
-# some of its properties.
-
-_fontInfo = {}
-
-_fontInfo['Helvetica'] = {
-  'foundry' : 'adobe',
-  'family' : 'helvetica',
-  'registry' : '',
-  'charset' : 'iso8859',
-  'encoding' : '1',
-  'spacing' : 'p',
-  'slant' : 'normal',
-  'width' : 'normal',
-  'weight' : 'normal',
-}
-
-_propertyAliases['Helvetica'] = {
-  ('slant', 'italic') : 'o',
-  ('weight', 'normal') : 'medium',
-  ('weight', 'light') : 'medium',
-}
-
-_fontInfo['Times'] = {
-  'foundry' : 'adobe',
-  'family' : 'times',
-  'registry' : '',
-  'charset' : 'iso8859',
-  'encoding' : '1',
-  'spacing' : 'p',
-  'slant' : 'normal',
-  'width' : 'normal',
-  'weight' : 'normal',
-}
-
-_propertyAliases['Times'] = {
-  ('weight', 'normal') : 'medium',
-  ('weight', 'light') : 'medium',
-}
-
-_fontInfo['Fixed'] = {
-  'foundry' : 'misc',
-  'family' : 'fixed',
-  'registry' : '',
-  'charset' : 'iso8859',
-  'encoding' : '1',
-  'spacing' : 'c',
-  'slant' : 'normal',
-  'width' : 'normal',
-  'weight' : 'normal',
-}
-
-_propertyAliases['Fixed'] = {
-  ('weight', 'normal') : 'medium',
-  ('weight', 'light') : 'medium',
-  ('style', None) : '',
-  ('width', 'condensed') : 'semicondensed',
-}
-
-_fontInfo['Courier'] = {
-  'foundry' : 'adobe',
-  'family' : 'courier',
-  'registry' : '',
-  'charset' : 'iso8859',
-  'encoding' : '1',
-  'spacing' : 'm',
-  'slant' : 'normal',
-  'width' : 'normal',
-  'weight' : 'normal',
-}
-
-_propertyAliases['Courier'] = {
-  ('weight', 'normal') : 'medium',
-  ('weight', 'light') : 'medium',
-  ('style', None) : '',
-}
-
-_fontInfo['Typewriter'] = {
-  'foundry' : 'b&amp;h',
-  'family' : 'lucidatypewriter',
-  'registry' : '',
-  'charset' : 'iso8859',
-  'encoding' : '1',
-  'spacing' : 'm',
-  'slant' : 'normal',
-  'width' : 'normal',
-  'weight' : 'normal',
-}
-
-_propertyAliases['Typewriter'] = {
-  ('weight', 'normal') : 'medium',
-  ('weight', 'light') : 'medium',
-}
-
-if os.name == 'nt':
-    # For some reason 'fixed' fonts on NT aren't.
-    _fontInfo['Fixed'] = _fontInfo['Courier']
-    _propertyAliases['Fixed'] = _propertyAliases['Courier']

Deleted: branches/map65/PmwBlt.py
===================================================================
--- branches/map65/PmwBlt.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/PmwBlt.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,643 +0,0 @@
-# Python interface to some of the commands of the 2.4 version of the
-# BLT extension to tcl.
-
-import string
-import types
-import Tkinter
-
-# Supported commands:
-_busyCommand = '::blt::busy'
-_vectorCommand = '::blt::vector'
-_graphCommand = '::blt::graph'
-_testCommand = '::blt::*'
-_chartCommand = '::blt::stripchart'
-_tabsetCommand = '::blt::tabset'
-
-_haveBlt = None
-_haveBltBusy = None
-
-def _checkForBlt(window):
-    global _haveBlt
-    global _haveBltBusy
-
-    # Blt may be a package which has not yet been loaded. Try to load it.
-    try:
-	window.tk.call('package', 'require', 'BLT')
-    except Tkinter.TclError:
-	# Another way to try to dynamically load blt:
-	try:
-	    window.tk.call('load', '', 'Blt')
-	except Tkinter.TclError:
-	    pass
-
-    _haveBlt= (window.tk.call('info', 'commands', _testCommand) != '')
-    _haveBltBusy = (window.tk.call('info', 'commands', _busyCommand) != '')
-
-def haveblt(window):
-    if _haveBlt is None:
-	_checkForBlt(window)
-    return _haveBlt
-
-def havebltbusy(window):
-    if _haveBlt is None:
-	_checkForBlt(window)
-    return _haveBltBusy
-
-def _loadBlt(window):
-    if _haveBlt is None:
-	if window is None:
-	    window = Tkinter._default_root
-	    if window is None:
-	    	window = Tkinter.Tk()
-	_checkForBlt(window)
-
-def busy_hold(window, cursor = None):
-    _loadBlt(window)
-    if cursor is None:
-        window.tk.call(_busyCommand, 'hold', window._w)
-    else:
-        window.tk.call(_busyCommand, 'hold', window._w, '-cursor', cursor)
-
-def busy_release(window):
-    _loadBlt(window)
-    window.tk.call(_busyCommand, 'release', window._w)
-
-def busy_forget(window):
-    _loadBlt(window)
-    window.tk.call(_busyCommand, 'forget', window._w)
-
-#=============================================================================
-# Interface to the blt vector command which makes it look like the
-# builtin python list type.
-# The -variable, -command, -watchunset creation options are not supported.
-# The dup, merge, notify, offset, populate, seq and variable methods
-# and the +, -, * and / operations are not supported.
-
-# Blt vector functions:
-def vector_expr(expression):
-    tk = Tkinter._default_root.tk
-    strList = tk.splitlist(tk.call(_vectorCommand, 'expr', expression))
-    return tuple(map(string.atof, strList))
-
-def vector_names(pattern = None):
-    tk = Tkinter._default_root.tk
-    return tk.splitlist(tk.call(_vectorCommand, 'names', pattern))
-
-class Vector:
-    _varnum = 0
-    def __init__(self, size=None, master=None):
-        # &lt;size&gt; can be either an integer size, or a string &quot;first:last&quot;.
-	_loadBlt(master)
-	if master:
-	    self._master = master
-	else:
-	    self._master = Tkinter._default_root
-	self.tk = self._master.tk
-	self._name = 'PY_VEC' + str(Vector._varnum)
-	Vector._varnum = Vector._varnum + 1
-	if size is None:
-	    self.tk.call(_vectorCommand, 'create', self._name)
-	else:
-	  self.tk.call(_vectorCommand, 'create', '%s(%s)' % (self._name, size))
-    def __del__(self):
-	self.tk.call(_vectorCommand, 'destroy', self._name)
-    def __str__(self):
-	return self._name
-
-    def __repr__(self):
-	return '[' + string.join(map(str, self), ', ') + ']'
-    def __cmp__(self, list):
-	return cmp(self[:], list)
-
-    def __len__(self): 
-	return self.tk.getint(self.tk.call(self._name, 'length'))
-    def __getitem__(self, key): 
-	oldkey = key
-	if key &lt; 0:
-	    key = key + len(self)
-	try:
-	    return self.tk.getdouble(self.tk.globalgetvar(self._name, str(key)))
-        except Tkinter.TclError:
-	    raise IndexError, oldkey
-    def __setitem__(self, key, value): 
-	if key &lt; 0:
-	    key = key + len(self)
-	return self.tk.globalsetvar(self._name, str(key), float(value))
-
-    def __delitem__(self, key):
-	if key &lt; 0:
-	    key = key + len(self)
-	return self.tk.globalunsetvar(self._name, str(key))
-
-    def __getslice__(self, start, end):
-	length = len(self)
-	if start &lt; 0:
-	    start = 0
-	if end &gt; length:
-	    end = length
-	if start &gt;= end:
-	    return []
-	end = end - 1  # Blt vector slices include end point.
-	text = self.tk.globalgetvar(self._name, str(start) + ':' + str(end))
-	return map(self.tk.getdouble, self.tk.splitlist(text))
-
-    def __setslice__(self, start, end, list):
-	if start &gt; end:
-	    end = start
-	self.set(self[:start] + list + self[end:])
-
-    def __delslice__(self, start, end):
-	if start &lt; end:
-	    self.set(self[:start] + self[end:])
-
-    def __add__(self, list):
-	return self[:] + list
-    def __radd__(self, list):
-	return list + self[:]
-    def __mul__(self, n):
-	return self[:] * n
-    __rmul__ = __mul__
-
-    # Python builtin list methods:
-    def append(self, *args):
-	self.tk.call(self._name, 'append', args)
-    def count(self, obj):
-	return self[:].count(obj)
-    def index(self, value):
-	return self[:].index(value)
-    def insert(self, index, value):
-	self[index:index] = [value]
-    def remove(self, value):
-	del self[self.index(value)]
-    def reverse(self):
-	s = self[:]
-	s.reverse()
-	self.set(s)
-    def sort(self, *args):
-	s = self[:]
-	s.sort()
-	self.set(s)
-
-    # Blt vector instance methods:
-    # append - same as list method above
-    def clear(self):
-	self.tk.call(self._name, 'clear')
-    def delete(self, *args):
-	self.tk.call((self._name, 'delete') + args)
-    def expr(self, expression):
-	self.tk.call(self._name, 'expr', expression)
-    def length(self, newSize=None): 
-	return self.tk.getint(self.tk.call(self._name, 'length', newSize))
-    def range(self, first, last=None):
-	# Note that, unlike self[first:last], this includes the last
-	# item in the returned range.
-	text = self.tk.call(self._name, 'range', first, last)
-	return map(self.tk.getdouble, self.tk.splitlist(text))
-    def search(self, start, end=None):
-	return self._master._getints(self.tk.call(
-		self._name, 'search', start, end))
-    def set(self, list):
-	if type(list) != types.TupleType:
-	    list = tuple(list)
-	self.tk.call(self._name, 'set', list)
-
-    # The blt vector sort method has different semantics to the python
-    # list sort method.  Call these blt_sort:
-    def blt_sort(self, *args):
-	self.tk.call((self._name, 'sort') + args)
-    def blt_sort_reverse(self, *args):
-	self.tk.call((self._name, 'sort', '-reverse') + args)
-
-    # Special blt vector indexes:
-    def min(self):
-	return self.tk.getdouble(self.tk.globalgetvar(self._name, 'min'))
-    def max(self):
-	return self.tk.getdouble(self.tk.globalgetvar(self._name, 'max'))
-
-    # Method borrowed from Tkinter.Var class:
-    def get(self):
-	return self[:]
-
-#=============================================================================
-
-# This is a general purpose configure routine which can handle the
-# configuration of widgets, items within widgets, etc.  Supports the
-# forms configure() and configure('font') for querying and
-# configure(font = 'fixed', text = 'hello') for setting.
-
-def _doConfigure(widget, subcommand, option, kw):
-
-    if not option and not kw:
-        # Return a description of all options.
-        ret = {}
-        options = widget.tk.splitlist(widget.tk.call(subcommand))
-        for optionString in options:
-            optionInfo = widget.tk.splitlist(optionString)
-            option = optionInfo[0][1:]
-            ret[option] = (option,) + optionInfo[1:]
-        return ret
-
-    if option:
-        # Return a description of the option given by &lt;option&gt;.
-        if kw:
-            # Having keywords implies setting configuration options.
-            # Can't set and get in one command!
-            raise ValueError, 'cannot have option argument with keywords'
-        option = '-' + option
-        optionInfo = widget.tk.splitlist(widget.tk.call(subcommand + (option,)))
-        return (optionInfo[0][1:],) + optionInfo[1:]
-
-    # Otherwise, set the given configuration options.
-    widget.tk.call(subcommand + widget._options(kw))
-
-#=============================================================================
-
-class Graph(Tkinter.Widget):
-    # Wrapper for the blt graph widget, version 2.4.
-
-    def __init__(self, master=None, cnf={}, **kw):
-	_loadBlt(master)
-	Tkinter.Widget.__init__(self, master, _graphCommand, cnf, kw)
-
-    def bar_create(self, name, **kw):
-	self.tk.call((self._w, 'bar', 'create', name) + self._options(kw))
-
-    def line_create(self, name, **kw):
-	self.tk.call((self._w, 'line', 'create', name) + self._options(kw))
-
-    def extents(self, item):
-	return self.tk.getint(self.tk.call(self._w, 'extents', item))
-
-    def invtransform(self, winX, winY):
-	return self._getdoubles(
-		self.tk.call(self._w, 'invtransform', winX, winY))
-
-    def inside(self, x, y):
-	return self.tk.getint(self.tk.call(self._w, 'inside', x, y))
-
-    def snap(self, photoName):
-	self.tk.call(self._w, 'snap', photoName)
-
-    def transform(self, x, y):
-	return self._getdoubles(self.tk.call(self._w, 'transform', x, y))
-
-    def axis_cget(self, axisName, key):
-	return self.tk.call(self._w, 'axis', 'cget', axisName, '-' + key)
-    def axis_configure(self, axes, option=None, **kw):
-        # &lt;axes&gt; may be a list of axisNames.
-	if type(axes) == types.StringType:
-            axes = [axes]
-	subcommand = (self._w, 'axis', 'configure') + tuple(axes)
-	return _doConfigure(self, subcommand, option, kw)
-    def axis_create(self, axisName, **kw):
-	self.tk.call((self._w, 'axis', 'create', axisName) + self._options(kw))
-    def axis_delete(self, *args):
-	self.tk.call((self._w, 'axis', 'delete') + args)
-    def axis_invtransform(self, axisName, value):
-	return self.tk.getdouble(self.tk.call(
-		self._w, 'axis', 'invtransform', axisName, value))
-    def axis_limits(self, axisName):
-	return self._getdoubles(self.tk.call(
-		self._w, 'axis', 'limits', axisName))
-    def axis_names(self, *args):
-        return self.tk.splitlist(
-                self.tk.call((self._w, 'axis', 'names') + args))
-    def axis_transform(self, axisName, value):
-	return self.tk.getint(self.tk.call(
-		self._w, 'axis', 'transform', axisName, value))
-
-    def xaxis_cget(self, key):
-	return self.tk.call(self._w, 'xaxis', 'cget', '-' + key)
-    def xaxis_configure(self, option=None, **kw):
-	subcommand = (self._w, 'xaxis', 'configure')
-	return _doConfigure(self, subcommand, option, kw)
-    def xaxis_invtransform(self, value):
-	return self.tk.getdouble(self.tk.call(
-		self._w, 'xaxis', 'invtransform', value))
-    def xaxis_limits(self):
-	return self._getdoubles(self.tk.call(self._w, 'xaxis', 'limits'))
-    def xaxis_transform(self, value):
-	return self.tk.getint(self.tk.call(
-		self._w, 'xaxis', 'transform', value))
-    def xaxis_use(self, axisName = None):
-	return self.tk.call(self._w, 'xaxis', 'use', axisName)
-
-    def x2axis_cget(self, key):
-	return self.tk.call(self._w, 'x2axis', 'cget', '-' + key)
-    def x2axis_configure(self, option=None, **kw):
-	subcommand = (self._w, 'x2axis', 'configure')
-	return _doConfigure(self, subcommand, option, kw)
-    def x2axis_invtransform(self, value):
-	return self.tk.getdouble(self.tk.call(
-		self._w, 'x2axis', 'invtransform', value))
-    def x2axis_limits(self):
-	return self._getdoubles(self.tk.call(self._w, 'x2axis', 'limits'))
-    def x2axis_transform(self, value):
-	return self.tk.getint(self.tk.call(
-		self._w, 'x2axis', 'transform', value))
-    def x2axis_use(self, axisName = None):
-	return self.tk.call(self._w, 'x2axis', 'use', axisName)
-
-    def yaxis_cget(self, key):
-	return self.tk.call(self._w, 'yaxis', 'cget', '-' + key)
-    def yaxis_configure(self, option=None, **kw):
-	subcommand = (self._w, 'yaxis', 'configure')
-	return _doConfigure(self, subcommand, option, kw)
-    def yaxis_invtransform(self, value):
-	return self.tk.getdouble(self.tk.call(
-		self._w, 'yaxis', 'invtransform', value))
-    def yaxis_limits(self):
-	return self._getdoubles(self.tk.call(self._w, 'yaxis', 'limits'))
-    def yaxis_transform(self, value):
-	return self.tk.getint(self.tk.call(
-		self._w, 'yaxis', 'transform', value))
-    def yaxis_use(self, axisName = None):
-	return self.tk.call(self._w, 'yaxis', 'use', axisName)
-
-    def y2axis_cget(self, key):
-	return self.tk.call(self._w, 'y2axis', 'cget', '-' + key)
-    def y2axis_configure(self, option=None, **kw):
-	subcommand = (self._w, 'y2axis', 'configure')
-	return _doConfigure(self, subcommand, option, kw)
-    def y2axis_invtransform(self, value):
-	return self.tk.getdouble(self.tk.call(
-		self._w, 'y2axis', 'invtransform', value))
-    def y2axis_limits(self):
-	return self._getdoubles(self.tk.call(self._w, 'y2axis', 'limits'))
-    def y2axis_transform(self, value):
-	return self.tk.getint(self.tk.call(
-		self._w, 'y2axis', 'transform', value))
-    def y2axis_use(self, axisName = None):
-	return self.tk.call(self._w, 'y2axis', 'use', axisName)
-
-    def crosshairs_cget(self, key):
-	return self.tk.call(self._w, 'crosshairs', 'cget', '-' + key)
-    def crosshairs_configure(self, option=None, **kw):
-	subcommand = (self._w, 'crosshairs', 'configure')
-	return _doConfigure(self, subcommand, option, kw)
-    def crosshairs_off(self):
-	self.tk.call(self._w, 'crosshairs', 'off')
-    def crosshairs_on(self):
-	self.tk.call(self._w, 'crosshairs', 'on')
-    def crosshairs_toggle(self):
-	self.tk.call(self._w, 'crosshairs', 'toggle')
-
-    def element_activate(self, name, *args):
-	self.tk.call((self._w, 'element', 'activate', name) + args)
-    def element_bind(self, tagName, sequence=None, func=None, add=None):
-        return self._bind((self._w, 'element', 'bind', tagName),
-                sequence, func, add)
-    def element_unbind(self, tagName, sequence, funcid=None):
-        self.tk.call(self._w, 'element', 'bind', tagName, sequence, '')
-        if funcid:
-            self.deletecommand(funcid)
-
-    def element_cget(self, name, key):
-	return self.tk.call(self._w, 'element', 'cget', name, '-' + key)
-
-    def element_closest(self, x, y, *args, **kw):
-        var = 'python_private_1'
-	success = self.tk.getint(self.tk.call(
-                (self._w, 'element', 'closest', x, y, var) +
-                        self._options(kw) + args))
-	if success:
-	    rtn = {}
-	    rtn['dist'] = self.tk.getdouble(self.tk.globalgetvar(var, 'dist'))
-	    rtn['x'] = self.tk.getdouble(self.tk.globalgetvar(var, 'x'))
-	    rtn['y'] = self.tk.getdouble(self.tk.globalgetvar(var, 'y'))
-	    rtn['index'] = self.tk.getint(self.tk.globalgetvar(var, 'index'))
-	    rtn['name'] = self.tk.globalgetvar(var, 'name')
-	    return rtn
-	else:
-	    return None
-
-    def element_configure(self, names, option=None, **kw):
-        # &lt;names&gt; may be a list of elemNames.
-	if type(names) == types.StringType:
-            names = [names]
-	subcommand = (self._w, 'element', 'configure') + tuple(names)
-	return _doConfigure(self, subcommand, option, kw)
-
-    def element_deactivate(self, *args):
-	self.tk.call((self._w, 'element', 'deactivate') + args)
-
-    def element_delete(self, *args):
-	self.tk.call((self._w, 'element', 'delete') + args)
-    def element_exists(self, name):
-	return self.tk.getboolean(
-		self.tk.call(self._w, 'element', 'exists', name))
-
-    def element_names(self, *args):
-        return self.tk.splitlist(
-                self.tk.call((self._w, 'element', 'names') + args))
-    def element_show(self, nameList=None):
-	if nameList is not None:
-	    nameList = tuple(nameList)
-	return self.tk.splitlist(
-		self.tk.call(self._w, 'element', 'show', nameList))
-    def element_type(self, name):
-	return self.tk.call(self._w, 'element', 'type', name)
-
-    def grid_cget(self, key):
-	return self.tk.call(self._w, 'grid', 'cget', '-' + key)
-    def grid_configure(self, option=None, **kw):
-	subcommand = (self._w, 'grid', 'configure')
-	return _doConfigure(self, subcommand, option, kw)
-
-    def grid_off(self):
-	self.tk.call(self._w, 'grid', 'off')
-    def grid_on(self):
-	self.tk.call(self._w, 'grid', 'on')
-    def grid_toggle(self):
-	self.tk.call(self._w, 'grid', 'toggle')
-
-    def legend_activate(self, *args):
-	self.tk.call((self._w, 'legend', 'activate') + args)
-    def legend_bind(self, tagName, sequence=None, func=None, add=None):
-        return self._bind((self._w, 'legend', 'bind', tagName),
-                sequence, func, add)
-    def legend_unbind(self, tagName, sequence, funcid=None):
-        self.tk.call(self._w, 'legend', 'bind', tagName, sequence, '')
-        if funcid:
-            self.deletecommand(funcid)
-
-    def legend_cget(self, key):
-	return self.tk.call(self._w, 'legend', 'cget', '-' + key)
-    def legend_configure(self, option=None, **kw):
-	subcommand = (self._w, 'legend', 'configure')
-	return _doConfigure(self, subcommand, option, kw)
-    def legend_deactivate(self, *args):
-	self.tk.call((self._w, 'legend', 'deactivate') + args)
-    def legend_get(self, pos):
-	return self.tk.call(self._w, 'legend', 'get', pos)
-
-    def pen_cget(self, name, key):
-	return self.tk.call(self._w, 'pen', 'cget', name, '-' + key)
-    def pen_configure(self, names, option=None, **kw):
-        # &lt;names&gt; may be a list of penNames.
-	if type(names) == types.StringType:
-            names = [names]
-	subcommand = (self._w, 'pen', 'configure') + tuple(names)
-	return _doConfigure(self, subcommand, option, kw)
-    def pen_create(self, name, **kw):
-	self.tk.call((self._w, 'pen', 'create', name) + self._options(kw))
-    def pen_delete(self, *args):
-	self.tk.call((self._w, 'pen', 'delete') + args)
-    def pen_names(self, *args):
-        return self.tk.splitlist(self.tk.call((self._w, 'pen', 'names') + args))
-
-    def postscript_cget(self, key):
-	return self.tk.call(self._w, 'postscript', 'cget', '-' + key)
-    def postscript_configure(self, option=None, **kw):
-	subcommand = (self._w, 'postscript', 'configure')
-	return _doConfigure(self, subcommand, option, kw)
-    def postscript_output(self, fileName=None, **kw):
-	prefix = (self._w, 'postscript', 'output')
-	if fileName is None:
-	    return self.tk.call(prefix + self._options(kw))
-	else:
-	    self.tk.call(prefix + (fileName,) + self._options(kw))
-
-    def marker_after(self, first, second=None):
-	self.tk.call(self._w, 'marker', 'after', first, second)
-    def marker_before(self, first, second=None):
-	self.tk.call(self._w, 'marker', 'before', first, second)
-    def marker_bind(self, tagName, sequence=None, func=None, add=None):
-        return self._bind((self._w, 'marker', 'bind', tagName),
-                sequence, func, add)
-    def marker_unbind(self, tagName, sequence, funcid=None):
-        self.tk.call(self._w, 'marker', 'bind', tagName, sequence, '')
-        if funcid:
-            self.deletecommand(funcid)
-
-    def marker_cget(self, name, key):
-	return self.tk.call(self._w, 'marker', 'cget', name, '-' + key)
-    def marker_configure(self, names, option=None, **kw):
-        # &lt;names&gt; may be a list of markerIds.
-	if type(names) == types.StringType:
-            names = [names]
-	subcommand = (self._w, 'marker', 'configure') + tuple(names)
-	return _doConfigure(self, subcommand, option, kw)
-    def marker_create(self, type, **kw):
-	return self.tk.call(
-                (self._w, 'marker', 'create', type) + self._options(kw))
-
-    def marker_delete(self, *args):
-	self.tk.call((self._w, 'marker', 'delete') + args)
-    def marker_exists(self, name):
-	return self.tk.getboolean(
-		self.tk.call(self._w, 'marker', 'exists', name))
-    def marker_names(self, *args):
-        return self.tk.splitlist(
-                self.tk.call((self._w, 'marker', 'names') + args))
-    def marker_type(self, name):
-	type = self.tk.call(self._w, 'marker', 'type', name)
-	if type == '':
-	    type = None
-	return type
-
-#=============================================================================
-class Stripchart(Graph):
-    # Wrapper for the blt stripchart widget, version 2.4.
-
-    def __init__(self, master=None, cnf={}, **kw):
-	_loadBlt(master)
-	Tkinter.Widget.__init__(self, master, _chartCommand, cnf, kw)
-
-#=============================================================================
-class Tabset(Tkinter.Widget): 
-
-    # Wrapper for the blt TabSet widget, version 2.4.
-
-    def __init__(self, master=None, cnf={}, **kw):
-	_loadBlt(master)
-	Tkinter.Widget.__init__(self, master, _tabsetCommand, cnf, kw)
-
-    def activate(self, tabIndex):
-        self.tk.call(self._w, 'activate', tabIndex)
-
-    # This is the 'bind' sub-command:
-    def tag_bind(self, tagName, sequence=None, func=None, add=None):
-        return self._bind((self._w, 'bind', tagName), sequence, func, add)
-
-    def tag_unbind(self, tagName, sequence, funcid=None):
-        self.tk.call(self._w, 'bind', tagName, sequence, '')
-        if funcid:
-            self.deletecommand(funcid)
-
-    def delete(self, first, last = None):
-    	self.tk.call(self._w, 'delete', first, last)
-
-    # This is the 'focus' sub-command:
-    def tab_focus(self, tabIndex):
-    	self.tk.call(self._w, 'focus', tabIndex)
-    	
-    def get(self, tabIndex):
-	return self.tk.call(self._w, 'get', tabIndex)
-
-    def index(self, tabIndex):
-	index = self.tk.call(self._w, 'index', tabIndex)
-        if index == '':
-            return None
-        else:
-            return self.tk.getint(self.tk.call(self._w, 'index', tabIndex))
-
-    def insert(self, position, name1, *names, **kw):
-	self.tk.call(
-            (self._w, 'insert', position, name1) + names + self._options(kw))
-
-    def invoke(self, tabIndex):
-    	return self.tk.call(self._w, 'invoke', tabIndex)
-
-    def move(self, tabIndex1, beforeOrAfter, tabIndex2):
-    	self.tk.call(self._w, 'move', tabIndex1, beforeOrAfter, tabIndex2)
-    	
-    def nearest(self, x, y):
-    	return self.tk.call(self._w, 'nearest', x, y)
-
-    def scan_mark(self, x, y):
-        self.tk.call(self._w, 'scan', 'mark', x, y)
-
-    def scan_dragto(self, x, y):
-        self.tk.call(self._w, 'scan', 'dragto', x, y)
-
-    def see(self, index):
-        self.tk.call(self._w, 'see', index)
-    	
-    def see(self, tabIndex):
-    	self.tk.call(self._w,'see',tabIndex)
-    	
-    def size(self):
-	return self.tk.getint(self.tk.call(self._w, 'size'))
-
-    def tab_cget(self, tabIndex, option):
-        if option[:1] != '-':
-            option = '-' + option
-        if option[-1:] == '_':
-            option = option[:-1]
-        return self.tk.call(self._w, 'tab', 'cget', tabIndex, option)
-
-    def tab_configure(self, tabIndexes, option=None, **kw):
-        # &lt;tabIndexes&gt; may be a list of tabs.
-	if type(tabIndexes) in (types.StringType, types.IntType):
-            tabIndexes = [tabIndexes]
-	subcommand = (self._w, 'tab', 'configure') + tuple(tabIndexes)
-	return _doConfigure(self, subcommand, option, kw)
-
-    def tab_names(self, *args):
-        return self.tk.splitlist(self.tk.call((self._w, 'tab', 'names') + args))
-
-    def tab_tearoff(self, tabIndex, newName = None):
-        if newName is None:
-            name = self.tk.call(self._w, 'tab', 'tearoff', tabIndex)
-            return self.nametowidget(name)
-        else:
-            self.tk.call(self._w, 'tab', 'tearoff', tabIndex, newName)
-
-    def view(self):
-        s = self.tk.call(self._w, 'view')
-        return tuple(map(self.tk.getint, self.tk.splitlist(s)))
-    def view_moveto(self, fraction):
-        self.tk.call(self._w, 'view', 'moveto', fraction)
-    def view_scroll(self, number, what):
-        self.tk.call(self._w, 'view', 'scroll', number, what)

Deleted: branches/map65/PmwColor.py
===================================================================
--- branches/map65/PmwColor.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/PmwColor.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,361 +0,0 @@
-# Functions for converting colors and modifying the color scheme of
-# an application.
-
-import math
-import string
-import sys
-import Tkinter
-
-_PI = math.pi
-_TWO_PI = _PI * 2
-_THIRD_PI = _PI / 3
-_SIXTH_PI = _PI / 6
-_MAX_RGB = float(256 * 256 - 1) # max size of rgb values returned from Tk
-
-def setscheme(root, background=None, **kw):
-    root = root._root()
-    palette = apply(_calcPalette, (root, background,), kw)
-    for option, value in palette.items():
-	root.option_add('*' + option, value, 'widgetDefault')
-
-def getdefaultpalette(root):
-    # Return the default values of all options, using the defaults
-    # from a few widgets.
-
-    ckbtn = Tkinter.Checkbutton(root)
-    entry = Tkinter.Entry(root)
-    scbar = Tkinter.Scrollbar(root)
-
-    orig = {}
-    orig['activeBackground'] = str(ckbtn.configure('activebackground')[4])
-    orig['activeForeground'] = str(ckbtn.configure('activeforeground')[4])
-    orig['background'] = str(ckbtn.configure('background')[4])
-    orig['disabledForeground'] = str(ckbtn.configure('disabledforeground')[4])
-    orig['foreground'] = str(ckbtn.configure('foreground')[4])
-    orig['highlightBackground'] = str(ckbtn.configure('highlightbackground')[4])
-    orig['highlightColor'] = str(ckbtn.configure('highlightcolor')[4])
-    orig['insertBackground'] = str(entry.configure('insertbackground')[4])
-    orig['selectColor'] = str(ckbtn.configure('selectcolor')[4])
-    orig['selectBackground'] = str(entry.configure('selectbackground')[4])
-    orig['selectForeground'] = str(entry.configure('selectforeground')[4])
-    orig['troughColor'] = str(scbar.configure('troughcolor')[4])
-
-    ckbtn.destroy()
-    entry.destroy()
-    scbar.destroy()
-
-    return orig
-
-#======================================================================
-
-# Functions dealing with brightness, hue, saturation and intensity of colors.
-
-def changebrightness(root, colorName, brightness):
-    # Convert the color name into its hue and back into a color of the
-    # required brightness.
-
-    rgb = name2rgb(root, colorName)
-    hue, saturation, intensity = rgb2hsi(rgb)
-    if saturation == 0.0:
-        hue = None
-    return hue2name(hue, brightness)
-
-def hue2name(hue, brightness = None):
-    # Convert the requested hue and brightness into a color name.  If
-    # hue is None, return a grey of the requested brightness.
-
-    if hue is None:
-	rgb = hsi2rgb(0.0, 0.0, brightness)
-    else:
-	while hue &lt; 0:
-	    hue = hue + _TWO_PI
-	while hue &gt;= _TWO_PI:
-	    hue = hue - _TWO_PI
-
-	rgb = hsi2rgb(hue, 1.0, 1.0)
-	if brightness is not None:
-	    b = rgb2brightness(rgb)
-	    i = 1.0 - (1.0 - brightness) * b
-	    s = bhi2saturation(brightness, hue, i)
-	    rgb = hsi2rgb(hue, s, i)
-
-    return rgb2name(rgb)
-
-def bhi2saturation(brightness, hue, intensity):
-    while hue &lt; 0:
-        hue = hue + _TWO_PI
-    while hue &gt;= _TWO_PI:
-        hue = hue - _TWO_PI
-    hue = hue / _THIRD_PI
-    f = hue - math.floor(hue)
-
-    pp = intensity
-    pq = intensity * f
-    pt = intensity - intensity * f
-    pv = 0
-
-    hue = int(hue)
-    if   hue == 0: rgb = (pv, pt, pp)
-    elif hue == 1: rgb = (pq, pv, pp)
-    elif hue == 2: rgb = (pp, pv, pt)
-    elif hue == 3: rgb = (pp, pq, pv)
-    elif hue == 4: rgb = (pt, pp, pv)
-    elif hue == 5: rgb = (pv, pp, pq)
-
-    return (intensity - brightness) / rgb2brightness(rgb)
-
-def hsi2rgb(hue, saturation, intensity):
-    i = intensity
-    if saturation == 0:
-	rgb = [i, i, i]
-    else:
-	while hue &lt; 0:
-	    hue = hue + _TWO_PI
-	while hue &gt;= _TWO_PI:
-	    hue = hue - _TWO_PI
-	hue = hue / _THIRD_PI
-	f = hue - math.floor(hue)
-	p = i * (1.0 - saturation)
-	q = i * (1.0 - saturation * f)
-	t = i * (1.0 - saturation * (1.0 - f))
-
-	hue = int(hue)
-	if   hue == 0: rgb = [i, t, p]
-	elif hue == 1: rgb = [q, i, p]
-	elif hue == 2: rgb = [p, i, t]
-	elif hue == 3: rgb = [p, q, i]
-	elif hue == 4: rgb = [t, p, i]
-	elif hue == 5: rgb = [i, p, q]
-
-    for index in range(3):
-	val = rgb[index]
-	if val &lt; 0.0:
-	    val = 0.0
-	if val &gt; 1.0:
-	    val = 1.0
-	rgb[index] = val
-
-    return rgb
-
-def average(rgb1, rgb2, fraction):
-    return (
-	rgb2[0] * fraction + rgb1[0] * (1.0 - fraction),
-	rgb2[1] * fraction + rgb1[1] * (1.0 - fraction),
-	rgb2[2] * fraction + rgb1[2] * (1.0 - fraction)
-    )
-
-def rgb2name(rgb):
-    return '#%02x%02x%02x' % \
-        (int(rgb[0] * 255), int(rgb[1] * 255), int(rgb[2] * 255))
-
-def rgb2brightness(rgb):
-    # Return the perceived grey level of the color
-    # (0.0 == black, 1.0 == white).
-
-    rf = 0.299
-    gf = 0.587
-    bf = 0.114
-    return rf * rgb[0] + gf * rgb[1] + bf * rgb[2]
-
-def rgb2hsi(rgb):
-    maxc = max(rgb[0], rgb[1], rgb[2])
-    minc = min(rgb[0], rgb[1], rgb[2])
-
-    intensity = maxc
-    if maxc != 0:
-      saturation  = (maxc - minc) / maxc
-    else:
-      saturation = 0.0
-
-    hue = 0.0
-    if saturation != 0.0:
-	c = []
-	for index in range(3):
-	    c.append((maxc - rgb[index]) / (maxc - minc))
-
-	if rgb[0] == maxc:
-	    hue = c[2] - c[1]
-	elif rgb[1] == maxc:
-	    hue = 2 + c[0] - c[2]
-	elif rgb[2] == maxc:
-	    hue = 4 + c[1] - c[0]
-
-	hue = hue * _THIRD_PI
-	if hue &lt; 0.0:
-	    hue = hue + _TWO_PI
-
-    return (hue, saturation, intensity)
-
-def name2rgb(root, colorName, asInt = 0):
-    if colorName[0] == '#':
-	# Extract rgb information from the color name itself, assuming
-	# it is either #rgb, #rrggbb, #rrrgggbbb, or #rrrrggggbbbb
-	# This is useful, since tk may return incorrect rgb values if
-	# the colormap is full - it will return the rbg values of the
-	# closest color available.
-        colorName = colorName[1:]
-        digits = len(colorName) / 3
-        factor = 16 ** (4 - digits)
-        rgb = (
-            string.atoi(colorName[0:digits], 16) * factor,
-            string.atoi(colorName[digits:digits * 2], 16) * factor,
-            string.atoi(colorName[digits * 2:digits * 3], 16) * factor,
-        )
-    else:
-	# We have no choice but to ask Tk what the rgb values are.
-	rgb = root.winfo_rgb(colorName)
-
-    if not asInt:
-        rgb = (rgb[0] / _MAX_RGB, rgb[1] / _MAX_RGB, rgb[2] / _MAX_RGB)
-    return rgb
-
-def _calcPalette(root, background=None, **kw):
-    # Create a map that has the complete new palette.  If some colors
-    # aren't specified, compute them from other colors that are specified.
-    new = {}
-    for key, value in kw.items():
-	new[key] = value
-    if background is not None:
-	new['background'] = background
-    if not new.has_key('background'):
-	raise ValueError, 'must specify a background color'
-
-    if not new.has_key('foreground'):
-	new['foreground'] = 'black'
-
-    bg = name2rgb(root, new['background'])
-    fg = name2rgb(root, new['foreground'])
-
-    for i in ('activeForeground', 'insertBackground', 'selectForeground',
-	    'highlightColor'):
-	if not new.has_key(i):
-	    new[i] = new['foreground']
-
-    if not new.has_key('disabledForeground'):
-	newCol = average(bg, fg, 0.3)
-	new['disabledForeground'] = rgb2name(newCol)
-
-    if not new.has_key('highlightBackground'):
-	new['highlightBackground'] = new['background']
-
-    # Set &lt;lighterBg&gt; to a color that is a little lighter that the
-    # normal background.  To do this, round each color component up by
-    # 9% or 1/3 of the way to full white, whichever is greater.
-    lighterBg = []
-    for i in range(3):
-	lighterBg.append(bg[i])
-	inc1 = lighterBg[i] * 0.09
-	inc2 = (1.0 - lighterBg[i]) / 3
-	if inc1 &gt; inc2:
-	    lighterBg[i] = lighterBg[i] + inc1
-	else:
-	    lighterBg[i] = lighterBg[i] + inc2
-	if lighterBg[i] &gt; 1.0:
-	    lighterBg[i] = 1.0
-
-    # Set &lt;darkerBg&gt; to a color that is a little darker that the
-    # normal background.
-    darkerBg = (bg[0] * 0.9, bg[1] * 0.9, bg[2] * 0.9)
-
-    if not new.has_key('activeBackground'):
-	# If the foreground is dark, pick a light active background.
-	# If the foreground is light, pick a dark active background.
-	# XXX This has been disabled, since it does not look very
-	# good with dark backgrounds. If this is ever fixed, the
-	# selectBackground and troughColor options should also be fixed.
-
-	if rgb2brightness(fg) &lt; 0.5:
-	    new['activeBackground'] = rgb2name(lighterBg)
-	else:
-	    new['activeBackground'] = rgb2name(lighterBg)
-
-    if not new.has_key('selectBackground'):
-	new['selectBackground'] = rgb2name(darkerBg)
-    if not new.has_key('troughColor'):
-	new['troughColor'] = rgb2name(darkerBg)
-    if not new.has_key('selectColor'):
-	new['selectColor'] = 'yellow'
-
-    return new
-
-def spectrum(numColors, correction = 1.0, saturation = 1.0, intensity = 1.0,
-	extraOrange = 1, returnHues = 0):
-    colorList = []
-    division = numColors / 7.0
-    for index in range(numColors):
-	if extraOrange:
-	    if index &lt; 2 * division:
-		hue = index / division
-	    else:
-		hue = 2 + 2 * (index - 2 * division) / division
-	    hue = hue * _SIXTH_PI
-	else:
-	    hue = index * _TWO_PI / numColors
-	if returnHues:
-	    colorList.append(hue)
-	else:
-	    rgb = hsi2rgb(hue, saturation, intensity)
-	    if correction != 1.0:
-		rgb = correct(rgb, correction)
-	    name = rgb2name(rgb)
-	    colorList.append(name)
-    return colorList
-
-def correct(rgb, correction):
-    correction = float(correction)
-    rtn = []
-    for index in range(3):
-	rtn.append((1 - (1 - rgb[index]) ** correction) ** (1 / correction))
-    return rtn
-
-#==============================================================================
-
-def _recolorTree(widget, oldpalette, newcolors):
-    # Change the colors in a widget and its descendants.
-
-    # Change the colors in &lt;widget&gt; and all of its descendants,
-    # according to the &lt;newcolors&gt; dictionary.  It only modifies
-    # colors that have their default values as specified by the
-    # &lt;oldpalette&gt; variable.  The keys of the &lt;newcolors&gt; dictionary
-    # are named after widget configuration options and the values are
-    # the new value for that option.
-
-    for dbOption in newcolors.keys():
-        option = string.lower(dbOption)
-        try:
-            value = str(widget.cget(option))
-        except:
-            continue
-        if oldpalette is None or value == oldpalette[dbOption]:
-            apply(widget.configure, (), {option : newcolors[dbOption]})
-
-    for child in widget.winfo_children():
-       _recolorTree(child, oldpalette, newcolors)
-
-def changecolor(widget, background=None, **kw):
-     root = widget._root()
-     if not hasattr(widget, '_Pmw_oldpalette'):
-	 widget._Pmw_oldpalette = getdefaultpalette(root)
-     newpalette = apply(_calcPalette, (root, background,), kw)
-     _recolorTree(widget, widget._Pmw_oldpalette, newpalette)
-     widget._Pmw_oldpalette = newpalette
-
-def bordercolors(root, colorName):
-    # This is the same method that Tk uses for shadows, in TkpGetShadows.
-
-    lightRGB = []
-    darkRGB = []
-    for value in name2rgb(root, colorName, 1):
-        value40pc = (14 * value) / 10
-        if value40pc &gt; _MAX_RGB:
-            value40pc = _MAX_RGB
-        valueHalfWhite = (_MAX_RGB + value) / 2;
-        lightRGB.append(max(value40pc, valueHalfWhite))
-
-        darkValue = (60 * value) / 100
-        darkRGB.append(darkValue)
-
-    return (
-        '#%04x%04x%04x' % (lightRGB[0], lightRGB[1], lightRGB[2]),
-        '#%04x%04x%04x' % (darkRGB[0], darkRGB[1], darkRGB[2])
-    )

Added: branches/map65/QtSupport.iss
===================================================================
--- branches/map65/QtSupport.iss	                        (rev 0)
+++ branches/map65/QtSupport.iss	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,10 @@
+[Setup]
+AppName=&quot;QtSupport for MAP65&quot;
+AppVerName=QtSupport
+DefaultDirName=C:\MAP65
+
+[Files]
+Source: &quot;c:\Users\joe\map65\QtSupport\*.dll&quot;;           DestDir: &quot;{app}&quot;;  Flags: onlyifdoesntexist
+
+
+

Deleted: branches/map65/TSKY.DAT
===================================================================
(Binary files differ)

Deleted: branches/map65/a2d.f90
===================================================================
--- branches/map65/a2d.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/a2d.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,35 +0,0 @@
-subroutine a2d(iarg)
-
-! Start the PortAudio streams for audio input and output.
-  integer nchin(0:20),nchout(0:20)
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-
-! This call does not normally return, as the background portion of
-! JTaudio goes into a test-and-sleep loop.
-
-  call cs_lock('a2d')
-  write(*,1000)
-1000 format('Using Linrad for input, PortAudio for output.')
-  idevout=ndevout
-  call padevsub(numdevs,ndefin,ndefout,nchin,nchout)
-  
-  write(*,1002) ndefout
-1002 format(/'Default Output:',i3)
-  write(*,1004) idevout
-1004 format('Requested Output:',i3)
-  if(idevout.lt.0 .or. idevout.ge.numdevs) idevout=ndefout
-  if(idevout.eq.0) idevout=ndefout
-  idevin=0
-  call cs_unlock
-  ierr=jtaudio(idevin,idevout,y1,y2,NMAX,iwrite,iwave,nwave,    &amp;
-       11025,NSPB,TRPeriod,TxOK,ndebug,Transmitting,            &amp;
-       Tsec,ngo,nmode,tbuf,ibuf,ndsec)
-  if(ierr.ne.0) then
-     print*,'Error ',ierr,' in JTaudio, cannot continue.'
-  else
-     write(*,1006) 
-1006 format('Audio output stream terminated normally.')
-  endif
-  return
-end subroutine a2d

Added: branches/map65/about.cpp
===================================================================
--- branches/map65/about.cpp	                        (rev 0)
+++ branches/map65/about.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,23 @@
+#include &quot;about.h&quot;
+#include &quot;ui_about.h&quot;
+
+CAboutDlg::CAboutDlg(QWidget *parent, QString Revision) :
+  QDialog(parent),
+  m_Revision(Revision),
+  ui(new Ui::CAboutDlg)
+{
+  ui-&gt;setupUi(this);
+  ui-&gt;labelTxt-&gt;clear();
+  m_Str  = &quot;&lt;html&gt;&lt;h2&gt;&quot; + m_Revision + &quot;&lt;/h2&gt;\n\n&quot;;
+  m_Str += &quot;MAP65 implements a wideband polarization-matching receiver &lt;br&gt;&quot;;
+  m_Str += &quot;for the JT65 protocol, with a matching transmitting facility. &lt;br&gt;&quot;;
+  m_Str += &quot;It is primarily intended for amateur radio EME communication. &lt;br&gt;&lt;br&gt;&quot;;
+  m_Str += &quot;Copyright 2001-2012 by Joe Taylor, K1JT.   Additional &lt;br&gt;&quot;;
+  m_Str += &quot;acknowledgments are contained in the source code. &lt;br&gt;&quot;;
+  ui-&gt;labelTxt-&gt;setText(m_Str);
+}
+
+CAboutDlg::~CAboutDlg()
+{
+  delete ui;
+}

Added: branches/map65/about.h
===================================================================
--- branches/map65/about.h	                        (rev 0)
+++ branches/map65/about.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,24 @@
+#ifndef ABOUTDLG_H
+#define ABOUTDLG_H
+
+#include &lt;QDialog&gt;
+
+namespace Ui {
+    class CAboutDlg;
+}
+
+class CAboutDlg : public QDialog
+{
+    Q_OBJECT
+
+public:
+	explicit CAboutDlg(QWidget *parent=0, QString Revision=&quot;&quot;);
+    ~CAboutDlg();
+
+private:
+	QString m_Revision;
+	Ui::CAboutDlg *ui;
+	QString m_Str;
+};
+
+#endif // ABOUTDLG_H

Added: branches/map65/about.ui
===================================================================
--- branches/map65/about.ui	                        (rev 0)
+++ branches/map65/about.ui	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,41 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;class&gt;CAboutDlg&lt;/class&gt;
+ &lt;widget class=&quot;QDialog&quot; name=&quot;CAboutDlg&quot;&gt;
+  &lt;property name=&quot;windowModality&quot;&gt;
+   &lt;enum&gt;Qt::NonModal&lt;/enum&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;374&lt;/width&gt;
+    &lt;height&gt;164&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;sizePolicy&quot;&gt;
+   &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Preferred&quot;&gt;
+    &lt;horstretch&gt;0&lt;/horstretch&gt;
+    &lt;verstretch&gt;0&lt;/verstretch&gt;
+   &lt;/sizepolicy&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;About MAP65&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;widget class=&quot;QLabel&quot; name=&quot;labelTxt&quot;&gt;
+   &lt;property name=&quot;geometry&quot;&gt;
+    &lt;rect&gt;
+     &lt;x&gt;20&lt;/x&gt;
+     &lt;y&gt;10&lt;/y&gt;
+     &lt;width&gt;331&lt;/width&gt;
+     &lt;height&gt;131&lt;/height&gt;
+    &lt;/rect&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string/&gt;
+   &lt;/property&gt;
+  &lt;/widget&gt;
+ &lt;/widget&gt;
+ &lt;resources/&gt;
+ &lt;connections/&gt;
+&lt;/ui&gt;

Deleted: branches/map65/aclocal.m4
===================================================================
--- branches/map65/aclocal.m4	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/aclocal.m4	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,220 +0,0 @@
-dnl {{{ ax_check_gfortran
-AC_DEFUN([AX_CHECK_GFORTRAN],[
-
-AC_ARG_ENABLE(g95,
-AC_HELP_STRING([--enable-g95],[Use G95 compiler if available.]),
-[g95=$enableval], [g95=no])
-
-AC_ARG_ENABLE(gfortran,
-AC_HELP_STRING([--enable-gfortran],[Use gfortran compiler if available.]),
-[gfortran=$enableval], [gfortran=no])
-
-dnl
-dnl Pick up FC from the environment if present
-dnl I'll add a test to confirm this is a gfortran later -db
-dnl
-
-FCV=&quot;&quot;
-
-if test -n $[{FC}] ; then
-	gfortran_name_part=`echo $[{FC}] | cut -c 1-8`
-	if test $[{gfortran_name_part}] = &quot;gfortran&quot; ; then
-		gfortran_name=$[{FC}]
-       		FC_LIB_PATH=`$[{FC}] -print-file-name=`
-		g95=no
-		gfortran=yes
-		FFLAGS=&quot;$[{FFLAGS_GFORTRAN}]&quot;
-		FCV=&quot;gnu95&quot;
-	else
-		unset $[{FC}]
-	fi
-fi
-
-dnl
-dnl Note regarding the apparent silliness with FCV.
-dnl The FCV value for g95 might be system dependent, this is
-dnl still to be fully explored. If not, then the FCV_G95
-dnl stuff can go away. -db
-dnl
-
-AC_MSG_CHECKING([uname -s])
-case `uname -s` in
-	CYGWIN*)
-		AC_MSG_RESULT(Cygwin)
-		CYGWIN=yes
-	;;
-	SunOS*)
-		AC_MSG_RESULT(SunOS or Solaris)
-		AC_DEFINE(__EXTENSIONS__, 1, [This is needed to use strtok_r on Solaris.])
-	;;
-dnl
-dnl Pick up current gfortran from ports infrastructure for fbsd
-dnl
-        FreeBSD*)
-		if test -z $[{gfortran_name}] ; then
-			gfortran_name=`grep FC: /usr/ports/Mk/bsd.gcc.mk | head -1 |awk '{print $[2]}'`
-		fi
-		FCV_G95=&quot;g95&quot;
-	;;
-	*)
-		FCV_G95=&quot;g95&quot;
-		AC_MSG_RESULT(no)
-	;;
-esac
-
-dnl
-dnl look for gfortran if nothing else was given
-dnl
-
-if test -z $[gfortran_name] ; then
-	gfortran_name=&quot;gfortran&quot;
-fi
-
-AC_PATH_PROG(G95, g95)
-AC_PATH_PROG(GFORTRAN, $[{gfortran_name}])
-
-if test ! -z $[{GFORTRAN}] ; then
-	echo &quot;*** gfortran compiler found at $[{GFORTRAN}]&quot;
-	if test &quot;$[{gfortran}]&quot; = yes; then
-       		FC_LIB_PATH=`$[{GFORTRAN}] -print-file-name=`
-		FC=`basename $[{GFORTRAN}]`
-		g95=no
-		FFLAGS=&quot;$[{FFLAGS_GFORTRAN}]&quot;
-		FCV=&quot;gnu95&quot;
-	fi
-else
-	echo &quot;*** No gfortran compiler found&quot;
-fi
-
-if test ! -z $[{G95}] ; then
-	echo &quot;*** g95 compiler found at $[{G95}]&quot;
-	if test &quot;$[{g95}]&quot; = yes; then
-       		FC_LIB_PATH=`$[{G95}] -print-file-name=`
-		FC=`basename $[{G95}]`
-		gfortran=no
-		FFLAGS=&quot;$[{FFLAGS_G95}]&quot;
-		FCV=$[{FCV_G95}]
-	fi
-else
-	echo &quot;*** No g95 compiler found&quot;
-fi
-
-dnl
-dnl if FC is not set by now, pick a compiler for user
-dnl
-if test -z $[{FC}] ; then
-	if test ! -z $[{GFORTRAN}] ; then
-		if test &quot;$[{g95}]&quot; = yes; then
-			echo &quot;You enabled g95, but no g95 compiler found, defaulting to gfortran instead&quot;
-		fi
-       		FC_LIB_PATH=`$[{GFORTRAN}] -print-file-name=`
-	        FC=`basename $[{GFORTRAN}]`
-		g95=no
-		gfortran=yes
-		FFLAGS=&quot;$[{FFLAGS_GFORTRAN}]&quot;
-		FCV=&quot;gnu95&quot;
-	elif test ! -z $G95 ; then
-		if test &quot;$[{gfortran}]&quot; = yes; then
-			echo &quot;You enabled gfortran, but no gfortran compiler found, defaulting to g95 instead&quot;
-		fi
-       		FC_LIB_PATH=`$[{G95}] -print-file-name=`
-	        FC=`basename $[{G95}]`
-		g95=yes
-		gfortran=no
-		FFLAGS=&quot;$[{FFLAGS_G95}]&quot;
-		FCV=$[{FCV_G95}]
-	fi
-fi
-
-AC_DEFINE_UNQUOTED(FC_LIB_PATH, &quot;${FC_LIB_PATH}&quot;, [Path to fortran libs.])
-AC_SUBST(FC_LIB_PATH, &quot;${FC_LIB_PATH}&quot;)
-AC_DEFINE_UNQUOTED(FC, &quot;${FC}&quot;, [Fortran compiler.])
-AC_SUBST(FC, &quot;${FC}&quot;)
-AC_SUBST(FCV, &quot;${FCV}&quot;)
-
-dnl =========================================
-dnl pick gfortran or g95
-
-])dnl }}}
-
-
-dnl {{{ ax_check_portaudio
-AC_DEFUN([AX_CHECK_PORTAUDIO],[
-
-HAS_PORTAUDIO_H=0
-HAS_PORTAUDIO_LIB=0
-HAS_PORTAUDIO=0
-
-AC_MSG_CHECKING([for a v19 portaudio ])
-
-portaudio_lib_dir=&quot;/usr/lib&quot;
-portaudio_include_dir=&quot;/usr/include&quot;
-
-AC_ARG_WITH([portaudio-include-dir],
-AC_HELP_STRING([--with-portaudio-include-dir=&lt;path&gt;],
-    [path to portaudio include files]),
-    [portaudio_include_dir=$with_portaudio_include_dir])
-
-AC_ARG_WITH([portaudio-lib-dir],
-AC_HELP_STRING([--with-portaudio-lib-dir=&lt;path&gt;],
-    [path to portaudio lib files]),
-    [portaudio_lib_dir=$with_portaudio_lib_dir])
-
-if test -e $[{portaudio_include_dir}]/portaudio.h; then
-	HAS_PORTAUDIO_H=1
-fi
-
-if test -e $[{portaudio_lib_dir}]/libportaudio.so \
-    -o -e $[{portaudio_lib_dir}]/libportaudio.a;then
-	HAS_PORTAUDIO_LIB=1
-fi
-
-if test $[{HAS_PORTAUDIO_H}] -eq 1 -a $[{HAS_PORTAUDIO_LIB}] -eq 1; then
-	LDFLAGS=&quot;-L$[{portaudio_lib_dir}] $[{LDFLAGS}]&quot;
-	LIBS=&quot;$[{LIBS}] -lportaudio&quot;
-	CPPFLAGS=&quot;-I$[{portaudio_include_dir}] $[{CPPFLAGS}]&quot;
-	AC_CHECK_LIB(portaudio, Pa_GetVersion, \
-		[HAS_PORTAUDIO_VERSION=1], [HAS_PORTAUDIO_VERSION=0])
-	if test $[{HAS_PORTAUDIO_VERSION}] -eq 0; then
-		AC_MSG_RESULT([This is likely portaudio v18; you need portaudio v19])
-	else
-		HAS_PORTAUDIO=1
-	fi
-else
-	AC_MSG_RESULT([portaudio not found trying FreeBSD paths ])
-	portaudio_lib_dir=&quot;/usr/local/lib/portaudio2&quot;
-	portaudio_include_dir=&quot;/usr/local/include/portaudio2&quot;
-dnl
-dnl Try again to make sure portaudio dirs are valid
-dnl
-	AC_MSG_CHECKING([for a v19 portaudio in FreeBSD paths.])
-	HAS_PORTAUDIO_H=0
-	HAS_PORTAUDIO_LIB=0
-
-	if test -e $[{portaudio_include_dir}]/portaudio.h; then
-		HAS_PORTAUDIO_H=1
-	fi
-
-	if test -e $[{portaudio_lib_dir}]/libportaudio.so \
-	    -o -e $[{portaudio_lib_dir}]/libportaudio.a;then
-		HAS_PORTAUDIO_LIB=1
-	fi
-
-	if test $[{HAS_PORTAUDIO_H}] -eq 1 -a $[{HAS_PORTAUDIO_LIB}] -eq 1; then
-		AC_MSG_RESULT([found portaudio in FreeBSD paths, double checking it is v19 ])
-		LDFLAGS=&quot;-L$[{portaudio_lib_dir}] $[{LDFLAGS}]&quot;
-		LIBS=&quot;$[{LIBS}] -lportaudio&quot;
-		CPPFLAGS=&quot;-I$[{portaudio_include_dir}] $[{CPPFLAGS}]&quot;
-		AC_CHECK_LIB(portaudio, Pa_GetVersion, \
-			[HAS_PORTAUDIO_VERSION=1], [HAS_PORTAUDIO_VERSION=0])
-		if test $[{HAS_PORTAUDIO_VERSION}] -eq 0; then
-			AC_MSG_RESULT([How did you end up with a portaudio v18 here?])
-		else
-			AC_MSG_RESULT([found v19])
-			HAS_PORTAUDIO=1
-			HAS_PORTAUDIO_H=1
-		fi
-	fi
-fi
-
-])dnl }}}

Deleted: branches/map65/afc65b.f
===================================================================
--- branches/map65/afc65b.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/afc65b.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,69 +0,0 @@
-      subroutine afc65b(cx,cy,npts,fsample,nflip,ipol,a,dt0,
-     +  ccfbest,dtbest)
-
-      complex cx(npts)
-      complex cy(npts)
-      real a(5),deltaa(5)
-
-      a(1)=0.
-      a(2)=0.
-      a(3)=0.
-      a(4)=45.0*(ipol-1.0)
-
-      deltaa(1)=2.0
-      deltaa(2)=2.0
-      deltaa(3)=2.0
-      deltaa(4)=22.5
-      deltaa(5)=0.05
-      nterms=4
-
-      chisqr=0.
-      nfree=npts-nterms
-
-C  Start the iteration
-      chisqr0=1.e6
-      do iter=1,3                               !One iteration is enough?
-         do j=1,nterms
-            chisq1=fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
-            fn=0.
-            delta=deltaa(j)
- 10         a(j)=a(j)+delta
-            chisq2=fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
-            if(chisq2.eq.chisq1) go to 10
-            if(chisq2.gt.chisq1) then
-               delta=-delta                      !Reverse direction
-               a(j)=a(j)+delta
-               tmp=chisq1
-               chisq1=chisq2
-               chisq2=tmp
-            endif
- 20         fn=fn+1.0
-            a(j)=a(j)+delta
-            chisq3=fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
-            if(chisq3.lt.chisq2) then
-               chisq1=chisq2
-               chisq2=chisq3
-               go to 20
-            endif
-
-C  Find minimum of parabola defined by last three points
-            delta=delta*(1./(1.+(chisq1-chisq2)/(chisq3-chisq2))+0.5)
-            a(j)=a(j)-delta
-            deltaa(j)=deltaa(j)*fn/3.
-         enddo
-         chisqr=fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
-         if(chisqr/chisqr0.gt.0.9999) go to 30
-         chisqr0=chisqr
-      enddo
-
- 30   ccfbest=ccfmax * (1378.125/fsample)**2
-      dtbest=dtmax
-
-      if(a(4).lt.0.0) a(4)=a(4)+180.0
-      if(a(4).ge.180.0) a(4)=a(4)-180.0
-      if(nint(a(4)).eq.180) a(4)=0.
-      ipol=nint(a(4)/45.0) + 1
-      if(ipol.gt.4) ipol=ipol-4
-
-      return
-      end

Added: branches/map65/afmhot.dat
===================================================================
--- branches/map65/afmhot.dat	                        (rev 0)
+++ branches/map65/afmhot.dat	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,257 @@
+     0      0.0000    0.0000    0.0000
+     1	    0.0000    0.0000    0.0000
+     2	    0.0078    0.0000    0.0000
+     3	    0.0157    0.0000    0.0000
+     4	    0.0235    0.0000    0.0000
+     5	    0.0314    0.0000    0.0000
+     6	    0.0392    0.0000    0.0000
+     7	    0.0471    0.0000    0.0000
+     8	    0.0549    0.0000    0.0000
+     9	    0.0627    0.0000    0.0000
+    10	    0.0706    0.0000    0.0000
+    11	    0.0784    0.0000    0.0000
+    12	    0.0863    0.0000    0.0000
+    13	    0.0941    0.0000    0.0000
+    14	    0.1020    0.0000    0.0000
+    15	    0.1098    0.0000    0.0000
+    16	    0.1176    0.0000    0.0000
+    17	    0.1255    0.0000    0.0000
+    18	    0.1333    0.0000    0.0000
+    19	    0.1412    0.0000    0.0000
+    20	    0.1490    0.0000    0.0000
+    21	    0.1569    0.0000    0.0000
+    22	    0.1647    0.0000    0.0000
+    23	    0.1725    0.0000    0.0000
+    24	    0.1804    0.0000    0.0000
+    25	    0.1882    0.0000    0.0000
+    26	    0.1961    0.0000    0.0000
+    27	    0.2039    0.0000    0.0000
+    28	    0.2118    0.0000    0.0000
+    29	    0.2196    0.0000    0.0000
+    30	    0.2275    0.0000    0.0000
+    31	    0.2353    0.0000    0.0000
+    32	    0.2431    0.0000    0.0000
+    33	    0.2510    0.0000    0.0000
+    34	    0.2588    0.0000    0.0000
+    35	    0.2667    0.0000    0.0000
+    36	    0.2745    0.0000    0.0000
+    37	    0.2824    0.0000    0.0000
+    38	    0.2902    0.0000    0.0000
+    39	    0.2980    0.0000    0.0000
+    40	    0.3059    0.0000    0.0000
+    41	    0.3137    0.0000    0.0000
+    42	    0.3216    0.0000    0.0000
+    43	    0.3294    0.0000    0.0000
+    44	    0.3373    0.0000    0.0000
+    45	    0.3451    0.0000    0.0000
+    46	    0.3529    0.0000    0.0000
+    47	    0.3608    0.0000    0.0000
+    48	    0.3686    0.0000    0.0000
+    49	    0.3765    0.0000    0.0000
+    50	    0.3843    0.0000    0.0000
+    51	    0.3922    0.0000    0.0000
+    52	    0.4000    0.0000    0.0000
+    53	    0.4078    0.0000    0.0000
+    54	    0.4157    0.0000    0.0000
+    55	    0.4235    0.0000    0.0000
+    56	    0.4314    0.0000    0.0000
+    57	    0.4392    0.0000    0.0000
+    58	    0.4471    0.0000    0.0000
+    59	    0.4549    0.0000    0.0000
+    60	    0.4627    0.0000    0.0000
+    61	    0.4706    0.0000    0.0000
+    62	    0.4784    0.0000    0.0000
+    63	    0.4863    0.0000    0.0000
+    64	    0.4941    0.0000    0.0000
+    65	    0.5020    0.0000    0.0000
+    66	    0.5098    0.0098    0.0000
+    67	    0.5176    0.0176    0.0000
+    68	    0.5255    0.0255    0.0000
+    69	    0.5333    0.0333    0.0000
+    70	    0.5412    0.0412    0.0000
+    71	    0.5490    0.0490    0.0000
+    72	    0.5569    0.0569    0.0000
+    73	    0.5647    0.0647    0.0000
+    74	    0.5725    0.0725    0.0000
+    75	    0.5804    0.0804    0.0000
+    76	    0.5882    0.0882    0.0000
+    77	    0.5961    0.0961    0.0000
+    78	    0.6039    0.1039    0.0000
+    79	    0.6118    0.1118    0.0000
+    80	    0.6196    0.1196    0.0000
+    81	    0.6275    0.1275    0.0000
+    82	    0.6353    0.1353    0.0000
+    83	    0.6431    0.1431    0.0000
+    84	    0.6510    0.1510    0.0000
+    85	    0.6588    0.1588    0.0000
+    86	    0.6667    0.1667    0.0000
+    87	    0.6745    0.1745    0.0000
+    88	    0.6824    0.1824    0.0000
+    89	    0.6902    0.1902    0.0000
+    90	    0.6980    0.1980    0.0000
+    91	    0.7059    0.2059    0.0000
+    92	    0.7137    0.2137    0.0000
+    93	    0.7216    0.2216    0.0000
+    94	    0.7294    0.2294    0.0000
+    95	    0.7373    0.2373    0.0000
+    96	    0.7451    0.2451    0.0000
+    97	    0.7529    0.2529    0.0000
+    98	    0.7608    0.2608    0.0000
+    99	    0.7686    0.2686    0.0000
+   100	    0.7765    0.2765    0.0000
+   101	    0.7843    0.2843    0.0000
+   102	    0.7922    0.2922    0.0000
+   103	    0.8000    0.3000    0.0000
+   104	    0.8078    0.3078    0.0000
+   105	    0.8157    0.3157    0.0000
+   106	    0.8235    0.3235    0.0000
+   107	    0.8314    0.3314    0.0000
+   108	    0.8392    0.3392    0.0000
+   109	    0.8471    0.3471    0.0000
+   110	    0.8549    0.3549    0.0000
+   111	    0.8627    0.3627    0.0000
+   112	    0.8706    0.3706    0.0000
+   113	    0.8784    0.3784    0.0000
+   114	    0.8863    0.3863    0.0000
+   115	    0.8941    0.3941    0.0000
+   116	    0.9020    0.4020    0.0000
+   117	    0.9098    0.4098    0.0000
+   118	    0.9176    0.4176    0.0000
+   119	    0.9255    0.4255    0.0000
+   120	    0.9333    0.4333    0.0000
+   121	    0.9412    0.4412    0.0000
+   122	    0.9490    0.4490    0.0000
+   123	    0.9569    0.4569    0.0000
+   124	    0.9647    0.4647    0.0000
+   125	    0.9725    0.4725    0.0000
+   126	    0.9804    0.4804    0.0000
+   127	    0.9882    0.4882    0.0000
+   128	    0.9961    0.4961    0.0000
+   129	    1.0000    0.5039    0.0000
+   130	    1.0000    0.5118    0.0118
+   131	    1.0000    0.5196    0.0196
+   132	    1.0000    0.5275    0.0275
+   133	    1.0000    0.5353    0.0353
+   134	    1.0000    0.5431    0.0431
+   135	    1.0000    0.5510    0.0510
+   136	    1.0000    0.5588    0.0588
+   137	    1.0000    0.5667    0.0667
+   138	    1.0000    0.5745    0.0745
+   139	    1.0000    0.5824    0.0824
+   140	    1.0000    0.5902    0.0902
+   141	    1.0000    0.5980    0.0980
+   142	    1.0000    0.6059    0.1059
+   143	    1.0000    0.6137    0.1137
+   144	    1.0000    0.6216    0.1216
+   145	    1.0000    0.6294    0.1294
+   146	    1.0000    0.6373    0.1373
+   147	    1.0000    0.6451    0.1451
+   148	    1.0000    0.6529    0.1529
+   149	    1.0000    0.6608    0.1608
+   150	    1.0000    0.6686    0.1686
+   151	    1.0000    0.6765    0.1765
+   152	    1.0000    0.6843    0.1843
+   153	    1.0000    0.6922    0.1922
+   154	    1.0000    0.7000    0.2000
+   155	    1.0000    0.7078    0.2078
+   156	    1.0000    0.7157    0.2157
+   157	    1.0000    0.7235    0.2235
+   158	    1.0000    0.7314    0.2314
+   159	    1.0000    0.7392    0.2392
+   160	    1.0000    0.7471    0.2471
+   161	    1.0000    0.7549    0.2549
+   162	    1.0000    0.7627    0.2627
+   163	    1.0000    0.7706    0.2706
+   164	    1.0000    0.7784    0.2784
+   165	    1.0000    0.7863    0.2863
+   166	    1.0000    0.7941    0.2941
+   167	    1.0000    0.8020    0.3020
+   168	    1.0000    0.8098    0.3098
+   169	    1.0000    0.8176    0.3176
+   170	    1.0000    0.8255    0.3255
+   171	    1.0000    0.8333    0.3333
+   172	    1.0000    0.8412    0.3412
+   173	    1.0000    0.8490    0.3490
+   174	    1.0000    0.8569    0.3569
+   175	    1.0000    0.8647    0.3647
+   176	    1.0000    0.8725    0.3725
+   177	    1.0000    0.8804    0.3804
+   178	    1.0000    0.8882    0.3882
+   179	    1.0000    0.8961    0.3961
+   180	    1.0000    0.9039    0.4039
+   181	    1.0000    0.9118    0.4118
+   182	    1.0000    0.9196    0.4196
+   183	    1.0000    0.9275    0.4275
+   184	    1.0000    0.9353    0.4353
+   185	    1.0000    0.9431    0.4431
+   186	    1.0000    0.9510    0.4510
+   187	    1.0000    0.9588    0.4588
+   188	    1.0000    0.9667    0.4667
+   189	    1.0000    0.9745    0.4745
+   190	    1.0000    0.9824    0.4824
+   191	    1.0000    0.9902    0.4902
+   192	    1.0000    0.9980    0.4980
+   193	    1.0000    1.0000    0.5059
+   194	    1.0000    1.0000    0.5137
+   195	    1.0000    1.0000    0.5216
+   196	    1.0000    1.0000    0.5294
+   197	    1.0000    1.0000    0.5373
+   198	    1.0000    1.0000    0.5451
+   199	    1.0000    1.0000    0.5529
+   200	    1.0000    1.0000    0.5608
+   201	    1.0000    1.0000    0.5686
+   202	    1.0000    1.0000    0.5765
+   203	    1.0000    1.0000    0.5843
+   204	    1.0000    1.0000    0.5922
+   205	    1.0000    1.0000    0.6000
+   206	    1.0000    1.0000    0.6078
+   207	    1.0000    1.0000    0.6157
+   208	    1.0000    1.0000    0.6235
+   209	    1.0000    1.0000    0.6314
+   210	    1.0000    1.0000    0.6392
+   211	    1.0000    1.0000    0.6471
+   212	    1.0000    1.0000    0.6549
+   213	    1.0000    1.0000    0.6627
+   214	    1.0000    1.0000    0.6706
+   215	    1.0000    1.0000    0.6784
+   216	    1.0000    1.0000    0.6863
+   217	    1.0000    1.0000    0.6941
+   218	    1.0000    1.0000    0.7020
+   219	    1.0000    1.0000    0.7098
+   220	    1.0000    1.0000    0.7176
+   221	    1.0000    1.0000    0.7255
+   222	    1.0000    1.0000    0.7333
+   223	    1.0000    1.0000    0.7412
+   224	    1.0000    1.0000    0.7490
+   225	    1.0000    1.0000    0.7569
+   226	    1.0000    1.0000    0.7647
+   227	    1.0000    1.0000    0.7725
+   228	    1.0000    1.0000    0.7804
+   229	    1.0000    1.0000    0.7882
+   230	    1.0000    1.0000    0.7961
+   231	    1.0000    1.0000    0.8039
+   232	    1.0000    1.0000    0.8118
+   233	    1.0000    1.0000    0.8196
+   234	    1.0000    1.0000    0.8275
+   235	    1.0000    1.0000    0.8353
+   236	    1.0000    1.0000    0.8431
+   237	    1.0000    1.0000    0.8510
+   238	    1.0000    1.0000    0.8588
+   239	    1.0000    1.0000    0.8667
+   240	    1.0000    1.0000    0.8745
+   241	    1.0000    1.0000    0.8824
+   242	    1.0000    1.0000    0.8902
+   243	    1.0000    1.0000    0.8980
+   244	    1.0000    1.0000    0.9059
+   245	    1.0000    1.0000    0.9137
+   246	    1.0000    1.0000    0.9216
+   247	    1.0000    1.0000    0.9294
+   248	    1.0000    1.0000    0.9373
+   249	    1.0000    1.0000    0.9451
+   250	    1.0000    1.0000    0.9529
+   251	    1.0000    1.0000    0.9608
+   252	    1.0000    1.0000    0.9686
+   253	    1.0000    1.0000    0.9765
+   254	    1.0       0.0       0.0
+   255	    1.0       1.0       0.0
+   256	    0.0       1.000     0.0

Added: branches/map65/astro.cpp
===================================================================
--- branches/map65/astro.cpp	                        (rev 0)
+++ branches/map65/astro.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,102 @@
+#include &quot;astro.h&quot;
+#include &quot;ui_astro.h&quot;
+#include &lt;QDebug&gt;
+#include &lt;QFile&gt;
+#include &lt;QMessageBox&gt;
+#include &lt;stdio.h&gt;
+#include &quot;commons.h&quot;
+
+Astro::Astro(QWidget *parent) :
+  QWidget(parent),
+  ui(new Ui::Astro)
+{
+  ui-&gt;setupUi(this);
+  ui-&gt;astroTextBrowser-&gt;setStyleSheet(
+        &quot;QTextBrowser { background-color : cyan; color : black; }&quot;);
+  ui-&gt;astroTextBrowser-&gt;clear();
+}
+
+Astro::~Astro()
+{
+    delete ui;
+}
+
+void Astro::astroUpdate(QDateTime t, QString mygrid, QString hisgrid,
+                        int fQSO, int nsetftx, int ntxFreq, QString azelDir)
+{
+  static int ntxFreq0=-99;
+  static bool astroBusy=false;
+  char cc[300];
+  double azsun,elsun,azmoon,elmoon,azmoondx,elmoondx;
+  double ramoon,decmoon,dgrd,poloffset,xnr;
+  int ntsky,ndop,ndop00;
+  QString date = t.date().toString(&quot;yyyy MMM dd&quot;);
+  QString utc = t.time().toString();
+  int nyear=t.date().year();
+  int month=t.date().month();
+  int nday=t.date().day();
+  int nhr=t.time().hour();
+  int nmin=t.time().minute();
+  double sec=t.time().second() + 0.001*t.time().msec();
+  int isec=sec;
+  double uth=nhr + nmin/60.0 + sec/3600.0;
+  int nfreq=(int)datcom_.fcenter;
+  if(nfreq&lt;10 or nfreq &gt; 50000) nfreq=144;
+
+  if(!astroBusy) {
+    astroBusy=true;
+    astrosub_(&amp;nyear, &amp;month, &amp;nday, &amp;uth, &amp;nfreq, mygrid.toAscii(),
+            hisgrid.toAscii(), &amp;azsun, &amp;elsun, &amp;azmoon, &amp;elmoon,
+            &amp;azmoondx, &amp;elmoondx, &amp;ntsky, &amp;ndop, &amp;ndop00,&amp;ramoon, &amp;decmoon,
+            &amp;dgrd, &amp;poloffset, &amp;xnr, 6, 6);
+    astroBusy=false;
+  }
+
+  sprintf(cc,&quot;Az:    %6.1f\n&quot;
+          &quot;El:    %6.1f\n&quot;
+          &quot;Dec:   %6.1f\n&quot;
+          &quot;DxAz:  %6.1f\n&quot;
+          &quot;DxEl:  %6.1f\n&quot;
+          &quot;SunAz: %6.1f\n&quot;
+          &quot;SunEl: %6.1f\n&quot;
+          &quot;Dop:   %6d\n&quot;
+          &quot;DXDop: %6d\n&quot;
+          &quot;Tsky:  %6d\n&quot;
+          &quot;MNR:   %6.1f\n&quot;
+          &quot;Dgrd:  %6.1f&quot;,
+          azmoon,elmoon,decmoon,azmoondx,elmoondx,azsun,elsun,
+          ndop,ndop00,ntsky,xnr,dgrd);
+  ui-&gt;astroTextBrowser-&gt;setText(&quot; &quot;+ date + &quot;\nUTC: &quot; + utc + &quot;\n&quot; + cc);
+
+  QString fname=azelDir+&quot;/azel.dat&quot;;
+  QFile f(fname);
+  if(!f.open(QIODevice::WriteOnly | QIODevice::Text)) {
+    QMessageBox mb;
+    mb.setText(&quot;Cannot open &quot; + fname);
+    mb.exec();
+    return;
+  }
+  int ndiff=0;
+  if(ntxFreq != ntxFreq0) ndiff=1;
+  ntxFreq0=ntxFreq;
+  QTextStream out(&amp;f);
+  sprintf(cc,&quot;%2.2d:%2.2d:%2.2d,%5.1f,%5.1f,Moon\n&quot;
+          &quot;%2.2d:%2.2d:%2.2d,%5.1f,%5.1f,Sun\n&quot;
+          &quot;%2.2d:%2.2d:%2.2d,%5.1f,%5.1f,Source\n&quot;
+          &quot;%4d,%6d,Doppler\n&quot;
+          &quot;%3d,%1d,fQSO\n&quot;
+          &quot;%3d,%1d,fQSO2\n&quot;,
+          nhr,nmin,isec,azmoon,elmoon,
+          nhr,nmin,isec,azsun,elsun,
+          nhr,nmin,isec,0.0,0.0,
+          nfreq,ndop,
+          fQSO,nsetftx,
+          ntxFreq,ndiff);
+  out &lt;&lt; cc;
+  f.close();
+}
+
+void Astro::setFontSize(int n)
+{
+  ui-&gt;astroTextBrowser-&gt;setFontPointSize(n);
+}

Deleted: branches/map65/astro.f
===================================================================
--- branches/map65/astro.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/astro.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,115 +0,0 @@
-      subroutine astro(AppDir,nyear,month,nday,uth,nfreq,Mygrid,
-     +     NStation,mode,MoonDX,AzSun,ElSun,AzMoon,ElMoon0,
-     +     ntsky,doppler00,doppler,dbMoon,RAMoon,DecMoon,HA,Dgrd,sd,
-     +     poloffset,xnr,auxra,auxdec,azaux,elaux)
-
-C  Computes astronomical quantities for display in JT65, CW, and EME Echo mode.
-C  NB: may want to smooth the Tsky map to 10 degrees or so.
-
-      character*80 AppDir,fname
-      character*6 MyGrid,HisGrid
-      logical first,ltsky
-      real LST
-      real lat,lon
-      real ldeg
-      integer*1 n1sky(129600)
-      integer*2 nsky
-      common/sky/ nsky(360,180)
-      common/echo/xdop(2),techo,ElMoon,mjd
-      equivalence (n1sky,nsky)
-      data first/.true./
-      data rad/57.2957795/
-      save
-
-      if(first) then
-	do i=80,1,-1
-	   if(ichar(AppDir(i:i)).ne.0 .and. 
-     +            ichar(AppDir(i:i)).ne.32) go to 1
-	enddo
- 1	lenappdir=i
-        call zero(nsky,180*180)
-	fname=Appdir(1:lenappdir)//'/TSKY.DAT'
-        call cs_lock('astro')
-#ifdef CVF
-        open(13,file=fname,status='old',form='binary',err=10)
-        read(13) nsky
-        close(13)
-#else
-        open(13,file=fname,status='old',access='stream',err=10)
-        read(13) nsky
-        close(13)
-#endif
-        ltsky=.true.
-        first=.false.
-        call cs_unlock
-      endif
-      go to 20
- 10   ltsky=.false.
-      call cs_unlock
-
- 20   call grid2deg(MyGrid,elon,lat)
-      lon=-elon
-      call sun(nyear,month,nday,uth,lon,lat,RASun,DecSun,LST,
-     +    AzSun,ElSun,mjd)
-
-      freq=nfreq*1.e6
-
-      call MoonDop(nyear,month,nday,uth,lon,lat,RAMoon,DecMoon,
-     +  LST,HA,AzMoon,ElMoon,ldeg,bdeg,vr,dist)
-
-C  Compute spatial polarization offset
-      xx=sin(lat/rad)*cos(ElMoon/rad) - cos(lat/rad)*
-     +     cos(AzMoon/rad)*sin(ElMoon/rad)
-      yy=cos(lat/rad)*sin(AzMoon/rad)
-      if(NStation.eq.1) poloffset1=rad*atan2(yy,xx)
-      if(NStation.eq.2) poloffset2=rad*atan2(yy,xx)
-
-      techo=2.0 * dist/2.99792458e5                 !Echo delay time
-      doppler=-freq*vr/2.99792458e5                 !One-way Doppler
-      t408=ftsky(ldeg,bdeg)                         !Read sky map
-      tsky=t408*(408.0/nfreq)**2.6                  !Tsky for obs freq
-      if(ltsky.and.(tsky.lt.3.0)) tsky=3.0          !Minimum = 3 Kelvin
-
-      xdop(NStation)=doppler
-      if(NStation.eq.2) then
-         HisGrid=MyGrid
-         go to 900
-      endif
-
-      doppler00=2.0*xdop(1)
-      if(mode.eq.2 .or. mode.eq.5) doppler=xdop(1)+xdop(2)
-      if(mode.eq.3) doppler=2.0*xdop(1)
-      dBMoon=-40.0*log10(dist/356903.)
-      sd=16.23*370152.0/dist
-
-!      if(NStation.eq.1 .and. MoonDX.ne.0 .and. 
-!     +    (mode.eq.2 .or. mode.eq.5)) then
-      if(NStation.eq.1 .and. MoonDX.ne.0) then
-         poloffset=mod(poloffset2-poloffset1+720.0,180.0)
-         if(poloffset.gt.90.0) poloffset=poloffset-180.0
-         x1=abs(cos(2*poloffset/rad))
-         if(x1.lt.0.056234) x1=0.056234
-         xnr=-20.0*log10(x1)
-         if(HisGrid(1:1).lt.'A' .or. HisGrid(1:1).gt.'Z') xnr=0
-      endif
-
-      tr=80.0                              !Good preamp
-      tskymin=13.0*(408.0/nfreq)**2.6      !Cold sky temperature
-      tsysmin=tskymin+tr
-      tsys=tsky+tr
-      dgrd=-10.0*log10(tsys/tsysmin) + dbMoon
-
- 900  ElMoon0=Elmoon
-      ntsky=nint(tsky)
-
-      auxHA = 15.0*(LST-auxra)                       !HA in degrees
-      pi=3.14159265
-      pio2=0.5*pi
-      call coord(pi,pio2-lat/rad,0.0,lat/rad,auxha*pi/180.0,
-     +  auxdec/rad,azaux,elaux)
-      AzAux=azaux*rad
-      ElAux=ElAux*rad
-
-      return
-
-      end

Added: branches/map65/astro.h
===================================================================
--- branches/map65/astro.h	                        (rev 0)
+++ branches/map65/astro.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,35 @@
+#ifndef ASTRO_H
+#define ASTRO_H
+
+#include &lt;QWidget&gt;
+#include &lt;QDateTime&gt;
+
+namespace Ui {
+  class Astro;
+}
+
+class Astro : public QWidget
+{
+  Q_OBJECT
+
+public:
+  explicit Astro(QWidget *parent = 0);
+  void astroUpdate(QDateTime t, QString mygrid, QString hisgrid,
+                   int fQSO, int nsetftx, int ntxFreq, QString azelDir);
+  void setFontSize(int n);
+  ~Astro();
+
+private:
+    Ui::Astro *ui;
+};
+
+extern &quot;C&quot; {
+  void astrosub_(int* nyear, int* month, int* nday, double* uth, int* nfreq,
+     const char* mygrid, const char* hisgrid, double* azsun,
+     double* elsun, double* azmoon, double* elmoon, double* azmoondx,
+     double* elmoondx, int* ntsky, int* ndop, int* ndop00,
+     double* ramoon, double* decmoon, double* dgrd, double* poloffset,
+     double* xnr, int len1, int len2);
+}
+
+#endif // ASTRO_H

Deleted: branches/map65/astro.py
===================================================================
--- branches/map65/astro.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/astro.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,52 +0,0 @@
-#------------------------------------------------------ astro
-from Tkinter import *
-import Pmw
-import g
-
-def done():
-    g.astro_geom0=root.geometry()
-    root.withdraw()
-
-root=Toplevel()
-root.withdraw()
-root.protocol('WM_DELETE_WINDOW',done)
-if g.Win32: root.iconbitmap(&quot;wsjt.ico&quot;)
-root.title(&quot;AstroData&quot;)
-frame=Frame(root)
-frame.pack()
-
-def astro2(t):
-    root.geometry(t)
-    root.deiconify()
-    root.focus_set()
-
-def update():
-    t1= &quot;           Az      El\n&quot; 
-    t2= &quot;Moon:    %6.2f  %6.2f\n&quot; % (g.AzMoon,g.ElMoon)
-    t3= &quot;Moon/DX: %6.2f  %6.2f\n&quot; % (g.AzMoonB,g.ElMoonB)
-    t4= &quot;Sun:     %6.2f  %6.2f\n&quot; % (g.AzSun,g.ElSun)
-    t4a=&quot;Source:  %6.2f  %6.2f\n\n&quot; % (g.AzAux,g.ElAux)
-    t5= &quot;        Doppler   df/dt\n&quot;
-    t6= &quot;DX:     %7d %7.2f\n&quot; % (g.ndop,g.dfdt)
-    t7= &quot;Self:   %7d %7.2f\n\n&quot; % (g.ndop00,g.dfdt0)
-    t7a=&quot;            RA      DEC\n&quot;
-    irah=int(g.RAMoon)
-    iram=int(60.0*(g.RAMoon-irah))
-    t7b=&quot;Moon:     %2.2d:%2.2d  %6.2f\n&quot; % (irah,iram,g.DecMoon)
-    irah=int(g.RaAux)
-    iram=int(60.0*(g.RaAux-irah))
-    t7c=&quot;Source:   %2.2d:%2.2d  %6.2f\n\n&quot; % (irah,iram,g.DecAux)
-    t8= &quot;Freq: %4d  Tsky:%6d\n&quot; % (g.nfreq,g.ntsky)
-    t9= &quot;MNR: %5.1f  Dgrd:%6.1f\n&quot; % (g.MaxNR,g.Dgrd)
-    t10=&quot;DPol: %4d  SD:%8.2f\n&quot; % (g.poloffset,g.sd)
-    t=t1+t2+t3+t4+t4a+t5+t6+t7+t7a+t7b+t7c+t8+t9+t10
-    lab1.configure(text=t)
-    g.astro_geom=root.geometry()
-    frame.after(1000,update)
-
-g2font=g.g2font
-lab1=Label(frame,font=g2font,justify=LEFT,bg=&quot;#66FFFF&quot;,
-           relief=RIDGE,bd=4,anchor=N)
-lab1.pack(ipadx=4)
-
-frame.after(1000,update)

Added: branches/map65/astro.ui
===================================================================
--- branches/map65/astro.ui	                        (rev 0)
+++ branches/map65/astro.ui	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,37 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;class&gt;Astro&lt;/class&gt;
+ &lt;widget class=&quot;QWidget&quot; name=&quot;Astro&quot;&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;262&lt;/width&gt;
+    &lt;height&gt;427&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;Form&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;widget class=&quot;QTextBrowser&quot; name=&quot;astroTextBrowser&quot;&gt;
+   &lt;property name=&quot;geometry&quot;&gt;
+    &lt;rect&gt;
+     &lt;x&gt;0&lt;/x&gt;
+     &lt;y&gt;10&lt;/y&gt;
+     &lt;width&gt;256&lt;/width&gt;
+     &lt;height&gt;411&lt;/height&gt;
+    &lt;/rect&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;font&quot;&gt;
+    &lt;font&gt;
+     &lt;family&gt;Courier New&lt;/family&gt;
+     &lt;pointsize&gt;20&lt;/pointsize&gt;
+     &lt;weight&gt;75&lt;/weight&gt;
+     &lt;bold&gt;true&lt;/bold&gt;
+    &lt;/font&gt;
+   &lt;/property&gt;
+  &lt;/widget&gt;
+ &lt;/widget&gt;
+ &lt;resources/&gt;
+ &lt;connections/&gt;
+&lt;/ui&gt;

Deleted: branches/map65/astro0.f90
===================================================================
--- branches/map65/astro0.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/astro0.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,123 +0,0 @@
-subroutine astro0(nyear,month,nday,uth8,nfreq,grid,cauxra,cauxdec,       &amp;
-     AzSun8,ElSun8,AzMoon8,ElMoon8,AzMoonB8,ElMoonB8,ntsky,ndop,ndop00,  &amp;
-     dbMoon8,RAMoon8,DecMoon8,HA8,Dgrd8,sd8,poloffset8,xnr8,dfdt,dfdt0,  &amp;
-     RaAux8,DecAux8,AzAux8,ElAux8)
-
-!f2py intent(in) nyear,month,nday,uth8,nfreq,grid,cauxra,cauxdec
-!f2py intent(out) AzSun8,ElSun8,AzMoon8,ElMoon8,AzMoonB8,ElMoonB8,ntsky,ndop,ndop00,dbMoon8,RAMoon8,DecMoon8,HA8,Dgrd8,sd8,poloffset8,xnr8,dfdt,dfdt0,RaAux8,DecAux8,AzAux8,ElAux8
-
-  character grid*6
-  character*9 cauxra,cauxdec
-  real*8 AzSun8,ElSun8,AzMoon8,ElMoon8,AzMoonB8,ElMoonB8,AzAux8,ElAux8
-  real*8 dbMoon8,RAMoon8,DecMoon8,HA8,Dgrd8,xnr8,dfdt,dfdt0
-  real*8 sd8,poloffset8
-  include 'gcom2.f90'
-  data uth8z/0.d0/,imin0/-99/
-  save
-
-  call cs_lock('astro0a')
-  auxra=0.
-  i=index(cauxra,':')
-  if(i.eq.0) then
-     read(cauxra,*,err=1,end=1) auxra
-  else
-     read(cauxra(1:i-1),*,err=1,end=1) ih
-     read(cauxra(i+1:i+2),*,err=1,end=1) im
-     read(cauxra(i+4:i+5),*,err=1,end=1) is
-     auxra=ih + im/60.0 + is/3600.0
-  endif
-1 auxdec=0.
-  i=index(cauxdec,':')
-  if(i.eq.0) then
-     read(cauxdec,*,err=2,end=2) auxdec
-  else
-     read(cauxdec(1:i-1),*,err=2,end=2) id
-     read(cauxdec(i+1:i+2),*,err=2,end=2) im
-     read(cauxdec(i+4:i+5),*,err=2,end=2) is
-     auxdec=abs(id) + im/60.0 + is/3600.0
-     if(cauxdec(1:1).eq.'-') auxdec=-auxdec
-  endif
-
-2 nmode=1
-  if(mode(1:4).eq.'JT65') then
-     nmode=2
-     if(mode(5:5).eq.'A') mode65=1
-     if(mode(5:5).eq.'B') mode65=2
-     if(mode(5:5).eq.'C') mode65=4
-  endif
-  if(mode.eq.'Echo') nmode=3
-  if(mode.eq.'JT6M') nmode=4
-  uth=uth8
-
-  call cs_unlock
-  call astro(AppDir,nyear,month,nday,uth,nfreq,hisgrid,2,nmode,1,    &amp;
-       AzSun,ElSun,AzMoon,ElMoon,ntsky,doppler00,doppler,            &amp;
-       dbMoon,RAMoon,DecMoon,HA,Dgrd,sd,poloffset,xnr,auxra,auxdec,  &amp;
-       AzAux,ElAux)
-  AzMoonB8=AzMoon
-  ElMoonB8=ElMoon
-  call astro(AppDir,nyear,month,nday,uth,nfreq,grid,1,nmode,1,       &amp;
-       AzSun,ElSun,AzMoon,ElMoon,ntsky,doppler00,doppler,            &amp;
-       dbMoon,RAMoon,DecMoon,HA,Dgrd,sd,poloffset,xnr,auxra,auxdec,  &amp;
-       AzAux,ElAux)
-
-  RaAux8=auxra
-  DecAux8=auxdec
-  AzSun8=AzSun
-  ElSun8=ElSun
-  AzMoon8=AzMoon
-  ElMoon8=ElMoon
-  dbMoon8=dbMoon
-  RAMoon8=RAMoon/15.0
-  DecMoon8=DecMoon
-  HA8=HA
-  Dgrd8=Dgrd
-  sd8=sd
-  poloffset8=poloffset
-  xnr8=xnr
-  AzAux8=AzAux
-  ElAux8=ElAux
-  ndop=nint(doppler)
-  ndop00=nint(doppler00)
-
-  if(uth8z.eq.0.d0) then
-     uth8z=uth8-1.d0/3600.d0
-     dopplerz=doppler
-     doppler00z=doppler00
-  endif
-     
-  dt=60.0*(uth8-uth8z)
-  if(dt.le.0) dt=1.d0/60.d0
-  dfdt=(doppler-dopplerz)/dt
-  dfdt0=(doppler00-doppler00z)/dt
-  uth8z=uth8
-  dopplerz=doppler
-  doppler00z=doppler00
-
-  imin=60*uth8
-  isec=3600*uth8
-
-  if(isec.ne.isec0 .and. ndecoding.eq.0) then
-     call cs_lock('astro0b')
-     ih=uth8
-     im=mod(imin,60)
-     is=mod(isec,60)
-     rewind 14
-     write(14,1010) ih,im,is,AzMoon,ElMoon,                          &amp;
-        ih,im,is,AzSun,ElSun,                                        &amp;
-        ih,im,is,AzAux,ElAux,                                        &amp;
-        nfreq,doppler,dfdt,doppler00,dfdt0,                          &amp;
-        mousefqso,nsetftx
-1010 format(i2.2,':',i2.2,':',i2.2,',',f5.1,',',f5.1,',Moon'/        &amp;
-            i2.2,':',i2.2,':',i2.2,',',f5.1,',',f5.1,',Sun'/         &amp;
-            i2.2,':',i2.2,':',i2.2,',',f5.1,',',f5.1,',Source'/      &amp;
-            i4,',',f8.1,',',f8.2,',',f8.1,',',f8.2,',Doppler'/       &amp;
-            i4,',',i1,',fQSO')
-     call flushqqq(14)
-     nsetftx=0
-     isec0=isec
-     call cs_unlock
-  endif
-
-  return
-end subroutine astro0

Deleted: branches/map65/astropak.f
===================================================================
--- branches/map65/astropak.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/astropak.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,14 +0,0 @@
-!      include 'astro.f'
-      include 'azdist.f'
-      include 'coord.f'
-      include 'dcoord.f'
-      include 'deg2grid.f'
-      include 'dot.f'
-      include 'ftsky.f'
-      include 'geocentric.f'
-      include 'GeoDist.f'
-      include 'grid2deg.f'
-      include 'moon2.f'
-      include 'MoonDop.f'
-      include 'sun.f'
-      include 'toxyz.f'

Deleted: branches/map65/audio_init.f90
===================================================================
--- branches/map65/audio_init.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/audio_init.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,74 +0,0 @@
-!------------------------------------------------ audio_init
-subroutine audio_init(ndin,ndout)
-
-#ifdef CVF
-  use dfmt
-  integer Thread1,Thread2,Thread3
-  external a2d,decode1,recvpkt
-#endif
-
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-
-  nmode=2
-  if(mode(5:5).eq.'A') mode65=1
-  if(mode(5:5).eq.'B') mode65=2
-  if(mode(5:5).eq.'C') mode65=4
-  ndevout=ndout
-  TxOK=0
-  Transmitting=0
-  nfsample=11025
-  nspb=1024
-  nbufs=2048
-  nmax=nbufs*nspb
-  nwave=60*nfsample
-  ngo=1
-  f0=800.0
-  do i=1,nwave
-     iwave(i)=nint(32767.0*sin(6.283185307*i*f0/nfsample))
-  enddo
-
-#ifdef CVF
-!  Priority classes (for processes):
-!     IDLE_PRIORITY_CLASS               64
-!     NORMAL_PRIORITY_CLASS             32
-!     HIGH_PRIORITY_CLASS              128
-
-!  Priority definitions (for threads):
-!     THREAD_PRIORITY_IDLE             -15
-!     THREAD_PRIORITY_LOWEST            -2
-!     THREAD_PRIORITY_BELOW_NORMAL      -1
-!     THREAD_PRIORITY_NORMAL             0
-!     THREAD_PRIORITY_ABOVE_NORMAL       1
-!     THREAD_PRIORITY_HIGHEST            2
-!     THREAD_PRIORITY_TIME_CRITICAL     15
-    
-  m0=SetPriorityClass(GetCurrentProcess(),NORMAL_PRIORITY_CLASS)
-!  m0=SetPriorityClass(GetCurrentProcess(),HIGH_PRIORITY_CLASS)
-
-! Start a thread for doing A/D and D/A with sound card.
-!  (actually, only D/A is used in MAP65)
-  Thread1=CreateThread(0,0,a2d,0,CREATE_SUSPENDED,id1)
-  m1=SetThreadPriority(Thread1,THREAD_PRIORITY_ABOVE_NORMAL)
-  m2=ResumeThread(Thread1)
-
-! Start a thread for background decoding.
-  Thread2=CreateThread(0,0,decode1,0,CREATE_SUSPENDED,id2)
-  m3=SetThreadPriority(Thread2,THREAD_PRIORITY_BELOW_NORMAL)
-  m4=ResumeThread(Thread2)
-
-! Start a thread to receive packets from Linrad
-  Thread3=CreateThread(0,0,recvpkt,0,CREATE_SUSPENDED,id3)
-  m5=SetThreadPriority(Thread3,THREAD_PRIORITY_ABOVE_NORMAL)
-  m6=ResumeThread(Thread3)
-
-#else
-!  print*,'Audio INIT called.'
-  ierr=start_threads(ndevin,ndevout,y1,y2,nmax,iwrite,iwave,nwave,    &amp;
-       11025,NSPB,TRPeriod,TxOK,ndebug,Transmitting,            &amp;
-       Tsec,ngo,nmode,tbuf,ibuf,ndsec,PttPort,devin_name,devout_name)
-
-#endif
-
-  return
-end subroutine audio_init

Deleted: branches/map65/avecom.h
===================================================================
--- branches/map65/avecom.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/avecom.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,4 +0,0 @@
-	parameter (MAXAVE=120)
-	common/ave/ppsave(64,63,MAXAVE),nflag(MAXAVE),nsave,
-     +    iseg(MAXAVE)
-

Deleted: branches/map65/avemsg65.f
===================================================================
--- branches/map65/avemsg65.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/avemsg65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,64 +0,0 @@
-      subroutine avemsg65(mseg,mode65,ndepth,decoded,nused,
-     +  nq1,nq2,neme,nsked,mycall,hiscall,hisgrid,qual,
-     +  ns,ncount)
-
-C  Decodes averaged JT65 data for the specified segment (mseg=1 or 2).
-
-      parameter (MAXAVE=120)                    !Max avg count is 120
-      character decoded*22,deepmsg*22
-      character mycall*12,hiscall*12,hisgrid*6
-      real s3(64,63)
-      logical ltext
-      common/ave/ppsave(64,63,MAXAVE),nflag(MAXAVE),nsave,iseg(MAXAVE)
-
-C  Count the available spectra for this Monitor segment (mseg=1 or 2),
-C  and the number of spectra flagged as good.
-
-      nused=0
-      ns=0
-      nqual=0
-      deepmsg='                      '
-      do i=1,nsave
-         if(iseg(i).eq.mseg) then
-            ns=ns+1
-            if(nflag(i).eq.1) nused=nused+1
-         endif
-      enddo
-      if(nused.lt.1) go to 100
-
-C  Compute the average of all flagged spectra for this segment.
-      do j=1,63
-         call zero(s3(1,j),64)
-         do n=1,nsave
-            if(nflag(n).eq.1 .and. iseg(n).eq.mseg) then
-               call add(s3(1,j),ppsave(1,j,n),s3(1,j),64)
-            endif
-         enddo
-      enddo
-
-      nadd=nused*mode65
-      call extract(s3,nadd,ncount,decoded,ltext)     !Extract the message
-      if(ncount.lt.0) decoded='                      '
-
-      nqual=0
-C  Possibly should pass nadd=nused, also:
-      if(ndepth.ge.3) then
-         flipx=1.0                     !Normal flip not relevant for ave msg
-         call deep65(s3,mode65,neme,nsked,flipx, 
-     +   mycall,hiscall,hisgrid,deepmsg,qual)
-         nqual=qual
-         if(nqual.lt.nq1) deepmsg='                      '
-         if(nqual.ge.nq1 .and. nqual.lt.nq2) deepmsg(19:19)='?'
-      else
-         deepmsg='                      '
-         qual=0.
-      endif
-      if(ncount.lt.0) decoded=deepmsg
-
-C  Suppress &quot;birdie messages&quot;:
-      if(decoded(1:7).eq.'000AAA ') decoded='                      '
-      if(decoded(1:7).eq.'0L6MWK ') decoded='                      '
-
- 100  if(nused.lt.1) decoded='                      '
-      return
-      end

Deleted: branches/map65/azdist.f
===================================================================
--- branches/map65/azdist.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/azdist.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,108 +0,0 @@
-      subroutine azdist(MyGrid,HisGrid,utch,nAz,nEl,nDmiles,nDkm,
-     +  nHotAz,nHotABetter)
-
-      character*6 MyGrid,HisGrid,mygrid0,hisgrid0
-      real*8 utch,utch0
-      logical HotABetter,IamEast
-      real eltab(22),daztab(22)
-      data eltab/18.,15.,13.,11.,9.,8.,7.,6.,5.3,4.7,4.,3.3,2.7,
-     +  2.,1.5,1.,0.8,0.6,0.4,0.2,0.0,0.0/
-      data daztab/21.,18.,16.,15.,14.,13.,12.,11.,10.7,10.3,10.,
-     +  10.,10.,10.,10.,10.,10.,9.,9.,9.,8.,8./
-      data mygrid0/&quot;      &quot;/,hisgrid0/&quot;      &quot;/,utch0/-999.d0/
-      save
-
-      if(MyGrid.eq.HisGrid) then
-         naz=0
-         nel=0
-         ndmiles=0
-         ndkm=0
-         nhotaz=0
-         nhotabetter=1
-         go to 999
-      endif
-
-      if(mygrid.eq.mygrid0 .and. hisgrid.eq.hisgrid0 .and.
-     +  abs(utch-utch0).lt.0.1666667d0) go to 900
-      utch0=utch
-      mygrid0=mygrid
-      hisgrid0=hisgrid
-      utchours=utch
-
-      if(MyGrid(5:5).eq.' ') MyGrid(5:5)='m'
-      if(MyGrid(6:6).eq.' ') MyGrid(6:6)='m'
-      if(HisGrid(5:5).eq.' ') HisGrid(5:5)='m'
-      if(HisGrid(6:6).eq.' ') HisGrid(6:6)='m'
-
-      if(MyGrid.eq.HisGrid) then
-         Az=0.
-         Dmiles=0.
-         Dkm=0.0
-         El=0.
-         HotA=0.
-         HotB=0.
-         HotABetter=.true.
-         go to 900
-      endif
-
-      call grid2deg(MyGrid,dlong1,dlat1)
-      call grid2deg(HisGrid,dlong2,dlat2)
-      call geodist(dlat1,dlong1,dlat2,dlong2,Az,Baz,Dkm)
-
-      ndkm=Dkm/100
-      j=ndkm-4
-      if(j.lt.1) j=1
-      if(j.gt.21)j=21
-      if(Dkm.lt.500.0) then
-        El=18.0
-      else
-        u=(Dkm-100.0*ndkm)/100.0
-        El=(1.0-u)*eltab(j) + u*eltab(j+1)
-      endif
-
-      daz=daztab(j) + u * (daztab(j+1)-daztab(j))
-      Dmiles=Dkm/1.609344
-
-      tmid=mod(UTChours-0.5*(dlong1+dlong2)/15.0+48.0,24.0)
-      IamEast=.false.
-      if(dlong1.lt.dlong2) IamEast=.true.
-      if(dlong1.eq.dlong2 .and. dlat1.gt.dlat2) IamEast=.false.
-      azEast=baz
-      if(IamEast) azEast=az
-      if((azEast.ge.45.0 .and. azEast.lt.135.0) .or.
-     +    (azEast.ge.225.0 .and. azEast.lt.315.0)) then
-C  The path will be taken as &quot;east-west&quot;.
-         HotABetter=.true.
-         if(abs(tmid-6.0).lt.6.0) HotABetter=.false.
-         if((dlat1+dlat2)/2.0 .lt. 0.0) HotABetter=.not.HotABetter
-      else
-C  The path will be taken as &quot;north-south&quot;.
-         HotABetter=.false.
-         if(abs(tmid-12.0).lt.6.0) HotABetter=.true.
-      endif
-      if(IamEast) then
-         HotA = Az - daz
-         HotB = Az + daz
-      else
-         HotA = Az + daz
-         HotB = Az - daz
-      endif
-      if(HotA.lt.0.0)   HotA=HotA+360.0
-      if(HotA.gt.360.0) HotA=HotA-360.0
-      if(HotB.lt.0.0)   HotB=HotB+360.0
-      if(HotB.gt.360.0) HotB=HotB-360.0
-
- 900  continue
-      naz=nint(Az)
-      nel=nint(el)
-      nDmiles=nint(Dmiles)
-      nDkm=nint(Dkm)
-      nHotAz=nint(HotB)
-      nHotABetter=0
-      if(HotABetter) then
-         nHotAz=nint(HotA)
-         nHotABetter=1
-      endif
-
- 999  return
-      end

Deleted: branches/map65/azdist0.f90
===================================================================
--- branches/map65/azdist0.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/azdist0.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,14 +0,0 @@
-
-!---------------------------------------------------- azdist0
-
-subroutine azdist0(MyGrid,HisGrid,utch,nAz,nEl,nDmiles,nDkm,nHotAz,nHotABetter)
-  character*6 MyGrid,HisGrid
-  real*8 utch
-!f2py intent(in) MyGrid,HisGrid,utch
-!f2py intent(out) nAz,nEl,nDmiles,nDkm,nHotAz,nHotABetter
-
-  if(hisgrid(5:5).eq.' ' .or. ichar(hisgrid(5:5)).eq.0) hisgrid(5:5)='m'
-  if(hisgrid(6:6).eq.' ' .or. ichar(hisgrid(6:6)).eq.0) hisgrid(6:6)='m'
-  call azdist(MyGrid,HisGrid,utch,nAz,nEl,nDmiles,nDkm,nHotAz,nHotABetter)
-  return
-end subroutine azdist0

Added: branches/map65/bandmap.cpp
===================================================================
--- branches/map65/bandmap.cpp	                        (rev 0)
+++ branches/map65/bandmap.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,89 @@
+#include &quot;bandmap.h&quot;
+#include &quot;ui_bandmap.h&quot;
+#include &lt;QDebug&gt;
+
+BandMap::BandMap(QWidget *parent) :
+  QWidget(parent),
+  ui(new Ui::BandMap)
+{
+  ui-&gt;setupUi(this);
+  ui-&gt;bmTextBrowser-&gt;setStyleSheet(
+        &quot;QTextBrowser { background-color : #000066; color : red; }&quot;);
+  m_bandMapText=&quot;&quot;;
+  ui-&gt;bmTextBrowser-&gt;clear();
+}
+
+BandMap::~BandMap()
+{
+  delete ui;
+}
+
+void BandMap::setText(QString t)
+{
+  m_bandMapText=t;
+  int w=ui-&gt;bmTextBrowser-&gt;size().width();
+  int ncols=1;
+  if(w&gt;220) ncols=2;
+  QString s=&quot;QTextBrowser{background-color: &quot;+m_colorBackground+&quot;}&quot;;
+  ui-&gt;bmTextBrowser-&gt;setStyleSheet(s);
+  QString t0=&quot;&lt;html style=\&quot; font-family:'Courier New';&quot;
+      &quot;font-size:9pt; background-color:#000066\&quot;&gt;&quot;
+      &quot;&lt;table border=0 cellspacing=7&gt;&lt;tr&gt;&lt;td&gt;\n&quot;;
+  QString tfreq,tspace,tcall;
+  QString s0,s1,s2,s3,bg;
+  bg=&quot;&lt;span style=color:&quot;+m_colorBackground+&quot;;&gt;.&lt;/span&gt;&quot;;
+  s0=&quot;&lt;span style=color:&quot;+m_color0+&quot;;&gt;&quot;;
+  s1=&quot;&lt;span style=color:&quot;+m_color1+&quot;;&gt;&quot;;
+  s2=&quot;&lt;span style=color:&quot;+m_color2+&quot;;&gt;&quot;;
+  s3=&quot;&lt;span style=color:&quot;+m_color3+&quot;;&gt;&quot;;
+
+  ui-&gt;bmTextBrowser-&gt;clear();
+  QStringList lines = t.split( &quot;\n&quot;, QString::SkipEmptyParts );
+  int nrows=(lines.length()+ncols-1)/ncols;
+
+  for(int i=0; i&lt;nrows; i++) {
+    tfreq=lines[i].mid(0,3);
+    tspace=lines[i].mid(4,1);
+    if(tspace==&quot; &quot;) tspace=bg;
+    tcall=lines[i].mid(5,7);
+    int n=lines[i].mid(13,1).toInt();
+    if(n==0) t0 += s0;
+    if(n==1) t0 += s1;
+    if(n==2) t0 += s2;
+    if(n&gt;=3) t0 += s3;
+    t0 += (tfreq + tspace + tcall + &quot;&lt;/span&gt;&lt;br&gt;\n&quot;);
+  }
+
+  if(ncols==2) {                                  //2-column display
+    t0 += &quot;&lt;td&gt;&lt;br&gt;&lt;td&gt;\n&quot;;
+    for(int i=nrows; i&lt;lines.length(); i++) {
+      tfreq=lines[i].mid(0,3);
+      tspace=lines[i].mid(4,1);
+      if(tspace==&quot;  &quot;) tspace=bg;
+      tcall=lines[i].mid(5,7);
+      int n=lines[i].mid(13,1).toInt();
+      if(n==0) t0 += s0;
+      if(n==1) t0 += s1;
+      if(n==2) t0 += s2;
+      if(n&gt;=3) t0 += s3;
+      t0 += (tfreq + tspace + tcall + &quot;&lt;/span&gt;&lt;br&gt;\n&quot;);
+    }
+    if(2*nrows&gt;lines.length()) t0 += (s0 + &quot;&lt;/span&gt;&lt;br&gt;\n&quot;);
+  }
+  ui-&gt;bmTextBrowser-&gt;setHtml(t0);
+}
+
+void BandMap::resizeEvent(QResizeEvent* )
+{
+  setText(m_bandMapText);
+}
+
+void BandMap::setColors(QString t)
+{
+  m_colorBackground = &quot;#&quot;+t.mid(0,6);
+  m_color0 = &quot;#&quot;+t.mid(6,6);
+  m_color1 = &quot;#&quot;+t.mid(12,6);
+  m_color2 = &quot;#&quot;+t.mid(18,6);
+  m_color3 = &quot;#&quot;+t.mid(24,6);
+  setText(m_bandMapText);
+}

Added: branches/map65/bandmap.h
===================================================================
--- branches/map65/bandmap.h	                        (rev 0)
+++ branches/map65/bandmap.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,34 @@
+#ifndef BANDMAP_H
+#define BANDMAP_H
+
+#include &lt;QWidget&gt;
+
+namespace Ui {
+    class BandMap;
+}
+
+class BandMap : public QWidget
+{
+    Q_OBJECT
+
+public:
+  explicit BandMap(QWidget *parent = 0);
+  void setText(QString t);
+  void setColors(QString t);
+
+  ~BandMap();
+
+protected:
+  void resizeEvent(QResizeEvent* event);
+
+private:
+    Ui::BandMap *ui;
+    QString m_bandMapText;
+    QString m_colorBackground;
+    QString m_color0;
+    QString m_color1;
+    QString m_color2;
+    QString m_color3;
+};
+
+#endif // BANDMAP_H

Added: branches/map65/bandmap.ui
===================================================================
--- branches/map65/bandmap.ui	                        (rev 0)
+++ branches/map65/bandmap.ui	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,43 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;class&gt;BandMap&lt;/class&gt;
+ &lt;widget class=&quot;QWidget&quot; name=&quot;BandMap&quot;&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;329&lt;/width&gt;
+    &lt;height&gt;379&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;minimumSize&quot;&gt;
+   &lt;size&gt;
+    &lt;width&gt;0&lt;/width&gt;
+    &lt;height&gt;0&lt;/height&gt;
+   &lt;/size&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;Form&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;layout class=&quot;QGridLayout&quot; name=&quot;gridLayout&quot;&gt;
+   &lt;item row=&quot;0&quot; column=&quot;0&quot;&gt;
+    &lt;widget class=&quot;QTextBrowser&quot; name=&quot;bmTextBrowser&quot;&gt;
+     &lt;property name=&quot;minimumSize&quot;&gt;
+      &lt;size&gt;
+       &lt;width&gt;107&lt;/width&gt;
+       &lt;height&gt;0&lt;/height&gt;
+      &lt;/size&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;font&quot;&gt;
+      &lt;font&gt;
+       &lt;family&gt;Courier New&lt;/family&gt;
+       &lt;pointsize&gt;9&lt;/pointsize&gt;
+      &lt;/font&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+  &lt;/layout&gt;
+ &lt;/widget&gt;
+ &lt;resources/&gt;
+ &lt;connections/&gt;
+&lt;/ui&gt;

Added: branches/map65/blue.dat
===================================================================
--- branches/map65/blue.dat	                        (rev 0)
+++ branches/map65/blue.dat	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,256 @@
+     0      0.0000    0.0000    0.0000
+     1	    0.0902    0.0902    0.2558
+     2	    0.1176    0.1176    0.2694
+     3	    0.1412    0.1412    0.2820
+     4	    0.1569    0.1569    0.2938
+     5	    0.1725    0.1725    0.3049
+     6	    0.1843    0.1843    0.3154
+     7	    0.1961    0.1961    0.3254
+     8	    0.2039    0.2039    0.3349
+     9	    0.2157    0.2157    0.3440
+    10	    0.2235    0.2235    0.3528
+    11	    0.2314    0.2314    0.3612
+    12	    0.2392    0.2392    0.3693
+    13	    0.2471    0.2471    0.3772
+    14	    0.2549    0.2549    0.3848
+    15	    0.2588    0.2588    0.3921
+    16	    0.2667    0.2667    0.3992
+    17	    0.2706    0.2706    0.4061
+    18	    0.2784    0.2784    0.4129
+    19	    0.2824    0.2824    0.4194
+    20	    0.2902    0.2902    0.4258
+    21	    0.2941    0.2941    0.4319
+    22	    0.2980    0.2980    0.4380
+    23	    0.3059    0.3059    0.4439
+    24	    0.3098    0.3098    0.4496
+    25	    0.3137    0.3137    0.4553
+    26	    0.3176    0.3176    0.4608
+    27	    0.3216    0.3216    0.4661
+    28	    0.3294    0.3294    0.4714
+    29	    0.3333    0.3333    0.4765
+    30	    0.3373    0.3373    0.4815
+    31	    0.3412    0.3412    0.4865
+    32	    0.3451    0.3451    0.4913
+    33	    0.3490    0.3490    0.4960
+    34	    0.3529    0.3529    0.5006
+    35	    0.3569    0.3569    0.5052
+    36	    0.3608    0.3608    0.5096
+    37	    0.3647    0.3647    0.5140
+    38	    0.3686    0.3686    0.5183
+    39	    0.3725    0.3725    0.5225
+    40	    0.3765    0.3765    0.5266
+    41	    0.3804    0.3804    0.5306
+    42	    0.3843    0.3843    0.5346
+    43	    0.3843    0.3843    0.5385
+    44	    0.3882    0.3882    0.5423
+    45	    0.3922    0.3922    0.5460
+    46	    0.3961    0.3961    0.5497
+    47	    0.4000    0.4000    0.5533
+    48	    0.4039    0.4039    0.5569
+    49	    0.4078    0.4078    0.5603
+    50	    0.4118    0.4118    0.5638
+    51	    0.4118    0.4118    0.5671
+    52	    0.4157    0.4157    0.5704
+    53	    0.4196    0.4196    0.5736
+    54	    0.4235    0.4235    0.5768
+    55	    0.4275    0.4275    0.5799
+    56	    0.4314    0.4314    0.5829
+    57	    0.4314    0.4314    0.5859
+    58	    0.4353    0.4353    0.5889
+    59	    0.4392    0.4392    0.5917
+    60	    0.4431    0.4431    0.5946
+    61	    0.4471    0.4471    0.5973
+    62	    0.4471    0.4471    0.6001
+    63	    0.4510    0.4510    0.6027
+    64	    0.4549    0.4549    0.6053
+    65	    0.4588    0.4588    0.6079
+    66	    0.4627    0.4627    0.6104
+    67	    0.4627    0.4627    0.6129
+    68	    0.4667    0.4667    0.6153
+    69	    0.4706    0.4706    0.6176
+    70	    0.4745    0.4745    0.6199
+    71	    0.4745    0.4745    0.6222
+    72	    0.4784    0.4784    0.6244
+    73	    0.4824    0.4824    0.6266
+    74	    0.4863    0.4863    0.6287
+    75	    0.4863    0.4863    0.6308
+    76	    0.4902    0.4902    0.6328
+    77	    0.4941    0.4941    0.6348
+    78	    0.4980    0.4980    0.6367
+    79	    0.5020    0.5020    0.6386
+    80	    0.5020    0.5020    0.6404
+    81	    0.5059    0.5059    0.6422
+    82	    0.5098    0.5098    0.6440
+    83	    0.5098    0.5098    0.6457
+    84	    0.5137    0.5137    0.6474
+    85	    0.5176    0.5176    0.6490
+    86	    0.5216    0.5216    0.6506
+    87	    0.5216    0.5216    0.6521
+    88	    0.5255    0.5255    0.6536
+    89	    0.5294    0.5294    0.6551
+    90	    0.5333    0.5333    0.6565
+    91	    0.5333    0.5333    0.6578
+    92	    0.5373    0.5373    0.6591
+    93	    0.5412    0.5412    0.6604
+    94	    0.5451    0.5451    0.6617
+    95	    0.5451    0.5451    0.6629
+    96	    0.5490    0.5490    0.6640
+    97	    0.5529    0.5529    0.6651
+    98	    0.5569    0.5569    0.6662
+    99	    0.5569    0.5569    0.6672
+   100	    0.5608    0.5608    0.6682
+   101	    0.5647    0.5647    0.6692
+   102	    0.5647    0.5647    0.6701
+   103	    0.5686    0.5686    0.6710
+   104	    0.5725    0.5725    0.6718
+   105	    0.5765    0.5765    0.6726
+   106	    0.5765    0.5765    0.6733
+   107	    0.5804    0.5804    0.6740
+   108	    0.5843    0.5843    0.6747
+   109	    0.5843    0.5843    0.6753
+   110	    0.5882    0.5882    0.6759
+   111	    0.5922    0.5922    0.6765
+   112	    0.5961    0.5961    0.6770
+   113	    0.5961    0.5961    0.6774
+   114	    0.6000    0.6000    0.6779
+   115	    0.6039    0.6039    0.6783
+   116	    0.6039    0.6039    0.6786
+   117	    0.6078    0.6078    0.6789
+   118	    0.6118    0.6118    0.6792
+   119	    0.6157    0.6157    0.6794
+   120	    0.6157    0.6157    0.6796
+   121	    0.6196    0.6196    0.6798
+   122	    0.6235    0.6235    0.6799
+   123	    0.6235    0.6235    0.6800
+   124	    0.6275    0.6275    0.6800
+   125	    0.6314    0.6314    0.6800
+   126	    0.6353    0.6353    0.6799
+   127	    0.6353    0.6353    0.6799
+   128	    0.6392    0.6392    0.6797
+   129	    0.6431    0.6431    0.6796
+   130	    0.6431    0.6431    0.6794
+   131	    0.6471    0.6471    0.6791
+   132	    0.6510    0.6510    0.6789
+   133	    0.6549    0.6549    0.6785
+   134	    0.6549    0.6549    0.6782
+   135	    0.6588    0.6588    0.6778
+   136	    0.6627    0.6627    0.6773
+   137	    0.6627    0.6627    0.6769
+   138	    0.6667    0.6667    0.6763
+   139	    0.6706    0.6706    0.6758
+   140	    0.6745    0.6745    0.6752
+   141	    0.6745    0.6745    0.6746
+   142	    0.6784    0.6784    0.6739
+   143	    0.6824    0.6824    0.6732
+   144	    0.6824    0.6824    0.6724
+   145	    0.6863    0.6863    0.6716
+   146	    0.6902    0.6902    0.6708
+   147	    0.6941    0.6941    0.6699
+   148	    0.6941    0.6941    0.6690
+   149	    0.6980    0.6980    0.6680
+   150	    0.7020    0.7020    0.6670
+   151	    0.7020    0.7020    0.6660
+   152	    0.7059    0.7059    0.6649
+   153	    0.7098    0.7098    0.6638
+   154	    0.7098    0.7098    0.6626
+   155	    0.7137    0.7137    0.6614
+   156	    0.7176    0.7176    0.6601
+   157	    0.7216    0.7216    0.6589
+   158	    0.7216    0.7216    0.6575
+   159	    0.7255    0.7255    0.6561
+   160	    0.7294    0.7294    0.6547
+   161	    0.7294    0.7294    0.6533
+   162	    0.7333    0.7333    0.6518
+   163	    0.7373    0.7373    0.6502
+   164	    0.7412    0.7412    0.6486
+   165	    0.7412    0.7412    0.6470
+   166	    0.7451    0.7451    0.6453
+   167	    0.7490    0.7490    0.6436
+   168	    0.7490    0.7490    0.6418
+   169	    0.7529    0.7529    0.6400
+   170	    0.7569    0.7569    0.6382
+   171	    0.7608    0.7608    0.6363
+   172	    0.7608    0.7608    0.6343
+   173	    0.7647    0.7647    0.6324
+   174	    0.7686    0.7686    0.6303
+   175	    0.7686    0.7686    0.6282
+   176	    0.7725    0.7725    0.6261
+   177	    0.7765    0.7765    0.6239
+   178	    0.7804    0.7804    0.6217
+   179	    0.7804    0.7804    0.6194
+   180	    0.7843    0.7843    0.6171
+   181	    0.7882    0.7882    0.6147
+   182	    0.7882    0.7882    0.6123
+   183	    0.7922    0.7922    0.6098
+   184	    0.7961    0.7961    0.6073
+   185	    0.8000    0.8000    0.6047
+   186	    0.8000    0.8000    0.6021
+   187	    0.8039    0.8039    0.5994
+   188	    0.8078    0.8078    0.5967
+   189	    0.8078    0.8078    0.5939
+   190	    0.8118    0.8118    0.5911
+   191	    0.8157    0.8157    0.5882
+   192	    0.8196    0.8196    0.5853
+   193	    0.8196    0.8196    0.5823
+   194	    0.8235    0.8235    0.5792
+   195	    0.8275    0.8275    0.5761
+   196	    0.8275    0.8275    0.5729
+   197	    0.8314    0.8314    0.5697
+   198	    0.8353    0.8353    0.5664
+   199	    0.8392    0.8392    0.5630
+   200	    0.8392    0.8392    0.5596
+   201	    0.8431    0.8431    0.5561
+   202	    0.8471    0.8471    0.5525
+   203	    0.8471    0.8471    0.5489
+   204	    0.8510    0.8510    0.5452
+   205	    0.8549    0.8549    0.5414
+   206	    0.8588    0.8588    0.5376
+   207	    0.8588    0.8588    0.5337
+   208	    0.8627    0.8627    0.5297
+   209	    0.8667    0.8667    0.5257
+   210	    0.8667    0.8667    0.5215
+   211	    0.8706    0.8706    0.5173
+   212	    0.8745    0.8745    0.5130
+   213	    0.8784    0.8784    0.5086
+   214	    0.8784    0.8784    0.5042
+   215	    0.8824    0.8824    0.4996
+   216	    0.8863    0.8863    0.4950
+   217	    0.8863    0.8863    0.4902
+   218	    0.8902    0.8902    0.4854
+   219	    0.8941    0.8941    0.4804
+   220	    0.8980    0.8980    0.4754
+   221	    0.8980    0.8980    0.4702
+   222	    0.9020    0.9020    0.4649
+   223	    0.9059    0.9059    0.4595
+   224	    0.9098    0.9098    0.4540
+   225	    0.9098    0.9098    0.4484
+   226	    0.9137    0.9137    0.4426
+   227	    0.9176    0.9176    0.4366
+   228	    0.9176    0.9176    0.4306
+   229	    0.9216    0.9216    0.4243
+   230	    0.9255    0.9255    0.4179
+   231	    0.9294    0.9294    0.4114
+   232	    0.9294    0.9294    0.4046
+   233	    0.9333    0.9333    0.3977
+   234	    0.9373    0.9373    0.3905
+   235	    0.9373    0.9373    0.3831
+   236	    0.9412    0.9412    0.3754
+   237	    0.9451    0.9451    0.3675
+   238	    0.9490    0.9490    0.3594
+   239	    0.9490    0.9490    0.3509
+   240	    0.9529    0.9529    0.3420
+   241	    0.9569    0.9569    0.3328
+   242	    0.9608    0.9608    0.3232
+   243	    0.9608    0.9608    0.3131
+   244	    0.9647    0.9647    0.3024
+   245	    0.9686    0.9686    0.2912
+   246	    0.9686    0.9686    0.2792
+   247	    0.9725    0.9725    0.2664
+   248	    0.9765    0.9765    0.2526
+   249	    0.9804    0.9804    0.2375
+   250	    0.9804    0.9804    0.2208
+   251	    0.9843    0.9843    0.2020
+   252	    0.9882    0.9882    0.1800
+   253	    1.0       0.0       0.0
+   254	    1.0       1.0       0.0
+   255	    0.0       1.000     0.0

Deleted: branches/map65/ccf2.f
===================================================================
--- branches/map65/ccf2.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/ccf2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,45 +0,0 @@
-      subroutine ccf2(ss,nz,nflip,ccfbest,lagpk)
-
-!      parameter (LAGMAX=20)
-      parameter (LAGMAX=200)
-      real ss(nz)
-      real ccf(-LAGMAX:LAGMAX)
-      integer npr(126)
-
-C  The JT65 pseudo-random sync pattern:
-      data npr/
-     + 1,0,0,1,1,0,0,0,1,1,1,1,1,1,0,1,0,1,0,0,
-     + 0,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,1,1,1,1,
-     + 0,1,1,0,1,1,1,1,0,0,0,1,1,0,1,0,1,0,1,1,
-     + 0,0,1,1,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,
-     + 1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,0,1,
-     + 0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,
-     + 1,1,1,1,1,1/
-      save
-
-      ccfbest=0.
-      lag1=-LAGMAX
-      lag2=LAGMAX
-      do lag=lag1,lag2
-         s0=0.
-         s1=0.
-         do i=1,126
-            j=2*(8*i + 43) + lag
-            if(j.ge.1 .and. j.le.nz-8) then
-               x=ss(j)+ss(j+8)
-               if(npr(i).eq.0) then
-                  s0=s0 + x
-               else
-                  s1=s1 + x
-               endif
-            endif
-         enddo
-         ccf(lag)=nflip*(s1-s0)
-         if(ccf(lag).gt.ccfbest) then
-            ccfbest=ccf(lag)
-            lagpk=lag
-         endif
-      enddo
-
-      return
-      end

Deleted: branches/map65/ccf65.f
===================================================================
--- branches/map65/ccf65.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/ccf65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,115 +0,0 @@
-      subroutine ccf65(ss,nhsym,sync1,ipol1,dt1,flipk,syncshort,
-     +     snr2,ipol2,dt2)
-
-      parameter (NFFT=512,NH=NFFT/2)
-      real ss(4,322)
-                   !Input: half-symbol powers, 4 pol'ns
-      real s(NFFT)                     !CCF = ss*pr
-      complex cs(0:NH)                 !Complex FT of s
-      real s2(NFFT)                    !CCF = ss*pr2
-      complex cs2(0:NH)                !Complex FT of s2
-      real pr(NFFT)                    !JT65 pseudo-random sync pattern
-      complex cpr(0:NH)                !Complex FT of pr
-      real pr2(NFFT)                   !JT65 shorthand pattern
-      complex cpr2(0:NH)               !Complex FT of pr2
-      real tmp1(322)
-      real tmp2(322)
-      real ccf(-27:27,4)
-      logical first
-      integer npr(126)
-      data first/.true./
-      equivalence (s,cs),(pr,cpr),(s2,cs2),(pr2,cpr2)
-      save
-
-C  The JT65 pseudo-random sync pattern:
-      data npr/
-     + 1,0,0,1,1,0,0,0,1,1,1,1,1,1,0,1,0,1,0,0,
-     + 0,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,1,1,1,1,
-     + 0,1,1,0,1,1,1,1,0,0,0,1,1,0,1,0,1,0,1,1,
-     + 0,0,1,1,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,
-     + 1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,0,1,
-     + 0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,
-     + 1,1,1,1,1,1/
-
-      if(first) then
-C  Initialize pr, pr2; compute cpr, cpr2.
-         fac=1.0/NFFT
-         do i=1,NFFT
-            pr(i)=0.
-            k=2*mod((i-1)/8,2)-1
-            pr2(i)=fac*k
-         enddo
-         do i=1,126
-            j=2*i
-            pr(j)=fac*(2*npr(i)-1)
-         enddo
-         call four2a(pr,NFFT,1,-1,0)
-         call four2a(pr2,NFFT,1,-1,0)
-         first=.false.
-      endif
-
-C  Look for JT65 sync pattern and shorthand square-wave pattern.
-      ccfbest=0.
-      ccfbest2=0.
-      do ip=1,4                                    !Do all four pol'ns
-         do i=1,nhsym                              ! ?? nhsym-1 ??
-            s(i)=min(4.0,ss(ip,i)+ss(ip,i+1))
-          enddo
-         do i=nhsym+1,NFFT                         ! ?? nhsym ??
-            s(i)=0.
-         enddo
-         call four2a(s,NFFT,1,-1,0)                !Real-to-complex FFT
-         do i=0,NH
-            cs2(i)=cs(i)*conjg(cpr2(i))            !Mult by complex FFT of pr2
-            cs(i)=cs(i)*conjg(cpr(i))              !Mult by complex FFT of pr
-         enddo
-         call four2a(cs,NFFT,1,1,-1)               !Complex-to-real inv-FFT
-         call four2a(cs2,NFFT,1,1,-1)              !Complex-to-real inv-FFT
-
-         do lag=-27,27                             !Check for best JT65 sync
-            ccf(lag,ip)=s(lag+28)                  
-            if(abs(ccf(lag,ip)).gt.ccfbest) then
-               ccfbest=abs(ccf(lag,ip))
-               lagpk=lag
-               ipol1=ip
-               flipk=1.0
-               if(ccf(lag,ip).lt.0.0) flipk=-1.0
-            endif
-         enddo
-
-         do lag=-8,7                               !Check for best shorthand
-            ccf2=s2(lag+28)
-            if(ccf2.gt.ccfbest2) then
-               ccfbest2=ccf2
-               lagpk2=lag
-               ipol2=ip
-            endif
-         enddo
-
-      enddo
-
-C  Find rms level on baseline of &quot;ccfblue&quot;, for normalization.
-      sum=0.
-      do lag=-26,26
-         if(abs(lag-lagpk).gt.1) sum=sum + ccf(lag,ipol1)
-      enddo
-      base=sum/50.0
-      sq=0.
-      do lag=-26,26
-         if(abs(lag-lagpk).gt.1) sq=sq + (ccf(lag,ipol1)-base)**2
-      enddo
-      rms=sqrt(sq/49.0)
-      sync1=ccfbest/rms - 4.0
-      dt1=2.5 + lagpk*(2048.0/11025.0)
-
-C  Find base level for normalizing snr2.
-      do i=1,nhsym
-         tmp1(i)=ss(ipol2,i)
-      enddo
-      call pctile(tmp1,tmp2,nhsym,40,base)
-      snr2=0.398107*ccfbest2/base                !### empirical
-      syncshort=0.5*ccfbest2/rms - 4.0           !### better normalizer than rms?
-      dt2=2.5 + lagpk2*(2048.0/11025.0)
-
-      return
-      end

Deleted: branches/map65/char.h
===================================================================
--- branches/map65/char.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/char.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,57 +0,0 @@
-/* Include file to configure the RS codec for character symbols
- *
- * Copyright 2002, Phil Karn, KA9Q
- * May be used under the terms of the GNU General Public License (GPL)
- */
-#define DTYPE unsigned char
-
-/* Reed-Solomon codec control block */
-struct rs {
-  int mm;              /* Bits per symbol */
-  int nn;              /* Symbols per block (= (1&lt;&lt;mm)-1) */
-  DTYPE *alpha_to;     /* log lookup table */
-  DTYPE *index_of;     /* Antilog lookup table */
-  DTYPE *genpoly;      /* Generator polynomial */
-  int nroots;     /* Number of generator roots = number of parity symbols */
-  int fcr;        /* First consecutive root, index form */
-  int prim;       /* Primitive element, index form */
-  int iprim;      /* prim-th root of 1, index form */
-  int pad;        /* Padding bytes in shortened block */
-};
-
-static inline int modnn(struct rs *rs,int x){
-  while (x &gt;= rs-&gt;nn) {
-    x -= rs-&gt;nn;
-    x = (x &gt;&gt; rs-&gt;mm) + (x &amp; rs-&gt;nn);
-  }
-  return x;
-}
-#define MODNN(x) modnn(rs,x)
-
-#define MM (rs-&gt;mm)
-#define NN (rs-&gt;nn)
-#define ALPHA_TO (rs-&gt;alpha_to) 
-#define INDEX_OF (rs-&gt;index_of)
-#define GENPOLY (rs-&gt;genpoly)
-#define NROOTS (rs-&gt;nroots)
-#define FCR (rs-&gt;fcr)
-#define PRIM (rs-&gt;prim)
-#define IPRIM (rs-&gt;iprim)
-#define PAD (rs-&gt;pad)
-#define A0 (NN)
-
-#define ENCODE_RS encode_rs_char
-#define DECODE_RS decode_rs_char
-#define INIT_RS init_rs_char
-#define FREE_RS free_rs_char
-
-void ENCODE_RS(void *p,DTYPE *data,DTYPE *parity);
-int DECODE_RS(void *p,DTYPE *data,int *eras_pos,int no_eras);
-void *INIT_RS(int symsize,int gfpoly,int fcr,
-		    int prim,int nroots,int pad);
-void FREE_RS(void *p);
-
-
-
-
-

Deleted: branches/map65/chkhist.f
===================================================================
--- branches/map65/chkhist.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/chkhist.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,23 +0,0 @@
-      subroutine chkhist(mrsym,nmax,ipk)
-
-      integer mrsym(63)
-      integer hist(0:63)
-
-      do i=0,63
-         hist(i)=0
-      enddo
-      do j=1,63
-         i=mrsym(j)
-         hist(i)=hist(i)+1
-      enddo
-
-      nmax=0
-      do i=0,63
-         if(hist(i).gt.nmax) then
-            nmax=hist(i)
-            ipk=i+1
-         endif
-      enddo
-
-      return
-      end

Deleted: branches/map65/chkmsg.f
===================================================================
--- branches/map65/chkmsg.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/chkmsg.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,31 +0,0 @@
-      subroutine chkmsg(message,cok,nspecial,flip)
-
-      character message*22,cok*3
-
-      nspecial=0
-      flip=1.0
-      cok=&quot;   &quot;
-
-      do i=22,1,-1
-         if(message(i:i).ne.' ') go to 10
-      enddo
-      i=22
-
- 10   if(i.ge.11 .and. (message(i-3:i).eq.' OOO') .or. 
-     +    (message(20:22).eq.' OO')) then
-         cok='OOO'
-         flip=-1.0
-         if(message(20:22).eq.' OO') then
-            message=message(1:19)
-         else
-            message=message(1:i-4)
-         endif
-      endif
-
-!      if(message(1:3).eq.'ATT') nspecial=1
-      if(message(1:2).eq.'RO')  nspecial=2
-      if(message(1:3).eq.'RRR') nspecial=3
-      if(message(1:2).eq.'73')  nspecial=4
-
-      return
-      end

Added: branches/map65/commons.h
===================================================================
--- branches/map65/commons.h	                        (rev 0)
+++ branches/map65/commons.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,42 @@
+#ifndef COMMONS_H
+#define COMMONS_H
+
+#define NFFT 32768
+
+extern &quot;C&quot; {
+
+extern struct {                     //This is &quot;common/datcom/...&quot; in Fortran
+  float d4[4*5760000];              //Raw I/Q data from Linrad
+  float ss[4*322*NFFT];             //Half-symbol spectra at 0,45,90,135 deg pol
+  float savg[4*NFFT];               //Avg spectra at 0,45,90,135 deg pol
+  double fcenter;                   //Center freq from Linrad (MHz)
+  int nutc;                         //UTC as integer, HHMM
+  int idphi;                        //Phase correction for Y pol'n, degrees
+  int mousedf;                      //User-selected DF
+  int mousefqso;                    //User-selected QSO freq (kHz)
+  int nagain;                       //1 ==&gt; decode only at fQSO +/- Tol
+  int ndepth;                       //How much hinted decoding to do?
+  int ndiskdat;                     //1 ==&gt; data read from *.tf2 or *.iq file
+  int neme;                         //Hinted decoding tries only for EME calls
+  int newdat;                       //1 ==&gt; new data, must do long FFT
+  int nfa;                          //Low decode limit (kHz)
+  int nfb;                          //High decode limit (kHz)
+  int nfcal;                        //Frequency correction, for calibration (Hz)
+  int nfshift;                      //Shift of displayed center freq (kHz)
+  int mcall3;                       //1 ==&gt; CALL3.TXT has been modified
+  int ntimeout;                     //Max for timeouts in Messages and BandMap
+  int ntol;                         //+/- decoding range around fQSO (Hz)
+  int nxant;                        //1 ==&gt; add 45 deg to measured pol angle
+  int map65RxLog;                   //Flags to control log files
+  int nfsample;                     //Input sample rate
+  int nxpol;                        //1 if using xpol antennas, 0 otherwise
+  int mode65;                       //JT65 sub-mode: A=1, B=2, C=4
+  char mycall[12];
+  char mygrid[6];
+  char hiscall[12];
+  char hisgrid[6];
+  char datetime[20];
+} datcom_;
+}
+
+#endif // COMMONS_H

Deleted: branches/map65/configure
===================================================================
--- branches/map65/configure	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/configure	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,6911 +0,0 @@
-#! /bin/sh
-# Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.62 for map65 0.9.
-#
-# $Id: configure.ac 1251 2009-05-19 22:49:52Z va3db $
-#
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
-# This configure script is free software; the Free Software Foundation
-# gives unlimited permission to copy, distribute and modify it.
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
-
-# Be more Bourne compatible
-DUALCASE=1; export DUALCASE # for MKS sh
-if test -n &quot;${ZSH_VERSION+set}&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+&quot;$@&quot;}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2&gt;/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
-fi
-
-
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
-as_nl='
-'
-export as_nl
-# Printing a long string crashes Solaris 7 /usr/bin/printf.
-as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
-as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
-as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test &quot;X`printf %s $as_echo`&quot; = &quot;X$as_echo&quot;) 2&gt;/dev/null; then
-  as_echo='printf %s\n'
-  as_echo_n='printf %s'
-else
-  if test &quot;X`(/usr/ucb/echo -n -n $as_echo) 2&gt;/dev/null`&quot; = &quot;X-n $as_echo&quot;; then
-    as_echo_body='eval /usr/ucb/echo -n &quot;$1$as_nl&quot;'
-    as_echo_n='/usr/ucb/echo -n'
-  else
-    as_echo_body='eval expr &quot;X$1&quot; : &quot;X\\(.*\\)&quot;'
-    as_echo_n_body='eval
-      arg=$1;
-      case $arg in
-      *&quot;$as_nl&quot;*)
-	expr &quot;X$arg&quot; : &quot;X\\(.*\\)$as_nl&quot;;
-	arg=`expr &quot;X$arg&quot; : &quot;.*$as_nl\\(.*\\)&quot;`;;
-      esac;
-      expr &quot;X$arg&quot; : &quot;X\\(.*\\)&quot; | tr -d &quot;$as_nl&quot;
-    '
-    export as_echo_n_body
-    as_echo_n='sh -c $as_echo_n_body as_echo'
-  fi
-  export as_echo_body
-  as_echo='sh -c $as_echo_body as_echo'
-fi
-
-# The user is always right.
-if test &quot;${PATH_SEPARATOR+set}&quot; != set; then
-  PATH_SEPARATOR=:
-  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; {
-    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) &gt;/dev/null 2&gt;&amp;1 ||
-      PATH_SEPARATOR=';'
-  }
-fi
-
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) &gt;/dev/null 2&gt;&amp;1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
-
-# IFS
-# We need space, tab and new line, in precisely that order.  Quoting is
-# there to prevent editors from complaining about space-tab.
-# (If _AS_PATH_WALK were called with IFS unset, it would disable word
-# splitting by setting IFS to empty value.)
-IFS=&quot; &quot;&quot;	$as_nl&quot;
-
-# Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
-  *[\\/]* ) as_myself=$0 ;;
-  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  test -r &quot;$as_dir/$0&quot; &amp;&amp; as_myself=$as_dir/$0 &amp;&amp; break
-done
-IFS=$as_save_IFS
-
-     ;;
-esac
-# We did not find ourselves, most probably we were run as `sh COMMAND'
-# in which case we are not to be found in the path.
-if test &quot;x$as_myself&quot; = x; then
-  as_myself=$0
-fi
-if test ! -f &quot;$as_myself&quot;; then
-  $as_echo &quot;$as_myself: error: cannot find myself; rerun with an absolute file name&quot; &gt;&amp;2
-  { (exit 1); exit 1; }
-fi
-
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; $as_unset $as_var
-done
-PS1='$ '
-PS2='&gt; '
-PS4='+ '
-
-# NLS nuisances.
-LC_ALL=C
-export LC_ALL
-LANGUAGE=C
-export LANGUAGE
-
-# Required to use basename.
-if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
-   test &quot;X`expr 00001 : '.*\(...\)'`&quot; = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-if (basename -- /) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; test &quot;X`basename -- / 2&gt;&amp;1`&quot; = &quot;X/&quot;; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-
-# Name of the executable.
-as_me=`$as_basename -- &quot;$0&quot; ||
-$as_expr X/&quot;$0&quot; : '.*/\([^/][^/]*\)/*$' \| \
-	 X&quot;$0&quot; : 'X\(//\)$' \| \
-	 X&quot;$0&quot; : 'X\(/\)' \| . 2&gt;/dev/null ||
-$as_echo X/&quot;$0&quot; |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-
-# CDPATH.
-$as_unset CDPATH
-
-
-if test &quot;x$CONFIG_SHELL&quot; = x; then
-  if (eval &quot;:&quot;) 2&gt;/dev/null; then
-  as_have_required=yes
-else
-  as_have_required=no
-fi
-
-  if test $as_have_required = yes &amp;&amp;	 (eval &quot;:
-(as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
-
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y &amp;&amp; test x = \&quot;\$1\&quot; ); then
-  :
-else
-  exitcode=1
-  echo positional parameters were not saved.
-fi
-
-test \$exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=\$LINENO
-  as_lineno_2=\$LINENO
-  test \&quot;x\$as_lineno_1\&quot; != \&quot;x\$as_lineno_2\&quot; &amp;&amp;
-  test \&quot;x\`expr \$as_lineno_1 + 1\`\&quot; = \&quot;x\$as_lineno_2\&quot;) || { (exit 1); exit 1; }
-&quot;) 2&gt; /dev/null; then
-  :
-else
-  as_candidate_shells=
-    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  case $as_dir in
-	 /*)
-	   for as_base in sh bash ksh sh5; do
-	     as_candidate_shells=&quot;$as_candidate_shells $as_dir/$as_base&quot;
-	   done;;
-       esac
-done
-IFS=$as_save_IFS
-
-
-      for as_shell in $as_candidate_shells $SHELL; do
-	 # Try only shells that exist, to save several forks.
-	 if { test -f &quot;$as_shell&quot; || test -f &quot;$as_shell.exe&quot;; } &amp;&amp;
-		{ (&quot;$as_shell&quot;) 2&gt; /dev/null &lt;&lt;\_ASEOF
-if test -n &quot;${ZSH_VERSION+set}&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+&quot;$@&quot;}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2&gt;/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
-fi
-
-
-:
-_ASEOF
-}; then
-  CONFIG_SHELL=$as_shell
-	       as_have_required=yes
-	       if { &quot;$as_shell&quot; 2&gt; /dev/null &lt;&lt;\_ASEOF
-if test -n &quot;${ZSH_VERSION+set}&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+&quot;$@&quot;}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2&gt;/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
-fi
-
-
-:
-(as_func_return () {
-  (exit $1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
-
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y &amp;&amp; test x = &quot;$1&quot; ); then
-  :
-else
-  exitcode=1
-  echo positional parameters were not saved.
-fi
-
-test $exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test &quot;x$as_lineno_1&quot; != &quot;x$as_lineno_2&quot; &amp;&amp;
-  test &quot;x`expr $as_lineno_1 + 1`&quot; = &quot;x$as_lineno_2&quot;) || { (exit 1); exit 1; }
-
-_ASEOF
-}; then
-  break
-fi
-
-fi
-
-      done
-
-      if test &quot;x$CONFIG_SHELL&quot; != x; then
-  for as_var in BASH_ENV ENV
-	do ($as_unset $as_var) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; $as_unset $as_var
-	done
-	export CONFIG_SHELL
-	exec &quot;$CONFIG_SHELL&quot; &quot;$as_myself&quot; ${1+&quot;$@&quot;}
-fi
-
-
-    if test $as_have_required = no; then
-  echo This script requires a shell more modern than all the
-      echo shells that I found on your system.  Please install a
-      echo modern shell, or manually run the script under such a
-      echo shell if you do have one.
-      { (exit 1); exit 1; }
-fi
-
-
-fi
-
-fi
-
-
-
-(eval &quot;as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
-
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y &amp;&amp; test x = \&quot;\$1\&quot; ); then
-  :
-else
-  exitcode=1
-  echo positional parameters were not saved.
-fi
-
-test \$exitcode = 0&quot;) || {
-  echo No shell found that supports shell functions.
-  echo Please tell <A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">bug-autoconf at gnu.org</A> about your system,
-  echo including any error possibly output before this message.
-  echo This can help us improve future autoconf versions.
-  echo Configuration will now proceed without shell functions.
-}
-
-
-
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test &quot;x$as_lineno_1&quot; != &quot;x$as_lineno_2&quot; &amp;&amp;
-  test &quot;x`expr $as_lineno_1 + 1`&quot; = &quot;x$as_lineno_2&quot; || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' &lt;$as_myself |
-    sed '
-      s/[$]LINENO.*/&amp;-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' &gt;$as_me.lineno &amp;&amp;
-  chmod +x &quot;$as_me.lineno&quot; ||
-    { $as_echo &quot;$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . &quot;./$as_me.lineno&quot;
-  # Exit status is that of the last command.
-  exit
-}
-
-
-if (as_dir=`dirname -- /` &amp;&amp; test &quot;X$as_dir&quot; = X/) &gt;/dev/null 2&gt;&amp;1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
-ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
--n*)
-  case `echo 'x\c'` in
-  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
-  esac;;
-*)
-  ECHO_N='-n';;
-esac
-if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
-   test &quot;X`expr 00001 : '.*\(...\)'`&quot; = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-rm -f conf$$ conf$$.exe conf$$.file
-if test -d conf$$.dir; then
-  rm -f conf$$.dir/conf$$.file
-else
-  rm -f conf$$.dir
-  mkdir conf$$.dir 2&gt;/dev/null
-fi
-if (echo &gt;conf$$.file) 2&gt;/dev/null; then
-  if ln -s conf$$.file conf$$ 2&gt;/dev/null; then
-    as_ln_s='ln -s'
-    # ... but there are two gotchas:
-    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
-    # 2) DJGPP &lt; 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
-    ln -s conf$$.file conf$$.dir 2&gt;/dev/null &amp;&amp; test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
-  elif ln conf$$.file conf$$ 2&gt;/dev/null; then
-    as_ln_s=ln
-  else
-    as_ln_s='cp -p'
-  fi
-else
-  as_ln_s='cp -p'
-fi
-rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
-rmdir conf$$.dir 2&gt;/dev/null
-
-if mkdir -p . 2&gt;/dev/null; then
-  as_mkdir_p=:
-else
-  test -d ./-p &amp;&amp; rmdir ./-p
-  as_mkdir_p=false
-fi
-
-if test -x / &gt;/dev/null 2&gt;&amp;1; then
-  as_test_x='test -x'
-else
-  if ls -dL / &gt;/dev/null 2&gt;&amp;1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d &quot;$1&quot;; then
-	test -d &quot;$1/.&quot;;
-      else
-	case $1 in
-	-*)set &quot;./$1&quot;;;
-	esac;
-	case `ls -ld'$as_ls_L_option' &quot;$1&quot; 2&gt;/dev/null` in
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
-
-# Sed expression to map a string onto a valid CPP name.
-as_tr_cpp=&quot;eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'&quot;
-
-# Sed expression to map a string onto a valid variable name.
-as_tr_sh=&quot;eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'&quot;
-
-
-
-exec 7&lt;&amp;0 &lt;/dev/null 6&gt;&amp;1
-
-# Name of the host.
-# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
-# so uname gets run too.
-ac_hostname=`(hostname || uname -n) 2&gt;/dev/null | sed 1q`
-
-#
-# Initializations.
-#
-ac_default_prefix=/usr/local
-ac_clean_files=
-ac_config_libobj_dir=.
-LIBOBJS=
-cross_compiling=no
-subdirs=
-MFLAGS=
-MAKEFLAGS=
-SHELL=${CONFIG_SHELL-/bin/sh}
-
-# Identity of this package.
-PACKAGE_NAME='map65'
-PACKAGE_TARNAME='map65'
-PACKAGE_VERSION='0.9'
-PACKAGE_STRING='map65 0.9'
-PACKAGE_BUGREPORT=''
-
-ac_default_prefix=/usr/local/
-# Factoring default headers for most tests.
-ac_includes_default=&quot;\
-#include &lt;stdio.h&gt;
-#ifdef HAVE_SYS_TYPES_H
-# include &lt;sys/types.h&gt;
-#endif
-#ifdef HAVE_SYS_STAT_H
-# include &lt;sys/stat.h&gt;
-#endif
-#ifdef STDC_HEADERS
-# include &lt;stdlib.h&gt;
-# include &lt;stddef.h&gt;
-#else
-# ifdef HAVE_STDLIB_H
-#  include &lt;stdlib.h&gt;
-# endif
-#endif
-#ifdef HAVE_STRING_H
-# if !defined STDC_HEADERS &amp;&amp; defined HAVE_MEMORY_H
-#  include &lt;memory.h&gt;
-# endif
-# include &lt;string.h&gt;
-#endif
-#ifdef HAVE_STRINGS_H
-# include &lt;strings.h&gt;
-#endif
-#ifdef HAVE_INTTYPES_H
-# include &lt;inttypes.h&gt;
-#endif
-#ifdef HAVE_STDINT_H
-# include &lt;stdint.h&gt;
-#endif
-#ifdef HAVE_UNISTD_H
-# include &lt;unistd.h&gt;
-#endif&quot;
-
-ac_subst_vars='SHELL
-PATH_SEPARATOR
-PACKAGE_NAME
-PACKAGE_TARNAME
-PACKAGE_VERSION
-PACKAGE_STRING
-PACKAGE_BUGREPORT
-exec_prefix
-prefix
-program_transform_name
-bindir
-sbindir
-libexecdir
-datarootdir
-datadir
-sysconfdir
-sharedstatedir
-localstatedir
-includedir
-oldincludedir
-docdir
-infodir
-htmldir
-dvidir
-pdfdir
-psdir
-libdir
-localedir
-mandir
-DEFS
-ECHO_C
-ECHO_N
-ECHO_T
-LIBS
-build_alias
-host_alias
-target_alias
-CC
-CFLAGS
-LDFLAGS
-CPPFLAGS
-ac_ct_CC
-EXEEXT
-OBJEXT
-F77
-FFLAGS
-ac_ct_F77
-G95
-GFORTRAN
-FC_LIB_PATH
-FC
-FCV
-CPP
-GREP
-EGREP
-SET_MAKE
-INSTALL_PROGRAM
-INSTALL_SCRIPT
-INSTALL_DATA
-RM
-CP
-MV
-LN
-SED
-AR
-LD
-TEST
-PYTHON
-F2PY
-OS
-CLOBBER
-PREFIX
-LIBOBJS
-LTLIBOBJS'
-ac_subst_files=''
-ac_user_opts='
-enable_option_checking
-enable_g95
-enable_gfortran
-with_portaudio_include_dir
-with_portaudio_lib_dir
-enable_clobber
-enable_assert
-'
-      ac_precious_vars='build_alias
-host_alias
-target_alias
-CC
-CFLAGS
-LDFLAGS
-LIBS
-CPPFLAGS
-F77
-FFLAGS
-CPP'
-
-
-# Initialize some variables set by options.
-ac_init_help=
-ac_init_version=false
-ac_unrecognized_opts=
-ac_unrecognized_sep=
-# The variables have the same names as the options, with
-# dashes changed to underlines.
-cache_file=/dev/null
-exec_prefix=NONE
-no_create=
-no_recursion=
-prefix=NONE
-program_prefix=NONE
-program_suffix=NONE
-program_transform_name=s,x,x,
-silent=
-site=
-srcdir=
-verbose=
-x_includes=NONE
-x_libraries=NONE
-
-# Installation directory options.
-# These are left unexpanded so users can &quot;make install exec_prefix=/foo&quot;
-# and all the variables that are supposed to be based on exec_prefix
-# by default will actually change.
-# Use braces instead of parens because sh, perl, etc. also accept them.
-# (The list follows the same order as the GNU Coding Standards.)
-bindir='${exec_prefix}/bin'
-sbindir='${exec_prefix}/sbin'
-libexecdir='${exec_prefix}/libexec'
-datarootdir='${prefix}/share'
-datadir='${datarootdir}'
-sysconfdir='${prefix}/etc'
-sharedstatedir='${prefix}/com'
-localstatedir='${prefix}/var'
-includedir='${prefix}/include'
-oldincludedir='/usr/include'
-docdir='${datarootdir}/doc/${PACKAGE_TARNAME}'
-infodir='${datarootdir}/info'
-htmldir='${docdir}'
-dvidir='${docdir}'
-pdfdir='${docdir}'
-psdir='${docdir}'
-libdir='${exec_prefix}/lib'
-localedir='${datarootdir}/locale'
-mandir='${datarootdir}/man'
-
-ac_prev=
-ac_dashdash=
-for ac_option
-do
-  # If the previous option needs an argument, assign it.
-  if test -n &quot;$ac_prev&quot;; then
-    eval $ac_prev=\$ac_option
-    ac_prev=
-    continue
-  fi
-
-  case $ac_option in
-  *=*)	ac_optarg=`expr &quot;X$ac_option&quot; : '[^=]*=\(.*\)'` ;;
-  *)	ac_optarg=yes ;;
-  esac
-
-  # Accept the important Cygnus configure options, so we can diagnose typos.
-
-  case $ac_dashdash$ac_option in
-  --)
-    ac_dashdash=yes ;;
-
-  -bindir | --bindir | --bindi | --bind | --bin | --bi)
-    ac_prev=bindir ;;
-  -bindir=* | --bindir=* | --bindi=* | --bind=* | --bin=* | --bi=*)
-    bindir=$ac_optarg ;;
-
-  -build | --build | --buil | --bui | --bu)
-    ac_prev=build_alias ;;
-  -build=* | --build=* | --buil=* | --bui=* | --bu=*)
-    build_alias=$ac_optarg ;;
-
-  -cache-file | --cache-file | --cache-fil | --cache-fi \
-  | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
-    ac_prev=cache_file ;;
-  -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
-  | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
-    cache_file=$ac_optarg ;;
-
-  --config-cache | -C)
-    cache_file=config.cache ;;
-
-  -datadir | --datadir | --datadi | --datad)
-    ac_prev=datadir ;;
-  -datadir=* | --datadir=* | --datadi=* | --datad=*)
-    datadir=$ac_optarg ;;
-
-  -datarootdir | --datarootdir | --datarootdi | --datarootd | --dataroot \
-  | --dataroo | --dataro | --datar)
-    ac_prev=datarootdir ;;
-  -datarootdir=* | --datarootdir=* | --datarootdi=* | --datarootd=* \
-  | --dataroot=* | --dataroo=* | --dataro=* | --datar=*)
-    datarootdir=$ac_optarg ;;
-
-  -disable-* | --disable-*)
-    ac_useropt=`expr &quot;x$ac_option&quot; : 'x-*disable-\(.*\)'`
-    # Reject names that are not valid shell variable names.
-    expr &quot;x$ac_useropt&quot; : &quot;.*[^-+._$as_cr_alnum]&quot; &gt;/dev/null &amp;&amp;
-      { $as_echo &quot;$as_me: error: invalid feature name: $ac_useropt&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-    ac_useropt_orig=$ac_useropt
-    ac_useropt=`$as_echo &quot;$ac_useropt&quot; | sed 's/[-+.]/_/g'`
-    case $ac_user_opts in
-      *&quot;
-&quot;enable_$ac_useropt&quot;
-&quot;*) ;;
-      *) ac_unrecognized_opts=&quot;$ac_unrecognized_opts$ac_unrecognized_sep--disable-$ac_useropt_orig&quot;
-	 ac_unrecognized_sep=', ';;
-    esac
-    eval enable_$ac_useropt=no ;;
-
-  -docdir | --docdir | --docdi | --doc | --do)
-    ac_prev=docdir ;;
-  -docdir=* | --docdir=* | --docdi=* | --doc=* | --do=*)
-    docdir=$ac_optarg ;;
-
-  -dvidir | --dvidir | --dvidi | --dvid | --dvi | --dv)
-    ac_prev=dvidir ;;
-  -dvidir=* | --dvidir=* | --dvidi=* | --dvid=* | --dvi=* | --dv=*)
-    dvidir=$ac_optarg ;;
-
-  -enable-* | --enable-*)
-    ac_useropt=`expr &quot;x$ac_option&quot; : 'x-*enable-\([^=]*\)'`
-    # Reject names that are not valid shell variable names.
-    expr &quot;x$ac_useropt&quot; : &quot;.*[^-+._$as_cr_alnum]&quot; &gt;/dev/null &amp;&amp;
-      { $as_echo &quot;$as_me: error: invalid feature name: $ac_useropt&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-    ac_useropt_orig=$ac_useropt
-    ac_useropt=`$as_echo &quot;$ac_useropt&quot; | sed 's/[-+.]/_/g'`
-    case $ac_user_opts in
-      *&quot;
-&quot;enable_$ac_useropt&quot;
-&quot;*) ;;
-      *) ac_unrecognized_opts=&quot;$ac_unrecognized_opts$ac_unrecognized_sep--enable-$ac_useropt_orig&quot;
-	 ac_unrecognized_sep=', ';;
-    esac
-    eval enable_$ac_useropt=\$ac_optarg ;;
-
-  -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
-  | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
-  | --exec | --exe | --ex)
-    ac_prev=exec_prefix ;;
-  -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
-  | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
-  | --exec=* | --exe=* | --ex=*)
-    exec_prefix=$ac_optarg ;;
-
-  -gas | --gas | --ga | --g)
-    # Obsolete; use --with-gas.
-    with_gas=yes ;;
-
-  -help | --help | --hel | --he | -h)
-    ac_init_help=long ;;
-  -help=r* | --help=r* | --hel=r* | --he=r* | -hr*)
-    ac_init_help=recursive ;;
-  -help=s* | --help=s* | --hel=s* | --he=s* | -hs*)
-    ac_init_help=short ;;
-
-  -host | --host | --hos | --ho)
-    ac_prev=host_alias ;;
-  -host=* | --host=* | --hos=* | --ho=*)
-    host_alias=$ac_optarg ;;
-
-  -htmldir | --htmldir | --htmldi | --htmld | --html | --htm | --ht)
-    ac_prev=htmldir ;;
-  -htmldir=* | --htmldir=* | --htmldi=* | --htmld=* | --html=* | --htm=* \
-  | --ht=*)
-    htmldir=$ac_optarg ;;
-
-  -includedir | --includedir | --includedi | --included | --include \
-  | --includ | --inclu | --incl | --inc)
-    ac_prev=includedir ;;
-  -includedir=* | --includedir=* | --includedi=* | --included=* | --include=* \
-  | --includ=* | --inclu=* | --incl=* | --inc=*)
-    includedir=$ac_optarg ;;
-
-  -infodir | --infodir | --infodi | --infod | --info | --inf)
-    ac_prev=infodir ;;
-  -infodir=* | --infodir=* | --infodi=* | --infod=* | --info=* | --inf=*)
-    infodir=$ac_optarg ;;
-
-  -libdir | --libdir | --libdi | --libd)
-    ac_prev=libdir ;;
-  -libdir=* | --libdir=* | --libdi=* | --libd=*)
-    libdir=$ac_optarg ;;
-
-  -libexecdir | --libexecdir | --libexecdi | --libexecd | --libexec \
-  | --libexe | --libex | --libe)
-    ac_prev=libexecdir ;;
-  -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
-  | --libexe=* | --libex=* | --libe=*)
-    libexecdir=$ac_optarg ;;
-
-  -localedir | --localedir | --localedi | --localed | --locale)
-    ac_prev=localedir ;;
-  -localedir=* | --localedir=* | --localedi=* | --localed=* | --locale=*)
-    localedir=$ac_optarg ;;
-
-  -localstatedir | --localstatedir | --localstatedi | --localstated \
-  | --localstate | --localstat | --localsta | --localst | --locals)
-    ac_prev=localstatedir ;;
-  -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
-  | --localstate=* | --localstat=* | --localsta=* | --localst=* | --locals=*)
-    localstatedir=$ac_optarg ;;
-
-  -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
-    ac_prev=mandir ;;
-  -mandir=* | --mandir=* | --mandi=* | --mand=* | --man=* | --ma=* | --m=*)
-    mandir=$ac_optarg ;;
-
-  -nfp | --nfp | --nf)
-    # Obsolete; use --without-fp.
-    with_fp=no ;;
-
-  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
-  | --no-cr | --no-c | -n)
-    no_create=yes ;;
-
-  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
-  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
-    no_recursion=yes ;;
-
-  -oldincludedir | --oldincludedir | --oldincludedi | --oldincluded \
-  | --oldinclude | --oldinclud | --oldinclu | --oldincl | --oldinc \
-  | --oldin | --oldi | --old | --ol | --o)
-    ac_prev=oldincludedir ;;
-  -oldincludedir=* | --oldincludedir=* | --oldincludedi=* | --oldincluded=* \
-  | --oldinclude=* | --oldinclud=* | --oldinclu=* | --oldincl=* | --oldinc=* \
-  | --oldin=* | --oldi=* | --old=* | --ol=* | --o=*)
-    oldincludedir=$ac_optarg ;;
-
-  -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
-    ac_prev=prefix ;;
-  -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
-    prefix=$ac_optarg ;;
-
-  -program-prefix | --program-prefix | --program-prefi | --program-pref \
-  | --program-pre | --program-pr | --program-p)
-    ac_prev=program_prefix ;;
-  -program-prefix=* | --program-prefix=* | --program-prefi=* \
-  | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
-    program_prefix=$ac_optarg ;;
-
-  -program-suffix | --program-suffix | --program-suffi | --program-suff \
-  | --program-suf | --program-su | --program-s)
-    ac_prev=program_suffix ;;
-  -program-suffix=* | --program-suffix=* | --program-suffi=* \
-  | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
-    program_suffix=$ac_optarg ;;
-
-  -program-transform-name | --program-transform-name \
-  | --program-transform-nam | --program-transform-na \
-  | --program-transform-n | --program-transform- \
-  | --program-transform | --program-transfor \
-  | --program-transfo | --program-transf \
-  | --program-trans | --program-tran \
-  | --progr-tra | --program-tr | --program-t)
-    ac_prev=program_transform_name ;;
-  -program-transform-name=* | --program-transform-name=* \
-  | --program-transform-nam=* | --program-transform-na=* \
-  | --program-transform-n=* | --program-transform-=* \
-  | --program-transform=* | --program-transfor=* \
-  | --program-transfo=* | --program-transf=* \
-  | --program-trans=* | --program-tran=* \
-  | --progr-tra=* | --program-tr=* | --program-t=*)
-    program_transform_name=$ac_optarg ;;
-
-  -pdfdir | --pdfdir | --pdfdi | --pdfd | --pdf | --pd)
-    ac_prev=pdfdir ;;
-  -pdfdir=* | --pdfdir=* | --pdfdi=* | --pdfd=* | --pdf=* | --pd=*)
-    pdfdir=$ac_optarg ;;
-
-  -psdir | --psdir | --psdi | --psd | --ps)
-    ac_prev=psdir ;;
-  -psdir=* | --psdir=* | --psdi=* | --psd=* | --ps=*)
-    psdir=$ac_optarg ;;
-
-  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-  | -silent | --silent | --silen | --sile | --sil)
-    silent=yes ;;
-
-  -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
-    ac_prev=sbindir ;;
-  -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
-  | --sbi=* | --sb=*)
-    sbindir=$ac_optarg ;;
-
-  -sharedstatedir | --sharedstatedir | --sharedstatedi \
-  | --sharedstated | --sharedstate | --sharedstat | --sharedsta \
-  | --sharedst | --shareds | --shared | --share | --shar \
-  | --sha | --sh)
-    ac_prev=sharedstatedir ;;
-  -sharedstatedir=* | --sharedstatedir=* | --sharedstatedi=* \
-  | --sharedstated=* | --sharedstate=* | --sharedstat=* | --sharedsta=* \
-  | --sharedst=* | --shareds=* | --shared=* | --share=* | --shar=* \
-  | --sha=* | --sh=*)
-    sharedstatedir=$ac_optarg ;;
-
-  -site | --site | --sit)
-    ac_prev=site ;;
-  -site=* | --site=* | --sit=*)
-    site=$ac_optarg ;;
-
-  -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
-    ac_prev=srcdir ;;
-  -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
-    srcdir=$ac_optarg ;;
-
-  -sysconfdir | --sysconfdir | --sysconfdi | --sysconfd | --sysconf \
-  | --syscon | --sysco | --sysc | --sys | --sy)
-    ac_prev=sysconfdir ;;
-  -sysconfdir=* | --sysconfdir=* | --sysconfdi=* | --sysconfd=* | --sysconf=* \
-  | --syscon=* | --sysco=* | --sysc=* | --sys=* | --sy=*)
-    sysconfdir=$ac_optarg ;;
-
-  -target | --target | --targe | --targ | --tar | --ta | --t)
-    ac_prev=target_alias ;;
-  -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
-    target_alias=$ac_optarg ;;
-
-  -v | -verbose | --verbose | --verbos | --verbo | --verb)
-    verbose=yes ;;
-
-  -version | --version | --versio | --versi | --vers | -V)
-    ac_init_version=: ;;
-
-  -with-* | --with-*)
-    ac_useropt=`expr &quot;x$ac_option&quot; : 'x-*with-\([^=]*\)'`
-    # Reject names that are not valid shell variable names.
-    expr &quot;x$ac_useropt&quot; : &quot;.*[^-+._$as_cr_alnum]&quot; &gt;/dev/null &amp;&amp;
-      { $as_echo &quot;$as_me: error: invalid package name: $ac_useropt&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-    ac_useropt_orig=$ac_useropt
-    ac_useropt=`$as_echo &quot;$ac_useropt&quot; | sed 's/[-+.]/_/g'`
-    case $ac_user_opts in
-      *&quot;
-&quot;with_$ac_useropt&quot;
-&quot;*) ;;
-      *) ac_unrecognized_opts=&quot;$ac_unrecognized_opts$ac_unrecognized_sep--with-$ac_useropt_orig&quot;
-	 ac_unrecognized_sep=', ';;
-    esac
-    eval with_$ac_useropt=\$ac_optarg ;;
-
-  -without-* | --without-*)
-    ac_useropt=`expr &quot;x$ac_option&quot; : 'x-*without-\(.*\)'`
-    # Reject names that are not valid shell variable names.
-    expr &quot;x$ac_useropt&quot; : &quot;.*[^-+._$as_cr_alnum]&quot; &gt;/dev/null &amp;&amp;
-      { $as_echo &quot;$as_me: error: invalid package name: $ac_useropt&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-    ac_useropt_orig=$ac_useropt
-    ac_useropt=`$as_echo &quot;$ac_useropt&quot; | sed 's/[-+.]/_/g'`
-    case $ac_user_opts in
-      *&quot;
-&quot;with_$ac_useropt&quot;
-&quot;*) ;;
-      *) ac_unrecognized_opts=&quot;$ac_unrecognized_opts$ac_unrecognized_sep--without-$ac_useropt_orig&quot;
-	 ac_unrecognized_sep=', ';;
-    esac
-    eval with_$ac_useropt=no ;;
-
-  --x)
-    # Obsolete; use --with-x.
-    with_x=yes ;;
-
-  -x-includes | --x-includes | --x-include | --x-includ | --x-inclu \
-  | --x-incl | --x-inc | --x-in | --x-i)
-    ac_prev=x_includes ;;
-  -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
-  | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
-    x_includes=$ac_optarg ;;
-
-  -x-libraries | --x-libraries | --x-librarie | --x-librari \
-  | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
-    ac_prev=x_libraries ;;
-  -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
-  | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
-    x_libraries=$ac_optarg ;;
-
-  -*) { $as_echo &quot;$as_me: error: unrecognized option: $ac_option
-Try \`$0 --help' for more information.&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-    ;;
-
-  *=*)
-    ac_envvar=`expr &quot;x$ac_option&quot; : 'x\([^=]*\)='`
-    # Reject names that are not valid shell variable names.
-    expr &quot;x$ac_envvar&quot; : &quot;.*[^_$as_cr_alnum]&quot; &gt;/dev/null &amp;&amp;
-      { $as_echo &quot;$as_me: error: invalid variable name: $ac_envvar&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-    eval $ac_envvar=\$ac_optarg
-    export $ac_envvar ;;
-
-  *)
-    # FIXME: should be removed in autoconf 3.0.
-    $as_echo &quot;$as_me: WARNING: you should use --build, --host, --target&quot; &gt;&amp;2
-    expr &quot;x$ac_option&quot; : &quot;.*[^-._$as_cr_alnum]&quot; &gt;/dev/null &amp;&amp;
-      $as_echo &quot;$as_me: WARNING: invalid host type: $ac_option&quot; &gt;&amp;2
-    : ${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}
-    ;;
-
-  esac
-done
-
-if test -n &quot;$ac_prev&quot;; then
-  ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  { $as_echo &quot;$as_me: error: missing argument to $ac_option&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-fi
-
-if test -n &quot;$ac_unrecognized_opts&quot;; then
-  case $enable_option_checking in
-    no) ;;
-    fatal) { $as_echo &quot;$as_me: error: Unrecognized options: $ac_unrecognized_opts&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; } ;;
-    *)     $as_echo &quot;$as_me: WARNING: Unrecognized options: $ac_unrecognized_opts&quot; &gt;&amp;2 ;;
-  esac
-fi
-
-# Check all directory arguments for consistency.
-for ac_var in	exec_prefix prefix bindir sbindir libexecdir datarootdir \
-		datadir sysconfdir sharedstatedir localstatedir includedir \
-		oldincludedir docdir infodir htmldir dvidir pdfdir psdir \
-		libdir localedir mandir
-do
-  eval ac_val=\$$ac_var
-  # Remove trailing slashes.
-  case $ac_val in
-    */ )
-      ac_val=`expr &quot;X$ac_val&quot; : 'X\(.*[^/]\)' \| &quot;X$ac_val&quot; : 'X\(.*\)'`
-      eval $ac_var=\$ac_val;;
-  esac
-  # Be sure to have absolute directory names.
-  case $ac_val in
-    [\\/$]* | ?:[\\/]* )  continue;;
-    NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
-  esac
-  { $as_echo &quot;$as_me: error: expected an absolute directory name for --$ac_var: $ac_val&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-done
-
-# There might be people who depend on the old broken behavior: `$host'
-# used to hold the argument of --host etc.
-# FIXME: To remove some day.
-build=$build_alias
-host=$host_alias
-target=$target_alias
-
-# FIXME: To remove some day.
-if test &quot;x$host_alias&quot; != x; then
-  if test &quot;x$build_alias&quot; = x; then
-    cross_compiling=maybe
-    $as_echo &quot;$as_me: WARNING: If you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used.&quot; &gt;&amp;2
-  elif test &quot;x$build_alias&quot; != &quot;x$host_alias&quot;; then
-    cross_compiling=yes
-  fi
-fi
-
-ac_tool_prefix=
-test -n &quot;$host_alias&quot; &amp;&amp; ac_tool_prefix=$host_alias-
-
-test &quot;$silent&quot; = yes &amp;&amp; exec 6&gt;/dev/null
-
-
-ac_pwd=`pwd` &amp;&amp; test -n &quot;$ac_pwd&quot; &amp;&amp;
-ac_ls_di=`ls -di .` &amp;&amp;
-ac_pwd_ls_di=`cd &quot;$ac_pwd&quot; &amp;&amp; ls -di .` ||
-  { $as_echo &quot;$as_me: error: Working directory cannot be determined&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-test &quot;X$ac_ls_di&quot; = &quot;X$ac_pwd_ls_di&quot; ||
-  { $as_echo &quot;$as_me: error: pwd does not report name of working directory&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-
-
-# Find the source files, if location was not specified.
-if test -z &quot;$srcdir&quot;; then
-  ac_srcdir_defaulted=yes
-  # Try the directory containing this script, then the parent directory.
-  ac_confdir=`$as_dirname -- &quot;$as_myself&quot; ||
-$as_expr X&quot;$as_myself&quot; : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X&quot;$as_myself&quot; : 'X\(//\)[^/]' \| \
-	 X&quot;$as_myself&quot; : 'X\(//\)$' \| \
-	 X&quot;$as_myself&quot; : 'X\(/\)' \| . 2&gt;/dev/null ||
-$as_echo X&quot;$as_myself&quot; |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-  srcdir=$ac_confdir
-  if test ! -r &quot;$srcdir/$ac_unique_file&quot;; then
-    srcdir=..
-  fi
-else
-  ac_srcdir_defaulted=no
-fi
-if test ! -r &quot;$srcdir/$ac_unique_file&quot;; then
-  test &quot;$ac_srcdir_defaulted&quot; = yes &amp;&amp; srcdir=&quot;$ac_confdir or ..&quot;
-  { $as_echo &quot;$as_me: error: cannot find sources ($ac_unique_file) in $srcdir&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-fi
-ac_msg=&quot;sources are in $srcdir, but \`cd $srcdir' does not work&quot;
-ac_abs_confdir=`(
-	cd &quot;$srcdir&quot; &amp;&amp; test -r &quot;./$ac_unique_file&quot; || { $as_echo &quot;$as_me: error: $ac_msg&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-	pwd)`
-# When building in place, set srcdir=.
-if test &quot;$ac_abs_confdir&quot; = &quot;$ac_pwd&quot;; then
-  srcdir=.
-fi
-# Remove unnecessary trailing slashes from srcdir.
-# Double slashes in file names in object file debugging info
-# mess up M-x gdb in Emacs.
-case $srcdir in
-*/) srcdir=`expr &quot;X$srcdir&quot; : 'X\(.*[^/]\)' \| &quot;X$srcdir&quot; : 'X\(.*\)'`;;
-esac
-for ac_var in $ac_precious_vars; do
-  eval ac_env_${ac_var}_set=\${${ac_var}+set}
-  eval ac_env_${ac_var}_value=\$${ac_var}
-  eval ac_cv_env_${ac_var}_set=\${${ac_var}+set}
-  eval ac_cv_env_${ac_var}_value=\$${ac_var}
-done
-
-#
-# Report the --help message.
-#
-if test &quot;$ac_init_help&quot; = &quot;long&quot;; then
-  # Omit some internal or obsolete options to make the list less imposing.
-  # This message is too long to be a string in the A/UX 3.1 sh.
-  cat &lt;&lt;_ACEOF
-\`configure' configures map65 0.9 to adapt to many kinds of systems.
-
-Usage: $0 [OPTION]... [VAR=VALUE]...
-
-To assign environment variables (e.g., CC, CFLAGS...), specify them as
-VAR=VALUE.  See below for descriptions of some of the useful variables.
-
-Defaults for the options are specified in brackets.
-
-Configuration:
-  -h, --help              display this help and exit
-      --help=short        display options specific to this package
-      --help=recursive    display the short help of all the included packages
-  -V, --version           display version information and exit
-  -q, --quiet, --silent   do not print \`checking...' messages
-      --cache-file=FILE   cache test results in FILE [disabled]
-  -C, --config-cache      alias for \`--cache-file=config.cache'
-  -n, --no-create         do not create output files
-      --srcdir=DIR        find the sources in DIR [configure dir or \`..']
-
-Installation directories:
-  --prefix=PREFIX         install architecture-independent files in PREFIX
-                          [$ac_default_prefix]
-  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
-                          [PREFIX]
-
-By default, \`make install' will install all the files in
-\`$ac_default_prefix/bin', \`$ac_default_prefix/lib' etc.  You can specify
-an installation prefix other than \`$ac_default_prefix' using \`--prefix',
-for instance \`--prefix=\$HOME'.
-
-For better control, use the options below.
-
-Fine tuning of the installation directories:
-  --bindir=DIR            user executables [EPREFIX/bin]
-  --sbindir=DIR           system admin executables [EPREFIX/sbin]
-  --libexecdir=DIR        program executables [EPREFIX/libexec]
-  --sysconfdir=DIR        read-only single-machine data [PREFIX/etc]
-  --sharedstatedir=DIR    modifiable architecture-independent data [PREFIX/com]
-  --localstatedir=DIR     modifiable single-machine data [PREFIX/var]
-  --libdir=DIR            object code libraries [EPREFIX/lib]
-  --includedir=DIR        C header files [PREFIX/include]
-  --oldincludedir=DIR     C header files for non-gcc [/usr/include]
-  --datarootdir=DIR       read-only arch.-independent data root [PREFIX/share]
-  --datadir=DIR           read-only architecture-independent data [DATAROOTDIR]
-  --infodir=DIR           info documentation [DATAROOTDIR/info]
-  --localedir=DIR         locale-dependent data [DATAROOTDIR/locale]
-  --mandir=DIR            man documentation [DATAROOTDIR/man]
-  --docdir=DIR            documentation root [DATAROOTDIR/doc/map65]
-  --htmldir=DIR           html documentation [DOCDIR]
-  --dvidir=DIR            dvi documentation [DOCDIR]
-  --pdfdir=DIR            pdf documentation [DOCDIR]
-  --psdir=DIR             ps documentation [DOCDIR]
-_ACEOF
-
-  cat &lt;&lt;\_ACEOF
-_ACEOF
-fi
-
-if test -n &quot;$ac_init_help&quot;; then
-  case $ac_init_help in
-     short | recursive ) echo &quot;Configuration of map65 0.9:&quot;;;
-   esac
-  cat &lt;&lt;\_ACEOF
-
-Optional Features:
-  --disable-option-checking  ignore unrecognized --enable/--with options
-  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
-  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
-  --enable-g95            Use G95 compiler if available.
-  --enable-gfortran       Use gfortran compiler if available.
-  --enable-clobber        Don't preserve old binaries on make install
-  --enable-assert         Enable assert().
-
-Optional Packages:
-  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
-  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
-  --with-portaudio-include-dir=&lt;path&gt;
-                          path to portaudio include files
-  --with-portaudio-lib-dir=&lt;path&gt;
-                          path to portaudio lib files
-
-Some influential environment variables:
-  CC          C compiler command
-  CFLAGS      C compiler flags
-  LDFLAGS     linker flags, e.g. -L&lt;lib dir&gt; if you have libraries in a
-              nonstandard directory &lt;lib dir&gt;
-  LIBS        libraries to pass to the linker, e.g. -l&lt;library&gt;
-  CPPFLAGS    C/C++/Objective C preprocessor flags, e.g. -I&lt;include dir&gt; if
-              you have headers in a nonstandard directory &lt;include dir&gt;
-  F77         Fortran 77 compiler command
-  FFLAGS      Fortran 77 compiler flags
-  CPP         C preprocessor
-
-Use these variables to override the choices made by `configure' or to help
-it to find libraries and programs with nonstandard names/locations.
-
-_ACEOF
-ac_status=$?
-fi
-
-if test &quot;$ac_init_help&quot; = &quot;recursive&quot;; then
-  # If there are subdirs, report their specific --help.
-  for ac_dir in : $ac_subdirs_all; do test &quot;x$ac_dir&quot; = x: &amp;&amp; continue
-    test -d &quot;$ac_dir&quot; ||
-      { cd &quot;$srcdir&quot; &amp;&amp; ac_pwd=`pwd` &amp;&amp; srcdir=. &amp;&amp; test -d &quot;$ac_dir&quot;; } ||
-      continue
-    ac_builddir=.
-
-case &quot;$ac_dir&quot; in
-.) ac_dir_suffix= ac_top_builddir_sub=. ac_top_build_prefix= ;;
-*)
-  ac_dir_suffix=/`$as_echo &quot;$ac_dir&quot; | sed 's|^\.[\\/]||'`
-  # A &quot;..&quot; for each directory in $ac_dir_suffix.
-  ac_top_builddir_sub=`$as_echo &quot;$ac_dir_suffix&quot; | sed 's|/[^\\/]*|/..|g;s|/||'`
-  case $ac_top_builddir_sub in
-  &quot;&quot;) ac_top_builddir_sub=. ac_top_build_prefix= ;;
-  *)  ac_top_build_prefix=$ac_top_builddir_sub/ ;;
-  esac ;;
-esac
-ac_abs_top_builddir=$ac_pwd
-ac_abs_builddir=$ac_pwd$ac_dir_suffix
-# for backward compatibility:
-ac_top_builddir=$ac_top_build_prefix
-
-case $srcdir in
-  .)  # We are building in place.
-    ac_srcdir=.
-    ac_top_srcdir=$ac_top_builddir_sub
-    ac_abs_top_srcdir=$ac_pwd ;;
-  [\\/]* | ?:[\\/]* )  # Absolute name.
-    ac_srcdir=$srcdir$ac_dir_suffix;
-    ac_top_srcdir=$srcdir
-    ac_abs_top_srcdir=$srcdir ;;
-  *) # Relative name.
-    ac_srcdir=$ac_top_build_prefix$srcdir$ac_dir_suffix
-    ac_top_srcdir=$ac_top_build_prefix$srcdir
-    ac_abs_top_srcdir=$ac_pwd/$srcdir ;;
-esac
-ac_abs_srcdir=$ac_abs_top_srcdir$ac_dir_suffix
-
-    cd &quot;$ac_dir&quot; || { ac_status=$?; continue; }
-    # Check for guested configure.
-    if test -f &quot;$ac_srcdir/configure.gnu&quot;; then
-      echo &amp;&amp;
-      $SHELL &quot;$ac_srcdir/configure.gnu&quot; --help=recursive
-    elif test -f &quot;$ac_srcdir/configure&quot;; then
-      echo &amp;&amp;
-      $SHELL &quot;$ac_srcdir/configure&quot; --help=recursive
-    else
-      $as_echo &quot;$as_me: WARNING: no configuration information is in $ac_dir&quot; &gt;&amp;2
-    fi || ac_status=$?
-    cd &quot;$ac_pwd&quot; || { ac_status=$?; break; }
-  done
-fi
-
-test -n &quot;$ac_init_help&quot; &amp;&amp; exit $ac_status
-if $ac_init_version; then
-  cat &lt;&lt;\_ACEOF
-map65 configure 0.9
-generated by GNU Autoconf 2.62
-
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
-This configure script is free software; the Free Software Foundation
-gives unlimited permission to copy, distribute and modify it.
-
-$Id: configure.ac 1251 2009-05-19 22:49:52Z va3db $
-_ACEOF
-  exit
-fi
-cat &gt;config.log &lt;&lt;_ACEOF
-This file contains any messages produced by compilers while
-running configure, to aid debugging if configure makes a mistake.
-
-It was created by map65 $as_me 0.9, which was
-generated by GNU Autoconf 2.62.  Invocation command line was
-
-  $ $0 $@
-
-_ACEOF
-exec 5&gt;&gt;config.log
-{
-cat &lt;&lt;_ASUNAME
-## --------- ##
-## Platform. ##
-## --------- ##
-
-hostname = `(hostname || uname -n) 2&gt;/dev/null | sed 1q`
-uname -m = `(uname -m) 2&gt;/dev/null || echo unknown`
-uname -r = `(uname -r) 2&gt;/dev/null || echo unknown`
-uname -s = `(uname -s) 2&gt;/dev/null || echo unknown`
-uname -v = `(uname -v) 2&gt;/dev/null || echo unknown`
-
-/usr/bin/uname -p = `(/usr/bin/uname -p) 2&gt;/dev/null || echo unknown`
-/bin/uname -X     = `(/bin/uname -X) 2&gt;/dev/null     || echo unknown`
-
-/bin/arch              = `(/bin/arch) 2&gt;/dev/null              || echo unknown`
-/usr/bin/arch -k       = `(/usr/bin/arch -k) 2&gt;/dev/null       || echo unknown`
-/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2&gt;/dev/null || echo unknown`
-/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2&gt;/dev/null      || echo unknown`
-/bin/machine           = `(/bin/machine) 2&gt;/dev/null           || echo unknown`
-/usr/bin/oslevel       = `(/usr/bin/oslevel) 2&gt;/dev/null       || echo unknown`
-/bin/universe          = `(/bin/universe) 2&gt;/dev/null          || echo unknown`
-
-_ASUNAME
-
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  $as_echo &quot;PATH: $as_dir&quot;
-done
-IFS=$as_save_IFS
-
-} &gt;&amp;5
-
-cat &gt;&amp;5 &lt;&lt;_ACEOF
-
-
-## ----------- ##
-## Core tests. ##
-## ----------- ##
-
-_ACEOF
-
-
-# Keep a trace of the command line.
-# Strip out --no-create and --no-recursion so they do not pile up.
-# Strip out --silent because we don't want to record it for future runs.
-# Also quote any args containing shell meta-characters.
-# Make two passes to allow for proper duplicate-argument suppression.
-ac_configure_args=
-ac_configure_args0=
-ac_configure_args1=
-ac_must_keep_next=false
-for ac_pass in 1 2
-do
-  for ac_arg
-  do
-    case $ac_arg in
-    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
-    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-    | -silent | --silent | --silen | --sile | --sil)
-      continue ;;
-    *\'*)
-      ac_arg=`$as_echo &quot;$ac_arg&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;` ;;
-    esac
-    case $ac_pass in
-    1) ac_configure_args0=&quot;$ac_configure_args0 '$ac_arg'&quot; ;;
-    2)
-      ac_configure_args1=&quot;$ac_configure_args1 '$ac_arg'&quot;
-      if test $ac_must_keep_next = true; then
-	ac_must_keep_next=false # Got value, back to normal.
-      else
-	case $ac_arg in
-	  *=* | --config-cache | -C | -disable-* | --disable-* \
-	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
-	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
-	  | -with-* | --with-* | -without-* | --without-* | --x)
-	    case &quot;$ac_configure_args0 &quot; in
-	      &quot;$ac_configure_args1&quot;*&quot; '$ac_arg' &quot;* ) continue ;;
-	    esac
-	    ;;
-	  -* ) ac_must_keep_next=true ;;
-	esac
-      fi
-      ac_configure_args=&quot;$ac_configure_args '$ac_arg'&quot;
-      ;;
-    esac
-  done
-done
-$as_unset ac_configure_args0 || test &quot;${ac_configure_args0+set}&quot; != set || { ac_configure_args0=; export ac_configure_args0; }
-$as_unset ac_configure_args1 || test &quot;${ac_configure_args1+set}&quot; != set || { ac_configure_args1=; export ac_configure_args1; }
-
-# When interrupted or exit'd, cleanup temporary files, and complete
-# config.log.  We remove comments because anyway the quotes in there
-# would cause problems or look ugly.
-# WARNING: Use '\'' to represent an apostrophe within the trap.
-# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
-trap 'exit_status=$?
-  # Save into config.log some information that might help in debugging.
-  {
-    echo
-
-    cat &lt;&lt;\_ASBOX
-## ---------------- ##
-## Cache variables. ##
-## ---------------- ##
-_ASBOX
-    echo
-    # The following way of writing the cache mishandles newlines in values,
-(
-  for ac_var in `(set) 2&gt;&amp;1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo &quot;$as_me:$LINENO: WARNING: Cache variable $ac_var contains a newline.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: Cache variable $ac_var contains a newline.&quot; &gt;&amp;2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-  (set) 2&gt;&amp;1 |
-    case $as_nl`(ac_space='\'' '\''; set) 2&gt;&amp;1` in #(
-    *${as_nl}ac_space=\ *)
-      sed -n \
-	&quot;s/'\''/'\''\\\\'\'''\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\''\\2'\''/p&quot;
-      ;; #(
-    *)
-      sed -n &quot;/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p&quot;
-      ;;
-    esac |
-    sort
-)
-    echo
-
-    cat &lt;&lt;\_ASBOX
-## ----------------- ##
-## Output variables. ##
-## ----------------- ##
-_ASBOX
-    echo
-    for ac_var in $ac_subst_vars
-    do
-      eval ac_val=\$$ac_var
-      case $ac_val in
-      *\'\''*) ac_val=`$as_echo &quot;$ac_val&quot; | sed &quot;s/'\''/'\''\\\\\\\\'\'''\''/g&quot;`;;
-      esac
-      $as_echo &quot;$ac_var='\''$ac_val'\''&quot;
-    done | sort
-    echo
-
-    if test -n &quot;$ac_subst_files&quot;; then
-      cat &lt;&lt;\_ASBOX
-## ------------------- ##
-## File substitutions. ##
-## ------------------- ##
-_ASBOX
-      echo
-      for ac_var in $ac_subst_files
-      do
-	eval ac_val=\$$ac_var
-	case $ac_val in
-	*\'\''*) ac_val=`$as_echo &quot;$ac_val&quot; | sed &quot;s/'\''/'\''\\\\\\\\'\'''\''/g&quot;`;;
-	esac
-	$as_echo &quot;$ac_var='\''$ac_val'\''&quot;
-      done | sort
-      echo
-    fi
-
-    if test -s confdefs.h; then
-      cat &lt;&lt;\_ASBOX
-## ----------- ##
-## confdefs.h. ##
-## ----------- ##
-_ASBOX
-      echo
-      cat confdefs.h
-      echo
-    fi
-    test &quot;$ac_signal&quot; != 0 &amp;&amp;
-      $as_echo &quot;$as_me: caught signal $ac_signal&quot;
-    $as_echo &quot;$as_me: exit $exit_status&quot;
-  } &gt;&amp;5
-  rm -f core *.core core.conftest.* &amp;&amp;
-    rm -f -r conftest* confdefs* conf$$* $ac_clean_files &amp;&amp;
-    exit $exit_status
-' 0
-for ac_signal in 1 2 13 15; do
-  trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
-done
-ac_signal=0
-
-# confdefs.h avoids OS command line length limits that DEFS can exceed.
-rm -f -r conftest* confdefs.h
-
-# Predefined preprocessor variables.
-
-cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_NAME &quot;$PACKAGE_NAME&quot;
-_ACEOF
-
-
-cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_TARNAME &quot;$PACKAGE_TARNAME&quot;
-_ACEOF
-
-
-cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_VERSION &quot;$PACKAGE_VERSION&quot;
-_ACEOF
-
-
-cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_STRING &quot;$PACKAGE_STRING&quot;
-_ACEOF
-
-
-cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_BUGREPORT &quot;$PACKAGE_BUGREPORT&quot;
-_ACEOF
-
-
-# Let the site file select an alternate cache file if it wants to.
-# Prefer an explicitly selected file to automatically selected ones.
-ac_site_file1=NONE
-ac_site_file2=NONE
-if test -n &quot;$CONFIG_SITE&quot;; then
-  ac_site_file1=$CONFIG_SITE
-elif test &quot;x$prefix&quot; != xNONE; then
-  ac_site_file1=$prefix/share/config.site
-  ac_site_file2=$prefix/etc/config.site
-else
-  ac_site_file1=$ac_default_prefix/share/config.site
-  ac_site_file2=$ac_default_prefix/etc/config.site
-fi
-for ac_site_file in &quot;$ac_site_file1&quot; &quot;$ac_site_file2&quot;
-do
-  test &quot;x$ac_site_file&quot; = xNONE &amp;&amp; continue
-  if test -r &quot;$ac_site_file&quot;; then
-    { $as_echo &quot;$as_me:$LINENO: loading site script $ac_site_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: loading site script $ac_site_file&quot; &gt;&amp;6;}
-    sed 's/^/| /' &quot;$ac_site_file&quot; &gt;&amp;5
-    . &quot;$ac_site_file&quot;
-  fi
-done
-
-if test -r &quot;$cache_file&quot;; then
-  # Some versions of bash will fail to source /dev/null (special
-  # files actually), so we avoid doing that.
-  if test -f &quot;$cache_file&quot;; then
-    { $as_echo &quot;$as_me:$LINENO: loading cache $cache_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: loading cache $cache_file&quot; &gt;&amp;6;}
-    case $cache_file in
-      [\\/]* | ?:[\\/]* ) . &quot;$cache_file&quot;;;
-      *)                      . &quot;./$cache_file&quot;;;
-    esac
-  fi
-else
-  { $as_echo &quot;$as_me:$LINENO: creating cache $cache_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: creating cache $cache_file&quot; &gt;&amp;6;}
-  &gt;$cache_file
-fi
-
-# Check that the precious variables saved in the cache have kept the same
-# value.
-ac_cache_corrupted=false
-for ac_var in $ac_precious_vars; do
-  eval ac_old_set=\$ac_cv_env_${ac_var}_set
-  eval ac_new_set=\$ac_env_${ac_var}_set
-  eval ac_old_val=\$ac_cv_env_${ac_var}_value
-  eval ac_new_val=\$ac_env_${ac_var}_value
-  case $ac_old_set,$ac_new_set in
-    set,)
-      { $as_echo &quot;$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run&quot; &gt;&amp;2;}
-      ac_cache_corrupted=: ;;
-    ,set)
-      { $as_echo &quot;$as_me:$LINENO: error: \`$ac_var' was not set in the previous run&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: \`$ac_var' was not set in the previous run&quot; &gt;&amp;2;}
-      ac_cache_corrupted=: ;;
-    ,);;
-    *)
-      if test &quot;x$ac_old_val&quot; != &quot;x$ac_new_val&quot;; then
-	# differences in whitespace do not lead to failure.
-	ac_old_val_w=`echo x $ac_old_val`
-	ac_new_val_w=`echo x $ac_new_val`
-	if test &quot;$ac_old_val_w&quot; != &quot;$ac_new_val_w&quot;; then
-	  { $as_echo &quot;$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: \`$ac_var' has changed since the previous run:&quot; &gt;&amp;2;}
-	  ac_cache_corrupted=:
-	else
-	  { $as_echo &quot;$as_me:$LINENO: warning: ignoring whitespace changes in \`$ac_var' since the previous run:&quot; &gt;&amp;5
-$as_echo &quot;$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:&quot; &gt;&amp;2;}
-	  eval $ac_var=\$ac_old_val
-	fi
-	{ $as_echo &quot;$as_me:$LINENO:   former value:  \`$ac_old_val'&quot; &gt;&amp;5
-$as_echo &quot;$as_me:   former value:  \`$ac_old_val'&quot; &gt;&amp;2;}
-	{ $as_echo &quot;$as_me:$LINENO:   current value: \`$ac_new_val'&quot; &gt;&amp;5
-$as_echo &quot;$as_me:   current value: \`$ac_new_val'&quot; &gt;&amp;2;}
-      fi;;
-  esac
-  # Pass precious variables to config.status.
-  if test &quot;$ac_new_set&quot; = set; then
-    case $ac_new_val in
-    *\'*) ac_arg=$ac_var=`$as_echo &quot;$ac_new_val&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;` ;;
-    *) ac_arg=$ac_var=$ac_new_val ;;
-    esac
-    case &quot; $ac_configure_args &quot; in
-      *&quot; '$ac_arg' &quot;*) ;; # Avoid dups.  Use of quotes ensures accuracy.
-      *) ac_configure_args=&quot;$ac_configure_args '$ac_arg'&quot; ;;
-    esac
-  fi
-done
-if $ac_cache_corrupted; then
-  { $as_echo &quot;$as_me:$LINENO: error: changes in the environment can compromise the build&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: changes in the environment can compromise the build&quot; &gt;&amp;2;}
-  { { $as_echo &quot;$as_me:$LINENO: error: run \`make distclean' and/or \`rm $cache_file' and start over&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-fi
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-
-fail=0
-
-
-
-OLD_CFLAGS=&quot;$CFLAGS&quot;
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-if test -n &quot;$ac_tool_prefix&quot;; then
-  # Extract the first word of &quot;${ac_tool_prefix}gcc&quot;, so it can be a program name with args.
-set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -n &quot;$CC&quot;; then
-  ac_cv_prog_CC=&quot;$CC&quot; # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_prog_CC=&quot;${ac_tool_prefix}gcc&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n &quot;$CC&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-$as_echo &quot;$CC&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-fi
-if test -z &quot;$ac_cv_prog_CC&quot;; then
-  ac_ct_CC=$CC
-  # Extract the first word of &quot;gcc&quot;, so it can be a program name with args.
-set dummy gcc; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_ac_ct_CC+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -n &quot;$ac_ct_CC&quot;; then
-  ac_cv_prog_ac_ct_CC=&quot;$ac_ct_CC&quot; # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_prog_ac_ct_CC=&quot;gcc&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n &quot;$ac_ct_CC&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
-$as_echo &quot;$ac_ct_CC&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-  if test &quot;x$ac_ct_CC&quot; = x; then
-    CC=&quot;&quot;
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-else
-  CC=&quot;$ac_cv_prog_CC&quot;
-fi
-
-if test -z &quot;$CC&quot;; then
-          if test -n &quot;$ac_tool_prefix&quot;; then
-    # Extract the first word of &quot;${ac_tool_prefix}cc&quot;, so it can be a program name with args.
-set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -n &quot;$CC&quot;; then
-  ac_cv_prog_CC=&quot;$CC&quot; # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_prog_CC=&quot;${ac_tool_prefix}cc&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n &quot;$CC&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-$as_echo &quot;$CC&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-  fi
-fi
-if test -z &quot;$CC&quot;; then
-  # Extract the first word of &quot;cc&quot;, so it can be a program name with args.
-set dummy cc; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -n &quot;$CC&quot;; then
-  ac_cv_prog_CC=&quot;$CC&quot; # Let the user override the test.
-else
-  ac_prog_rejected=no
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    if test &quot;$as_dir/$ac_word$ac_exec_ext&quot; = &quot;/usr/ucb/cc&quot;; then
-       ac_prog_rejected=yes
-       continue
-     fi
-    ac_cv_prog_CC=&quot;cc&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-if test $ac_prog_rejected = yes; then
-  # We found a bogon in the path, so make sure we never use it.
-  set dummy $ac_cv_prog_CC
-  shift
-  if test $# != 0; then
-    # We chose a different compiler from the bogus one.
-    # However, it has the same basename, so the bogon will be chosen
-    # first if we set CC to just the basename; use the full file name.
-    shift
-    ac_cv_prog_CC=&quot;$as_dir/$ac_word${1+' '}$@&quot;
-  fi
-fi
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n &quot;$CC&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-$as_echo &quot;$CC&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-fi
-if test -z &quot;$CC&quot;; then
-  if test -n &quot;$ac_tool_prefix&quot;; then
-  for ac_prog in cl.exe
-  do
-    # Extract the first word of &quot;$ac_tool_prefix$ac_prog&quot;, so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -n &quot;$CC&quot;; then
-  ac_cv_prog_CC=&quot;$CC&quot; # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_prog_CC=&quot;$ac_tool_prefix$ac_prog&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n &quot;$CC&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-$as_echo &quot;$CC&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-    test -n &quot;$CC&quot; &amp;&amp; break
-  done
-fi
-if test -z &quot;$CC&quot;; then
-  ac_ct_CC=$CC
-  for ac_prog in cl.exe
-do
-  # Extract the first word of &quot;$ac_prog&quot;, so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_ac_ct_CC+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -n &quot;$ac_ct_CC&quot;; then
-  ac_cv_prog_ac_ct_CC=&quot;$ac_ct_CC&quot; # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_prog_ac_ct_CC=&quot;$ac_prog&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n &quot;$ac_ct_CC&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
-$as_echo &quot;$ac_ct_CC&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-  test -n &quot;$ac_ct_CC&quot; &amp;&amp; break
-done
-
-  if test &quot;x$ac_ct_CC&quot; = x; then
-    CC=&quot;&quot;
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-fi
-
-fi
-
-
-test -z &quot;$CC&quot; &amp;&amp; { { $as_echo &quot;$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details.&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-
-# Provide some information about the compiler.
-$as_echo &quot;$as_me:$LINENO: checking for C compiler version&quot; &gt;&amp;5
-set X $ac_compile
-ac_compiler=$2
-{ (ac_try=&quot;$ac_compiler --version &gt;&amp;5&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compiler --version &gt;&amp;5&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }
-{ (ac_try=&quot;$ac_compiler -v &gt;&amp;5&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compiler -v &gt;&amp;5&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }
-{ (ac_try=&quot;$ac_compiler -V &gt;&amp;5&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compiler -V &gt;&amp;5&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }
-
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-ac_clean_files_save=$ac_clean_files
-ac_clean_files=&quot;$ac_clean_files a.out a.out.dSYM a.exe b.out&quot;
-# Try to create an executable without -o first, disregard a.out.
-# It will help us diagnose broken compilers, and finding out an intuition
-# of exeext.
-{ $as_echo &quot;$as_me:$LINENO: checking for C compiler default output file name&quot; &gt;&amp;5
-$as_echo_n &quot;checking for C compiler default output file name... &quot; &gt;&amp;6; }
-ac_link_default=`$as_echo &quot;$ac_link&quot; | sed 's/ -o *conftest[^ ]*//'`
-
-# The possible output files:
-ac_files=&quot;a.out conftest.exe conftest a.exe a_out.exe b.out conftest.*&quot;
-
-ac_rmfiles=
-for ac_file in $ac_files
-do
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
-    * ) ac_rmfiles=&quot;$ac_rmfiles $ac_file&quot;;;
-  esac
-done
-rm -f $ac_rmfiles
-
-if { (ac_try=&quot;$ac_link_default&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_link_default&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; then
-  # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
-# So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
-# in a Makefile.  We should not override ac_cv_exeext if it was cached,
-# so that the user can short-circuit this test for compilers unknown to
-# Autoconf.
-for ac_file in $ac_files ''
-do
-  test -f &quot;$ac_file&quot; || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj )
-	;;
-    [ab].out )
-	# We found the default executable, but exeext='' is most
-	# certainly right.
-	break;;
-    *.* )
-        if test &quot;${ac_cv_exeext+set}&quot; = set &amp;&amp; test &quot;$ac_cv_exeext&quot; != no;
-	then :; else
-	   ac_cv_exeext=`expr &quot;$ac_file&quot; : '[^.]*\(\..*\)'`
-	fi
-	# We set ac_cv_exeext here because the later test for it is not
-	# safe: cross compilers may not add the suffix if given an `-o'
-	# argument, so we may need to know it at that point already.
-	# Even if this section looks crufty: it has the advantage of
-	# actually working.
-	break;;
-    * )
-	break;;
-  esac
-done
-test &quot;$ac_cv_exeext&quot; = no &amp;&amp; ac_cv_exeext=
-
-else
-  ac_file=''
-fi
-
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_file&quot; &gt;&amp;5
-$as_echo &quot;$ac_file&quot; &gt;&amp;6; }
-if test -z &quot;$ac_file&quot;; then
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-{ { $as_echo &quot;$as_me:$LINENO: error: C compiler cannot create executables
-See \`config.log' for more details.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: C compiler cannot create executables
-See \`config.log' for more details.&quot; &gt;&amp;2;}
-   { (exit 77); exit 77; }; }
-fi
-
-ac_exeext=$ac_cv_exeext
-
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo &quot;$as_me:$LINENO: checking whether the C compiler works&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether the C compiler works... &quot; &gt;&amp;6; }
-# FIXME: These cross compiler hacks should be removed for Autoconf 3.0
-# If not cross compiling, check that we can run a simple program.
-if test &quot;$cross_compiling&quot; != yes; then
-  if { ac_try='./$ac_file'
-  { (case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_try&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; }; then
-    cross_compiling=no
-  else
-    if test &quot;$cross_compiling&quot; = maybe; then
-	cross_compiling=yes
-    else
-	{ { $as_echo &quot;$as_me:$LINENO: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details.&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-    fi
-  fi
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
-$as_echo &quot;yes&quot; &gt;&amp;6; }
-
-rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
-ac_clean_files=$ac_clean_files_save
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo &quot;$as_me:$LINENO: checking whether we are cross compiling&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether we are cross compiling... &quot; &gt;&amp;6; }
-{ $as_echo &quot;$as_me:$LINENO: result: $cross_compiling&quot; &gt;&amp;5
-$as_echo &quot;$cross_compiling&quot; &gt;&amp;6; }
-
-{ $as_echo &quot;$as_me:$LINENO: checking for suffix of executables&quot; &gt;&amp;5
-$as_echo_n &quot;checking for suffix of executables... &quot; &gt;&amp;6; }
-if { (ac_try=&quot;$ac_link&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_link&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; then
-  # If both `conftest.exe' and `conftest' are `present' (well, observable)
-# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
-# work properly (i.e., refer to `conftest.exe'), while it won't with
-# `rm'.
-for ac_file in conftest.exe conftest conftest.*; do
-  test -f &quot;$ac_file&quot; || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
-    *.* ) ac_cv_exeext=`expr &quot;$ac_file&quot; : '[^.]*\(\..*\)'`
-	  break;;
-    * ) break;;
-  esac
-done
-else
-  { { $as_echo &quot;$as_me:$LINENO: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details.&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-fi
-
-rm -f conftest$ac_cv_exeext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_exeext&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_exeext&quot; &gt;&amp;6; }
-
-rm -f conftest.$ac_ext
-EXEEXT=$ac_cv_exeext
-ac_exeext=$EXEEXT
-{ $as_echo &quot;$as_me:$LINENO: checking for suffix of object files&quot; &gt;&amp;5
-$as_echo_n &quot;checking for suffix of object files... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_objext+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.o conftest.obj
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; then
-  for ac_file in conftest.o conftest.obj conftest.*; do
-  test -f &quot;$ac_file&quot; || continue;
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
-    *) ac_cv_objext=`expr &quot;$ac_file&quot; : '.*\.\(.*\)'`
-       break;;
-  esac
-done
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-{ { $as_echo &quot;$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details.&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-fi
-
-rm -f conftest.$ac_cv_objext conftest.$ac_ext
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_objext&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_objext&quot; &gt;&amp;6; }
-OBJEXT=$ac_cv_objext
-ac_objext=$OBJEXT
-{ $as_echo &quot;$as_me:$LINENO: checking whether we are using the GNU C compiler&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether we are using the GNU C compiler... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_c_compiler_gnu+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_compiler_gnu=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_compiler_gnu=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_c_compiler_gnu=$ac_compiler_gnu
-
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_c_compiler_gnu&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_c_compiler_gnu&quot; &gt;&amp;6; }
-if test $ac_compiler_gnu = yes; then
-  GCC=yes
-else
-  GCC=
-fi
-ac_test_CFLAGS=${CFLAGS+set}
-ac_save_CFLAGS=$CFLAGS
-{ $as_echo &quot;$as_me:$LINENO: checking whether $CC accepts -g&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether $CC accepts -g... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_cc_g+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_save_c_werror_flag=$ac_c_werror_flag
-   ac_c_werror_flag=yes
-   ac_cv_prog_cc_g=no
-   CFLAGS=&quot;-g&quot;
-   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	CFLAGS=&quot;&quot;
-      cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_c_werror_flag=$ac_save_c_werror_flag
-	 CFLAGS=&quot;-g&quot;
-	 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_c_werror_flag=$ac_save_c_werror_flag
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_prog_cc_g&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_prog_cc_g&quot; &gt;&amp;6; }
-if test &quot;$ac_test_CFLAGS&quot; = set; then
-  CFLAGS=$ac_save_CFLAGS
-elif test $ac_cv_prog_cc_g = yes; then
-  if test &quot;$GCC&quot; = yes; then
-    CFLAGS=&quot;-g -O2&quot;
-  else
-    CFLAGS=&quot;-g&quot;
-  fi
-else
-  if test &quot;$GCC&quot; = yes; then
-    CFLAGS=&quot;-O2&quot;
-  else
-    CFLAGS=
-  fi
-fi
-{ $as_echo &quot;$as_me:$LINENO: checking for $CC option to accept ISO C89&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $CC option to accept ISO C89... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_cc_c89+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_cv_prog_cc_c89=no
-ac_save_CC=$CC
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;stdarg.h&gt;
-#include &lt;stdio.h&gt;
-#include &lt;sys/types.h&gt;
-#include &lt;sys/stat.h&gt;
-/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
-struct buf { int x; };
-FILE * (*rcsopen) (struct buf *, struct stat *, int);
-static char *e (p, i)
-     char **p;
-     int i;
-{
-  return p[i];
-}
-static char *f (char * (*g) (char **, int), char **p, ...)
-{
-  char *s;
-  va_list v;
-  va_start (v,p);
-  s = g (p, va_arg (v,int));
-  va_end (v);
-  return s;
-}
-
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
-
-/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
-   inside strings and character constants.  */
-#define FOO(x) 'x'
-int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
-
-int test (int i, double x);
-struct s1 {int (*f) (int a);};
-struct s2 {int (*f) (double a);};
-int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
-int argc;
-char **argv;
-int
-main ()
-{
-return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
-  ;
-  return 0;
-}
-_ACEOF
-for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
-	-Ae &quot;-Aa -D_HPUX_SOURCE&quot; &quot;-Xc -D__EXTENSIONS__&quot;
-do
-  CC=&quot;$ac_save_CC $ac_arg&quot;
-  rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext
-  test &quot;x$ac_cv_prog_cc_c89&quot; != &quot;xno&quot; &amp;&amp; break
-done
-rm -f conftest.$ac_ext
-CC=$ac_save_CC
-
-fi
-# AC_CACHE_VAL
-case &quot;x$ac_cv_prog_cc_c89&quot; in
-  x)
-    { $as_echo &quot;$as_me:$LINENO: result: none needed&quot; &gt;&amp;5
-$as_echo &quot;none needed&quot; &gt;&amp;6; } ;;
-  xno)
-    { $as_echo &quot;$as_me:$LINENO: result: unsupported&quot; &gt;&amp;5
-$as_echo &quot;unsupported&quot; &gt;&amp;6; } ;;
-  *)
-    CC=&quot;$CC $ac_cv_prog_cc_c89&quot;
-    { $as_echo &quot;$as_me:$LINENO: result: $ac_cv_prog_cc_c89&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_prog_cc_c89&quot; &gt;&amp;6; } ;;
-esac
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-ac_ext=f
-ac_compile='$F77 -c $FFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$F77 -o conftest$ac_exeext $FFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_f77_compiler_gnu
-if test -n &quot;$ac_tool_prefix&quot;; then
-  for ac_prog in g77 xlf f77 frt pgf77 cf77 fort77 fl32 af77 xlf90 f90 pgf90 pghpf epcf90 gfortran g95 xlf95 f95 fort ifort ifc efc pgf95 lf95 ftn
-  do
-    # Extract the first word of &quot;$ac_tool_prefix$ac_prog&quot;, so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_F77+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -n &quot;$F77&quot;; then
-  ac_cv_prog_F77=&quot;$F77&quot; # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_prog_F77=&quot;$ac_tool_prefix$ac_prog&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-F77=$ac_cv_prog_F77
-if test -n &quot;$F77&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $F77&quot; &gt;&amp;5
-$as_echo &quot;$F77&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-    test -n &quot;$F77&quot; &amp;&amp; break
-  done
-fi
-if test -z &quot;$F77&quot;; then
-  ac_ct_F77=$F77
-  for ac_prog in g77 xlf f77 frt pgf77 cf77 fort77 fl32 af77 xlf90 f90 pgf90 pghpf epcf90 gfortran g95 xlf95 f95 fort ifort ifc efc pgf95 lf95 ftn
-do
-  # Extract the first word of &quot;$ac_prog&quot;, so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_ac_ct_F77+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -n &quot;$ac_ct_F77&quot;; then
-  ac_cv_prog_ac_ct_F77=&quot;$ac_ct_F77&quot; # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_prog_ac_ct_F77=&quot;$ac_prog&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_F77=$ac_cv_prog_ac_ct_F77
-if test -n &quot;$ac_ct_F77&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $ac_ct_F77&quot; &gt;&amp;5
-$as_echo &quot;$ac_ct_F77&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-  test -n &quot;$ac_ct_F77&quot; &amp;&amp; break
-done
-
-  if test &quot;x$ac_ct_F77&quot; = x; then
-    F77=&quot;&quot;
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
-ac_tool_warned=yes ;;
-esac
-    F77=$ac_ct_F77
-  fi
-fi
-
-
-# Provide some information about the compiler.
-$as_echo &quot;$as_me:$LINENO: checking for Fortran 77 compiler version&quot; &gt;&amp;5
-set X $ac_compile
-ac_compiler=$2
-{ (ac_try=&quot;$ac_compiler --version &gt;&amp;5&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compiler --version &gt;&amp;5&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }
-{ (ac_try=&quot;$ac_compiler -v &gt;&amp;5&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compiler -v &gt;&amp;5&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }
-{ (ac_try=&quot;$ac_compiler -V &gt;&amp;5&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compiler -V &gt;&amp;5&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }
-rm -f a.out
-
-# If we don't use `.F' as extension, the preprocessor is not run on the
-# input file.  (Note that this only needs to work for GNU compilers.)
-ac_save_ext=$ac_ext
-ac_ext=F
-{ $as_echo &quot;$as_me:$LINENO: checking whether we are using the GNU Fortran 77 compiler&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether we are using the GNU Fortran 77 compiler... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_f77_compiler_gnu+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-      program main
-#ifndef __GNUC__
-       choke me
-#endif
-
-      end
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_f77_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_compiler_gnu=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_compiler_gnu=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_f77_compiler_gnu=$ac_compiler_gnu
-
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_f77_compiler_gnu&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_f77_compiler_gnu&quot; &gt;&amp;6; }
-ac_ext=$ac_save_ext
-ac_test_FFLAGS=${FFLAGS+set}
-ac_save_FFLAGS=$FFLAGS
-FFLAGS=
-{ $as_echo &quot;$as_me:$LINENO: checking whether $F77 accepts -g&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether $F77 accepts -g... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_f77_g+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  FFLAGS=-g
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-      program main
-
-      end
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_f77_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_cv_prog_f77_g=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_cv_prog_f77_g=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_prog_f77_g&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_prog_f77_g&quot; &gt;&amp;6; }
-if test &quot;$ac_test_FFLAGS&quot; = set; then
-  FFLAGS=$ac_save_FFLAGS
-elif test $ac_cv_prog_f77_g = yes; then
-  if test &quot;x$ac_cv_f77_compiler_gnu&quot; = xyes; then
-    FFLAGS=&quot;-g -O2&quot;
-  else
-    FFLAGS=&quot;-g&quot;
-  fi
-else
-  if test &quot;x$ac_cv_f77_compiler_gnu&quot; = xyes; then
-    FFLAGS=&quot;-O2&quot;
-  else
-    FFLAGS=
-  fi
-fi
-
-if test $ac_compiler_gnu = yes; then
-  G77=yes
-else
-  G77=
-fi
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-CFLAGS=&quot;$OLD_CFLAGS&quot;
-
-CPPFLAGS=&quot;-I/usr/local/include ${CPPFLAGS}&quot;
-LDFLAGS=&quot;-L/usr/local/lib ${LDFLAGS}&quot;
-LIBS=&quot; -lpthread ${LIBS}&quot;
-FFLAGS_GFORTRAN=&quot;${FFLAGS} -fno-range-check -ffixed-line-length-none\
-			-Wall -fbounds-check -fno-second-underscore -fPIC&quot;
-FFLAGS_G95=&quot;${FFLAGS} -Wall -Wno-precision-loss -fbounds-check -fno-second-underscore -fPIC&quot;
-#-Wall -Wno-precision-loss -fbounds-check -fno-second-underscore -fPIC
-
-
-
-# Check whether --enable-g95 was given.
-if test &quot;${enable_g95+set}&quot; = set; then
-  enableval=$enable_g95; g95=$enableval
-else
-  g95=no
-fi
-
-
-# Check whether --enable-gfortran was given.
-if test &quot;${enable_gfortran+set}&quot; = set; then
-  enableval=$enable_gfortran; gfortran=$enableval
-else
-  gfortran=no
-fi
-
-
-
-FCV=&quot;&quot;
-
-if test -n ${FC} ; then
-	gfortran_name_part=`echo ${FC} | cut -c 1-8`
-	if test ${gfortran_name_part} = &quot;gfortran&quot; ; then
-		gfortran_name=${FC}
-       		FC_LIB_PATH=`${FC} -print-file-name=`
-		g95=no
-		gfortran=yes
-		FFLAGS=&quot;${FFLAGS_GFORTRAN}&quot;
-		FCV=&quot;gnu95&quot;
-	else
-		unset ${FC}
-	fi
-fi
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking uname -s&quot; &gt;&amp;5
-$as_echo_n &quot;checking uname -s... &quot; &gt;&amp;6; }
-case `uname -s` in
-	CYGWIN*)
-		{ $as_echo &quot;$as_me:$LINENO: result: Cygwin&quot; &gt;&amp;5
-$as_echo &quot;Cygwin&quot; &gt;&amp;6; }
-		CYGWIN=yes
-	;;
-	SunOS*)
-		{ $as_echo &quot;$as_me:$LINENO: result: SunOS or Solaris&quot; &gt;&amp;5
-$as_echo &quot;SunOS or Solaris&quot; &gt;&amp;6; }
-
-cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define __EXTENSIONS__ 1
-_ACEOF
-
-	;;
-        FreeBSD*)
-		if test -z ${gfortran_name} ; then
-			gfortran_name=`grep FC: /usr/ports/Mk/bsd.gcc.mk | head -1 |awk '{print $2}'`
-		fi
-		FCV_G95=&quot;g95&quot;
-	;;
-	*)
-		FCV_G95=&quot;g95&quot;
-		{ $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-	;;
-esac
-
-
-if test -z $gfortran_name ; then
-	gfortran_name=&quot;gfortran&quot;
-fi
-
-# Extract the first word of &quot;g95&quot;, so it can be a program name with args.
-set dummy g95; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_G95+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $G95 in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_G95=&quot;$G95&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_G95=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-G95=$ac_cv_path_G95
-if test -n &quot;$G95&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $G95&quot; &gt;&amp;5
-$as_echo &quot;$G95&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;${gfortran_name}&quot;, so it can be a program name with args.
-set dummy ${gfortran_name}; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_GFORTRAN+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $GFORTRAN in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_GFORTRAN=&quot;$GFORTRAN&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_GFORTRAN=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-GFORTRAN=$ac_cv_path_GFORTRAN
-if test -n &quot;$GFORTRAN&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $GFORTRAN&quot; &gt;&amp;5
-$as_echo &quot;$GFORTRAN&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-
-if test ! -z ${GFORTRAN} ; then
-	echo &quot;*** gfortran compiler found at ${GFORTRAN}&quot;
-	if test &quot;${gfortran}&quot; = yes; then
-       		FC_LIB_PATH=`${GFORTRAN} -print-file-name=`
-		FC=`basename ${GFORTRAN}`
-		g95=no
-		FFLAGS=&quot;${FFLAGS_GFORTRAN}&quot;
-		FCV=&quot;gnu95&quot;
-	fi
-else
-	echo &quot;*** No gfortran compiler found&quot;
-fi
-
-if test ! -z ${G95} ; then
-	echo &quot;*** g95 compiler found at ${G95}&quot;
-	if test &quot;${g95}&quot; = yes; then
-       		FC_LIB_PATH=`${G95} -print-file-name=`
-		FC=`basename ${G95}`
-		gfortran=no
-		FFLAGS=&quot;${FFLAGS_G95}&quot;
-		FCV=${FCV_G95}
-	fi
-else
-	echo &quot;*** No g95 compiler found&quot;
-fi
-
-if test -z ${FC} ; then
-	if test ! -z ${GFORTRAN} ; then
-		if test &quot;${g95}&quot; = yes; then
-			echo &quot;You enabled g95, but no g95 compiler found, defaulting to gfortran instead&quot;
-		fi
-       		FC_LIB_PATH=`${GFORTRAN} -print-file-name=`
-	        FC=`basename ${GFORTRAN}`
-		g95=no
-		gfortran=yes
-		FFLAGS=&quot;${FFLAGS_GFORTRAN}&quot;
-		FCV=&quot;gnu95&quot;
-	elif test ! -z $G95 ; then
-		if test &quot;${gfortran}&quot; = yes; then
-			echo &quot;You enabled gfortran, but no gfortran compiler found, defaulting to g95 instead&quot;
-		fi
-       		FC_LIB_PATH=`${G95} -print-file-name=`
-	        FC=`basename ${G95}`
-		g95=yes
-		gfortran=no
-		FFLAGS=&quot;${FFLAGS_G95}&quot;
-		FCV=${FCV_G95}
-	fi
-fi
-
-
-cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define FC_LIB_PATH &quot;${FC_LIB_PATH}&quot;
-_ACEOF
-
-FC_LIB_PATH=&quot;${FC_LIB_PATH}&quot;
-
-
-cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define FC &quot;${FC}&quot;
-_ACEOF
-
-FC=&quot;${FC}&quot;
-
-FCV=&quot;${FCV}&quot;
-
-
-
-
-
-
-
-HAS_PORTAUDIO_H=0
-HAS_PORTAUDIO_LIB=0
-HAS_PORTAUDIO=0
-
-{ $as_echo &quot;$as_me:$LINENO: checking for a v19 portaudio &quot; &gt;&amp;5
-$as_echo_n &quot;checking for a v19 portaudio ... &quot; &gt;&amp;6; }
-
-portaudio_lib_dir=&quot;/usr/lib&quot;
-portaudio_include_dir=&quot;/usr/include&quot;
-
-
-# Check whether --with-portaudio-include-dir was given.
-if test &quot;${with_portaudio_include_dir+set}&quot; = set; then
-  withval=$with_portaudio_include_dir; portaudio_include_dir=$with_portaudio_include_dir
-fi
-
-
-
-# Check whether --with-portaudio-lib-dir was given.
-if test &quot;${with_portaudio_lib_dir+set}&quot; = set; then
-  withval=$with_portaudio_lib_dir; portaudio_lib_dir=$with_portaudio_lib_dir
-fi
-
-
-if test -e ${portaudio_include_dir}/portaudio.h; then
-	HAS_PORTAUDIO_H=1
-fi
-
-if test -e ${portaudio_lib_dir}/libportaudio.so \
-    -o -e ${portaudio_lib_dir}/libportaudio.a;then
-	HAS_PORTAUDIO_LIB=1
-fi
-
-if test ${HAS_PORTAUDIO_H} -eq 1 -a ${HAS_PORTAUDIO_LIB} -eq 1; then
-	LDFLAGS=&quot;-L${portaudio_lib_dir} ${LDFLAGS}&quot;
-	LIBS=&quot;${LIBS} -lportaudio&quot;
-	CPPFLAGS=&quot;-I${portaudio_include_dir} ${CPPFLAGS}&quot;
-	{ $as_echo &quot;$as_me:$LINENO: checking for Pa_GetVersion in -lportaudio&quot; &gt;&amp;5
-$as_echo_n &quot;checking for Pa_GetVersion in -lportaudio... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_lib_portaudio_Pa_GetVersion+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS=&quot;-lportaudio  $LIBS&quot;
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern &quot;C&quot;
-#endif
-char Pa_GetVersion ();
-int
-main ()
-{
-return Pa_GetVersion ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try=&quot;$ac_link&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_link&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest$ac_exeext &amp;&amp; {
-	 test &quot;$cross_compiling&quot; = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_portaudio_Pa_GetVersion=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_cv_lib_portaudio_Pa_GetVersion=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_lib_portaudio_Pa_GetVersion&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_lib_portaudio_Pa_GetVersion&quot; &gt;&amp;6; }
-if test $ac_cv_lib_portaudio_Pa_GetVersion = yes; then
-  \
-		HAS_PORTAUDIO_VERSION=1
-else
-  HAS_PORTAUDIO_VERSION=0
-fi
-
-	if test ${HAS_PORTAUDIO_VERSION} -eq 0; then
-		{ $as_echo &quot;$as_me:$LINENO: result: This is likely portaudio v18; you need portaudio v19&quot; &gt;&amp;5
-$as_echo &quot;This is likely portaudio v18; you need portaudio v19&quot; &gt;&amp;6; }
-	else
-		HAS_PORTAUDIO=1
-	fi
-else
-	{ $as_echo &quot;$as_me:$LINENO: result: portaudio not found trying FreeBSD paths &quot; &gt;&amp;5
-$as_echo &quot;portaudio not found trying FreeBSD paths &quot; &gt;&amp;6; }
-	portaudio_lib_dir=&quot;/usr/local/lib/portaudio2&quot;
-	portaudio_include_dir=&quot;/usr/local/include/portaudio2&quot;
-	{ $as_echo &quot;$as_me:$LINENO: checking for a v19 portaudio in FreeBSD paths.&quot; &gt;&amp;5
-$as_echo_n &quot;checking for a v19 portaudio in FreeBSD paths.... &quot; &gt;&amp;6; }
-	HAS_PORTAUDIO_H=0
-	HAS_PORTAUDIO_LIB=0
-
-	if test -e ${portaudio_include_dir}/portaudio.h; then
-		HAS_PORTAUDIO_H=1
-	fi
-
-	if test -e ${portaudio_lib_dir}/libportaudio.so \
-	    -o -e ${portaudio_lib_dir}/libportaudio.a;then
-		HAS_PORTAUDIO_LIB=1
-	fi
-
-	if test ${HAS_PORTAUDIO_H} -eq 1 -a ${HAS_PORTAUDIO_LIB} -eq 1; then
-		{ $as_echo &quot;$as_me:$LINENO: result: found portaudio in FreeBSD paths, double checking it is v19 &quot; &gt;&amp;5
-$as_echo &quot;found portaudio in FreeBSD paths, double checking it is v19 &quot; &gt;&amp;6; }
-		LDFLAGS=&quot;-L${portaudio_lib_dir} ${LDFLAGS}&quot;
-		LIBS=&quot;${LIBS} -lportaudio&quot;
-		CPPFLAGS=&quot;-I${portaudio_include_dir} ${CPPFLAGS}&quot;
-		{ $as_echo &quot;$as_me:$LINENO: checking for Pa_GetVersion in -lportaudio&quot; &gt;&amp;5
-$as_echo_n &quot;checking for Pa_GetVersion in -lportaudio... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_lib_portaudio_Pa_GetVersion+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS=&quot;-lportaudio  $LIBS&quot;
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern &quot;C&quot;
-#endif
-char Pa_GetVersion ();
-int
-main ()
-{
-return Pa_GetVersion ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try=&quot;$ac_link&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_link&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest$ac_exeext &amp;&amp; {
-	 test &quot;$cross_compiling&quot; = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_portaudio_Pa_GetVersion=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_cv_lib_portaudio_Pa_GetVersion=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_lib_portaudio_Pa_GetVersion&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_lib_portaudio_Pa_GetVersion&quot; &gt;&amp;6; }
-if test $ac_cv_lib_portaudio_Pa_GetVersion = yes; then
-  \
-			HAS_PORTAUDIO_VERSION=1
-else
-  HAS_PORTAUDIO_VERSION=0
-fi
-
-		if test ${HAS_PORTAUDIO_VERSION} -eq 0; then
-			{ $as_echo &quot;$as_me:$LINENO: result: How did you end up with a portaudio v18 here?&quot; &gt;&amp;5
-$as_echo &quot;How did you end up with a portaudio v18 here?&quot; &gt;&amp;6; }
-		else
-			{ $as_echo &quot;$as_me:$LINENO: result: found v19&quot; &gt;&amp;5
-$as_echo &quot;found v19&quot; &gt;&amp;6; }
-			HAS_PORTAUDIO=1
-			HAS_PORTAUDIO_H=1
-		fi
-	fi
-fi
-
-
-
-if test &quot;$ac_cv_prog_cc_g&quot; = yes; then
-		CFLAGS=&quot;$CFLAGS -g&quot;
-fi
-
-if test ! -z &quot;$CFLAGS&quot;; then
-	CFLAGS=&quot;$CFLAGS $CFLAGS&quot;
-fi
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking for library containing strerror&quot; &gt;&amp;5
-$as_echo_n &quot;checking for library containing strerror... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_search_strerror+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_func_search_save_LIBS=$LIBS
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern &quot;C&quot;
-#endif
-char strerror ();
-int
-main ()
-{
-return strerror ();
-  ;
-  return 0;
-}
-_ACEOF
-for ac_lib in '' cposix; do
-  if test -z &quot;$ac_lib&quot;; then
-    ac_res=&quot;none required&quot;
-  else
-    ac_res=-l$ac_lib
-    LIBS=&quot;-l$ac_lib  $ac_func_search_save_LIBS&quot;
-  fi
-  rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try=&quot;$ac_link&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_link&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest$ac_exeext &amp;&amp; {
-	 test &quot;$cross_compiling&quot; = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_search_strerror=$ac_res
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext
-  if test &quot;${ac_cv_search_strerror+set}&quot; = set; then
-  break
-fi
-done
-if test &quot;${ac_cv_search_strerror+set}&quot; = set; then
-  :
-else
-  ac_cv_search_strerror=no
-fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_search_strerror&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_search_strerror&quot; &gt;&amp;6; }
-ac_res=$ac_cv_search_strerror
-if test &quot;$ac_res&quot; != no; then
-  test &quot;$ac_res&quot; = &quot;none required&quot; || LIBS=&quot;$ac_res $LIBS&quot;
-
-fi
-
-{ $as_echo &quot;$as_me:$LINENO: checking for inline&quot; &gt;&amp;5
-$as_echo_n &quot;checking for inline... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_c_inline+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_cv_c_inline=no
-for ac_kw in inline __inline__ __inline; do
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#ifndef __cplusplus
-typedef int foo_t;
-static $ac_kw foo_t static_foo () {return 0; }
-$ac_kw foo_t foo () {return 0; }
-#endif
-
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_cv_c_inline=$ac_kw
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  test &quot;$ac_cv_c_inline&quot; != no &amp;&amp; break
-done
-
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_c_inline&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_c_inline&quot; &gt;&amp;6; }
-
-
-case $ac_cv_c_inline in
-  inline | yes) ;;
-  *)
-    case $ac_cv_c_inline in
-      no) ac_val=;;
-      *) ac_val=$ac_cv_c_inline;;
-    esac
-    cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#ifndef __cplusplus
-#define inline $ac_val
-#endif
-_ACEOF
-    ;;
-esac
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ $as_echo &quot;$as_me:$LINENO: checking how to run the C preprocessor&quot; &gt;&amp;5
-$as_echo_n &quot;checking how to run the C preprocessor... &quot; &gt;&amp;6; }
-# On Suns, sometimes $CPP names a directory.
-if test -n &quot;$CPP&quot; &amp;&amp; test -d &quot;$CPP&quot;; then
-  CPP=
-fi
-if test -z &quot;$CPP&quot;; then
-  if test &quot;${ac_cv_prog_CPP+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-      # Double quotes because CPP needs to be expanded
-    for CPP in &quot;$CC -E&quot; &quot;$CC -E -traditional-cpp&quot; &quot;/lib/cpp&quot;
-    do
-      ac_preproc_ok=false
-for ac_c_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer &lt;limits.h&gt; to &lt;assert.h&gt; if __STDC__ is defined, since
-  # &lt;limits.h&gt; exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. &quot;Syntax error&quot; is here to catch this case.
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include &lt;limits.h&gt;
-#else
-# include &lt;assert.h&gt;
-#endif
-		     Syntax error
-_ACEOF
-if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
-	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-  # Broken: fails on valid input.
-continue
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;ac_nonexistent.h&gt;
-_ACEOF
-if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
-	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       }; then
-  # Broken: success on invalid input.
-continue
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  break
-fi
-
-    done
-    ac_cv_prog_CPP=$CPP
-
-fi
-  CPP=$ac_cv_prog_CPP
-else
-  ac_cv_prog_CPP=$CPP
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $CPP&quot; &gt;&amp;5
-$as_echo &quot;$CPP&quot; &gt;&amp;6; }
-ac_preproc_ok=false
-for ac_c_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer &lt;limits.h&gt; to &lt;assert.h&gt; if __STDC__ is defined, since
-  # &lt;limits.h&gt; exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. &quot;Syntax error&quot; is here to catch this case.
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include &lt;limits.h&gt;
-#else
-# include &lt;assert.h&gt;
-#endif
-		     Syntax error
-_ACEOF
-if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
-	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-  # Broken: fails on valid input.
-continue
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;ac_nonexistent.h&gt;
-_ACEOF
-if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
-	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       }; then
-  # Broken: success on invalid input.
-continue
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
-else
-  { { $as_echo &quot;$as_me:$LINENO: error: C preprocessor \&quot;$CPP\&quot; fails sanity check
-See \`config.log' for more details.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: C preprocessor \&quot;$CPP\&quot; fails sanity check
-See \`config.log' for more details.&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-fi
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking for grep that handles long lines and -e&quot; &gt;&amp;5
-$as_echo_n &quot;checking for grep that handles long lines and -e... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_GREP+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if test -z &quot;$GREP&quot;; then
-  ac_path_GREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_prog in grep ggrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_GREP=&quot;$as_dir/$ac_prog$ac_exec_ext&quot;
-      { test -f &quot;$ac_path_GREP&quot; &amp;&amp; $as_test_x &quot;$ac_path_GREP&quot;; } || continue
-# Check for GNU ac_path_GREP and select it if it is found.
-  # Check for GNU $ac_path_GREP
-case `&quot;$ac_path_GREP&quot; --version 2&gt;&amp;1` in
-*GNU*)
-  ac_cv_path_GREP=&quot;$ac_path_GREP&quot; ac_path_GREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 &gt;&quot;conftest.in&quot;
-  while :
-  do
-    cat &quot;conftest.in&quot; &quot;conftest.in&quot; &gt;&quot;conftest.tmp&quot;
-    mv &quot;conftest.tmp&quot; &quot;conftest.in&quot;
-    cp &quot;conftest.in&quot; &quot;conftest.nl&quot;
-    $as_echo 'GREP' &gt;&gt; &quot;conftest.nl&quot;
-    &quot;$ac_path_GREP&quot; -e 'GREP$' -e '-(cannot match)-' &lt; &quot;conftest.nl&quot; &gt;&quot;conftest.out&quot; 2&gt;/dev/null || break
-    diff &quot;conftest.out&quot; &quot;conftest.nl&quot; &gt;/dev/null 2&gt;&amp;1 || break
-    ac_count=`expr $ac_count + 1`
-    if test $ac_count -gt ${ac_path_GREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_GREP=&quot;$ac_path_GREP&quot;
-      ac_path_GREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 &amp;&amp; break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_GREP_found &amp;&amp; break 3
-    done
-  done
-done
-IFS=$as_save_IFS
-  if test -z &quot;$ac_cv_path_GREP&quot;; then
-    { { $as_echo &quot;$as_me:$LINENO: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-  fi
-else
-  ac_cv_path_GREP=$GREP
-fi
-
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_path_GREP&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_path_GREP&quot; &gt;&amp;6; }
- GREP=&quot;$ac_cv_path_GREP&quot;
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking for egrep&quot; &gt;&amp;5
-$as_echo_n &quot;checking for egrep... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_EGREP+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  if echo a | $GREP -E '(a|b)' &gt;/dev/null 2&gt;&amp;1
-   then ac_cv_path_EGREP=&quot;$GREP -E&quot;
-   else
-     if test -z &quot;$EGREP&quot;; then
-  ac_path_EGREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_prog in egrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_EGREP=&quot;$as_dir/$ac_prog$ac_exec_ext&quot;
-      { test -f &quot;$ac_path_EGREP&quot; &amp;&amp; $as_test_x &quot;$ac_path_EGREP&quot;; } || continue
-# Check for GNU ac_path_EGREP and select it if it is found.
-  # Check for GNU $ac_path_EGREP
-case `&quot;$ac_path_EGREP&quot; --version 2&gt;&amp;1` in
-*GNU*)
-  ac_cv_path_EGREP=&quot;$ac_path_EGREP&quot; ac_path_EGREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 &gt;&quot;conftest.in&quot;
-  while :
-  do
-    cat &quot;conftest.in&quot; &quot;conftest.in&quot; &gt;&quot;conftest.tmp&quot;
-    mv &quot;conftest.tmp&quot; &quot;conftest.in&quot;
-    cp &quot;conftest.in&quot; &quot;conftest.nl&quot;
-    $as_echo 'EGREP' &gt;&gt; &quot;conftest.nl&quot;
-    &quot;$ac_path_EGREP&quot; 'EGREP$' &lt; &quot;conftest.nl&quot; &gt;&quot;conftest.out&quot; 2&gt;/dev/null || break
-    diff &quot;conftest.out&quot; &quot;conftest.nl&quot; &gt;/dev/null 2&gt;&amp;1 || break
-    ac_count=`expr $ac_count + 1`
-    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_EGREP=&quot;$ac_path_EGREP&quot;
-      ac_path_EGREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 &amp;&amp; break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_EGREP_found &amp;&amp; break 3
-    done
-  done
-done
-IFS=$as_save_IFS
-  if test -z &quot;$ac_cv_path_EGREP&quot;; then
-    { { $as_echo &quot;$as_me:$LINENO: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-  fi
-else
-  ac_cv_path_EGREP=$EGREP
-fi
-
-   fi
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_path_EGREP&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_path_EGREP&quot; &gt;&amp;6; }
- EGREP=&quot;$ac_cv_path_EGREP&quot;
-
-
-if test $ac_cv_c_compiler_gnu = yes; then
-    { $as_echo &quot;$as_me:$LINENO: checking whether $CC needs -traditional&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether $CC needs -traditional... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_prog_gcc_traditional+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-    ac_pattern=&quot;Autoconf.*'x'&quot;
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;sgtty.h&gt;
-Autoconf TIOCGETP
-_ACEOF
-if (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;&amp;5 |
-  $EGREP &quot;$ac_pattern&quot; &gt;/dev/null 2&gt;&amp;1; then
-  ac_cv_prog_gcc_traditional=yes
-else
-  ac_cv_prog_gcc_traditional=no
-fi
-rm -f conftest*
-
-
-  if test $ac_cv_prog_gcc_traditional = no; then
-    cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;termio.h&gt;
-Autoconf TCGETA
-_ACEOF
-if (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;&amp;5 |
-  $EGREP &quot;$ac_pattern&quot; &gt;/dev/null 2&gt;&amp;1; then
-  ac_cv_prog_gcc_traditional=yes
-fi
-rm -f conftest*
-
-  fi
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_prog_gcc_traditional&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_prog_gcc_traditional&quot; &gt;&amp;6; }
-  if test $ac_cv_prog_gcc_traditional = yes; then
-    CC=&quot;$CC -traditional&quot;
-  fi
-fi
-
-{ $as_echo &quot;$as_me:$LINENO: checking whether ${MAKE-make} sets \$(MAKE)&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether ${MAKE-make} sets \$(MAKE)... &quot; &gt;&amp;6; }
-set x ${MAKE-make}
-ac_make=`$as_echo &quot;$2&quot; | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
-if { as_var=ac_cv_prog_make_${ac_make}_set; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  cat &gt;conftest.make &lt;&lt;\_ACEOF
-SHELL = /bin/sh
-all:
-	@echo '@@@%%%=$(MAKE)=@@@%%%'
-_ACEOF
-# GNU make sometimes prints &quot;make[1]: Entering...&quot;, which would confuse us.
-case `${MAKE-make} -f conftest.make 2&gt;/dev/null` in
-  *@@@%%%=?*=@@@%%%*)
-    eval ac_cv_prog_make_${ac_make}_set=yes;;
-  *)
-    eval ac_cv_prog_make_${ac_make}_set=no;;
-esac
-rm -f conftest.make
-fi
-if eval test \$ac_cv_prog_make_${ac_make}_set = yes; then
-  { $as_echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
-$as_echo &quot;yes&quot; &gt;&amp;6; }
-  SET_MAKE=
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-  SET_MAKE=&quot;MAKE=${MAKE-make}&quot;
-fi
-
-ac_aux_dir=
-for ac_dir in &quot;$srcdir&quot; &quot;$srcdir/..&quot; &quot;$srcdir/../..&quot;; do
-  if test -f &quot;$ac_dir/install-sh&quot;; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh=&quot;$ac_aux_dir/install-sh -c&quot;
-    break
-  elif test -f &quot;$ac_dir/install.sh&quot;; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh=&quot;$ac_aux_dir/install.sh -c&quot;
-    break
-  elif test -f &quot;$ac_dir/shtool&quot;; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh=&quot;$ac_aux_dir/shtool install -c&quot;
-    break
-  fi
-done
-if test -z &quot;$ac_aux_dir&quot;; then
-  { { $as_echo &quot;$as_me:$LINENO: error: cannot find install-sh or install.sh in \&quot;$srcdir\&quot; \&quot;$srcdir/..\&quot; \&quot;$srcdir/../..\&quot;&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: cannot find install-sh or install.sh in \&quot;$srcdir\&quot; \&quot;$srcdir/..\&quot; \&quot;$srcdir/../..\&quot;&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-fi
-
-# These three variables are undocumented and unsupported,
-# and are intended to be withdrawn in a future Autoconf release.
-# They can cause serious problems if a builder's source tree is in a directory
-# whose full name contains unusual characters.
-ac_config_guess=&quot;$SHELL $ac_aux_dir/config.guess&quot;  # Please don't use this var.
-ac_config_sub=&quot;$SHELL $ac_aux_dir/config.sub&quot;  # Please don't use this var.
-ac_configure=&quot;$SHELL $ac_aux_dir/configure&quot;  # Please don't use this var.
-
-
-# Find a good install program.  We prefer a C program (faster),
-# so one script is as good as another.  But avoid the broken or
-# incompatible versions:
-# SysV /etc/install, /usr/sbin/install
-# SunOS /usr/etc/install
-# IRIX /sbin/install
-# AIX /bin/install
-# AmigaOS /C/install, which installs bootblocks on floppy discs
-# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
-# AFS /usr/afsws/bin/install, which mishandles nonexistent args
-# SVR4 /usr/ucb/install, which tries to use the nonexistent group &quot;staff&quot;
-# OS/2's system install, which has a completely different semantic
-# ./install, which can be erroneously created by make from ./install.sh.
-# Reject install programs that cannot install multiple files.
-{ $as_echo &quot;$as_me:$LINENO: checking for a BSD-compatible install&quot; &gt;&amp;5
-$as_echo_n &quot;checking for a BSD-compatible install... &quot; &gt;&amp;6; }
-if test -z &quot;$INSTALL&quot;; then
-if test &quot;${ac_cv_path_install+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  # Account for people who put trailing slashes in PATH elements.
-case $as_dir/ in
-  ./ | .// | /cC/* | \
-  /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
-  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
-  /usr/ucb/* ) ;;
-  *)
-    # OSF1 and SCO ODT 3.0 have their own names for install.
-    # Don't use installbsd from OSF since it installs stuff as root
-    # by default.
-    for ac_prog in ginstall scoinst install; do
-      for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f &quot;$as_dir/$ac_prog$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_prog$ac_exec_ext&quot;; }; then
-	  if test $ac_prog = install &amp;&amp;
-	    grep dspmsg &quot;$as_dir/$ac_prog$ac_exec_ext&quot; &gt;/dev/null 2&gt;&amp;1; then
-	    # AIX install.  It has an incompatible calling convention.
-	    :
-	  elif test $ac_prog = install &amp;&amp;
-	    grep pwplus &quot;$as_dir/$ac_prog$ac_exec_ext&quot; &gt;/dev/null 2&gt;&amp;1; then
-	    # program-specific install script used by HP pwplus--don't use.
-	    :
-	  else
-	    rm -rf conftest.one conftest.two conftest.dir
-	    echo one &gt; conftest.one
-	    echo two &gt; conftest.two
-	    mkdir conftest.dir
-	    if &quot;$as_dir/$ac_prog$ac_exec_ext&quot; -c conftest.one conftest.two &quot;`pwd`/conftest.dir&quot; &amp;&amp;
-	      test -s conftest.one &amp;&amp; test -s conftest.two &amp;&amp;
-	      test -s conftest.dir/conftest.one &amp;&amp;
-	      test -s conftest.dir/conftest.two
-	    then
-	      ac_cv_path_install=&quot;$as_dir/$ac_prog$ac_exec_ext -c&quot;
-	      break 3
-	    fi
-	  fi
-	fi
-      done
-    done
-    ;;
-esac
-
-done
-IFS=$as_save_IFS
-
-rm -rf conftest.one conftest.two conftest.dir
-
-fi
-  if test &quot;${ac_cv_path_install+set}&quot; = set; then
-    INSTALL=$ac_cv_path_install
-  else
-    # As a last resort, use the slow shell script.  Don't cache a
-    # value for INSTALL within a source directory, because that will
-    # break other packages using the cache if that directory is
-    # removed, or if the value is a relative name.
-    INSTALL=$ac_install_sh
-  fi
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $INSTALL&quot; &gt;&amp;5
-$as_echo &quot;$INSTALL&quot; &gt;&amp;6; }
-
-# Use test -z because SunOS4 sh mishandles braces in ${var-val}.
-# It thinks the first close brace ends the variable substitution.
-test -z &quot;$INSTALL_PROGRAM&quot; &amp;&amp; INSTALL_PROGRAM='${INSTALL}'
-
-test -z &quot;$INSTALL_SCRIPT&quot; &amp;&amp; INSTALL_SCRIPT='${INSTALL}'
-
-test -z &quot;$INSTALL_DATA&quot; &amp;&amp; INSTALL_DATA='${INSTALL} -m 644'
-
-# Extract the first word of &quot;rm&quot;, so it can be a program name with args.
-set dummy rm; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_RM+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $RM in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_RM=&quot;$RM&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_RM=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-RM=$ac_cv_path_RM
-if test -n &quot;$RM&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $RM&quot; &gt;&amp;5
-$as_echo &quot;$RM&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;cp&quot;, so it can be a program name with args.
-set dummy cp; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_CP+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $CP in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_CP=&quot;$CP&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_CP=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-CP=$ac_cv_path_CP
-if test -n &quot;$CP&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $CP&quot; &gt;&amp;5
-$as_echo &quot;$CP&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;mv&quot;, so it can be a program name with args.
-set dummy mv; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_MV+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $MV in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_MV=&quot;$MV&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_MV=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-MV=$ac_cv_path_MV
-if test -n &quot;$MV&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $MV&quot; &gt;&amp;5
-$as_echo &quot;$MV&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;ln&quot;, so it can be a program name with args.
-set dummy ln; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_LN+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $LN in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_LN=&quot;$LN&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_LN=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-LN=$ac_cv_path_LN
-if test -n &quot;$LN&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $LN&quot; &gt;&amp;5
-$as_echo &quot;$LN&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;sed&quot;, so it can be a program name with args.
-set dummy sed; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_SED+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $SED in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_SED=&quot;$SED&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_SED=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-SED=$ac_cv_path_SED
-if test -n &quot;$SED&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $SED&quot; &gt;&amp;5
-$as_echo &quot;$SED&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;ar&quot;, so it can be a program name with args.
-set dummy ar; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_AR+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $AR in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_AR=&quot;$AR&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_AR=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-AR=$ac_cv_path_AR
-if test -n &quot;$AR&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $AR&quot; &gt;&amp;5
-$as_echo &quot;$AR&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;ld&quot;, so it can be a program name with args.
-set dummy ld; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_LD+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $LD in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_LD=&quot;$LD&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_LD=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-LD=$ac_cv_path_LD
-if test -n &quot;$LD&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $LD&quot; &gt;&amp;5
-$as_echo &quot;$LD&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;test&quot;, so it can be a program name with args.
-set dummy test; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_TEST+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $TEST in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_TEST=&quot;$TEST&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_TEST=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  test -z &quot;$ac_cv_path_TEST&quot; &amp;&amp; ac_cv_path_TEST=&quot;test&quot;
-  ;;
-esac
-fi
-TEST=$ac_cv_path_TEST
-if test -n &quot;$TEST&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $TEST&quot; &gt;&amp;5
-$as_echo &quot;$TEST&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;python&quot;, so it can be a program name with args.
-set dummy python; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_PYTHON+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $PYTHON in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_PYTHON=&quot;$PYTHON&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_PYTHON=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-PYTHON=$ac_cv_path_PYTHON
-if test -n &quot;$PYTHON&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $PYTHON&quot; &gt;&amp;5
-$as_echo &quot;$PYTHON&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-# Extract the first word of &quot;f2py&quot;, so it can be a program name with args.
-set dummy f2py; ac_word=$2
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_word... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_path_F2PY+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  case $F2PY in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_F2PY=&quot;$F2PY&quot; # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_test_x &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
-    ac_cv_path_F2PY=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
-    $as_echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-F2PY=$ac_cv_path_F2PY
-if test -n &quot;$F2PY&quot;; then
-  { $as_echo &quot;$as_me:$LINENO: result: $F2PY&quot; &gt;&amp;5
-$as_echo &quot;$F2PY&quot; &gt;&amp;6; }
-else
-  { $as_echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-$as_echo &quot;no&quot; &gt;&amp;6; }
-fi
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking OS&quot; &gt;&amp;5
-$as_echo_n &quot;checking OS... &quot; &gt;&amp;6; }
-OS=`uname`
-OS=&quot;${OS}&quot;
-
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking for ANSI C header files&quot; &gt;&amp;5
-$as_echo_n &quot;checking for ANSI C header files... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_header_stdc+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;stdlib.h&gt;
-#include &lt;stdarg.h&gt;
-#include &lt;string.h&gt;
-#include &lt;float.h&gt;
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_cv_header_stdc=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_cv_header_stdc=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-if test $ac_cv_header_stdc = yes; then
-  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;string.h&gt;
-
-_ACEOF
-if (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;&amp;5 |
-  $EGREP &quot;memchr&quot; &gt;/dev/null 2&gt;&amp;1; then
-  :
-else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
-
-fi
-
-if test $ac_cv_header_stdc = yes; then
-  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;stdlib.h&gt;
-
-_ACEOF
-if (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;&amp;5 |
-  $EGREP &quot;free&quot; &gt;/dev/null 2&gt;&amp;1; then
-  :
-else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
-
-fi
-
-if test $ac_cv_header_stdc = yes; then
-  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test &quot;$cross_compiling&quot; = yes; then
-  :
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;ctype.h&gt;
-#include &lt;stdlib.h&gt;
-#if ((' ' &amp; 0x0FF) == 0x020)
-# define ISLOWER(c) ('a' &lt;= (c) &amp;&amp; (c) &lt;= 'z')
-# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
-#else
-# define ISLOWER(c) \
-		   (('a' &lt;= (c) &amp;&amp; (c) &lt;= 'i') \
-		     || ('j' &lt;= (c) &amp;&amp; (c) &lt;= 'r') \
-		     || ('s' &lt;= (c) &amp;&amp; (c) &lt;= 'z'))
-# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
-#endif
-
-#define XOR(e, f) (((e) &amp;&amp; !(f)) || (!(e) &amp;&amp; (f)))
-int
-main ()
-{
-  int i;
-  for (i = 0; i &lt; 256; i++)
-    if (XOR (islower (i), ISLOWER (i))
-	|| toupper (i) != TOUPPER (i))
-      return 2;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try=&quot;$ac_link&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_link&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; { ac_try='./conftest$ac_exeext'
-  { (case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_try&quot;) 2&gt;&amp;5
-  ac_status=$?
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; }; then
-  :
-else
-  $as_echo &quot;$as_me: program exited with status $ac_status&quot; &gt;&amp;5
-$as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-( exit $ac_status )
-ac_cv_header_stdc=no
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-
-
-fi
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_stdc&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_header_stdc&quot; &gt;&amp;6; }
-if test $ac_cv_header_stdc = yes; then
-
-cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
-
-fi
-
-
-# On IRIX 5.3, sys/types and inttypes.h are conflicting.
-
-
-
-
-
-
-
-
-
-for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
-		  inttypes.h stdint.h unistd.h
-do
-as_ac_Header=`$as_echo &quot;ac_cv_header_$ac_header&quot; | $as_tr_sh`
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_header... &quot; &gt;&amp;6; }
-if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-
-#include &lt;$ac_header&gt;
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  eval &quot;$as_ac_Header=yes&quot;
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	eval &quot;$as_ac_Header=no&quot;
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo &quot;$as_val&quot;'`
-	       { $as_echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
-$as_echo &quot;$ac_res&quot; &gt;&amp;6; }
-if test `eval 'as_val=${'$as_ac_Header'}
-		 $as_echo &quot;$as_val&quot;'` = yes; then
-  cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define `$as_echo &quot;HAVE_$ac_header&quot; | $as_tr_cpp` 1
-_ACEOF
-
-fi
-
-done
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-for ac_header in inttypes.h stdint.h sys/resource.h sys/param.h errno.h \
-sys/syslog.h stddef.h libgen.h sys/wait.h wait.h stdio.h termios.h \
-sys/resource.h linux/ppdev.h dev/ppbus/ppi.h sys/stat.h fcntl.h sys/ioctl.h
-do
-as_ac_Header=`$as_echo &quot;ac_cv_header_$ac_header&quot; | $as_tr_sh`
-if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
-  { $as_echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_header... &quot; &gt;&amp;6; }
-if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo &quot;$as_val&quot;'`
-	       { $as_echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
-$as_echo &quot;$ac_res&quot; &gt;&amp;6; }
-else
-  # Is the header compilable?
-{ $as_echo &quot;$as_me:$LINENO: checking $ac_header usability&quot; &gt;&amp;5
-$as_echo_n &quot;checking $ac_header usability... &quot; &gt;&amp;6; }
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include &lt;$ac_header&gt;
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-$as_echo &quot;$ac_header_compiler&quot; &gt;&amp;6; }
-
-# Is the header present?
-{ $as_echo &quot;$as_me:$LINENO: checking $ac_header presence&quot; &gt;&amp;5
-$as_echo_n &quot;checking $ac_header presence... &quot; &gt;&amp;6; }
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;$ac_header&gt;
-_ACEOF
-if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
-	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-$as_echo &quot;$ac_header_preproc&quot; &gt;&amp;6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_header: proceeding with the compiler's result&quot; &gt;&amp;2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_header: present but cannot be compiled&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_header:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_header: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_header:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_header:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_header: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_header: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-
-    ;;
-esac
-{ $as_echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
-$as_echo_n &quot;checking for $ac_header... &quot; &gt;&amp;6; }
-if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo &quot;$as_val&quot;'`
-	       { $as_echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
-$as_echo &quot;$ac_res&quot; &gt;&amp;6; }
-
-fi
-if test `eval 'as_val=${'$as_ac_Header'}
-		 $as_echo &quot;$as_val&quot;'` = yes; then
-  cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define `$as_echo &quot;HAVE_$ac_header&quot; | $as_tr_cpp` 1
-_ACEOF
-
-fi
-
-done
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking whether time.h and sys/time.h may both be included&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether time.h and sys/time.h may both be included... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_header_time+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;sys/types.h&gt;
-#include &lt;sys/time.h&gt;
-#include &lt;time.h&gt;
-
-int
-main ()
-{
-if ((struct tm *) 0)
-return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_cv_header_time=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_cv_header_time=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_time&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_header_time&quot; &gt;&amp;6; }
-if test $ac_cv_header_time = yes; then
-
-cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define TIME_WITH_SYS_TIME 1
-_ACEOF
-
-fi
-
-
-if test &quot;${ac_cv_header_fftw3_h+set}&quot; = set; then
-  { $as_echo &quot;$as_me:$LINENO: checking for fftw3.h&quot; &gt;&amp;5
-$as_echo_n &quot;checking for fftw3.h... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_header_fftw3_h+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_fftw3_h&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_header_fftw3_h&quot; &gt;&amp;6; }
-else
-  # Is the header compilable?
-{ $as_echo &quot;$as_me:$LINENO: checking fftw3.h usability&quot; &gt;&amp;5
-$as_echo_n &quot;checking fftw3.h usability... &quot; &gt;&amp;6; }
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include &lt;fftw3.h&gt;
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-$as_echo &quot;$ac_header_compiler&quot; &gt;&amp;6; }
-
-# Is the header present?
-{ $as_echo &quot;$as_me:$LINENO: checking fftw3.h presence&quot; &gt;&amp;5
-$as_echo_n &quot;checking fftw3.h presence... &quot; &gt;&amp;6; }
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;fftw3.h&gt;
-_ACEOF
-if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
-	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-$as_echo &quot;$ac_header_preproc&quot; &gt;&amp;6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: fftw3.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: proceeding with the compiler's result&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: fftw3.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: present but cannot be compiled&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: fftw3.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: fftw3.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: see the Autoconf documentation&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: fftw3.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: fftw3.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: fftw3.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: fftw3.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-
-    ;;
-esac
-{ $as_echo &quot;$as_me:$LINENO: checking for fftw3.h&quot; &gt;&amp;5
-$as_echo_n &quot;checking for fftw3.h... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_header_fftw3_h+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_cv_header_fftw3_h=$ac_header_preproc
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_fftw3_h&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_header_fftw3_h&quot; &gt;&amp;6; }
-
-fi
-if test $ac_cv_header_fftw3_h = yes; then
-  HAS_FFTW3_H=1
-else
-  HAS_FFTW3_H=0
-fi
-
-
-if test &quot;${ac_cv_header_samplerate_h+set}&quot; = set; then
-  { $as_echo &quot;$as_me:$LINENO: checking for samplerate.h&quot; &gt;&amp;5
-$as_echo_n &quot;checking for samplerate.h... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_header_samplerate_h+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_samplerate_h&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_header_samplerate_h&quot; &gt;&amp;6; }
-else
-  # Is the header compilable?
-{ $as_echo &quot;$as_me:$LINENO: checking samplerate.h usability&quot; &gt;&amp;5
-$as_echo_n &quot;checking samplerate.h usability... &quot; &gt;&amp;6; }
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include &lt;samplerate.h&gt;
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-$as_echo &quot;$ac_header_compiler&quot; &gt;&amp;6; }
-
-# Is the header present?
-{ $as_echo &quot;$as_me:$LINENO: checking samplerate.h presence&quot; &gt;&amp;5
-$as_echo_n &quot;checking samplerate.h presence... &quot; &gt;&amp;6; }
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;samplerate.h&gt;
-_ACEOF
-if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
-	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-$as_echo &quot;$ac_header_preproc&quot; &gt;&amp;6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo &quot;$as_me:$LINENO: WARNING: samplerate.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: samplerate.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: samplerate.h: proceeding with the compiler's result&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: samplerate.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo &quot;$as_me:$LINENO: WARNING: samplerate.h: present but cannot be compiled&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: samplerate.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: samplerate.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: samplerate.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: samplerate.h: see the Autoconf documentation&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: samplerate.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: samplerate.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: samplerate.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: samplerate.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: samplerate.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: samplerate.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: samplerate.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-
-    ;;
-esac
-{ $as_echo &quot;$as_me:$LINENO: checking for samplerate.h&quot; &gt;&amp;5
-$as_echo_n &quot;checking for samplerate.h... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_header_samplerate_h+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_cv_header_samplerate_h=$ac_header_preproc
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_samplerate_h&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_header_samplerate_h&quot; &gt;&amp;6; }
-
-fi
-if test $ac_cv_header_samplerate_h = yes; then
-  HAS_SAMPLERATE_H=1
-else
-  HAS_SAMPLERATE_H=0
-fi
-
-
-
-{ $as_echo &quot;$as_me:$LINENO: checking whether string.h and strings.h may both be included&quot; &gt;&amp;5
-$as_echo_n &quot;checking whether string.h and strings.h may both be included... &quot; &gt;&amp;6; }
-if test &quot;${gcc_cv_header_string+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-
-	cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-#include &lt;string.h&gt;
-	#include &lt;strings.h&gt;
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  gcc_cv_header_string=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	gcc_cv_header_string=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $gcc_cv_header_string&quot; &gt;&amp;5
-$as_echo &quot;$gcc_cv_header_string&quot; &gt;&amp;6; }
-
-if test &quot;$gcc_cv_header_string&quot; = &quot;yes&quot;; then
-
-cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define STRING_WITH_STRINGS 1
-_ACEOF
-
-fi
-
-{ $as_echo &quot;$as_me:$LINENO: checking for sfftw_destroy_plan_ in -lfftw3f&quot; &gt;&amp;5
-$as_echo_n &quot;checking for sfftw_destroy_plan_ in -lfftw3f... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_lib_fftw3f_sfftw_destroy_plan_+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS=&quot;-lfftw3f  $LIBS&quot;
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern &quot;C&quot;
-#endif
-char sfftw_destroy_plan_ ();
-int
-main ()
-{
-return sfftw_destroy_plan_ ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try=&quot;$ac_link&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_link&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest$ac_exeext &amp;&amp; {
-	 test &quot;$cross_compiling&quot; = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_fftw3f_sfftw_destroy_plan_=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_cv_lib_fftw3f_sfftw_destroy_plan_=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_lib_fftw3f_sfftw_destroy_plan_&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_lib_fftw3f_sfftw_destroy_plan_&quot; &gt;&amp;6; }
-if test $ac_cv_lib_fftw3f_sfftw_destroy_plan_ = yes; then
-  \
-	HAS_FFTW3FLIBS=1
-else
-  HAS_FFTW3FLIBS=0
-fi
-
-
-if test &quot;${ac_cv_header_stdarg_h+set}&quot; = set; then
-  { $as_echo &quot;$as_me:$LINENO: checking for stdarg.h&quot; &gt;&amp;5
-$as_echo_n &quot;checking for stdarg.h... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_header_stdarg_h+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_stdarg_h&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_header_stdarg_h&quot; &gt;&amp;6; }
-else
-  # Is the header compilable?
-{ $as_echo &quot;$as_me:$LINENO: checking stdarg.h usability&quot; &gt;&amp;5
-$as_echo_n &quot;checking stdarg.h usability... &quot; &gt;&amp;6; }
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include &lt;stdarg.h&gt;
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try=&quot;$ac_compile&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp; {
-	 test -z &quot;$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       } &amp;&amp; test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-$as_echo &quot;$ac_header_compiler&quot; &gt;&amp;6; }
-
-# Is the header present?
-{ $as_echo &quot;$as_me:$LINENO: checking stdarg.h presence&quot; &gt;&amp;5
-$as_echo_n &quot;checking stdarg.h presence... &quot; &gt;&amp;6; }
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;stdarg.h&gt;
-_ACEOF
-if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
-case &quot;(($ac_try&quot; in
-  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
-$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
-  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
-	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-$as_echo &quot;$ac_header_preproc&quot; &gt;&amp;6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo &quot;$as_me:$LINENO: WARNING: stdarg.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: stdarg.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: stdarg.h: proceeding with the compiler's result&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: stdarg.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo &quot;$as_me:$LINENO: WARNING: stdarg.h: present but cannot be compiled&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: stdarg.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: stdarg.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: stdarg.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: stdarg.h: see the Autoconf documentation&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: stdarg.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: stdarg.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: stdarg.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: stdarg.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: stdarg.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { $as_echo &quot;$as_me:$LINENO: WARNING: stdarg.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: stdarg.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-
-    ;;
-esac
-{ $as_echo &quot;$as_me:$LINENO: checking for stdarg.h&quot; &gt;&amp;5
-$as_echo_n &quot;checking for stdarg.h... &quot; &gt;&amp;6; }
-if test &quot;${ac_cv_header_stdarg_h+set}&quot; = set; then
-  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
-else
-  ac_cv_header_stdarg_h=$ac_header_preproc
-fi
-{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_stdarg_h&quot; &gt;&amp;5
-$as_echo &quot;$ac_cv_header_stdarg_h&quot; &gt;&amp;6; }
-
-fi
-if test $ac_cv_header_stdarg_h = yes; then
-  :
-else
-  { { $as_echo &quot;$as_me:$LINENO: error: ** stdarg.h could not be found - wsjt will not compile without it **&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: ** stdarg.h could not be found - wsjt will not compile without it **&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-fi
-
-
-
-
-# Check whether --enable-clobber was given.
-if test &quot;${enable_clobber+set}&quot; = set; then
-  enableval=$enable_clobber; clobber=$enableval
-else
-  clobber=no
-fi
-
-
-if test &quot;$clobber&quot; = yes; then
-	CLOBBER=yes
-
-fi
-
-# Check whether --enable-assert was given.
-if test &quot;${enable_assert+set}&quot; = set; then
-  enableval=$enable_assert; assert=$enableval
-else
-  assert=no
-fi
-
-
-if test &quot;$assert&quot; = no; then
-
-cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define NDEBUG 1
-_ACEOF
-
-fi
-
-if test &quot;$prefix&quot; = &quot;NONE&quot;; then
-	prefix=${ac_default_prefix}
-else
-
-
-	prefix=`echo ${ac_default_prefix} | sed 's/\/$//'`
-fi
-
-
-if test -z $FC ; then
-	fail=1
-	echo &quot;You need g95 or gfortran to compile this program!&quot;
-fi
-
-if test $HAS_FFTW3_H -eq 0; then
-	fail=1
-	echo &quot;You need to install the fftw3 libraries&quot;
-fi
-
-if test $HAS_SAMPLERATE_H -eq 0; then
-	fail=1
-	echo &quot;You need to install the samplerate library&quot;
-else
-        cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define HAS_SAMPLERATE_H 1
-_ACEOF
-
-	LIBS=&quot;${LIBS} -lsamplerate&quot;
-fi
-
-if test $HAS_PORTAUDIO -eq 1; then
-	cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define HAS_PORTAUDIO 1
-_ACEOF
-
-	cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define HAS_PORTAUDIO_H 1
-_ACEOF
-
-	cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define HAS_PORTAUDIO_LIB 1
-_ACEOF
-
-else
-	fail=1
-	echo &quot;This program needs portaudio v19 to compile.&quot;
-	echo &quot;Please use --with-portaudio-include-dir= and&quot;
-	echo &quot; --with-portaudio-lib-dir= to set the paths.&quot;
-fi
-
-if test $HAS_FFTW3_H -eq 1; then
-	cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define HAS_FFTW3_H 1
-_ACEOF
-
-else
-	fail=1
-	echo &quot;You are missing the fftw3.h include file&quot;
-fi
-
-if test $HAS_FFTW3FLIBS -eq 1; then
-	LIBS=&quot;${LIBS} -lfftw3f&quot;
-	cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define HAS_FFTW3FLIBS 1
-_ACEOF
-
-else
-	fail=1
-	echo &quot;You are missing the fortran shim in libfftw3.&quot;
-fi
-
-if test &quot;$F2PY&quot; = &quot;&quot;; then
-	echo &quot;You are missing f2py, trying local copy.&quot;
-	F2PY=&quot;python f2py.py&quot;;
-fi
-
-
-if test $fail -eq 1; then
-	{ { $as_echo &quot;$as_me:$LINENO: error: Please check error messages and install missing packages.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: Please check error messages and install missing packages.&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-fi
-
-PREFIX=&quot;${prefix}&quot;
-
-CPPFLAGS=&quot;${CPPFLAGS}&quot;
-
-LDFLAGS=&quot;${LDFLAGS}&quot;
-
-LIBS=&quot;${LIBS}&quot;
-
-
-
-F2PY=&quot;${F2PY}&quot;
-
-ac_config_files=&quot;$ac_config_files Makefile&quot;
-
-cat &gt;confcache &lt;&lt;\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2&gt;&amp;1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo &quot;$as_me:$LINENO: WARNING: Cache variable $ac_var contains a newline.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: Cache variable $ac_var contains a newline.&quot; &gt;&amp;2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2&gt;&amp;1 |
-    case $as_nl`(ac_space=' '; set) 2&gt;&amp;1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	&quot;s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p&quot;
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n &quot;/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p&quot;
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test &quot;${\1+set}&quot; = set || &amp;/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' &gt;&gt;confcache
-if diff &quot;$cache_file&quot; confcache &gt;/dev/null 2&gt;&amp;1; then :; else
-  if test -w &quot;$cache_file&quot;; then
-    test &quot;x$cache_file&quot; != &quot;x/dev/null&quot; &amp;&amp;
-      { $as_echo &quot;$as_me:$LINENO: updating cache $cache_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: updating cache $cache_file&quot; &gt;&amp;6;}
-    cat confcache &gt;$cache_file
-  else
-    { $as_echo &quot;$as_me:$LINENO: not updating unwritable cache $cache_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: not updating unwritable cache $cache_file&quot; &gt;&amp;6;}
-  fi
-fi
-rm -f confcache
-
-test &quot;x$prefix&quot; = xNONE &amp;&amp; prefix=$ac_default_prefix
-# Let make expand exec_prefix.
-test &quot;x$exec_prefix&quot; = xNONE &amp;&amp; exec_prefix='${prefix}'
-
-# Transform confdefs.h into DEFS.
-# Protect against shell expansion while executing Makefile rules.
-# Protect against Makefile macro expansion.
-#
-# If the first sed substitution is executed (which looks for macros that
-# take arguments), then branch to the quote section.  Otherwise,
-# look for a macro that doesn't take arguments.
-ac_script='
-:mline
-/\\$/{
- N
- s,\\\n,,
- b mline
-}
-t clear
-:clear
-s/^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 (][^	 (]*([^)]*)\)[	 ]*\(.*\)/-D\1=\2/g
-t quote
-s/^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 ][^	 ]*\)[	 ]*\(.*\)/-D\1=\2/g
-t quote
-b any
-:quote
-s/[	 `~#$^&amp;*(){}\\|;'\''&quot;&lt;&gt;?]/\\&amp;/g
-s/\[/\\&amp;/g
-s/\]/\\&amp;/g
-s/\$/$$/g
-H
-:any
-${
-	g
-	s/^\n//
-	s/\n/ /g
-	p
-}
-'
-DEFS=`sed -n &quot;$ac_script&quot; confdefs.h`
-
-
-ac_libobjs=
-ac_ltlibobjs=
-for ac_i in : $LIBOBJS; do test &quot;x$ac_i&quot; = x: &amp;&amp; continue
-  # 1. Remove the extension, and $U if already installed.
-  ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
-  ac_i=`$as_echo &quot;$ac_i&quot; | sed &quot;$ac_script&quot;`
-  # 2. Prepend LIBOBJDIR.  When used with automake&gt;=1.10 LIBOBJDIR
-  #    will be set to the directory where LIBOBJS objects are built.
-  ac_libobjs=&quot;$ac_libobjs \${LIBOBJDIR}$ac_i\$U.$ac_objext&quot;
-  ac_ltlibobjs=&quot;$ac_ltlibobjs \${LIBOBJDIR}$ac_i&quot;'$U.lo'
-done
-LIBOBJS=$ac_libobjs
-
-LTLIBOBJS=$ac_ltlibobjs
-
-
-
-: ${CONFIG_STATUS=./config.status}
-ac_write_fail=0
-ac_clean_files_save=$ac_clean_files
-ac_clean_files=&quot;$ac_clean_files $CONFIG_STATUS&quot;
-{ $as_echo &quot;$as_me:$LINENO: creating $CONFIG_STATUS&quot; &gt;&amp;5
-$as_echo &quot;$as_me: creating $CONFIG_STATUS&quot; &gt;&amp;6;}
-cat &gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-#! $SHELL
-# Generated by $as_me.
-# Run this file to recreate the current configuration.
-# Compiler output produced by configure, useful for debugging
-# configure, is in config.log if it exists.
-
-debug=false
-ac_cs_recheck=false
-ac_cs_silent=false
-SHELL=\${CONFIG_SHELL-$SHELL}
-_ACEOF
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
-
-# Be more Bourne compatible
-DUALCASE=1; export DUALCASE # for MKS sh
-if test -n &quot;${ZSH_VERSION+set}&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+&quot;$@&quot;}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2&gt;/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
-fi
-
-
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
-as_nl='
-'
-export as_nl
-# Printing a long string crashes Solaris 7 /usr/bin/printf.
-as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
-as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
-as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test &quot;X`printf %s $as_echo`&quot; = &quot;X$as_echo&quot;) 2&gt;/dev/null; then
-  as_echo='printf %s\n'
-  as_echo_n='printf %s'
-else
-  if test &quot;X`(/usr/ucb/echo -n -n $as_echo) 2&gt;/dev/null`&quot; = &quot;X-n $as_echo&quot;; then
-    as_echo_body='eval /usr/ucb/echo -n &quot;$1$as_nl&quot;'
-    as_echo_n='/usr/ucb/echo -n'
-  else
-    as_echo_body='eval expr &quot;X$1&quot; : &quot;X\\(.*\\)&quot;'
-    as_echo_n_body='eval
-      arg=$1;
-      case $arg in
-      *&quot;$as_nl&quot;*)
-	expr &quot;X$arg&quot; : &quot;X\\(.*\\)$as_nl&quot;;
-	arg=`expr &quot;X$arg&quot; : &quot;.*$as_nl\\(.*\\)&quot;`;;
-      esac;
-      expr &quot;X$arg&quot; : &quot;X\\(.*\\)&quot; | tr -d &quot;$as_nl&quot;
-    '
-    export as_echo_n_body
-    as_echo_n='sh -c $as_echo_n_body as_echo'
-  fi
-  export as_echo_body
-  as_echo='sh -c $as_echo_body as_echo'
-fi
-
-# The user is always right.
-if test &quot;${PATH_SEPARATOR+set}&quot; != set; then
-  PATH_SEPARATOR=:
-  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; {
-    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) &gt;/dev/null 2&gt;&amp;1 ||
-      PATH_SEPARATOR=';'
-  }
-fi
-
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) &gt;/dev/null 2&gt;&amp;1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
-
-# IFS
-# We need space, tab and new line, in precisely that order.  Quoting is
-# there to prevent editors from complaining about space-tab.
-# (If _AS_PATH_WALK were called with IFS unset, it would disable word
-# splitting by setting IFS to empty value.)
-IFS=&quot; &quot;&quot;	$as_nl&quot;
-
-# Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
-  *[\\/]* ) as_myself=$0 ;;
-  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  test -r &quot;$as_dir/$0&quot; &amp;&amp; as_myself=$as_dir/$0 &amp;&amp; break
-done
-IFS=$as_save_IFS
-
-     ;;
-esac
-# We did not find ourselves, most probably we were run as `sh COMMAND'
-# in which case we are not to be found in the path.
-if test &quot;x$as_myself&quot; = x; then
-  as_myself=$0
-fi
-if test ! -f &quot;$as_myself&quot;; then
-  $as_echo &quot;$as_myself: error: cannot find myself; rerun with an absolute file name&quot; &gt;&amp;2
-  { (exit 1); exit 1; }
-fi
-
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; $as_unset $as_var
-done
-PS1='$ '
-PS2='&gt; '
-PS4='+ '
-
-# NLS nuisances.
-LC_ALL=C
-export LC_ALL
-LANGUAGE=C
-export LANGUAGE
-
-# Required to use basename.
-if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
-   test &quot;X`expr 00001 : '.*\(...\)'`&quot; = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-if (basename -- /) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; test &quot;X`basename -- / 2&gt;&amp;1`&quot; = &quot;X/&quot;; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-
-# Name of the executable.
-as_me=`$as_basename -- &quot;$0&quot; ||
-$as_expr X/&quot;$0&quot; : '.*/\([^/][^/]*\)/*$' \| \
-	 X&quot;$0&quot; : 'X\(//\)$' \| \
-	 X&quot;$0&quot; : 'X\(/\)' \| . 2&gt;/dev/null ||
-$as_echo X/&quot;$0&quot; |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-
-# CDPATH.
-$as_unset CDPATH
-
-
-
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test &quot;x$as_lineno_1&quot; != &quot;x$as_lineno_2&quot; &amp;&amp;
-  test &quot;x`expr $as_lineno_1 + 1`&quot; = &quot;x$as_lineno_2&quot; || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' &lt;$as_myself |
-    sed '
-      s/[$]LINENO.*/&amp;-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' &gt;$as_me.lineno &amp;&amp;
-  chmod +x &quot;$as_me.lineno&quot; ||
-    { $as_echo &quot;$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . &quot;./$as_me.lineno&quot;
-  # Exit status is that of the last command.
-  exit
-}
-
-
-if (as_dir=`dirname -- /` &amp;&amp; test &quot;X$as_dir&quot; = X/) &gt;/dev/null 2&gt;&amp;1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
-ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
--n*)
-  case `echo 'x\c'` in
-  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
-  esac;;
-*)
-  ECHO_N='-n';;
-esac
-if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
-   test &quot;X`expr 00001 : '.*\(...\)'`&quot; = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-rm -f conf$$ conf$$.exe conf$$.file
-if test -d conf$$.dir; then
-  rm -f conf$$.dir/conf$$.file
-else
-  rm -f conf$$.dir
-  mkdir conf$$.dir 2&gt;/dev/null
-fi
-if (echo &gt;conf$$.file) 2&gt;/dev/null; then
-  if ln -s conf$$.file conf$$ 2&gt;/dev/null; then
-    as_ln_s='ln -s'
-    # ... but there are two gotchas:
-    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
-    # 2) DJGPP &lt; 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
-    ln -s conf$$.file conf$$.dir 2&gt;/dev/null &amp;&amp; test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
-  elif ln conf$$.file conf$$ 2&gt;/dev/null; then
-    as_ln_s=ln
-  else
-    as_ln_s='cp -p'
-  fi
-else
-  as_ln_s='cp -p'
-fi
-rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
-rmdir conf$$.dir 2&gt;/dev/null
-
-if mkdir -p . 2&gt;/dev/null; then
-  as_mkdir_p=:
-else
-  test -d ./-p &amp;&amp; rmdir ./-p
-  as_mkdir_p=false
-fi
-
-if test -x / &gt;/dev/null 2&gt;&amp;1; then
-  as_test_x='test -x'
-else
-  if ls -dL / &gt;/dev/null 2&gt;&amp;1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d &quot;$1&quot;; then
-	test -d &quot;$1/.&quot;;
-      else
-	case $1 in
-	-*)set &quot;./$1&quot;;;
-	esac;
-	case `ls -ld'$as_ls_L_option' &quot;$1&quot; 2&gt;/dev/null` in
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
-
-# Sed expression to map a string onto a valid CPP name.
-as_tr_cpp=&quot;eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'&quot;
-
-# Sed expression to map a string onto a valid variable name.
-as_tr_sh=&quot;eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'&quot;
-
-
-exec 6&gt;&amp;1
-
-# Save the log message, to keep $[0] and so on meaningful, and to
-# report actual input values of CONFIG_FILES etc. instead of their
-# values after options handling.
-ac_log=&quot;
-This file was extended by map65 $as_me 0.9, which was
-generated by GNU Autoconf 2.62.  Invocation command line was
-
-  CONFIG_FILES    = $CONFIG_FILES
-  CONFIG_HEADERS  = $CONFIG_HEADERS
-  CONFIG_LINKS    = $CONFIG_LINKS
-  CONFIG_COMMANDS = $CONFIG_COMMANDS
-  $ $0 $@
-
-on `(hostname || uname -n) 2&gt;/dev/null | sed 1q`
-&quot;
-
-_ACEOF
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-# Files that config.status was made for.
-config_files=&quot;$ac_config_files&quot;
-
-_ACEOF
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-ac_cs_usage=&quot;\
-\`$as_me' instantiates files from templates according to the
-current configuration.
-
-Usage: $0 [OPTIONS] [FILE]...
-
-  -h, --help       print this help, then exit
-  -V, --version    print version number and configuration settings, then exit
-  -q, --quiet      do not print progress messages
-  -d, --debug      don't remove temporary files
-      --recheck    update $as_me by reconfiguring in the same conditions
-  --file=FILE[:TEMPLATE]
-                   instantiate the configuration file FILE
-
-Configuration files:
-$config_files
-
-Report bugs to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">bug-autoconf at gnu.org</A>&gt;.&quot;
-
-_ACEOF
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-ac_cs_version=&quot;\\
-map65 config.status 0.9
-configured by $0, generated by GNU Autoconf 2.62,
-  with options \\&quot;`$as_echo &quot;$ac_configure_args&quot; | sed 's/^ //; s/[\\&quot;&quot;\`\$]/\\\\&amp;/g'`\\&quot;
-
-Copyright (C) 2008 Free Software Foundation, Inc.
-This config.status script is free software; the Free Software Foundation
-gives unlimited permission to copy, distribute and modify it.&quot;
-
-ac_pwd='$ac_pwd'
-srcdir='$srcdir'
-INSTALL='$INSTALL'
-test -n &quot;\$AWK&quot; || AWK=awk
-_ACEOF
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-# The default lists apply if the user does not specify any file.
-ac_need_defaults=:
-while test $# != 0
-do
-  case $1 in
-  --*=*)
-    ac_option=`expr &quot;X$1&quot; : 'X\([^=]*\)='`
-    ac_optarg=`expr &quot;X$1&quot; : 'X[^=]*=\(.*\)'`
-    ac_shift=:
-    ;;
-  *)
-    ac_option=$1
-    ac_optarg=$2
-    ac_shift=shift
-    ;;
-  esac
-
-  case $ac_option in
-  # Handling of the options.
-  -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
-    ac_cs_recheck=: ;;
-  --version | --versio | --versi | --vers | --ver | --ve | --v | -V )
-    $as_echo &quot;$ac_cs_version&quot;; exit ;;
-  --debug | --debu | --deb | --de | --d | -d )
-    debug=: ;;
-  --file | --fil | --fi | --f )
-    $ac_shift
-    case $ac_optarg in
-    *\'*) ac_optarg=`$as_echo &quot;$ac_optarg&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;` ;;
-    esac
-    CONFIG_FILES=&quot;$CONFIG_FILES '$ac_optarg'&quot;
-    ac_need_defaults=false;;
-  --he | --h |  --help | --hel | -h )
-    $as_echo &quot;$ac_cs_usage&quot;; exit ;;
-  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-  | -silent | --silent | --silen | --sile | --sil | --si | --s)
-    ac_cs_silent=: ;;
-
-  # This is an error.
-  -*) { $as_echo &quot;$as_me: error: unrecognized option: $1
-Try \`$0 --help' for more information.&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; } ;;
-
-  *) ac_config_targets=&quot;$ac_config_targets $1&quot;
-     ac_need_defaults=false ;;
-
-  esac
-  shift
-done
-
-ac_configure_extra_args=
-
-if $ac_cs_silent; then
-  exec 6&gt;/dev/null
-  ac_configure_extra_args=&quot;$ac_configure_extra_args --silent&quot;
-fi
-
-_ACEOF
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-if \$ac_cs_recheck; then
-  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
-  shift
-  \$as_echo &quot;running CONFIG_SHELL=$SHELL \$*&quot; &gt;&amp;6
-  CONFIG_SHELL='$SHELL'
-  export CONFIG_SHELL
-  exec &quot;\$@&quot;
-fi
-
-_ACEOF
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-exec 5&gt;&gt;config.log
-{
-  echo
-  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' &lt;&lt;_ASBOX
-## Running $as_me. ##
-_ASBOX
-  $as_echo &quot;$ac_log&quot;
-} &gt;&amp;5
-
-_ACEOF
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-_ACEOF
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-
-# Handling of arguments.
-for ac_config_target in $ac_config_targets
-do
-  case $ac_config_target in
-    &quot;Makefile&quot;) CONFIG_FILES=&quot;$CONFIG_FILES Makefile&quot; ;;
-
-  *) { { $as_echo &quot;$as_me:$LINENO: error: invalid argument: $ac_config_target&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: invalid argument: $ac_config_target&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; };;
-  esac
-done
-
-
-# If the user did not use the arguments to specify the items to instantiate,
-# then the envvar interface is used.  Set only those that are not.
-# We use the long form for the default assignment because of an extremely
-# bizarre bug on SunOS 4.1.3.
-if $ac_need_defaults; then
-  test &quot;${CONFIG_FILES+set}&quot; = set || CONFIG_FILES=$config_files
-fi
-
-# Have a temporary directory for convenience.  Make it in the build tree
-# simply because there is no reason against having it here, and in addition,
-# creating and moving files from /tmp can sometimes cause problems.
-# Hook for its removal unless debugging.
-# Note that there is a small window in which the directory will not be cleaned:
-# after its creation but before its name has been assigned to `$tmp'.
-$debug ||
-{
-  tmp=
-  trap 'exit_status=$?
-  { test -z &quot;$tmp&quot; || test ! -d &quot;$tmp&quot; || rm -fr &quot;$tmp&quot;; } &amp;&amp; exit $exit_status
-' 0
-  trap '{ (exit 1); exit 1; }' 1 2 13 15
-}
-# Create a (secure) tmp directory for tmp files.
-
-{
-  tmp=`(umask 077 &amp;&amp; mktemp -d &quot;./confXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp;
-  test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot;
-}  ||
-{
-  tmp=./conf$$-$RANDOM
-  (umask 077 &amp;&amp; mkdir &quot;$tmp&quot;)
-} ||
-{
-   $as_echo &quot;$as_me: cannot create a temporary directory in .&quot; &gt;&amp;2
-   { (exit 1); exit 1; }
-}
-
-# Set up the scripts for CONFIG_FILES section.
-# No need to generate them if there are no CONFIG_FILES.
-# This happens for instance with `./config.status config.h'.
-if test -n &quot;$CONFIG_FILES&quot;; then
-
-
-ac_cr='
-'
-ac_cs_awk_cr=`$AWK 'BEGIN { print &quot;a\rb&quot; }' &lt;/dev/null 2&gt;/dev/null`
-if test &quot;$ac_cs_awk_cr&quot; = &quot;a${ac_cr}b&quot;; then
-  ac_cs_awk_cr='\\r'
-else
-  ac_cs_awk_cr=$ac_cr
-fi
-
-echo 'BEGIN {' &gt;&quot;$tmp/subs1.awk&quot; &amp;&amp;
-_ACEOF
-
-
-{
-  echo &quot;cat &gt;conf$$subs.awk &lt;&lt;_ACEOF&quot; &amp;&amp;
-  echo &quot;$ac_subst_vars&quot; | sed 's/.*/&amp;!$&amp;$ac_delim/' &amp;&amp;
-  echo &quot;_ACEOF&quot;
-} &gt;conf$$subs.sh ||
-  { { $as_echo &quot;$as_me:$LINENO: error: could not make $CONFIG_STATUS&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: could not make $CONFIG_STATUS&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-ac_delim_num=`echo &quot;$ac_subst_vars&quot; | grep -c '$'`
-ac_delim='%!_!# '
-for ac_last_try in false false false false false :; do
-  . ./conf$$subs.sh ||
-    { { $as_echo &quot;$as_me:$LINENO: error: could not make $CONFIG_STATUS&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: could not make $CONFIG_STATUS&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-
-  if test `sed -n &quot;s/.*$ac_delim\$/X/p&quot; conf$$subs.awk | grep -c X` = $ac_delim_num; then
-    break
-  elif $ac_last_try; then
-    { { $as_echo &quot;$as_me:$LINENO: error: could not make $CONFIG_STATUS&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: could not make $CONFIG_STATUS&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-  else
-    ac_delim=&quot;$ac_delim!$ac_delim _$ac_delim!! &quot;
-  fi
-done
-rm -f conf$$subs.sh
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-cat &gt;&gt;&quot;\$tmp/subs1.awk&quot; &lt;&lt;\\_ACAWK &amp;&amp;
-_ACEOF
-sed -n '
-h
-s/^/S[&quot;/; s/!.*/&quot;]=/
-p
-g
-s/^[^!]*!//
-:repl
-t repl
-s/'&quot;$ac_delim&quot;'$//
-t delim
-:nl
-h
-s/\(.\{148\}\).*/\1/
-t more1
-s/[&quot;\\]/\\&amp;/g; s/^/&quot;/; s/$/\\n&quot;\\/
-p
-n
-b repl
-:more1
-s/[&quot;\\]/\\&amp;/g; s/^/&quot;/; s/$/&quot;\\/
-p
-g
-s/.\{148\}//
-t nl
-:delim
-h
-s/\(.\{148\}\).*/\1/
-t more2
-s/[&quot;\\]/\\&amp;/g; s/^/&quot;/; s/$/&quot;/
-p
-b
-:more2
-s/[&quot;\\]/\\&amp;/g; s/^/&quot;/; s/$/&quot;\\/
-p
-g
-s/.\{148\}//
-t delim
-' &lt;conf$$subs.awk | sed '
-/^[^&quot;&quot;]/{
-  N
-  s/\n//
-}
-' &gt;&gt;$CONFIG_STATUS || ac_write_fail=1
-rm -f conf$$subs.awk
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-_ACAWK
-cat &gt;&gt;&quot;\$tmp/subs1.awk&quot; &lt;&lt;_ACAWK &amp;&amp;
-  for (key in S) S_is_set[key] = 1
-  FS = &quot;&quot;
-
-}
-{
-  line = $ 0
-  nfields = split(line, field, &quot;@&quot;)
-  substed = 0
-  len = length(field[1])
-  for (i = 2; i &lt; nfields; i++) {
-    key = field[i]
-    keylen = length(key)
-    if (S_is_set[key]) {
-      value = S[key]
-      line = substr(line, 1, len) &quot;&quot; value &quot;&quot; substr(line, len + keylen + 3)
-      len += length(value) + length(field[++i])
-      substed = 1
-    } else
-      len += 1 + keylen
-  }
-
-  print line
-}
-
-_ACAWK
-_ACEOF
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-if sed &quot;s/$ac_cr//&quot; &lt; /dev/null &gt; /dev/null 2&gt;&amp;1; then
-  sed &quot;s/$ac_cr\$//; s/$ac_cr/$ac_cs_awk_cr/g&quot;
-else
-  cat
-fi &lt; &quot;$tmp/subs1.awk&quot; &gt; &quot;$tmp/subs.awk&quot; \
-  || { { $as_echo &quot;$as_me:$LINENO: error: could not setup config files machinery&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: could not setup config files machinery&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-_ACEOF
-
-# VPATH may cause trouble with some makes, so we remove $(srcdir),
-# ${srcdir} and @srcdir@ from VPATH if srcdir is &quot;.&quot;, strip leading and
-# trailing colons and then remove the whole line if VPATH becomes empty
-# (actually we leave an empty line to preserve line numbers).
-if test &quot;x$srcdir&quot; = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
-s/:*\$(srcdir):*/:/
-s/:*\${srcdir}:*/:/
-s/:*@srcdir@:*/:/
-s/^\([^=]*=[	 ]*\):*/\1/
-s/:*$//
-s/^[^=]*=[	 ]*$//
-}'
-fi
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-fi # test -n &quot;$CONFIG_FILES&quot;
-
-
-eval set X &quot;  :F $CONFIG_FILES      &quot;
-shift
-for ac_tag
-do
-  case $ac_tag in
-  :[FHLC]) ac_mode=$ac_tag; continue;;
-  esac
-  case $ac_mode$ac_tag in
-  :[FHL]*:*);;
-  :L* | :C*:*) { { $as_echo &quot;$as_me:$LINENO: error: Invalid tag $ac_tag.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: Invalid tag $ac_tag.&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; };;
-  :[FH]-) ac_tag=-:-;;
-  :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
-  esac
-  ac_save_IFS=$IFS
-  IFS=:
-  set x $ac_tag
-  IFS=$ac_save_IFS
-  shift
-  ac_file=$1
-  shift
-
-  case $ac_mode in
-  :L) ac_source=$1;;
-  :[FH])
-    ac_file_inputs=
-    for ac_f
-    do
-      case $ac_f in
-      -) ac_f=&quot;$tmp/stdin&quot;;;
-      *) # Look for the file first in the build tree, then in the source tree
-	 # (if the path is not absolute).  The absolute path cannot be DOS-style,
-	 # because $ac_f cannot contain `:'.
-	 test -f &quot;$ac_f&quot; ||
-	   case $ac_f in
-	   [\\/$]*) false;;
-	   *) test -f &quot;$srcdir/$ac_f&quot; &amp;&amp; ac_f=&quot;$srcdir/$ac_f&quot;;;
-	   esac ||
-	   { { $as_echo &quot;$as_me:$LINENO: error: cannot find input file: $ac_f&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: cannot find input file: $ac_f&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; };;
-      esac
-      case $ac_f in *\'*) ac_f=`$as_echo &quot;$ac_f&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;`;; esac
-      ac_file_inputs=&quot;$ac_file_inputs '$ac_f'&quot;
-    done
-
-    # Let's still pretend it is `configure' which instantiates (i.e., don't
-    # use $as_me), people would be surprised to read:
-    #    /* config.h.  Generated by config.status.  */
-    configure_input='Generated from '`
-	  $as_echo &quot;$*&quot; | sed 's|^[^:]*/||;s|:[^:]*/|, |g'
-	`' by configure.'
-    if test x&quot;$ac_file&quot; != x-; then
-      configure_input=&quot;$ac_file.  $configure_input&quot;
-      { $as_echo &quot;$as_me:$LINENO: creating $ac_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: creating $ac_file&quot; &gt;&amp;6;}
-    fi
-    # Neutralize special characters interpreted by sed in replacement strings.
-    case $configure_input in #(
-    *\&amp;* | *\|* | *\\* )
-       ac_sed_conf_input=`$as_echo &quot;$configure_input&quot; |
-       sed 's/[\\\\&amp;|]/\\\\&amp;/g'`;; #(
-    *) ac_sed_conf_input=$configure_input;;
-    esac
-
-    case $ac_tag in
-    *:-:* | *:-) cat &gt;&quot;$tmp/stdin&quot; \
-      || { { $as_echo &quot;$as_me:$LINENO: error: could not create $ac_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: could not create $ac_file&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; } ;;
-    esac
-    ;;
-  esac
-
-  ac_dir=`$as_dirname -- &quot;$ac_file&quot; ||
-$as_expr X&quot;$ac_file&quot; : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X&quot;$ac_file&quot; : 'X\(//\)[^/]' \| \
-	 X&quot;$ac_file&quot; : 'X\(//\)$' \| \
-	 X&quot;$ac_file&quot; : 'X\(/\)' \| . 2&gt;/dev/null ||
-$as_echo X&quot;$ac_file&quot; |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-  { as_dir=&quot;$ac_dir&quot;
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d &quot;$as_dir&quot; || { $as_mkdir_p &amp;&amp; mkdir -p &quot;$as_dir&quot;; } || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`$as_echo &quot;$as_dir&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;`;; #'(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs=&quot;'$as_qdir' $as_dirs&quot;
-      as_dir=`$as_dirname -- &quot;$as_dir&quot; ||
-$as_expr X&quot;$as_dir&quot; : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X&quot;$as_dir&quot; : 'X\(//\)[^/]' \| \
-	 X&quot;$as_dir&quot; : 'X\(//\)$' \| \
-	 X&quot;$as_dir&quot; : 'X\(/\)' \| . 2&gt;/dev/null ||
-$as_echo X&quot;$as_dir&quot; |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-      test -d &quot;$as_dir&quot; &amp;&amp; break
-    done
-    test -z &quot;$as_dirs&quot; || eval &quot;mkdir $as_dirs&quot;
-  } || test -d &quot;$as_dir&quot; || { { $as_echo &quot;$as_me:$LINENO: error: cannot create directory $as_dir&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: cannot create directory $as_dir&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }; }
-  ac_builddir=.
-
-case &quot;$ac_dir&quot; in
-.) ac_dir_suffix= ac_top_builddir_sub=. ac_top_build_prefix= ;;
-*)
-  ac_dir_suffix=/`$as_echo &quot;$ac_dir&quot; | sed 's|^\.[\\/]||'`
-  # A &quot;..&quot; for each directory in $ac_dir_suffix.
-  ac_top_builddir_sub=`$as_echo &quot;$ac_dir_suffix&quot; | sed 's|/[^\\/]*|/..|g;s|/||'`
-  case $ac_top_builddir_sub in
-  &quot;&quot;) ac_top_builddir_sub=. ac_top_build_prefix= ;;
-  *)  ac_top_build_prefix=$ac_top_builddir_sub/ ;;
-  esac ;;
-esac
-ac_abs_top_builddir=$ac_pwd
-ac_abs_builddir=$ac_pwd$ac_dir_suffix
-# for backward compatibility:
-ac_top_builddir=$ac_top_build_prefix
-
-case $srcdir in
-  .)  # We are building in place.
-    ac_srcdir=.
-    ac_top_srcdir=$ac_top_builddir_sub
-    ac_abs_top_srcdir=$ac_pwd ;;
-  [\\/]* | ?:[\\/]* )  # Absolute name.
-    ac_srcdir=$srcdir$ac_dir_suffix;
-    ac_top_srcdir=$srcdir
-    ac_abs_top_srcdir=$srcdir ;;
-  *) # Relative name.
-    ac_srcdir=$ac_top_build_prefix$srcdir$ac_dir_suffix
-    ac_top_srcdir=$ac_top_build_prefix$srcdir
-    ac_abs_top_srcdir=$ac_pwd/$srcdir ;;
-esac
-ac_abs_srcdir=$ac_abs_top_srcdir$ac_dir_suffix
-
-
-  case $ac_mode in
-  :F)
-  #
-  # CONFIG_FILE
-  #
-
-  case $INSTALL in
-  [\\/$]* | ?:[\\/]* ) ac_INSTALL=$INSTALL ;;
-  *) ac_INSTALL=$ac_top_build_prefix$INSTALL ;;
-  esac
-_ACEOF
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-# If the template does not know about datarootdir, expand it.
-# FIXME: This hack should be removed a few years after 2.60.
-ac_datarootdir_hack=; ac_datarootdir_seen=
-
-ac_sed_dataroot='
-/datarootdir/ {
-  p
-  q
-}
-/@datadir@/p
-/@docdir@/p
-/@infodir@/p
-/@localedir@/p
-/@mandir@/p
-'
-case `eval &quot;sed -n \&quot;\$ac_sed_dataroot\&quot; $ac_file_inputs&quot;` in
-*datarootdir*) ac_datarootdir_seen=yes;;
-*@datadir@*|*@docdir@*|*@infodir@*|*@localedir@*|*@mandir@*)
-  { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting&quot; &gt;&amp;2;}
-_ACEOF
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-  ac_datarootdir_hack='
-  s&amp;@datadir@&amp;$datadir&amp;g
-  s&amp;@docdir@&amp;$docdir&amp;g
-  s&amp;@infodir@&amp;$infodir&amp;g
-  s&amp;@localedir@&amp;$localedir&amp;g
-  s&amp;@mandir@&amp;$mandir&amp;g
-    s&amp;\\\${datarootdir}&amp;$datarootdir&amp;g' ;;
-esac
-_ACEOF
-
-# Neutralize VPATH when `$srcdir' = `.'.
-# Shell code in configure.ac might set extrasub.
-# FIXME: do we really want to maintain this feature?
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF || ac_write_fail=1
-ac_sed_extra=&quot;$ac_vpsub
-$extrasub
-_ACEOF
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF || ac_write_fail=1
-:t
-/@[a-zA-Z_][a-zA-Z_0-9]*@/!b
-s|@configure_input@|$ac_sed_conf_input|;t t
-s&amp;@top_builddir@&amp;$ac_top_builddir_sub&amp;;t t
-s&amp;@top_build_prefix@&amp;$ac_top_build_prefix&amp;;t t
-s&amp;@srcdir@&amp;$ac_srcdir&amp;;t t
-s&amp;@abs_srcdir@&amp;$ac_abs_srcdir&amp;;t t
-s&amp;@top_srcdir@&amp;$ac_top_srcdir&amp;;t t
-s&amp;@abs_top_srcdir@&amp;$ac_abs_top_srcdir&amp;;t t
-s&amp;@builddir@&amp;$ac_builddir&amp;;t t
-s&amp;@abs_builddir@&amp;$ac_abs_builddir&amp;;t t
-s&amp;@abs_top_builddir@&amp;$ac_abs_top_builddir&amp;;t t
-s&amp;@INSTALL@&amp;$ac_INSTALL&amp;;t t
-$ac_datarootdir_hack
-&quot;
-eval sed \&quot;\$ac_sed_extra\&quot; &quot;$ac_file_inputs&quot; | $AWK -f &quot;$tmp/subs.awk&quot; &gt;$tmp/out \
-  || { { $as_echo &quot;$as_me:$LINENO: error: could not create $ac_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: could not create $ac_file&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-
-test -z &quot;$ac_datarootdir_hack$ac_datarootdir_seen&quot; &amp;&amp;
-  { ac_out=`sed -n '/\${datarootdir}/p' &quot;$tmp/out&quot;`; test -n &quot;$ac_out&quot;; } &amp;&amp;
-  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' &quot;$tmp/out&quot;`; test -z &quot;$ac_out&quot;; } &amp;&amp;
-  { $as_echo &quot;$as_me:$LINENO: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined.&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined.&quot; &gt;&amp;2;}
-
-  rm -f &quot;$tmp/stdin&quot;
-  case $ac_file in
-  -) cat &quot;$tmp/out&quot; &amp;&amp; rm -f &quot;$tmp/out&quot;;;
-  *) rm -f &quot;$ac_file&quot; &amp;&amp; mv &quot;$tmp/out&quot; &quot;$ac_file&quot;;;
-  esac \
-  || { { $as_echo &quot;$as_me:$LINENO: error: could not create $ac_file&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: could not create $ac_file&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
- ;;
-
-
-
-  esac
-
-done # for ac_tag
-
-
-{ (exit 0); exit 0; }
-_ACEOF
-chmod +x $CONFIG_STATUS
-ac_clean_files=$ac_clean_files_save
-
-test $ac_write_fail = 0 ||
-  { { $as_echo &quot;$as_me:$LINENO: error: write failure creating $CONFIG_STATUS&quot; &gt;&amp;5
-$as_echo &quot;$as_me: error: write failure creating $CONFIG_STATUS&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-
-
-# configure is writing to config.log, and then calls config.status.
-# config.status does its own redirection, appending to config.log.
-# Unfortunately, on DOS this fails, as config.log is still kept open
-# by configure, so config.status won't be able to write to it; its
-# output is simply discarded.  So we exec the FD to /dev/null,
-# effectively closing config.log, so it can be properly (re)opened and
-# appended to by config.status.  When coming back to configure, we
-# need to make the FD available again.
-if test &quot;$no_create&quot; != yes; then
-  ac_cs_success=:
-  ac_config_status_args=
-  test &quot;$silent&quot; = yes &amp;&amp;
-    ac_config_status_args=&quot;$ac_config_status_args --quiet&quot;
-  exec 5&gt;/dev/null
-  $SHELL $CONFIG_STATUS $ac_config_status_args || ac_cs_success=false
-  exec 5&gt;&gt;config.log
-  # Use ||, not &amp;&amp;, to avoid exiting from the if with $? = 1, which
-  # would make configure fail if this is the last instruction.
-  $ac_cs_success || { (exit 1); exit 1; }
-fi
-if test -n &quot;$ac_unrecognized_opts&quot; &amp;&amp; test &quot;$enable_option_checking&quot; != no; then
-  { $as_echo &quot;$as_me:$LINENO: WARNING: Unrecognized options: $ac_unrecognized_opts&quot; &gt;&amp;5
-$as_echo &quot;$as_me: WARNING: Unrecognized options: $ac_unrecognized_opts&quot; &gt;&amp;2;}
-fi
-
-
-
-echo
-echo
-
-if test $g95 = &quot;yes&quot;; then
-	echo &quot;Using g95 as fortran compiler.&quot;;
-elif test $gfortran = &quot;yes&quot;; then
-	echo &quot;Using gfortran as fortran compiler.&quot;;
-fi
-
-echo
-echo &quot;Compiling $PACKAGE_NAME $PACKAGE_VERSION&quot;
-echo
-
-echo &quot;Installing into: $prefix&quot;
-
-echo

Deleted: branches/map65/configure.ac
===================================================================
--- branches/map65/configure.ac	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/configure.ac	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,220 +0,0 @@
-dnl $Id$
-dnl Process this file with autoconf to produce a configure script.
-
-dnl AC_PREREQ(2.61)
-
-dnl Sneaky way to get an Id tag into the configure script
-AC_COPYRIGHT([$Id$])
-
-AC_INIT([map65],[0.9])
-
-fail=0
-
-AC_PREFIX_DEFAULT(/usr/local/)
-
-OLD_CFLAGS=&quot;$CFLAGS&quot;
-dnl Checks for programs.
-AC_PROG_CC
-AC_LANG(C)
-AC_PROG_F77
-
-dnl Make sure autoconf doesn't interfere with cflags -jmallett
-CFLAGS=&quot;$OLD_CFLAGS&quot;
-
-dnl Lets guess at some likely places for extra libs/includes XXX -db
-CPPFLAGS=&quot;-I/usr/local/include ${CPPFLAGS}&quot;
-LDFLAGS=&quot;-L/usr/local/lib ${LDFLAGS}&quot;
-LIBS=&quot; -lpthread ${LIBS}&quot;
-FFLAGS_GFORTRAN=&quot;${FFLAGS} -fno-range-check -ffixed-line-length-none\
-			-Wall -fbounds-check -fno-second-underscore -fPIC&quot;
-FFLAGS_G95=&quot;${FFLAGS} -Wall -Wno-precision-loss -fbounds-check -fno-second-underscore -fPIC&quot;
-#-Wall -Wno-precision-loss -fbounds-check -fno-second-underscore -fPIC
-
-AX_CHECK_GFORTRAN
-AX_CHECK_PORTAUDIO
-
-dnl If we support -g, use it!
-if test &quot;$ac_cv_prog_cc_g&quot; = yes; then
-		CFLAGS=&quot;$CFLAGS -g&quot;
-fi
-
-dnl jdc -- If CFLAGS is defined, best use it everywhere...
-dnl NOTE: jv says it must be added to the *END*, because things like
-dnl &quot;gcc -O9 -O2&quot; will result in -O2 getting preference.  How stupid.
-if test ! -z &quot;$CFLAGS&quot;; then
-	CFLAGS=&quot;$CFLAGS $CFLAGS&quot;
-fi
-
-
-AC_ISC_POSIX
-AC_C_INLINE
-AC_PROG_GCC_TRADITIONAL
-AC_PROG_MAKE_SET
-AC_PROG_INSTALL
-AC_PATH_PROG(RM, rm)
-AC_PATH_PROG(CP, cp)
-AC_PATH_PROG(MV, mv)
-AC_PATH_PROG(LN, ln)
-AC_PATH_PROG(SED, sed)
-AC_PATH_PROG(AR, ar)
-AC_PATH_PROG(LD, ld)
-AC_PATH_PROG(TEST, [test], [test])
-AC_PATH_PROG(PYTHON, python)
-AC_PATH_PROG(F2PY, f2py)
-AC_MSG_CHECKING([OS])
-OS=`uname`
-AC_SUBST(OS, &quot;${OS}&quot;)
-
-dnl Checks for header files.
-
-AC_HEADER_STDC
-
-AC_CHECK_HEADERS([inttypes.h stdint.h sys/resource.h sys/param.h errno.h \
-sys/syslog.h stddef.h libgen.h sys/wait.h wait.h stdio.h termios.h \
-sys/resource.h linux/ppdev.h dev/ppbus/ppi.h sys/stat.h fcntl.h sys/ioctl.h ])
-
-AC_HEADER_TIME
-
-AC_CHECK_HEADER([fftw3.h], [HAS_FFTW3_H=1], [HAS_FFTW3_H=0])
-AC_CHECK_HEADER([samplerate.h], [HAS_SAMPLERATE_H=1], [HAS_SAMPLERATE_H=0])
-
-dnl See whether we can include both string.h and strings.h.
-AC_CACHE_CHECK([whether string.h and strings.h may both be included],
-gcc_cv_header_string,
-[
-	AC_COMPILE_IFELSE(
-	[#include &lt;string.h&gt;
-	#include &lt;strings.h&gt;], 
-	[gcc_cv_header_string=yes],
-	[gcc_cv_header_string=no])
-])
-
-if test &quot;$gcc_cv_header_string&quot; = &quot;yes&quot;; then
-	AC_DEFINE(STRING_WITH_STRINGS, 1, [Define to 1 if string.h may be included along with strings.h])
-fi
-
-dnl check for a fortran shim entry point
-AC_CHECK_LIB(fftw3f, sfftw_destroy_plan_, \
-	[HAS_FFTW3FLIBS=1], [HAS_FFTW3FLIBS=0])
-
-dnl Check for stdarg.h - if we can't find it, halt configure
-AC_CHECK_HEADER(stdarg.h, , [AC_MSG_ERROR([** stdarg.h could not be found - wsjt will not compile without it **])])
-
-dnl Debug-related options
-dnl =====================
-
-AC_ARG_ENABLE(clobber,
-AC_HELP_STRING([--enable-clobber], [Don't preserve old binaries on make install]),
-[clobber=$enableval], [clobber=no])
-
-if test &quot;$clobber&quot; = yes; then
-	AC_SUBST(CLOBBER, yes)
-fi
-
-AC_ARG_ENABLE(assert,
-AC_HELP_STRING([--enable-assert],[Enable assert().]),
-[assert=$enableval], [assert=no])
-
-if test &quot;$assert&quot; = no; then
-	AC_DEFINE(NDEBUG, 1, [Define this to disable debugging support.])
-fi
-
-if test &quot;$prefix&quot; = &quot;NONE&quot;; then 
-	prefix=${ac_default_prefix}
-else
-
-dnl Don't get bitten by Cygwin's stupidity if the user specified
-dnl a custom prefix with a trailing slash
-
-	prefix=`echo ${ac_default_prefix} | sed 's/\/$//'`
-fi
-
-dnl sanity tests.
-dnl =============
-
-if test -z $FC ; then
-	fail=1
-	echo &quot;You need g95 or gfortran to compile this program!&quot;
-fi
-
-if test $HAS_FFTW3_H -eq 0; then
-	fail=1
-	echo &quot;You need to install the fftw3 libraries&quot;
-fi
-
-if test $HAS_SAMPLERATE_H -eq 0; then
-	fail=1
-	echo &quot;You need to install the samplerate library&quot;
-else
-        AC_DEFINE(HAS_SAMPLERATE_H, 1, )
-	LIBS=&quot;${LIBS} -lsamplerate&quot;
-fi
-
-if test $HAS_PORTAUDIO -eq 1; then
-	AC_DEFINE(HAS_PORTAUDIO, 1, )
-	AC_DEFINE(HAS_PORTAUDIO_H, 1, )
-	AC_DEFINE(HAS_PORTAUDIO_LIB, 1, )
-else
-	fail=1
-	echo &quot;This program needs portaudio v19 to compile.&quot;
-	echo &quot;Please use --with-portaudio-include-dir= and&quot;
-	echo &quot; --with-portaudio-lib-dir= to set the paths.&quot;
-fi
-
-if test $HAS_FFTW3_H -eq 1; then
-	AC_DEFINE(HAS_FFTW3_H, 1, )
-else
-	fail=1
-	echo &quot;You are missing the fftw3.h include file&quot;
-fi
-
-if test $HAS_FFTW3FLIBS -eq 1; then
-	LIBS=&quot;${LIBS} -lfftw3f&quot;
-	AC_DEFINE(HAS_FFTW3FLIBS, 1, )
-else
-	fail=1
-	echo &quot;You are missing the fortran shim in libfftw3.&quot;
-fi
-
-if test &quot;$F2PY&quot; = &quot;&quot;; then
-	echo &quot;You are missing f2py, trying local copy.&quot;
-	F2PY=&quot;python f2py.py&quot;;	
-fi
-
-dnl 
-dnl
-dnl If fail a pre-requisite then fail
-dnl
-
-if test $fail -eq 1; then
-	AC_MSG_ERROR([Please check error messages and install missing packages.])
-fi
-
-AC_SUBST(PREFIX, &quot;${prefix}&quot;)
-AC_SUBST(CPPFLAGS, &quot;${CPPFLAGS}&quot;)
-AC_SUBST(LDFLAGS, &quot;${LDFLAGS}&quot;)
-AC_SUBST(LIBS, &quot;${LIBS}&quot;)
-AC_SUBST(CFLAGS)
-AC_SUBST(FFLAGS)
-AC_SUBST(F2PY, &quot;${F2PY}&quot;)
-AC_CONFIG_FILES(Makefile)
-AC_OUTPUT
-
-dnl do summary
-
-echo
-echo
-
-if test $g95 = &quot;yes&quot;; then
-	echo &quot;Using g95 as fortran compiler.&quot;;
-elif test $gfortran = &quot;yes&quot;; then
-	echo &quot;Using gfortran as fortran compiler.&quot;;
-fi
-
-echo
-echo &quot;Compiling $PACKAGE_NAME $PACKAGE_VERSION&quot;
-echo
-
-echo &quot;Installing into: $prefix&quot;
-
-echo

Deleted: branches/map65/coord.f
===================================================================
--- branches/map65/coord.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/coord.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,37 +0,0 @@
-	SUBROUTINE COORD(A0,B0,AP,BP,A1,B1,A2,B2)
-
-C  Examples:
-C  1. From ha,dec to az,el:
-C	call coord(pi,pio2-lat,0.,lat,ha,dec,az,el)
-C  2. From az,el to ha,dec:
-C	call coord(pi,pio2-lat,0.,lat,az,el,ha,dec)
-C  3. From ra,dec to l,b
-C	call coord(4.635594495,-0.504691042,3.355395488,0.478220215,
-C	  ra,dec,l,b)
-C  4. From l,b to ra,dec
-C	call coord(1.705981071d0,-1.050357016d0,2.146800277d0,
-C         0.478220215d0,l,b,ra,dec)
-C  5. From ecliptic latitude (eb) and longitude (el) to ra, dec:
-C	call coord(0.e0,0.e0,-pio2,pio2-23.443*pi/180,ra,dec,el,eb)
-
-      SB0=sin(B0)
-      CB0=cos(B0)
-      SBP=sin(BP)
-      CBP=cos(BP)
-      SB1=sin(B1)
-      CB1=cos(B1)
-      SB2=SBP*SB1 + CBP*CB1*cos(AP-A1)
-      CB2=SQRT(1.e0-SB2**2)
-      B2=atan(SB2/CB2)
-      SAA=sin(AP-A1)*CB1/CB2
-      CAA=(SB1-SB2*SBP)/(CB2*CBP)
-      CBB=SB0/CBP
-      SBB=sin(AP-A0)*CB0
-      SA2=SAA*CBB-CAA*SBB
-      CA2=CAA*CBB+SAA*SBB
-      IF(CA2.LE.0.e0) TA2O2=(1.e0-CA2)/SA2 
-      IF(CA2.GT.0.e0) TA2O2=SA2/(1.e0+CA2)
-      A2=2.e0*atan(TA2O2)
-      IF(A2.LT.0.e0) A2=A2+6.2831853
-      RETURN
-      END

Deleted: branches/map65/cutil.c
===================================================================
--- branches/map65/cutil.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/cutil.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,93 +0,0 @@
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;unistd.h&gt;
-#include &lt;sys/types.h&gt;
-#include &lt;sys/stat.h&gt;
-#include &lt;fcntl.h&gt;
-// #include &lt;sys/times.h&gt;
-// #include &lt;time.h&gt;
-// #include &lt;sys/time.h&gt;
-#include &quot;sleep.h&quot;
-#include &quot;timeval.h&quot;
-
-/*  FORTRAN:  fd = close(filedes)      */
-int close_(int *filedes)
-{
-return(close(*filedes));
-}
-/*  FORTRAN:  fd = open(filnam,mode)  */
-int open_(char filnam[], int *mode)
-{
-  return(open(filnam,*mode));
-}
-/* FORTRAN:  fd = creat(filnam,mode) */
-int creat_(char filnam[],int *mode)
-{
-  return(creat(filnam,*mode));
-}
-/* FORTRAN:  nread = read(fd,buf,n) */
-int read_(int *fd, char buf[], int *n)
-{
-  return(read(*fd,buf,*n));
-}
-/* FORTRAN:  nwrt = write(fd,buf,n) */
-int write_(int *fd, char buf[], int *n)
-{
-  return(write(*fd,buf,*n));
-}
-/* FORTRAN: ns = lseek(fd,offset,origin) */
-int lseek_(int *fd,int *offset, int *origin)
-{
-  return(lseek(*fd,*offset,*origin));
-}
-/* times(2) */
-//int times_(struct tms *buf)
-//{
-//  return (times(buf));
-//}
-/* ioperm(2) */
-//ioperm_(from,num,turn_on)
-//unsigned long *from,*num,*turn_on;
-//{
-//  return (ioperm(*from,*num,*turn_on));
-//   return (i386_get_ioperm(*from,*num,*turn_on));
-//}
-
-/* usleep(3) */
-void usleep_(unsigned long *microsec)
-{
-  usleep(*microsec);
-}
-
-/* returns random numbers between 0 and 32767 to FORTRAN program */
-int iran_(int *arg)
-{
-  return (rand());
-}
-
-int exit_(int *n)
-{
-  printf(&quot;\n\n&quot;);
-  exit(*n);
-}
-
-/*
-struct tm *
-gmtime_r_(const time_t *clock, struct tm *result)
-{
-  gmtime_r(clock, result);
-}
-*/
-
-time_t time_(void)
-{
-     return time(0);
-}
-
-/* hrtime() */
-double hrtime_(void)
-{
-  struct timeval tv;
-  gettimeofday(&amp;tv,NULL);
-  return(tv.tv_sec+1.e-6*tv.tv_usec);
-}

Deleted: branches/map65/datcom.f90
===================================================================
--- branches/map65/datcom.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/datcom.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,5 +0,0 @@
-parameter (NSMAX=60*96000)          !Samples per 60 s file
-real*4 dd                           !92 MB: raw data from Linrad timf2
-character*80 fname80
-common/datcom/dd(4,NSMAX,2),nutc,newdat2,kbuf,kxp,kk,kkdone,nlost,   &amp;
-     nlen,fname80

Deleted: branches/map65/db.f
===================================================================
--- branches/map65/db.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/db.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,5 +0,0 @@
-	real function db(x)
-	db=-99.0
-	if(x.gt.1.259e-10) db=10.0*log10(x)
-	return
-	end

Deleted: branches/map65/dcoord.f
===================================================================
--- branches/map65/dcoord.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/dcoord.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,39 +0,0 @@
-	SUBROUTINE DCOORD(A0,B0,AP,BP,A1,B1,A2,B2)
-
-	implicit real*8 (a-h,o-z)
-C  Examples:
-C  1. From ha,dec to az,el:
-C	call coord(pi,pio2-lat,0.,lat,ha,dec,az,el)
-C  2. From az,el to ha,dec:
-C	call coord(pi,pio2-lat,0.,lat,az,el,ha,dec)
-C  3. From ra,dec to l,b
-C	call coord(4.635594495,-0.504691042,3.355395488,0.478220215,
-C	  ra,dec,l,b)
-C  4. From l,b to ra,dec
-C	call coord(1.705981071d0,-1.050357016d0,2.146800277d0,
-C         0.478220215d0,l,b,ra,dec)
-C  5. From ecliptic latitude (eb) and longitude (el) to ra, dec:
-C	call coord(0.d0,0.d0,-pio2,pio2-23.443*pi/180,ra,dec,el,eb)
-
-      SB0=sin(B0)
-      CB0=cos(B0)
-      SBP=sin(BP)
-      CBP=cos(BP)
-      SB1=sin(B1)
-      CB1=cos(B1)
-      SB2=SBP*SB1 + CBP*CB1*cos(AP-A1)
-      CB2=SQRT(1.D0-SB2**2)
-      B2=atan(SB2/CB2)
-      SAA=sin(AP-A1)*CB1/CB2
-      CAA=(SB1-SB2*SBP)/(CB2*CBP)
-      CBB=SB0/CBP
-      SBB=sin(AP-A0)*CB0
-      SA2=SAA*CBB-CAA*SBB
-      CA2=CAA*CBB+SAA*SBB
-      IF(CA2.LE.0.D0) TA2O2=(1.D0-CA2)/SA2 
-      IF(CA2.GT.0.D0) TA2O2=SA2/(1.D0+CA2)
-      A2=2.D0*atan(TA2O2)
-      IF(A2.LT.0.D0) A2=A2+6.2831853071795864D0
-
-      RETURN
-      END

Deleted: branches/map65/decode1.f90
===================================================================
--- branches/map65/decode1.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/decode1.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,87 +0,0 @@
-subroutine decode1(iarg)
-
-! Get data and parameters from gcom, then call the decoders when needed.
-! This routine runs in a background thread and will never return.
-
-#ifdef CVF
-  use dflib
-#endif
-
-  character sending0*28,mode0*6,cshort*11
-  integer sendingsh0
-
-  include 'datcom.f90'
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-  include 'gcom3.f90'
-  include 'gcom4.f90'
-  data kbuf0/0/,ns00/-999/
-  data sending0/'                      '/
-  save
-
-  kkdone=-99
-  ns0=999999
-  newdat2=0
-  kbuf=1
-
-10 continue
-  if(newdat2.gt.0) then
-     call getfile2(fname80,nlen)
-     newdat2=0
-     kbuf=1
-     kk=NSMAX
-     kkdone=0
-     newdat=1
-  endif
-
-  if(kbuf.ne.kbuf0) kkdone=0
-  kbuf0=kbuf
-  kkk=kk
-  if(kbuf.eq.2) kkk=kk-5760000
-  n=Tsec
-
-  if((ndiskdat.eq.1 .or. ndecoding.eq.0) .and. ((kkk-kkdone).gt.32768)) then
-     call symspec(dd,kbuf,kk,kkdone,nutc,newdat)
-     call sleep_msec(10)
-  endif
-
-  if(ndecoding.gt.0 .and. mode(1:4).eq.'JT65') then
-     ndecdone=0
-     call map65a(newdat)
-     if(mousebutton.eq.0) ndecoding0=ndecoding
-     ndecoding=0
-  endif
-
-  if(ns0.lt.0) then
-     rewind 21
-     ns0=999999
-  endif
-  if(n.lt.ns0 .and. utcdate(1:1).eq.'2') then
-     call cs_lock('decode1a')
-     write(21,1001) utcdate(:11)
-1001 format(/'UTC Date: ',a11/'---------------------')
-     ns0=n
-     call cs_unlock
-  endif
-
-  if(transmitting.eq.1 .and. (sending.ne.sending0 .or.       &amp;
-       sendingsh.ne.sendingsh0 .or. mode.ne.mode0)) then
-     ih=n/3600
-     im=mod(n/60,60)
-     is=mod(n,60)
-     cshort='           '
-     if(sendingsh.eq.1) cshort='(Shorthand)'
-     call cs_lock('decode1b')
-     write(21,1010) ih,im,is,mode,sending,cshort
-1010 format(3i2.2,'  Transmitting: ',a6,2x,a28,2x,a11)
-     call flushqqq(21)
-     call cs_unlock
-     sending0=sending
-     sendingsh0=sendingsh
-     mode0=mode
-  endif
-
-  call sleep_msec(100)                  !### was 100
-  go to 10
-
-end subroutine decode1

Deleted: branches/map65/decode1a.f
===================================================================
--- branches/map65/decode1a.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/decode1a.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,110 +0,0 @@
-      subroutine decode1a(dd,newdat,freq,nflip,
-     +         mycall,hiscall,hisgrid,neme,ndepth,nqd,dphi,ndphi,
-     +         ipol,sync2,a,dt,pol,nkv,nhist,qual,decoded)
-
-C  Apply AFC corrections to a candidate JT65 signal, and then try
-C  to decode it.
-
-      parameter (NFFT1=77760,NFFT2=2430)
-      parameter (NMAX=60*96000)          !Samples per 60 s
-      real*4  dd(4,NMAX)                 !92 MB: raw data from Linrad timf2
-      complex c2x(NMAX/4), c2y(NMAX/4)   !After 1/4 filter and downsample
-      complex c3x(NMAX/16),c3y(NMAX/16)  !After 1/16 filter and downsample
-      complex c4x(NMAX/64),c4y(NMAX/64)  !After 1/64 filter and downsample
-      complex cx(NMAX/64), cy(NMAX/64)   !Data at 1378.125 samples/s
-      complex c5x(NMAX/256),c5y(NMAX/256),c5y0(NMAX/256)
-      complex c5a(256),    c5b(256)
-      complex z
-
-      real s2(256,126)
-      real a(5)
-      real*8 samratio
-      logical first
-      character decoded*22
-      character mycall*12,hiscall*12,hisgrid*6
-      data first/.true./,jjjmin/1000/,jjjmax/-1000/
-      save
-
-C  Mix sync tone to baseband, low-pass filter, and decimate by 64
-      dt00=dt
-C  If freq=125.0 kHz, f0=48000 Hz.
-      f0=1000*(freq-77.0)                  !Freq of sync tone (0-96000 Hz)
-      call filbig(dd,NMAX,f0,newdat,cx,cy,n5)
-      joff=0
-      sqa=0.
-      sqb=0.
-      do i=1,n5
-         sqa=sqa + real(cx(i))**2 + aimag(cx(i))**2
-         sqb=sqb + real(cy(i))**2 + aimag(cy(i))**2
-      enddo
-      sqa=sqa/n5
-      sqb=sqb/n5
-
-C  Find best DF, f1, f2, DT, and pol
-
-!      a(5)=dt00
-!      fsample=1378.125
-!      i0=nint((a(5)+0.5)*fsample)
-!      if(i0.lt.1) i0=1
-!      nz=n5+1-i0
-!      call afc65b(cx(i0),cy(i0),nz,fsample,nflip,ipol,a,dt,
-!     +    ccfbest,dtbest)
-
-      call fil6521(cx,n5,c5x,n6)
-      call fil6521(cy,n5,c5y0,n6)
-
-!  Adjust for cable length difference:
-      z=cmplx(cos(dphi),sin(dphi))
-      do i=1,n6
-         c5y(i)=z*c5y0(i)
-      enddo
-
-      fsample=1378.125/4.
-      a(5)=dt00
-      i0=nint((a(5)+0.5)*fsample) - 2
-      if(i0.lt.1) i0=1
-      nz=n6+1-i0
-
-      call afc65b(c5x(i0),c5y(i0),nz,fsample,nflip,ipol,a,dt,
-     +     ccfbest,dtbest)
-
-      pol=a(4)/57.2957795
-      aa=cos(pol)
-      bb=sin(pol)
-      sq0=aa*aa*sqa + bb*bb*sqb
-      sync2=3.7*ccfbest/sq0
-
-C  Apply AFC corrections to the time-domain signal
-      call twkfreq(cx,cy,n5,a)
-
-C  Compute spectrum at best polarization for each half symbol.
-C  Adding or subtracting a small number (e.g., 5) to j may make it decode.
-      nsym=126
-      nfft=256
-      j=(dt00+dtbest+2.685)*1378.125 + joff
-      if(j.lt.0) j=0
-      do k=1,nsym
-         do i=1,nfft
-            j=j+1
-            c5a(i)=aa*cx(j) + bb*cy(j)
-         enddo
-         call four2a(c5a,nfft,1,1,1)
-         do i=1,nfft
-            j=j+1
-            c5b(i)=aa*cx(j) + bb*cy(j)
-         enddo
-         call four2a(c5b,nfft,1,1,1)
-
-         do i=1,256
-            s2(i,k)=real(c5a(i))**2 + aimag(c5a(i))**2 +
-     +           real(c5b(i))**2 + aimag(c5b(i))**2
-         enddo
-      enddo
-
-      flip=nflip
-      call decode65b(s2,flip,mycall,hiscall,hisgrid,neme,ndepth,
-     +    nqd,nkv,nhist,qual,decoded)
-      dt=dt00 + dtbest
-
-      return
-      end

Deleted: branches/map65/decode65b.f
===================================================================
--- branches/map65/decode65b.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/decode65b.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,59 +0,0 @@
-      subroutine decode65b(s2,flip,mycall,hiscall,hisgrid,neme,ndepth,
-     +  nqd,nkv,nhist,qual,decoded)
-
-      real s2(256,126)
-      real s3(64,63)
-      logical first,ltext
-      character decoded*22,deepmsg*22
-      character mycall*12,hiscall*12,hisgrid*6
-!      include 'avecom.h'
-      include 'prcom.h'
-      data first/.true./
-      save
-
-      if(first) call setup65
-      first=.false.
-
-      call setup65
-      do j=1,63
-         k=mdat(j)                       !Points to data symbol
-         if(flip.lt.0.0) k=mdat2(j)
-         do i=1,64
-            s3(i,j)=s2(i+2,k)            !### Check the &quot;i+2&quot; ###
-         enddo
-      enddo
-      mode65=2
-      nadd=mode65
-
-      call extract(s3,nadd,ncount,nhist,decoded,ltext)     !Extract the message
-C  Suppress &quot;birdie messages&quot; and other garbage decodes:
-      if(decoded(1:7).eq.'000AAA ') ncount=-1
-      if(decoded(1:7).eq.'0L6MWK ') ncount=-1
-      if(flip.lt.0.0 .and. ltext) ncount=-1
-      nkv=1
-      if(ncount.lt.0) then 
-         nkv=0
-         decoded='                      '
-      endif
-
-      qual=0.
-
-      if(ndepth.ge.1 .and. (nqd.eq.1 .or. flip.eq.1.0)) then
-         call deep65(s3,mode65,neme,flip,mycall,hiscall,
-     +       hisgrid,deepmsg,qual)
-         if(nqd.ne.1 .and. qual.lt.10.0) qual=0.0
-      endif
-
-C  Save symbol spectra for possible decoding of average.
-!      do j=1,63
-!         k=mdat(j)
-!         if(flip.lt.0.0) k=mdat2(j)
-!         call move(s2(8,k),ppsave(1,j,nsave),64)
-!      enddo
-
-!      endif
-
-      if(nkv.eq.0 .and. qual.ge.1.0) decoded=deepmsg
-
-      return
-      end

Deleted: branches/map65/decode_rs.c
===================================================================
--- branches/map65/decode_rs.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/decode_rs.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,263 +0,0 @@
-/* Reed-Solomon decoder
- * Copyright 2002 Phil Karn, KA9Q
- * May be used under the terms of the GNU General Public License (GPL)
- */
-
-#ifdef DEBUG
-#include &lt;stdio.h&gt;
-#endif
-
-#include &lt;string.h&gt;
-
-#define NULL ((void *)0)
-#define	min(a,b)	((a) &lt; (b) ? (a) : (b))
-
-#ifdef FIXED
-#include &quot;fixed.h&quot;
-#elif defined(BIGSYM)
-#include &quot;int.h&quot;
-#else
-#include &quot;char.h&quot;
-#endif
-
-int DECODE_RS(
-#ifdef FIXED
-DTYPE *data, int *eras_pos, int no_eras,int pad){
-#else
-void *p,DTYPE *data, int *eras_pos, int no_eras){
-  struct rs *rs = (struct rs *)p;
-#endif
-  int deg_lambda, el, deg_omega;
-  int i, j, r,k;
-  DTYPE u,q,tmp,num1,num2,den,discr_r;
-  DTYPE lambda[NROOTS+1], s[NROOTS];	/* Err+Eras Locator poly
-					 * and syndrome poly */
-  DTYPE b[NROOTS+1], t[NROOTS+1], omega[NROOTS+1];
-  DTYPE root[NROOTS], reg[NROOTS+1], loc[NROOTS];
-  int syn_error, count;
-
-#ifdef FIXED
-  /* Check pad parameter for validity */
-  if(pad &lt; 0 || pad &gt;= NN)
-    return -1;
-#endif
-
-  /* form the syndromes; i.e., evaluate data(x) at roots of g(x) */
-  for(i=0;i&lt;NROOTS;i++)
-    s[i] = data[0];
-
-  for(j=1;j&lt;NN-PAD;j++){
-    for(i=0;i&lt;NROOTS;i++){
-      if(s[i] == 0){
-	s[i] = data[j];
-      } else {
-	s[i] = data[j] ^ ALPHA_TO[MODNN(INDEX_OF[s[i]] + (FCR+i)*PRIM)];
-      }
-    }
-  }
-
-  /* Convert syndromes to index form, checking for nonzero condition */
-  syn_error = 0;
-  for(i=0;i&lt;NROOTS;i++){
-    syn_error |= s[i];
-    s[i] = INDEX_OF[s[i]];
-  }
-
-  if (!syn_error) {
-    /* if syndrome is zero, data[] is a codeword and there are no
-     * errors to correct. So return data[] unmodified
-     */
-    count = 0;
-    goto finish;
-  }
-  memset(&amp;lambda[1],0,NROOTS*sizeof(lambda[0]));
-  lambda[0] = 1;
-
-  if (no_eras &gt; 0) {
-    /* Init lambda to be the erasure locator polynomial */
-    lambda[1] = ALPHA_TO[MODNN(PRIM*(NN-1-eras_pos[0]))];
-    for (i = 1; i &lt; no_eras; i++) {
-      u = MODNN(PRIM*(NN-1-eras_pos[i]));
-      for (j = i+1; j &gt; 0; j--) {
-	tmp = INDEX_OF[lambda[j - 1]];
-	if(tmp != A0)
-	  lambda[j] ^= ALPHA_TO[MODNN(u + tmp)];
-      }
-    }
-
-#if DEBUG &gt;= 1
-    /* Test code that verifies the erasure locator polynomial just constructed
-       Needed only for decoder debugging. */
-    
-    /* find roots of the erasure location polynomial */
-    for(i=1;i&lt;=no_eras;i++)
-      reg[i] = INDEX_OF[lambda[i]];
-
-    count = 0;
-    for (i = 1,k=IPRIM-1; i &lt;= NN; i++,k = MODNN(k+IPRIM)) {
-      q = 1;
-      for (j = 1; j &lt;= no_eras; j++)
-	if (reg[j] != A0) {
-	  reg[j] = MODNN(reg[j] + j);
-	  q ^= ALPHA_TO[reg[j]];
-	}
-      if (q != 0)
-	continue;
-      /* store root and error location number indices */
-      root[count] = i;
-      loc[count] = k;
-      count++;
-    }
-    if (count != no_eras) {
-      printf(&quot;count = %d no_eras = %d\n lambda(x) is WRONG\n&quot;,count,no_eras);
-      count = -1;
-      goto finish;
-    }
-#if DEBUG &gt;= 2
-    printf(&quot;\n Erasure positions as determined by roots of Eras Loc Poly:\n&quot;);
-    for (i = 0; i &lt; count; i++)
-      printf(&quot;%d &quot;, loc[i]);
-    printf(&quot;\n&quot;);
-#endif
-#endif
-  }
-  for(i=0;i&lt;NROOTS+1;i++)
-    //    printf(&quot;%d  %d  %d\n&quot;,i,lambda[i],INDEX_OF[lambda[i]]);
-    b[i] = INDEX_OF[lambda[i]];
-  
-  /*
-   * Begin Berlekamp-Massey algorithm to determine error+erasure
-   * locator polynomial
-   */
-  r = no_eras;
-  el = no_eras;
-  while (++r &lt;= NROOTS) {	/* r is the step number */
-    /* Compute discrepancy at the r-th step in poly-form */
-    discr_r = 0;
-    for (i = 0; i &lt; r; i++){
-      if ((lambda[i] != 0) &amp;&amp; (s[r-i-1] != A0)) {
-	discr_r ^= ALPHA_TO[MODNN(INDEX_OF[lambda[i]] + s[r-i-1])];
-      }
-    }
-    discr_r = INDEX_OF[discr_r];	/* Index form */
-    if (discr_r == A0) {
-      /* 2 lines below: B(x) &lt;-- x*B(x) */
-      memmove(&amp;b[1],b,NROOTS*sizeof(b[0]));
-      b[0] = A0;
-    } else {
-      /* 7 lines below: T(x) &lt;-- lambda(x) - discr_r*x*b(x) */
-      t[0] = lambda[0];
-      for (i = 0 ; i &lt; NROOTS; i++) {
-	if(b[i] != A0)
-	  t[i+1] = lambda[i+1] ^ ALPHA_TO[MODNN(discr_r + b[i])];
-	else
-	  t[i+1] = lambda[i+1];
-      }
-      if (2 * el &lt;= r + no_eras - 1) {
-	el = r + no_eras - el;
-	/*
-	 * 2 lines below: B(x) &lt;-- inv(discr_r) *
-	 * lambda(x)
-	 */
-	for (i = 0; i &lt;= NROOTS; i++)
-	  b[i] = (lambda[i] == 0) ? A0 : MODNN(INDEX_OF[lambda[i]] - discr_r + NN);
-      } else {
-	/* 2 lines below: B(x) &lt;-- x*B(x) */
-	memmove(&amp;b[1],b,NROOTS*sizeof(b[0]));
-	b[0] = A0;
-      }
-      memcpy(lambda,t,(NROOTS+1)*sizeof(t[0]));
-    }
-  }
-
-  /* Convert lambda to index form and compute deg(lambda(x)) */
-  deg_lambda = 0;
-  for(i=0;i&lt;NROOTS+1;i++){
-    lambda[i] = INDEX_OF[lambda[i]];
-    if(lambda[i] != A0)
-      deg_lambda = i;
-  }
-  /* Find roots of the error+erasure locator polynomial by Chien search */
-  memcpy(&amp;reg[1],&amp;lambda[1],NROOTS*sizeof(reg[0]));
-  count = 0;		/* Number of roots of lambda(x) */
-  for (i = 1,k=IPRIM-1; i &lt;= NN; i++,k = MODNN(k+IPRIM)) {
-    q = 1; /* lambda[0] is always 0 */
-    for (j = deg_lambda; j &gt; 0; j--){
-      if (reg[j] != A0) {
-	reg[j] = MODNN(reg[j] + j);
-	q ^= ALPHA_TO[reg[j]];
-      }
-    }
-    if (q != 0)
-      continue; /* Not a root */
-    /* store root (index-form) and error location number */
-#if DEBUG&gt;=2
-    printf(&quot;count %d root %d loc %d\n&quot;,count,i,k);
-#endif
-    root[count] = i;
-    loc[count] = k;
-    /* If we've already found max possible roots,
-     * abort the search to save time
-     */
-    if(++count == deg_lambda)
-      break;
-  }
-  if (deg_lambda != count) {
-    /*
-     * deg(lambda) unequal to number of roots =&gt; uncorrectable
-     * error detected
-     */
-    count = -1;
-    goto finish;
-  }
-  /*
-   * Compute err+eras evaluator poly omega(x) = s(x)*lambda(x) (modulo
-   * x**NROOTS). in index form. Also find deg(omega).
-   */
-  deg_omega = deg_lambda-1;
-  for (i = 0; i &lt;= deg_omega;i++){
-    tmp = 0;
-    for(j=i;j &gt;= 0; j--){
-      if ((s[i - j] != A0) &amp;&amp; (lambda[j] != A0))
-	tmp ^= ALPHA_TO[MODNN(s[i - j] + lambda[j])];
-    }
-    omega[i] = INDEX_OF[tmp];
-  }
-
-  /*
-   * Compute error values in poly-form. num1 = omega(inv(X(l))), num2 =
-   * inv(X(l))**(FCR-1) and den = lambda_pr(inv(X(l))) all in poly-form
-   */
-  for (j = count-1; j &gt;=0; j--) {
-    num1 = 0;
-    for (i = deg_omega; i &gt;= 0; i--) {
-      if (omega[i] != A0)
-	num1  ^= ALPHA_TO[MODNN(omega[i] + i * root[j])];
-    }
-    num2 = ALPHA_TO[MODNN(root[j] * (FCR - 1) + NN)];
-    den = 0;
-    
-    /* lambda[i+1] for i even is the formal derivative lambda_pr of lambda[i] */
-    for (i = min(deg_lambda,NROOTS-1) &amp; ~1; i &gt;= 0; i -=2) {
-      if(lambda[i+1] != A0)
-	den ^= ALPHA_TO[MODNN(lambda[i+1] + i * root[j])];
-    }
-#if DEBUG &gt;= 1
-    if (den == 0) {
-      printf(&quot;\n ERROR: denominator = 0\n&quot;);
-      count = -1;
-      goto finish;
-    }
-#endif
-    /* Apply error to data */
-    if (num1 != 0 &amp;&amp; loc[j] &gt;= PAD) {
-      data[loc[j]-PAD] ^= ALPHA_TO[MODNN(INDEX_OF[num1] + INDEX_OF[num2] + NN - INDEX_OF[den])];
-    }
-  }
- finish:
-  if(eras_pos != NULL){
-    for(i=0;i&lt;count;i++)
-      eras_pos[i] = loc[i];
-  }
-  return count;
-}

Deleted: branches/map65/deep65.f
===================================================================
--- branches/map65/deep65.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/deep65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,186 +0,0 @@
-      subroutine deep65(s3,mode65,neme,flip,mycall,hiscall,
-     +  hisgrid,decoded,qual)
-
-      parameter (MAXCALLS=7000,MAXRPT=63)
-      real s3(64,63)
-      character callsign*12,grid*4,message*22,hisgrid*6,c*1,ceme*3
-      character*12 mycall,hiscall
-      character mycall0*12,hiscall0*12,hisgrid0*6
-      character*22 decoded
-      character*22 testmsg(2*MAXCALLS + 2 + MAXRPT)
-      character*15 callgrid(MAXCALLS)
-      character*180 line
-      character*4 rpt(MAXRPT)
-      integer ncode(63,2*MAXCALLS + 2 + MAXRPT)
-      real pp(2*MAXCALLS + 2 + MAXRPT)
-      common/mrscom/ mrs(63),mrs2(63)
-      common/c3com/ mcall3a
-
-      data neme0/-99/
-      data rpt/'-01','-02','-03','-04','-05',
-     +         '-06','-07','-08','-09','-10',
-     +         '-11','-12','-13','-14','-15',
-     +         '-16','-17','-18','-19','-20',
-     +         '-21','-22','-23','-24','-25',
-     +         '-26','-27','-28','-29','-30',
-     +         'R-01','R-02','R-03','R-04','R-05',
-     +         'R-06','R-07','R-08','R-09','R-10',
-     +         'R-11','R-12','R-13','R-14','R-15',
-     +         'R-16','R-17','R-18','R-19','R-20',
-     +         'R-21','R-22','R-23','R-24','R-25',
-     +         'R-26','R-27','R-28','R-29','R-30',
-     +         'RO','RRR','73'/
-      save
-
-      if(mycall.eq.mycall0 .and. hiscall.eq.hiscall0 .and. 
-     +   hisgrid.eq.hisgrid0 .and. mcall3a.eq.0 .and.
-     +   neme.eq.neme0) go to 30
-
-      mcall3a=0
-      call cs_lock('deep65a')
-      rewind 23
-      k=0
-      icall=0
-      do n=1,MAXCALLS
-         if(n.eq.1) then
-            callsign=hiscall
-            do i=4,12
-               if(ichar(callsign(i:i)).eq.0) callsign(i:i)=' '
-            enddo
-            grid=hisgrid(1:4)
-            if(ichar(grid(3:3)).eq.0) grid(3:3)=' '
-            if(ichar(grid(4:4)).eq.0) grid(4:4)=' '
-         else
-            read(23,1002,end=20) line
- 1002       format (A80)
-            if(line(1:4).eq.'ZZZZ') go to 20
-            if(line(1:2).eq.'//') go to 10
-            i1=index(line,',')
-            if(i1.lt.4) go to 10
-            i2=index(line(i1+1:),',')
-            if(i2.lt.5) go to 10
-            i2=i2+i1
-            i3=index(line(i2+1:),',')
-            if(i3.lt.1) i3=index(line(i2+1:),' ')
-            i3=i2+i3
-            callsign=line(1:i1-1)
-            grid=line(i1+1:i2-1)
-            ceme=line(i2+1:i3-1)
-            if(neme.eq.1 .and. ceme.ne.'EME') go to 10
-         endif
-
-         icall=icall+1
-         j1=index(mycall,' ') - 1
-         if(j1.le.-1) j1=12
-         if(j1.lt.3) j1=6
-         j2=index(callsign,' ') - 1
-         if(j2.le.-1) j2=12
-         if(j2.lt.3) j2=6
-         j3=index(mycall,'/')                 ! j3&gt;0 means compound mycall
-         j4=index(callsign,'/')               ! j4&gt;0 means compound hiscall
-         callgrid(icall)=callsign(1:j2)
-
-         mz=1
-! Allow MyCall + HisCall + rpt (?)
-         if(n.eq.1 .and. j3.lt.1 .and. j4.lt.1 .and.
-     +     flip.gt.0.0 .and. callsign(1:6).ne.'      ') mz=MAXRPT+1
-         do m=1,mz
-            if(m.gt.1) grid=rpt(m-1)
-            if(j3.lt.1 .and.j4.lt.1) 
-     +         callgrid(icall)=callsign(1:j2)//' '//grid
-            message=mycall(1:j1)//' '//callgrid(icall)
-            k=k+1
-            testmsg(k)=message
-            call encode65(message,ncode(1,k))
-
-            if(n.ge.2) then
-C  Insert CQ message
-               if(j4.lt.1) callgrid(icall)=callsign(1:j2)//' '//grid
-               message='CQ '//callgrid(icall)
-               k=k+1
-               testmsg(k)=message
-               call encode65(message,ncode(1,k))
-            endif
-         enddo
- 10      continue
-      enddo
-
- 20   continue
-      call cs_unlock
-      ntot=k
-      neme0=neme
-
- 30   mycall0=mycall
-      hiscall0=hiscall
-      hisgrid0=hisgrid
-      modified0=modified
-      ref0=0.
-      do j=1,63
-         ref0=ref0 + s3(mrs(j),j)
-      enddo
-
-      p1=-1.e30
-      p2=-1.e30
-      do k=1,ntot
-         pp(k)=0.
-! Test all messages if flip=+1; skip the CQ messages if flip=-1.
-         if(flip.gt.0.0 .or. testmsg(k)(1:3).ne.'CQ ') then
-            sum=0.
-            ref=ref0
-            do j=1,63
-               i=ncode(j,k)+1
-               sum=sum + s3(i,j)
-               if(i.eq.mrs(j)) then
-                  ref=ref - s3(i,j) + s3(mrs2(j),j)
-               endif
-            enddo
-            p=sum/ref
-            pp(k)=p
-            if(p.gt.p1) then
-               p1=p
-               ip1=k
-            endif
-         endif
-      enddo
-
-      do i=1,ntot
-         if(pp(i).gt.p2 .and. pp(i).ne.p1) p2=pp(i)
-      enddo
-
-C  ### DO NOT REMOVE ### 
-      call cs_lock('deep65b')
-      rewind 77
-      write(77,*) p1,p2
-      call cs_unlock
-
-C  ### Works OK without it (in both Windows and Linux) if compiled 
-C  ### without optimization.  However, in Windows this is a colossal 
-C  ### pain because of the way McMillan Installer wants to run the 
-C  ### compile step.
-
-      if(mode65.eq.1) bias=max(1.12*p2,0.335)
-      if(mode65.eq.2) bias=max(1.08*p2,0.405)
-      if(mode65.ge.4) bias=max(1.04*p2,0.505)
-
-      if(p2.eq.p1 .and. p1.ne.-1.e30) stop 'Error in deep65'
-      qual=100.0*(p1-bias)
-
-      decoded='                      '
-      c=' '
-
-      if(qual.gt.1.0) then
-         if(qual.lt.6.0) c='?'
-         decoded=testmsg(ip1)
-      else
-         qual=0.
-      endif
-      decoded(22:22)=c
-
-C  Make sure everything is upper case.
-      do i=1,22
-         if(decoded(i:i).ge.'a' .and. decoded(i:i).le.'z') 
-     +     decoded(i:i)=char(ichar(decoded(i:i))-32)
-      enddo
-
-      return
-      end

Deleted: branches/map65/deg2grid.f
===================================================================
--- branches/map65/deg2grid.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/deg2grid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,30 +0,0 @@
-      subroutine deg2grid(dlong0,dlat,grid)
-
-      real dlong                        !West longitude (deg)
-      real dlat                         !Latitude (deg)
-      character grid*6
-
-      dlong=dlong0
-      if(dlong.lt.-180.0) dlong=dlong+360.0
-      if(dlong.gt.180.0) dlong=dlong-360.0
-
-C  Convert to units of 5 min of longitude, working east from 180 deg.
-      nlong=60.0*(180.0-dlong)/5.0
-      n1=nlong/240                      !20-degree field
-      n2=(nlong-240*n1)/24              !2 degree square
-      n3=nlong-240*n1-24*n2             !5 minute subsquare
-      grid(1:1)=char(ichar('A')+n1)
-      grid(3:3)=char(ichar('0')+n2)
-      grid(5:5)=char(ichar('a')+n3)
-
-C  Convert to units of 2.5 min of latitude, working north from -90 deg.
-      nlat=60.0*(dlat+90)/2.5
-      n1=nlat/240                       !10-degree field
-      n2=(nlat-240*n1)/24               !1 degree square
-      n3=nlat-240*n1-24*n2              !2.5 minuts subsquare
-      grid(2:2)=char(ichar('A')+n1)
-      grid(4:4)=char(ichar('0')+n2)
-      grid(6:6)=char(ichar('a')+n3)
-
-      return
-      end

Deleted: branches/map65/demod64a.f
===================================================================
--- branches/map65/demod64a.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/demod64a.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,71 +0,0 @@
-      subroutine demod64a(signal,nadd,mrsym,mrprob,
-     +  mr2sym,mr2prob,ntest,nlow)
-
-C  Demodulate the 64-bin spectra for each of 63 symbols in a frame.
-
-C  Parameters
-C     nadd     number of spectra already summed
-C     mrsym    most reliable symbol value
-C     mr2sym   second most likely symbol value
-C     mrprob   probability that mrsym was the transmitted value
-C     mr2prob  probability that mr2sym was the transmitted value
-
-      implicit real*8 (a-h,o-z)
-      real*4 signal(64,63)
-      real*8 fs(64)
-      integer mrsym(63),mrprob(63),mr2sym(63),mr2prob(63)
-      common/mrscom/ mrs(63),mrs2(63)
-
-      afac=1.1 * float(nadd)**0.64
-      scale=255.999
-
-C  Compute average spectral value
-      sum=0.
-      do j=1,63
-         do i=1,64
-            sum=sum+signal(i,j)
-         enddo
-      enddo
-      ave=sum/(64.*63.)
-
-C  Compute probabilities for most reliable symbol values
-      do j=1,63
-         s1=-1.e30
-         fsum=0.
-         do i=1,64
-            x=min(afac*signal(i,j)/ave,50.d0)
-            fs(i)=exp(x)
-            fsum=fsum+fs(i)
-            if(signal(i,j).gt.s1) then
-               s1=signal(i,j)
-               i1=i                              !Most reliable
-            endif
-         enddo
-
-         s2=-1.e30
-         do i=1,64
-            if(i.ne.i1 .and. signal(i,j).gt.s2) then
-               s2=signal(i,j)
-               i2=i                              !Second most reliable
-            endif
-         enddo
-         p1=fs(i1)/fsum                          !Normalized probabilities
-         p2=fs(i2)/fsum
-         mrsym(j)=i1-1
-         mr2sym(j)=i2-1
-         mrprob(j)=scale*p1
-         mr2prob(j)=scale*p2
-         mrs(j)=i1
-         mrs2(j)=i2
-      enddo
-
-      sum=0.
-      nlow=0
-      do j=1,63
-         sum=sum+mrprob(j)
-         if(mrprob(j).le.5) nlow=nlow+1
-      enddo
-      ntest=sum/63
-
-      return
-      end

Deleted: branches/map65/detect.f
===================================================================
--- branches/map65/detect.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/detect.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,29 +0,0 @@
-      subroutine detect(data,npts,f,y)
-
-C  Compute powers at the tone frequencies using 1-sample steps.
-
-      parameter (NZ=11025,NSPD=25)
-      real data(npts)
-      real y(npts)
-      complex c(NZ)
-      complex csum
-      data twopi/6.283185307/
-
-      dpha=twopi*f/11025.0
-      do i=1,npts
-         c(i)=data(i)*cmplx(cos(dpha*i),-sin(dpha*i))
-      enddo
-
-      csum=0.
-      do i=1,NSPD
-         csum=csum+c(i)
-      enddo
-         
-      y(1)=real(csum)**2 + aimag(csum)**2
-      do i=2,npts-(NSPD-1)
-         csum=csum-c(i-1)+c(i+NSPD-1)
-         y(i)=real(csum)**2 + aimag(csum)**2
-      enddo
-
-      return
-      end

Added: branches/map65/devsetup.cpp
===================================================================
--- branches/map65/devsetup.cpp	                        (rev 0)
+++ branches/map65/devsetup.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,325 @@
+#include &quot;devsetup.h&quot;
+#include &quot;mainwindow.h&quot;
+#include &lt;QDebug&gt;
+#include &lt;portaudio.h&gt;
+
+#define MAXDEVICES 100
+
+//----------------------------------------------------------- DevSetup()
+DevSetup::DevSetup(QWidget *parent) :	QDialog(parent)
+{
+  ui.setupUi(this);	//setup the dialog form
+  m_restartSoundIn=false;
+  m_restartSoundOut=false;
+}
+
+DevSetup::~DevSetup()
+{
+}
+
+void DevSetup::initDlg()
+{
+  int k,id;
+  int valid_devices=0;
+  int minChan[MAXDEVICES];
+  int maxChan[MAXDEVICES];
+  int minSpeed[MAXDEVICES];
+  int maxSpeed[MAXDEVICES];
+  char hostAPI_DeviceName[MAXDEVICES][50];
+  char s[60];
+  int numDevices=Pa_GetDeviceCount();
+  getDev(&amp;numDevices,hostAPI_DeviceName,minChan,maxChan,minSpeed,maxSpeed);
+  k=0;
+  for(id=0; id&lt;numDevices; id++)  {
+    if(96000 &gt;= minSpeed[id] &amp;&amp; 96000 &lt;= maxSpeed[id]) {
+      m_inDevList[k]=id;
+      k++;
+      sprintf(s,&quot;%2d   %d  %-49s&quot;,id,maxChan[id],hostAPI_DeviceName[id]);
+      QString t(s);
+      ui.comboBoxSndIn-&gt;addItem(t);
+      valid_devices++;
+    }
+  }
+
+  const PaDeviceInfo *pdi;
+  int nchout;
+  char *p,*p1;
+  char p2[50];
+  char pa_device_name[128];
+  char pa_device_hostapi[128];
+
+  k=0;
+  for(id=0; id&lt;numDevices; id++ )  {
+    pdi=Pa_GetDeviceInfo(id);
+    nchout=pdi-&gt;maxOutputChannels;
+    if(nchout&gt;=2) {
+      m_outDevList[k]=id;
+      k++;
+      sprintf((char*)(pa_device_name),&quot;%s&quot;,pdi-&gt;name);
+      sprintf((char*)(pa_device_hostapi),&quot;%s&quot;,
+              Pa_GetHostApiInfo(pdi-&gt;hostApi)-&gt;name);
+
+      p1=(char*)&quot;&quot;;
+      p=strstr(pa_device_hostapi,&quot;MME&quot;);
+      if(p!=NULL) p1=(char*)&quot;MME&quot;;
+      p=strstr(pa_device_hostapi,&quot;Direct&quot;);
+      if(p!=NULL) p1=(char*)&quot;DirectX&quot;;
+      p=strstr(pa_device_hostapi,&quot;WASAPI&quot;);
+      if(p!=NULL) p1=(char*)&quot;WASAPI&quot;;
+      p=strstr(pa_device_hostapi,&quot;ASIO&quot;);
+      if(p!=NULL) p1=(char*)&quot;ASIO&quot;;
+      p=strstr(pa_device_hostapi,&quot;WDM-KS&quot;);
+      if(p!=NULL) p1=(char*)&quot;WDM-KS&quot;;
+
+      sprintf(p2,&quot;%2d   %-8s  %-39s&quot;,id,p1,pa_device_name);
+      QString t(p2);
+      ui.comboBoxSndOut-&gt;addItem(t);
+    }
+  }
+
+  ui.myCallEntry-&gt;setText(m_myCall);
+  ui.myGridEntry-&gt;setText(m_myGrid);
+  ui.idIntSpinBox-&gt;setValue(m_idInt);
+  ui.pttComboBox-&gt;setCurrentIndex(m_pttPort);
+  ui.astroFont-&gt;setValue(m_astroFont);
+  ui.cbXpol-&gt;setChecked(m_xpol);
+  ui.rbAntennaX-&gt;setChecked(m_xpolx);
+  ui.saveDirEntry-&gt;setText(m_saveDir);
+  ui.azelDirEntry-&gt;setText(m_azelDir);
+  ui.dxccEntry-&gt;setText(m_dxccPfx);
+  ui.timeoutSpinBox-&gt;setValue(m_timeout);
+  ui.dPhiSpinBox-&gt;setValue(m_dPhi);
+  ui.fCalSpinBox-&gt;setValue(m_fCal);
+  ui.faddEntry-&gt;setText(QString::number(m_fAdd,'f',3));
+  ui.networkRadioButton-&gt;setChecked(m_network);
+  ui.soundCardRadioButton-&gt;setChecked(!m_network);
+  ui.rb96000-&gt;setChecked(m_fs96000);
+  ui.rb95238-&gt;setChecked(!m_fs96000);
+  ui.comboBoxSndIn-&gt;setEnabled(!m_network);
+  ui.comboBoxSndIn-&gt;setCurrentIndex(m_nDevIn);
+  ui.comboBoxSndOut-&gt;setCurrentIndex(m_nDevOut);
+  ui.sbPort-&gt;setValue(m_udpPort);
+  ui.cbIQswap-&gt;setChecked(m_IQswap);
+  ui.cb10db-&gt;setChecked(m_10db);
+  ui.cbInitIQplus-&gt;setChecked(m_initIQplus);
+  ui.mult570SpinBox-&gt;setValue(m_mult570);
+  ui.cal570SpinBox-&gt;setValue(m_cal570);
+  sscanf(m_colors.toAscii(),&quot;%2x%2x%2x%2x%2x%2x%2x%2x%2x%2x%2x%2x%2x%2x%2x&quot;,
+         &amp;r,&amp;g,&amp;b,&amp;r0,&amp;g0,&amp;b0,&amp;r1,&amp;g1,&amp;b1,&amp;r2,&amp;g2,&amp;b2,&amp;r3,&amp;g3,&amp;b3);
+  updateColorLabels();
+  ui.sbBackgroundRed-&gt;setValue(r);
+  ui.sbBackgroundGreen-&gt;setValue(g);
+  ui.sbBackgroundBlue-&gt;setValue(b);
+  ui.sbRed0-&gt;setValue(r0);
+  ui.sbRed1-&gt;setValue(r1);
+  ui.sbRed2-&gt;setValue(r2);
+  ui.sbRed3-&gt;setValue(r3);
+  ui.sbGreen0-&gt;setValue(g0);
+  ui.sbGreen1-&gt;setValue(g1);
+  ui.sbGreen2-&gt;setValue(g2);
+  ui.sbGreen3-&gt;setValue(g3);
+  ui.sbBlue0-&gt;setValue(b0);
+  ui.sbBlue1-&gt;setValue(b1);
+  ui.sbBlue2-&gt;setValue(b2);
+  ui.sbBlue3-&gt;setValue(b3);
+
+  m_paInDevice=m_inDevList[m_nDevIn];
+  m_paOutDevice=m_outDevList[m_nDevOut];
+
+}
+
+//------------------------------------------------------- accept()
+void DevSetup::accept()
+{
+  // Called when OK button is clicked.
+  // Check to see whether SoundInThread must be restarted,
+  // and save user parameters.
+
+  if(m_network!=ui.networkRadioButton-&gt;isChecked() or
+     m_nDevIn!=ui.comboBoxSndIn-&gt;currentIndex() or
+     m_paInDevice!=m_inDevList[m_nDevIn] or
+     m_xpol!=ui.cbXpol-&gt;isChecked() or
+     m_udpPort!=ui.sbPort-&gt;value()) m_restartSoundIn=true;
+
+  if(m_nDevOut!=ui.comboBoxSndOut-&gt;currentIndex() or
+     m_paOutDevice!=m_outDevList[m_nDevOut]) m_restartSoundOut=true;
+
+  m_myCall=ui.myCallEntry-&gt;text();
+  m_myGrid=ui.myGridEntry-&gt;text();
+  m_idInt=ui.idIntSpinBox-&gt;value();
+  m_pttPort=ui.pttComboBox-&gt;currentIndex();
+  m_astroFont=ui.astroFont-&gt;value();
+  m_xpol=ui.cbXpol-&gt;isChecked();
+  m_xpolx=ui.rbAntennaX-&gt;isChecked();
+  m_saveDir=ui.saveDirEntry-&gt;text();
+  m_azelDir=ui.azelDirEntry-&gt;text();
+  m_dxccPfx=ui.dxccEntry-&gt;text();
+  m_timeout=ui.timeoutSpinBox-&gt;value();
+  m_dPhi=ui.dPhiSpinBox-&gt;value();
+  m_fCal=ui.fCalSpinBox-&gt;value();
+  m_fAdd=ui.faddEntry-&gt;text().toDouble();
+  m_network=ui.networkRadioButton-&gt;isChecked();
+  m_fs96000=ui.rb96000-&gt;isChecked();
+  m_nDevIn=ui.comboBoxSndIn-&gt;currentIndex();
+  m_paInDevice=m_inDevList[m_nDevIn];
+  m_nDevOut=ui.comboBoxSndOut-&gt;currentIndex();
+  m_paOutDevice=m_outDevList[m_nDevOut];
+  m_udpPort=ui.sbPort-&gt;value();
+  m_IQswap=ui.cbIQswap-&gt;isChecked();
+  m_10db=ui.cb10db-&gt;isChecked();
+  m_initIQplus=ui.cbInitIQplus-&gt;isChecked();
+  m_mult570=ui.mult570SpinBox-&gt;value();
+  m_cal570=ui.cal570SpinBox-&gt;value();
+
+  QDialog::accept();
+}
+
+void DevSetup::on_soundCardRadioButton_toggled(bool checked)
+{
+  ui.comboBoxSndIn-&gt;setEnabled(ui.soundCardRadioButton-&gt;isChecked());
+  ui.rb96000-&gt;setChecked(checked);
+  ui.rb95238-&gt;setEnabled(!checked);
+  ui.label_InputDev-&gt;setEnabled(checked);
+  ui.label_Port-&gt;setEnabled(!checked);
+  ui.sbPort-&gt;setEnabled(!checked);
+  ui.cbIQswap-&gt;setEnabled(checked);
+  ui.cb10db-&gt;setEnabled(checked);
+}
+
+void DevSetup::on_cbXpol_stateChanged(int n)
+{
+  m_xpol = (n!=0);
+  ui.rbAntenna-&gt;setEnabled(m_xpol);
+  ui.rbAntennaX-&gt;setEnabled(m_xpol);
+  ui.dPhiSpinBox-&gt;setEnabled(m_xpol);
+  ui.labelDphi-&gt;setEnabled(m_xpol);
+}
+
+void DevSetup::on_cal570SpinBox_valueChanged(double ppm)
+{
+  m_cal570=ppm;
+}
+
+void DevSetup::on_mult570SpinBox_valueChanged(int mult)
+{
+  m_mult570=mult;
+}
+
+void DevSetup::updateColorLabels()
+{
+  QString t;
+  int r=ui.sbBackgroundRed-&gt;value();
+  int g=ui.sbBackgroundGreen-&gt;value();
+  int b=ui.sbBackgroundBlue-&gt;value();
+  int r0=ui.sbRed0-&gt;value();
+  int r1=ui.sbRed1-&gt;value();
+  int r2=ui.sbRed2-&gt;value();
+  int r3=ui.sbRed3-&gt;value();
+  int g0=ui.sbGreen0-&gt;value();
+  int g1=ui.sbGreen1-&gt;value();
+  int g2=ui.sbGreen2-&gt;value();
+  int g3=ui.sbGreen3-&gt;value();
+  int b0=ui.sbBlue0-&gt;value();
+  int b1=ui.sbBlue1-&gt;value();
+  int b2=ui.sbBlue2-&gt;value();
+  int b3=ui.sbBlue3-&gt;value();
+
+  t.sprintf(&quot;QLabel{background-color: #%2.2x%2.2x%2.2x;&quot;
+            &quot;color: #%2.2x%2.2x%2.2x}&quot;,r,g,b,r0,g0,b0);
+  ui.lab0-&gt;setStyleSheet(t);
+  t.sprintf(&quot;QLabel{background-color: #%2.2x%2.2x%2.2x;&quot;
+            &quot;color: #%2.2x%2.2x%2.2x}&quot;,r,g,b,r1,g1,b1);
+  ui.lab1-&gt;setStyleSheet(t);
+  t.sprintf(&quot;QLabel{background-color: #%2.2x%2.2x%2.2x;&quot;
+            &quot;color: #%2.2x%2.2x%2.2x}&quot;,r,g,b,r2,g2,b2);
+  ui.lab2-&gt;setStyleSheet(t);
+  t.sprintf(&quot;QLabel{background-color: #%2.2x%2.2x%2.2x;&quot;
+            &quot;color: #%2.2x%2.2x%2.2x}&quot;,r,g,b,r3,g3,b3);
+  ui.lab3-&gt;setStyleSheet(t);
+
+  m_colors.sprintf(&quot;%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x&quot;
+            &quot;%2.2x%2.2x%2.2x&quot;,r,g,b,r0,g0,b0,r1,g1,b1,r2,g2,b2,r3,g3,b3);
+}
+
+void DevSetup::on_sbBackgroundRed_valueChanged(int r)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_sbBackgroundGreen_valueChanged(int g)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_sbBackgroundBlue_valueChanged(int b)
+{
+  updateColorLabels();
+}
+
+
+void DevSetup::on_sbRed0_valueChanged(int arg1)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_sbGreen0_valueChanged(int arg1)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_sbBlue0_valueChanged(int arg1)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_sbRed1_valueChanged(int arg1)
+{
+   updateColorLabels();
+}
+
+void DevSetup::on_sbGreen1_valueChanged(int arg1)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_sbBlue1_valueChanged(int arg1)
+{
+   updateColorLabels();
+}
+
+void DevSetup::on_sbRed2_valueChanged(int arg1)
+{
+   updateColorLabels();
+}
+
+void DevSetup::on_sbGreen2_valueChanged(int arg1)
+{
+   updateColorLabels();
+}
+
+void DevSetup::on_sbBlue2_valueChanged(int arg1)
+{
+   updateColorLabels();
+}
+
+void DevSetup::on_sbRed3_valueChanged(int arg1)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_sbGreen3_valueChanged(int arg1)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_sbBlue3_valueChanged(int arg1)
+{
+  updateColorLabels();
+}
+
+void DevSetup::on_pushButton_5_clicked()
+{
+  QColor color = QColorDialog::getColor(Qt::green, this);
+  if (color.isValid()) {
+  }
+}

Added: branches/map65/devsetup.h
===================================================================
--- branches/map65/devsetup.h	                        (rev 0)
+++ branches/map65/devsetup.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,83 @@
+#ifndef DEVSETUP_H
+#define DEVSETUP_H
+
+#include &lt;QDialog&gt;
+#include &quot;ui_devsetup.h&quot;
+
+class DevSetup : public QDialog
+{
+  Q_OBJECT
+public:
+  DevSetup(QWidget *parent=0);
+  ~DevSetup();
+
+  void initDlg();
+  qint32  m_idInt;
+  qint32  m_pttPort;
+  qint32  m_nDevIn;
+  qint32  m_nDevOut;
+  qint32  m_inDevList[100];
+  qint32  m_outDevList[100];
+  qint32  m_paInDevice;
+  qint32  m_paOutDevice;
+  qint32  m_timeout;
+  qint32  m_dPhi;
+  qint32  m_fCal;
+  qint32  m_udpPort;
+  qint32  m_astroFont;
+  qint32  m_mult570;
+
+  double  m_fAdd;
+  double  m_cal570;
+
+  bool    m_xpolx;
+  bool    m_network;
+  bool    m_fs96000;
+  bool    m_xpol;
+  bool    m_IQswap;
+  bool    m_restartSoundIn;
+  bool    m_restartSoundOut;
+  bool    m_10db;
+  bool    m_initIQplus;
+
+  QString m_myCall;
+  QString m_myGrid;
+  QString m_saveDir;
+  QString m_azelDir;
+  QString m_dxccPfx;
+  QString m_colors;
+
+  QColor  m_colorBackground;
+
+public slots:
+  void accept();
+
+private slots:
+  void on_soundCardRadioButton_toggled(bool checked);
+  void on_cbXpol_stateChanged(int arg1);
+  void on_cal570SpinBox_valueChanged(double ppm);
+  void on_mult570SpinBox_valueChanged(int mult);
+  void on_sbBackgroundRed_valueChanged(int arg1);
+  void on_sbBackgroundGreen_valueChanged(int arg1);
+  void on_sbBackgroundBlue_valueChanged(int arg1);
+  void updateColorLabels(void);
+  void on_sbRed0_valueChanged(int arg1);
+  void on_sbGreen0_valueChanged(int arg1);
+  void on_sbBlue0_valueChanged(int arg1);
+  void on_sbRed1_valueChanged(int arg1);
+  void on_sbGreen1_valueChanged(int arg1);
+  void on_sbBlue1_valueChanged(int arg1);
+  void on_sbRed2_valueChanged(int arg1);
+  void on_sbGreen2_valueChanged(int arg1);
+  void on_sbBlue2_valueChanged(int arg1);
+  void on_sbRed3_valueChanged(int arg1);
+  void on_sbGreen3_valueChanged(int arg1);
+  void on_sbBlue3_valueChanged(int arg1);
+  void on_pushButton_5_clicked();
+
+private:
+  int r,g,b,r0,g0,b0,r1,g1,b1,r2,g2,b2,r3,g3,b3;
+  Ui::DialogSndCard ui;
+};
+
+#endif // DEVSETUP_H

Added: branches/map65/devsetup.ui
===================================================================
--- branches/map65/devsetup.ui	                        (rev 0)
+++ branches/map65/devsetup.ui	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,1583 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;class&gt;DialogSndCard&lt;/class&gt;
+ &lt;widget class=&quot;QDialog&quot; name=&quot;DialogSndCard&quot;&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;392&lt;/width&gt;
+    &lt;height&gt;379&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;Setup&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_2&quot;&gt;
+   &lt;item&gt;
+    &lt;widget class=&quot;QTabWidget&quot; name=&quot;ioTabWidget&quot;&gt;
+     &lt;property name=&quot;currentIndex&quot;&gt;
+      &lt;number&gt;0&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;widget class=&quot;QWidget&quot; name=&quot;tab&quot;&gt;
+      &lt;attribute name=&quot;title&quot;&gt;
+       &lt;string&gt;Station&lt;/string&gt;
+      &lt;/attribute&gt;
+      &lt;widget class=&quot;QWidget&quot; name=&quot;layoutWidget&quot;&gt;
+       &lt;property name=&quot;geometry&quot;&gt;
+        &lt;rect&gt;
+         &lt;x&gt;12&lt;/x&gt;
+         &lt;y&gt;33&lt;/y&gt;
+         &lt;width&gt;348&lt;/width&gt;
+         &lt;height&gt;267&lt;/height&gt;
+        &lt;/rect&gt;
+       &lt;/property&gt;
+       &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_6&quot;&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_2&quot;&gt;
+          &lt;item&gt;
+           &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout&quot;&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;My Call:&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_2&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;My Grid:&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_3&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;ID Interval (min):&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_4&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;PTT Port:&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_7&quot;&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Astro Font Size:&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_3&quot;&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;myCallEntry&quot;&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;60&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;K1JT&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;myGridEntry&quot;&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;60&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;FN20qi&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QSpinBox&quot; name=&quot;idIntSpinBox&quot;&gt;
+              &lt;property name=&quot;minimum&quot;&gt;
+               &lt;number&gt;-20&lt;/number&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximum&quot;&gt;
+               &lt;number&gt;10&lt;/number&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QComboBox&quot; name=&quot;pttComboBox&quot;&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;60&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;editable&quot;&gt;
+               &lt;bool&gt;false&lt;/bool&gt;
+              &lt;/property&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;None&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM1&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM2&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM3&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM4&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM5&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM6&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM7&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM8&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM9&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM10&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM11&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM12&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;property name=&quot;text&quot;&gt;
+                &lt;string&gt;COM13&lt;/string&gt;
+               &lt;/property&gt;
+              &lt;/item&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QSpinBox&quot; name=&quot;astroFont&quot;&gt;
+              &lt;property name=&quot;minimum&quot;&gt;
+               &lt;number&gt;12&lt;/number&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximum&quot;&gt;
+               &lt;number&gt;32&lt;/number&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;value&quot;&gt;
+               &lt;number&gt;20&lt;/number&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_2&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;40&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_4&quot;&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_5&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;DXCC:&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_8&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Timeout (min):&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_9&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Fcal (Hz):&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_11&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Fadd (MHz)&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;spacer name=&quot;verticalSpacer&quot;&gt;
+              &lt;property name=&quot;orientation&quot;&gt;
+               &lt;enum&gt;Qt::Vertical&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeType&quot;&gt;
+               &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/spacer&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_5&quot;&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;dxccEntry&quot;&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;16777215&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;PJ9&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QSpinBox&quot; name=&quot;timeoutSpinBox&quot;&gt;
+              &lt;property name=&quot;maximum&quot;&gt;
+               &lt;number&gt;20&lt;/number&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QSpinBox&quot; name=&quot;fCalSpinBox&quot;&gt;
+              &lt;property name=&quot;minimum&quot;&gt;
+               &lt;number&gt;-2000&lt;/number&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximum&quot;&gt;
+               &lt;number&gt;2000&lt;/number&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;faddEntry&quot;&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;0.0&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;spacer name=&quot;verticalSpacer_3&quot;&gt;
+              &lt;property name=&quot;orientation&quot;&gt;
+               &lt;enum&gt;Qt::Vertical&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeType&quot;&gt;
+               &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/spacer&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QGroupBox&quot; name=&quot;antennaGroupBox&quot;&gt;
+          &lt;property name=&quot;sizePolicy&quot;&gt;
+           &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Maximum&quot;&gt;
+            &lt;horstretch&gt;0&lt;/horstretch&gt;
+            &lt;verstretch&gt;0&lt;/verstretch&gt;
+           &lt;/sizepolicy&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;minimumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;0&lt;/width&gt;
+            &lt;height&gt;55&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;title&quot;&gt;
+           &lt;string&gt;Antennas:&lt;/string&gt;
+          &lt;/property&gt;
+          &lt;widget class=&quot;QWidget&quot; name=&quot;layoutWidget_1&quot;&gt;
+           &lt;property name=&quot;geometry&quot;&gt;
+            &lt;rect&gt;
+             &lt;x&gt;10&lt;/x&gt;
+             &lt;y&gt;23&lt;/y&gt;
+             &lt;width&gt;321&lt;/width&gt;
+             &lt;height&gt;22&lt;/height&gt;
+            &lt;/rect&gt;
+           &lt;/property&gt;
+           &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_5&quot;&gt;
+            &lt;item&gt;
+             &lt;spacer name=&quot;horizontalSpacer_10&quot;&gt;
+              &lt;property name=&quot;orientation&quot;&gt;
+               &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;40&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/spacer&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbXpol&quot;&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Xpol&lt;/string&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;checked&quot;&gt;
+               &lt;bool&gt;true&lt;/bool&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;spacer name=&quot;horizontalSpacer_9&quot;&gt;
+              &lt;property name=&quot;orientation&quot;&gt;
+               &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeType&quot;&gt;
+               &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;40&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/spacer&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QRadioButton&quot; name=&quot;rbAntenna&quot;&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;+&lt;/string&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;checked&quot;&gt;
+               &lt;bool&gt;true&lt;/bool&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QRadioButton&quot; name=&quot;rbAntennaX&quot;&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;x&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;spacer name=&quot;horizontalSpacer_3&quot;&gt;
+              &lt;property name=&quot;orientation&quot;&gt;
+               &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeType&quot;&gt;
+               &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;40&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/spacer&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;labelDphi&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Dphi:&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QSpinBox&quot; name=&quot;dPhiSpinBox&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimum&quot;&gt;
+               &lt;number&gt;-90&lt;/number&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximum&quot;&gt;
+               &lt;number&gt;90&lt;/number&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;singleStep&quot;&gt;
+               &lt;number&gt;10&lt;/number&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;spacer name=&quot;horizontalSpacer_4&quot;&gt;
+              &lt;property name=&quot;orientation&quot;&gt;
+               &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;40&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/spacer&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/widget&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_3&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_10&quot;&gt;
+            &lt;property name=&quot;minimumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;75&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Save Directory:&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLineEdit&quot; name=&quot;saveDirEntry&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;C:\Users\joe\wsjt\map65\save&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_4&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_6&quot;&gt;
+            &lt;property name=&quot;minimumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;75&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;AzEl Directory:&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLineEdit&quot; name=&quot;azelDirEntry&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;C:\Users\joe\wsjt\map65&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+       &lt;/layout&gt;
+      &lt;/widget&gt;
+     &lt;/widget&gt;
+     &lt;widget class=&quot;QWidget&quot; name=&quot;tab_2&quot;&gt;
+      &lt;attribute name=&quot;title&quot;&gt;
+       &lt;string&gt;I/O Devices&lt;/string&gt;
+      &lt;/attribute&gt;
+      &lt;widget class=&quot;QWidget&quot; name=&quot;layoutWidget_2&quot;&gt;
+       &lt;property name=&quot;geometry&quot;&gt;
+        &lt;rect&gt;
+         &lt;x&gt;0&lt;/x&gt;
+         &lt;y&gt;10&lt;/y&gt;
+         &lt;width&gt;361&lt;/width&gt;
+         &lt;height&gt;291&lt;/height&gt;
+        &lt;/rect&gt;
+       &lt;/property&gt;
+       &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_8&quot;&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QGroupBox&quot; name=&quot;groupBox_2&quot;&gt;
+          &lt;property name=&quot;title&quot;&gt;
+           &lt;string&gt;Input Source (Rx, Baseband)&lt;/string&gt;
+          &lt;/property&gt;
+          &lt;widget class=&quot;QWidget&quot; name=&quot;layoutWidget_3&quot;&gt;
+           &lt;property name=&quot;geometry&quot;&gt;
+            &lt;rect&gt;
+             &lt;x&gt;13&lt;/x&gt;
+             &lt;y&gt;14&lt;/y&gt;
+             &lt;width&gt;341&lt;/width&gt;
+             &lt;height&gt;211&lt;/height&gt;
+            &lt;/rect&gt;
+           &lt;/property&gt;
+           &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_7&quot;&gt;
+            &lt;item&gt;
+             &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout&quot;&gt;
+              &lt;item&gt;
+               &lt;widget class=&quot;QRadioButton&quot; name=&quot;soundCardRadioButton&quot;&gt;
+                &lt;property name=&quot;enabled&quot;&gt;
+                 &lt;bool&gt;true&lt;/bool&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;text&quot;&gt;
+                 &lt;string&gt;SoundCard&lt;/string&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;checked&quot;&gt;
+                 &lt;bool&gt;false&lt;/bool&gt;
+                &lt;/property&gt;
+               &lt;/widget&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;spacer name=&quot;horizontalSpacer&quot;&gt;
+                &lt;property name=&quot;orientation&quot;&gt;
+                 &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+                 &lt;size&gt;
+                  &lt;width&gt;40&lt;/width&gt;
+                  &lt;height&gt;20&lt;/height&gt;
+                 &lt;/size&gt;
+                &lt;/property&gt;
+               &lt;/spacer&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;widget class=&quot;QRadioButton&quot; name=&quot;networkRadioButton&quot;&gt;
+                &lt;property name=&quot;text&quot;&gt;
+                 &lt;string&gt;Network&lt;/string&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;checked&quot;&gt;
+                 &lt;bool&gt;true&lt;/bool&gt;
+                &lt;/property&gt;
+               &lt;/widget&gt;
+              &lt;/item&gt;
+             &lt;/layout&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_8&quot;&gt;
+              &lt;item&gt;
+               &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbIQswap&quot;&gt;
+                &lt;property name=&quot;enabled&quot;&gt;
+                 &lt;bool&gt;false&lt;/bool&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;minimumSize&quot;&gt;
+                 &lt;size&gt;
+                  &lt;width&gt;0&lt;/width&gt;
+                  &lt;height&gt;20&lt;/height&gt;
+                 &lt;/size&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;text&quot;&gt;
+                 &lt;string&gt;Swap I/Q&lt;/string&gt;
+                &lt;/property&gt;
+               &lt;/widget&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;widget class=&quot;QCheckBox&quot; name=&quot;cb10db&quot;&gt;
+                &lt;property name=&quot;enabled&quot;&gt;
+                 &lt;bool&gt;false&lt;/bool&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;text&quot;&gt;
+                 &lt;string&gt;+10 dB&lt;/string&gt;
+                &lt;/property&gt;
+               &lt;/widget&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;spacer name=&quot;horizontalSpacer_11&quot;&gt;
+                &lt;property name=&quot;orientation&quot;&gt;
+                 &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+                 &lt;size&gt;
+                  &lt;width&gt;40&lt;/width&gt;
+                  &lt;height&gt;20&lt;/height&gt;
+                 &lt;/size&gt;
+                &lt;/property&gt;
+               &lt;/spacer&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbPort&quot;&gt;
+                &lt;property name=&quot;minimumSize&quot;&gt;
+                 &lt;size&gt;
+                  &lt;width&gt;57&lt;/width&gt;
+                  &lt;height&gt;0&lt;/height&gt;
+                 &lt;/size&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;minimum&quot;&gt;
+                 &lt;number&gt;20000&lt;/number&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;maximum&quot;&gt;
+                 &lt;number&gt;51000&lt;/number&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;value&quot;&gt;
+                 &lt;number&gt;50004&lt;/number&gt;
+                &lt;/property&gt;
+               &lt;/widget&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;widget class=&quot;QLabel&quot; name=&quot;label_Port&quot;&gt;
+                &lt;property name=&quot;sizePolicy&quot;&gt;
+                 &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                  &lt;horstretch&gt;0&lt;/horstretch&gt;
+                  &lt;verstretch&gt;0&lt;/verstretch&gt;
+                 &lt;/sizepolicy&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;minimumSize&quot;&gt;
+                 &lt;size&gt;
+                  &lt;width&gt;26&lt;/width&gt;
+                  &lt;height&gt;0&lt;/height&gt;
+                 &lt;/size&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;maximumSize&quot;&gt;
+                 &lt;size&gt;
+                  &lt;width&gt;16777215&lt;/width&gt;
+                  &lt;height&gt;20&lt;/height&gt;
+                 &lt;/size&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;text&quot;&gt;
+                 &lt;string&gt;Port&lt;/string&gt;
+                &lt;/property&gt;
+               &lt;/widget&gt;
+              &lt;/item&gt;
+             &lt;/layout&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;label_InputDev&quot;&gt;
+              &lt;property name=&quot;enabled&quot;&gt;
+               &lt;bool&gt;false&lt;/bool&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;0&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Dev Ch API      Name&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_7&quot;&gt;
+              &lt;item&gt;
+               &lt;widget class=&quot;QComboBox&quot; name=&quot;comboBoxSndIn&quot;&gt;
+                &lt;property name=&quot;enabled&quot;&gt;
+                 &lt;bool&gt;false&lt;/bool&gt;
+                &lt;/property&gt;
+               &lt;/widget&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;spacer name=&quot;horizontalSpacer_8&quot;&gt;
+                &lt;property name=&quot;orientation&quot;&gt;
+                 &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;sizeType&quot;&gt;
+                 &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+                &lt;/property&gt;
+                &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+                 &lt;size&gt;
+                  &lt;width&gt;50&lt;/width&gt;
+                  &lt;height&gt;13&lt;/height&gt;
+                 &lt;/size&gt;
+                &lt;/property&gt;
+               &lt;/spacer&gt;
+              &lt;/item&gt;
+             &lt;/layout&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;spacer name=&quot;verticalSpacer_2&quot;&gt;
+              &lt;property name=&quot;orientation&quot;&gt;
+               &lt;enum&gt;Qt::Vertical&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeType&quot;&gt;
+               &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;13&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/spacer&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QGroupBox&quot; name=&quot;groupBox_3&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Maximum&quot;&gt;
+                &lt;horstretch&gt;0&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;16777215&lt;/width&gt;
+                &lt;height&gt;60&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;title&quot;&gt;
+               &lt;string&gt;Sample Rate&lt;/string&gt;
+              &lt;/property&gt;
+              &lt;widget class=&quot;QWidget&quot; name=&quot;layoutWidget_4&quot;&gt;
+               &lt;property name=&quot;geometry&quot;&gt;
+                &lt;rect&gt;
+                 &lt;x&gt;30&lt;/x&gt;
+                 &lt;y&gt;20&lt;/y&gt;
+                 &lt;width&gt;282&lt;/width&gt;
+                 &lt;height&gt;22&lt;/height&gt;
+                &lt;/rect&gt;
+               &lt;/property&gt;
+               &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_6&quot;&gt;
+                &lt;item&gt;
+                 &lt;spacer name=&quot;horizontalSpacer_5&quot;&gt;
+                  &lt;property name=&quot;orientation&quot;&gt;
+                   &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;40&lt;/width&gt;
+                    &lt;height&gt;20&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                 &lt;/spacer&gt;
+                &lt;/item&gt;
+                &lt;item&gt;
+                 &lt;widget class=&quot;QRadioButton&quot; name=&quot;rb96000&quot;&gt;
+                  &lt;property name=&quot;text&quot;&gt;
+                   &lt;string&gt;96000 Hz&lt;/string&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;checked&quot;&gt;
+                   &lt;bool&gt;true&lt;/bool&gt;
+                  &lt;/property&gt;
+                 &lt;/widget&gt;
+                &lt;/item&gt;
+                &lt;item&gt;
+                 &lt;spacer name=&quot;horizontalSpacer_6&quot;&gt;
+                  &lt;property name=&quot;orientation&quot;&gt;
+                   &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;40&lt;/width&gt;
+                    &lt;height&gt;20&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                 &lt;/spacer&gt;
+                &lt;/item&gt;
+                &lt;item&gt;
+                 &lt;widget class=&quot;QRadioButton&quot; name=&quot;rb95238&quot;&gt;
+                  &lt;property name=&quot;text&quot;&gt;
+                   &lt;string&gt;95238 Hz&lt;/string&gt;
+                  &lt;/property&gt;
+                 &lt;/widget&gt;
+                &lt;/item&gt;
+                &lt;item&gt;
+                 &lt;spacer name=&quot;horizontalSpacer_7&quot;&gt;
+                  &lt;property name=&quot;orientation&quot;&gt;
+                   &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;40&lt;/width&gt;
+                    &lt;height&gt;20&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                 &lt;/spacer&gt;
+                &lt;/item&gt;
+               &lt;/layout&gt;
+              &lt;/widget&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/widget&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QGroupBox&quot; name=&quot;groupBox&quot;&gt;
+          &lt;property name=&quot;sizePolicy&quot;&gt;
+           &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Preferred&quot;&gt;
+            &lt;horstretch&gt;0&lt;/horstretch&gt;
+            &lt;verstretch&gt;0&lt;/verstretch&gt;
+           &lt;/sizepolicy&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;maximumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;16777215&lt;/width&gt;
+            &lt;height&gt;55&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;title&quot;&gt;
+           &lt;string&gt;Output Device (Tx Audio)&lt;/string&gt;
+          &lt;/property&gt;
+          &lt;widget class=&quot;QComboBox&quot; name=&quot;comboBoxSndOut&quot;&gt;
+           &lt;property name=&quot;geometry&quot;&gt;
+            &lt;rect&gt;
+             &lt;x&gt;10&lt;/x&gt;
+             &lt;y&gt;20&lt;/y&gt;
+             &lt;width&gt;291&lt;/width&gt;
+             &lt;height&gt;22&lt;/height&gt;
+            &lt;/rect&gt;
+           &lt;/property&gt;
+          &lt;/widget&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+       &lt;/layout&gt;
+      &lt;/widget&gt;
+     &lt;/widget&gt;
+     &lt;widget class=&quot;QWidget&quot; name=&quot;tab_3&quot;&gt;
+      &lt;attribute name=&quot;title&quot;&gt;
+       &lt;string&gt;Si570&lt;/string&gt;
+      &lt;/attribute&gt;
+      &lt;widget class=&quot;QWidget&quot; name=&quot;&quot;&gt;
+       &lt;property name=&quot;geometry&quot;&gt;
+        &lt;rect&gt;
+         &lt;x&gt;70&lt;/x&gt;
+         &lt;y&gt;90&lt;/y&gt;
+         &lt;width&gt;228&lt;/width&gt;
+         &lt;height&gt;111&lt;/height&gt;
+        &lt;/rect&gt;
+       &lt;/property&gt;
+       &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_9&quot;&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_9&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_12&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Frequency multiplier:&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_12&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;47&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;mult570SpinBox&quot;&gt;
+            &lt;property name=&quot;minimum&quot;&gt;
+             &lt;number&gt;1&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;8&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;2&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_10&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_13&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Frequency correction (ppm):&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_13&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;10&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QDoubleSpinBox&quot; name=&quot;cal570SpinBox&quot;&gt;
+            &lt;property name=&quot;decimals&quot;&gt;
+             &lt;number&gt;3&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;minimum&quot;&gt;
+             &lt;double&gt;-100.000000000000000&lt;/double&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;double&gt;100.000000000000000&lt;/double&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbInitIQplus&quot;&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;Initialize IQ+  on startup&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+       &lt;/layout&gt;
+      &lt;/widget&gt;
+     &lt;/widget&gt;
+     &lt;widget class=&quot;QWidget&quot; name=&quot;tab_4&quot;&gt;
+      &lt;attribute name=&quot;title&quot;&gt;
+       &lt;string&gt;Colors&lt;/string&gt;
+      &lt;/attribute&gt;
+      &lt;widget class=&quot;QWidget&quot; name=&quot;layoutWidget_5&quot;&gt;
+       &lt;property name=&quot;geometry&quot;&gt;
+        &lt;rect&gt;
+         &lt;x&gt;12&lt;/x&gt;
+         &lt;y&gt;21&lt;/y&gt;
+         &lt;width&gt;351&lt;/width&gt;
+         &lt;height&gt;281&lt;/height&gt;
+        &lt;/rect&gt;
+       &lt;/property&gt;
+       &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_10&quot;&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QLabel&quot; name=&quot;label_14&quot;&gt;
+          &lt;property name=&quot;font&quot;&gt;
+           &lt;font&gt;
+            &lt;pointsize&gt;10&lt;/pointsize&gt;
+           &lt;/font&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;Choose colors for Band Map and Messages Windows&lt;/string&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;alignment&quot;&gt;
+           &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_17&quot;&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_17&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;80&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_20&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Red&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_19&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;31&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_21&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Green&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_20&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;34&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_22&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Blue&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_18&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;80&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_11&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_15&quot;&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;60&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Background&lt;/string&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;alignment&quot;&gt;
+             &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbBackgroundRed&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbBackgroundGreen&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbBackgroundBlue&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;102&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_14&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;55&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_12&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_16&quot;&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;60&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Newest&lt;/string&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;alignment&quot;&gt;
+             &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbRed0&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbGreen0&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbBlue0&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;lab0&quot;&gt;
+            &lt;property name=&quot;sizePolicy&quot;&gt;
+             &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Preferred&quot;&gt;
+              &lt;horstretch&gt;0&lt;/horstretch&gt;
+              &lt;verstretch&gt;0&lt;/verstretch&gt;
+             &lt;/sizepolicy&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;50&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;font&quot;&gt;
+             &lt;font&gt;
+              &lt;family&gt;Courier New&lt;/family&gt;
+              &lt;pointsize&gt;9&lt;/pointsize&gt;
+             &lt;/font&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt; K1ABC&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_13&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_17&quot;&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;60&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;2nd&lt;/string&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;alignment&quot;&gt;
+             &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbRed1&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbGreen1&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbBlue1&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;lab1&quot;&gt;
+            &lt;property name=&quot;sizePolicy&quot;&gt;
+             &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Preferred&quot;&gt;
+              &lt;horstretch&gt;0&lt;/horstretch&gt;
+              &lt;verstretch&gt;0&lt;/verstretch&gt;
+             &lt;/sizepolicy&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;50&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;font&quot;&gt;
+             &lt;font&gt;
+              &lt;family&gt;Courier New&lt;/family&gt;
+              &lt;pointsize&gt;9&lt;/pointsize&gt;
+             &lt;/font&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt; K1ABC&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_14&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_18&quot;&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;60&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;3rd&lt;/string&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;alignment&quot;&gt;
+             &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbRed2&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;150&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbGreen2&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;150&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbBlue2&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;150&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;lab2&quot;&gt;
+            &lt;property name=&quot;sizePolicy&quot;&gt;
+             &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Preferred&quot;&gt;
+              &lt;horstretch&gt;0&lt;/horstretch&gt;
+              &lt;verstretch&gt;0&lt;/verstretch&gt;
+             &lt;/sizepolicy&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;50&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;font&quot;&gt;
+             &lt;font&gt;
+              &lt;family&gt;Courier New&lt;/family&gt;
+              &lt;pointsize&gt;9&lt;/pointsize&gt;
+             &lt;/font&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt; K1ABC&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_15&quot;&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;label_19&quot;&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;60&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Oldest&lt;/string&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;alignment&quot;&gt;
+             &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbRed3&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;100&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbGreen3&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;100&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSpinBox&quot; name=&quot;sbBlue3&quot;&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;255&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;100&lt;/number&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;lab3&quot;&gt;
+            &lt;property name=&quot;sizePolicy&quot;&gt;
+             &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Preferred&quot;&gt;
+              &lt;horstretch&gt;0&lt;/horstretch&gt;
+              &lt;verstretch&gt;0&lt;/verstretch&gt;
+             &lt;/sizepolicy&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;50&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;font&quot;&gt;
+             &lt;font&gt;
+              &lt;family&gt;Courier New&lt;/family&gt;
+              &lt;pointsize&gt;9&lt;/pointsize&gt;
+             &lt;/font&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt; K1ABC&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_16&quot;&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_15&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;40&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QPushButton&quot; name=&quot;pushButton_5&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Color Selector&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;horizontalSpacer_16&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;40&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+       &lt;/layout&gt;
+      &lt;/widget&gt;
+     &lt;/widget&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item&gt;
+    &lt;widget class=&quot;QDialogButtonBox&quot; name=&quot;buttonBox&quot;&gt;
+     &lt;property name=&quot;orientation&quot;&gt;
+      &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;standardButtons&quot;&gt;
+      &lt;set&gt;QDialogButtonBox::Cancel|QDialogButtonBox::Ok&lt;/set&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+  &lt;/layout&gt;
+ &lt;/widget&gt;
+ &lt;resources/&gt;
+ &lt;connections&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;accepted()&lt;/signal&gt;
+   &lt;receiver&gt;DialogSndCard&lt;/receiver&gt;
+   &lt;slot&gt;accept()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot;&gt;
+     &lt;x&gt;248&lt;/x&gt;
+     &lt;y&gt;254&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot;&gt;
+     &lt;x&gt;157&lt;/x&gt;
+     &lt;y&gt;274&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;rejected()&lt;/signal&gt;
+   &lt;receiver&gt;DialogSndCard&lt;/receiver&gt;
+   &lt;slot&gt;reject()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot;&gt;
+     &lt;x&gt;316&lt;/x&gt;
+     &lt;y&gt;260&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot;&gt;
+     &lt;x&gt;286&lt;/x&gt;
+     &lt;y&gt;274&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+ &lt;/connections&gt;
+&lt;/ui&gt;

Deleted: branches/map65/display.f90
===================================================================
--- branches/map65/display.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/display.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,174 +0,0 @@
-subroutine display(nkeep)
-
-#ifdef CVF
-  use dfport
-#endif
-
-  parameter (MAXLINES=500,MX=500)
-  integer indx(MAXLINES),indx2(MX)
-  character*81 line(MAXLINES),line2(MX),line3(MAXLINES)
-  character out*50,cfreq0*3
-  character*6 callsign,callsign0
-  character*12 freqcall(100)
-  character*40 bm2
-  real freqkHz(MAXLINES)
-  integer utc(MAXLINES),utc2(MX),utcz
-  real*8 f0
-
-  call cs_lock('display')
-  ftol=0.02
-  rewind 26
-
-  do i=1,MAXLINES
-     read(26,1010,end=10) line(i)
-1010 format(a80)
-     read(line(i),1020) f0,ndf,nh,nm
-1020 format(f7.3,i5,26x,i3,i2)
-     utc(i)=60*nh + nm
-     freqkHz(i)=1000.d0*(f0-144.d0) + 0.001d0*ndf
-  enddo
-
-10 nz=i-1
-  utcz=utc(nz)
-  nz=nz-1
-  if(nz.lt.1) go to 999
-  nquad=max(nkeep/4,3)
-  do i=1,nz
-     nage=utcz-utc(i)
-     if(nage.lt.0) nage=nage+1440
-     iage=(nage/nquad) + 1
-     if(nage.le.1) iage=0
-     write(line(i)(78:81),1021) iage
-1021 format(i4)
-  enddo
-
-  nage=utcz-utc(1)
-  if(nage.lt.0) nage=nage+1440
-  if(nage.gt.nkeep) then
-     do i=1,nz
-        nage=utcz-utc(i)
-        if(nage.lt.0) nage=nage+1440
-        if(nage.le.nkeep) go to 20
-     enddo
-20   i0=i
-     nz=nz-i0+1
-     rewind 26
-     if(nz.lt.1) go to 999
-     do i=1,nz
-        j=i+i0-1
-        line(i)=line(j)
-        utc(i)=utc(j)
-        freqkHz(i)=freqkHz(j)
-        write(26,1010) line(i)
-     enddo
-  endif
-
-  call flushqqq(26)
-  call indexx(nz,freqkHz,indx)
-
-  nstart=1
-  k3=0
-  k=1
-  m=indx(1)
-  if(m.lt.1 .or. m.gt.MAXLINES) then
-     print*,'Error in display.F90: ',nz,m
-     m=1
-  endif
-  line2(1)=line(m)
-  utc2(1)=utc(m)
-  do i=2,nz
-     j0=indx(i-1)
-     j=indx(i)
-     if(freqkHz(j)-freqkHz(j0).gt.ftol) then
-        if(nstart.eq.0) then
-           k=k+1
-           line2(k)=&quot;&quot;
-           utc2(k)=-1
-        endif
-        kz=k
-        if(nstart.eq.1) then
-           call indexx(kz,utc2,indx2)
-           k3=0
-           do k=1,kz
-              k3=min(k3+1,500)
-              line3(k3)=line2(indx2(k))
-           enddo
-           nstart=0
-        else
-           call indexx(kz,utc2,indx2)
-           do k=1,kz
-              k3=min(k3+1,500)
-              line3(k3)=line2(indx2(k))
-           enddo
-        endif
-        k=0
-     endif
-     if(i.eq.nz) then
-        k=k+1
-        line2(k)=&quot;&quot;
-        utc2(k)=-1
-     endif
-     k=k+1
-     line2(k)=line(j)
-     utc2(k)=utc(j)
-     j0=j
-  enddo
-  kz=k
-  call indexx(kz,utc2,indx2)
-  do k=1,kz
-     k3=k3+1
-     line3(k3)=line2(indx2(k))
-  enddo
-
-  rewind 19
-  rewind 20
-  cfreq0='   '
-  nc=0
-  callsign0='          '
-  do k=1,k3
-     out=line3(k)(5:12)//line3(k)(28:31)//line3(k)(39:43)//       &amp;
-          line3(k)(35:38)//line3(k)(44:67)//line3(k)(77:81)
-     if(out(1:3).ne.'   ') then
-        if(out(1:3).eq.cfreq0) then
-           out(1:3)='   '
-        else
-           cfreq0=out(1:3)
-        endif
-        write(19,1030) out
-1030    format(a50)
-        i1=index(out(24:),' ')
-        callsign=out(i1+24:)
-        i2=index(callsign,' ')
-        if(i2.gt.1) callsign(i2:)='      '
-        if(callsign.ne.'      ' .and. callsign.ne.callsign0) then
-           len=i2-1
-           if(len.lt.0) len=6
-           if(len.ge.4) then                        !Omit short &quot;callsigns&quot;
-              nc=nc+1
-              freqcall(nc)=cfreq0//' '//callsign//line3(k)(80:81)
-              callsign0=callsign
-           endif
-        endif
-        if(callsign.ne.'      ' .and. callsign.eq.callsign0) then
-           freqcall(nc)=cfreq0//' '//callsign//line3(k)(80:81)
-        endif
-     endif
-  enddo
-  call flushqqq(19)
-  nc=nc+1
-  freqcall(nc)='            '
-  nc=nc+1
-  freqcall(nc)='            '
-  freqcall(nc+1)='            '
-  freqcall(nc+2)='            '
-  iz=(nc+2)/3
-  do i=1,iz
-     bm2=freqcall(i)//'  '//freqcall(i+iz)//'  '//freqcall(i+2*iz)
-     write(20,1040) bm2
-1040 format(a40)
-  enddo
-  call flushqqq(20)
-999  continue
-  call cs_unlock
-  return
-end subroutine display

Added: branches/map65/displaytext.cpp
===================================================================
--- branches/map65/displaytext.cpp	                        (rev 0)
+++ branches/map65/displaytext.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,15 @@
+#include &quot;displaytext.h&quot;
+#include &lt;QDebug&gt;
+#include &lt;QMouseEvent&gt;
+
+DisplayText::DisplayText(QWidget *parent) :
+    QTextBrowser(parent)
+{
+}
+
+void DisplayText::mouseDoubleClickEvent(QMouseEvent *e)
+{
+  bool ctrl = (e-&gt;modifiers() &amp; 0x4000000);
+  emit(selectCallsign(ctrl));
+  QTextBrowser::mouseDoubleClickEvent(e);
+}

Added: branches/map65/displaytext.h
===================================================================
--- branches/map65/displaytext.h	                        (rev 0)
+++ branches/map65/displaytext.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,22 @@
+#ifndef DISPLAYTEXT_H
+#define DISPLAYTEXT_H
+
+#include &lt;QTextBrowser&gt;
+
+class DisplayText : public QTextBrowser
+{
+    Q_OBJECT
+public:
+    explicit DisplayText(QWidget *parent = 0);
+
+signals:
+  void selectCallsign(bool ctrl);
+
+public slots:
+
+protected:
+  void mouseDoubleClickEvent(QMouseEvent *e);
+
+};
+
+#endif // DISPLAYTEXT_H

Deleted: branches/map65/dot.f
===================================================================
--- branches/map65/dot.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/dot.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,11 +0,0 @@
-      real*8 function dot(x,y)
-
-      real*8 x(3),y(3)
-
-      dot=0.d0
-      do i=1,3
-         dot=dot+x(i)*y(i)
-      enddo
-
-      return
-      end

Deleted: branches/map65/encode65.f
===================================================================
--- branches/map65/encode65.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/encode65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,13 +0,0 @@
-      subroutine encode65(message,sent)
-
-      character message*22
-      integer dgen(12)
-      integer sent(63)
-
-      call packmsg(message,dgen)
-      call rs_encode(dgen,sent)
-      call interleave63(sent,1)
-      call graycode(sent,63,1)
-
-      return
-      end

Deleted: branches/map65/encode_rs.c
===================================================================
--- branches/map65/encode_rs.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/encode_rs.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,52 +0,0 @@
-/* Reed-Solomon encoder
- * Copyright 2002, Phil Karn, KA9Q
- * May be used under the terms of the GNU General Public License (GPL)
- */
-#include &lt;string.h&gt;
-
-#ifdef FIXED
-#include &quot;fixed.h&quot;
-#elif defined(BIGSYM)
-#include &quot;int.h&quot;
-#else
-#include &quot;char.h&quot;
-#endif
-
-void ENCODE_RS(
-#ifdef FIXED
-DTYPE *data, DTYPE *bb,int pad){
-#else
-void *p,DTYPE *data, DTYPE *bb){
-  struct rs *rs = (struct rs *)p;
-#endif
-  int i, j;
-  DTYPE feedback;
-
-#ifdef FIXED
-  /* Check pad parameter for validity */
-  if(pad &lt; 0 || pad &gt;= NN)
-    return;
-#endif
-
-  memset(bb,0,NROOTS*sizeof(DTYPE));
-
-  for(i=0;i&lt;NN-NROOTS-PAD;i++){
-    feedback = INDEX_OF[data[i] ^ bb[0]];
-    if(feedback != A0){      /* feedback term is non-zero */
-#ifdef UNNORMALIZED
-      /* This line is unnecessary when GENPOLY[NROOTS] is unity, as it must
-       * always be for the polynomials constructed by init_rs()
-       */
-      feedback = MODNN(NN - GENPOLY[NROOTS] + feedback);
-#endif
-      for(j=1;j&lt;NROOTS;j++)
-	bb[j] ^= ALPHA_TO[MODNN(feedback + GENPOLY[NROOTS-j])];
-    }
-    /* Shift */
-    memmove(&amp;bb[0],&amp;bb[1],sizeof(DTYPE)*(NROOTS-1));
-    if(feedback != A0)
-      bb[NROOTS-1] = ALPHA_TO[MODNN(feedback + GENPOLY[0])];
-    else
-      bb[NROOTS-1] = 0;
-  }
-}

Deleted: branches/map65/extract.f
===================================================================
--- branches/map65/extract.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/extract.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,90 +0,0 @@
-      subroutine extract(s3,nadd,ncount,nhist,decoded,ltext)
-
-      real s3(64,63)
-      real tmp(4032)
-      character decoded*22
-      integer era(51),dat4(12),indx(64)
-      integer mrsym(63),mr2sym(63),mrprob(63),mr2prob(63)
-      logical first,ltext
-      data first/.true./,nsec1/0/
-      save
-
-      nfail=0
- 1    call demod64a(s3,nadd,mrsym,mrprob,mr2sym,mr2prob,ntest,nlow)
-      if(ntest.lt.50 .or. nlow.gt.20) then
-         ncount=-999                         !Flag bad data
-         go to 900
-      endif
-      call chkhist(mrsym,nhist,ipk)
-
-      if(nhist.ge.20) then
-         nfail=nfail+1
-         call pctile(s3,tmp,4032,50,base)     ! ### or, use ave from demod64a
-         do j=1,63
-            s3(ipk,j)=base
-         enddo
-         go to 1
-      endif
-
-      call graycode(mrsym,63,-1)
-      call interleave63(mrsym,-1)
-      call interleave63(mrprob,-1)
-
-      ndec=1
-      nemax=30                              !Was 200 (30)
-      maxe=8
-      xlambda=13.0                          !Was 12
-
-      if(ndec.eq.1) then
-         call graycode(mr2sym,63,-1)
-         call interleave63(mr2sym,-1)
-         call interleave63(mr2prob,-1)
-
-         nsec1=nsec1+1
-         call cs_lock('extracta')
-         write(22,rec=1) nsec1,xlambda,maxe,200,
-     +        mrsym,mrprob,mr2sym,mr2prob
-         call flushqqq(22)
-         call cs_unlock
-         call runqqq('kvasd.exe','-q',iret)
-         if(iret.ne.0) then
-            call cs_lock('extractb')
-            if(first) write(*,1000) iret
- 1000       format('Error in KV decoder, or no KV decoder present.'/
-     +         'Return code:',i8,'.  Will use BM algorithm.')
-            call cs_unlock
-            ndec=0
-            first=.false.
-            go to 20
-         endif
-         read(22,rec=2) nsec2,ncount,dat4
-         decoded='                      '
-         ltext=.false.
-         if(ncount.ge.0) then
-            call unpackmsg(dat4,decoded) !Unpack the user message
-            if(iand(dat4(10),8).ne.0) ltext=.true.
-         endif
-      endif
- 20   if(ndec.eq.0) then
-         call indexx(63,mrprob,indx)
-         do i=1,nemax
-            j=indx(i)
-            if(mrprob(j).gt.120) then
-               ne2=i-1
-               go to 2
-            endif
-            era(i)=j-1
-         enddo
-         ne2=nemax
- 2       decoded='                      '
-         do nerase=0,ne2,2
-            call rs_decode(mrsym,era,nerase,dat4,ncount)
-            if(ncount.ge.0) then
-               call unpackmsg(dat4,decoded)
-               go to 900
-            endif
-         enddo
-      endif
-
- 900  return
-      end

Deleted: branches/map65/f2py.py
===================================================================
--- branches/map65/f2py.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/f2py.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,4 +0,0 @@
-#!/usr/bin/env python.exe
-# See <A HREF="http://cens.ioc.ee/projects/f2py2e/">http://cens.ioc.ee/projects/f2py2e/</A>
-import f2py2e
-f2py2e.main()

Deleted: branches/map65/f77_wisdom.f
===================================================================
--- branches/map65/f77_wisdom.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/f77_wisdom.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,45 +0,0 @@
-      subroutine write_char(c, iunit)
-      character c
-      integer iunit
-      write(iunit,1000) c
- 1000 format(a,$)
-      end      
-
-      subroutine export_wisdom_to_file(iunit)
-      integer iunit
-      external write_char
-c      call dfftw_export_wisdom(write_char, iunit)
-      call sfftw_export_wisdom(write_char, iunit)
-      end
-
-      subroutine read_char(ic, iunit)
-      integer ic
-      integer iunit
-      character*256 buf
-      save buf
-      integer ibuf
-      data ibuf/257/
-      save ibuf
-      if (ibuf .lt. 257) then
-         ic = ichar(buf(ibuf:ibuf))
-         ibuf = ibuf + 1
-         return
-      endif
-      read(iunit,1000,end=10) buf
- 1000 format(a256)
-      ic = ichar(buf(1:1))
-      ibuf = 2
-      return
- 10   ic = -1
-      ibuf = 257
-      rewind iunit
-      return
-      end
-      
-      subroutine import_wisdom_from_file(isuccess, iunit)
-      integer isuccess
-      integer iunit
-      external read_char
-c      call dfftw_import_wisdom(isuccess, read_char, iunit)
-      call sfftw_import_wisdom(isuccess, read_char, iunit)
-      end

Deleted: branches/map65/fchisq.f
===================================================================
--- branches/map65/fchisq.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fchisq.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,72 +0,0 @@
-      real function fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
-
-      parameter (NMAX=60*96000)          !Samples per 60 s
-      complex cx(npts),cy(npts)
-      real a(5)
-      complex w,wstep,za,zb,z
-      real ss(2600)
-      complex csx(0:NMAX/64),csy(0:NMAX/64)
-      data twopi/6.283185307/a1,a2,a3/99.,99.,99./
-      save
-
-      baud=11025.0/4096.0
-      if(a(1).ne.a1 .or. a(2).ne.a2 .or. a(3).ne.a3) then
-         a1=a(1)
-         a2=a(2)
-         a3=a(3)
-
-C  Mix and integrate the complex X and Y signals
-         csx(0)=0.
-         csy(0)=0.
-         w=1.0
-         x0=0.5*(npts+1)
-         s=2.0/npts
-         do i=1,npts
-            x=s*(i-x0)
-            if(mod(i,100).eq.1) then
-               p2=1.5*x*x - 0.5
-!               p3=2.5*(x**3) - 1.5*x
-!               p4=4.375*(x**4) - 3.75*(x**2) + 0.375
-               dphi=(a(1) + x*a(2) + p2*a(3)) * (twopi/fsample)
-               wstep=cmplx(cos(dphi),sin(dphi))
-            endif
-            w=w*wstep
-            csx(i)=csx(i-1) + w*cx(i)
-            csy(i)=csy(i-1) + w*cy(i)
-         enddo
-      endif
-
-C  Compute 1/2-symbol powers at 1/16-symbol steps.
-      fac=1.e-4
-      pol=a(4)/57.2957795
-      aa=cos(pol)
-      bb=sin(pol)
-      nsps=nint(fsample/baud)                  !Samples per symbol
-      nsph=nsps/2                              !Samples per half-symbol
-
-      ndiv=16                                  !Output ss() steps per symbol
-      nout=ndiv*npts/nsps
-      dtstep=1.0/(ndiv*baud)                   !Time per output step
-
-      do i=1,nout
-         j=i*nsps/ndiv
-         k=j-nsph
-         ss(i)=0.
-         if(k.ge.1) then
-            za=csx(j)-csx(k)
-            zb=csy(j)-csy(k)
-            z=aa*za + bb*zb
-            ss(i)=fac*(real(z)**2 + aimag(z)**2)
-         endif
-      enddo
-
-      ccfmax=0.
-      call ccf2(ss,nout,nflip,ccf,lagpk)
-      if(ccf.gt.ccfmax) then
-         ccfmax=ccf
-         dtmax=lagpk*dtstep
-      endif
-      fchisq=-ccfmax
-
-      return
-      end

Added: branches/map65/ffft.f
===================================================================
--- branches/map65/ffft.f	                        (rev 0)
+++ branches/map65/ffft.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,69 @@
+	subroutine ffft(d,npts,isign,ireal)
+
+C  Fourier transform of length npts=2**k, performed in place.
+C  Input data in array d, treated as complex if ireal=0, and as real if ireal=1.
+C  In either case the transform values are returned in array d, treated as
+C  complex. The DC term is d(1), and d(npts/2+1) is the term at the Nyquist
+C  frequency.  The basic algorithm is the same as Norm Brenner's FOUR1, and
+C  uses radix-2 transforms.
+
+C  J. H. Taylor, Princeton University.
+
+	complex d(npts),t,w,wstep,tt,uu
+	data pi/3.14159265359/
+
+C  Shuffle the data to bit-reversed order.
+
+	imax=npts/(ireal+1)
+	irev=1
+	do 5 i=1,imax
+	if(i.ge.irev) go to 2
+	t=d(i)
+	d(i)=d(irev)
+	d(irev)=t
+2	mmax=imax/2
+3	if(irev.le.mmax) go to 5
+	irev=irev-mmax
+	mmax=mmax/2
+	if(mmax.ge.1) go to 3
+5	irev=irev+mmax
+
+C  The radix-2 transform begins here.
+
+	api=isign*pi/2.
+	mmax=1
+6	istep=2*mmax
+	wstep=cmplx(-2.*sin(api/mmax)**2,sin(2.*api/mmax))
+	w=1.
+	do 9 m=1,mmax
+
+C  This in the inner-most loop -- optimization here is important!
+	do 8 i=m,imax,istep
+	t=w*d(i+mmax)
+	d(i+mmax)=d(i)-t
+8	d(i)=d(i)+t
+
+9	w=w*(1.+wstep)
+	mmax=istep
+	if(mmax.lt.imax) go to 6
+
+	if(ireal.eq.0) return
+
+C  Now complete the last stage of a doubled-up real transform.
+
+	jmax=imax/2 + 1
+	wstep=cmplx(-2.*sin(isign*pi/npts)**2,sin(isign*pi/imax))
+	w=1.0
+	d(imax+1)=d(1)
+
+	do 10 j=1,jmax
+	uu=cmplx(real(d(j))+real(d(2+imax-j)),aimag(d(j)) - 
+     +    aimag(d(2+imax-j)))
+	tt=w*cmplx(aimag(d(j))+aimag(d(2+imax-j)),-real(d(j)) +
+     +    real(d(2+imax-j)))
+	d(j)=uu+tt
+	d(2+imax-j)=conjg(uu-tt)
+10	w=w*(1.+wstep)
+
+	return
+	end

Deleted: branches/map65/fftw3.f
===================================================================
--- branches/map65/fftw3.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fftw3.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,64 +0,0 @@
-      INTEGER FFTW_R2HC
-      PARAMETER (FFTW_R2HC=0)
-      INTEGER FFTW_HC2R
-      PARAMETER (FFTW_HC2R=1)
-      INTEGER FFTW_DHT
-      PARAMETER (FFTW_DHT=2)
-      INTEGER FFTW_REDFT00
-      PARAMETER (FFTW_REDFT00=3)
-      INTEGER FFTW_REDFT01
-      PARAMETER (FFTW_REDFT01=4)
-      INTEGER FFTW_REDFT10
-      PARAMETER (FFTW_REDFT10=5)
-      INTEGER FFTW_REDFT11
-      PARAMETER (FFTW_REDFT11=6)
-      INTEGER FFTW_RODFT00
-      PARAMETER (FFTW_RODFT00=7)
-      INTEGER FFTW_RODFT01
-      PARAMETER (FFTW_RODFT01=8)
-      INTEGER FFTW_RODFT10
-      PARAMETER (FFTW_RODFT10=9)
-      INTEGER FFTW_RODFT11
-      PARAMETER (FFTW_RODFT11=10)
-      INTEGER FFTW_FORWARD
-      PARAMETER (FFTW_FORWARD=-1)
-      INTEGER FFTW_BACKWARD
-      PARAMETER (FFTW_BACKWARD=+1)
-      INTEGER FFTW_MEASURE
-      PARAMETER (FFTW_MEASURE=0)
-      INTEGER FFTW_DESTROY_INPUT
-      PARAMETER (FFTW_DESTROY_INPUT=1)
-      INTEGER FFTW_UNALIGNED
-      PARAMETER (FFTW_UNALIGNED=2)
-      INTEGER FFTW_CONSERVE_MEMORY
-      PARAMETER (FFTW_CONSERVE_MEMORY=4)
-      INTEGER FFTW_EXHAUSTIVE
-      PARAMETER (FFTW_EXHAUSTIVE=8)
-      INTEGER FFTW_PRESERVE_INPUT
-      PARAMETER (FFTW_PRESERVE_INPUT=16)
-      INTEGER FFTW_PATIENT
-      PARAMETER (FFTW_PATIENT=32)
-      INTEGER FFTW_ESTIMATE
-      PARAMETER (FFTW_ESTIMATE=64)
-      INTEGER FFTW_ESTIMATE_PATIENT
-      PARAMETER (FFTW_ESTIMATE_PATIENT=128)
-      INTEGER FFTW_BELIEVE_PCOST
-      PARAMETER (FFTW_BELIEVE_PCOST=256)
-      INTEGER FFTW_DFT_R2HC_ICKY
-      PARAMETER (FFTW_DFT_R2HC_ICKY=512)
-      INTEGER FFTW_NONTHREADED_ICKY
-      PARAMETER (FFTW_NONTHREADED_ICKY=1024)
-      INTEGER FFTW_NO_BUFFERING
-      PARAMETER (FFTW_NO_BUFFERING=2048)
-      INTEGER FFTW_NO_INDIRECT_OP
-      PARAMETER (FFTW_NO_INDIRECT_OP=4096)
-      INTEGER FFTW_ALLOW_LARGE_GENERIC
-      PARAMETER (FFTW_ALLOW_LARGE_GENERIC=8192)
-      INTEGER FFTW_NO_RANK_SPLITS
-      PARAMETER (FFTW_NO_RANK_SPLITS=16384)
-      INTEGER FFTW_NO_VRANK_SPLITS
-      PARAMETER (FFTW_NO_VRANK_SPLITS=32768)
-      INTEGER FFTW_NO_VRECURSE
-      PARAMETER (FFTW_NO_VRECURSE=65536)
-      INTEGER FFTW_NO_SIMD
-      PARAMETER (FFTW_NO_SIMD=131072)

Added: branches/map65/fftw3.f
===================================================================
--- branches/map65/fftw3.f	                        (rev 0)
+++ branches/map65/fftw3.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,64 @@
+      INTEGER FFTW_R2HC
+      PARAMETER (FFTW_R2HC=0)
+      INTEGER FFTW_HC2R
+      PARAMETER (FFTW_HC2R=1)
+      INTEGER FFTW_DHT
+      PARAMETER (FFTW_DHT=2)
+      INTEGER FFTW_REDFT00
+      PARAMETER (FFTW_REDFT00=3)
+      INTEGER FFTW_REDFT01
+      PARAMETER (FFTW_REDFT01=4)
+      INTEGER FFTW_REDFT10
+      PARAMETER (FFTW_REDFT10=5)
+      INTEGER FFTW_REDFT11
+      PARAMETER (FFTW_REDFT11=6)
+      INTEGER FFTW_RODFT00
+      PARAMETER (FFTW_RODFT00=7)
+      INTEGER FFTW_RODFT01
+      PARAMETER (FFTW_RODFT01=8)
+      INTEGER FFTW_RODFT10
+      PARAMETER (FFTW_RODFT10=9)
+      INTEGER FFTW_RODFT11
+      PARAMETER (FFTW_RODFT11=10)
+      INTEGER FFTW_FORWARD
+      PARAMETER (FFTW_FORWARD=-1)
+      INTEGER FFTW_BACKWARD
+      PARAMETER (FFTW_BACKWARD=+1)
+      INTEGER FFTW_MEASURE
+      PARAMETER (FFTW_MEASURE=0)
+      INTEGER FFTW_DESTROY_INPUT
+      PARAMETER (FFTW_DESTROY_INPUT=1)
+      INTEGER FFTW_UNALIGNED
+      PARAMETER (FFTW_UNALIGNED=2)
+      INTEGER FFTW_CONSERVE_MEMORY
+      PARAMETER (FFTW_CONSERVE_MEMORY=4)
+      INTEGER FFTW_EXHAUSTIVE
+      PARAMETER (FFTW_EXHAUSTIVE=8)
+      INTEGER FFTW_PRESERVE_INPUT
+      PARAMETER (FFTW_PRESERVE_INPUT=16)
+      INTEGER FFTW_PATIENT
+      PARAMETER (FFTW_PATIENT=32)
+      INTEGER FFTW_ESTIMATE
+      PARAMETER (FFTW_ESTIMATE=64)
+      INTEGER FFTW_ESTIMATE_PATIENT
+      PARAMETER (FFTW_ESTIMATE_PATIENT=128)
+      INTEGER FFTW_BELIEVE_PCOST
+      PARAMETER (FFTW_BELIEVE_PCOST=256)
+      INTEGER FFTW_DFT_R2HC_ICKY
+      PARAMETER (FFTW_DFT_R2HC_ICKY=512)
+      INTEGER FFTW_NONTHREADED_ICKY
+      PARAMETER (FFTW_NONTHREADED_ICKY=1024)
+      INTEGER FFTW_NO_BUFFERING
+      PARAMETER (FFTW_NO_BUFFERING=2048)
+      INTEGER FFTW_NO_INDIRECT_OP
+      PARAMETER (FFTW_NO_INDIRECT_OP=4096)
+      INTEGER FFTW_ALLOW_LARGE_GENERIC
+      PARAMETER (FFTW_ALLOW_LARGE_GENERIC=8192)
+      INTEGER FFTW_NO_RANK_SPLITS
+      PARAMETER (FFTW_NO_RANK_SPLITS=16384)
+      INTEGER FFTW_NO_VRANK_SPLITS
+      PARAMETER (FFTW_NO_VRANK_SPLITS=32768)
+      INTEGER FFTW_NO_VRECURSE
+      PARAMETER (FFTW_NO_VRECURSE=65536)
+      INTEGER FFTW_NO_SIMD
+      PARAMETER (FFTW_NO_SIMD=131072)

Deleted: branches/map65/fftw3single.lib
===================================================================
(Binary files differ)

Deleted: branches/map65/fil651.f
===================================================================
--- branches/map65/fil651.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fil651.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,67 +0,0 @@
-      subroutine fil651(d,n1,c,n2)
-
-C  FIR lowpass mixing filter designed with ScopeFIR.  Real in, complex out.
-
-C  fsample     = 5512.5   Hz
-C  Ntaps       = 31
-C  fc          = 1000     Hz
-C  fstop       = 1378.125 Hz
-C  Ripple      = 0.5      dB
-C  Stop Atten  = 50       dB
-C  fmix        = 1378.125 Hz
-C  fout        = 2706.25  Hz
-
-      parameter (NTAPS=31)
-      parameter (NH=NTAPS/2)
-      parameter (NDOWN=2)               !Downsample ratio
-
-      real d(n1)
-      complex c(n2)
-
-      complex ck(-NH:NH)
-      data ck/
-     +  (-0.000000073578,-0.000859869243),
-     +  ( 0.008518289457,-0.000000680308),
-     +  ( 0.000000834309, 0.011250152594),
-     +  (-0.001061705254, 0.000000072679),
-     +  ( 0.000000875897, 0.013958392128),
-     +  (-0.010047338711, 0.000000573160),
-     +  ( 0.000000770320, 0.015003869984),
-     +  (-0.025027880956, 0.000001142192),
-     +  ( 0.000000285583, 0.007151700551),
-     +  (-0.043634723888, 0.000001493512),
-     +  (-0.000000478847,-0.016788108005),
-     +  (-0.061886192046, 0.000001412144),
-     +  (-0.000001258694,-0.073548459509),
-     +  (-0.075261027462, 0.000000858668),
-     +  (-0.000001749252,-0.306638863572),
-     +  ( 0.419826269508, 0.000000000000),
-     +  (-0.000001749252, 0.306638863572),
-     +  (-0.075261027462,-0.000000858668),
-     +  (-0.000001258694, 0.073548459509),
-     +  (-0.061886192046,-0.000001412144),
-     +  (-0.000000478847, 0.016788108005),
-     +  (-0.043634723888,-0.000001493512),
-     +  ( 0.000000285583,-0.007151700551),
-     +  (-0.025027880956,-0.000001142192),
-     +  ( 0.000000770320,-0.015003869984),
-     +  (-0.010047338711,-0.000000573160),
-     +  ( 0.000000875897,-0.013958392128),
-     +  (-0.001061705254,-0.000000072679),
-     +  ( 0.000000834309,-0.011250152594),
-     +  ( 0.008518289457, 0.000000680308),
-     +  (-0.000000073578, 0.000859869243)/
-
-      n2=(n1-NTAPS+NDOWN)/NDOWN
-      k0=NH-NDOWN+1
-
-      do i=1,n2
-         c(i)=0.
-         k=k0 + NDOWN*i
-         do j=-NH,NH
-            c(i)=c(i) + d(j+k)*conjg(ck(j))
-         enddo
-      enddo
-
-      return
-      end

Deleted: branches/map65/fil652.f
===================================================================
--- branches/map65/fil652.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fil652.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,44 +0,0 @@
-      subroutine fil652(c1,n1,c2,n2)
-
-C  FIR lowpass filter designed using ScopeFIR
-
-C  fsample     = 2756.25  Hz
-C  Ntaps       = 31
-C  fc          = 500      Hz
-C  fstop       = 689.0625 Hz
-C  Ripple      = 0.5      dB
-C  Stop Atten  = 50       dB
-C  fout        = 1378.125 Hz
-
-      parameter (NTAPS=31)
-      parameter (NH=NTAPS/2)
-      parameter (NDOWN=2)                !Downsample ratio
-      complex c1(n1)
-      complex c2(n2)
-
-C  Filter coefficients:
-      real a(-NH:NH)
-      data a/
-     +  -0.000859869246,-0.008518289484,-0.011250152625,-0.001061705256,
-     +   0.013958392156, 0.010047338728,-0.015003870003,-0.025027880982,
-     +   0.007151700557, 0.043634723913, 0.016788108012,-0.061886192062,
-     +  -0.073548459520, 0.075261027466, 0.306638863577, 0.419826269508,
-     +   0.306638863577, 0.075261027466,-0.073548459520,-0.061886192062,
-     +   0.016788108012, 0.043634723913, 0.007151700557,-0.025027880982,
-     +  -0.015003870003, 0.010047338728, 0.013958392156,-0.001061705256,
-     +  -0.011250152625,-0.008518289484,-0.000859869246/
-
-      n2=(n1-NTAPS+NDOWN)/NDOWN
-      k0=NH-NDOWN+1
-
-C  Loop over all output samples
-      do i=1,n2
-         c2(i)=0.
-         k=k0 + NDOWN*i
-         do j=-NH,NH
-            c2(i)=c2(i) + c1(j+k)*a(j)
-         enddo
-      enddo
-
-      return
-      end

Deleted: branches/map65/fil6521.f
===================================================================
--- branches/map65/fil6521.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fil6521.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,44 +0,0 @@
-      subroutine fil6521(c1,n1,c2,n2)
-
-C  FIR lowpass filter designed using ScopeFIR
-
-C                   Pass #1   Pass #2  
-C-----------------------------------------------
-C  fsample    (Hz)  1378.125   Input sample rate
-C  Ntaps            21         Number of filter taps
-C  fc         (Hz)  40         Cutoff frequency
-C  fstop      (Hz)  172.266    Lower limit of stopband
-C  Ripple     (dB)  0.1        Ripple in passband
-C  Stop Atten (dB)  38         Stopband attenuation
-C  fout       (Hz)  344.531    Output sample rate
-
-      parameter (NTAPS=21)
-      parameter (NH=NTAPS/2)
-      parameter (NDOWN=4)                !Downsample ratio = 1/4
-      complex c1(n1)
-      complex c2(n1/NDOWN)
-
-C  Filter coefficients:
-      real a(-NH:NH)
-      data a/
-     +  -0.011958606980,-0.013888627387,-0.015601306443,-0.010602249570,
-     +   0.003804023436, 0.028320058273, 0.060903935217, 0.096841904411,
-     +   0.129639871228, 0.152644580853, 0.160917511283, 0.152644580853,
-     +   0.129639871228, 0.096841904411, 0.060903935217, 0.028320058273,
-     +   0.003804023436,-0.010602249570,-0.015601306443,-0.013888627387,
-     +  -0.011958606980/
-
-      n2=(n1-NTAPS+NDOWN)/NDOWN
-      k0=NH-NDOWN+1
-
-C  Loop over all output samples
-      do i=1,n2
-         c2(i)=0.
-         k=k0 + NDOWN*i
-         do j=-NH,NH
-            c2(i)=c2(i) + c1(j+k)*a(j)
-         enddo
-      enddo
-
-      return
-      end

Deleted: branches/map65/fil653.f
===================================================================
--- branches/map65/fil653.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fil653.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,49 +0,0 @@
-      subroutine fil653(c1,n1,c2,n2)
-
-C  FIR lowpass filter designed using ScopeFIR
-
-C  fsample     = 1378.125   Hz
-C  Ntaps       = 45
-C  fc          = 100        Hz
-C  fstop       = 172.265625 Hz
-C  Ripple      = 0.5        dB
-C  Stop Atten  = 50         dB
-C  fout        = 172.265625 Hz
-C  BW          = 200        Hz
-
-      parameter (NTAPS=45)
-      parameter (NH=NTAPS/2)
-      parameter (NDOWN=4)                !Downsample ratio
-      complex c1(n1)
-      complex c2(n2)
-
-C  Filter coefficients:
-      real a(-NH:NH)
-      data a/
-     +  -0.000005569862,-0.002503777832,-0.004040335617,-0.005717910288,
-     +  -0.006153385485,-0.004446125293,-0.000305215272, 0.005557289511,
-     +   0.011329120672, 0.014496551280, 0.012703875898, 0.004837591829,
-     +  -0.008060363689,-0.022474422302,-0.032964876083,-0.033575486327,
-     +  -0.019743889907, 0.009895672340, 0.052467109908, 0.101031155027,
-     +   0.146073001698, 0.177927966814, 0.189427119395, 0.177927966814,
-     +   0.146073001698, 0.101031155027, 0.052467109908, 0.009895672340,
-     +  -0.019743889907,-0.033575486327,-0.032964876083,-0.022474422302,
-     +  -0.008060363689, 0.004837591829, 0.012703875898, 0.014496551280,
-     +   0.011329120672, 0.005557289511,-0.000305215272,-0.004446125293,
-     +  -0.006153385485,-0.005717910288,-0.004040335617,-0.002503777832,
-     +  -0.000005569862/
-
-      n2=(n1-NTAPS+NDOWN)/NDOWN
-      k0=NH-NDOWN+1
-
-C  Loop over all output samples
-      do i=1,n2
-         c2(i)=0.
-         k=k0 + NDOWN*i
-         do j=-NH,NH
-            c2(i)=c2(i) + c1(j+k)*a(j)
-         enddo
-      enddo
-
-      return
-      end

Deleted: branches/map65/filbig.f
===================================================================
--- branches/map65/filbig.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/filbig.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,119 +0,0 @@
-      subroutine filbig(dd,nmax,f0,newdat,c4a,c4b,n4)
-
-C  Filter and downsample complex data for X and Y polarizations,
-C  stored in array dd(4,nmax).  Output is downsampled from 96000 Hz
-C  to 1500 Hz, and the low-pass filter has f_cutoff = 375 Hz and 
-C  f_stop = 750 Hz.
-
-      parameter (NFFT1=5376000,NFFT2=77175)
-      real*4  dd(4,nmax)                         !Input data
-      complex c4a(NFFT2),c4b(NFFT2)              !Output data
-      complex ca(NFFT1),cb(NFFT1)                !FFTs of input
-      real*8 df
-C Impulse response of filter (one side)
-      real halfpulse(8)
-      complex cfilt(NFFT2)
-                       !Filter (complex; imag = 0)
-      real rfilt(NFFT2)                          !Filter (real)
-      integer plan1,plan2,plan3,plan4,plan5
-      logical first
-      include 'fftw3.f'
-      equivalence (rfilt,cfilt)
-      data first/.true./
-      data halfpulse/114.97547150,36.57879257,-20.93789101,
-     +  5.89886379,1.59355187,-2.49138308,0.60910773,-0.04248129/
-      save
-
-      if(nmax.lt.0) go to 900
-      if(first) then
-         npatience=1
-         nflags=FFTW_ESTIMATE
-         if(npatience.eq.1) nflags=FFTW_ESTIMATE_PATIENT
-         if(npatience.eq.2) nflags=FFTW_MEASURE
-         if(npatience.eq.3) nflags=FFTW_PATIENT
-         if(npatience.eq.4) nflags=FFTW_EXHAUSTIVE
-C  Plan the FFTs just once
-         call sfftw_plan_dft_1d_(plan1,NFFT1,ca,ca,
-     +        FFTW_BACKWARD,nflags)
-         call sfftw_plan_dft_1d_(plan2,NFFT1,cb,cb,
-     +        FFTW_BACKWARD,nflags)
-         call sfftw_plan_dft_1d_(plan3,NFFT2,c4a,c4a,
-     +        FFTW_FORWARD,nflags)
-         call sfftw_plan_dft_1d_(plan4,NFFT2,c4b,c4b,
-     +        FFTW_FORWARD,nflags)
-         call sfftw_plan_dft_1d_(plan5,NFFT2,cfilt,cfilt,
-     +        FFTW_BACKWARD,nflags)
-
-C  Convert impulse response to filter function
-         do i=1,NFFT2
-            cfilt(i)=0.
-         enddo
-         fac=0.00625/NFFT1
-         cfilt(1)=fac*halfpulse(1)
-         do i=2,8
-            cfilt(i)=fac*halfpulse(i)
-            cfilt(NFFT2+2-i)=fac*halfpulse(i)
-         enddo
-         call sfftw_execute_(plan5)
-
-         base=cfilt(NFFT2/2+1)
-         do i=1,NFFT2
-            rfilt(i)=real(cfilt(i))-base
-         enddo
-
-         df=96000.d0/NFFT1
-         first=.false.
-      endif
-
-C  When new data comes along, we need to compute a new &quot;big FFT&quot;
-C  If we just have a new f0, continue with the existing ca and cb.
-
-      if(newdat.ne.0) then
-         nz=min(nmax,NFFT1)
-         do i=1,nz
-            ca(i)=cmplx(dd(1,i),dd(2,i))
-            cb(i)=cmplx(dd(3,i),dd(4,i))
-         enddo
-
-         if(nmax.lt.NFFT1) then
-            do i=nmax+1,NFFT1
-               ca(i)=0.
-               cb(i)=0.
-            enddo
-         endif
-         call sfftw_execute_(plan1)
-         call sfftw_execute_(plan2)
-         newdat=0
-      endif
-
-C  NB: f0 is the frequency at which we want our filter centered.
-C      i0 is the bin number in ca and cb closest to f0.
-
-      i0=nint(f0/df) + 1
-      nh=NFFT2/2
-      do i=1,nh                                !Copy data into c4a and c4b,
-         j=i0+i-1                              !and apply the filter function
-         c4a(i)=rfilt(i)*ca(j)
-         c4b(i)=rfilt(i)*cb(j)
-      enddo
-      do i=nh+1,NFFT2
-         j=i0+i-1-NFFT2
-         if(j.lt.1) j=j+NFFT1                  !NFFT1 was NFFT2
-         c4a(i)=rfilt(i)*ca(j)
-         c4b(i)=rfilt(i)*cb(j)
-      enddo
-
-C  Do the short reverse transform, to go back to time domain.
-      call sfftw_execute_(plan3)
-      call sfftw_execute_(plan4)
-      n4=min(nmax/64,NFFT2)
-      go to 999
-
- 900  call sfftw_destroy_plan_(plan1)
-      call sfftw_destroy_plan_(plan2)
-      call sfftw_destroy_plan_(plan3)
-      call sfftw_destroy_plan_(plan4)
-      call sfftw_destroy_plan_(plan5)
-
- 999  return
-      end

Deleted: branches/map65/files.txt
===================================================================
--- branches/map65/files.txt	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/files.txt	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,36 +0,0 @@
-LU  fname          write          read                write thread
---------------------------------------------------------------------------
-10  *.tf2                         getfile2
-11  prefixes.txt   pfxdump        GUI                 GUI     (once only)
-11  decoded.txt    map65a         GUI                 decoder (60 s)
-12
-13  tsky.dat                      astro0.F
-14  azel.dat       astro0.F                           GUI     (1 s)
-15
-16
-17  *.tf2          savetf2                            decoder
-18  TxData                        wsjtgen
-19  messages.txt   display.txt    GUI                 decoder
-20  bandmap.txt    display.txt    GUI                 decoder
-21  ALL65.TXT      map65a                             decoder
-22  kvasd.dat      extract        KVASD               decoder
-23  CALL3.TXT                     deep65              decoder
-24  meas24.txt     savetf2                            decoder
-25  meas25.txt     savetf2                            decoder
-26  tmp26.txt      map65a,display display             decoder
-27  dphi.txt       map65a                             decoder
-28
-29  debug.txt
-77                 deep65                             decoder
---------------------------------------------------------------------------
-
-So ... the problem may be writing to azel.dat from the GUI thread?
-(Could put astro data into a common, and write to file from decode1.F90.)
-
-Also: look at write(line,...) forms ...
-
-  unpackgrid unpackmsg symspec display savetf2 (all in decoder thread)
-
-read(char,...) 
-
-  packcall packgrid astro0 display getfile2

Deleted: branches/map65/fivehz.f90
===================================================================
--- branches/map65/fivehz.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fivehz.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,250 +0,0 @@
-subroutine fivehz
-
-!  Called at interrupt level from the PortAudio callback routine.
-!  For nspb=2048 the callback rate is nfsample/nspb = 5.38 Hz.
-!  Thus, we should be able to control the timing of T/R sequence events
-!  here to within about 0.2 s.
-
-!  Do not do anything very time consuming in this routine!!
-!  Disk I/O is a bad idea.  Writing to stdout (for diagnostic purposes)
-!  seems to be OK.
-
-#ifdef CVF
-  use dflib
-  use dfport
-#endif
-
-  parameter (NTRING=64)
-  real*8 tt1(0:NTRING-1)
-  logical first,txtime,filled
-  integer ptt
-  integer TxOKz
-  real*8 fs,fsample,tt,u
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-  data first/.true./,nc0/1/,nc1/1/
-  save
-
-  n1=time()
-  n2=mod(n1,86400)
-  tt=n1-n2+tsec-0.1d0*ndsec
-
-  if(first) then
-     rxdelay=0.2
-     txdelay=0.4
-     tlatency=1.0
-     first=.false.
-     iptt=0
-     ntr0=-99
-     rxdone=.false.
-     ibuf00=-99
-     ncall=-1
-     u=0.05d0
-     fsample=11025.d0
-     mfsample=110250
-     filled=.false.
-  endif
-
-  if(txdelay.lt.0.2d0) txdelay=0.2d0
-
-! Measure average sampling frequency over a recent interval
-  ncall=ncall+1
-  if(ncall.eq.9) then
-     ntt0=0
-     ntt1=0
-     tt1(ntt1)=tt
-  endif
-!  if(ncall.ge.10 .and. mod(ncall,2).eq.1) then
-  if(ncall.ge.10) then
-     ntt1=iand(ntt1+1,NTRING-1)
-     tt1(ntt1)=tt
-     if(ntt1.eq.NTRING-1) filled=.true.
-     if(filled) ntt0=iand(ntt1+1,NTRING-1)
-     if(mod(ncall,2).eq.1) then
-        nd=ntt1-ntt0
-        if(nd.lt.0) nd=nd+NTRING
-        fs=nd*2048.d0/(tt1(ntt1)-tt1(ntt0))
-        fsample=u*fs + (1.d0-u)*fsample
-        mfsample=nint(10.d0*fsample)
-     endif
-  endif
-
-  if(trperiod.le.0) trperiod=30
-  tx1=0.0                              !Time to start a TX sequence
-  tx2=trperiod-(tlatency+txdelay)      !Time to turn TX off
-  if(mode(1:4).eq.'JT65') then
-     if(nwave.lt.126*4096) nwave=126*4096
-     tx2=txdelay + nwave/11025.0
-     if(tx2.gt.(trperiod-2.0)) tx2=trperiod-tlatency-1.0
-  endif
-
-  if(TxFirst.eq.0) then
-     tx1=tx1+trperiod
-     tx2=tx2+trperiod
-  endif
-
-  t=mod(Tsec,2.d0*trperiod)
-  txtime = t.ge.tx1 .and. t.lt.tx2
-
-! If we're transmitting, freeze the input buffer pointers where they were.
-  receiving=1
-  if(((txtime .and. (lauto.eq.1)) .or. TxOK.eq.1 .or. transmitting.eq.1) &amp; 
-       .and. (mute.eq.0)) then
-     receiving=0
-     ibuf=ibuf000
-     iwrite=iwrite000
-  endif
-  ibuf000=ibuf
-  iwrite000=iwrite
-  nsec=Tsec
-  ntr=mod(nsec/trperiod,2)             !ntr=0 in 1st sequence, 1 in 2nd
-
-  if(ntr.ne.ntr0) then
-     ibuf0=ibuf                        !Start of new sequence, save ibuf
-!     if(mode(1:4).ne.'JT65') then
-!        ibuf0=ibuf0+3                  !So we don't copy our own Tx
-!        if(ibuf0.gt.1024) ibuf0=ibuf0-1024
-!     endif
-     ntime=time()                      !Save start time
-     if(mantx.eq.1 .and. iptt.eq.1) then
-        mantx=0
-        TxOK=0
-     endif
-  endif
-
-! Switch PTT line and TxOK appropriately
-  if(lauto.eq.1) then
-     if(txtime .and. iptt.eq.0 .and.          &amp;
-          mute.eq.0) i1=ptt(nport,pttport,1,iptt)        !Raise PTT
-     if(.not.txtime .or. mute.eq.1) TxOK=0               !Lower TxOK
-  else
-     if(mantx.eq.1 .and. iptt.eq.0 .and.      &amp;
-          mute.eq.0) i2=ptt(nport,pttport,1,iptt)        !Raise PTT
-     if(mantx.eq.0 .or. mute.eq.1) TxOK=0                !Lower TxOK
-  endif
-
-! Calculate Tx waveform as needed
-  if((iptt.eq.1 .and. iptt0.eq.0) .or. nrestart.eq.1) then
-     call wsjtgen
-     nrestart=0
-  endif
-
-! If PTT was just raised, start a countdown for raising TxOK:
-  nc1a=txdelay/0.18576
-  if(nc1a.lt.2) nc1a=2
-  if(iptt.eq.1 .and. iptt0.eq.0) nc1=-nc1a-1
-  if(nc1.le.0) nc1=nc1+1
-  if(nc1.eq.0) TxOK=1                               ! We are transmitting
-
-! If TxOK was just lowered, start a countdown for lowering PTT:
-  nc0a=(tlatency+txdelay)/0.18576
-  if(nc0a.lt.5) nc0a=5
-  if(TxOK.eq.0 .and. TxOKz.eq.1 .and. iptt.eq.1) nc0=-nc0a-1
-  if(nc0.le.0) nc0=nc0+1
-  if(nc0.eq.0) i3=ptt(nport,pttport,0,iptt)
-
-  if(iptt.eq.0 .and.TxOK.eq.0) then
-     sending=&quot;                      &quot;
-     sendingsh=0
-  endif
-
-  nbufs=ibuf-ibuf0
-  if(nbufs.lt.0) nbufs=nbufs+1024
-  tdata=nbufs*2048.0/11025.0
-  if(mode(1:4).eq.'JT65' .and. monitoring.eq.1 .and. tdata.gt.53.0    &amp;
-       .and. ibuf0.ne.ibuf00) then
-     rxdone=.true.
-     ibuf00=ibuf0
-  endif
-  iptt0=iptt
-  TxOKz=TxOK
-  ntr0=ntr
-
-  return
-end subroutine fivehz
-
-subroutine fivehztx
-
-!  Called at interrupt level from the PortAudio output callback.
-
-#ifdef CVF
-  use dflib
-  use dfport
-#endif
-
-  parameter (NTRING=64)
-  real*8 tt1(0:NTRING-1)
-  logical first,filled
-  real*8 fs,fsample,tt,u
-  include 'gcom1.f90'
-  data first/.true./
-  save
-
-  n1=time()
-  n2=mod(n1,86400)
-  tt=n1-n2+tsec-0.1d0*ndsec
-
-  if(first) then
-     first=.false.
-     ncall=-1
-     fsample=11025.d0
-     u=0.05d0
-     mfsample2=110250
-     filled=.false.
-  endif
-
-! Measure average sampling frequency over a recent interval
-  ncall=ncall+1
-  if(ncall.eq.9) then
-     ntt0=0
-     ntt1=0
-     tt1(ntt1)=tt
-  endif
-  if(ncall.ge.10) then
-     ntt1=iand(ntt1+1,NTRING-1)
-     tt1(ntt1)=tt
-     if(ntt1.eq.NTRING-1) filled=.true.
-     if(filled) ntt0=iand(ntt1+1,NTRING-1)
-     if(mod(ncall,2).eq.1) then
-        nd=ntt1-ntt0
-        if(nd.lt.0) nd=nd+NTRING
-        fs=nd*2048.d0/(tt1(ntt1)-tt1(ntt0))
-        fsample=u*fs + (1.d0-u)*fsample
-        mfsample2=nint(10.d0*fsample)
-     endif
-  endif
-
-  return
-end subroutine fivehztx
-
-subroutine addnoise(n)
-  integer*2 n
-  real*8 txsnrdb0
-  include 'gcom1.f90'
-  data idum/0/
-  save
-
-  if(txsnrdb.gt.40.0) return
-  if(txsnrdb.ne.txsnrdb0) then
-     snr=10.0**(0.05*(txsnrdb-1))
-     fac=3000.0
-     if(snr.gt.1.0) fac=3000.0/snr
-     txsnrdb0=txsnrdb
-  endif
-  i=fac*(gran(idum) + n*snr/32768.0)
-  if(i&gt;32767) i=32767;
-  if(i&lt;-32767) i=-32767;
-  n=i
-
-  return
-end subroutine addnoise
-
-real function gran(idum)
-  real r(12)
-  if(idum.lt.0) then
-     call random_seed
-     idum=0
-  endif
-  call random_number(r)
-  gran=sum(r)-6.0
-end function gran

Deleted: branches/map65/fivehz.h
===================================================================
--- branches/map65/fivehz.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fivehz.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,5 +0,0 @@
-#include &lt;inttypes.h&gt;
-
-void addnoise_(int16_t *n2);
-void fivehztx_(void);
-void fivehz_(void);

Deleted: branches/map65/flat1.f
===================================================================
--- branches/map65/flat1.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/flat1.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,30 +0,0 @@
-      subroutine flat1(psavg,s2,nh,nsteps,nhmax,nsmax)
-
-      real psavg(nh)
-      real s2(nhmax,nsmax)
-      real x(8192),tmp(33)
-
-      nsmo=33
-      ia=nsmo/2 + 1
-      ib=nh - nsmo/2 - 1
-      do i=ia,ib
-         call pctile(psavg(i-nsmo/2),tmp,nsmo,50,x(i))
-      enddo
-      do i=1,ia-1
-         x(i)=x(ia)
-      enddo
-      do i=ib+1,nh
-         x(i)=x(ib)
-      enddo
-
-      do i=1,nh
-         psavg(i)=psavg(i)/x(i)
-         do j=1,nsteps
-            s2(i,j)=s2(i,j)/x(i)
-         enddo
-      enddo
-
-      return
-      end
-
-      

Deleted: branches/map65/flat2.f
===================================================================
--- branches/map65/flat2.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/flat2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,28 +0,0 @@
-      subroutine flat2(ss,n,nsum)
-
-      real ss(2048)
-      real ref(2048)
-      real tmp(2048)
-
-      nsmo=20
-      base=50*(float(nsum)**1.5)
-      ia=nsmo+1
-      ib=n-nsmo-1
-      do i=ia,ib
-         call pctile(ss(i-nsmo),tmp,2*nsmo+1,50,ref(i))
-      enddo
-      call pctile(ref(ia),tmp,ib-ia+1,68,base2)
-
-C  Don't flatten if signal is extremely low (e.g., RX is off).
-      if(base2.gt.0.05*base) then
-         do i=ia,ib
-            ss(i)=base*ss(i)/ref(i)
-         enddo
-      else
-         do i=1,n
-            ss(i)=0.
-         enddo
-      endif
-
-      return
-      end

Deleted: branches/map65/flatten.f
===================================================================
--- branches/map65/flatten.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/flatten.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,105 +0,0 @@
-      subroutine flatten(s2,nbins,jz,psa,ref,birdie,variance)
-
-C  Examines the 2-d spectrum s2(nbins,jz) and makes a reference spectrum
-C  from the jz/2 spectra below the 50th percentile in total power.  Uses
-C  reference spectrum (with birdies removed) to flatten the passband.
-
-      real s2(nbins,jz)               !2d spectrum
-      real psa(nbins)                 !Grand average spectrum
-      real ref(nbins)                 !Ref spect: smoothed ave of lower half
-      real birdie(nbins)              !Spec (with birdies) for plot, in dB
-      real variance(nbins)
-      real ref2(750)                  !Work array
-      real power(300)
-      
-C  Find power in each time block, then get median
-      do j=1,jz
-         s=0.
-         do i=1,nbins
-            s=s+s2(i,j)
-         enddo
-         power(j)=s
-      enddo
-      call pctile(power,ref2,jz,50,xmedian)
-      if(jz.lt.5) go to 900
-
-C  Get variance in each freq channel, using only those spectra with
-C  power below the median.
-      do i=1,nbins                        
-         s=0.
-         nsum=0
-         do j=1,jz
-            if(power(j).le.xmedian) then
-               s=s+s2(i,j)
-               nsum=nsum+1
-            endif
-         enddo
-         s=s/nsum
-         sq=0.
-         do j=1,jz
-            if(power(j).le.xmedian) sq=sq + (s2(i,j)/s-1.0)**2
-         enddo
-         variance(i)=sq/nsum
-      enddo
-
-C  Get grand average, and average of spectra with power below median.
-      call zero(psa,nbins)
-      call zero(ref,nbins)
-      nsum=0
-      do j=1,jz
-         call add(psa,s2(1,j),psa,nbins)
-         if(power(j).le.xmedian) then
-            call add(ref,s2(1,j),ref,nbins)
-            nsum=nsum+1
-         endif
-      enddo
-      do i=1,nbins                          !Normalize the averages
-         psa(i)=psa(i)/jz
-         ref(i)=ref(i)/nsum
-         birdie(i)=ref(i)                   !Copy ref into birdie
-      enddo
-
-C  Compute smoothed reference spectrum with narrow lines (birdies) removed
-      do i=4,nbins-3
-         rmax=-1.e10
-         do k=i-3,i+3                  !Get highest point within +/- 3 bins
-            if(ref(k).gt.rmax) then
-               rmax=ref(k)
-               kpk=k
-            endif
-         enddo
-         sum=0.
-         nsum=0
-         do k=i-3,i+3
-            if(abs(k-kpk).gt.1) then
-               sum=sum+ref(k)
-               nsum=nsum+1
-            endif
-         enddo
-         ref2(i)=sum/nsum
-      enddo
-      call move(ref2(4),ref(4),nbins-6)     !Copy smoothed ref back into ref
-      
-      call pctile(ref(4),ref2,nbins-6,50,xmedian)  !Get median in-band level
-
-C  Fix ends of reference spectrum
-      do i=1,3
-         ref(i)=ref(4)
-         ref(nbins+1-i)=ref(nbins-3)
-      enddo
-
-      facmax=30.0/xmedian
-      do i=1,nbins                          !Flatten the 2d spectrum
-         fac=xmedian/ref(i)
-         fac=min(fac,facmax)
-         do j=1,jz
-            s2(i,j)=fac*s2(i,j)
-         enddo
-         psa(i)=dB(psa(i)) + 25.
-         ref(i)=dB(ref(i)) + 25.
-         birdie(i)=db(birdie(i)) + 25.
-      enddo
-
-900   continue
-      return
-      end

Deleted: branches/map65/flushqqq.f90
===================================================================
--- branches/map65/flushqqq.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/flushqqq.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,10 +0,0 @@
-subroutine flushqqq(lu)
-
-#ifdef CVF
-  use dfport
-#endif
-
-  call flush(lu)
-
-  return
-end subroutine flushqqq

Deleted: branches/map65/four2.f
===================================================================
--- branches/map65/four2.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/four2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,350 +0,0 @@
-      SUBROUTINE FOUR2a (DATA,N,NDIM,ISIGN,IFORM)
-
-C     Cooley-Tukey fast Fourier transform in USASI basic Fortran.
-C     multi-dimensional transform, each dimension a power of two,
-C     complex or real data.
-
-C     TRANSFORM(K1,K2,...) = SUM(DATA(J1,J2,...)*EXP(ISIGN*2*PI*SQRT(-1)
-C     *((J1-1)*(K1-1)/N(1)+(J2-1)*(K2-1)/N(2)+...))), summed for all
-C     J1 and K1 from 1 to N(1), J2 and K2 from 1 TO N(2),
-C     etc, for all NDIM subscripts.  NDIM must be positive and
-C     each N(IDIM) must be a power of two.  ISIGN is +1 or -1.
-C     Let NTOT = N(1)*N(2)*...*N(NDIM).  Then a -1 transform
-C     followed by a +1 one (or vice versa) returns NTOT
-C     times the original data.  
-
-C     IFORM = 1, 0 or -1, as data is
-C     complex, real, or the first half of a complex array.  Transform
-C     values are returned in array DATA.  They are complex, real, or
-C     the first half of a complex array, as IFORM = 1, -1 or 0.
-
-C     The transform of a real array (IFORM = 0) dimensioned N(1) by N(2)
-C     by ... will be returned in the same array, now considered to
-C     be complex of dimensions N(1)/2+1 by N(2) by ....  Note that if
-C     IFORM = 0 or -1, N(1) must be even, and enough room must be
-C     reserved.  The missing values may be obtained by complex conjuga-
-C     tion.  
-
-C     The reverse transformation of a half complex array dimensioned
-C     N(1)/2+1 by N(2) by ..., is accomplished by setting IFORM
-C     to -1.  In the N array, N(1) must be the true N(1), not N(1)/2+1.
-C     The transform will be real and returned to the input array.
-
-C     Running time is proportional to NTOT*LOG2(NTOT), rather than
-C     the naive NTOT**2.  Furthermore, less error is built up.
-
-C     Written by Norman Brenner of MIT Lincoln Laboratory, January 1969.
-C     See IEEE Audio Transactions (June 1967), Special issue on FFT.
-
-      parameter(NMAX=2048*1024)
-      DIMENSION DATA(NMAX), N(1)
-      NTOT=1
-      DO 10 IDIM=1,NDIM
- 10   NTOT=NTOT*N(IDIM)
-      IF (IFORM) 70,20,20
- 20   NREM=NTOT
-      DO 60 IDIM=1,NDIM
-      NREM=NREM/N(IDIM)
-      NPREV=NTOT/(N(IDIM)*NREM)
-      NCURR=N(IDIM)
-      IF (IDIM-1+IFORM) 30,30,40
- 30   NCURR=NCURR/2
- 40   CALL BITRV (DATA,NPREV,NCURR,NREM)
-      CALL COOL2 (DATA,NPREV,NCURR,NREM,ISIGN)
-      IF (IDIM-1+IFORM) 50,50,60
- 50   CALL FIXRL (DATA,N(1),NREM,ISIGN,IFORM)
-      NTOT=(NTOT/N(1))*(N(1)/2+1)
- 60   CONTINUE
-      RETURN
- 70   NTOT=(NTOT/N(1))*(N(1)/2+1)
-      NREM=1
-      DO 100 JDIM=1,NDIM
-      IDIM=NDIM+1-JDIM
-      NCURR=N(IDIM)
-      IF (IDIM-1) 80,80,90
- 80   NCURR=NCURR/2
-      CALL FIXRL (DATA,N(1),NREM,ISIGN,IFORM)
-      NTOT=NTOT/(N(1)/2+1)*N(1)
- 90   NPREV=NTOT/(N(IDIM)*NREM)
-      CALL BITRV (DATA,NPREV,NCURR,NREM)
-      CALL COOL2 (DATA,NPREV,NCURR,NREM,ISIGN)
- 100  NREM=NREM*N(IDIM)
-      RETURN
-      END
-      SUBROUTINE BITRV (DATA,NPREV,N,NREM)
-C     SHUFFLE THE DATA BY BIT REVERSAL.
-C     DIMENSION DATA(NPREV,N,NREM)
-C     COMPLEX DATA
-C     EXCHANGE DATA(J1,J4REV,J5) WITH DATA(J1,J4,J5) FOR ALL J1 FROM 1
-C     TO NPREV, ALL J4 FROM 1 TO N (WHICH MUST BE A POWER OF TWO), AND
-C     ALL J5 FROM 1 TO NREM.  J4REV-1 IS THE BIT REVERSAL OF J4-1.  E.G.
-C     SUPPOSE N = 32.  THEN FOR J4-1 = 10011, J4REV-1 = 11001, ETC.
-      parameter(NMAX=2048*1024)
-      DIMENSION DATA(NMAX)
-      IP0=2
-      IP1=IP0*NPREV
-      IP4=IP1*N
-      IP5=IP4*NREM
-      I4REV=1
-C     I4REV = 1+(J4REV-1)*IP1
-      DO 60 I4=1,IP4,IP1
-C     I4 = 1+(J4-1)*IP1
-      IF (I4-I4REV) 10,30,30
- 10   I1MAX=I4+IP1-IP0
-      DO 20 I1=I4,I1MAX,IP0
-C     I1 = 1+(J1-1)*IP0+(J4-1)*IP1
-      DO 20 I5=I1,IP5,IP4
-C     I5 = 1+(J1-1)*IP0+(J4-1)*IP1+(J5-1)*IP4
-      I5REV=I4REV+I5-I4
-C     I5REV = 1+(J1-1)*IP0+(J4REV-1)*IP1+(J5-1)*IP4
-      TEMPR=DATA(I5)
-      TEMPI=DATA(I5+1)
-      DATA(I5)=DATA(I5REV)
-      DATA(I5+1)=DATA(I5REV+1)
-      DATA(I5REV)=TEMPR
- 20   DATA(I5REV+1)=TEMPI
-C     ADD ONE WITH DOWNWARD CARRY TO THE HIGH ORDER BIT OF J4REV-1.
- 30   IP2=IP4/2
- 40   IF (I4REV-IP2) 60,60,50
- 50   I4REV=I4REV-IP2
-      IP2=IP2/2
-      IF (IP2-IP1) 60,40,40
- 60   I4REV=I4REV+IP2
-      RETURN
-      END
-      SUBROUTINE COOL2 (DATA,NPREV,N,NREM,ISIGN)
-C     DISCRETE FOURIER TRANSFORM OF LENGTH N.  IN-PLACE COOLEY-TUKEY
-C     ALGORITHM, BIT-REVERSED TO NORMAL ORDER, SANDE-TUKEY PHASE SHIFTS.
-C     DIMENSION DATA(NPREV,N,NREM)
-C     COMPLEX DATA
-C     DATA(J1,K4,J5) = SUM(DATA(J1,J4,J5)*EXP(ISIGN*2*PI*I*(J4-1)*
-C     (K4-1)/N)), SUMMED OVER J4 = 1 TO N FOR ALL J1 FROM 1 TO NPREV,
-C     K4 FROM 1 TO N AND J5 FROM 1 TO NREM.  N MUST BE A POWER OF TWO.
-C     METHOD--LET IPREV TAKE THE VALUES 1, 2 OR 4, 4 OR 8, ..., N/16,
-C     N/4, N.  THE CHOICE BETWEEN 2 OR 4, ETC., DEPENDS ON WHETHER N IS
-C     A POWER OF FOUR.  DEFINE IFACT = 2 OR 4, THE NEXT FACTOR THAT
-C     IPREV MUST TAKE, AND IREM = N/(IFACT*IPREV).  THEN--
-C     DIMENSION DATA(NPREV,IPREV,IFACT,IREM,NREM)
-C     COMPLEX DATA
-C     DATA(J1,J2,K3,J4,J5) = SUM(DATA(J1,J2,J3,J4,J5)*EXP(ISIGN*2*PI*I*
-C     (K3-1)*((J3-1)/IFACT+(J2-1)/(IFACT*IPREV)))), SUMMED OVER J3 = 1
-C     TO IFACT FOR ALL J1 FROM 1 TO NPREV, J2 FROM 1 TO IPREV, K3 FROM
-C     1 TO IFACT, J4 FROM 1 TO IREM AND J5 FROM 1 TO NREM.  THIS IS
-C     A PHASE-SHIFTED DISCRETE FOURIER TRANSFORM OF LENGTH IFACT.
-C     FACTORING N BY FOURS SAVES ABOUT TWENTY FIVE PERCENT OVER FACTOR-
-C     ING BY TWOS.  DATA MUST BE BIT-REVERSED INITIALLY.
-C     IT IS NOT NECESSARY TO REWRITE THIS SUBROUTINE INTO COMPLEX
-C     NOTATION SO LONG AS THE FORTRAN COMPILER USED STORES REAL AND
-C     IMAGINARY PARTS IN ADJACENT STORAGE LOCATIONS.  IT MUST ALSO
-C     STORE ARRAYS WITH THE FIRST SUBSCRIPT INCREASING FASTEST.
-      parameter(NMAX=2048*1024)
-      DIMENSION DATA(NMAX)
-
-      real*8 twopi,wstpr,wstpi,wr,wi,w2r,w2i,w3r,w3i,wtempr
-
-      TWOPI=6.2831853072*FLOAT(ISIGN)
-      IP0=2
-      IP1=IP0*NPREV
-      IP4=IP1*N
-      IP5=IP4*NREM
-      IP2=IP1
-C     IP2=IP1*IPROD
-      NPART=N
- 10   IF (NPART-2) 60,30,20
- 20   NPART=NPART/4
-      GO TO 10
-C     DO A FOURIER TRANSFORM OF LENGTH TWO
- 30   IF (IP2-IP4) 40,160,160
- 40   IP3=IP2*2
-C     IP3=IP2*IFACT
-      DO 50 I1=1,IP1,IP0
-C     I1 = 1+(J1-1)*IP0
-      DO 50 I5=I1,IP5,IP3
-C     I5 = 1+(J1-1)*IP0+(J4-1)*IP3+(J5-1)*IP4
-      I3A=I5
-      I3B=I3A+IP2
-C     I3 = 1+(J1-1)*IP0+(J2-1)*IP1+(J3-1)*IP2+(J4-1)*IP3+(J5-1)*IP4
-      TEMPR=DATA(I3B)
-      TEMPI=DATA(I3B+1)
-      DATA(I3B)=DATA(I3A)-TEMPR
-      DATA(I3B+1)=DATA(I3A+1)-TEMPI
-      DATA(I3A)=DATA(I3A)+TEMPR
- 50   DATA(I3A+1)=DATA(I3A+1)+TEMPI
-      IP2=IP3
-C     DO A FOURIER TRANSFORM OF LENGTH FOUR (FROM BIT REVERSED ORDER)
- 60   IF (IP2-IP4) 70,160,160
- 70   IP3=IP2*4
-C     IP3=IP2*IFACT
-C     COMPUTE TWOPI THRU WR AND WI IN DOUBLE PRECISION, IF AVAILABLE.
-      THETA=TWOPI/FLOAT(IP3/IP1)
-      SINTH=SIN(THETA/2)
-      WSTPR=-2*SINTH*SINTH
-      WSTPI=SIN(THETA)
-      WR=1.
-      WI=0.
-      DO 150 I2=1,IP2,IP1
-C     I2 = 1+(J2-1)*IP1
-      IF (I2-1) 90,90,80
- 80   W2R=WR*WR-WI*WI
-      W2I=2*WR*WI
-      W3R=W2R*WR-W2I*WI
-      W3I=W2R*WI+W2I*WR
- 90   I1MAX=I2+IP1-IP0
-      DO 140 I1=I2,I1MAX,IP0
-C     I1 = 1+(J1-1)*IP0+(J2-1)*IP1
-      DO 140 I5=I1,IP5,IP3
-C     I5 = 1+(J1-1)*IP0+(J2-1)*IP1+(J4-1)*IP3+(J5-1)*IP4
-      I3A=I5
-      I3B=I3A+IP2
-      I3C=I3B+IP2
-      I3D=I3C+IP2
-C     I3 = 1+(J1-1)*IP0+(J2-1)*IP1+(J3-1)*IP2+(J4-1)*IP3+(J5-1)*IP4
-      IF (I2-1) 110,110,100
-C     APPLY THE PHASE SHIFT FACTORS
- 100  TEMPR=DATA(I3B)
-      DATA(I3B)=W2R*DATA(I3B)-W2I*DATA(I3B+1)
-      DATA(I3B+1)=W2R*DATA(I3B+1)+W2I*TEMPR
-      TEMPR=DATA(I3C)
-      DATA(I3C)=WR*DATA(I3C)-WI*DATA(I3C+1)
-      DATA(I3C+1)=WR*DATA(I3C+1)+WI*TEMPR
-      TEMPR=DATA(I3D)
-      DATA(I3D)=W3R*DATA(I3D)-W3I*DATA(I3D+1)
-      DATA(I3D+1)=W3R*DATA(I3D+1)+W3I*TEMPR
- 110  T0R=DATA(I3A)+DATA(I3B)
-      T0I=DATA(I3A+1)+DATA(I3B+1)
-      T1R=DATA(I3A)-DATA(I3B)
-      T1I=DATA(I3A+1)-DATA(I3B+1)
-      T2R=DATA(I3C)+DATA(I3D)
-      T2I=DATA(I3C+1)+DATA(I3D+1)
-      T3R=DATA(I3C)-DATA(I3D)
-      T3I=DATA(I3C+1)-DATA(I3D+1)
-      DATA(I3A)=T0R+T2R
-      DATA(I3A+1)=T0I+T2I
-      DATA(I3C)=T0R-T2R
-      DATA(I3C+1)=T0I-T2I
-      IF (ISIGN) 120,120,130
- 120  T3R=-T3R
-      T3I=-T3I
- 130  DATA(I3B)=T1R-T3I
-      DATA(I3B+1)=T1I+T3R
-      DATA(I3D)=T1R+T3I
- 140  DATA(I3D+1)=T1I-T3R
-      WTEMPR=WR
-      WR=WSTPR*WTEMPR-WSTPI*WI+WTEMPR
- 150  WI=WSTPR*WI+WSTPI*WTEMPR+WI
-      IP2=IP3
-      GO TO 60
- 160  RETURN
-      END
-      SUBROUTINE FIXRL (DATA,N,NREM,ISIGN,IFORM)
-C     FOR IFORM = 0, CONVERT THE TRANSFORM OF A DOUBLED-UP REAL ARRAY,
-C     CONSIDERED COMPLEX, INTO ITS TRUE TRANSFORM.  SUPPLY ONLY THE
-C     FIRST HALF OF THE COMPLEX TRANSFORM, AS THE SECOND HALF HAS
-C     CONJUGATE SYMMETRY.  FOR IFORM = -1, CONVERT THE FIRST HALF
-C     OF THE TRUE TRANSFORM INTO THE TRANSFORM OF A DOUBLED-UP REAL
-C     ARRAY.  N MUST BE EVEN.
-C     USING COMPLEX NOTATION AND SUBSCRIPTS STARTING AT ZERO, THE
-C     TRANSFORMATION IS--
-C     DIMENSION DATA(N,NREM)
-C     ZSTP = EXP(ISIGN*2*PI*I/N)
-C     DO 10 I2=0,NREM-1
-C     DATA(0,I2) = CONJ(DATA(0,I2))*(1+I)
-C     DO 10 I1=1,N/4
-C     Z = (1+(2*IFORM+1)*I*ZSTP**I1)/2
-C     I1CNJ = N/2-I1
-C     DIF = DATA(I1,I2)-CONJ(DATA(I1CNJ,I2))
-C     TEMP = Z*DIF
-C     DATA(I1,I2) = (DATA(I1,I2)-TEMP)*(1-IFORM)
-C 10  DATA(I1CNJ,I2) = (DATA(I1CNJ,I2)+CONJ(TEMP))*(1-IFORM)
-C     IF I1=I1CNJ, THE CALCULATION FOR THAT VALUE COLLAPSES INTO
-C     A SIMPLE CONJUGATION OF DATA(I1,I2).
-      parameter(NMAX=2048*1024)
-      DIMENSION DATA(NMAX)
-      TWOPI=6.283185307*FLOAT(ISIGN)
-      IP0=2
-      IP1=IP0*(N/2)
-      IP2=IP1*NREM
-      IF (IFORM) 10,70,70
-C     PACK THE REAL INPUT VALUES (TWO PER COLUMN)
- 10   J1=IP1+1
-      DATA(2)=DATA(J1)
-      IF (NREM-1) 70,70,20
- 20   J1=J1+IP0
-      I2MIN=IP1+1
-      DO 60 I2=I2MIN,IP2,IP1
-      DATA(I2)=DATA(J1)
-      J1=J1+IP0
-      IF (N-2) 50,50,30
- 30   I1MIN=I2+IP0
-      I1MAX=I2+IP1-IP0
-      DO 40 I1=I1MIN,I1MAX,IP0
-      DATA(I1)=DATA(J1)
-      DATA(I1+1)=DATA(J1+1)
- 40   J1=J1+IP0
- 50   DATA(I2+1)=DATA(J1)
- 60   J1=J1+IP0
- 70   DO 80 I2=1,IP2,IP1
-      TEMPR=DATA(I2)
-      DATA(I2)=DATA(I2)+DATA(I2+1)
- 80   DATA(I2+1)=TEMPR-DATA(I2+1)
-      IF (N-2) 200,200,90
- 90   THETA=TWOPI/FLOAT(N)
-      SINTH=SIN(THETA/2.)
-      ZSTPR=-2.*SINTH*SINTH
-      ZSTPI=SIN(THETA)
-      ZR=(1.-ZSTPI)/2.
-      ZI=(1.+ZSTPR)/2.
-      IF (IFORM) 100,110,110
- 100  ZR=1.-ZR
-      ZI=-ZI
- 110  I1MIN=IP0+1
-      I1MAX=IP0*(N/4)+1
-      DO 190 I1=I1MIN,I1MAX,IP0
-      DO 180 I2=I1,IP2,IP1
-      I2CNJ=IP0*(N/2+1)-2*I1+I2
-      IF (I2-I2CNJ) 150,120,120
- 120  IF (ISIGN*(2*IFORM+1)) 130,140,140
- 130  DATA(I2+1)=-DATA(I2+1)
- 140  IF (IFORM) 170,180,180
- 150  DIFR=DATA(I2)-DATA(I2CNJ)
-      DIFI=DATA(I2+1)+DATA(I2CNJ+1)
-      TEMPR=DIFR*ZR-DIFI*ZI
-      TEMPI=DIFR*ZI+DIFI*ZR
-      DATA(I2)=DATA(I2)-TEMPR
-      DATA(I2+1)=DATA(I2+1)-TEMPI
-      DATA(I2CNJ)=DATA(I2CNJ)+TEMPR
-      DATA(I2CNJ+1)=DATA(I2CNJ+1)-TEMPI
-      IF (IFORM) 160,180,180
- 160  DATA(I2CNJ)=DATA(I2CNJ)+DATA(I2CNJ)
-      DATA(I2CNJ+1)=DATA(I2CNJ+1)+DATA(I2CNJ+1)
- 170  DATA(I2)=DATA(I2)+DATA(I2)
-      DATA(I2+1)=DATA(I2+1)+DATA(I2+1)
- 180  CONTINUE
-      TEMPR=ZR-.5
-      ZR=ZSTPR*TEMPR-ZSTPI*ZI+ZR
- 190  ZI=ZSTPR*ZI+ZSTPI*TEMPR+ZI
-C     RECURSION SAVES TIME, AT A SLIGHT LOSS IN ACCURACY.  IF AVAILABLE,
-C     USE DOUBLE PRECISION TO COMPUTE ZR AND ZI.
- 200  IF (IFORM) 270,210,210
-C     UNPACK THE REAL TRANSFORM VALUES (TWO PER COLUMN)
- 210  I2=IP2+1
-      I1=I2
-      J1=IP0*(N/2+1)*NREM+1
-      GO TO 250
- 220  DATA(J1)=DATA(I1)
-      DATA(J1+1)=DATA(I1+1)
-      I1=I1-IP0
-      J1=J1-IP0
- 230  IF (I2-I1) 220,240,240
- 240  DATA(J1)=DATA(I1)
-      DATA(J1+1)=0.
- 250  I2=I2-IP1
-      J1=J1-IP0
-      DATA(J1)=DATA(I2+1)
-      DATA(J1+1)=0.
-      I1=I1-IP0
-      J1=J1-IP0
-      IF (I2-1) 260,260,230
- 260  DATA(2)=0.
- 270  RETURN
-      END

Deleted: branches/map65/four2a.f
===================================================================
--- branches/map65/four2a.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/four2a.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,111 +0,0 @@
-      subroutine four2a(a,nfft,ndim,isign,iform)
-
-C     IFORM = 1, 0 or -1, as data is
-C     complex, real, or the first half of a complex array.  Transform
-C     values are returned in array DATA.  They are complex, real, or
-C     the first half of a complex array, as IFORM = 1, -1 or 0.
-
-C     The transform of a real array (IFORM = 0) dimensioned N(1) by N(2)
-C     by ... will be returned in the same array, now considered to
-C     be complex of dimensions N(1)/2+1 by N(2) by ....  Note that if
-C     IFORM = 0 or -1, N(1) must be even, and enough room must be
-C     reserved.  The missing values may be obtained by complex conjuga-
-C     tion.  
-
-C     The reverse transformation of a half complex array dimensioned
-C     N(1)/2+1 by N(2) by ..., is accomplished by setting IFORM
-C     to -1.  In the N array, N(1) must be the true N(1), not N(1)/2+1.
-C     The transform will be real and returned to the input array.
-
-      parameter (NPMAX=100)
-      parameter (NSMALL=16384)
-      complex a(nfft)
-      complex aa(NSMALL)
-      integer nn(NPMAX),ns(NPMAX),nf(NPMAX),nl(NPMAX)
-      real*8 plan(NPMAX)             !Actually should be i*8, but no matter
-      data nplan/0/
-      include 'fftw3.f'
-      save plan,nplan,nn,ns,nf,nl
-
-      if(nfft.lt.0 .or. ndim.lt.0) go to 999
-
-      nloc=loc(a)
-      do i=1,nplan
-         if(nfft.eq.nn(i) .and. isign.eq.ns(i) .and.
-     +      iform.eq.nf(i) .and. nloc.eq.nl(i)) go to 10
-      enddo
-      if(nplan.ge.NPMAX) stop 'Too many FFTW plans requested.'
-      nplan=nplan+1
-      i=nplan
-      nn(i)=nfft
-      ns(i)=isign
-      nf(i)=iform
-      nl(i)=nloc
-
-C  Planning: FFTW_ESTIMATE, FFTW_ESTIMATE_PATIENT, FFTW_MEASURE, 
-C            FFTW_PATIENT,  FFTW_EXHAUSTIVE
-      npatience=1
-      nflags=FFTW_ESTIMATE
-      if(npatience.eq.1) nflags=FFTW_ESTIMATE_PATIENT
-      if(npatience.eq.2) nflags=FFTW_MEASURE
-      if(npatience.eq.3) nflags=FFTW_PATIENT
-      if(npatience.eq.4) nflags=FFTW_EXHAUSTIVE
-      if(nfft.le.NSMALL) then
-         jz=nfft
-         if(iform.eq.0) jz=nfft/2
-         do j=1,jz
-            aa(j)=a(j)
-         enddo
-      endif
-      call sleep_msec(0)
-      if(isign.eq.-1 .and. iform.eq.1) then
-#ifdef CVF
-         call sfftw_plan_dft_1d_(plan(i),nfft,a,a,FFTW_FORWARD,nflags)
-      else if(isign.eq.1 .and. iform.eq.1) then
-         call sfftw_plan_dft_1d_(plan(i),nfft,a,a,FFTW_BACKWARD,nflags)
-      else if(isign.eq.-1 .and. iform.eq.0) then
-         call sfftw_plan_dft_r2c_1d_(plan(i),nfft,a,a,nflags)
-      else if(isign.eq.1 .and. iform.eq.-1) then
-         call sfftw_plan_dft_c2r_1d_(plan(i),nfft,a,a,nflags)
-#else
-         call sfftw_plan_dft_1d(plan(i),nfft,a,a,FFTW_FORWARD,nflags)
-      else if(isign.eq.1 .and. iform.eq.1) then
-         call sfftw_plan_dft_1d(plan(i),nfft,a,a,FFTW_BACKWARD,nflags)
-      else if(isign.eq.-1 .and. iform.eq.0) then
-         call sfftw_plan_dft_r2c_1d(plan(i),nfft,a,a,nflags)
-      else if(isign.eq.1 .and. iform.eq.-1) then
-         call sfftw_plan_dft_c2r_1d(plan(i),nfft,a,a,nflags)
-#endif
-      else
-         stop 'Unsupported request in four2a'
-      endif
-      call sleep_msec(0)
-      i=nplan
-      if(nfft.le.NSMALL) then
-         jz=nfft
-         if(iform.eq.0) jz=nfft/2
-         do j=1,jz
-            a(j)=aa(j)
-         enddo
-      endif
-
- 10   continue
-      call sleep_msec(0)
-#ifdef CVF
-      call sfftw_execute_(plan(i))
-#else
-      call sfftw_execute(plan(i))
-#endif
-      call sleep_msec(0)
-      return
-
- 999  do i=1,nplan
-#ifdef CVF
-         call sfftw_destroy_plan_(plan(i))
-#else
-         call sfftw_destroy_plan(plan(i))
-#endif
-      enddo
-
-      return
-      end

Deleted: branches/map65/fstatqqq.f90
===================================================================
--- branches/map65/fstatqqq.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fstatqqq.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,14 +0,0 @@
-subroutine fstatqqq(lu,istat,ierr)
-
-#ifdef CVF
-  use dfport
-#endif
-
-#ifdef CVF
-  ierr=fstat(lu,istat)
-#else
-  call fstat(lu,istat,ierr)
-#endif
-
-  return
-end subroutine fstatqqq

Deleted: branches/map65/fthread.c
===================================================================
--- branches/map65/fthread.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/fthread.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,74 +0,0 @@
-/*
-* fthread.c
-*
-* pthread library interface to Fortran, for OSs supporting pthreads
-*
-* Adapted from code by V. Ganesh
-*/
-#include &lt;stdio.h&gt;
-#include &lt;pthread.h&gt;
-
-// Create a new fortran thread through a subroutine.
-void fthread_create_(void *(*thread_func)(void *), pthread_t *theThread) 
-{
-  pthread_create(theThread, NULL, thread_func, NULL);
-} 
-
-/*
-// Yield control to other threads
-void fthread_yield_() 
-{
-  pthread_yield();
-}
-*/
-
-// Return my own thread ID
-pthread_t fthread_self_() 
-{
-  return pthread_self();
-} 
-
-// Lock the execution of all threads until we have the mutex
-int fthread_mutex_lock_(pthread_mutex_t **theMutex) 
-{
-  return(pthread_mutex_lock(*theMutex));
-}
-
-int fthread_mutex_trylock_(pthread_mutex_t **theMutex) 
-{
-  return(pthread_mutex_trylock(*theMutex));
-}
-
-// Unlock the execution of all threads that were stopped by this mutex
-void fthread_mutex_unlock_(pthread_mutex_t **theMutex) 
-{
-  pthread_mutex_unlock(*theMutex);
-}
-
-// Get a new mutex object
-void fthread_mutex_init_(pthread_mutex_t **theMutex) 
-{
-  *theMutex = (pthread_mutex_t *) malloc(sizeof(pthread_mutex_t));
-  pthread_mutex_init(*theMutex, NULL);
-}
-
-// Release a mutex object
-void fthread_mutex_destroy_(pthread_mutex_t **theMutex) 
-{
-  pthread_mutex_destroy(*theMutex);
-  free(*theMutex);
-}
-
-// Waits for thread ID to join
-void fthread_join(pthread_t *theThread) 
-{
-  int value = 0;
-  pthread_join(*theThread, (void **)&amp;value);
-}
-
-// Exit from a thread
-void fthread_exit_(void *status) 
-{
-  pthread_exit(status);
-}
-

Deleted: branches/map65/ftn_init.f90
===================================================================
--- branches/map65/ftn_init.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/ftn_init.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,171 +0,0 @@
-! Fortran logical units used in WSJT6
-!
-!   10  binary input data, *.tf2 files
-!   11  decoded.txt
-!   12  decoded.ave
-!   13  tsky.dat
-!   14  azel.dat
-!   15  
-!   16
-!   17  saved *.tf2 files
-!   18  test file to be transmitted (wsjtgen.f90)
-!   19  messages.txt
-!   20  bandmap.txt
-!   21  ALL65.TXT
-!   22  kvasd.dat
-!   23  CALL3.TXT
-!   24  meas24.dat
-!   25  meas25.dat
-!   26  tmp26.txt
-!   27  dphi.txt
-!   28  fftw_wisdom.dat
-!   29  debug.txt
-!------------------------------------------------ ftn_init
-subroutine ftn_init
-
-  character*1 cjunk
-  integer ptt
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-  include 'gcom3.f90'
-  include 'gcom4.f90'
-
-  call cs_init
-  call cs_lock('ftn_init')
-  i=ptt(nport,pttport,0,iptt)                       !Clear the PTT line
-  addpfx='    '
-  nrw26=0
-
-  do i=80,1,-1
-     if(AppDir(i:i).ne.' ') goto 1
-  enddo
-1 iz=i
-  lenappdir=iz
-  call pfxdump(appdir(:iz)//'/prefixes.txt')
-
-  do i=80,1,-1
-     if(AzElDir(i:i).ne.' ') goto 2
-  enddo
-2 iz2=i
-
-#ifdef CVF
-  open(11,file=appdir(:iz)//'/decoded.txt',status='unknown',               &amp;
-       share='denynone',err=910)
-#else
-  open(11,file=appdir(:iz)//'/decoded.txt',status='unknown',               &amp;
-       err=910)
-#endif
-  endfile 11
-
-#ifdef CVF
-  open(12,file=appdir(:iz)//'/decoded.ave',status='unknown',               &amp;
-       share='denynone',err=920)
-#else
-  open(12,file=appdir(:iz)//'/decoded.ave',status='unknown',               &amp;
-       err=920)
-#endif
-  endfile 12
-
-#ifdef CVF
-  open(14,file=azeldir(:iz2)//'/azel.dat',status='unknown',                  &amp;
-       share='denynone',err=930)
-#else
-  open(14,file=azeldir(:iz2)//'/azel.dat',status='unknown',                  &amp;
-       err=930)
-#endif
-
-#ifdef CVF
-  open(19,file=appdir(:iz)//'/messages.txt',status='unknown',               &amp;
-       share='denynone',err=911)
-#else
-  open(19,file=appdir(:iz)//'/messages.txt',status='unknown',               &amp;
-       err=911)
-#endif
-  endfile 19
-
-#ifdef CVF
-  open(20,file=appdir(:iz)//'/bandmap.txt',status='unknown',               &amp;
-       share='denynone',err=912)
-#else
-  open(20,file=appdir(:iz)//'/bandmap.txt',status='unknown',               &amp;
-       err=912)
-#endif
-  endfile 20
-
-#ifdef CVF
-  open(21,file=appdir(:iz)//'/ALL65.TXT',status='unknown',                   &amp;
-       access='append',share='denynone',err=950)
-#else
-  open(21,file=appdir(:iz)//'/ALL65.TXT',status='unknown',                   &amp;
-	access='append',err=950)
-  do i=1,9999999
-     read(21,*,end=10) cjunk
-  enddo
-10 continue
-#endif
-
-#ifdef CVF
-  open(22,file=appdir(:iz)//'/kvasd.dat',access='direct',recl=1024,        &amp;
-       status='unknown',share='denynone')
-#else
-  open(22,file=appdir(:iz)//'/kvasd.dat',access='direct',recl=1024,        &amp;
-       status='unknown')
-#endif
-
-#ifdef CVF
-  open(24,file=appdir(:iz)//'/meas24.txt',status='unknown',                 &amp;
-       share='denynone')
-#else
-  open(24,file=appdir(:iz)//'/meas24.txt',status='unknown')
-#endif
-
-#ifdef CVF
-  open(25,file=appdir(:iz)//'/meas25.txt',status='unknown',                 &amp;
-       share='denynone')
-#else
-  open(25,file=appdir(:iz)//'/meas25.txt',status='unknown')
-#endif
-
-#ifdef CVF
-  open(26,file=appdir(:iz)//'/tmp26.txt',status='unknown',                 &amp;
-       share='denynone')
-#else
-  open(26,file=appdir(:iz)//'/tmp26.txt',status='unknown')
-#endif
-
-#ifdef CVF
-  open(27,file=appdir(:iz)//'/dphi.txt',status='unknown',                 &amp;
-       share='denynone')
-#else
-  open(27,file=appdir(:iz)//'/dphi.txt',status='unknown')
-  open(28,file='fftw_wisdom.dat',status='unknown')
-  call import_wisdom_from_file(isuccess,28)
-  close(28)
-  if(isuccess.ne.0) write(*,1000) 
-1000 format('Using optimized FFTs.')
-#endif
-
-#ifdef CVF
-  open(29,file=appdir(:iz)//'/debug.txt',status='unknown',                 &amp;
-       share='denynone')
-#else
-  open(29,file=appdir(:iz)//'/debug.txt',status='unknown')
-#endif
-
-  call cs_unlock
-  return
-
-910 print*,'Error opening DECODED.TXT'
-  stop
-911 print*,'Error opening messages.txt'
-  stop
-912 print*,'Error opening bandmap.txt'
-  stop
-920 print*,'Error opening DECODED.AVE'
-  stop
-930 print*,'Error opening AZEL.DAT'
-  stop
-950 print*,'Error opening ALL65.TXT'
-  stop
-
-end subroutine ftn_init

Deleted: branches/map65/ftn_quit.f90
===================================================================
--- branches/map65/ftn_quit.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/ftn_quit.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,9 +0,0 @@
-!------------------------------------------------ ftn_quit
-subroutine ftn_quit
-  include 'gcom1.f90'
-  ngo=0
-! Destroy the FFTW plans
-  call four2a(a,-1,1,1,1)
-  call filbig(id,-1,f0,newdat,c4a,c4b,n4)
-  return
-end subroutine ftn_quit

Deleted: branches/map65/ftsky.f
===================================================================
--- branches/map65/ftsky.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/ftsky.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,24 +0,0 @@
-      real function ftsky(l,b)
-
-C  Returns 408 MHz sky temperature for l,b (in degrees), from 
-C  Haslam, et al. survey.  Must have already read the entire
-C  file tsky.dat into memory.
-
-      real*4 l,b
-      integer*2 nsky
-      common/sky/ nsky(360,180)
-      save
-
-      j=nint(b+91.0)
-      if(j.gt.180) j=180
-      xl=l
-      if(xl.lt.0.0) xl=xl+360.0
-      i=nint(xl+1.0)
-      if(i.gt.360) i=i-360
-      ftsky=0.0
-      if(i.ge.1 .and. i.le.360 .and. j.ge.1 .and. j.le.180) then
-         ftsky=0.1*nsky(i,j)
-      endif
-
-      return
-      end

Deleted: branches/map65/g.py
===================================================================
--- branches/map65/g.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/g.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,32 +0,0 @@
-DFreq=0.0
-Freq=0.0
-PingTime=0.0
-PingFile=&quot;current&quot;
-report=&quot;26&quot;
-rms=1.0
-mode_change=0
-showspecjt=0
-g2font='courier 16 bold'
-
-#------------------------------------------------------ ftnstr
-def ftnstr(x):
-    y=&quot;&quot;
-    xs=x.tostring()
-    for i in range(len(xs)):
-        y=y+xs[i]
-    return y
-
-#------------------------------------------------------ filetime
-def filetime(t):
-#    i=t.rfind(&quot;.&quot;)
-    i=rfnd(t,&quot;.&quot;)
-    t=t[:i][-6:]
-    t=t[0:2]+&quot;:&quot;+t[2:4]+&quot;:&quot;+t[4:6]
-    return t
-
-#------------------------------------------------------ rfnd
-#Temporary workaround to replace t.rfind(c)
-def rfnd(t,c):
-    for i in range(len(t)-1,0,-1):
-        if t[i:i+1]==c: return i
-    return -1

Deleted: branches/map65/gcom1.f90
===================================================================
--- branches/map65/gcom1.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/gcom1.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,51 +0,0 @@
-! Variable             Purpose                               Set in Thread
-!---------------------------------------------------------------------------
-integer NRXMAX         !Max length of Rx ring buffers
-integer NTXMAX         !Max length of Tx waveform in samples
-parameter(NRXMAX=2097152)  ! =2048*1024
-parameter(NTXMAX=1653750)  ! =150*11025
-real*8 tbuf            !Tsec at time of input callback          SoundIn
-integer ntrbuf         !(obsolete?)
-real*8 Tsec            !Present time                       SoundIn,SoundOut
-real*8 rxdelay         !Delay between PTT=1 and Tx audio        SoundIn
-real*8 txdelay         !Delay from end of Tx Audio and PTT=0    SoundOut
-real*8 samfacin        !(Input sample rate)/11025               GUI
-real*8 samfacout       !(Output sample rate)/11025              GUI
-real*8 txsnrdb         !SNR for simulations                     GUI
-integer*2 y1           !Ring buffer for audio channel 0         SoundIn
-integer*2 y2           !Ring buffer for audio channel 1         SoundIn
-integer nmax           !Actual length of Rx ring buffers        GUI
-integer iwrite         !Write pointer to Rx ring buffer         SoundIn
-integer iread          !Read pointer to Rx ring buffer          GUI
-integer*2 iwave        !Data for audio output                   SoundIn
-integer nwave          !Number of samples in iwave              SoundIn
-integer TxOK           !OK to transmit?                         SoundIn
-!                       NB: TxOK=1 only in SoundIn; TxOK=0 also in GUI
-integer Receiving      !Actually receiving?                     SoundIn
-integer Transmitting   !Actually transmitting?                  SoundOut
-integer TxFirst        !Transmit first?                         GUI
-integer TRPeriod       !Tx or Rx period in seconds              GUI
-integer ibuf           !Most recent input buffer#               SoundIn
-integer ibuf0          !Buffer# at start of Rx sequence         SoundIn
-real ave               !(why is this here?)                     GUI
-real rms               !(why is this here?)                     GUI
-integer ngo            !Set to 0 to terminate audio streams     GUI
-integer level          !S-meter level, 0-100                    GUI
-integer mute           !True means &quot;don't transmit&quot;             GUI
-integer newdat         !New data available for waterfall?       GUI
-integer ndsec          !Dsec in units of 0.1 s                  GUI
-integer ndevin         !Device# for audio input                 GUI
-integer ndevout        !Device# for audio output                GUI
-integer mfsample       !Measured sample rate, input             SoundIn
-integer mfsample2      !Measured sample rate, output            SoundOut
-integer ns0            !Time at last ALL.TXT date entry         Decoder
-character*12 devin_name,devout_name ! GUI
-
-common/gcom1/Tbuf(1024),ntrbuf(1024),Tsec,rxdelay,txdelay,              &amp;
-     samfacin,samfacout,txsnrdb,y1(NRXMAX),y2(NRXMAX),                  &amp;
-     nmax,iwrite,iread,iwave(NTXMAX),nwave,TxOK,Receiving,Transmitting, &amp;
-     TxFirst,TRPeriod,ibuf,ibuf0,ave,rms,ngo,level,mute,newdat,ndsec,   &amp;
-     ndevin,ndevout,mfsample,mfsample2,ns0,devin_name,devout_name
-
-!### volatile /gcom1/
-

Deleted: branches/map65/gcom2.f90
===================================================================
--- branches/map65/gcom2.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/gcom2.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,124 +0,0 @@
-! Variable             Purpose                              Set in Thread
-!-------------------------------------------------------------------------
-real*8 fcenter         !Linrad center freq, from pkt header   recvpkt
-real*8 forcefcenter    !Optional override of fcenter            GUI
-real ps0               !Spectrum of best ping, FSK441/JT6m      Decoder
-real psavg             !Average spectrum                        Decoder
-real s2                !2d spectrum for horizontal waterfall    GUI
-real ccf               !CCF in time (blue curve)                Decoder
-real green             !Data for green line                     GUI
-real fselect           !Specified QSO frequency                 GUI
-real pctlost           !Percent of lost packets                 Decoder
-real pctblank          !Percent of blanked blocks/packets       Decoder
-real rxnoise           !Rx noise in dB                        recvpkt
-real dphi              !Phase shift between pol'n channels   GUI,Decoder
-integer ngreen         !Length of green                         GUI
-real dgain             !Digital audio gain setting              GUI
-integer ndecoding      !Decoder status (see decode2.f90)     GUI,Decoder
-integer ndecoding0     !Status on previous decode            GUI,Decoder
-integer mcall3         !CALL3.TXT has been modified          GUI,Decoder
-integer mousebutton    !Which button was clicked?               GUI
-integer multicast      !1 for multicast data, 0 for unicast     GUI
-integer ndecdone       !Is decoder finished?                 GUI,Decoder
-integer nfloat         !Floating-point data from Linrad?      recvpkt
-integer ierr           !Error opening *.tf2 file                GUI
-integer lauto          !Are we in Auto mode?                    GUI
-integer mantx          !Manual transmission requested?       GUI,SoundIn
-integer nrestart       !True if transmission should restart  GUI,SoundIn
-integer ntr            !Are we in 2nd sequence?                 SoundIn
-integer nmsg           !Length of Tx message                    SoundIn
-integer nsave          !Which files to save?                    GUI
-integer nadd5          !Prepend 5 sec of 0's before decoding?   GUI 
-integer dftolerance    !DF tolerance (Hz)                       GUI
-logical LDecoded       !Was a message decoded?                  Decoder
-logical rxdone         !Has the Rx sequence finished?      SoundIn,Decoder
-integer monitoring     !Are we monitoring?                      GUI
-integer nzap           !Is Zap checked?                         GUI
-integer minsigdb       !Decoder threshold setting               GUI
-integer nclearave      !Set to 1 to clear JT65 avg         GUI,Decoder
-integer nfreeze        !Is Freeze checked?                      GUI
-integer nafc           !Is AFC checked?                         GUI
-integer newspec        !New spectra in ss(4,322,NSMAX)     GUI,Decoder
-integer nfa            !Low end of map65 search (def 100 kHz)   GUI
-integer nfb            !High end of map65 search (def 160 kHz)  GUI
-integer nfcal          !Calibration offset, Hz                  GUI
-integer idphi          !Phase offset in Y channel (deg)         GUI
-integer nkeep          !Timeout limit for band maps (min)       GUI
-integer nmode          !Which WSJT mode?                   GUI,Decoder
-integer mode65         !JT65 sub-mode (A/B/C ==&gt; 1/2/4) GUI,SoundIn,Decoder
-integer nbpp           !# FFT Bins/pixel, wideband waterfall   Spec
-integer ndebug         !Write debugging info?                   GUI
-integer ndphi          !Set to 1 to compute dphi             GUI,Decoder
-integer nhispol        !Pol angle matching HisCall or HisGrid Decoder
-integer nt1            !Time to start FFTs                      GUI
-integer nxant          !Antenna configuration: 0='+', 1='x'     GUI
-integer nblank         !Is NB checked?                          GUI
-integer nfmid          !Center frequency of main display        GUI
-integer nfrange        !Frequency range of main display         GUI
-integer nport          !Requested COM port number               GUI
-integer mousedf        !Mouse-selected freq offset, DF          GUI
-integer mousefqso      !Mouse-selected QSO freq                 GUI
-integer neme           !EME calls only in deep search?          GUI
-integer nrw26          !Request to rewind lu 26 (tmp26.txt)  GUI,Decoder
-integer naggressive    !Is &quot;Aggressive decoding&quot; checked?       GUI
-integer ntx2           !Is &quot;No shorthands if Tx1&quot; checked?      GUI
-integer nagain         !Decode same file again?                 GUI
-integer shok           !Shorthand messages OK?                  GUI
-integer sendingsh      !Sending a shorthand message?            SoundIn
-integer*2 d2a          !Rx data, extracted from y1              Decoder
-integer*2 d2b          !Rx data, selected by mouse-pick         Decoder
-integer*2 b            !Pixel values for waterfall spectrum     GUI
-integer jza            !Length of data in d2a                GUI,Decoder
-integer jzb            !(why is this here?)
-integer ntime          !Integer Unix time (now)               SoundIn
-integer idinterval     !Interval between CWIDs, minutes         GUI
-integer msmax          !(why is this here?)
-integer lenappdir      !Length of Appdir string                 GUI
-integer idf            !Frequency offset in Hz                  Decoder
-integer ndiskdat       !1 if data read from disk, 0 otherwise   GUI
-integer nlines         !Available lines of waterfall data       GUI
-integer nflat          !Is waterfall to be flattened?           GUI
-integer ntxreq         !Tx msg# requested                       GUI
-integer ntxnow         !Tx msg# being sent now                  GUI
-integer ndepth         !Requested &quot;depth&quot; of JT65 decoding      GUI
-integer nspecial       !JT65 shorthand msg#: RO=2 RRR=3 73=4    Decoder
-integer ndf            !Measured DF in Hz                       Decoder
-real ss1               !Magenta curve for JT65 shorthand msg    Decoder
-real ss2               !Orange curve for JT65 shorthand msg     Decoder
-character mycall*12    !My call sign                            GUI
-character hiscall*12   !His call sign                           GUI
-character hisgrid*6    !His grid locator                        GUI
-character txmsg*28     !Message to be transmitted               GUI
-character sending*28   !Message being sent                      SoundIn
-character mode*6       !WSJT operating mode                     GUI
-character utcdate*12   !UTC date                                GUI
-character*24 fname0    !Filenames to be recorded, read, ...     Decoder
-character*24 fnamea
-character*24 fnameb
-character*6  fnamedate
-character*24 decodedfile
-character*80 AppDir      !WSJT installation directory           GUI
-character*80 AzElDir     !Directory for azel.dat                GUI
-character*80 SaveDir     !Directory for saved data files        GUI
-character*80 filetokilla !Filenames (full path)                 Decoder
-character*80 filetokillb
-character*12 pttport
-character*8 utcdata     !HHMM UTC for the processed data       Decoder
-
-common/gcom2/fcenter,forcefcenter,ps0(431),psavg(450),s2(64,3100),ccf(-5:540), &amp;
-     green(500),fselect,pctlost,pctblank,rxnoise,dphi,ngreen,dgain,         &amp;
-     ndecoding,ndecoding0,mcall3,mousebutton,multicast,nsetftx,ierr,        &amp;
-     ndecdone,nfloat,lauto,mantx,nrestart,ntr,nmsg,nsave,nadd5,             &amp;
-     dftolerance,LDecoded,rxdone,monitoring,nzap,minsigdb,                  &amp;
-     nclearave,nfreeze,nafc,newspec,nfa,nfb,nfcal,idphi,nkeep,              &amp;
-     nmode,mode65,nbpp,ndebug,ndphi,nhispol,nt1,nxant,                      &amp;
-     nblank,nport,mousedf,mousefqso,neme,nrw26,naggressive,ntx2,nagain,     &amp;
-     shok,sendingsh,d2a(661500),d2b(661500),b(60000),jza,jzb,ntime,         &amp;
-     idinterval,msmax,lenappdir,idf,ndiskdat,nlines,nflat,ntxreq,ntxnow,    &amp;
-     ndepth,nspecial,ndf,nfmid,nfrange,ss1(-224:224),ss2(-224:224),         &amp;
-     mycall,hiscall,hisgrid,txmsg,sending,mode,fname0,fnamea,               &amp;
-     fnameb,fnamedate,decodedfile,AppDir,AzElDir,SaveDir,                   &amp;
-     filetokilla,filetokillb,utcdate,pttport,utcdata
-
-!### volatile /gcom2/
-

Deleted: branches/map65/gcom3.f90
===================================================================
--- branches/map65/gcom3.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/gcom3.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,20 +0,0 @@
-! Variable             Purpose                              Set in Thread
-!-------------------------------------------------------------------------
-integer*2 nfmt2        !Standard header for *.WAV file         Decoder
-integer*2 nchan2
-integer*2 nbitsam2
-integer*2 nbytesam2
-integer*4 nchunk
-integer*4 lenfmt
-integer*4 nsamrate
-integer*4 nbytesec
-integer*4 ndata
-character*4 ariff
-character*4 awave
-character*4 afmt
-character*4 adata
-
-common/gcom3/ariff,nchunk,awave,afmt,lenfmt,nfmt2,nchan2,nsamrate, &amp;
-     nbytesec,nbytesam2,nbitsam2,adata,ndata
-
-!### volatile /gcom3/

Deleted: branches/map65/gcom4.f90
===================================================================
--- branches/map65/gcom4.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/gcom4.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,10 +0,0 @@
-! Variable             Purpose                              Set in Thread
-!-------------------------------------------------------------------------
-character addpfx*8     !Add-on prefix, as in ZA/PA2CHR           GUI
-integer*2 d2c          !Rx data recovered from recorded file     GUI
-integer jzc            !Length of data available in d2c          GUI
-character filename*24  !Name of wave file read from disk         GUI
-
-common/gcom4/addpfx,d2c(661500),jzc,filename
-
-!### volatile /gcom4/

Deleted: branches/map65/gen65.f
===================================================================
--- branches/map65/gen65.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/gen65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,82 +0,0 @@
-      subroutine gen65(message,mode65,samfac,iwave,nwave,sendingsh,
-     +  msgsent)
-
-C  Encodes a JT65 message into a wavefile.
-
-      parameter (NMAX=60*11025)     !Max length of wave file
-      character*22 message          !Message to be generated
-      character*22 msgsent          !Message as it will be received
-      character*3 cok               !'   ' or 'OOO'
-      character*6 c1,c2
-      real*8 t,dt,phi,f,f0,dfgen,dphi,twopi,samfac,tsymbol
-
-      integer*2 iwave(NMAX)  !Generated wave file
-      integer dgen(12)
-      integer sent(63)
-      integer sendingsh
-      common/c1c2/c1,c2
-      include 'prcom.h'
-      data twopi/6.283185307d0/
-      save
-
-      if(abs(pr(1)).ne.1.0) call setup65
-
-      call chkmsg(message,cok,nspecial,flip)
-      if(nspecial.eq.0) then
-         call packmsg(message,dgen)          !Pack message into 72 bits
-         sendingsh=0
-         if(iand(dgen(10),8).ne.0) sendingsh=-1    !Plain text flag
-         call rs_encode(dgen,sent)
-         call interleave63(sent,1)           !Apply interleaving
-         call graycode(sent,63,1)            !Apply Gray code
-         tsymbol=4096.d0/11025.d0
-         nsym=126                            !Symbols per transmission
-      else
-         tsymbol=16384.d0/11025.d0
-         nsym=32
-         sendingsh=1                         !Flag for shorthand message
-      endif
-
-C  Set up necessary constants
-      dt=1.0/(samfac*11025.0)
-      f0=118*11025.d0/1024
-      dfgen=mode65*11025.0/4096.0
-      t=0.d0
-      phi=0.d0
-      k=0
-      j0=0
-      ndata=(nsym*11025.d0*samfac*tsymbol)/2
-      ndata=2*ndata
-      do i=1,ndata
-         t=t+dt
-         j=int(t/tsymbol) + 1                    !Symbol number, 1-126
-         if(j.ne.j0) then
-            f=f0
-            if(nspecial.ne.0 .and. mod(j,2).eq.0) f=f0+10*nspecial*dfgen
-            if(nspecial.eq.0 .and. flip*pr(j).lt.0.0) then
-               k=k+1
-               f=f0+(sent(k)+2)*dfgen
-            endif
-            dphi=twopi*dt*f
-            j0=j
-         endif
-         phi=phi+dphi
-         iwave(i)=32767.0*sin(phi)
-      enddo
-
-      do j=1,5512                !Put another 0.5 sec of silence at end
-         i=i+1
-         iwave(i)=0
-      enddo
-      nwave=i
-      call unpackmsg(dgen,msgsent)
-      if(flip.lt.0.0) then
-         do i=22,1,-1
-            if(msgsent(i:i).ne.' ') goto 10
-         enddo
- 10      msgsent=msgsent(1:i)//' OOO'
-      endif
-
-      return
-      end
-

Deleted: branches/map65/gencwid.f
===================================================================
--- branches/map65/gencwid.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/gencwid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,36 +0,0 @@
-      subroutine gencwid(msg,wpm,freqcw,samfac,iwave,nwave)
-
-      parameter (NMAX=10*11025)
-      character msg*22,msg2*22
-      integer*2 iwave(NMAX)
-
-      integer*1 idat(460)
-      real*8 dt,t,twopi,pha,dpha,tdit,samfac
-      data twopi/6.283185307d0/
-
-      do i=1,22
-         if(msg(i:i).eq.' ') go to 10
-       enddo
- 10   iz=i-1
-      msg2=msg(1:iz)//'                      '
-      call morse(msg2,idat,ndits) !Encode part 1 of msg
-
-      tdit=1.2d0/wpm                   !Key-down dit time, seconds
-      dt=1.d0/(11025.d0*samfac)
-      nwave=ndits*tdit/dt
-      pha=0.
-      dpha=twopi*freqcw*dt
-      t=0.d0
-      s=0.
-      u=wpm/(11025*0.03)
-      do i=1,nwave
-         t=t+dt
-         pha=pha+dpha
-         j=t/tdit + 1
-         s=s + u*(idat(j)-s)
-         iwave(i)=nint(s*32767.d0*sin(pha))
-      enddo
-
-      return
-      end
-

Deleted: branches/map65/gentone.f
===================================================================
--- branches/map65/gentone.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/gentone.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,13 +0,0 @@
-      subroutine gentone(x,n,k)
-
-      real*4 x(512)
-
-      dt=1.0/11025.0
-      f=(n+51)*11025.0/512.0
-      do i=1,512
-         x(i)=sin(6.2831853*i*dt*f)
-      enddo
-      k=k+512
-
-      return
-      end

Deleted: branches/map65/geocentric.f
===================================================================
--- branches/map65/geocentric.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/geocentric.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,17 +0,0 @@
-      subroutine geocentric(alat,elev,hlt,erad)
-
-      implicit real*8 (a-h,o-z)
-
-C  IAU 1976 flattening f, equatorial radius a
-      f = 1.d0/298.257d0
-      a = 6378140.d0
-      c = 1.d0/sqrt(1.d0 + (-2.d0 + f)*f*sin(alat)*sin(alat))
-      arcf = (a*c + elev)*cos(alat)
-      arsf = (a*(1.d0 - f)*(1.d0 - f)*c + elev)*sin(alat)
-      hlt = datan2(arsf,arcf)
-      erad = sqrt(arcf*arcf + arsf*arsf)
-      erad = 0.001d0*erad
-
-      return
-      end
-

Added: branches/map65/getdev.cpp
===================================================================
--- branches/map65/getdev.cpp	                        (rev 0)
+++ branches/map65/getdev.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,259 @@
+#include &lt;stdio.h&gt;
+#define MAXDEVICES 100
+#include &lt;string.h&gt;
+#include &lt;portaudio.h&gt;
+#include &lt;QDebug&gt;
+
+//------------------------------------------------------- pa_get_device_info
+int pa_get_device_info (int  n,
+                        void *pa_device_name,
+                        void *pa_device_hostapi,
+                        double *pa_device_max_speed,
+                        double *pa_device_min_speed,
+                        int *pa_device_max_bytes,
+                        int *pa_device_min_bytes,
+                        int *pa_device_max_channels,
+                        int *pa_device_min_channels )
+{
+
+  (void) n ;
+  (void) pa_device_name;
+  (void) pa_device_hostapi;
+  (void) pa_device_max_speed;
+  (void) pa_device_min_speed;
+  (void) pa_device_max_bytes;
+  (void) pa_device_min_bytes;
+  (void) pa_device_max_channels;
+  (void) pa_device_min_channels;
+  const PaDeviceInfo *deviceInfo;
+  PaError pa_err;
+  PaStreamParameters inputParameters;
+  int i,j, speed_warning;
+  int minBytes, maxBytes;
+  double maxStandardSampleRate;
+  double minStandardSampleRate;
+  int minInputChannels;
+  int maxInputChannels;
+
+// negative terminated  list
+  static double standardSampleRates[] = {8000.0, 9600.0,
+        11025.0, 12000.0, 16000.0, 22050.0, 24000.0, 32000.0,
+        44100.0, 48000.0, 88200.0, 96000.0, 192000.0, -1};
+// *******************************************************
+
+
+  *pa_device_max_speed=0;
+  *pa_device_min_speed=0;
+  *pa_device_max_bytes=0;
+  *pa_device_min_bytes=0;
+  *pa_device_max_channels=0;
+  *pa_device_min_channels=0;
+  minInputChannels=0;
+  if(n &gt;= Pa_GetDeviceCount() ) return -1;
+  deviceInfo = Pa_GetDeviceInfo(n);
+  if (deviceInfo-&gt;maxInputChannels==0) return -1;
+  sprintf((char*)(pa_device_name),&quot;%s&quot;,deviceInfo-&gt;name);
+  sprintf((char*)(pa_device_hostapi),&quot;%s&quot;,
+          Pa_GetHostApiInfo( deviceInfo-&gt;hostApi )-&gt;name);
+  speed_warning=0;
+
+// bypass bug in Juli@ ASIO driver:
+// this driver hangs after a Pa_IsFormatSupported call
+  i = strncmp(deviceInfo-&gt;name, &quot;ASIO 2.0 - ESI Juli@&quot;, 19);
+  if (i == 0) {
+    minStandardSampleRate=44100;
+    maxStandardSampleRate=192000;
+    minBytes=1;
+    maxBytes=4;
+    maxInputChannels= deviceInfo-&gt;maxInputChannels;
+    minInputChannels= 1;
+    goto end_pa_get_device_info;
+  }
+
+// Investigate device capabilities.
+// Check min and max samplerates  with 16 bit data.
+  maxStandardSampleRate=0;
+  minStandardSampleRate=0;
+  inputParameters.device = n;
+  inputParameters.channelCount = deviceInfo-&gt;maxInputChannels;
+  inputParameters.sampleFormat = paInt16;
+  inputParameters.suggestedLatency = 0;
+  inputParameters.hostApiSpecificStreamInfo = NULL;
+
+// ************************************************************************
+//filter for portaudio Windows hostapi's with non experts.
+//only allow ASIO or WASAPI or WDM-KS
+  i = strncmp(Pa_GetHostApiInfo(deviceInfo-&gt;hostApi)-&gt;name, &quot;ASIO&quot;, 4);
+  if (i==0 ) goto end_filter_hostapi;
+  i = strncmp(Pa_GetHostApiInfo(deviceInfo-&gt;hostApi)-&gt;name,
+              &quot;Windows WASAPI&quot;, 14);
+  if (i==0 ) goto end_filter_hostapi;
+  i = strncmp(Pa_GetHostApiInfo(deviceInfo-&gt;hostApi)-&gt;name,
+              &quot;Windows WDM-KS&quot;, 14);
+  if (i==0 ) goto end_filter_hostapi;
+  speed_warning=1;
+end_filter_hostapi:;
+
+// ************************************************************************
+  i=0;
+  while(standardSampleRates[i] &gt; 0 &amp;&amp; minStandardSampleRate==0) {
+    pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL,
+                                standardSampleRates[i] );
+    if(pa_err == paDeviceUnavailable) return -1;
+    if(pa_err == paInvalidDevice) return -1;
+    if(pa_err == paFormatIsSupported ) {
+      minStandardSampleRate=standardSampleRates[i];
+    }
+    i++;
+  }
+  if(minStandardSampleRate == 0) return -1;
+  j=i;
+  while(standardSampleRates[i] &gt; 0 ) i++;
+  i--;
+
+  while(i &gt;= j &amp;&amp; maxStandardSampleRate==0) {
+    pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL,
+                                  standardSampleRates[i] );
+    if(pa_err == paDeviceUnavailable) return -1;
+    if(pa_err == paInvalidDevice) return -1;
+    if( pa_err == paFormatIsSupported ) {
+      maxStandardSampleRate=standardSampleRates[i];
+    }
+    i--;
+  }
+
+// check if min SampleRate  = max SampleRate
+  if(maxStandardSampleRate==0 &amp;&amp; (minStandardSampleRate != 0)) {
+    maxStandardSampleRate= minStandardSampleRate;
+  }
+
+// check min and max bytes
+  minBytes=2;
+  maxBytes=2;
+  inputParameters.sampleFormat = paUInt8;
+  pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL,
+                                maxStandardSampleRate );
+  if( pa_err == paFormatIsSupported ) {
+    minBytes=1;
+  }
+    inputParameters.sampleFormat = paInt32;
+    pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL,
+                                maxStandardSampleRate );
+  if( pa_err == paFormatIsSupported ) {
+    maxBytes=4;
+  }
+
+// check min channel count
+  maxInputChannels= deviceInfo-&gt;maxInputChannels;
+  inputParameters.channelCount = 1;
+  inputParameters.sampleFormat = paInt16;
+  pa_err=paFormatIsSupported+32000;
+  while(pa_err != paFormatIsSupported &amp;&amp;
+          ( inputParameters.channelCount &lt; (maxInputChannels+1)) ) {
+    pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL,
+                                maxStandardSampleRate );
+    inputParameters.channelCount++;
+  }
+  if( pa_err == paFormatIsSupported ) {
+    minInputChannels=inputParameters.channelCount-1;
+  } else {
+    return -1;
+  }
+
+end_pa_get_device_info:;
+
+  *pa_device_max_speed=maxStandardSampleRate;
+  *pa_device_min_speed=minStandardSampleRate;
+  *pa_device_max_bytes=maxBytes;
+  *pa_device_min_bytes=minBytes;
+  *pa_device_max_channels= maxInputChannels;
+  *pa_device_min_channels= minInputChannels;
+
+  return speed_warning;
+}
+
+
+void paInputDevice(int id, char* hostAPI_DeviceName, int* minChan,
+                   int* maxChan, int* minSpeed, int* maxSpeed)
+{
+  int i;
+  char pa_device_name[128];
+  char pa_device_hostapi[128];
+  double pa_device_max_speed;
+  double pa_device_min_speed;
+  int pa_device_max_bytes;
+  int pa_device_min_bytes;
+  int pa_device_max_channels;
+  int pa_device_min_channels;
+  char p2[50];
+  char *p,*p1;
+  static int iret, valid_dev_cnt;
+
+  iret=pa_get_device_info (id,
+                          &amp;pa_device_name,
+                          &amp;pa_device_hostapi,
+                          &amp;pa_device_max_speed,
+                          &amp;pa_device_min_speed,
+                          &amp;pa_device_max_bytes,
+                          &amp;pa_device_min_bytes,
+                          &amp;pa_device_max_channels,
+                          &amp;pa_device_min_channels);
+
+  if (iret &gt;= 0 ) {
+    valid_dev_cnt++;
+
+    p1=(char*)&quot;&quot;;
+    p=strstr(pa_device_hostapi,&quot;MME&quot;);
+    if(p!=NULL) p1=(char*)&quot;MME&quot;;
+    p=strstr(pa_device_hostapi,&quot;Direct&quot;);
+    if(p!=NULL) p1=(char*)&quot;DirectX&quot;;
+    p=strstr(pa_device_hostapi,&quot;WASAPI&quot;);
+    if(p!=NULL) p1=(char*)&quot;WASAPI&quot;;
+    p=strstr(pa_device_hostapi,&quot;ASIO&quot;);
+    if(p!=NULL) p1=(char*)&quot;ASIO&quot;;
+    p=strstr(pa_device_hostapi,&quot;WDM-KS&quot;);
+    if(p!=NULL) p1=(char*)&quot;WDM-KS&quot;;
+
+    sprintf(p2,&quot;%-8s %-39s&quot;,p1,pa_device_name);
+    for(i=0; i&lt;50; i++) {
+      hostAPI_DeviceName[i]=p2[i];
+      if(p2[i]==0) break;
+    }
+    *minChan=pa_device_min_channels;
+    *maxChan=pa_device_max_channels;
+    *minSpeed=(int)pa_device_min_speed;
+    *maxSpeed=(int)pa_device_max_speed;
+  } else {
+    for(i=0; i&lt;50; i++) {
+      hostAPI_DeviceName[i]=0;
+    }
+    *minChan=0;
+    *maxChan=0;
+    *minSpeed=0;
+    *maxSpeed=0;
+  }
+}
+
+void getDev(int* numDevices0, char hostAPI_DeviceName[][50],
+            int minChan[], int maxChan[],
+            int minSpeed[], int maxSpeed[])
+{
+  int i,id,numDevices;
+  int minch,maxch,minsp,maxsp;
+  char apidev[256];
+
+  numDevices=Pa_GetDeviceCount();
+  *numDevices0=numDevices;
+
+  for(id=0; id&lt;numDevices; id++)  {
+    paInputDevice(id,apidev,&amp;minch,&amp;maxch,&amp;minsp,&amp;maxsp);
+    for(i=0; i&lt;50; i++) {
+      hostAPI_DeviceName[id][i]=apidev[i];
+    }
+    hostAPI_DeviceName[id][49]=0;
+    minChan[id]=minch;
+    maxChan[id]=maxch;
+    minSpeed[id]=minsp;
+    maxSpeed[id]=maxsp;
+  }
+}

Deleted: branches/map65/getdphi.f90
===================================================================
--- branches/map65/getdphi.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/getdphi.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,20 +0,0 @@
-subroutine getdphi(qphi)
-
-  real qphi(12)
-
-  s=0.
-  c=0.
-  do i=1,12
-     th=i*30/57.2957795
-     s=s+qphi(i)*sin(th)
-     c=c+qphi(i)*cos(th)
-  enddo
-
-  dphi=57.2957795*atan2(s,c)
-  call cs_lock('getdphi')
-  write(11,1010) nint(dphi)
-1010 format('Best-fit Dphi =',i4,' deg')
-  call cs_unlock
-
-  return
-  end

Added: branches/map65/getfile.cpp
===================================================================
--- branches/map65/getfile.cpp	                        (rev 0)
+++ branches/map65/getfile.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,105 @@
+#include &quot;getfile.h&quot;
+#include &lt;QDir&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;math.h&gt;
+
+extern qint16 id[4*60*96000];
+
+void getfile(QString fname, bool xpol, int dbDgrd)
+{
+  int npts=2*52*96000;
+  if(xpol) npts=2*npts;
+
+// Degrade S/N by dbDgrd dB -- for tests only!!
+  float dgrd=0.0;
+  if(dbDgrd&lt;0) dgrd = 23.0*sqrt(pow(10.0,-0.1*(double)dbDgrd) - 1.0);
+  float fac=23.0/sqrt(dgrd*dgrd + 23.0*23.0);
+
+  memset(id,0,2*npts);
+  char name[80];
+  strcpy(name,fname.toAscii());
+  FILE* fp=fopen(name,&quot;rb&quot;);
+
+  if(fp != NULL) {
+    fread(&amp;datcom_.fcenter,sizeof(datcom_.fcenter),1,fp);
+    fread(id,2,npts,fp);
+    int j=0;
+
+    if(dbDgrd&lt;0) {
+      for(int i=0; i&lt;npts; i+=2) {
+        datcom_.d4[j++]=fac*((float)id[i] + dgrd*gran());
+        datcom_.d4[j++]=fac*((float)id[i+1] + dgrd*gran());
+        if(!xpol) j+=2;               //Skip over d4(3,x) and d4(4,x)
+      }
+    } else {
+      for(int i=0; i&lt;npts; i+=2) {
+        datcom_.d4[j++]=(float)id[i];
+        datcom_.d4[j++]=(float)id[i+1];
+        if(!xpol) j+=2;               //Skip over d4(3,x) and d4(4,x)
+      }
+    }
+    fclose(fp);
+
+    datcom_.ndiskdat=1;
+    int nfreq=(int)datcom_.fcenter;
+    if(nfreq!=144 and nfreq != 432 and nfreq != 1296) datcom_.fcenter=144.125;
+    int i0=fname.indexOf(&quot;.tf2&quot;);
+    if(i0&lt;0) i0=fname.indexOf(&quot;.iq&quot;);
+    datcom_.nutc=0;
+    if(i0&gt;0) datcom_.nutc=100*fname.mid(i0-4,2).toInt() +
+        fname.mid(i0-2,2).toInt();
+  }
+}
+
+void savetf2(QString fname, bool xpol)
+{
+  int npts=2*52*96000;
+  if(xpol) npts=2*npts;
+
+  qint16* buf=(qint16*)malloc(2*npts);
+  char name[80];
+  strcpy(name,fname.toAscii());
+  FILE* fp=fopen(name,&quot;wb&quot;);
+
+  if(fp != NULL) {
+    fwrite(&amp;datcom_.fcenter,sizeof(datcom_.fcenter),1,fp);
+    int j=0;
+    for(int i=0; i&lt;npts; i+=2) {
+      buf[i]=(qint16)datcom_.d4[j++];
+      buf[i+1]=(qint16)datcom_.d4[j++];
+      if(!xpol) j+=2;               //Skip over d4(3,x) and d4(4,x)
+    }
+    fwrite(buf,2,npts,fp);
+    fclose(fp);
+  }
+  free(buf);
+}
+
+//#define	MAX_RANDOM	0x7fffffff
+
+/* Generate gaussian random float with mean=0 and std_dev=1 */
+float gran()
+{
+  float fac,rsq,v1,v2;
+  static float gset;
+  static int iset;
+
+  if(iset){
+    /* Already got one */
+    iset = 0;
+    return gset;
+  }
+  /* Generate two evenly distributed numbers between -1 and +1
+   * that are inside the unit circle
+   */
+  do {
+    v1 = 2.0 * (float)rand() / RAND_MAX - 1;
+    v2 = 2.0 * (float)rand() / RAND_MAX - 1;
+    rsq = v1*v1 + v2*v2;
+  } while(rsq &gt;= 1.0 || rsq == 0.0);
+  fac = sqrt(-2.0*log(rsq)/rsq);
+  gset = v1*fac;
+  iset++;
+  return v2*fac;
+}

Deleted: branches/map65/getfile.f90
===================================================================
--- branches/map65/getfile.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/getfile.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,14 +0,0 @@
-!----------------------------------------------------- getfile
-subroutine getfile(fname,len)
-  character*(*) fname
-
-  include 'datcom.f90'
-  include 'gcom2.f90'
-
-  fname80=fname
-  nlen=len
-  newdat2=1
-  ierr=0
-
-  return
-end subroutine getfile

Added: branches/map65/getfile.h
===================================================================
--- branches/map65/getfile.h	                        (rev 0)
+++ branches/map65/getfile.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,12 @@
+#ifndef GETFILE_H
+#define GETFILE_H
+#include &lt;QString&gt;
+#include &lt;QFile&gt;
+#include &lt;QDebug&gt;
+#include &quot;commons.h&quot;
+
+void getfile(QString fname, bool xpol, int dbDgrd);
+void savetf2(QString fname, bool xpol);
+float gran();
+
+#endif // GETFILE_H

Deleted: branches/map65/getfile2.f90
===================================================================
--- branches/map65/getfile2.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/getfile2.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,71 +0,0 @@
-subroutine getfile2(fname,len)
-
-#ifdef CVF
-  use dflib
-#endif
-
-  character*(*) fname
-  real*8 sq
-
-  include 'datcom.f90'
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-  include 'gcom4.f90'
-  integer*2 id(4,NSMAX)
-
-1 if(ndecoding.eq.0) go to 2
-#ifdef CVF
-  call sleepqq(100)
-#else
-  call usleep(100*1000)
-#endif
-
-  go to 1
-
-2 do i=len,1,-1
-     if(fname(i:i).eq.'/' .or. fname(i:i).eq.'\\') go to 10
-  enddo
-  i=0
-10 filename=fname(i+1:)
-  ierr=0
-
-  n=8*NSMAX
-  ndecoding=4
-  monitoring=0
-  kbuf=1
-
-  call cs_lock('getfile2a')
-!###
-! NB: not really necessary to read whole file at once.  Save memory!
-  call rfile3a(fname,id,n,ierr)
-  do i=1,NSMAX
-     dd(1,i,1)=id(1,i)
-     dd(2,i,1)=id(2,i)
-  enddo
-!###
-
-  call cs_unlock
-  if(ierr.ne.0) then
-     print*,'Error opening or reading file: ',fname,ierr
-     go to 999
-  endif
-
-  sq=0.
-  ka=0.1*NSMAX
-  kb=0.8*NSMAX
-  do k=ka,kb
-     sq=sq + dd(1,k,1)**2 + dd(2,k,1)**2 + dd(3,k,1)**2 + dd(4,k,1)**2
-  enddo
-  sqave=174*sq/(kb-ka+1)
-  rxnoise=10.0*log10(sqave) - 48.0
-  call cs_lock('getfile2b')
-  read(filename(8:11),*,err=20,end=20) nutc
-  call cs_unlock
-  go to 30
-20 nutc=0
-
-30 ndiskdat=1
-  mousebutton=0
-
-999 return
-end subroutine getfile2

Deleted: branches/map65/getpfx1.f
===================================================================
--- branches/map65/getpfx1.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/getpfx1.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,45 +0,0 @@
-      subroutine getpfx1(callsign,k)
-
-      character callsign*12
-      character*8 c
-      character addpfx*8
-C  Can't 'include' *.f90 in *.f 
-      common/gcom4/addpfx
-      include 'pfx.f'
-
-      iz=index(callsign,' ') - 1
-      if(iz.lt.0) iz=12
-      islash=index(callsign(1:iz),'/')
-      k=0
-      c='   '
-      if(islash.gt.0 .and. islash.le.(iz-4)) then
-!  Add-on prefix
-         c=callsign(1:islash-1)
-         callsign=callsign(islash+1:iz)
-         do i=1,NZ
-            if(pfx(i)(1:4).eq.c) then
-               k=i
-               go to 10
-            endif
-         enddo
-         if(addpfx.eq.c) then
-            k=449
-            go to 10
-         endif
-
-      else if(islash.eq.(iz-1)) then
-!  Add-on suffix
-         c=callsign(islash+1:iz)
-         callsign=callsign(1:islash-1)
-         do i=1,NZ2
-            if(sfx(i).eq.c(1:1)) then
-               k=400+i
-               go to 10
-            endif
-         enddo
-      endif
-
- 10   if(islash.ne.0 .and.k.eq.0) k=-1
-      return
-      end
-

Deleted: branches/map65/getpfx2.f
===================================================================
--- branches/map65/getpfx2.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/getpfx2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,24 +0,0 @@
-      subroutine getpfx2(k0,callsign)
-
-      character callsign*12
-      include 'pfx.f'
-      character addpfx*8
-      common/gcom4/addpfx
-
-      k=k0
-      if(k.gt.450) k=k-450
-      if(k.ge.1 .and. k.le.NZ) then
-         iz=index(pfx(k),' ') - 1
-         callsign=pfx(k)(1:iz)//'/'//callsign
-      else if(k.ge.401 .and. k.le.400+NZ2) then
-         iz=index(callsign,' ') - 1
-         callsign=callsign(1:iz)//'/'//sfx(k-400)
-      else if(k.eq.449) then
-         iz=index(addpfx,' ') - 1
-         if(iz.lt.1) iz=8
-         callsign=addpfx(1:iz)//'/'//callsign
-      endif
-
-      return
-      end
-

Deleted: branches/map65/getsnr.f
===================================================================
--- branches/map65/getsnr.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/getsnr.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,35 +0,0 @@
-      subroutine getsnr(x,nz,snr)
-
-      real x(nz)
-
-      smax=-1.e30
-      do i=1,nz
-         if(x(i).gt.smax) then
-            ipk=i
-            smax=x(i)
-         endif
-         s=s+x(i)
-      enddo
-
-      s=0.
-      ns=0
-      do i=1,nz
-         if(abs(i-ipk).ge.3) then
-            s=s+x(i)
-            ns=ns+1
-         endif
-      enddo
-      ave=s/ns
-
-      sq=0.
-      do i=1,nz
-         if(abs(i-ipk).ge.3) then
-            sq=sq+(x(i)-ave)**2
-            ns=ns+1
-         endif
-      enddo
-      rms=sqrt(sq/(nz-2))
-      snr=(smax-ave)/rms
-
-      return
-      end

Deleted: branches/map65/go.py
===================================================================
--- branches/map65/go.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/go.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1 +0,0 @@
-import map65

Deleted: branches/map65/gp.bat
===================================================================
--- branches/map65/gp.bat	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/gp.bat	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,2 +0,0 @@
-gcc -c plrr_subs_win.c
-g95 -o pulsar -fno-second-underscore -fbounds-check -ftrace=full pulsar.f90 plrr_subs_win.o

Deleted: branches/map65/graycode.f
===================================================================
--- branches/map65/graycode.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/graycode.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,10 +0,0 @@
-      subroutine graycode(dat,n,idir)
-
-      integer dat(n)
-      do i=1,n
-         dat(i)=igray(dat(i),idir)
-      enddo
-
-      return
-      end
-

Deleted: branches/map65/grid2deg.f
===================================================================
--- branches/map65/grid2deg.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/grid2deg.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,40 +0,0 @@
-      subroutine grid2deg(grid0,dlong,dlat)
-
-C  Converts Maidenhead grid locator to degrees of West longitude
-C  and North latitude.
-
-      character*6 grid0,grid
-      character*1 g1,g2,g3,g4,g5,g6
-
-      grid=grid0
-      i=ichar(grid(5:5))
-      if(grid(5:5).eq.' ' .or. i.le.64 .or. i.ge.128) grid(5:6)='mm'
-
-      if(grid(1:1).ge.'a' .and. grid(1:1).le.'z') grid(1:1)= 
-     +   char(ichar(grid(1:1))+ichar('A')-ichar('a'))
-      if(grid(2:2).ge.'a' .and. grid(2:2).le.'z') grid(2:2)=
-     +   char(ichar(grid(2:2))+ichar('A')-ichar('a'))
-      if(grid(5:5).ge.'A' .and. grid(5:5).le.'Z') grid(5:5)=
-     +   char(ichar(grid(5:5))-ichar('A')+ichar('a'))
-      if(grid(6:6).ge.'A' .and. grid(6:6).le.'Z') grid(6:6)=
-     +   char(ichar(grid(6:6))-ichar('A')+ichar('a'))
-
-      g1=grid(1:1)
-      g2=grid(2:2)
-      g3=grid(3:3)
-      g4=grid(4:4)
-      g5=grid(5:5)
-      g6=grid(6:6)
-
-      nlong = 180 - 20*(ichar(g1)-ichar('A'))
-      n20d = 2*(ichar(g3)-ichar('0'))
-      xminlong = 5*(ichar(g5)-ichar('a')+0.5)
-      dlong = nlong - n20d - xminlong/60.0
-c      print*,nlong,n20d,xminlong,dlong
-      nlat = -90+10*(ichar(g2)-ichar('A')) + ichar(g4)-ichar('0')
-      xminlat = 2.5*(ichar(g6)-ichar('a')+0.5)
-      dlat = nlat + xminlat/60.0
-c      print*,nlat,xminlat,dlat
-
-      return
-      end

Deleted: branches/map65/grid2k.f
===================================================================
--- branches/map65/grid2k.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/grid2k.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,12 +0,0 @@
-      subroutine grid2k(grid,k)
-
-      character*6 grid
-
-      call grid2deg(grid,xlong,xlat)
-      nlong=nint(xlong)
-      nlat=nint(xlat)
-      k=0
-      if(nlat.ge.85) k=5*(nlong+179)/2 + nlat-84
-
-      return
-      end

Deleted: branches/map65/i1tor4.f90
===================================================================
--- branches/map65/i1tor4.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/i1tor4.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,19 +0,0 @@
-
-!--------------------------------------------------- i1tor4
-subroutine i1tor4(d,jz,data)
-
-!  Convert wavefile byte data from to real*4.
-
-  integer*1 d(jz)
-  real data(jz)
-  integer*1 i1
-  equivalence(i1,i4)
-
-  do i=1,jz
-     n=d(i)
-     i4=n-128
-     data(i)=i1
-  enddo
-
-  return
-end subroutine i1tor4

Deleted: branches/map65/igray.c
===================================================================
--- branches/map65/igray.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/igray.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,22 +0,0 @@
-#ifdef CVF
-extern int __stdcall IGRAY(int *n0, int *idir)
-#else
-int igray_(int *n0, int *idir)
-#endif
-{
-  int n;
-  unsigned long sh;
-  unsigned long nn;
-  n=*n0;
-
-  if(*idir&gt;0) return (n ^ (n &gt;&gt; 1));
-
-  sh = 1;
-  nn = (n &gt;&gt; sh);
-  while (nn &gt; 0) {
-    n ^= nn;
-    sh &lt;&lt;= 1;
-    nn = (n &gt;&gt; sh);
-  }
-  return (n);
-}

Added: branches/map65/in.dat
===================================================================
--- branches/map65/in.dat	                        (rev 0)
+++ branches/map65/in.dat	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,16 @@
+  35  36  22   8  31  11  14  55  20  36  55  13  24  15  56  38  16  28  61  58
+  15  26  45   8  41  53  37  57  59  60  29  29  41  46  44  35  52  61  24  26
+  16  20  53  35   2   6   9  27  47  28  57   6  15   9  16  10  56   9  63  46
+   9  15   3
+  74  61  44 233  29 245 254  64 119  64 250 111  38 145  53  29 140 194 119  99
+  55  86  48 110 142  95  48 120  61  66 252 252 245  88  62  41 124 249 246  68
+ 250 249  65  64 140 142  88 190 237  90 240  52  79 216  55  31 112 135  66  44
+  99  57  68
+  54  61  26   5  13  60   3  56  30  58  57   4  16  43  28  43   6  61  13  19
+  56   8   4   9  45  32   9   7  14  52   4  38  40  27   3  26  51  54  40  29
+  36  63  34  43   3  48  36  49  46  30   8  20  40  59  29  28  17  11   8  19
+  11  63   5
+  38  25  35   8  28   0   0  60  60  25   0  31  28  52  14  24   9  30  18  54
+  49  55  48  15  27  54  26  22  30  27   1   1   4  31  35  29  23   2   2  27
+   0   1  25  32  21  84  28  19   5  60   2  27  15   9  39  23  42  12  29  17
+  16  50  49

Deleted: branches/map65/indexx.f
===================================================================
--- branches/map65/indexx.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/indexx.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,19 +0,0 @@
-      subroutine indexx(n,arr,indx)
-
-      parameter (NMAX=3000)
-      integer indx(n)
-      real arr(n)
-      real brr(NMAX)
-      if(n.gt.NMAX) then
-         print*,'n=',n,' too big in indexx.'
-         stop
-      endif
-      do i=1,n
-         brr(i)=arr(i)
-         indx(i)=i
-      enddo
-      call ssort(brr,indx,n,2)
-
-      return
-      end
-

Deleted: branches/map65/init_rs.c
===================================================================
--- branches/map65/init_rs.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/init_rs.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,126 +0,0 @@
-/* Initialize a RS codec
- *
- * Copyright 2002 Phil Karn, KA9Q
- * May be used under the terms of the GNU General Public License (GPL)
- */
-#include &lt;stdlib.h&gt;
-
-#ifdef CCSDS
-#include &quot;ccsds.h&quot;
-#elif defined(BIGSYM)
-#include &quot;int.h&quot;
-#else
-#include &quot;char.h&quot;
-#endif
-
-#define NULL ((void *)0)
-
-void FREE_RS(void *p){
-  struct rs *rs = (struct rs *)p;
-
-  free(rs-&gt;alpha_to);
-  free(rs-&gt;index_of);
-  free(rs-&gt;genpoly);
-  free(rs);
-}
-
-/* Initialize a Reed-Solomon codec
- * symsize = symbol size, bits (1-8)
- * gfpoly = Field generator polynomial coefficients
- * fcr = first root of RS code generator polynomial, index form
- * prim = primitive element to generate polynomial roots
- * nroots = RS code generator polynomial degree (number of roots)
- * pad = padding bytes at front of shortened block
- */
-void *INIT_RS(int symsize,int gfpoly,int fcr,int prim,
-	int nroots,int pad){
-  struct rs *rs;
-  int i, j, sr,root,iprim;
-
-  /* Check parameter ranges */
-  if(symsize &lt; 0 || symsize &gt; 8*sizeof(DTYPE))
-    return NULL; /* Need version with ints rather than chars */
-
-  if(fcr &lt; 0 || fcr &gt;= (1&lt;&lt;symsize))
-    return NULL;
-  if(prim &lt;= 0 || prim &gt;= (1&lt;&lt;symsize))
-    return NULL;
-  if(nroots &lt; 0 || nroots &gt;= (1&lt;&lt;symsize))
-    return NULL; /* Can't have more roots than symbol values! */
-  if(pad &lt; 0 || pad &gt;= ((1&lt;&lt;symsize) -1 - nroots))
-    return NULL; /* Too much padding */
-
-  rs = (struct rs *)calloc(1,sizeof(struct rs));
-  rs-&gt;mm = symsize;
-  rs-&gt;nn = (1&lt;&lt;symsize)-1;
-  rs-&gt;pad = pad;
-
-  rs-&gt;alpha_to = (DTYPE *)malloc(sizeof(DTYPE)*(rs-&gt;nn+1));
-  if(rs-&gt;alpha_to == NULL){
-    free(rs);
-    return NULL;
-  }
-  rs-&gt;index_of = (DTYPE *)malloc(sizeof(DTYPE)*(rs-&gt;nn+1));
-  if(rs-&gt;index_of == NULL){
-    free(rs-&gt;alpha_to);
-    free(rs);
-    return NULL;
-  }
-
-  /* Generate Galois field lookup tables */
-  rs-&gt;index_of[0] = A0; /* log(zero) = -inf */
-  rs-&gt;alpha_to[A0] = 0; /* alpha**-inf = 0 */
-  sr = 1;
-  for(i=0;i&lt;rs-&gt;nn;i++){
-    rs-&gt;index_of[sr] = i;
-    rs-&gt;alpha_to[i] = sr;
-    sr &lt;&lt;= 1;
-    if(sr &amp; (1&lt;&lt;symsize))
-      sr ^= gfpoly;
-    sr &amp;= rs-&gt;nn;
-  }
-  if(sr != 1){
-    /* field generator polynomial is not primitive! */
-    free(rs-&gt;alpha_to);
-    free(rs-&gt;index_of);
-    free(rs);
-    return NULL;
-  }
-
-  /* Form RS code generator polynomial from its roots */
-  rs-&gt;genpoly = (DTYPE *)malloc(sizeof(DTYPE)*(nroots+1));
-  if(rs-&gt;genpoly == NULL){
-    free(rs-&gt;alpha_to);
-    free(rs-&gt;index_of);
-    free(rs);
-    return NULL;
-  }
-  rs-&gt;fcr = fcr;
-  rs-&gt;prim = prim;
-  rs-&gt;nroots = nroots;
-
-  /* Find prim-th root of 1, used in decoding */
-  for(iprim=1;(iprim % prim) != 0;iprim += rs-&gt;nn)
-    ;
-  rs-&gt;iprim = iprim / prim;
-
-  rs-&gt;genpoly[0] = 1;
-  for (i = 0,root=fcr*prim; i &lt; nroots; i++,root += prim) {
-    rs-&gt;genpoly[i+1] = 1;
-
-    /* Multiply rs-&gt;genpoly[] by  @**(root + x) */
-    for (j = i; j &gt; 0; j--){
-      if (rs-&gt;genpoly[j] != 0)
-	rs-&gt;genpoly[j] = rs-&gt;genpoly[j-1] ^ rs-&gt;alpha_to[modnn(rs,rs-&gt;index_of[rs-&gt;genpoly[j]] + root)];
-      else
-	rs-&gt;genpoly[j] = rs-&gt;genpoly[j-1];
-    }
-    /* rs-&gt;genpoly[0] can never be zero */
-    rs-&gt;genpoly[0] = rs-&gt;alpha_to[modnn(rs,rs-&gt;index_of[rs-&gt;genpoly[0]] + root)];
-  }
-  /* convert rs-&gt;genpoly[] to index form for quicker encoding */
-  for (i = 0; i &lt;= nroots; i++)
-    rs-&gt;genpoly[i] = rs-&gt;index_of[rs-&gt;genpoly[i]];
-
-  return rs;
-}

Deleted: branches/map65/install-sh
===================================================================
--- branches/map65/install-sh	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/install-sh	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,323 +0,0 @@
-#!/bin/sh
-# install - install a program, script, or datafile
-
-scriptversion=2005-05-14.22
-
-# This originates from X11R5 (mit/util/scripts/install.sh), which was
-# later released in X11R6 (xc/config/util/install.sh) with the
-# following copyright and license.
-#
-# Copyright (C) 1994 X Consortium
-#
-# Permission is hereby granted, free of charge, to any person obtaining a copy
-# of this software and associated documentation files (the &quot;Software&quot;), to
-# deal in the Software without restriction, including without limitation the
-# rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
-# sell copies of the Software, and to permit persons to whom the Software is
-# furnished to do so, subject to the following conditions:
-#
-# The above copyright notice and this permission notice shall be included in
-# all copies or substantial portions of the Software.
-#
-# THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-# X CONSORTIUM BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
-# AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNEC-
-# TION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-#
-# Except as contained in this notice, the name of the X Consortium shall not
-# be used in advertising or otherwise to promote the sale, use or other deal-
-# ings in this Software without prior written authorization from the X Consor-
-# tium.
-#
-#
-# FSF changes to this file are in the public domain.
-#
-# Calling this script install-sh is preferred over install.sh, to prevent
-# `make' implicit rules from creating a file called install from it
-# when there is no Makefile.
-#
-# This script is compatible with the BSD install script, but was written
-# from scratch.  It can only install one file at a time, a restriction
-# shared with many OS's install programs.
-
-# set DOITPROG to echo to test this script
-
-# Don't use :- since 4.3BSD and earlier shells don't like it.
-doit=&quot;${DOITPROG-}&quot;
-
-# put in absolute paths if you don't have them in your path; or use env. vars.
-
-mvprog=&quot;${MVPROG-mv}&quot;
-cpprog=&quot;${CPPROG-cp}&quot;
-chmodprog=&quot;${CHMODPROG-chmod}&quot;
-chownprog=&quot;${CHOWNPROG-chown}&quot;
-chgrpprog=&quot;${CHGRPPROG-chgrp}&quot;
-stripprog=&quot;${STRIPPROG-strip}&quot;
-rmprog=&quot;${RMPROG-rm}&quot;
-mkdirprog=&quot;${MKDIRPROG-mkdir}&quot;
-
-chmodcmd=&quot;$chmodprog 0755&quot;
-chowncmd=
-chgrpcmd=
-stripcmd=
-rmcmd=&quot;$rmprog -f&quot;
-mvcmd=&quot;$mvprog&quot;
-src=
-dst=
-dir_arg=
-dstarg=
-no_target_directory=
-
-usage=&quot;Usage: $0 [OPTION]... [-T] SRCFILE DSTFILE
-   or: $0 [OPTION]... SRCFILES... DIRECTORY
-   or: $0 [OPTION]... -t DIRECTORY SRCFILES...
-   or: $0 [OPTION]... -d DIRECTORIES...
-
-In the 1st form, copy SRCFILE to DSTFILE.
-In the 2nd and 3rd, copy all SRCFILES to DIRECTORY.
-In the 4th, create DIRECTORIES.
-
-Options:
--c         (ignored)
--d         create directories instead of installing files.
--g GROUP   $chgrpprog installed files to GROUP.
--m MODE    $chmodprog installed files to MODE.
--o USER    $chownprog installed files to USER.
--s         $stripprog installed files.
--t DIRECTORY  install into DIRECTORY.
--T         report an error if DSTFILE is a directory.
---help     display this help and exit.
---version  display version info and exit.
-
-Environment variables override the default commands:
-  CHGRPPROG CHMODPROG CHOWNPROG CPPROG MKDIRPROG MVPROG RMPROG STRIPPROG
-&quot;
-
-while test -n &quot;$1&quot;; do
-  case $1 in
-    -c) shift
-        continue;;
-
-    -d) dir_arg=true
-        shift
-        continue;;
-
-    -g) chgrpcmd=&quot;$chgrpprog $2&quot;
-        shift
-        shift
-        continue;;
-
-    --help) echo &quot;$usage&quot;; exit $?;;
-
-    -m) chmodcmd=&quot;$chmodprog $2&quot;
-        shift
-        shift
-        continue;;
-
-    -o) chowncmd=&quot;$chownprog $2&quot;
-        shift
-        shift
-        continue;;
-
-    -s) stripcmd=$stripprog
-        shift
-        continue;;
-
-    -t) dstarg=$2
-	shift
-	shift
-	continue;;
-
-    -T) no_target_directory=true
-	shift
-	continue;;
-
-    --version) echo &quot;$0 $scriptversion&quot;; exit $?;;
-
-    *)  # When -d is used, all remaining arguments are directories to create.
-	# When -t is used, the destination is already specified.
-	test -n &quot;$dir_arg$dstarg&quot; &amp;&amp; break
-        # Otherwise, the last argument is the destination.  Remove it from $@.
-	for arg
-	do
-          if test -n &quot;$dstarg&quot;; then
-	    # $@ is not empty: it contains at least $arg.
-	    set fnord &quot;$@&quot; &quot;$dstarg&quot;
-	    shift # fnord
-	  fi
-	  shift # arg
-	  dstarg=$arg
-	done
-	break;;
-  esac
-done
-
-if test -z &quot;$1&quot;; then
-  if test -z &quot;$dir_arg&quot;; then
-    echo &quot;$0: no input file specified.&quot; &gt;&amp;2
-    exit 1
-  fi
-  # It's OK to call `install-sh -d' without argument.
-  # This can happen when creating conditional directories.
-  exit 0
-fi
-
-for src
-do
-  # Protect names starting with `-'.
-  case $src in
-    -*) src=./$src ;;
-  esac
-
-  if test -n &quot;$dir_arg&quot;; then
-    dst=$src
-    src=
-
-    if test -d &quot;$dst&quot;; then
-      mkdircmd=:
-      chmodcmd=
-    else
-      mkdircmd=$mkdirprog
-    fi
-  else
-    # Waiting for this to be detected by the &quot;$cpprog $src $dsttmp&quot; command
-    # might cause directories to be created, which would be especially bad
-    # if $src (and thus $dsttmp) contains '*'.
-    if test ! -f &quot;$src&quot; &amp;&amp; test ! -d &quot;$src&quot;; then
-      echo &quot;$0: $src does not exist.&quot; &gt;&amp;2
-      exit 1
-    fi
-
-    if test -z &quot;$dstarg&quot;; then
-      echo &quot;$0: no destination specified.&quot; &gt;&amp;2
-      exit 1
-    fi
-
-    dst=$dstarg
-    # Protect names starting with `-'.
-    case $dst in
-      -*) dst=./$dst ;;
-    esac
-
-    # If destination is a directory, append the input filename; won't work
-    # if double slashes aren't ignored.
-    if test -d &quot;$dst&quot;; then
-      if test -n &quot;$no_target_directory&quot;; then
-	echo &quot;$0: $dstarg: Is a directory&quot; &gt;&amp;2
-	exit 1
-      fi
-      dst=$dst/`basename &quot;$src&quot;`
-    fi
-  fi
-
-  # This sed command emulates the dirname command.
-  dstdir=`echo &quot;$dst&quot; | sed -e 's,/*$,,;s,[^/]*$,,;s,/*$,,;s,^$,.,'`
-
-  # Make sure that the destination directory exists.
-
-  # Skip lots of stat calls in the usual case.
-  if test ! -d &quot;$dstdir&quot;; then
-    defaultIFS='
-	 '
-    IFS=&quot;${IFS-$defaultIFS}&quot;
-
-    oIFS=$IFS
-    # Some sh's can't handle IFS=/ for some reason.
-    IFS='%'
-    set x `echo &quot;$dstdir&quot; | sed -e 's@/@%@g' -e 's@^%@/@'`
-    shift
-    IFS=$oIFS
-
-    pathcomp=
-
-    while test $# -ne 0 ; do
-      pathcomp=$pathcomp$1
-      shift
-      if test ! -d &quot;$pathcomp&quot;; then
-        $mkdirprog &quot;$pathcomp&quot;
-	# mkdir can fail with a `File exist' error in case several
-	# install-sh are creating the directory concurrently.  This
-	# is OK.
-	test -d &quot;$pathcomp&quot; || exit
-      fi
-      pathcomp=$pathcomp/
-    done
-  fi
-
-  if test -n &quot;$dir_arg&quot;; then
-    $doit $mkdircmd &quot;$dst&quot; \
-      &amp;&amp; { test -z &quot;$chowncmd&quot; || $doit $chowncmd &quot;$dst&quot;; } \
-      &amp;&amp; { test -z &quot;$chgrpcmd&quot; || $doit $chgrpcmd &quot;$dst&quot;; } \
-      &amp;&amp; { test -z &quot;$stripcmd&quot; || $doit $stripcmd &quot;$dst&quot;; } \
-      &amp;&amp; { test -z &quot;$chmodcmd&quot; || $doit $chmodcmd &quot;$dst&quot;; }
-
-  else
-    dstfile=`basename &quot;$dst&quot;`
-
-    # Make a couple of temp file names in the proper directory.
-    dsttmp=$dstdir/_inst.$$_
-    rmtmp=$dstdir/_rm.$$_
-
-    # Trap to clean up those temp files at exit.
-    trap 'ret=$?; rm -f &quot;$dsttmp&quot; &quot;$rmtmp&quot; &amp;&amp; exit $ret' 0
-    trap '(exit $?); exit' 1 2 13 15
-
-    # Copy the file name to the temp name.
-    $doit $cpprog &quot;$src&quot; &quot;$dsttmp&quot; &amp;&amp;
-
-    # and set any options; do chmod last to preserve setuid bits.
-    #
-    # If any of these fail, we abort the whole thing.  If we want to
-    # ignore errors from any of these, just make sure not to ignore
-    # errors from the above &quot;$doit $cpprog $src $dsttmp&quot; command.
-    #
-    { test -z &quot;$chowncmd&quot; || $doit $chowncmd &quot;$dsttmp&quot;; } \
-      &amp;&amp; { test -z &quot;$chgrpcmd&quot; || $doit $chgrpcmd &quot;$dsttmp&quot;; } \
-      &amp;&amp; { test -z &quot;$stripcmd&quot; || $doit $stripcmd &quot;$dsttmp&quot;; } \
-      &amp;&amp; { test -z &quot;$chmodcmd&quot; || $doit $chmodcmd &quot;$dsttmp&quot;; } &amp;&amp;
-
-    # Now rename the file to the real destination.
-    { $doit $mvcmd -f &quot;$dsttmp&quot; &quot;$dstdir/$dstfile&quot; 2&gt;/dev/null \
-      || {
-	   # The rename failed, perhaps because mv can't rename something else
-	   # to itself, or perhaps because mv is so ancient that it does not
-	   # support -f.
-
-	   # Now remove or move aside any old file at destination location.
-	   # We try this two ways since rm can't unlink itself on some
-	   # systems and the destination file might be busy for other
-	   # reasons.  In this case, the final cleanup might fail but the new
-	   # file should still install successfully.
-	   {
-	     if test -f &quot;$dstdir/$dstfile&quot;; then
-	       $doit $rmcmd -f &quot;$dstdir/$dstfile&quot; 2&gt;/dev/null \
-	       || $doit $mvcmd -f &quot;$dstdir/$dstfile&quot; &quot;$rmtmp&quot; 2&gt;/dev/null \
-	       || {
-		 echo &quot;$0: cannot unlink or rename $dstdir/$dstfile&quot; &gt;&amp;2
-		 (exit 1); exit 1
-	       }
-	     else
-	       :
-	     fi
-	   } &amp;&amp;
-
-	   # Now rename the file to the real destination.
-	   $doit $mvcmd &quot;$dsttmp&quot; &quot;$dstdir/$dstfile&quot;
-	 }
-    }
-  fi || { (exit 1); exit 1; }
-done
-
-# The final little trick to &quot;correctly&quot; pass the exit status to the exit trap.
-{
-  (exit 0); exit 0
-}
-
-# Local variables:
-# eval: (add-hook 'write-file-hooks 'time-stamp)
-# time-stamp-start: &quot;scriptversion=&quot;
-# time-stamp-format: &quot;%:y-%02m-%02d.%02H&quot;
-# time-stamp-end: &quot;$&quot;
-# End:

Deleted: branches/map65/int.h
===================================================================
--- branches/map65/int.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/int.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,57 +0,0 @@
-/* Include file to configure the RS codec for integer symbols
- *
- * Copyright 2002, Phil Karn, KA9Q
- * May be used under the terms of the GNU General Public License (GPL)
- */
-#define DTYPE int
-
-/* Reed-Solomon codec control block */
-struct rs {
-  int mm;              /* Bits per symbol */
-  int nn;              /* Symbols per block (= (1&lt;&lt;mm)-1) */
-  DTYPE *alpha_to;     /* log lookup table */
-  DTYPE *index_of;     /* Antilog lookup table */
-  DTYPE *genpoly;      /* Generator polynomial */
-  int nroots;     /* Number of generator roots = number of parity symbols */
-  int fcr;        /* First consecutive root, index form */
-  int prim;       /* Primitive element, index form */
-  int iprim;      /* prim-th root of 1, index form */
-  int pad;        /* Padding bytes in shortened block */
-};
-
-static int modnn(struct rs *rs,int x){
-  while (x &gt;= rs-&gt;nn) {
-    x -= rs-&gt;nn;
-    x = (x &gt;&gt; rs-&gt;mm) + (x &amp; rs-&gt;nn);
-  }
-  return x;
-}
-#define MODNN(x) modnn(rs,x)
-
-#define MM (rs-&gt;mm)
-#define NN (rs-&gt;nn)
-#define ALPHA_TO (rs-&gt;alpha_to) 
-#define INDEX_OF (rs-&gt;index_of)
-#define GENPOLY (rs-&gt;genpoly)
-//#define NROOTS (rs-&gt;nroots)
-#define NROOTS (51)
-#define FCR (rs-&gt;fcr)
-#define PRIM (rs-&gt;prim)
-#define IPRIM (rs-&gt;iprim)
-#define PAD (rs-&gt;pad)
-#define A0 (NN)
-
-#define ENCODE_RS encode_rs_int
-#define DECODE_RS decode_rs_int
-#define INIT_RS init_rs_int
-#define FREE_RS free_rs_int
-
-void ENCODE_RS(void *p,DTYPE *data,DTYPE *parity);
-int DECODE_RS(void *p,DTYPE *data,int *eras_pos,int no_eras);
-void *INIT_RS(int symsize,int gfpoly,int fcr,
-		   int prim,int nroots,int pad);
-void FREE_RS(void *p);
-
-
-
-

Deleted: branches/map65/interleave63.f
===================================================================
--- branches/map65/interleave63.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/interleave63.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,25 +0,0 @@
-      subroutine interleave63(d1,idir)
-
-C  Interleave (idir=1) or de-interleave (idir=-1) the array d1.
-
-      integer d1(0:6,0:8)
-      integer d2(0:8,0:6)
-
-      if(idir.ge.0) then
-         do i=0,6
-            do j=0,8
-               d2(j,i)=d1(i,j)
-            enddo
-         enddo
-         call move(d2,d1,63)
-      else
-         call move(d1,d2,63)
-         do i=0,6
-            do j=0,8
-               d1(i,j)=d2(j,i)
-            enddo
-         enddo
-      endif
-         
-      return
-      end

Deleted: branches/map65/jtaudio.c
===================================================================
--- branches/map65/jtaudio.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/jtaudio.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,263 +0,0 @@
-#include &lt;stdio.h&gt;
-#include &lt;portaudio.h&gt;
-#include &lt;string.h&gt;
-
-void fivehz_();
-void fivehztx_();
-void addnoise_(short int *n);
-
-//  Definition of structure pointing to the audio data
-typedef struct
-{
-  double *Tsec;
-  double *tbuf;
-  int    *iwrite;
-  int    *ibuf;
-  int    *TxOK;
-  int    *ndebug;
-  int    *ndsec;
-  int    *Transmitting;
-  int    *nwave;
-  int    *nmode;
-  int    *trperiod;
-  int     nbuflen;
-  int     nfs;
-  short  *y1;
-  short  *y2;
-  short  *iwave;
-}
-paTestData;
-
-typedef struct _SYSTEMTIME
-{
-  short   Year;
-  short   Month;
-  short   DayOfWeek;
-  short   Day;
-  short   Hour;
-  short   Minute;
-  short   Second;
-  short   Millisecond;
-} SYSTEMTIME;
-
-#ifdef Win32
-extern void __stdcall GetSystemTime(SYSTEMTIME *st);
-#else
-#include &lt;sys/time.h&gt;
-#include &lt;time.h&gt;
-
-void GetSystemTime(SYSTEMTIME *st){
-  struct timeval tmptimeofday;
-  struct tm tmptmtime;
-  gettimeofday(&amp;tmptimeofday,NULL);
-  gmtime_r((const time_t *)&amp;tmptimeofday.tv_sec,&amp;tmptmtime);
-  st-&gt;Year = (short)tmptmtime.tm_year;
-  st-&gt;Month = (short)tmptmtime.tm_year;
-  st-&gt;DayOfWeek = (short)tmptmtime.tm_wday;
-  st-&gt;Day = (short)tmptmtime.tm_mday;
-  st-&gt;Hour = (short)tmptmtime.tm_hour;
-  st-&gt;Minute = (short)tmptmtime.tm_min;
-  st-&gt;Second = (short)tmptmtime.tm_sec;
-  st-&gt;Millisecond = (short)(tmptimeofday.tv_usec/1000);
-}
-#endif
-
-//  Output callback routine:
-static int SoundOut( void *inputBuffer, void *outputBuffer,
-		       unsigned long framesPerBuffer,
-		       const PaStreamCallbackTimeInfo* timeInfo, 
-		       PaStreamCallbackFlags statusFlags,
-		       void *userData )
-{
-  paTestData *data = (paTestData*)userData;
-  short *wptr = (short*)outputBuffer;
-  unsigned int i,n;
-  static short int n2;
-  static int n0;
-  static int ia=0;
-  static int ib=0;
-  static int ic=0;
-  static int TxOKz=0;
-  static double stime0=86400.0;
-  int nsec;
-  double stime;
-  SYSTEMTIME st;
-
-  // Get System time
-  GetSystemTime(&amp;st);
-  nsec = (int) (st.Hour*3600.0 + st.Minute*60.0 + st.Second);
-  stime = nsec + st.Millisecond*0.001 + *data-&gt;ndsec*0.1;
-  *data-&gt;Tsec = stime;
-  nsec=(int)stime;
-
-  if(*data-&gt;TxOK &amp;&amp; (!TxOKz))  {
-    n=nsec/(*data-&gt;trperiod);
-    //    ic = (int)(stime - *data-&gt;trperiod*n) * data-&gt;nfs/framesPerBuffer;
-    //    ic = framesPerBuffer*ic;
-    ic = (int)(stime - *data-&gt;trperiod*n) * data-&gt;nfs;
-    ic = ic % *data-&gt;nwave;
-  }
-
-  TxOKz=*data-&gt;TxOK;
-  *data-&gt;Transmitting=*data-&gt;TxOK;
-
-  if(*data-&gt;TxOK)  {
-    for(i=0 ; i&lt;framesPerBuffer; i++ )  {
-      n2=data-&gt;iwave[ic];
-      addnoise_(&amp;n2);
-      *wptr++ = n2;                   //left
-      *wptr++ = n2;                   //right
-      ic++;
-      if(ic&gt;=*data-&gt;nwave) {
-	if(*data-&gt;nmode==2) {
-	  *data-&gt;TxOK=0;
-	  ic--;
-	}
-	else
-	  ic = ic % *data-&gt;nwave;       //Wrap buffer pointer if necessary
-      }
-    }
-  } else {
-    memset((void*)outputBuffer, 0, 2*sizeof(short)*framesPerBuffer);
-  }
-  fivehz_();                               //Call fortran routine
-  fivehztx_();                             //Call fortran routine
-  return 0;
-}
-
-/*******************************************************************/
-int jtaudio_(int *ndevin, int *ndevout, short y1[], short y2[], 
-	     int *nbuflen, int *iwrite, short iwave[], 
-	     int *nwave, int *nfsample, int *nsamperbuf,
-	     int *TRPeriod, int *TxOK, int *ndebug,
- 	     int *Transmitting, double *Tsec, int *ngo, int *nmode,
-	     double tbuf[], int *ibuf, int *ndsec)
-{
-  paTestData data;
-  PaStream *outstream;
-  PaStreamParameters outputParameters;
-
-  int nfs,ndin,ndout;
-  PaError err1,err2,err2a,err3,err3a;
-  double dnfs;
-
-  data.Tsec = Tsec;
-  data.tbuf = tbuf;
-  data.iwrite = iwrite;
-  data.ibuf = ibuf;
-  data.TxOK = TxOK;
-  data.ndebug = ndebug;
-  data.ndsec = ndsec;
-  data.Transmitting = Transmitting;
-  data.y1 = y1;
-  data.y2 = y2;
-  data.nbuflen = *nbuflen;
-  data.nmode = nmode;
-  data.nwave = nwave;
-  data.iwave = iwave;
-  data.nfs = *nfsample;
-  data.trperiod = TRPeriod;
-
-  nfs=*nfsample;
-  err1=Pa_Initialize();                      // Initialize PortAudio
-  if(err1) {
-    printf(&quot;Error initializing PortAudio.\n&quot;);
-    printf(&quot;%s\n&quot;,Pa_GetErrorText(err1));
-    goto error;
-  }
-
-  ndin=*ndevin;
-  ndout=*ndevout;
-  dnfs=(double)nfs;
-  printf(&quot;Opening device %d for output.\n&quot;,ndout);
-
-  outputParameters.device=*ndevout;
-  outputParameters.channelCount=2;
-  outputParameters.sampleFormat=paInt16;
-  outputParameters.suggestedLatency=1.0;
-  outputParameters.hostApiSpecificStreamInfo=NULL;
-  err2a=Pa_OpenStream(
-		       &amp;outstream,      //address of stream
-		       NULL,
-		       &amp;outputParameters,
-		       dnfs,            //Sample rate
-		       2048,            //Frames per buffer
-		       paNoFlag,
-		       (PaStreamCallback *)SoundOut, //Callback routine
-		       (void *)&amp;data);               //address of data structure
-  if(err2a) {
-    printf(&quot;Error opening Audio stream for output.\n&quot;);
-    printf(&quot;%s\n&quot;,Pa_GetErrorText(err2a));
-    goto error;
-  }
-
-  err3a=Pa_StartStream(outstream);             //Start output stream
-  if(err3a) {
-    printf(&quot;Error starting output Audio stream\n&quot;);
-    printf(&quot;%s\n&quot;,Pa_GetErrorText(err3a));
-    goto error;
-  }
-
-  printf(&quot;Audio output stream running normally.\n******************************************************************\n&quot;);
-
-  while(Pa_IsStreamActive(outstream))  {
-    if(*ngo==0) goto StopStream;
-    Pa_Sleep(200);
-  }
-
- StopStream:
-  Pa_AbortStream(outstream);              // Abort stream
-  Pa_CloseStream(outstream);             // Close stream, we're done.
-  Pa_Terminate();
-  return(0);
-
-error:
-  printf(&quot;%d  %f  %d  %d  %d\n&quot;,ndout,dnfs,err1,err2a,err3a);
-  Pa_Terminate();
-  return(1);
-}
-
-
-int padevsub_(int *numdev, int *ndefin, int *ndefout, 
-	      int nchin[], int nchout[])
-{
-  int      i;
-  int      numDevices;
-  const    PaDeviceInfo *pdi;
-  PaError  err;
-  //  PaHostApiInfo *hostapi;
-  
-  Pa_Initialize();
-
-  //  numDevices = Pa_CountDevices();
-  numDevices = Pa_GetDeviceCount();
- 
-  *numdev=numDevices;
-  if( numDevices &lt; 0 )  {
-    err = numDevices;
-    goto error;
-  }
-
-
-  printf(&quot;\nAudio    Output    Device Name\n&quot;);
-  printf(&quot;Device  Channels\n&quot;);
-  printf(&quot;----------------------------------------------------------\n&quot;);
-
-  for( i=0; i&lt;numDevices; i++ )  {
-    pdi = Pa_GetDeviceInfo( i );
-    if(i == Pa_GetDefaultInputDevice()) *ndefin=i;
-    if(i == Pa_GetDefaultOutputDevice()) *ndefout=i;
-    nchin[i]=pdi-&gt;maxInputChannels;
-    nchout[i]=pdi-&gt;maxOutputChannels;
-    if(nchout[i]&gt;0) 
-      printf(&quot;  %2d      %2d       %s\n&quot;,i,nchout[i],pdi-&gt;name);
-  }
-
-  Pa_Terminate();
-  return 0;
-
- error:
-  Pa_Terminate();
-  return err;
-}
-

Deleted: branches/map65/k2grid.f
===================================================================
--- branches/map65/k2grid.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/k2grid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,12 +0,0 @@
-      subroutine k2grid(k,grid)
-      character grid*6
-
-      nlong=2*mod((k-1)/5,90)-179
-      if(k.gt.450) nlong=nlong+180
-      nlat=mod(k-1,5)+ 85
-      dlat=nlat
-      dlong=nlong
-      call deg2grid(dlong,dlat,grid)
-
-      return
-      end

Added: branches/map65/killbyname.cpp
===================================================================
--- branches/map65/killbyname.cpp	                        (rev 0)
+++ branches/map65/killbyname.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,282 @@
+#include &lt;windows.h&gt;
+#include &lt;tlhelp32.h&gt;
+#include &lt;iostream&gt;
+
+int killbyname(const char *szToTerminate)
+// Created: 6/23/2000  (Ravi Kochhar)
+// Last modified: 3/10/2002  (RK)
+// Please report any problems or bugs to <A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">kochhar at physiology.wisc.edu</A>
+// The latest version of this routine can be found at:
+//     <A HREF="http://www.neurophys.wisc.edu/ravi/software/killproc/">http://www.neurophys.wisc.edu/ravi/software/killproc/</A>
+// Terminate the process &quot;szToTerminate&quot; if it is currently running
+// This works for Win/95/98/ME and also Win/NT/2000/XP
+// The process name is case-insensitive, i.e. &quot;notepad.exe&quot; and &quot;NOTEPAD.EXE&quot;
+// will both work (for szToTerminate)
+// Return codes are as follows:
+//   0   = Process was successfully terminated
+//   602 = Unable to terminate process for some other reason
+//   603 = Process was not currently running
+//   604 = No permission to terminate process
+//   605 = Unable to load PSAPI.DLL
+//   606 = Unable to identify system type
+//   607 = Unsupported OS
+//   632 = Invalid process name
+//   700 = Unable to get procedure address from PSAPI.DLL
+//   701 = Unable to get process list, EnumProcesses failed
+//   702 = Unable to load KERNEL32.DLL
+//   703 = Unable to get procedure address from KERNEL32.DLL
+//   704 = CreateToolhelp32Snapshot failed
+
+{
+  BOOL bResult,bResultm;
+  DWORD aiPID[1000],iCb=1000,iNumProc;  //,iV2000=0;
+  DWORD iCbneeded,i,iFound=0;
+  char szName[MAX_PATH],szToTermUpper[MAX_PATH];
+  HANDLE hProc,hSnapShot,hSnapShotm;
+  OSVERSIONINFO osvi;
+  HINSTANCE hInstLib;
+  int iLen,iLenP,indx;
+  HMODULE hMod;
+  PROCESSENTRY32 procentry;
+  MODULEENTRY32 modentry;
+
+  // Transfer Process name into &quot;szToTermUpper&quot; and convert to upper case
+  iLenP=strlen(szToTerminate);
+  if(iLenP&lt;1 || iLenP&gt;MAX_PATH) return 632;
+  for(indx=0;indx&lt;iLenP;indx++)
+    szToTermUpper[indx]=toupper(szToTerminate[indx]);
+  szToTermUpper[iLenP]=0;
+
+  // PSAPI Function Pointers.
+  BOOL (WINAPI *lpfEnumProcesses)( DWORD *, DWORD cb, DWORD * );
+  BOOL (WINAPI *lpfEnumProcessModules)( HANDLE, HMODULE *,
+                                        DWORD, LPDWORD );
+  DWORD (WINAPI *lpfGetModuleBaseName)( HANDLE, HMODULE,
+                                        LPTSTR, DWORD );
+
+  // ToolHelp Function Pointers.
+  HANDLE (WINAPI *lpfCreateToolhelp32Snapshot)(DWORD,DWORD) ;
+  BOOL (WINAPI *lpfProcess32First)(HANDLE,LPPROCESSENTRY32) ;
+  BOOL (WINAPI *lpfProcess32Next)(HANDLE,LPPROCESSENTRY32) ;
+  BOOL (WINAPI *lpfModule32First)(HANDLE,LPMODULEENTRY32) ;
+  BOOL (WINAPI *lpfModule32Next)(HANDLE,LPMODULEENTRY32) ;
+
+  // First check what version of Windows we're in
+  osvi.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
+  bResult=GetVersionEx(&amp;osvi);
+  if(!bResult) return 606;    // Unable to identify system version
+
+  // At Present we only support Win/NT/2000/XP or Win/9x/ME
+  // Seems to work OK in Win7
+  if((osvi.dwPlatformId != VER_PLATFORM_WIN32_NT) &amp;&amp;
+     (osvi.dwPlatformId != VER_PLATFORM_WIN32_WINDOWS)) return 607;
+
+  if(osvi.dwPlatformId==VER_PLATFORM_WIN32_NT)
+  {
+    // Win/NT or 2000 or XP
+
+    // Load library and get the procedures explicitly. We do
+    // this so that we don't have to worry about modules using
+    // this code failing to load under Windows 9x, because
+    // it can't resolve references to the PSAPI.DLL.
+    hInstLib = LoadLibraryA(&quot;PSAPI.DLL&quot;);
+    if(hInstLib == NULL) return 605;
+
+    // Get procedure addresses.
+    lpfEnumProcesses = (BOOL(WINAPI *)(DWORD *,DWORD,DWORD*))
+        GetProcAddress( hInstLib, &quot;EnumProcesses&quot; ) ;
+    lpfEnumProcessModules = (BOOL(WINAPI *)(HANDLE, HMODULE *,
+        DWORD, LPDWORD)) GetProcAddress( hInstLib,                                                                     &quot;EnumProcessModules&quot; ) ;
+        lpfGetModuleBaseName =(DWORD (WINAPI *)(HANDLE, HMODULE, LPTSTR,
+        DWORD )) GetProcAddress( hInstLib, &quot;GetModuleBaseNameA&quot; ) ;
+
+    if(lpfEnumProcesses == NULL || lpfEnumProcessModules == NULL ||
+         lpfGetModuleBaseName == NULL) {
+      FreeLibrary(hInstLib);
+      return 700;
+    }
+
+    bResult=lpfEnumProcesses(aiPID,iCb,&amp;iCbneeded);
+    if(!bResult) {
+      // Unable to get process list, EnumProcesses failed
+      FreeLibrary(hInstLib);
+      return 701;
+    }
+
+    // How many processes are there?
+    iNumProc=iCbneeded/sizeof(DWORD);
+
+    // Get and match the name of each process
+    for(i=0;i&lt;iNumProc;i++) {
+      // Get the (module) name for this process
+      strcpy(szName,&quot;Unknown&quot;);
+      // First, get a handle to the process
+      hProc=OpenProcess(PROCESS_QUERY_INFORMATION|PROCESS_VM_READ,FALSE,
+                        aiPID[i]);
+      // Now, get the process name
+      if(hProc) {
+        if(lpfEnumProcessModules(hProc,&amp;hMod,sizeof(hMod),&amp;iCbneeded) ) {
+          iLen=lpfGetModuleBaseName(hProc,hMod,szName,MAX_PATH);
+        }
+      }
+      CloseHandle(hProc);
+      // We will match regardless of lower or upper case
+      if(strcmp(_strupr(szName),szToTermUpper)==0) {
+        // Process found, now terminate it
+        iFound=1;
+        // First open for termination
+        hProc=OpenProcess(PROCESS_TERMINATE,FALSE,aiPID[i]);
+        if(hProc) {
+          if(TerminateProcess(hProc,0)) {
+            // process terminated
+            CloseHandle(hProc);
+            FreeLibrary(hInstLib);
+            return 0;
+          } else {
+            // Unable to terminate process
+            CloseHandle(hProc);
+            FreeLibrary(hInstLib);
+            return 602;
+          }
+        } else {
+          // Unable to open process for termination
+          FreeLibrary(hInstLib);
+          return 604;
+        }
+      }
+    }
+  }
+
+  if(osvi.dwPlatformId==VER_PLATFORM_WIN32_WINDOWS)
+  {
+    // Win/95 or 98 or ME
+
+    hInstLib = LoadLibraryA(&quot;Kernel32.DLL&quot;);
+    if( hInstLib == NULL )
+      return 702;
+
+    // Get procedure addresses.
+    // We are linking to these functions of Kernel32
+    // explicitly, because otherwise a module using
+    // this code would fail to load under Windows NT,
+    // which does not have the Toolhelp32
+    // functions in the Kernel 32.
+    lpfCreateToolhelp32Snapshot=
+        (HANDLE(WINAPI *)(DWORD,DWORD))
+        GetProcAddress( hInstLib,
+                        &quot;CreateToolhelp32Snapshot&quot; ) ;
+    lpfProcess32First=
+        (BOOL(WINAPI *)(HANDLE,LPPROCESSENTRY32))
+        GetProcAddress( hInstLib, &quot;Process32First&quot; ) ;
+    lpfProcess32Next=
+        (BOOL(WINAPI *)(HANDLE,LPPROCESSENTRY32))
+        GetProcAddress( hInstLib, &quot;Process32Next&quot; ) ;
+    lpfModule32First=
+        (BOOL(WINAPI *)(HANDLE,LPMODULEENTRY32))
+        GetProcAddress( hInstLib, &quot;Module32First&quot; ) ;
+    lpfModule32Next=
+        (BOOL(WINAPI *)(HANDLE,LPMODULEENTRY32))
+        GetProcAddress( hInstLib, &quot;Module32Next&quot; ) ;
+    if( lpfProcess32Next == NULL ||
+        lpfProcess32First == NULL ||
+        lpfModule32Next == NULL ||
+        lpfModule32First == NULL ||
+        lpfCreateToolhelp32Snapshot == NULL )
+    {
+      FreeLibrary(hInstLib);
+      return 703;
+    }
+
+    // The Process32.. and Module32.. routines return names in all uppercase
+
+    // Get a handle to a Toolhelp snapshot of all the systems processes.
+
+    hSnapShot = lpfCreateToolhelp32Snapshot(
+          TH32CS_SNAPPROCESS, 0 ) ;
+    if( hSnapShot == INVALID_HANDLE_VALUE )
+    {
+      FreeLibrary(hInstLib);
+      return 704;
+    }
+
+    // Get the first process' information.
+    procentry.dwSize = sizeof(PROCESSENTRY32);
+    bResult=lpfProcess32First(hSnapShot,&amp;procentry);
+
+    // While there are processes, keep looping and checking.
+    while(bResult)
+    {
+      // Get a handle to a Toolhelp snapshot of this process.
+      hSnapShotm = lpfCreateToolhelp32Snapshot(
+            TH32CS_SNAPMODULE, procentry.th32ProcessID) ;
+      if( hSnapShotm == INVALID_HANDLE_VALUE )
+      {
+        CloseHandle(hSnapShot);
+        FreeLibrary(hInstLib);
+        return 704;
+      }
+      // Get the module list for this process
+      modentry.dwSize=sizeof(MODULEENTRY32);
+      bResultm=lpfModule32First(hSnapShotm,&amp;modentry);
+
+      // While there are modules, keep looping and checking
+      while(bResultm)
+      {
+        if(strcmp(modentry.szModule,szToTermUpper)==0)
+        {
+          // Process found, now terminate it
+          iFound=1;
+          // First open for termination
+          hProc=OpenProcess(PROCESS_TERMINATE,FALSE,procentry.th32ProcessID);
+          if(hProc)
+          {
+            if(TerminateProcess(hProc,0))
+            {
+              // process terminated
+              CloseHandle(hSnapShotm);
+              CloseHandle(hSnapShot);
+              CloseHandle(hProc);
+              FreeLibrary(hInstLib);
+              return 0;
+            }
+            else
+            {
+              // Unable to terminate process
+              CloseHandle(hSnapShotm);
+              CloseHandle(hSnapShot);
+              CloseHandle(hProc);
+              FreeLibrary(hInstLib);
+              return 602;
+            }
+          }
+          else
+          {
+            // Unable to open process for termination
+            CloseHandle(hSnapShotm);
+            CloseHandle(hSnapShot);
+            FreeLibrary(hInstLib);
+            return 604;
+          }
+        }
+        else
+        {  // Look for next modules for this process
+          modentry.dwSize=sizeof(MODULEENTRY32);
+          bResultm=lpfModule32Next(hSnapShotm,&amp;modentry);
+        }
+      }
+
+      //Keep looking
+      CloseHandle(hSnapShotm);
+      procentry.dwSize = sizeof(PROCESSENTRY32);
+      bResult = lpfProcess32Next(hSnapShot,&amp;procentry);
+    }
+    CloseHandle(hSnapShot);
+  }
+  if(iFound==0)
+  {
+    FreeLibrary(hInstLib);
+    return 603;
+  }
+  FreeLibrary(hInstLib);
+  return 0;
+}

Deleted: branches/map65/kvasd
===================================================================
(Binary files differ)

Added: branches/map65/kvasd2.exe
===================================================================
(Binary files differ)


Property changes on: branches/map65/kvasd2.exe
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Deleted: branches/map65/kvasd_g95
===================================================================
(Binary files differ)

Deleted: branches/map65/kvasd_gfortran
===================================================================
(Binary files differ)

Deleted: branches/map65/libfftw3f.a
===================================================================
(Binary files differ)

Deleted: branches/map65/libfftw3f_win.a
===================================================================
(Binary files differ)

Added: branches/map65/libfftw3f_win.a
===================================================================
(Binary files differ)


Property changes on: branches/map65/libfftw3f_win.a
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: branches/map65/libm65/JT65code.f90
===================================================================
--- branches/map65/libm65/JT65code.f90	                        (rev 0)
+++ branches/map65/libm65/JT65code.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,47 @@
+program JT65code
+
+! Provides examples of message packing, bit and symbol ordering,
+! Reed Solomon encoding, and other necessary details of the JT65
+! protocol.
+
+  character*22 msg0,msg,decoded,cok*3
+  integer dgen(12),sent(63),recd(12),era(51)
+
+  nargs=iargc()
+  if(nargs.ne.1) then
+     print*,'Usage: JT65code &quot;message&quot;'
+     go to 999
+  endif
+
+  call getarg(1,msg0)                     !Get message from command line
+  msg=msg0
+
+  call chkmsg(msg,cok,nspecial,flip)      !See if it includes &quot;OOO&quot; report
+  if(nspecial.gt.0) then                  !or is a shorthand message
+     write(*,1010) 
+1010 format('Shorthand message.')
+     go to 999
+  endif
+
+  call packmsg(msg,dgen)                  !Pack message into 72 bits
+  write(*,1020) msg0
+1020 format('Message:   ',a22)            !Echo input message
+  if(iand(dgen(10),8).ne.0) write(*,1030) !Is plain text bit set?
+1030 format('Plain text.')         
+  write(*,1040) dgen
+1040 format('Packed message, 6-bit symbols: ',12i3) !Display packed symbols
+
+  call rs_encode(dgen,sent)               !RS encode
+  call interleave63(sent,1)               !Interleave channel symbols
+  call graycode(sent,63,1)                !Apply Gray code
+  write(*,1050) sent
+1050 format('Channel symbols, including FEC:'/(i5,20i3))
+
+  call graycode(sent,63,-1)
+  call interleave63(sent,-1)
+  call rs_decode(sent,era,0,recd,nerr)
+  call unpackmsg(recd,decoded)            !Unpack the user message
+  write(*,1060) decoded,cok
+1060 format('Decoded message: ',a22,2x,a3)
+
+999 end program JT65code

Added: branches/map65/libm65/Makefile.MinGW
===================================================================
--- branches/map65/libm65/Makefile.MinGW	                        (rev 0)
+++ branches/map65/libm65/Makefile.MinGW	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,92 @@
+# Makefile for MinGW on Windows
+CC = gcc
+FC = g95
+
+FFLAGS = -O2 -fbounds-check -Wall -Wno-precision-loss -fno-second-underscore
+CFLAGS = -I. -fbounds-check
+
+# Default rules
+%.o: %.c
+	${CC} ${CFLAGS} -c $&lt;
+%.o: %.f
+	${FC} ${FFLAGS} -c $&lt;
+%.o: %.F
+	${FC} ${FFLAGS} -c $&lt;
+%.o: %.f90
+	${FC} ${FFLAGS} -c $&lt;
+%.o: %.F90
+	${FC} ${FFLAGS} -c $&lt;
+
+all:    libm65.a m65.exe JT65code.exe
+
+OBJS1 = trimlist.o display.o getdphi.o pctile.o ccf65.o \
+	decode1a.o sort.o filbig.o fil6521.o afc65b.o \
+	twkfreq.o decode65b.o indexx.o ssort.o fchisq.o setup65.o \
+	extract.o deep65.o ccf2.o demod64a.o chkhist.o graycode.o \
+	interleave63.o unpackmsg.o encode65.o igray.o set.o unpackcall.o \
+	unpackgrid.o grid2k.o unpacktext.o getpfx2.o packmsg.o \
+	deg2grid.o packtext.o getpfx1.o packcall.o k2grid.o packgrid.o \
+	wrapkarn.o nchar.o init_rs.o encode_rs.o decode_rs.o \
+	four2a.o rfile3a.o grid2deg.o pfxdump.o dpol.o \
+	astro.o tm2.o sun.o moondop.o coord.o tmoonsub.o \
+	geocentric.o moon2.o toxyz.o dot.o dcoord.o f77_wisdom.o \
+	gen65.o chkmsg.o ptt.o astrosub.o astro0.o recvpkt.o symspec.o \
+	iqcal.o iqfix.o timf2.o
+
+libm65.a: $(OBJS1)
+	ar cr libm65.a $(OBJS1) 
+	ranlib libm65.a
+
+OBJS3 = m65.o m65a.o map65a.o symspec.o decode0.o ftninit.o ftnquit.o \
+	timer.o ipcomm.o sec_midn.o cutil.o 
+LIBS3    = -L'c:/QtSDK/Desktop/Qt/4.7.4/mingw/lib' -lQtCore4
+
+m65.exe: $(OBJS3) libm65.a
+	g++ -o m65.exe $(OBJS3) $(LIBS3) libm65.a ../libfftw3f_win.a \
+	c:/MinGW/lib/libf95.a
+	cp m65.exe ../../install
+
+OBJS2 = JT65code.o
+JT65code.exe: $(OBJS2) libm65.a
+	$(FC) -o JT65code.exe $(OBJS2) libm65.a
+
+INCPATH = -I'c:/QtSDK/Desktop/Qt/4.7.4/mingw/include/QtCore' \
+	 -I'c:/QtSDK/Desktop/Qt/4.7.4/mingw/include' \
+	 -I'c:/QtSDK/Desktop/Qt/4.7.4/mingw/include/ActiveQt' \
+	 -I'release' -I'.' -I'c:/QtSDK/Desktop/Qt/4.7.4/mingw/mkspecs/win32-g++'
+ipcomm.o: ipcomm.cpp
+	g++ -c $(INCPATH) ipcomm.cpp
+
+#m65a.o:	m65a.f90
+#	$(FC) -c -fno-second-underscore -cpp m65a.f90
+
+sec_midn.o: sec_midn.f90
+	$(FC) -c -fno-second-underscore sec_midn.f90
+
+#symspec.o: ../symspec.f90
+#	$(FC) -c $(FFLAGS) -o symspec.o ../symspec.f90
+
+OBJS4 = tastro.o astro0.o libm65.a
+tastro.exe: $(OBJS4)
+	$(FC) $(FFLAGS) -o tastro.exe $(OBJS4) libm65.a 
+
+OBJS5 = t1.o timer.o libm65.a
+t1.exe: $(OBJS5)
+	$(FC) $(FFLAGS) -o t1.exe $(OBJS5) libm65.a 
+
+#astro0.o: ../astro0.f90
+#	$(FC) -c $(FFLAGS) -o astro0.o ../astro0.f90
+
+init_rs.o: init_rs.c
+	$(CC) -c -DBIGSYM=1 -o init_rs.o init_rs.c
+
+encode_rs.o: encode_rs.c
+	$(CC) -c -DBIGSYM=1 -o encode_rs.o encode_rs.c
+
+decode_rs.o: decode_rs.c
+	$(CC) -c -DBIGSYM=1 -o decode_rs.o decode_rs.c
+
+.PHONY : clean
+
+clean:
+	rm -f *.o libm65.a m65.exe jt65code.exe

Added: branches/map65/libm65/Makefile.linux
===================================================================
--- branches/map65/libm65/Makefile.linux	                        (rev 0)
+++ branches/map65/libm65/Makefile.linux	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,96 @@
+CC = gcc
+FC = gfortran
+
+FFLAGS = -O2 -fbounds-check -Wall 
+# For ptt_unix:
+CFLAGS = -I. -fbounds-check -DHAVE_STDLIB_H=1 -DHAVE_STDIO_H=1 \
+	-DHAVE_FCNTL_H=1 -DHAVE_SYS_IOCTL_H=1
+
+# Default rules
+%.o: %.c
+	${CC} ${CFLAGS} -c $&lt;
+%.o: %.f
+	${FC} ${FFLAGS} -c $&lt;
+%.o: %.F
+	${FC} ${FFLAGS} -c $&lt;
+%.o: %.f90
+	${FC} ${FFLAGS} -c $&lt;
+%.o: %.F90
+	${FC} ${FFLAGS} -c $&lt;
+
+all:    libm65.a m65
+
+OBJS1 = trimlist.o display.o getdphi.o pctile.o ccf65.o \
+	decode1a.o sort.o filbig.o fil6521.o afc65b.o \
+	twkfreq.o decode65b.o indexx.o ssort.o fchisq.o setup65.o \
+	extract.o deep65.o ccf2.o demod64a.o chkhist.o graycode.o \
+	interleave63.o unpackmsg.o encode65.o igray.o set.o unpackcall.o \
+	unpackgrid.o grid2k.o unpacktext.o getpfx2.o packmsg.o \
+	deg2grid.o packtext.o getpfx1.o packcall.o k2grid.o packgrid.o \
+	wrapkarn.o nchar.o init_rs.o encode_rs.o decode_rs.o \
+	four2a.o rfile3a.o grid2deg.o pfxdump.o dpol.o \
+	astro.o tm2.o sun.o moondop.o coord.o tmoonsub.o \
+	geocentric.o moon2.o toxyz.o dot.o dcoord.o f77_wisdom.o \
+	gen65.o chkmsg.o ptt_unix.o astrosub.o astro0.o recvpkt.o \
+	symspec.o iqcal.o iqfix.o timf2.o s3avg.o
+
+libm65.a: $(OBJS1)
+	ar cr libm65.a $(OBJS1) 
+	ranlib libm65.a
+
+OBJS3 = m65.o m65a.o map65a.o symspec.o decode0.o ftninit.o ftnquit.o \
+	timer.o ipcomm.o sec_midn.o cutil.o 
+
+m65:	$(OBJS3) libm65.a
+	g++ -o m65 $(OBJS3) libm65.a -lfftw3f -lQtCore -lfftw3f -lgfortran
+
+OBJS2 = m65a.o ipcomm.o sec_midn.o cutil.o decode0.o map65a.o \
+	timer.o ftninit.o ftnquit.o
+LIBS2    = -lQtCore -lfftw3f -lgfortran
+
+m65a: 	 $(OBJS2) libm65.a
+	 g++ -o m65a $(OBJS2) libm65.a -lQtCore -lfftw3f -lgfortran
+
+OBJS6 = t3.o ipcomm.o 
+LIBS2    = -lQtCore -lgfortran
+
+t3: 	 $(OBJS6) 
+	 g++ -o t3 $(OBJS6) $(LIBS2)
+
+t3:	
+
+INCPATH = -I. -I'/usr/include/qt4' -I'/usr/include/qt4/QtCore'
+
+ipcomm.o: ipcomm.cpp
+	g++ -c $(INCPATH) ipcomm.cpp
+
+m65a.o:	m65a.F90
+	$(FC) -c -fno-second-underscore -DUNIX m65a.F90
+
+extract.o: extract.F
+	$(FC) -c -fno-second-underscore -DUNIX extract.F
+
+sec_midn.o: sec_midn.f90
+	$(FC) -c -fno-second-underscore sec_midn.f90
+
+OBJS4 = tastro.o astro0.o libm65.a
+tastro: $(OBJS4)
+	$(FC) $(FFLAGS) -o tastro $(OBJS4) libm65.a 
+
+OBJS5 = t1.o timer.o libm65.a
+t1: $(OBJS5)
+	$(FC) $(FFLAGS) -o t1 $(OBJS5) libm65.a 
+
+init_rs.o: init_rs.c
+	$(CC) -c -DBIGSYM=1 -o init_rs.o init_rs.c
+
+encode_rs.o: encode_rs.c
+	$(CC) -c -DBIGSYM=1 -o encode_rs.o encode_rs.c
+
+decode_rs.o: decode_rs.c
+	$(CC) -c -DBIGSYM=1 -o decode_rs.o decode_rs.c
+
+.PHONY : clean
+
+clean:
+	rm -f *.o libm65.a m65 m65a

Added: branches/map65/libm65/afc65b.f
===================================================================
--- branches/map65/libm65/afc65b.f	                        (rev 0)
+++ branches/map65/libm65/afc65b.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,68 @@
+      subroutine afc65b(cx,cy,npts,fsample,nflip,ipol,xpol,a,
+     +  ccfbest,dtbest)
+
+      logical xpol
+      complex cx(npts)
+      complex cy(npts)
+      real a(5),deltaa(5)
+
+      a(1)=0.
+      a(2)=0.
+      a(3)=0.
+      a(4)=45.0*(ipol-1.0)
+      deltaa(1)=2.0
+      deltaa(2)=2.0
+      deltaa(3)=2.0
+      deltaa(4)=22.5
+      deltaa(5)=0.05
+      nterms=3
+      if(xpol) nterms=4
+      chisqr=0.
+
+C  Start the iteration
+      chisqr0=1.e6
+      do iter=1,3                               !One iteration is enough?
+         do j=1,nterms
+            chisq1=fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
+            fn=0.
+            delta=deltaa(j)
+ 10         a(j)=a(j)+delta
+            chisq2=fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
+            if(chisq2.eq.chisq1) go to 10
+            if(chisq2.gt.chisq1) then
+               delta=-delta                      !Reverse direction
+               a(j)=a(j)+delta
+               tmp=chisq1
+               chisq1=chisq2
+               chisq2=tmp
+            endif
+ 20         fn=fn+1.0
+            a(j)=a(j)+delta
+            chisq3=fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
+            if(chisq3.lt.chisq2) then
+               chisq1=chisq2
+               chisq2=chisq3
+               go to 20
+            endif
+
+C  Find minimum of parabola defined by last three points
+            delta=delta*(1./(1.+(chisq1-chisq2)/(chisq3-chisq2))+0.5)
+            a(j)=a(j)-delta
+            deltaa(j)=deltaa(j)*fn/3.
+         enddo
+         chisqr=fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
+         if(chisqr/chisqr0.gt.0.9999) go to 30
+         chisqr0=chisqr
+      enddo
+
+ 30   ccfbest=ccfmax * (1378.125/fsample)**2
+      dtbest=dtmax
+
+      if(a(4).lt.0.0) a(4)=a(4)+180.0
+      if(a(4).ge.180.0) a(4)=a(4)-180.0
+      if(nint(a(4)).eq.180) a(4)=0.
+      ipol=nint(a(4)/45.0) + 1
+      if(ipol.gt.4) ipol=ipol-4
+
+      return
+      end

Added: branches/map65/libm65/astro.f
===================================================================
--- branches/map65/libm65/astro.f	                        (rev 0)
+++ branches/map65/libm65/astro.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,109 @@
+      subroutine astro(nyear,month,nday,uth,nfreq,Mygrid,
+     +     NStation,MoonDX,AzSun,ElSun,AzMoon0,ElMoon0,
+     +     ntsky,doppler00,doppler,dbMoon,RAMoon,DecMoon,HA,Dgrd,sd,
+     +     poloffset,xnr,day,lon,lat,LST)
+
+C  Computes astronomical quantities for display and tracking.
+C  NB: may want to smooth the Tsky map to 10 degrees or so.
+
+      character*6 MyGrid,HisGrid
+      real LST
+      real lat,lon
+      integer*2 nt144(180)
+
+!      common/echo/xdop(2),techo,AzMoon,ElMoon,mjd
+      real xdop(2)
+
+      data rad/57.2957795/
+      data nt144/
+     +  234, 246, 257, 267, 275, 280, 283, 286, 291, 298,
+     +  305, 313, 322, 331, 341, 351, 361, 369, 376, 381, 
+     +  383, 382, 379, 374, 370, 366, 363, 361, 363, 368, 
+     +  376, 388, 401, 415, 428, 440, 453, 467, 487, 512, 
+     +  544, 579, 607, 618, 609, 588, 563, 539, 512, 482, 
+     +  450, 422, 398, 379, 363, 349, 334, 319, 302, 282, 
+     +  262, 242, 226, 213, 205, 200, 198, 197, 196, 197, 
+     +  200, 202, 204, 205, 204, 203, 202, 201, 203, 206, 
+     +  212, 218, 223, 227, 231, 236, 240, 243, 247, 257, 
+     +  276, 301, 324, 339, 346, 344, 339, 331, 323, 316, 
+     +  312, 310, 312, 317, 327, 341, 358, 375, 392, 407, 
+     +  422, 437, 451, 466, 480, 494, 511, 530, 552, 579, 
+     +  612, 653, 702, 768, 863,1008,1232,1557,1966,2385, 
+     + 2719,2924,3018,3038,2986,2836,2570,2213,1823,1461, 
+     + 1163, 939, 783, 677, 602, 543, 494, 452, 419, 392, 
+     +  373, 360, 353, 350, 350, 350, 350, 350, 350, 348, 
+     +  344, 337, 329, 319, 307, 295, 284, 276, 272, 272, 
+     +  273, 274, 274, 271, 266, 260, 252, 245, 238, 231/
+      save
+
+      call grid2deg(MyGrid,elon,lat)
+      lon=-elon
+      call sun(nyear,month,nday,uth,lon,lat,RASun,DecSun,LST,
+     +    AzSun,ElSun,mjd,day)
+
+      freq=nfreq*1.e6
+      if(nfreq.eq.2) freq=1.8e6
+      if(nfreq.eq.4) freq=3.5e6
+
+      call MoonDop(nyear,month,nday,uth,lon,lat,RAMoon,DecMoon,
+     +  LST,HA,AzMoon,ElMoon,vr,dist)
+
+C  Compute spatial polarization offset
+      xx=sin(lat/rad)*cos(ElMoon/rad) - cos(lat/rad)*
+     +     cos(AzMoon/rad)*sin(ElMoon/rad)
+      yy=cos(lat/rad)*sin(AzMoon/rad)
+      if(NStation.eq.1) poloffset1=rad*atan2(yy,xx)
+      if(NStation.eq.2) poloffset2=rad*atan2(yy,xx)
+
+      techo=2.0 * dist/2.99792458e5                 !Echo delay time
+      doppler=-freq*vr/2.99792458e5                 !One-way Doppler
+
+      call coord(0.,0.,-1.570796,1.161639,RAMoon/rad,DecMoon/rad,el,eb)
+      longecl_half=nint(rad*el/2.0)
+      if(longecl_half.lt.1 .or. longecl_half.gt.180) longecl_half=180
+      t144=nt144(longecl_half)
+      tsky=(t144-2.7)*(144.0/nfreq)**2.6 + 2.7      !Tsky for obs freq
+
+      xdop(NStation)=doppler
+      if(NStation.eq.2) then
+         HisGrid=MyGrid
+         go to 900
+      endif
+
+      doppler00=2.0*xdop(1)
+      doppler=xdop(1)+xdop(2)
+!      if(mode.eq.3) doppler=2.0*xdop(1)
+      dBMoon=-40.0*log10(dist/356903.)
+      sd=16.23*370152.0/dist
+
+!      if(NStation.eq.1 .and. MoonDX.ne.0 .and. 
+!     +    (mode.eq.2 .or. mode.eq.5)) then
+      if(NStation.eq.1 .and. MoonDX.ne.0) then
+         poloffset=mod(poloffset2-poloffset1+720.0,180.0)
+         if(poloffset.gt.90.0) poloffset=poloffset-180.0
+         x1=abs(cos(2*poloffset/rad))
+         if(x1.lt.0.056234) x1=0.056234
+         xnr=-20.0*log10(x1)
+         if(HisGrid(1:1).lt.'A' .or. HisGrid(1:1).gt.'R') xnr=0
+      endif
+
+      tr=80.0                              !Good preamp
+      tskymin=13.0*(408.0/nfreq)**2.6      !Cold sky temperature
+      tsysmin=tskymin+tr
+      tsys=tsky+tr
+      dgrd=-10.0*log10(tsys/tsysmin) + dbMoon
+ 900  AzMoon0=Azmoon
+      ElMoon0=Elmoon
+      ntsky=nint(tsky)
+
+!      auxHA = 15.0*(LST-auxra)                       !HA in degrees
+!      pi=3.14159265
+!      pio2=0.5*pi
+!      call coord(pi,pio2-lat/rad,0.0,lat/rad,auxha*pi/180.0,
+!     +  auxdec/rad,azaux,elaux)
+!      AzAux=azaux*rad
+!      ElAux=ElAux*rad
+
+      return
+
+      end

Added: branches/map65/libm65/astro0.f90
===================================================================
--- branches/map65/libm65/astro0.f90	                        (rev 0)
+++ branches/map65/libm65/astro0.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,81 @@
+subroutine astro0(nyear,month,nday,uth8,nfreq,mygrid,hisgrid,              &amp;
+     AzSun8,ElSun8,AzMoon8,ElMoon8,AzMoonB8,ElMoonB8,ntsky,ndop,ndop00,    &amp;
+     dbMoon8,RAMoon8,DecMoon8,HA8,Dgrd8,sd8,poloffset8,xnr8,dfdt,dfdt0,    &amp;
+     width1,width2,w501,w502,xlst8)
+
+  parameter (DEGS=57.2957795130823d0)
+  character*6 mygrid,hisgrid
+  real*8 AzSun8,ElSun8,AzMoon8,ElMoon8,AzMoonB8,ElMoonB8
+  real*8 dbMoon8,RAMoon8,DecMoon8,HA8,Dgrd8,xnr8,dfdt,dfdt0,dt
+  real*8 sd8,poloffset8,day8,width1,width2,w501,w502,xlst8
+  real*8 uth8
+  data uth8z/0.d0/
+  save
+
+  uth=uth8
+  call astro(nyear,month,nday,uth,nfreq,hisgrid,2,1,                 &amp;
+       AzSun,ElSun,AzMoon,ElMoon,ntsky,doppler00,doppler,            &amp;
+       dbMoon,RAMoon,DecMoon,HA,Dgrd,sd,poloffset,xnr,               &amp;
+       day,xlon2,xlat2,xlst)
+  AzMoonB8=AzMoon
+  ElMoonB8=ElMoon
+  call astro(nyear,month,nday,uth,nfreq,mygrid,1,1,                  &amp;
+       AzSun,ElSun,AzMoon,ElMoon,ntsky,doppler00,doppler,            &amp;
+       dbMoon,RAMoon,DecMoon,HA,Dgrd,sd,poloffset,xnr,               &amp;
+       day,xlon1,xlat1,xlst)
+
+  day8=day
+  xlst8=xlst
+  call tm2(day8,xlat1,xlon1,xl1,b1)
+  call tm2(day8,xlat2,xlon2,xl2,b2)
+  call tm2(day8+1.d0/1440.0,xlat1,xlon1,xl1a,b1a)
+  call tm2(day8+1.d0/1440.0,xlat2,xlon2,xl2a,b2a)
+  fghz=0.001*nfreq
+  dldt1=DEGS*(xl1a-xl1)
+  dbdt1=DEGS*(b1a-b1)
+  dldt2=DEGS*(xl2a-xl2)
+  dbdt2=DEGS*(b2a-b2)
+  rate1=2.0*sqrt(dldt1**2 + dbdt1**2)
+  width1=0.5*6741*fghz*rate1
+  rate2=sqrt((dldt1+dldt2)**2 + (dbdt1+dbdt2)**2)
+  width2=0.5*6741*fghz*rate2
+
+  fbend=0.7
+  a2=0.0045*log(fghz/fbend)/log(1.05)
+  if(fghz.lt.fbend) a2=0.0
+  f50=0.19 * (fghz/fbend)**a2
+  if(f50.gt.1.0) f50=1.0
+  w501=f50*width1
+  w502=f50*width2
+
+  AzSun8=AzSun
+  ElSun8=ElSun
+  AzMoon8=AzMoon
+  ElMoon8=ElMoon
+  dbMoon8=dbMoon
+  RAMoon8=RAMoon/15.0
+  DecMoon8=DecMoon
+  HA8=HA
+  Dgrd8=Dgrd
+  sd8=sd
+  poloffset8=poloffset
+  xnr8=xnr
+  ndop=nint(doppler)
+  ndop00=nint(doppler00)
+
+  if(uth8z.eq.0.d0) then
+     uth8z=uth8-1.d0/3600.d0
+     dopplerz=doppler
+     doppler00z=doppler00
+  endif
+     
+  dt=60.0*(uth8-uth8z)
+  if(dt.le.0) dt=1.d0/60.d0
+  dfdt=(doppler-dopplerz)/dt
+  dfdt0=(doppler00-doppler00z)/dt
+  uth8z=uth8
+  dopplerz=doppler
+  doppler00z=doppler00
+
+  return
+end subroutine astro0

Added: branches/map65/libm65/astrosub.f90
===================================================================
--- branches/map65/libm65/astrosub.f90	                        (rev 0)
+++ branches/map65/libm65/astrosub.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,14 @@
+subroutine astrosub(nyear,month,nday,uth8,nfreq,mygrid,hisgrid,          &amp;
+     AzSun8,ElSun8,AzMoon8,ElMoon8,AzMoonB8,ElMoonB8,ntsky,ndop,ndop00,  &amp;
+     RAMoon8,DecMoon8,Dgrd8,poloffset8,xnr8)
+
+  implicit real*8 (a-h,o-z)
+  character*6 mygrid,hisgrid
+
+  call astro0(nyear,month,nday,uth8,nfreq,mygrid,hisgrid,                &amp;
+     AzSun8,ElSun8,AzMoon8,ElMoon8,AzMoonB8,ElMoonB8,ntsky,ndop,ndop00,  &amp;
+     dbMoon8,RAMoon8,DecMoon8,HA8,Dgrd8,sd8,poloffset8,xnr8,dfdt,dfdt0,  &amp;
+     width1,width2,w501,w502,xlst8)
+
+  return  
+end subroutine astrosub

Added: branches/map65/libm65/ccf2.f
===================================================================
--- branches/map65/libm65/ccf2.f	                        (rev 0)
+++ branches/map65/libm65/ccf2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,45 @@
+      subroutine ccf2(ss,nz,nflip,ccfbest,lagpk)
+
+      parameter (LAGMAX=60)
+!      parameter (LAGMAX=200)
+      real ss(nz)
+      real ccf(-LAGMAX:LAGMAX)
+      integer npr(126)
+
+C  The JT65 pseudo-random sync pattern:
+      data npr/
+     + 1,0,0,1,1,0,0,0,1,1,1,1,1,1,0,1,0,1,0,0,
+     + 0,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,1,1,1,1,
+     + 0,1,1,0,1,1,1,1,0,0,0,1,1,0,1,0,1,0,1,1,
+     + 0,0,1,1,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,
+     + 1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,0,1,
+     + 0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,
+     + 1,1,1,1,1,1/
+      save
+
+      ccfbest=0.
+      lag1=-LAGMAX
+      lag2=LAGMAX
+      do lag=lag1,lag2
+         s0=0.
+         s1=0.
+         do i=1,126
+            j=2*(8*i + 43) + lag
+            if(j.ge.1 .and. j.le.nz-8) then
+               x=ss(j)+ss(j+8)             !Add two half-symbol contributions
+               if(npr(i).eq.0) then
+                  s0=s0 + x
+               else
+                  s1=s1 + x
+               endif
+            endif
+         enddo
+         ccf(lag)=nflip*(s1-s0)
+         if(ccf(lag).gt.ccfbest) then
+            ccfbest=ccf(lag)
+            lagpk=lag
+         endif
+      enddo
+
+      return
+      end

Added: branches/map65/libm65/ccf65.f90
===================================================================
--- branches/map65/libm65/ccf65.f90	                        (rev 0)
+++ branches/map65/libm65/ccf65.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,118 @@
+subroutine ccf65(ss,nhsym,ssmax,sync1,ipol1,jpz,dt1,flipk,syncshort,      &amp;
+     snr2,ipol2,dt2)
+
+  parameter (NFFT=512,NH=NFFT/2)
+  real ss(4,322)                   !Input: half-symbol powers, 4 pol'ns
+  real s(NFFT)                     !CCF = ss*pr
+  complex cs(0:NH)                 !Complex FT of s
+  real s2(NFFT)                    !CCF = ss*pr2
+  complex cs2(0:NH)                !Complex FT of s2
+  real pr(NFFT)                    !JT65 pseudo-random sync pattern
+  complex cpr(0:NH)                !Complex FT of pr
+  real pr2(NFFT)                   !JT65 shorthand pattern
+  complex cpr2(0:NH)               !Complex FT of pr2
+  real tmp1(322)
+  real tmp2(322)
+  real ccf(-27:27,4)
+  logical first
+  integer npr(126)
+  data first/.true./
+  equivalence (s,cs),(pr,cpr),(s2,cs2),(pr2,cpr2)
+  save
+
+! The JT65 pseudo-random sync pattern:
+  data npr/                                        &amp;
+      1,0,0,1,1,0,0,0,1,1,1,1,1,1,0,1,0,1,0,0,     &amp;
+      0,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,1,1,1,1,     &amp;
+      0,1,1,0,1,1,1,1,0,0,0,1,1,0,1,0,1,0,1,1,     &amp;
+      0,0,1,1,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,     &amp;
+      1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,0,1,     &amp;
+      0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,     &amp;
+      1,1,1,1,1,1/
+
+  if(first) then
+! Initialize pr, pr2; compute cpr, cpr2.
+     fac=1.0/NFFT
+     do i=1,NFFT
+        pr(i)=0.
+        pr2(i)=0.
+        k=2*mod((i-1)/8,2)-1
+        if(i.le.NH) pr2(i)=fac*k
+     enddo
+     do i=1,126
+        j=2*i
+        pr(j)=fac*(2*npr(i)-1)
+! Not sure why, but it works significantly better without the following line:
+!        pr(j-1)=pr(j)
+     enddo
+     call four2a(pr,NFFT,1,-1,0)
+     call four2a(pr2,NFFT,1,-1,0)
+     first=.false.
+  endif
+
+! Look for JT65 sync pattern and shorthand square-wave pattern.
+  ccfbest=0.
+  ccfbest2=0.
+  ipol1=1
+  ipol2=1
+  do ip=1,jpz                                  !Do jpz polarizations
+     do i=1,nhsym-1
+!        s(i)=ss(ip,i)+ss(ip,i+1)
+        s(i)=min(ssmax,ss(ip,i)+ss(ip,i+1))
+     enddo
+     s(nhsym:NFFT)=0.
+     call four2a(s,NFFT,1,-1,0)                !Real-to-complex FFT
+     do i=0,NH
+        cs2(i)=cs(i)*conjg(cpr2(i))            !Mult by complex FFT of pr2
+        cs(i)=cs(i)*conjg(cpr(i))              !Mult by complex FFT of pr
+     enddo
+     call four2a(cs,NFFT,1,1,-1)               !Complex-to-real inv-FFT
+     call four2a(cs2,NFFT,1,1,-1)              !Complex-to-real inv-FFT
+     
+     do lag=-27,27                             !Check for best JT65 sync
+        ccf(lag,ip)=s(lag+28)                  
+        if(abs(ccf(lag,ip)).gt.ccfbest) then
+           ccfbest=abs(ccf(lag,ip))
+           lagpk=lag
+           ipol1=ip
+           flipk=1.0
+           if(ccf(lag,ip).lt.0.0) flipk=-1.0
+        endif
+     enddo
+
+     do lag=-8,7                               !Check for best shorthand
+        ccf2=s2(lag+28)
+        if(ccf2.gt.ccfbest2) then
+           ccfbest2=ccf2
+           lagpk2=lag
+           ipol2=ip
+        endif
+     enddo
+     
+  enddo
+
+! Find rms level on baseline of &quot;ccfblue&quot;, for normalization.
+  sum=0.
+  do lag=-26,26
+     if(abs(lag-lagpk).gt.1) sum=sum + ccf(lag,ipol1)
+  enddo
+  base=sum/50.0
+  sq=0.
+  do lag=-26,26
+     if(abs(lag-lagpk).gt.1) sq=sq + (ccf(lag,ipol1)-base)**2
+  enddo
+  rms=sqrt(sq/49.0)
+  sync1=ccfbest/rms - 4.0
+  dt1=2.5 + lagpk*(2048.0/11025.0)
+
+! Find base level for normalizing snr2.
+  do i=1,nhsym
+     tmp1(i)=ss(ipol2,i)
+  enddo
+  call pctile(tmp1,tmp2,nhsym,40,base)
+  snr2=0.398107*ccfbest2/base                !### empirical
+  syncshort=0.5*ccfbest2/rms - 4.0           !### better normalizer than rms?
+  dt2=2.5 + lagpk2*(2048.0/11025.0)
+
+  return
+end subroutine ccf65

Added: branches/map65/libm65/chkhist.f
===================================================================
--- branches/map65/libm65/chkhist.f	                        (rev 0)
+++ branches/map65/libm65/chkhist.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,23 @@
+      subroutine chkhist(mrsym,nmax,ipk)
+
+      integer mrsym(63)
+      integer hist(0:63)
+
+      do i=0,63
+         hist(i)=0
+      enddo
+      do j=1,63
+         i=mrsym(j)
+         hist(i)=hist(i)+1
+      enddo
+
+      nmax=0
+      do i=0,63
+         if(hist(i).gt.nmax) then
+            nmax=hist(i)
+            ipk=i+1
+         endif
+      enddo
+
+      return
+      end

Added: branches/map65/libm65/chkmsg.f
===================================================================
--- branches/map65/libm65/chkmsg.f	                        (rev 0)
+++ branches/map65/libm65/chkmsg.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,32 @@
+      subroutine chkmsg(message,cok,nspecial,flip)
+
+      character message*22,cok*3
+
+      nspecial=0
+      flip=1.0
+      cok=&quot;   &quot;
+
+      do i=22,1,-1
+         if(message(i:i).ne.' ') go to 10
+      enddo
+      i=22
+
+ 10   if(i.ge.11) then
+         if ((message(i-3:i).eq.' OOO') .or. 
+     +        (message(20:22).eq.' OO')) then
+            cok='OOO'
+            flip=-1.0
+            if(message(20:22).eq.' OO') then
+               message=message(1:19)
+            else
+               message=message(1:i-4)
+            endif
+         endif
+      endif
+
+      if(message(1:3).eq.'RO ')  nspecial=2
+      if(message(1:4).eq.'RRR ') nspecial=3
+      if(message(1:3).eq.'73 ')  nspecial=4
+
+      return
+      end

Added: branches/map65/libm65/coord.f
===================================================================
--- branches/map65/libm65/coord.f	                        (rev 0)
+++ branches/map65/libm65/coord.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,41 @@
+        SUBROUTINE COORD(A0,B0,AP,BP,A1,B1,A2,B2)
+
+C  Examples:
+C  1. From ha,dec to az,el:
+C       call coord(pi,pio2-lat,0.,lat,ha,dec,az,el)
+C  2. From az,el to ha,dec:
+C       call coord(pi,pio2-lat,0.,lat,az,el,ha,dec)
+C  3. From ra,dec to l,b
+C       call coord(4.635594495,-0.504691042,3.355395488,0.478220215,
+C         ra,dec,l,b)
+C  4. From l,b to ra,dec
+C       call coord(1.705981071d0,-1.050357016d0,2.146800277d0,
+C         0.478220215d0,l,b,ra,dec)
+C  5. From ra,dec to ecliptic latitude (eb) and longitude (el):
+C       call coord(0.d0,0.d0,-pio2,pio2-23.443*pi/180,ra,dec,el,eb)
+C  6. From ecliptic latitude (eb) and longitude (el) to ra,dec:
+C       call coord(0.d0,0.d0,-pio2,pio2-23.443*pi/180,el,eb,ra,dec)
+
+
+      SB0=sin(B0)
+      CB0=cos(B0)
+      SBP=sin(BP)
+      CBP=cos(BP)
+      SB1=sin(B1)
+      CB1=cos(B1)
+      SB2=SBP*SB1 + CBP*CB1*cos(AP-A1)
+      CB2=SQRT(1.e0-SB2**2)
+      B2=atan(SB2/CB2)
+      SAA=sin(AP-A1)*CB1/CB2
+      CAA=(SB1-SB2*SBP)/(CB2*CBP)
+      CBB=SB0/CBP
+      SBB=sin(AP-A0)*CB0
+      SA2=SAA*CBB-CAA*SBB
+      CA2=CAA*CBB+SAA*SBB
+      TA2O2=0.0 !Shut up compiler warnings. -db
+      IF(CA2.LE.0.e0) TA2O2=(1.e0-CA2)/SA2 
+      IF(CA2.GT.0.e0) TA2O2=SA2/(1.e0+CA2)
+      A2=2.e0*atan(TA2O2)
+      IF(A2.LT.0.e0) A2=A2+6.2831853
+      RETURN
+      END

Added: branches/map65/libm65/cutil.c
===================================================================
--- branches/map65/libm65/cutil.c	                        (rev 0)
+++ branches/map65/libm65/cutil.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,93 @@
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;unistd.h&gt;
+#include &lt;sys/types.h&gt;
+#include &lt;sys/stat.h&gt;
+#include &lt;fcntl.h&gt;
+// #include &lt;sys/times.h&gt;
+// #include &lt;time.h&gt;
+// #include &lt;sys/time.h&gt;
+#include &quot;sleep.h&quot;
+#include &quot;timeval.h&quot;
+
+/*  FORTRAN:  fd = close(filedes)      */
+int close_(int *filedes)
+{
+return(close(*filedes));
+}
+/*  FORTRAN:  fd = open(filnam,mode)  */
+int open_(char filnam[], int *mode)
+{
+  return(open(filnam,*mode));
+}
+/* FORTRAN:  fd = creat(filnam,mode) */
+int creat_(char filnam[],int *mode)
+{
+  return(creat(filnam,*mode));
+}
+/* FORTRAN:  nread = read(fd,buf,n) */
+int read_(int *fd, char buf[], int *n)
+{
+  return(read(*fd,buf,*n));
+}
+/* FORTRAN:  nwrt = write(fd,buf,n) */
+int write_(int *fd, char buf[], int *n)
+{
+  return(write(*fd,buf,*n));
+}
+/* FORTRAN: ns = lseek(fd,offset,origin) */
+int lseek_(int *fd,int *offset, int *origin)
+{
+  return(lseek(*fd,*offset,*origin));
+}
+/* times(2) */
+//int times_(struct tms *buf)
+//{
+//  return (times(buf));
+//}
+/* ioperm(2) */
+//ioperm_(from,num,turn_on)
+//unsigned long *from,*num,*turn_on;
+//{
+//  return (ioperm(*from,*num,*turn_on));
+//   return (i386_get_ioperm(*from,*num,*turn_on));
+//}
+
+/* usleep(3) */
+void usleep_(unsigned long *microsec)
+{
+  usleep(*microsec);
+}
+
+/* returns random numbers between 0 and 32767 to FORTRAN program */
+int iran_(int *arg)
+{
+  return (rand());
+}
+
+int exit_(int *n)
+{
+  printf(&quot;\n\n&quot;);
+  exit(*n);
+}
+
+/*
+struct tm *
+gmtime_r_(const time_t *clock, struct tm *result)
+{
+  gmtime_r(clock, result);
+}
+*/
+
+time_t time_(void)
+{
+     return time(0);
+}
+
+/* hrtime() */
+double hrtime_(void)
+{
+  struct timeval tv;
+  gettimeofday(&amp;tv,NULL);
+  return(tv.tv_sec+1.e-6*tv.tv_usec);
+}

Added: branches/map65/libm65/dcoord.f
===================================================================
--- branches/map65/libm65/dcoord.f	                        (rev 0)
+++ branches/map65/libm65/dcoord.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,40 @@
+        SUBROUTINE DCOORD(A0,B0,AP,BP,A1,B1,A2,B2)
+
+        implicit real*8 (a-h,o-z)
+C  Examples:
+C  1. From ha,dec to az,el:
+C       call coord(pi,pio2-lat,0.,lat,ha,dec,az,el)
+C  2. From az,el to ha,dec:
+C       call coord(pi,pio2-lat,0.,lat,az,el,ha,dec)
+C  3. From ra,dec to l,b
+C       call coord(4.635594495,-0.504691042,3.355395488,0.478220215,
+C         ra,dec,l,b)
+C  4. From l,b to ra,dec
+C       call coord(1.705981071d0,-1.050357016d0,2.146800277d0,
+C         0.478220215d0,l,b,ra,dec)
+C  5. From ecliptic latitude (eb) and longitude (el) to ra, dec:
+C       call coord(0.d0,0.d0,-pio2,pio2-23.443*pi/180,ra,dec,el,eb)
+
+      SB0=sin(B0)
+      CB0=cos(B0)
+      SBP=sin(BP)
+      CBP=cos(BP)
+      SB1=sin(B1)
+      CB1=cos(B1)
+      SB2=SBP*SB1 + CBP*CB1*cos(AP-A1)
+      CB2=SQRT(1.D0-SB2**2)
+      B2=atan(SB2/CB2)
+      SAA=sin(AP-A1)*CB1/CB2
+      CAA=(SB1-SB2*SBP)/(CB2*CBP)
+      CBB=SB0/CBP
+      SBB=sin(AP-A0)*CB0
+      SA2=SAA*CBB-CAA*SBB
+      CA2=CAA*CBB+SAA*SBB
+      TA2O2=0.0 !Shut up compiler warnings. -db
+      IF(CA2.LE.0.D0) TA2O2=(1.D0-CA2)/SA2 
+      IF(CA2.GT.0.D0) TA2O2=SA2/(1.D0+CA2)
+      A2=2.D0*atan(TA2O2)
+      IF(A2.LT.0.D0) A2=A2+6.2831853071795864D0
+
+      RETURN
+      END

Added: branches/map65/libm65/decode0.f90
===================================================================
--- branches/map65/libm65/decode0.f90	                        (rev 0)
+++ branches/map65/libm65/decode0.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,64 @@
+subroutine decode0(dd,ss,savg,nstandalone)
+
+  parameter (NSMAX=60*96000)
+  parameter (NFFT=32768)
+
+  real*4 dd(4,NSMAX),ss(4,322,NFFT),savg(4,NFFT)
+  real*8 fcenter
+  integer hist(0:32768)
+  character mycall*12,hiscall*12,mygrid*6,hisgrid*6,datetime*20
+  character mycall0*12,hiscall0*12,hisgrid0*6
+  common/npar/fcenter,nutc,idphi,mousedf,mousefqso,nagain,                &amp;
+       ndepth,ndiskdat,neme,newdat,nfa,nfb,nfcal,nfshift,                 &amp;
+       mcall3,nkeep,ntol,nxant,nrxlog,nfsample,nxpol,mode65,              &amp;
+       mycall,mygrid,hiscall,hisgrid,datetime
+  common/tracer/ limtrace,lu
+  data neme0/-99/,mcall3b/1/
+  save
+
+  call timer('decode0 ',0)
+
+  if(newdat.ne.0) then
+     nz=52*96000
+     hist=0
+     do i=1,nz
+        j1=min(abs(dd(1,i)),32768.0)
+        hist(j1)=hist(j1)+1
+        j2=min(abs(dd(2,i)),32768.0)
+        hist(j2)=hist(j2)+1
+        j3=min(abs(dd(3,i)),32768.0)
+        hist(j3)=hist(j3)+1
+        j4=min(abs(dd(4,i)),32768.0)
+        hist(j4)=hist(j4)+1
+     enddo
+     m=0
+     do i=0,32768
+        m=m+hist(i)
+        if(m.ge.2*nz) go to 10
+     enddo
+10   rmsdd=1.5*i
+  endif
+  nhsym=279
+  ndphi=0
+  if(iand(nrxlog,8).ne.0) ndphi=1
+
+  if(mycall.ne.mycall0 .or. hiscall.ne.hiscall0 .or.         &amp;
+       hisgrid.ne.hisgrid0 .or. mcall3.ne.0 .or. neme.ne.neme0) mcall3b=1
+      
+  mycall0=mycall
+  hiscall0=hiscall
+  hisgrid0=hisgrid
+  neme0=neme
+
+  call timer('map65a  ',0)
+  call map65a(dd,ss,savg,newdat,nutc,fcenter,ntol,idphi,nfa,nfb,           &amp;
+       mousedf,mousefqso,nagain,ndecdone,ndiskdat,nfshift,ndphi,           &amp;
+       nfcal,nkeep,mcall3b,nsave,nxant,rmsdd,mycall,mygrid,                &amp;
+       neme,ndepth,hiscall,hisgrid,nhsym,nfsample,nxpol,mode65)
+
+  call timer('map65a  ',1)
+  call timer('decode0 ',1)
+  if(nstandalone.eq.0) call timer('decode0 ',101)
+
+  return
+end subroutine decode0

Added: branches/map65/libm65/decode1a.f
===================================================================
--- branches/map65/libm65/decode1a.f	                        (rev 0)
+++ branches/map65/libm65/decode1a.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,149 @@
+      subroutine decode1a(dd,newdat,f0,nflip,mode65,nfsample,xpol,
+     +     mycall,hiscall,hisgrid,neme,ndepth,nqd,dphi,
+     +     nutc,nkhz,ndf,ipol,sync2,a,dt,pol,nkv,nhist,qual,decoded)
+
+!  Apply AFC corrections to a candidate JT65 signal, then decode it.
+
+      parameter (NMAX=60*96000)          !Samples per 60 s
+      real*4  dd(4,NMAX)                 !92 MB: raw data from Linrad timf2
+      complex cx(NMAX/64), cy(NMAX/64)   !Data at 1378.125 samples/s
+      complex c5x(NMAX/256),c5y(NMAX/256),c5tmp(NMAX/256)  !Data at 344.53125 Hz
+      complex c5a(512)
+      complex z
+      real s2(66,126)
+      real s3(64,63),sy(63)
+      real a(5)
+      logical first,xpol
+      character decoded*22
+      character mycall*12,hiscall*12,hisgrid*6
+      data first/.true./,jjjmin/1000/,jjjmax/-1000/
+      data nutc0/-999/,nkhz0/-999/
+      save
+
+!  Mix sync tone to baseband, low-pass filter, downsample to 1378.125 Hz
+      dt00=dt
+      call timer('filbig  ',0)
+      call filbig(dd,NMAX,f0,newdat,nfsample,xpol,cx,cy,n5)
+!  NB: cx, cy have sample rate 96000*77125/5376000 = 1378.125 Hz
+      call timer('filbig  ',1)
+      joff=0
+      sqa=0.
+      sqb=0.
+      do i=1,n5
+         sqa=sqa + real(cx(i))**2 + aimag(cx(i))**2
+         sqb=sqb + real(cy(i))**2 + aimag(cy(i))**2
+      enddo
+      sqa=sqa/n5
+      sqb=sqb/n5
+
+!  Find best DF, f1, f2, DT, and pol.  Start by downsampling to 344.53125 Hz
+      z=cmplx(cos(dphi),sin(dphi))
+      cy(:n5)=z*cy(:n5)                   !Adjust for cable length difference
+      call timer('fil6521 ',0)
+      call fil6521(cx,n5,c5x,n6)
+      call fil6521(cy,n5,c5y,n6)
+      call timer('fil6521 ',1)
+
+! Add some zeros at start of c5 arrays -- empirical fix for negative DT's
+! NB: might be better to add zeros to cx and cy, rather than here.
+! Q: is the DT search range big enough?
+
+      nadd=200
+      c5tmp(1:nadd)=0.
+      c5tmp(1+nadd:n6+nadd)=c5x(1:n6)
+      c5x(1:n6+nadd)=c5tmp(1:n6+nadd)
+      c5tmp(1+nadd:n6+nadd)=c5y(1:n6)
+      c5y(1:n6+nadd)=c5tmp(1:n6+nadd)
+      n6=n6+nadd
+
+      fsample=1378.125/4.
+      a(5)=dt00
+      i0=nint((a(5)+0.5)*fsample) - 2 + 200
+      if(i0.lt.1) then
+         write(13,*) 'i0 too small in decode1a:',i0,f0
+         flush(13)
+         i0=1
+      endif
+      nz=n6+1-i0
+
+! We're looking only at sync tone here... so why not downsample by another
+! factor of 1/8, say?  Should be a significant execution speed-up.
+      call timer('afc65b  ',0)
+! Best fit for DF, f1, f2, pol
+      call afc65b(c5x(i0),c5y(i0),nz,fsample,nflip,ipol,xpol,a,
+     +     ccfbest,dtbest)
+      call timer('afc65b  ',1)
+
+      pol=a(4)/57.2957795
+      aa=cos(pol)
+      bb=sin(pol)
+      sq0=aa*aa*sqa + bb*bb*sqb
+      sync2=3.7*ccfbest/sq0
+
+!  Apply AFC corrections to the time-domain signal
+!  Now we are back to using the 1378.125 Hz sample rate, enough to 
+!  accommodate the full JT65C bandwidth.
+
+      call timer('twkfreq ',0)
+      call twkfreq(cx,cy,n5,a)
+      call timer('twkfreq ',1)
+
+!  Compute spectrum at best polarization for each half symbol.
+!  Adding or subtracting a small number (e.g., 5) to j may make it decode.\
+!  NB: might want to try computing full-symbol spectra (nfft=512, even for
+!  submodes B and C).
+
+      nsym=126
+      nfft=512/mode65
+      j=(dt00+dtbest+2.685)*1378.125 + joff
+      if(j.lt.0) j=0
+
+      call timer('sh_ffts ',0)
+
+! Perhaps should try full-symbol-length FFTs even in B, C sub-modes?
+! (Tried this, found no significant difference in decodes.)
+
+      do k=1,nsym
+         do n=1,mode65
+            do i=1,nfft
+               j=j+1
+               c5a(i)=aa*cx(j) + bb*cy(j)
+            enddo
+            call four2a(c5a,nfft,1,1,1)
+            if(n.eq.1) then
+               do i=1,66
+                  s2(i,k)=real(c5a(i))**2 + aimag(c5a(i))**2
+               enddo
+            else
+               do i=1,66
+                  s2(i,k)=s2(i,k) + real(c5a(i))**2 + aimag(c5a(i))**2
+               enddo
+            endif
+         enddo
+      enddo
+
+      call timer('sh_ffts ',1)
+
+      flip=nflip
+      call timer('dec65b  ',0)
+      call decode65b(s2,flip,mycall,hiscall,hisgrid,mode65,neme,ndepth,
+     +    nqd,nkv,nhist,qual,decoded,s3,sy)
+      dt=dt00 + dtbest
+      call timer('dec65b  ',1)
+
+      if(nqd.eq.1 .and. nkv.eq.0) then
+         if(nutc.ne.nutc0) syncbest=0.
+         if(sync2.gt.syncbest) then
+            if(nutc.eq.nutc0) nsave=nsave-1
+            if(nkhz.ne.nkhz0) nsave=0
+            nkhz0=nkhz
+            nsave=min(32,nsave+1)
+            npol=nint(57.296*pol)
+            call s3avg(nsave,mode65,nutc,ndf,dt+0.8,npol,s3,nkv,decoded)
+            syncbest=sync2
+         endif
+         nutc0=nutc
+      endif
+
+      return
+      end

Added: branches/map65/libm65/decode65b.f
===================================================================
--- branches/map65/libm65/decode65b.f	                        (rev 0)
+++ branches/map65/libm65/decode65b.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,49 @@
+      subroutine decode65b(s2,flip,mycall,hiscall,hisgrid,mode65,
+     +  neme,ndepth,nqd,nkv,nhist,qual,decoded,s3,sy)
+
+      real s2(66,126)
+      real s3(64,63),sy(63)
+      logical first,ltext
+      character decoded*22,deepmsg*22
+      character mycall*12,hiscall*12,hisgrid*6
+      common/prcom/pr(126),mdat(126),mref(126,2),mdat2(126),mref2(126,2)
+      data first/.true./
+      save
+
+      if(first) call setup65
+      first=.false.
+
+      do j=1,63
+         k=mdat(j)                       !Points to data symbol
+         if(flip.lt.0.0) k=mdat2(j)
+         do i=1,64
+            s3(i,j)=s2(i+2,k)
+         enddo
+         k=mdat2(j)                       !Points to data symbol
+         if(flip.lt.0.0) k=mdat(j)
+         sy(j)=s2(1,k)
+      enddo
+
+      nadd=mode65
+      call extract(s3,nadd,ncount,nhist,decoded,ltext)     !Extract the message
+C  Suppress &quot;birdie messages&quot; and other garbage decodes:
+      if(decoded(1:7).eq.'000AAA ') ncount=-1
+      if(decoded(1:7).eq.'0L6MWK ') ncount=-1
+      if(flip.lt.0.0 .and. ltext) ncount=-1
+      nkv=1
+      if(ncount.lt.0) then 
+         nkv=0
+         decoded='                      '
+      endif
+
+      qual=0.
+      if(ndepth.ge.1 .and. (nqd.eq.1 .or. flip.eq.1.0)) then
+         call deep65(s3,mode65,neme,flip,mycall,hiscall,
+     +       hisgrid,deepmsg,qual)
+         if(nqd.ne.1 .and. qual.lt.10.0) qual=0.0
+         if(ndepth.lt.2 .and. qual.lt.6.0) qual=0.0
+      endif
+      if(nkv.eq.0 .and. qual.ge.1.0) decoded=deepmsg
+
+      return
+      end

Added: branches/map65/libm65/decode_rs.c
===================================================================
--- branches/map65/libm65/decode_rs.c	                        (rev 0)
+++ branches/map65/libm65/decode_rs.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,263 @@
+/* Reed-Solomon decoder
+ * Copyright 2002 Phil Karn, KA9Q
+ * May be used under the terms of the GNU General Public License (GPL)
+ */
+
+#ifdef DEBUG
+#include &lt;stdio.h&gt;
+#endif
+
+#include &lt;string.h&gt;
+
+#define NULL ((void *)0)
+#define	min(a,b)	((a) &lt; (b) ? (a) : (b))
+
+#ifdef FIXED
+#include &quot;fixed.h&quot;
+#elif defined(BIGSYM)
+#include &quot;int.h&quot;
+#else
+#include &quot;char.h&quot;
+#endif
+
+int DECODE_RS(
+#ifdef FIXED
+DTYPE *data, int *eras_pos, int no_eras,int pad){
+#else
+void *p,DTYPE *data, int *eras_pos, int no_eras){
+  struct rs *rs = (struct rs *)p;
+#endif
+  int deg_lambda, el, deg_omega;
+  int i, j, r,k;
+  DTYPE u,q,tmp,num1,num2,den,discr_r;
+  DTYPE lambda[NROOTS+1], s[NROOTS];	/* Err+Eras Locator poly
+					 * and syndrome poly */
+  DTYPE b[NROOTS+1], t[NROOTS+1], omega[NROOTS+1];
+  DTYPE root[NROOTS], reg[NROOTS+1], loc[NROOTS];
+  int syn_error, count;
+
+#ifdef FIXED
+  /* Check pad parameter for validity */
+  if(pad &lt; 0 || pad &gt;= NN)
+    return -1;
+#endif
+
+  /* form the syndromes; i.e., evaluate data(x) at roots of g(x) */
+  for(i=0;i&lt;NROOTS;i++)
+    s[i] = data[0];
+
+  for(j=1;j&lt;NN-PAD;j++){
+    for(i=0;i&lt;NROOTS;i++){
+      if(s[i] == 0){
+	s[i] = data[j];
+      } else {
+	s[i] = data[j] ^ ALPHA_TO[MODNN(INDEX_OF[s[i]] + (FCR+i)*PRIM)];
+      }
+    }
+  }
+
+  /* Convert syndromes to index form, checking for nonzero condition */
+  syn_error = 0;
+  for(i=0;i&lt;NROOTS;i++){
+    syn_error |= s[i];
+    s[i] = INDEX_OF[s[i]];
+  }
+
+  if (!syn_error) {
+    /* if syndrome is zero, data[] is a codeword and there are no
+     * errors to correct. So return data[] unmodified
+     */
+    count = 0;
+    goto finish;
+  }
+  memset(&amp;lambda[1],0,NROOTS*sizeof(lambda[0]));
+  lambda[0] = 1;
+
+  if (no_eras &gt; 0) {
+    /* Init lambda to be the erasure locator polynomial */
+    lambda[1] = ALPHA_TO[MODNN(PRIM*(NN-1-eras_pos[0]))];
+    for (i = 1; i &lt; no_eras; i++) {
+      u = MODNN(PRIM*(NN-1-eras_pos[i]));
+      for (j = i+1; j &gt; 0; j--) {
+	tmp = INDEX_OF[lambda[j - 1]];
+	if(tmp != A0)
+	  lambda[j] ^= ALPHA_TO[MODNN(u + tmp)];
+      }
+    }
+
+#if DEBUG &gt;= 1
+    /* Test code that verifies the erasure locator polynomial just constructed
+       Needed only for decoder debugging. */
+    
+    /* find roots of the erasure location polynomial */
+    for(i=1;i&lt;=no_eras;i++)
+      reg[i] = INDEX_OF[lambda[i]];
+
+    count = 0;
+    for (i = 1,k=IPRIM-1; i &lt;= NN; i++,k = MODNN(k+IPRIM)) {
+      q = 1;
+      for (j = 1; j &lt;= no_eras; j++)
+	if (reg[j] != A0) {
+	  reg[j] = MODNN(reg[j] + j);
+	  q ^= ALPHA_TO[reg[j]];
+	}
+      if (q != 0)
+	continue;
+      /* store root and error location number indices */
+      root[count] = i;
+      loc[count] = k;
+      count++;
+    }
+    if (count != no_eras) {
+      printf(&quot;count = %d no_eras = %d\n lambda(x) is WRONG\n&quot;,count,no_eras);
+      count = -1;
+      goto finish;
+    }
+#if DEBUG &gt;= 2
+    printf(&quot;\n Erasure positions as determined by roots of Eras Loc Poly:\n&quot;);
+    for (i = 0; i &lt; count; i++)
+      printf(&quot;%d &quot;, loc[i]);
+    printf(&quot;\n&quot;);
+#endif
+#endif
+  }
+  for(i=0;i&lt;NROOTS+1;i++)
+    //    printf(&quot;%d  %d  %d\n&quot;,i,lambda[i],INDEX_OF[lambda[i]]);
+    b[i] = INDEX_OF[lambda[i]];
+  
+  /*
+   * Begin Berlekamp-Massey algorithm to determine error+erasure
+   * locator polynomial
+   */
+  r = no_eras;
+  el = no_eras;
+  while (++r &lt;= NROOTS) {	/* r is the step number */
+    /* Compute discrepancy at the r-th step in poly-form */
+    discr_r = 0;
+    for (i = 0; i &lt; r; i++){
+      if ((lambda[i] != 0) &amp;&amp; (s[r-i-1] != A0)) {
+	discr_r ^= ALPHA_TO[MODNN(INDEX_OF[lambda[i]] + s[r-i-1])];
+      }
+    }
+    discr_r = INDEX_OF[discr_r];	/* Index form */
+    if (discr_r == A0) {
+      /* 2 lines below: B(x) &lt;-- x*B(x) */
+      memmove(&amp;b[1],b,NROOTS*sizeof(b[0]));
+      b[0] = A0;
+    } else {
+      /* 7 lines below: T(x) &lt;-- lambda(x) - discr_r*x*b(x) */
+      t[0] = lambda[0];
+      for (i = 0 ; i &lt; NROOTS; i++) {
+	if(b[i] != A0)
+	  t[i+1] = lambda[i+1] ^ ALPHA_TO[MODNN(discr_r + b[i])];
+	else
+	  t[i+1] = lambda[i+1];
+      }
+      if (2 * el &lt;= r + no_eras - 1) {
+	el = r + no_eras - el;
+	/*
+	 * 2 lines below: B(x) &lt;-- inv(discr_r) *
+	 * lambda(x)
+	 */
+	for (i = 0; i &lt;= NROOTS; i++)
+	  b[i] = (lambda[i] == 0) ? A0 : MODNN(INDEX_OF[lambda[i]] - discr_r + NN);
+      } else {
+	/* 2 lines below: B(x) &lt;-- x*B(x) */
+	memmove(&amp;b[1],b,NROOTS*sizeof(b[0]));
+	b[0] = A0;
+      }
+      memcpy(lambda,t,(NROOTS+1)*sizeof(t[0]));
+    }
+  }
+
+  /* Convert lambda to index form and compute deg(lambda(x)) */
+  deg_lambda = 0;
+  for(i=0;i&lt;NROOTS+1;i++){
+    lambda[i] = INDEX_OF[lambda[i]];
+    if(lambda[i] != A0)
+      deg_lambda = i;
+  }
+  /* Find roots of the error+erasure locator polynomial by Chien search */
+  memcpy(&amp;reg[1],&amp;lambda[1],NROOTS*sizeof(reg[0]));
+  count = 0;		/* Number of roots of lambda(x) */
+  for (i = 1,k=IPRIM-1; i &lt;= NN; i++,k = MODNN(k+IPRIM)) {
+    q = 1; /* lambda[0] is always 0 */
+    for (j = deg_lambda; j &gt; 0; j--){
+      if (reg[j] != A0) {
+	reg[j] = MODNN(reg[j] + j);
+	q ^= ALPHA_TO[reg[j]];
+      }
+    }
+    if (q != 0)
+      continue; /* Not a root */
+    /* store root (index-form) and error location number */
+#if DEBUG&gt;=2
+    printf(&quot;count %d root %d loc %d\n&quot;,count,i,k);
+#endif
+    root[count] = i;
+    loc[count] = k;
+    /* If we've already found max possible roots,
+     * abort the search to save time
+     */
+    if(++count == deg_lambda)
+      break;
+  }
+  if (deg_lambda != count) {
+    /*
+     * deg(lambda) unequal to number of roots =&gt; uncorrectable
+     * error detected
+     */
+    count = -1;
+    goto finish;
+  }
+  /*
+   * Compute err+eras evaluator poly omega(x) = s(x)*lambda(x) (modulo
+   * x**NROOTS). in index form. Also find deg(omega).
+   */
+  deg_omega = deg_lambda-1;
+  for (i = 0; i &lt;= deg_omega;i++){
+    tmp = 0;
+    for(j=i;j &gt;= 0; j--){
+      if ((s[i - j] != A0) &amp;&amp; (lambda[j] != A0))
+	tmp ^= ALPHA_TO[MODNN(s[i - j] + lambda[j])];
+    }
+    omega[i] = INDEX_OF[tmp];
+  }
+
+  /*
+   * Compute error values in poly-form. num1 = omega(inv(X(l))), num2 =
+   * inv(X(l))**(FCR-1) and den = lambda_pr(inv(X(l))) all in poly-form
+   */
+  for (j = count-1; j &gt;=0; j--) {
+    num1 = 0;
+    for (i = deg_omega; i &gt;= 0; i--) {
+      if (omega[i] != A0)
+	num1  ^= ALPHA_TO[MODNN(omega[i] + i * root[j])];
+    }
+    num2 = ALPHA_TO[MODNN(root[j] * (FCR - 1) + NN)];
+    den = 0;
+    
+    /* lambda[i+1] for i even is the formal derivative lambda_pr of lambda[i] */
+    for (i = min(deg_lambda,NROOTS-1) &amp; ~1; i &gt;= 0; i -=2) {
+      if(lambda[i+1] != A0)
+	den ^= ALPHA_TO[MODNN(lambda[i+1] + i * root[j])];
+    }
+#if DEBUG &gt;= 1
+    if (den == 0) {
+      printf(&quot;\n ERROR: denominator = 0\n&quot;);
+      count = -1;
+      goto finish;
+    }
+#endif
+    /* Apply error to data */
+    if (num1 != 0 &amp;&amp; loc[j] &gt;= PAD) {
+      data[loc[j]-PAD] ^= ALPHA_TO[MODNN(INDEX_OF[num1] + INDEX_OF[num2] + NN - INDEX_OF[den])];
+    }
+  }
+ finish:
+  if(eras_pos != NULL){
+    for(i=0;i&lt;count;i++)
+      eras_pos[i] = loc[i];
+  }
+  return count;
+}

Added: branches/map65/libm65/deep65.f90
===================================================================
--- branches/map65/libm65/deep65.f90	                        (rev 0)
+++ branches/map65/libm65/deep65.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,169 @@
+subroutine deep65(s3,mode65,neme,flip,mycall,hiscall,hisgrid,decoded,qual)
+
+  parameter (MAXCALLS=7000,MAXRPT=63)
+  real s3(64,63)
+  character callsign*12,grid*4,message*22,hisgrid*6,c*1,ceme*3
+  character*12 mycall,hiscall
+  character*22 decoded
+  character*22 testmsg(2*MAXCALLS + 2 + MAXRPT)
+  character*15 callgrid(MAXCALLS)
+  character*180 line
+  character*4 rpt(MAXRPT)
+  integer ncode(63,2*MAXCALLS + 2 + MAXRPT)
+  real pp(2*MAXCALLS + 2 + MAXRPT)
+  common/mrscom/ mrs(63),mrs2(63)
+  common/c3com/ mcall3a
+  data rpt/'-01','-02','-03','-04','-05',          &amp;
+           '-06','-07','-08','-09','-10',          &amp;
+           '-11','-12','-13','-14','-15',          &amp;
+           '-16','-17','-18','-19','-20',          &amp;
+           '-21','-22','-23','-24','-25',          &amp;
+           '-26','-27','-28','-29','-30',          &amp;
+           'R-01','R-02','R-03','R-04','R-05',     &amp;
+           'R-06','R-07','R-08','R-09','R-10',     &amp;
+           'R-11','R-12','R-13','R-14','R-15',     &amp;
+           'R-16','R-17','R-18','R-19','R-20',     &amp;
+           'R-21','R-22','R-23','R-24','R-25',     &amp;
+           'R-26','R-27','R-28','R-29','R-30',     &amp;
+           'RO','RRR','73'/
+  save
+
+  if(mcall3a.eq.0) go to 30
+
+  call timer('deep65a ',0)
+  mcall3a=0
+  rewind 23
+  k=0
+  icall=0
+  do n=1,MAXCALLS
+     if(n.eq.1) then
+        callsign=hiscall
+        do i=4,12
+           if(ichar(callsign(i:i)).eq.0) callsign(i:i)=' '
+        enddo
+        grid=hisgrid(1:4)
+        if(ichar(grid(3:3)).eq.0) grid(3:3)=' '
+        if(ichar(grid(4:4)).eq.0) grid(4:4)=' '
+     else
+        read(23,1002,end=20) line
+1002    format (A80)
+        if(line(1:4).eq.'ZZZZ') go to 20
+        if(line(1:2).eq.'//') go to 10
+        i1=index(line,',')
+        if(i1.lt.4) go to 10
+        i2=index(line(i1+1:),',')
+        if(i2.lt.5) go to 10
+        i2=i2+i1
+        i3=index(line(i2+1:),',')
+        if(i3.lt.1) i3=index(line(i2+1:),' ')
+        i3=i2+i3
+        callsign=line(1:i1-1)
+        grid=line(i1+1:i2-1)
+        ceme=line(i2+1:i3-1)
+        if(neme.eq.1 .and. ceme.ne.'EME') go to 10
+     endif
+
+     icall=icall+1
+     j1=index(mycall,' ') - 1
+     if(j1.le.-1) j1=12
+     if(j1.lt.3) j1=6
+     j2=index(callsign,' ') - 1
+     if(j2.le.-1) j2=12
+     if(j2.lt.3) j2=6
+     j3=index(mycall,'/')                 ! j3&gt;0 means compound mycall
+     j4=index(callsign,'/')               ! j4&gt;0 means compound hiscall
+     callgrid(icall)=callsign(1:j2)
+
+     mz=1
+! Allow MyCall + HisCall + rpt (?)
+     if(n.eq.1 .and. j3.lt.1 .and. j4.lt.1 .and.                       &amp;
+          flip.gt.0.0 .and. callsign(1:6).ne.'      ') mz=MAXRPT+1
+     do m=1,mz
+        if(m.gt.1) grid=rpt(m-1)
+        if(j3.lt.1 .and.j4.lt.1) callgrid(icall)=callsign(1:j2)//' '//grid
+        message=mycall(1:j1)//' '//callgrid(icall)
+        k=k+1
+        testmsg(k)=message
+        call encode65(message,ncode(1,k))
+        
+! Insert CQ message
+        if(j4.lt.1) callgrid(icall)=callsign(1:j2)//' '//grid
+        message='CQ '//callgrid(icall)
+        k=k+1
+        testmsg(k)=message
+        call encode65(message,ncode(1,k))
+     enddo
+10   continue
+  enddo
+
+20 continue
+  ntot=k
+  call timer('deep65a ',1)
+
+30 continue
+  call timer('deep65b ',0)
+  ref0=0.
+  do j=1,63
+     ref0=ref0 + s3(mrs(j),j)
+  enddo
+
+  p1=-1.e30
+  p2=-1.e30
+  do k=1,ntot
+     pp(k)=0.
+! Test all messages if flip=+1; skip the CQ messages if flip=-1.
+     if(flip.gt.0.0 .or. testmsg(k)(1:3).ne.'CQ ') then
+        sum=0.
+        ref=ref0
+        do j=1,63
+           i=ncode(j,k)+1
+           sum=sum + s3(i,j)
+           if(i.eq.mrs(j)) ref=ref - s3(i,j) + s3(mrs2(j),j)
+        enddo
+        p=sum/ref
+        pp(k)=p
+        if(p.gt.p1) then
+           p1=p
+           ip1=k
+        endif
+     endif
+  enddo
+
+  do i=1,ntot
+     if(pp(i).gt.p2 .and. pp(i).ne.p1) p2=pp(i)
+  enddo
+
+! ### DO NOT REMOVE ### 
+  rewind 77
+  write(77,*) p1,p2
+! ### Works OK without it (in both Windows and Linux) if compiled 
+! ### without optimization.  However, in Windows this is a colossal 
+! ### pain because of the way F2PY wants to run the compile step.
+
+  if(mode65.eq.1) bias=max(1.12*p2,0.335)
+  if(mode65.eq.2) bias=max(1.08*p2,0.405)
+  if(mode65.ge.4) bias=max(1.04*p2,0.505)
+
+  if(p2.eq.p1 .and. p1.ne.-1.e30) stop 'Error in deep65'
+  qual=100.0*(p1-bias)
+
+  decoded='                      '
+  c=' '
+
+  if(qual.gt.1.0) then
+     if(qual.lt.6.0) c='?'
+     decoded=testmsg(ip1)
+  else
+     qual=0.
+  endif
+  decoded(22:22)=c
+
+! Make sure everything is upper case.
+  do i=1,22
+     if(decoded(i:i).ge.'a' .and. decoded(i:i).le.'z')                &amp;
+          decoded(i:i)=char(ichar(decoded(i:i))-32)
+  enddo
+  call timer('deep65b ',1)
+
+  return
+end subroutine deep65

Added: branches/map65/libm65/deg2grid.f
===================================================================
--- branches/map65/libm65/deg2grid.f	                        (rev 0)
+++ branches/map65/libm65/deg2grid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,30 @@
+      subroutine deg2grid(dlong0,dlat,grid)
+
+      real dlong                        !West longitude (deg)
+      real dlat                         !Latitude (deg)
+      character grid*6
+
+      dlong=dlong0
+      if(dlong.lt.-180.0) dlong=dlong+360.0
+      if(dlong.gt.180.0) dlong=dlong-360.0
+
+C  Convert to units of 5 min of longitude, working east from 180 deg.
+      nlong=60.0*(180.0-dlong)/5.0
+      n1=nlong/240                      !20-degree field
+      n2=(nlong-240*n1)/24              !2 degree square
+      n3=nlong-240*n1-24*n2             !5 minute subsquare
+      grid(1:1)=char(ichar('A')+n1)
+      grid(3:3)=char(ichar('0')+n2)
+      grid(5:5)=char(ichar('a')+n3)
+
+C  Convert to units of 2.5 min of latitude, working north from -90 deg.
+      nlat=60.0*(dlat+90)/2.5
+      n1=nlat/240                       !10-degree field
+      n2=(nlat-240*n1)/24               !1 degree square
+      n3=nlat-240*n1-24*n2              !2.5 minuts subsquare
+      grid(2:2)=char(ichar('A')+n1)
+      grid(4:4)=char(ichar('0')+n2)
+      grid(6:6)=char(ichar('a')+n3)
+
+      return
+      end

Added: branches/map65/libm65/demod64a.f
===================================================================
--- branches/map65/libm65/demod64a.f	                        (rev 0)
+++ branches/map65/libm65/demod64a.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,73 @@
+      subroutine demod64a(s3,nadd,mrsym,mrprob,
+     +  mr2sym,mr2prob,ntest,nlow)
+
+C  Demodulate the 64-bin spectra for each of 63 symbols in a frame.
+
+C  Parameters
+C     nadd     number of spectra already summed
+C     mrsym    most reliable symbol value
+C     mr2sym   second most likely symbol value
+C     mrprob   probability that mrsym was the transmitted value
+C     mr2prob  probability that mr2sym was the transmitted value
+
+      implicit real*8 (a-h,o-z)
+      real*4 s3(64,63)
+      real*8 fs(64)
+      integer mrsym(63),mrprob(63),mr2sym(63),mr2prob(63)
+      common/mrscom/ mrs(63),mrs2(63)
+
+      afac=1.1 * float(nadd)**0.64
+      scale=255.999
+
+C  Compute average spectral value
+      sum=0.
+      do j=1,63
+         do i=1,64
+            sum=sum+s3(i,j)
+         enddo
+      enddo
+      ave=sum/(64.*63.)
+      i1=1                                      !Silence warning
+      i2=1
+
+C  Compute probabilities for most reliable symbol values
+      do j=1,63
+         s1=-1.e30
+         fsum=0.
+         do i=1,64
+            x=min(afac*s3(i,j)/ave,50.d0)
+            fs(i)=exp(x)
+            fsum=fsum+fs(i)
+            if(s3(i,j).gt.s1) then
+               s1=s3(i,j)
+               i1=i                              !Most reliable
+            endif
+         enddo
+
+         s2=-1.e30
+         do i=1,64
+            if(i.ne.i1 .and. s3(i,j).gt.s2) then
+               s2=s3(i,j)
+               i2=i                              !Second most reliable
+            endif
+         enddo
+         p1=fs(i1)/fsum                          !Normalized probabilities
+         p2=fs(i2)/fsum
+         mrsym(j)=i1-1
+         mr2sym(j)=i2-1
+         mrprob(j)=scale*p1
+         mr2prob(j)=scale*p2
+         mrs(j)=i1
+         mrs2(j)=i2
+      enddo
+
+      sum=0.
+      nlow=0
+      do j=1,63
+         sum=sum+mrprob(j)
+         if(mrprob(j).le.5) nlow=nlow+1
+      enddo
+      ntest=sum/63
+
+      return
+      end

Added: branches/map65/libm65/display.f90
===================================================================
--- branches/map65/libm65/display.f90	                        (rev 0)
+++ branches/map65/libm65/display.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,169 @@
+subroutine display(nkeep,ftol)
+
+  parameter (MAXLINES=400,MX=400)
+  integer indx(MAXLINES),indx2(MX)
+  character*81 line(MAXLINES),line2(MX),line3(MAXLINES)
+  character out*50,cfreq0*3,cqlive*52
+  character*6 callsign,callsign0
+  character*12 freqcall(100)
+  real freqkHz(MAXLINES)
+  integer utc(MAXLINES),utc2(MX),utcz
+  real*8 f0
+
+  rewind 26
+
+  do i=1,MAXLINES
+     read(26,1010,end=10) line(i)
+1010 format(a80)
+     read(line(i),1020) f0,ndf,nh,nm
+1020 format(f8.3,i5,25x,i3,i2)
+     utc(i)=60*nh + nm
+     freqkHz(i)=1000.d0*(f0-144.d0) + 0.001d0*ndf
+  enddo
+
+10 nz=i-1
+  utcz=utc(nz)
+  nz=nz-1
+  if(nz.lt.1) go to 999
+  nquad=max(nkeep/4,3)
+  do i=1,nz
+     nage=utcz-utc(i)
+     if(nage.lt.0) nage=nage+1440
+     iage=nage/nquad
+     write(line(i)(80:81),1021) iage
+1021 format(i2)
+  enddo
+
+  nage=utcz-utc(1)
+  if(nage.lt.0) nage=nage+1440
+  if(nage.gt.nkeep) then
+     do i=1,nz
+        nage=utcz-utc(i)
+        if(nage.lt.0) nage=nage+1440
+        if(nage.le.nkeep) go to 20
+     enddo
+20   i0=i
+     nz=nz-i0+1
+     rewind 26
+     if(nz.lt.1) go to 999
+     do i=1,nz
+        j=i+i0-1
+        line(i)=line(j)
+        utc(i)=utc(j)
+        freqkHz(i)=freqkHz(j)
+        write(26,1010) line(i)
+     enddo
+  endif
+
+  call flush(26)
+  call indexx(nz,freqkHz,indx)
+
+  nstart=1
+  k3=0
+  k=1
+  m=indx(1)
+  if(m.lt.1 .or. m.gt.MAXLINES) then
+     print*,'Error in display.f90: ',nz,m
+     m=1
+  endif
+  line2(1)=line(m)
+  utc2(1)=utc(m)
+  do i=2,nz
+     j0=indx(i-1)
+     j=indx(i)
+     if(freqkHz(j)-freqkHz(j0).gt.2.0*ftol) then
+        if(nstart.eq.0) then
+           k=k+1
+           line2(k)=&quot;&quot;
+           utc2(k)=-1
+        endif
+        kz=k
+        if(nstart.eq.1) then
+           call indexx(kz,utc2,indx2)
+           k3=0
+           do k=1,kz
+              k3=min(k3+1,400)
+              line3(k3)=line2(indx2(k))
+           enddo
+           nstart=0
+        else
+           call indexx(kz,utc2,indx2)
+           do k=1,kz
+              k3=min(k3+1,400)
+              line3(k3)=line2(indx2(k))
+           enddo
+        endif
+        k=0
+     endif
+     if(i.eq.nz) then
+        k=k+1
+        line2(k)=&quot;&quot;
+        utc2(k)=-1
+     endif
+     k=k+1
+     line2(k)=line(j)
+     utc2(k)=utc(j)
+     j0=j
+  enddo
+  kz=k
+  call indexx(kz,utc2,indx2)
+  do k=1,kz
+     k3=min(k3+1,400)
+     line3(k3)=line2(indx2(k))
+  enddo
+
+  rewind 19
+  rewind 20
+  cfreq0='   '
+  nc=0
+  callsign0='      '
+  do k=1,k3
+     out=line3(k)(6:13)//line3(k)(28:31)//line3(k)(39:43)//       &amp;
+          line3(k)(35:38)//line3(k)(44:67)//line3(k)(77:81)
+     if(out(1:3).ne.'   ') then
+        cfreq0=out(1:3)
+        if(iw.lt.MAXLINES-1) iw=iw+1
+        cqlive=line3(k)(6:13)//line3(k)(28:31)//line3(k)(39:43)//       &amp;
+             line3(k)(23:27)//line3(k)(35:38)//line3(k)(44:67)//        &amp;
+             line3(k)(80:81)
+        if(index(cqlive,' CQ ').gt.0 .or. index(cqlive,' QRZ ').gt.0 .or.   &amp;
+           index(cqlive,' QRT ').gt.0 .or. index(cqlive,' CQV ').gt.0 .or.  &amp;
+           index(cqlive,' CQH ').gt.0) write(19,1029) cqlive
+1029    format(a52)
+        write(*,1030) out
+1030    format('@',a50)
+        i1=index(out(24:),' ')
+        callsign=out(i1+24:)
+        i2=index(callsign,' ')
+        if(i2.gt.1) callsign(i2:)='      '
+        if(callsign.ne.'      ' .and. callsign.ne.callsign0) then
+           len=i2-1
+           if(len.lt.0) len=6
+           if(len.ge.4) then                        !Omit short &quot;callsigns&quot;
+              nc=nc+1
+              freqcall(nc)=cfreq0//' '//callsign//line3(k)(80:81)
+              callsign0=callsign
+           endif
+        endif
+        if(callsign.ne.'      ' .and. callsign.eq.callsign0) then
+           freqcall(nc)=cfreq0//' '//callsign//line3(k)(80:81)
+        endif
+     endif
+  enddo
+  flush(19)
+  nc=nc+1
+  freqcall(nc)='            '
+  nc=nc+1
+  freqcall(nc)='            '
+  freqcall(nc+1)='            '
+  freqcall(nc+2)='            '
+  iz=(nc+2)/3
+
+  do i=1,nc
+  write(*,1042) freqcall(i)
+1042 format('&amp;',a12)
+  enddo
+
+999  continue
+  return
+end subroutine display

Added: branches/map65/libm65/dot.f
===================================================================
--- branches/map65/libm65/dot.f	                        (rev 0)
+++ branches/map65/libm65/dot.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,11 @@
+      real*8 function dot(x,y)
+
+      real*8 x(3),y(3)
+
+      dot=0.d0
+      do i=1,3
+         dot=dot+x(i)*y(i)
+      enddo
+
+      return
+      end

Added: branches/map65/libm65/dpol.f90
===================================================================
--- branches/map65/libm65/dpol.f90	                        (rev 0)
+++ branches/map65/libm65/dpol.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,41 @@
+real function dpol(mygrid,hisgrid)
+
+! Compute spatial polartzation offset in degrees for the present 
+! time, between two specified grid locators.
+
+  character*6 MyGrid,HisGrid
+  real lat,lon,LST
+  character cdate*8,ctime2*10,czone*5,fnamedate*6
+  integer  it(8)
+  data rad/57.2957795/
+
+  call date_and_time(cdate,ctime2,czone,it)
+  nyear=it(1)
+  month=it(2)
+  nday=it(3)
+  nh=it(5)-it(4)/60
+  nm=it(6)
+  ns=it(7)
+  uth=nh + nm/60.0 + ns/3600.0
+
+  call grid2deg(MyGrid,lon,lat)
+  call MoonDop(nyear,month,nday,uth,-lon,lat,RAMoon,DecMoon,         &amp;
+       LST,HA,AzMoon,ElMoon,vr,dist)
+  xx=sin(lat/rad)*cos(ElMoon/rad) - cos(lat/rad)*                    &amp;
+       cos(AzMoon/rad)*sin(ElMoon/rad)
+  yy=cos(lat/rad)*sin(AzMoon/rad)
+  poloffset1=rad*atan2(yy,xx)
+
+  call grid2deg(hisGrid,lon,lat)
+  call MoonDop(nyear,month,nday,uth,-lon,lat,RAMoon,DecMoon,         &amp;
+       LST,HA,AzMoon,ElMoon,vr,dist)
+  xx=sin(lat/rad)*cos(ElMoon/rad) - cos(lat/rad)*                    &amp;
+       cos(AzMoon/rad)*sin(ElMoon/rad)
+  yy=cos(lat/rad)*sin(AzMoon/rad)
+  poloffset2=rad*atan2(yy,xx)
+
+  dpol=mod(poloffset2-poloffset1+720.0,180.0)
+  if(dpol.gt.90.0) dpol=dpol-180.0
+
+  return
+end function dpol

Added: branches/map65/libm65/encode65.f
===================================================================
--- branches/map65/libm65/encode65.f	                        (rev 0)
+++ branches/map65/libm65/encode65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,13 @@
+      subroutine encode65(message,sent)
+
+      character message*22
+      integer dgen(12)
+      integer sent(63)
+
+      call packmsg(message,dgen)
+      call rs_encode(dgen,sent)
+      call interleave63(sent,1)
+      call graycode(sent,63,1)
+
+      return
+      end

Added: branches/map65/libm65/encode_rs.c
===================================================================
--- branches/map65/libm65/encode_rs.c	                        (rev 0)
+++ branches/map65/libm65/encode_rs.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,52 @@
+/* Reed-Solomon encoder
+ * Copyright 2002, Phil Karn, KA9Q
+ * May be used under the terms of the GNU General Public License (GPL)
+ */
+#include &lt;string.h&gt;
+
+#ifdef FIXED
+#include &quot;fixed.h&quot;
+#elif defined(BIGSYM)
+#include &quot;int.h&quot;
+#else
+#include &quot;char.h&quot;
+#endif
+
+void ENCODE_RS(
+#ifdef FIXED
+DTYPE *data, DTYPE *bb,int pad){
+#else
+void *p,DTYPE *data, DTYPE *bb){
+  struct rs *rs = (struct rs *)p;
+#endif
+  int i, j;
+  DTYPE feedback;
+
+#ifdef FIXED
+  /* Check pad parameter for validity */
+  if(pad &lt; 0 || pad &gt;= NN)
+    return;
+#endif
+
+  memset(bb,0,NROOTS*sizeof(DTYPE));
+
+  for(i=0;i&lt;NN-NROOTS-PAD;i++){
+    feedback = INDEX_OF[data[i] ^ bb[0]];
+    if(feedback != A0){      /* feedback term is non-zero */
+#ifdef UNNORMALIZED
+      /* This line is unnecessary when GENPOLY[NROOTS] is unity, as it must
+       * always be for the polynomials constructed by init_rs()
+       */
+      feedback = MODNN(NN - GENPOLY[NROOTS] + feedback);
+#endif
+      for(j=1;j&lt;NROOTS;j++)
+	bb[j] ^= ALPHA_TO[MODNN(feedback + GENPOLY[NROOTS-j])];
+    }
+    /* Shift */
+    memmove(&amp;bb[0],&amp;bb[1],sizeof(DTYPE)*(NROOTS-1));
+    if(feedback != A0)
+      bb[NROOTS-1] = ALPHA_TO[MODNN(feedback + GENPOLY[0])];
+    else
+      bb[NROOTS-1] = 0;
+  }
+}

Added: branches/map65/libm65/extract.F
===================================================================
--- branches/map65/libm65/extract.F	                        (rev 0)
+++ branches/map65/libm65/extract.F	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,109 @@
+      subroutine extract(s3,nadd,ncount,nhist,decoded,ltext)
+
+      real s3(64,63)
+      real tmp(4032)
+      character decoded*22
+      integer era(51),dat4(12),indx(64)
+      integer mrsym(63),mr2sym(63),mrprob(63),mr2prob(63)
+      logical first,ltext
+      data first/.true./,nsec1/0/
+      save
+
+      nfail=0
+ 1    continue
+!      call timer('demod64a',0)
+      call demod64a(s3,nadd,mrsym,mrprob,mr2sym,mr2prob,ntest,nlow)
+!      call timer('demod64a',1)
+      if(ntest.lt.50 .or. nlow.gt.20) then
+         ncount=-999                         !Flag bad data
+         go to 900
+      endif
+      call chkhist(mrsym,nhist,ipk)
+
+      if(nhist.ge.20) then
+         nfail=nfail+1
+         call pctile(s3,tmp,4032,50,base)     ! ### or, use ave from demod64a
+         do j=1,63
+            s3(ipk,j)=base
+         enddo
+         if(nfail.gt.30) then
+            decoded='                      '
+            ncount=-1
+            go to 900
+         endif
+         go to 1
+      endif
+
+      call graycode(mrsym,63,-1)
+      call interleave63(mrsym,-1)
+      call interleave63(mrprob,-1)
+
+      ndec=1
+      nemax=30                              !Was 200 (30)
+      maxe=8
+      xlambda=13.0                          !Was 12
+
+      if(ndec.eq.1) then
+         call graycode(mr2sym,63,-1)
+         call interleave63(mr2sym,-1)
+         call interleave63(mr2prob,-1)
+
+         nsec1=nsec1+1
+         write(22,rec=1) nsec1,xlambda,maxe,200,
+     +        mrsym,mrprob,mr2sym,mr2prob
+         call flush(22)
+!         call timer('kvasd   ',0)
+#ifdef UNIX
+         iret=system('./kvasd -q &gt; dev_null')
+#else
+         iret=system('kvasd -q &gt; dev_null')
+#endif
+!         call timer('kvasd   ',1)
+         if(iret.ne.0) then
+            if(first) write(*,1000) iret
+ 1000       format('Error in KV decoder, or no KV decoder present.'/
+     +         'Return code:',i8,'.  Will use BM algorithm.')
+            ndec=0
+            first=.false.
+            go to 20
+         endif
+
+         read(22,rec=2) nsec2,ncount,dat4
+         j=nsec2                !Silence compiler warning
+         decoded='                      '
+         ltext=.false.
+         if(ncount.ge.0) then
+            call unpackmsg(dat4,decoded)     !Unpack the user message
+            if(iand(dat4(10),8).ne.0) ltext=.true.
+            do i=2,12
+               if(dat4(i).ne.dat4(1)) go to 20
+            enddo
+            write(13,*) 'Bad decode?',nhist,nfail,ipk,
+     +      ' ',dat4,decoded
+            ncount=-1           !Suppress supposedly bogus decodes
+            decoded='                      '
+         endif
+      endif
+ 20   if(ndec.eq.0) then
+         call indexx(63,mrprob,indx)
+         do i=1,nemax
+            j=indx(i)
+            if(mrprob(j).gt.120) then
+               ne2=i-1
+               go to 2
+            endif
+            era(i)=j-1
+         enddo
+         ne2=nemax
+ 2       decoded='                      '
+         do nerase=0,ne2,2
+            call rs_decode(mrsym,era,nerase,dat4,ncount)
+            if(ncount.ge.0) then
+               call unpackmsg(dat4,decoded)
+               go to 900
+            endif
+         enddo
+      endif
+
+ 900  return
+      end

Added: branches/map65/libm65/f77_wisdom.f
===================================================================
--- branches/map65/libm65/f77_wisdom.f	                        (rev 0)
+++ branches/map65/libm65/f77_wisdom.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,45 @@
+      subroutine write_char(c, iunit)
+      character c
+      integer iunit
+      write(iunit,1000) c
+ 1000 format(a,$)
+      end      
+
+      subroutine export_wisdom_to_file(iunit)
+      integer iunit
+      external write_char
+c      call dfftw_export_wisdom(write_char, iunit)
+      call sfftw_export_wisdom(write_char, iunit)
+      end
+
+      subroutine read_char(ic, iunit)
+      integer ic
+      integer iunit
+      character*256 buf
+      save buf
+      integer ibuf
+      data ibuf/257/
+      save ibuf
+      if (ibuf .lt. 257) then
+         ic = ichar(buf(ibuf:ibuf))
+         ibuf = ibuf + 1
+         return
+      endif
+      read(iunit,1000,end=10) buf
+ 1000 format(a256)
+      ic = ichar(buf(1:1))
+      ibuf = 2
+      return
+ 10   ic = -1
+      ibuf = 257
+      rewind iunit
+      return
+      end
+      
+      subroutine import_wisdom_from_file(isuccess, iunit)
+      integer isuccess
+      integer iunit
+      external read_char
+c      call dfftw_import_wisdom(isuccess, read_char, iunit)
+      call sfftw_import_wisdom(isuccess, read_char, iunit)
+      end

Added: branches/map65/libm65/fchisq.f
===================================================================
--- branches/map65/libm65/fchisq.f	                        (rev 0)
+++ branches/map65/libm65/fchisq.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,76 @@
+      real function fchisq(cx,cy,npts,fsample,nflip,a,ccfmax,dtmax)
+
+      parameter (NMAX=60*96000)          !Samples per 60 s
+      complex cx(npts),cy(npts)
+      real a(5)
+      complex w,wstep,za,zb,z
+      real ss(2600)
+      complex csx(0:NMAX/64),csy(0:NMAX/64)
+      data twopi/6.283185307/a1,a2,a3/99.,99.,99./
+      save
+
+      call timer('fchisq  ',0)
+      baud=11025.0/4096.0
+      if(a(1).ne.a1 .or. a(2).ne.a2 .or. a(3).ne.a3) then
+         a1=a(1)
+         a2=a(2)
+         a3=a(3)
+
+C  Mix and integrate the complex X and Y signals
+         csx(0)=0.
+         csy(0)=0.
+         w=1.0
+         x0=0.5*(npts+1)
+         s=2.0/npts
+         do i=1,npts
+            x=s*(i-x0)
+            if(mod(i,100).eq.1) then
+               p2=1.5*x*x - 0.5
+!               p3=2.5*(x**3) - 1.5*x
+!               p4=4.375*(x**4) - 3.75*(x**2) + 0.375
+               dphi=(a(1) + x*a(2) + p2*a(3)) * (twopi/fsample)
+               wstep=cmplx(cos(dphi),sin(dphi))
+            endif
+            w=w*wstep
+            csx(i)=csx(i-1) + w*cx(i)
+            csy(i)=csy(i-1) + w*cy(i)
+         enddo
+      endif
+
+C  Compute 1/2-symbol powers at 1/16-symbol steps.
+      fac=1.e-4
+      pol=a(4)/57.2957795
+      aa=cos(pol)
+      bb=sin(pol)
+      nsps=nint(fsample/baud)                  !Samples per symbol
+      nsph=nsps/2                              !Samples per half-symbol
+
+      ndiv=16                                  !Output ss() steps per symbol
+      nout=ndiv*npts/nsps
+      dtstep=1.0/(ndiv*baud)                   !Time per output step
+
+      do i=1,nout
+         j=i*nsps/ndiv
+         k=j-nsph
+         ss(i)=0.
+         if(k.ge.1) then
+            za=csx(j)-csx(k)
+            zb=csy(j)-csy(k)
+            z=aa*za + bb*zb
+            ss(i)=fac*(real(z)**2 + aimag(z)**2)
+         endif
+      enddo
+
+      ccfmax=0.
+      call timer('ccf2    ',0)
+      call ccf2(ss,nout,nflip,ccf,lagpk)
+      call timer('ccf2    ',1)
+      if(ccf.gt.ccfmax) then
+         ccfmax=ccf
+         dtmax=lagpk*dtstep
+      endif
+      fchisq=-ccfmax
+
+      call timer('fchisq  ',1)
+      return
+      end

Added: branches/map65/libm65/fftw3.f
===================================================================
--- branches/map65/libm65/fftw3.f	                        (rev 0)
+++ branches/map65/libm65/fftw3.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,64 @@
+      INTEGER FFTW_R2HC
+      PARAMETER (FFTW_R2HC=0)
+      INTEGER FFTW_HC2R
+      PARAMETER (FFTW_HC2R=1)
+      INTEGER FFTW_DHT
+      PARAMETER (FFTW_DHT=2)
+      INTEGER FFTW_REDFT00
+      PARAMETER (FFTW_REDFT00=3)
+      INTEGER FFTW_REDFT01
+      PARAMETER (FFTW_REDFT01=4)
+      INTEGER FFTW_REDFT10
+      PARAMETER (FFTW_REDFT10=5)
+      INTEGER FFTW_REDFT11
+      PARAMETER (FFTW_REDFT11=6)
+      INTEGER FFTW_RODFT00
+      PARAMETER (FFTW_RODFT00=7)
+      INTEGER FFTW_RODFT01
+      PARAMETER (FFTW_RODFT01=8)
+      INTEGER FFTW_RODFT10
+      PARAMETER (FFTW_RODFT10=9)
+      INTEGER FFTW_RODFT11
+      PARAMETER (FFTW_RODFT11=10)
+      INTEGER FFTW_FORWARD
+      PARAMETER (FFTW_FORWARD=-1)
+      INTEGER FFTW_BACKWARD
+      PARAMETER (FFTW_BACKWARD=+1)
+      INTEGER FFTW_MEASURE
+      PARAMETER (FFTW_MEASURE=0)
+      INTEGER FFTW_DESTROY_INPUT
+      PARAMETER (FFTW_DESTROY_INPUT=1)
+      INTEGER FFTW_UNALIGNED
+      PARAMETER (FFTW_UNALIGNED=2)
+      INTEGER FFTW_CONSERVE_MEMORY
+      PARAMETER (FFTW_CONSERVE_MEMORY=4)
+      INTEGER FFTW_EXHAUSTIVE
+      PARAMETER (FFTW_EXHAUSTIVE=8)
+      INTEGER FFTW_PRESERVE_INPUT
+      PARAMETER (FFTW_PRESERVE_INPUT=16)
+      INTEGER FFTW_PATIENT
+      PARAMETER (FFTW_PATIENT=32)
+      INTEGER FFTW_ESTIMATE
+      PARAMETER (FFTW_ESTIMATE=64)
+      INTEGER FFTW_ESTIMATE_PATIENT
+      PARAMETER (FFTW_ESTIMATE_PATIENT=128)
+      INTEGER FFTW_BELIEVE_PCOST
+      PARAMETER (FFTW_BELIEVE_PCOST=256)
+      INTEGER FFTW_DFT_R2HC_ICKY
+      PARAMETER (FFTW_DFT_R2HC_ICKY=512)
+      INTEGER FFTW_NONTHREADED_ICKY
+      PARAMETER (FFTW_NONTHREADED_ICKY=1024)
+      INTEGER FFTW_NO_BUFFERING
+      PARAMETER (FFTW_NO_BUFFERING=2048)
+      INTEGER FFTW_NO_INDIRECT_OP
+      PARAMETER (FFTW_NO_INDIRECT_OP=4096)
+      INTEGER FFTW_ALLOW_LARGE_GENERIC
+      PARAMETER (FFTW_ALLOW_LARGE_GENERIC=8192)
+      INTEGER FFTW_NO_RANK_SPLITS
+      PARAMETER (FFTW_NO_RANK_SPLITS=16384)
+      INTEGER FFTW_NO_VRANK_SPLITS
+      PARAMETER (FFTW_NO_VRANK_SPLITS=32768)
+      INTEGER FFTW_NO_VRECURSE
+      PARAMETER (FFTW_NO_VRECURSE=65536)
+      INTEGER FFTW_NO_SIMD
+      PARAMETER (FFTW_NO_SIMD=131072)

Added: branches/map65/libm65/fil6521.f
===================================================================
--- branches/map65/libm65/fil6521.f	                        (rev 0)
+++ branches/map65/libm65/fil6521.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,44 @@
+      subroutine fil6521(c1,n1,c2,n2)
+
+C  FIR lowpass filter designed using ScopeFIR
+
+C                   Pass #1   Pass #2  
+C-----------------------------------------------
+C  fsample    (Hz)  1378.125   Input sample rate
+C  Ntaps            21         Number of filter taps
+C  fc         (Hz)  40         Cutoff frequency
+C  fstop      (Hz)  172.266    Lower limit of stopband
+C  Ripple     (dB)  0.1        Ripple in passband
+C  Stop Atten (dB)  38         Stopband attenuation
+C  fout       (Hz)  344.531    Output sample rate
+
+      parameter (NTAPS=21)
+      parameter (NH=NTAPS/2)
+      parameter (NDOWN=4)                !Downsample ratio = 1/4
+      complex c1(n1)
+      complex c2(n1/NDOWN)
+
+C  Filter coefficients:
+      real a(-NH:NH)
+      data a/
+     +  -0.011958606980,-0.013888627387,-0.015601306443,-0.010602249570,
+     +   0.003804023436, 0.028320058273, 0.060903935217, 0.096841904411,
+     +   0.129639871228, 0.152644580853, 0.160917511283, 0.152644580853,
+     +   0.129639871228, 0.096841904411, 0.060903935217, 0.028320058273,
+     +   0.003804023436,-0.010602249570,-0.015601306443,-0.013888627387,
+     +  -0.011958606980/
+
+      n2=(n1-NTAPS+NDOWN)/NDOWN
+      k0=NH-NDOWN+1
+
+C  Loop over all output samples
+      do i=1,n2
+         c2(i)=0.
+         k=k0 + NDOWN*i
+         do j=-NH,NH
+            c2(i)=c2(i) + c1(j+k)*a(j)
+         enddo
+      enddo
+
+      return
+      end

Added: branches/map65/libm65/filbig.f
===================================================================
--- branches/map65/libm65/filbig.f	                        (rev 0)
+++ branches/map65/libm65/filbig.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,134 @@
+      subroutine filbig(dd,nmax,f0,newdat,nfsample,xpol,c4a,c4b,n4)
+
+C  Filter and downsample complex data stored in array dd(4,nmax).  
+C  Output is downsampled from 96000 Hz to 1375.125 Hz.
+
+      parameter (MAXFFT1=5376000,MAXFFT2=77175)
+      real*4  dd(4,nmax)                         !Input data
+      complex ca(MAXFFT1),cb(MAXFFT1)            !FFTs of input
+      complex c4a(MAXFFT2),c4b(MAXFFT2)          !Output data
+      real*8 df
+      real halfpulse(8)                 !Impulse response of filter (one sided)
+      complex cfilt(MAXFFT2)                     !Filter (complex; imag = 0)
+      real rfilt(MAXFFT2)                        !Filter (real)
+      integer*8 plan1,plan2,plan3,plan4,plan5
+      logical first,xpol
+      include 'fftw3.f'
+      equivalence (rfilt,cfilt)
+      data first/.true./,npatience/1/
+      data halfpulse/114.97547150,36.57879257,-20.93789101,
+     +  5.89886379,1.59355187,-2.49138308,0.60910773,-0.04248129/
+      save
+
+      nfft1=MAXFFT1
+      nfft2=MAXFFT2
+      if(nfsample.eq.95238) then
+         nfft1=5120000
+         nfft2=74088
+      endif
+      if(nmax.lt.0) go to 900
+      if(first) then
+         nflags=FFTW_ESTIMATE
+         if(npatience.eq.1) nflags=FFTW_ESTIMATE_PATIENT
+         if(npatience.eq.2) nflags=FFTW_MEASURE
+         if(npatience.eq.3) nflags=FFTW_PATIENT
+         if(npatience.eq.4) nflags=FFTW_EXHAUSTIVE
+C  Plan the FFTs just once
+         call timer('FFTplans ',0)
+         call sfftw_plan_dft_1d(plan1,nfft1,ca,ca,
+     +        FFTW_BACKWARD,nflags)
+         call sfftw_plan_dft_1d(plan2,nfft1,cb,cb,
+     +        FFTW_BACKWARD,nflags)
+         call sfftw_plan_dft_1d(plan3,nfft2,c4a,c4a,
+     +        FFTW_FORWARD,nflags)
+         call sfftw_plan_dft_1d(plan4,nfft2,c4b,c4b,
+     +        FFTW_FORWARD,nflags)
+         call sfftw_plan_dft_1d(plan5,nfft2,cfilt,cfilt,
+     +        FFTW_BACKWARD,nflags)
+         call timer('FFTplans ',1)
+
+C  Convert impulse response to filter function
+         do i=1,nfft2
+            cfilt(i)=0.
+         enddo
+         fac=0.00625/nfft1
+         cfilt(1)=fac*halfpulse(1)
+         do i=2,8
+            cfilt(i)=fac*halfpulse(i)
+            cfilt(nfft2+2-i)=fac*halfpulse(i)
+         enddo
+         call timer('FFTfilt ',0)
+         call sfftw_execute(plan5)
+         call timer('FFTfilt ',1)
+
+         base=cfilt(nfft2/2+1)
+         do i=1,nfft2
+            rfilt(i)=real(cfilt(i))-base
+         enddo
+
+         df=96000.d0/nfft1
+         if(nfsample.eq.95238) df=95238.1d0/nfft1
+         first=.false.
+      endif
+
+C  When new data comes along, we need to compute a new &quot;big FFT&quot;
+C  If we just have a new f0, continue with the existing ca and cb.
+
+      if(newdat.ne.0) then
+         nz=min(nmax,nfft1)
+         do i=1,nz
+            ca(i)=cmplx(dd(1,i),dd(2,i))
+            if(xpol) cb(i)=cmplx(dd(3,i),dd(4,i))
+         enddo
+
+         if(nmax.lt.nfft1) then
+            do i=nmax+1,nfft1
+               ca(i)=0.
+               if(xpol) cb(i)=0.
+            enddo
+         endif
+         call timer('FFTbig  ',0)
+         call sfftw_execute(plan1)
+         if(xpol) call sfftw_execute(plan2)
+         call timer('FFTbig  ',1)
+         newdat=0
+      endif
+
+C  NB: f0 is the frequency at which we want our filter centered.
+C      i0 is the bin number in ca and cb closest to f0.
+
+      i0=nint(f0/df) + 1
+      nh=nfft2/2
+      do i=1,nh                                !Copy data into c4a and c4b,
+         j=i0+i-1                              !and apply the filter function
+         if(j.ge.1 .and. j.le.nfft1) then
+            c4a(i)=rfilt(i)*ca(j)
+            if(xpol) c4b(i)=rfilt(i)*cb(j)
+         else
+            c4a(i)=0.
+            if(xpol) c4b(i)=0.
+         endif
+      enddo
+      do i=nh+1,nfft2
+         j=i0+i-1-nfft2
+         if(j.lt.1) j=j+nfft1                  !nfft1 was nfft2
+         c4a(i)=rfilt(i)*ca(j)
+         if(xpol) c4b(i)=rfilt(i)*cb(j)
+      enddo
+
+C  Do the short reverse transform, to go back to time domain.
+      call timer('FFTsmall',0)
+      call sfftw_execute(plan3)
+      if(xpol) call sfftw_execute(plan4)
+      call timer('FFTsmall',1)
+      n4=min(nmax/64,nfft2)
+      go to 999
+
+ 900  call sfftw_destroy_plan(plan1)
+      call sfftw_destroy_plan(plan2)
+      call sfftw_destroy_plan(plan3)
+      call sfftw_destroy_plan(plan4)
+      call sfftw_destroy_plan(plan5)
+
+ 999  return
+      end

Added: branches/map65/libm65/four2a.f90
===================================================================
--- branches/map65/libm65/four2a.f90	                        (rev 0)
+++ branches/map65/libm65/four2a.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,89 @@
+subroutine four2a(a,nfft,ndim,isign,iform)
+
+!     IFORM = 1, 0 or -1, as data is
+!     complex, real, or the first half of a complex array.  Transform
+!     values are returned in array DATA.  They are complex, real, or
+!     the first half of a complex array, as IFORM = 1, -1 or 0.
+
+!     The transform of a real array (IFORM = 0) dimensioned N(1) by N(2)
+!     by ... will be returned in the same array, now considered to
+!     be complex of dimensions N(1)/2+1 by N(2) by ....  Note that if
+!     IFORM = 0 or -1, N(1) must be even, and enough room must be
+!     reserved.  The missing values may be obtained by complex conjugation.  
+
+!     The reverse transformation of a half complex array dimensioned
+!     N(1)/2+1 by N(2) by ..., is accomplished by setting IFORM
+!     to -1.  In the N array, N(1) must be the true N(1), not N(1)/2+1.
+!     The transform will be real and returned to the input array.
+
+  parameter (NPMAX=100)
+  parameter (NSMALL=16384)
+  complex a(nfft)
+  complex aa(NSMALL)
+  integer nn(NPMAX),ns(NPMAX),nf(NPMAX),nl(NPMAX)
+  integer*8 plan(NPMAX)             !Actually should be i*8, but no matter
+  data nplan/0/,npatience/1/
+  include 'fftw3.f'
+  save plan,nplan,nn,ns,nf,nl
+
+  if(nfft.lt.0) go to 999
+
+  nloc=loc(a)
+  do i=1,nplan
+     if(nfft.eq.nn(i) .and. isign.eq.ns(i) .and.                     &amp;
+          iform.eq.nf(i) .and. nloc.eq.nl(i)) go to 10
+  enddo
+  if(nplan.ge.NPMAX) stop 'Too many FFTW plans requested.'
+  nplan=nplan+1
+  i=nplan
+  nn(i)=nfft
+  ns(i)=isign
+  nf(i)=iform
+  nl(i)=nloc
+
+! Planning: FFTW_ESTIMATE, FFTW_ESTIMATE_PATIENT, FFTW_MEASURE, 
+!            FFTW_PATIENT,  FFTW_EXHAUSTIVE
+  nflags=FFTW_ESTIMATE
+  if(npatience.eq.1) nflags=FFTW_ESTIMATE_PATIENT
+  if(npatience.eq.2) nflags=FFTW_MEASURE
+  if(npatience.eq.3) nflags=FFTW_PATIENT
+  if(npatience.eq.4) nflags=FFTW_EXHAUSTIVE
+
+  if(nfft.le.NSMALL) then
+     jz=nfft
+     if(iform.eq.0) jz=nfft/2
+     do j=1,jz
+        aa(j)=a(j)
+     enddo
+  endif
+  if(isign.eq.-1 .and. iform.eq.1) then
+     call sfftw_plan_dft_1d(plan(i),nfft,a,a,FFTW_FORWARD,nflags)
+  else if(isign.eq.1 .and. iform.eq.1) then
+     call sfftw_plan_dft_1d(plan(i),nfft,a,a,FFTW_BACKWARD,nflags)
+  else if(isign.eq.-1 .and. iform.eq.0) then
+     call sfftw_plan_dft_r2c_1d(plan(i),nfft,a,a,nflags)
+  else if(isign.eq.1 .and. iform.eq.-1) then
+     call sfftw_plan_dft_c2r_1d(plan(i),nfft,a,a,nflags)
+  else
+     stop 'Unsupported request in four2a'
+  endif
+  i=nplan
+  if(nfft.le.NSMALL) then
+     jz=nfft
+     if(iform.eq.0) jz=nfft/2
+     do j=1,jz
+        a(j)=aa(j)
+     enddo
+  endif
+
+10 continue
+  call sfftw_execute(plan(i))
+  return
+
+999 do i=1,nplan
+! The test is only to silence a compiler warning:
+     if(ndim.ne.-999) call sfftw_destroy_plan(plan(i))
+  enddo
+
+  return
+end subroutine four2a

Added: branches/map65/libm65/ftninit.f90
===================================================================
--- branches/map65/libm65/ftninit.f90	                        (rev 0)
+++ branches/map65/libm65/ftninit.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,63 @@
+! Fortran logical units used in WSJT6
+!
+!   10  binary input data, *.tf2 files
+!   11  prefixes.txt
+!   12  timer.out
+!   13  map65.log
+!   14  
+!   15  
+!   16
+!   17  saved *.tf2 files
+!   18  test file to be transmitted (wsjtgen.f90)
+!   19  livecq.txt
+!   20  
+!   21  map65_rx.log
+!   22  kvasd.dat
+!   23  CALL3.TXT
+!   24  
+!   25  
+!   26  tmp26.txt
+!   27  
+!   28  fftw_wisdom.dat
+!------------------------------------------------ ftn_init
+subroutine ftninit(appd)
+
+  character*(*) appd
+  character cjunk*1,firstline*30
+  character addpfx*8
+  integer junk(256)
+  common/pfxcom/addpfx
+
+  addpfx='    '
+  call pfxdump(appd//'/prefixes.txt')
+  open(12,file=appd//'/timer.out',status='unknown',err=920)
+  open(13,file=appd//'/map65.log',status='unknown')
+  open(19,file=appd//'/livecq.txt',status='unknown')
+  open(21,file=appd//'/map65_rx.log',status='unknown',access='append',err=950)
+  open(22,file=appd//'/kvasd.dat',access='direct',recl=1024,status='unknown')
+  read(22,rec=2,err=12) junk
+  go to 18
+12 junk=0
+  write(22,rec=1) junk
+  write(22,rec=2) junk
+
+18  open(26,file=appd//'/tmp26.txt',status='unknown')
+
+! Import FFTW wisdom, if available:
+  open(28,file=appd//'/fftwf_wisdom.dat',status='old',err=30)
+  read(28,1000,err=30,end=30) firstline
+1000 format(a30)
+  rewind 28
+  call import_wisdom_from_file(isuccess,28)
+  close(28)
+  if(isuccess.ne.0) write(13,1010) firstline
+1010 format('Imported FFTW wisdom: ',a30)
+
+30  return
+
+920 write(0,*) '!Error opening timer.out'
+  stop
+950 write(0,*) '!Error opening ALL65.TXT'
+  stop
+
+end subroutine ftninit

Added: branches/map65/libm65/ftnquit.f90
===================================================================
--- branches/map65/libm65/ftnquit.f90	                        (rev 0)
+++ branches/map65/libm65/ftnquit.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,9 @@
+subroutine ftnquit
+
+! Destroy the FFTW plans
+  call four2a(a,-1,1,1,1)
+  call filbig(id,-1,f0,newdat,nfsample,c4a,c4b,n4)
+  stop
+
+  return
+end subroutine ftnquit

Added: branches/map65/libm65/gen65.f90
===================================================================
--- branches/map65/libm65/gen65.f90	                        (rev 0)
+++ branches/map65/libm65/gen65.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,93 @@
+subroutine gen65(message,mode65,samfac,nsendingsh,msgsent,iwave,nwave)
+
+! Encodes a JT65 message into a wavefile.  
+! Executes in 17 ms on opti-745.
+
+  parameter (NMAX=60*11025)     !Max length of wave file
+  character*22 message          !Message to be generated
+  character*22 msgsent          !Message as it will be received
+  character*3 cok               !'   ' or 'OOO'
+  real*8 dt,phi,f,f0,dfgen,dphi,twopi,samfac
+  integer*2 iwave(NMAX)         !Generated wave file
+  integer dgen(12)
+  integer sent(63)
+  logical first
+  integer nprc(126)
+  real pr(126)
+  data nprc/1,0,0,1,1,0,0,0,1,1,1,1,1,1,0,1,0,1,0,0,  &amp;
+            0,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,1,1,1,1,  &amp;
+            0,1,1,0,1,1,1,1,0,0,0,1,1,0,1,0,1,0,1,1,  &amp;
+            0,0,1,1,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,  &amp;
+            1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,0,1,  &amp;
+            0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,  &amp;
+            1,1,1,1,1,1/
+  data twopi/6.283185307179586476d0/,first/.true./
+  save
+
+  if(first) then
+     do i=1,126
+        pr(i)=2*nprc(i)-1
+     enddo
+     first=.false.
+  endif
+
+  call chkmsg(message,cok,nspecial,flip)
+  if(nspecial.eq.0) then
+     call packmsg(message,dgen)          !Pack message into 72 bits
+     nsendingsh=0
+     if(iand(dgen(10),8).ne.0) nsendingsh=-1    !Plain text flag
+
+     call rs_encode(dgen,sent)
+     call interleave63(sent,1)           !Apply interleaving
+     call graycode(sent,63,1)            !Apply Gray code
+     nsym=126                            !Symbols per transmission
+     nsps=4096
+  else
+     nsym=32
+     nsps=16384
+     nsendingsh=1                         !Flag for shorthand message
+  endif
+  if(mode65.eq.0) go to 900
+
+! Set up necessary constants
+  dt=1.d0/(samfac*11025.d0)
+  f0=118*11025.d0/1024
+  dfgen=mode65*11025.d0/4096.d0
+  phi=0.d0
+  i=0
+  k=0
+  do j=1,nsym
+     f=f0
+     if(nspecial.ne.0 .and. mod(j,2).eq.0) f=f0+10*nspecial*dfgen
+     if(nspecial.eq.0 .and. flip*pr(j).lt.0.0) then
+        k=k+1
+        f=f0+(sent(k)+2)*dfgen
+     endif
+     dphi=twopi*dt*f
+     do ii=1,nsps
+        phi=phi+dphi
+        if(phi.gt.twopi) phi=phi-twopi
+        xphi=phi
+        i=i+1
+        iwave(i)=32767.0*sin(xphi)
+     enddo
+  enddo
+
+  iwave(nsym*nsps+1:)=0
+  nwave=nsym*nsps + 5512
+  call unpackmsg(dgen,msgsent)
+  if(flip.lt.0.0) then
+     do i=22,1,-1
+        if(msgsent(i:i).ne.' ') goto 10
+     enddo
+10   msgsent=msgsent(1:i)//' OOO'
+  endif
+
+  if(nsendingsh.eq.1) then
+     if(nspecial.eq.2) msgsent='RO'
+     if(nspecial.eq.3) msgsent='RRR'
+     if(nspecial.eq.4) msgsent='73'
+  endif
+
+900 return
+end subroutine gen65

Added: branches/map65/libm65/geocentric.f
===================================================================
--- branches/map65/libm65/geocentric.f	                        (rev 0)
+++ branches/map65/libm65/geocentric.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,17 @@
+      subroutine geocentric(alat,elev,hlt,erad)
+
+      implicit real*8 (a-h,o-z)
+
+C  IAU 1976 flattening f, equatorial radius a
+      f = 1.d0/298.257d0
+      a = 6378140.d0
+      c = 1.d0/sqrt(1.d0 + (-2.d0 + f)*f*sin(alat)*sin(alat))
+      arcf = (a*c + elev)*cos(alat)
+      arsf = (a*(1.d0 - f)*(1.d0 - f)*c + elev)*sin(alat)
+      hlt = datan2(arsf,arcf)
+      erad = sqrt(arcf*arcf + arsf*arsf)
+      erad = 0.001d0*erad
+
+      return
+      end
+

Added: branches/map65/libm65/getdphi.f90
===================================================================
--- branches/map65/libm65/getdphi.f90	                        (rev 0)
+++ branches/map65/libm65/getdphi.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,18 @@
+subroutine getdphi(qphi)
+
+  real qphi(12)
+
+  s=0.
+  c=0.
+  do i=1,12
+     th=i*30/57.2957795
+     s=s+qphi(i)*sin(th)
+     c=c+qphi(i)*cos(th)
+  enddo
+
+  dphi=57.2957795*atan2(s,c)
+  write(*,1010) nint(dphi)
+1010 format('!Best-fit Dphi =',i4,' deg')
+
+  return
+  end

Added: branches/map65/libm65/getpfx1.f
===================================================================
--- branches/map65/libm65/getpfx1.f	                        (rev 0)
+++ branches/map65/libm65/getpfx1.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,96 @@
+      subroutine getpfx1(callsign,k,nv2)
+
+      character*12 callsign0,callsign,lof,rof
+      character*8 c
+      character addpfx*8,tpfx*4,tsfx*3
+      logical ispfx,issfx,invalid
+      common/pfxcom/addpfx
+      include 'pfx.f'
+
+      callsign0=callsign
+      nv2=0
+      iz=index(callsign,' ') - 1
+      if(iz.lt.0) iz=12
+      islash=index(callsign(1:iz),'/')
+      k=0
+      c='   '
+      if(islash.gt.0 .and. islash.le.(iz-4)) then
+!  Add-on prefix
+         c=callsign(1:islash-1)
+         callsign=callsign(islash+1:iz)
+         do i=1,NZ
+            if(pfx(i)(1:4).eq.c) then
+               k=i
+               go to 10
+            endif
+         enddo
+         if(addpfx.eq.c) then
+            k=449
+            go to 10
+         endif
+
+      else if(islash.eq.(iz-1)) then
+!  Add-on suffix
+         c=callsign(islash+1:iz)
+         callsign=callsign(1:islash-1)
+         do i=1,NZ2
+            if(sfx(i).eq.c(1:1)) then
+               k=400+i
+               go to 10
+            endif
+         enddo
+      endif
+
+ 10   if(islash.ne.0 .and.k.eq.0) then
+!  Original JT65 would force this compound callsign to be treated as
+!  plain text.  In JT65v2, we will encode the prefix or suffix into nc1.
+!  The task here is to compute the proper value of k.
+         lof=callsign0(:islash-1)
+         rof=callsign0(islash+1:)
+         llof=len_trim(lof)
+         lrof=len_trim(rof)
+         ispfx=(llof.gt.0 .and. llof.le.4)
+         issfx=(lrof.gt.0 .and. lrof.le.3)
+         invalid=.not.(ispfx.or.issfx)
+         if(ispfx.and.issfx) then
+            if(llof.lt.3) issfx=.false.
+            if(lrof.lt.3) ispfx=.false.
+            if(ispfx.and.issfx) then
+               i=ichar(callsign0(islash-1:islash-1))
+               if(i.ge.ichar('0') .and. i.le.ichar('9')) then
+                  issfx=.false.
+               else
+                  ispfx=.false.
+               endif
+            endif
+         endif
+
+         if(invalid) then
+            k=-1
+         else
+            if(ispfx) then
+               tpfx=lof
+               k=nchar(tpfx(1:1))
+               k=37*k + nchar(tpfx(2:2))
+               k=37*k + nchar(tpfx(3:3))
+               k=37*k + nchar(tpfx(4:4))
+               nv2=1
+               i=index(callsign0,'/')
+               callsign=callsign0(:i-1)
+               callsign=callsign0(i+1:)
+            endif
+            if(issfx) then
+               tsfx=rof
+               k=nchar(tsfx(1:1))
+               k=37*k + nchar(tsfx(2:2))
+               k=37*k + nchar(tsfx(3:3))
+               nv2=2
+               i=index(callsign0,'/')
+               callsign=callsign0(:i-1)
+            endif
+         endif
+      endif
+
+      return
+      end
+

Added: branches/map65/libm65/getpfx2.f
===================================================================
--- branches/map65/libm65/getpfx2.f	                        (rev 0)
+++ branches/map65/libm65/getpfx2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,24 @@
+      subroutine getpfx2(k0,callsign)
+
+      character callsign*12
+      include 'pfx.f'
+      character addpfx*8
+      common/pfxcom/addpfx
+
+      k=k0
+      if(k.gt.450) k=k-450
+      if(k.ge.1 .and. k.le.NZ) then
+         iz=index(pfx(k),' ') - 1
+         callsign=pfx(k)(1:iz)//'/'//callsign
+      else if(k.ge.401 .and. k.le.400+NZ2) then
+         iz=index(callsign,' ') - 1
+         callsign=callsign(1:iz)//'/'//sfx(k-400)
+      else if(k.eq.449) then
+         iz=index(addpfx,' ') - 1
+         if(iz.lt.1) iz=8
+         callsign=addpfx(1:iz)//'/'//callsign
+      endif
+
+      return
+      end
+

Added: branches/map65/libm65/graycode.f
===================================================================
--- branches/map65/libm65/graycode.f	                        (rev 0)
+++ branches/map65/libm65/graycode.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,10 @@
+      subroutine graycode(dat,n,idir)
+
+      integer dat(n)
+      do i=1,n
+         dat(i)=igray(dat(i),idir)
+      enddo
+
+      return
+      end
+

Added: branches/map65/libm65/grid2deg.f
===================================================================
--- branches/map65/libm65/grid2deg.f	                        (rev 0)
+++ branches/map65/libm65/grid2deg.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,38 @@
+      subroutine grid2deg(grid0,dlong,dlat)
+
+C  Converts Maidenhead grid locator to degrees of West longitude
+C  and North latitude.
+
+      character*6 grid0,grid
+      character*1 g1,g2,g3,g4,g5,g6
+
+      grid=grid0
+      i=ichar(grid(5:5))
+      if(grid(5:5).eq.' ' .or. i.le.64 .or. i.ge.128) grid(5:6)='mm'
+
+      if(grid(1:1).ge.'a' .and. grid(1:1).le.'z') grid(1:1)= 
+     +   char(ichar(grid(1:1))+ichar('A')-ichar('a'))
+      if(grid(2:2).ge.'a' .and. grid(2:2).le.'z') grid(2:2)=
+     +   char(ichar(grid(2:2))+ichar('A')-ichar('a'))
+      if(grid(5:5).ge.'A' .and. grid(5:5).le.'Z') grid(5:5)=
+     +   char(ichar(grid(5:5))-ichar('A')+ichar('a'))
+      if(grid(6:6).ge.'A' .and. grid(6:6).le.'Z') grid(6:6)=
+     +   char(ichar(grid(6:6))-ichar('A')+ichar('a'))
+
+      g1=grid(1:1)
+      g2=grid(2:2)
+      g3=grid(3:3)
+      g4=grid(4:4)
+      g5=grid(5:5)
+      g6=grid(6:6)
+
+      nlong = 180 - 20*(ichar(g1)-ichar('A'))
+      n20d = 2*(ichar(g3)-ichar('0'))
+      xminlong = 5*(ichar(g5)-ichar('a')+0.5)
+      dlong = nlong - n20d - xminlong/60.0
+      nlat = -90+10*(ichar(g2)-ichar('A')) + ichar(g4)-ichar('0')
+      xminlat = 2.5*(ichar(g6)-ichar('a')+0.5)
+      dlat = nlat + xminlat/60.0
+
+      return
+      end

Added: branches/map65/libm65/grid2k.f
===================================================================
--- branches/map65/libm65/grid2k.f	                        (rev 0)
+++ branches/map65/libm65/grid2k.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,12 @@
+      subroutine grid2k(grid,k)
+
+      character*6 grid
+
+      call grid2deg(grid,xlong,xlat)
+      nlong=nint(xlong)
+      nlat=nint(xlat)
+      k=0
+      if(nlat.ge.85) k=5*(nlong+179)/2 + nlat-84
+
+      return
+      end

Added: branches/map65/libm65/igray.c
===================================================================
--- branches/map65/libm65/igray.c	                        (rev 0)
+++ branches/map65/libm65/igray.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,22 @@
+#ifdef CVF
+extern int __stdcall IGRAY(int *n0, int *idir)
+#else
+int igray_(int *n0, int *idir)
+#endif
+{
+  int n;
+  unsigned long sh;
+  unsigned long nn;
+  n=*n0;
+
+  if(*idir&gt;0) return (n ^ (n &gt;&gt; 1));
+
+  sh = 1;
+  nn = (n &gt;&gt; sh);
+  while (nn &gt; 0) {
+    n ^= nn;
+    sh &lt;&lt;= 1;
+    nn = (n &gt;&gt; sh);
+  }
+  return (n);
+}

Added: branches/map65/libm65/indexx.f
===================================================================
--- branches/map65/libm65/indexx.f	                        (rev 0)
+++ branches/map65/libm65/indexx.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,19 @@
+      subroutine indexx(n,arr,indx)
+
+      parameter (NMAX=3000)
+      integer indx(n)
+      real arr(n)
+      real brr(NMAX)
+      if(n.gt.NMAX) then
+         print*,'n=',n,' too big in indexx.'
+         stop
+      endif
+      do i=1,n
+         brr(i)=arr(i)
+         indx(i)=i
+      enddo
+      call ssort(brr,indx,n,2)
+
+      return
+      end
+

Added: branches/map65/libm65/init_rs.c
===================================================================
--- branches/map65/libm65/init_rs.c	                        (rev 0)
+++ branches/map65/libm65/init_rs.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,126 @@
+/* Initialize a RS codec
+ *
+ * Copyright 2002 Phil Karn, KA9Q
+ * May be used under the terms of the GNU General Public License (GPL)
+ */
+#include &lt;stdlib.h&gt;
+
+#ifdef CCSDS
+#include &quot;ccsds.h&quot;
+#elif defined(BIGSYM)
+#include &quot;int.h&quot;
+#else
+#include &quot;char.h&quot;
+#endif
+
+#define NULL ((void *)0)
+
+void FREE_RS(void *p){
+  struct rs *rs = (struct rs *)p;
+
+  free(rs-&gt;alpha_to);
+  free(rs-&gt;index_of);
+  free(rs-&gt;genpoly);
+  free(rs);
+}
+
+/* Initialize a Reed-Solomon codec
+ * symsize = symbol size, bits (1-8)
+ * gfpoly = Field generator polynomial coefficients
+ * fcr = first root of RS code generator polynomial, index form
+ * prim = primitive element to generate polynomial roots
+ * nroots = RS code generator polynomial degree (number of roots)
+ * pad = padding bytes at front of shortened block
+ */
+void *INIT_RS(int symsize,int gfpoly,int fcr,int prim,
+	int nroots,int pad){
+  struct rs *rs;
+  int i, j, sr,root,iprim;
+
+  /* Check parameter ranges */
+  if(symsize &lt; 0 || symsize &gt; 8*sizeof(DTYPE))
+    return NULL; /* Need version with ints rather than chars */
+
+  if(fcr &lt; 0 || fcr &gt;= (1&lt;&lt;symsize))
+    return NULL;
+  if(prim &lt;= 0 || prim &gt;= (1&lt;&lt;symsize))
+    return NULL;
+  if(nroots &lt; 0 || nroots &gt;= (1&lt;&lt;symsize))
+    return NULL; /* Can't have more roots than symbol values! */
+  if(pad &lt; 0 || pad &gt;= ((1&lt;&lt;symsize) -1 - nroots))
+    return NULL; /* Too much padding */
+
+  rs = (struct rs *)calloc(1,sizeof(struct rs));
+  rs-&gt;mm = symsize;
+  rs-&gt;nn = (1&lt;&lt;symsize)-1;
+  rs-&gt;pad = pad;
+
+  rs-&gt;alpha_to = (DTYPE *)malloc(sizeof(DTYPE)*(rs-&gt;nn+1));
+  if(rs-&gt;alpha_to == NULL){
+    free(rs);
+    return NULL;
+  }
+  rs-&gt;index_of = (DTYPE *)malloc(sizeof(DTYPE)*(rs-&gt;nn+1));
+  if(rs-&gt;index_of == NULL){
+    free(rs-&gt;alpha_to);
+    free(rs);
+    return NULL;
+  }
+
+  /* Generate Galois field lookup tables */
+  rs-&gt;index_of[0] = A0; /* log(zero) = -inf */
+  rs-&gt;alpha_to[A0] = 0; /* alpha**-inf = 0 */
+  sr = 1;
+  for(i=0;i&lt;rs-&gt;nn;i++){
+    rs-&gt;index_of[sr] = i;
+    rs-&gt;alpha_to[i] = sr;
+    sr &lt;&lt;= 1;
+    if(sr &amp; (1&lt;&lt;symsize))
+      sr ^= gfpoly;
+    sr &amp;= rs-&gt;nn;
+  }
+  if(sr != 1){
+    /* field generator polynomial is not primitive! */
+    free(rs-&gt;alpha_to);
+    free(rs-&gt;index_of);
+    free(rs);
+    return NULL;
+  }
+
+  /* Form RS code generator polynomial from its roots */
+  rs-&gt;genpoly = (DTYPE *)malloc(sizeof(DTYPE)*(nroots+1));
+  if(rs-&gt;genpoly == NULL){
+    free(rs-&gt;alpha_to);
+    free(rs-&gt;index_of);
+    free(rs);
+    return NULL;
+  }
+  rs-&gt;fcr = fcr;
+  rs-&gt;prim = prim;
+  rs-&gt;nroots = nroots;
+
+  /* Find prim-th root of 1, used in decoding */
+  for(iprim=1;(iprim % prim) != 0;iprim += rs-&gt;nn)
+    ;
+  rs-&gt;iprim = iprim / prim;
+
+  rs-&gt;genpoly[0] = 1;
+  for (i = 0,root=fcr*prim; i &lt; nroots; i++,root += prim) {
+    rs-&gt;genpoly[i+1] = 1;
+
+    /* Multiply rs-&gt;genpoly[] by  @**(root + x) */
+    for (j = i; j &gt; 0; j--){
+      if (rs-&gt;genpoly[j] != 0)
+	rs-&gt;genpoly[j] = rs-&gt;genpoly[j-1] ^ rs-&gt;alpha_to[modnn(rs,rs-&gt;index_of[rs-&gt;genpoly[j]] + root)];
+      else
+	rs-&gt;genpoly[j] = rs-&gt;genpoly[j-1];
+    }
+    /* rs-&gt;genpoly[0] can never be zero */
+    rs-&gt;genpoly[0] = rs-&gt;alpha_to[modnn(rs,rs-&gt;index_of[rs-&gt;genpoly[0]] + root)];
+  }
+  /* convert rs-&gt;genpoly[] to index form for quicker encoding */
+  for (i = 0; i &lt;= nroots; i++)
+    rs-&gt;genpoly[i] = rs-&gt;index_of[rs-&gt;genpoly[i]];
+
+  return rs;
+}

Added: branches/map65/libm65/int.h
===================================================================
--- branches/map65/libm65/int.h	                        (rev 0)
+++ branches/map65/libm65/int.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,57 @@
+/* Include file to configure the RS codec for integer symbols
+ *
+ * Copyright 2002, Phil Karn, KA9Q
+ * May be used under the terms of the GNU General Public License (GPL)
+ */
+#define DTYPE int
+
+/* Reed-Solomon codec control block */
+struct rs {
+  int mm;              /* Bits per symbol */
+  int nn;              /* Symbols per block (= (1&lt;&lt;mm)-1) */
+  DTYPE *alpha_to;     /* log lookup table */
+  DTYPE *index_of;     /* Antilog lookup table */
+  DTYPE *genpoly;      /* Generator polynomial */
+  int nroots;     /* Number of generator roots = number of parity symbols */
+  int fcr;        /* First consecutive root, index form */
+  int prim;       /* Primitive element, index form */
+  int iprim;      /* prim-th root of 1, index form */
+  int pad;        /* Padding bytes in shortened block */
+};
+
+static int modnn(struct rs *rs,int x){
+  while (x &gt;= rs-&gt;nn) {
+    x -= rs-&gt;nn;
+    x = (x &gt;&gt; rs-&gt;mm) + (x &amp; rs-&gt;nn);
+  }
+  return x;
+}
+#define MODNN(x) modnn(rs,x)
+
+#define MM (rs-&gt;mm)
+#define NN (rs-&gt;nn)
+#define ALPHA_TO (rs-&gt;alpha_to) 
+#define INDEX_OF (rs-&gt;index_of)
+#define GENPOLY (rs-&gt;genpoly)
+//#define NROOTS (rs-&gt;nroots)
+#define NROOTS (51)
+#define FCR (rs-&gt;fcr)
+#define PRIM (rs-&gt;prim)
+#define IPRIM (rs-&gt;iprim)
+#define PAD (rs-&gt;pad)
+#define A0 (NN)
+
+#define ENCODE_RS encode_rs_int
+#define DECODE_RS decode_rs_int
+#define INIT_RS init_rs_int
+#define FREE_RS free_rs_int
+
+void ENCODE_RS(void *p,DTYPE *data,DTYPE *parity);
+int DECODE_RS(void *p,DTYPE *data,int *eras_pos,int no_eras);
+void *INIT_RS(int symsize,int gfpoly,int fcr,
+		   int prim,int nroots,int pad);
+void FREE_RS(void *p);
+
+
+
+

Added: branches/map65/libm65/interleave63.f
===================================================================
--- branches/map65/libm65/interleave63.f	                        (rev 0)
+++ branches/map65/libm65/interleave63.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,25 @@
+      subroutine interleave63(d1,idir)
+
+C  Interleave (idir=1) or de-interleave (idir=-1) the array d1.
+
+      integer d1(0:6,0:8)
+      integer d2(0:8,0:6)
+
+      if(idir.ge.0) then
+         do i=0,6
+            do j=0,8
+               d2(j,i)=d1(i,j)
+            enddo
+         enddo
+         call move(d2,d1,63)
+      else
+         call move(d1,d2,63)
+         do i=0,6
+            do j=0,8
+               d1(i,j)=d2(j,i)
+            enddo
+         enddo
+      endif
+         
+      return
+      end

Added: branches/map65/libm65/ipcomm.cpp
===================================================================
--- branches/map65/libm65/ipcomm.cpp	                        (rev 0)
+++ branches/map65/libm65/ipcomm.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,34 @@
+#include &lt;QDebug&gt;
+#include &lt;qsharedmemory.h&gt;
+#include &lt;QSystemSemaphore&gt;
+
+QSharedMemory mem_m65(&quot;mem_m65&quot;);
+QSystemSemaphore sem_m65(&quot;sem_m65&quot;, 1, QSystemSemaphore::Open);
+
+extern &quot;C&quot; {
+  bool attach_m65_();
+  bool create_m65_(int nsize);
+  bool detach_m65_();
+  bool lock_m65_();
+  bool unlock_m65_();
+  char* address_m65_();
+  int size_m65_();
+
+  bool acquire_m65_();
+  bool release_m65_();
+
+  extern struct {
+    char c[10];
+  } m65com_;
+}
+
+bool attach_m65_() {return mem_m65.attach();}
+bool create_m65_(int nsize) {return mem_m65.create(nsize);}
+bool detach_m65_() {return mem_m65.detach();}
+bool lock_m65_() {return mem_m65.lock();}
+bool unlock_m65_() {return mem_m65.unlock();}
+char* address_m65_() {return (char*)mem_m65.constData();}
+int size_m65_() {return (int)mem_m65.size();}
+
+bool acquire_m65_() {return sem_m65.acquire();}
+bool release_m65_() {return sem_m65.release();}

Added: branches/map65/libm65/iqcal.f90
===================================================================
--- branches/map65/libm65/iqcal.f90	                        (rev 0)
+++ branches/map65/libm65/iqcal.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,30 @@
+subroutine iqcal(nn,c,nfft,gain,phase,zsum,ipk,reject)
+
+  complex c(0:nfft-1)
+  complex z,zsum,zave
+
+  if(nn.eq.0) then
+     zsum=0.
+  endif
+  nn=nn+1
+  smax=0.
+  ipk=1
+  do i=1,nfft-1                       !Find strongest signal
+     s=real(c(i))**2 + aimag(c(i))**2
+     if(s.gt.smax) then
+        smax=s
+        ipk=i
+     endif
+  enddo
+  pimage=real(c(nfft-ipk))**2 + aimag(c(nfft-ipk))**2
+  p=smax + pimage
+  z=c(ipk)*c(nfft-ipk)/p              !Synchronous detection of image
+  zsum=zsum+z
+  zave=zsum/nn
+  tmp=sqrt(1.0 - (2.0*real(zave))**2)
+  phase=asin(2.0*aimag(zave)/tmp)    !Estimate phase
+  gain=tmp/(1.0-2.0*real(zave))      !Estimate gain
+  reject=10.0*log10(pimage/smax)
+
+  return
+end subroutine iqcal

Added: branches/map65/libm65/iqfix.f90
===================================================================
--- branches/map65/libm65/iqfix.f90	                        (rev 0)
+++ branches/map65/libm65/iqfix.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,29 @@
+subroutine iqfix(c,nfft,gain,phase)
+
+  complex c(0:nfft-1)
+  complex z,h,u,v
+  real*8 sq1,sq2
+
+  nh=nfft/2
+  h=gain*cmplx(cos(phase),sin(phase))
+
+  do i=1,nh-1
+     u=c(i)
+     v=c(nfft-i)
+     x=real(u)  + real(v)  - (aimag(u) + aimag(v))*aimag(h) +         &amp;
+          (real(u) - real(v))*real(h)
+     y=aimag(u) - aimag(v) + (aimag(u) + aimag(v))*real(h)  +         &amp;
+          (real(u) - real(v))*aimag(h)
+     c(i)=0.5*cmplx(x,y)
+     z=u
+     u=v
+     v=z
+     x=real(u)  + real(v)  - (aimag(u) + aimag(v))*aimag(h) +         &amp;
+          (real(u) - real(v))*real(h)
+     y=aimag(u) - aimag(v) + (aimag(u) + aimag(v))*real(h)  +         &amp;
+          (real(u) - real(v))*aimag(h)
+     c(nfft-i)=0.5*cmplx(x,y)
+  enddo
+
+  return
+end subroutine iqfix

Added: branches/map65/libm65/k2grid.f
===================================================================
--- branches/map65/libm65/k2grid.f	                        (rev 0)
+++ branches/map65/libm65/k2grid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,12 @@
+      subroutine k2grid(k,grid)
+      character grid*6
+
+      nlong=2*mod((k-1)/5,90)-179
+      if(k.gt.450) nlong=nlong+180
+      nlat=mod(k-1,5)+ 85
+      dlat=nlat
+      dlong=nlong
+      call deg2grid(dlong,dlat,grid)
+
+      return
+      end

Added: branches/map65/libm65/kvasd.exe
===================================================================
(Binary files differ)


Property changes on: branches/map65/libm65/kvasd.exe
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: branches/map65/libm65/m65.f90
===================================================================
--- branches/map65/libm65/m65.f90	                        (rev 0)
+++ branches/map65/libm65/m65.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,130 @@
+program m65
+
+! Decoder for map65.  Can run stand-alone, reading data from *.tf2 files;
+! or as the back end of map65, with data placed in a shared memory region.
+
+  parameter (NSMAX=60*96000)
+  parameter (NFFT=32768)
+  integer*2 i2(4,87)
+  real*8 hsym
+  real*4 ssz5a(NFFT)
+  logical*1 lstrong(0:1023)
+  common/tracer/limtrace,lu
+  real*8 fc0,fcenter
+  character*80 arg,infile
+  character mycall*12,hiscall*12,mygrid*6,hisgrid*6,datetime*20
+  common/datcom/dd(4,5760000),ss(4,322,NFFT),savg(4,NFFT),fc0,nutc0,junk(34)
+  common/npar/fcenter,nutc,idphi,mousedf,mousefqso,nagain,                &amp;
+       ndepth,ndiskdat,neme,newdat,nfa,nfb,nfcal,nfshift,                 &amp;
+       mcall3,nkeep,ntol,nxant,nrxlog,nfsample,nxpol,mode65,              &amp;
+       mycall,mygrid,hiscall,hisgrid,datetime
+
+  nargs=iargc()
+  if(nargs.lt.1) then
+     print*,'Usage: m65 [95238] file1 [file2 ...]'
+     print*,'       Reads data from *.tf2 files.'
+     print*,''
+     print*,'       m65 -s'
+     print*,'       Gets data from shared memory region.'
+     go to 999
+  endif
+  call getarg(1,arg)
+  if(arg(1:2).eq.'-s') then
+     call m65a
+     call ftnquit
+     go to 999
+  endif
+  nfsample=96000
+  nxpol=1
+  mode65=2
+  ifile1=1
+  if(arg.eq.'95238') then
+     nfsample=95238
+     call getarg(2,arg)
+     ifile1=2
+  endif
+
+  limtrace=0
+  lu=12
+  nfa=100
+  nfb=162
+  nfshift=6
+  ndepth=2
+  nfcal=344
+  idphi=-50
+  ntol=500
+  nkeep=10
+
+  call ftninit('.')
+
+  do ifile=ifile1,nargs
+     call getarg(ifile,infile)
+     open(10,file=infile,access='stream',status='old',err=998)
+     i1=index(infile,'.tf2')
+     read(infile(i1-4:i1-1),*,err=1) nutc0
+     go to 2
+1    nutc0=0
+2    hsym=2048.d0*96000.d0/11025.d0          !Samples per half symbol
+     nhsym0=-999
+     k=0
+     fcenter=144.125d0
+     mousedf=0
+     mousefqso=125
+     newdat=1
+     mycall='K1JT'
+
+     if(ifile.eq.ifile1) call timer('m65     ',0)
+     do irec=1,9999999
+        call timer('read_tf2',0)
+        read(10) i2
+        call timer('read_tf2',1)
+        
+        call timer('float   ',0)
+        do i=1,87
+           k=k+1
+           dd(1,k)=i2(1,i)
+           dd(2,k)=i2(2,i)
+           dd(3,k)=i2(3,i)
+           dd(4,k)=i2(4,i)
+        enddo
+        call timer('float   ',1)
+        nhsym=(k-2048)/hsym
+        if(nhsym.ge.1 .and. nhsym.ne.nhsym0) then
+           ndiskdat=1
+           nb=0
+! Emit signal readyForFFT
+           call timer('symspec ',0)
+           fgreen=-13.0
+           iqadjust=1
+           iqapply=1
+           nbslider=100
+           gainx=0.9962
+           gainy=1.0265
+           phasex=0.01426
+           phasey=-0.01195
+           call symspec(k,nxpol,ndiskdat,nb,nbslider,idphi,nfsample,fgreen,  &amp;
+                iqadjust,iqapply,gainx,gainy,phasex,phasey,rejectx,rejecty,  &amp;
+                pxdb,pydb,ssz5a,nkhz,ihsym,nzap,slimit,lstrong)
+           call timer('symspec ',1)
+           nhsym0=nhsym
+           if(ihsym.ge.278) go to 10
+        endif
+     enddo
+
+10   continue
+     if(iqadjust.ne.0) write(*,3002) rejectx,rejecty
+3002 format('Image rejection:',2f7.1,' dB')
+     nutc=nutc0
+     nstandalone=1
+     call decode0(dd,ss,savg,nstandalone,nfsample)
+  enddo
+
+  call timer('m65     ',1)
+  call timer('m65     ',101)
+  call ftnquit
+  go to 999
+
+998 print*,'Cannot open file:'
+  print*,infile
+
+999 end program m65

Added: branches/map65/libm65/m65a.F90
===================================================================
--- branches/map65/libm65/m65a.F90	                        (rev 0)
+++ branches/map65/libm65/m65a.F90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,97 @@
+subroutine m65a
+
+! NB: this interface block is required by g95, but must be omitted
+!     for gfortran.  (????)
+
+#ifndef UNIX
+  interface
+     function address_m65()
+     end function address_m65
+  end interface
+#endif
+  
+  integer*1 attach_m65,lock_m65,unlock_m65
+  integer size_m65
+  integer*1, pointer :: address_m65,p_m65
+  character*80 cwd
+  logical fileExists
+  common/tracer/limtrace,lu
+
+  call getcwd(cwd)
+  call ftninit(trim(cwd))
+  limtrace=0
+  lu=12
+  i1=attach_m65()
+
+10 inquire(file=trim(cwd)//'/.lock',exist=fileExists)
+  if(fileExists) then
+     call sleep_msec(100)
+     go to 10
+  endif
+
+  inquire(file=trim(cwd)//'/.quit',exist=fileExists)
+  if(fileExists) then
+     call ftnquit
+     i=detach_m65()
+     go to 999
+  endif
+  
+  nbytes=size_m65()
+  if(nbytes.le.0) then
+     print*,'m65a: Shared memory mem_m65 does not exist.' 
+     print*,'Program m65a should be started automatically from within map65.'
+     go to 999
+  endif
+  p_m65=&gt;address_m65()
+  call m65b(p_m65,nbytes)
+
+  write(*,1010) 
+1010 format('&lt;m65aFinished&gt;')
+  flush(6)
+
+100 inquire(file=trim(cwd)//'/.lock',exist=fileExists)
+  if(fileExists) go to 10
+  call sleep_msec(100)
+  go to 100
+
+999 return
+end subroutine m65a
+
+subroutine m65b(m65com,nbytes)
+  integer*1 m65com(0:nbytes-1)
+  kss=4*4*60*96000
+  ksavg=kss+4*4*322*32768
+  kfcenter=ksavg+4*4*32768
+ call m65c(m65com(0),m65com(kss),m65com(ksavg),m65com(kfcenter))
+  return
+end subroutine m65b
+
+subroutine m65c(dd,ss,savg,nparams0)
+  integer*1 detach_m65
+  real*4 dd(4,5760000),ss(4,322,32768),savg(4,32768)
+  real*8 fcenter
+  integer nparams0(37),nparams(37)
+  character*12 mycall,hiscall
+  character*6 mygrid,hisgrid
+  character*20 datetime
+  common/npar/fcenter,nutc,idphi,mousedf,mousefqso,nagain,              &amp;
+       ndepth,ndiskdat,neme,newdat,nfa,nfb,nfcal,nfshift,               &amp;
+       mcall3,nkeep,ntol,nxant,nrxlog,nfsample,nxpol,mode65,            &amp;
+       mycall,mygrid,hiscall,hisgrid,datetime
+  equivalence (nparams,fcenter)
+  
+  nparams=nparams0                     !Copy parameters into common/npar/
+  npatience=1
+  if(iand(nrxlog,1).ne.0) then
+     write(21,1000) datetime(:17)
+1000 format(/'UTC Date: 'a17/78('-'))
+     flush(21)
+  endif
+  if(iand(nrxlog,2).ne.0) rewind 21
+  if(iand(nrxlog,4).ne.0) rewind 26
+
+  nstandalone=0
+  if(sum(nparams).ne.0) call decode0(dd,ss,savg,nstandalone)
+
+  return
+end subroutine m65c

Added: branches/map65/libm65/map65a.f90
===================================================================
--- branches/map65/libm65/map65a.f90	                        (rev 0)
+++ branches/map65/libm65/map65a.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,438 @@
+subroutine map65a(dd,ss,savg,newdat,nutc,fcenter,ntol,idphi,nfa,nfb,        &amp;
+     mousedf,mousefqso,nagain,ndecdone,ndiskdat,nfshift,ndphi,              &amp;
+     nfcal,nkeep,mcall3b,nsave,nxant,rmsdd,mycall,mygrid,                    &amp;
+     neme,ndepth,hiscall,hisgrid,nhsym,nfsample,nxpol,mode65)
+
+!  Processes timf2 data from Linrad to find and decode JT65 signals.
+
+  parameter (MAXMSG=1000)            !Size of decoded message list
+  parameter (NSMAX=60*96000)
+  parameter (NFFT=32768)
+  real dd(4,NSMAX)
+  real*4 ss(4,322,NFFT),savg(4,NFFT)
+  real tavg(-50:50)                  !Temp for finding local base level
+  real base(4)                       !Local basel level at 4 pol'ns
+  real tmp (200)                     !Temp storage for pctile sorting
+  real sig(MAXMSG,30)                !Parameters of detected signals
+  real a(5)
+  real*8 fcenter
+  character*22 msg(MAXMSG)
+  character*3 shmsg0(4)
+  character mycall*12,hiscall*12,mygrid*6,hisgrid*6,grid*6,cp*1
+  integer indx(MAXMSG),nsiz(MAXMSG)
+  logical done(MAXMSG)
+  logical xpol
+  character decoded*22,blank*22
+  real short(3,NFFT)                 !SNR dt ipol for potential shorthands
+  real qphi(12)
+  common/c3com/ mcall3a
+  common/testcom/ifreq
+  
+  data blank/'                      '/
+  data shmsg0/'ATT','RO ','RRR','73 '/
+  data nfile/0/,nutc0/-999/,nid/0/,ip000/1/,ip001/1/,mousefqso0/-999/
+  save
+
+  mcall3a=mcall3b
+  mousefqso0=mousefqso
+  xpol=(nxpol.ne.0)
+  if(.not.xpol) ndphi=0
+
+!### Should use AppDir! ###
+!  open(23,file='release/CALL3.TXT',status='unknown')
+  open(23,file='CALL3.TXT',status='unknown')
+
+  if(nutc.ne.nutc0) nfile=nfile+1
+  nutc0=nutc
+  df=96000.0/NFFT                     !df = 96000/NFFT = 2.930 Hz
+  if(nfsample.eq.95238) df=95238.1/NFFT
+  ftol=0.010                          !Frequency tolerance (kHz)
+  dphi=idphi/57.2957795
+  foffset=0.001*(1270 + nfcal)              !Offset from sync tone, plus CAL
+  fqso=mousefqso + foffset - 0.5*(nfa+nfb) + nfshift !fqso at baseband (khz)
+  iloop=0
+
+2  if(ndphi.eq.1) dphi=30*iloop/57.2957795
+
+  do nqd=1,0,-1
+     if(nqd.eq.1) then                     !Quick decode, at fQSO
+        fa=1000.0*(fqso+0.001*mousedf) - ntol
+        fb=1000.0*(fqso+0.001*mousedf) + ntol + 4*53.8330078
+     else                                  !Wideband decode at all freqs
+        fa=-1000*0.5*(nfb-nfa) + 1000*nfshift
+        fb= 1000*0.5*(nfb-nfa) + 1000*nfshift
+     endif
+     ia=nint(fa/df) + 16385
+     ib=nint(fb/df) + 16385
+     ia=max(51,ia)
+     ib=min(32768-51,ib)
+
+     km=0
+     nkm=1
+     nz=n/8
+     freq0=-999.
+     sync10=-999.
+     fshort0=-999.
+     syncshort0=-999.
+     ntry=0
+     short=0.                                 !Zero the whole short array
+     jpz=1
+     if(xpol) jpz=4
+
+     do i=ia,ib                               !Search over freq range
+        freq=0.001*(i-16385)*df
+!  Find the local base level for each polarization; update every 10 bins.
+        if(mod(i-ia,10).eq.0) then
+           do jp=1,jpz
+              do ii=-50,50
+                 iii=i+ii
+                 if(iii.ge.1 .and. iii.le.32768) then
+                    tavg(ii)=savg(jp,iii)
+                 else
+                    write(13,*) ,'Error in iii:',iii,ia,ib,fa,fb
+                    flush(13)
+                    go to 999
+                 endif
+              enddo
+              call pctile(tavg,tmp,101,50,base(jp))
+           enddo
+        endif
+
+!  Find max signal at this frequency
+        smax=0.
+        do jp=1,jpz
+           if(savg(jp,i)/base(jp).gt.smax) then
+              smax=savg(jp,i)/base(jp)
+              jpmax=jp
+           endif
+        enddo
+
+        if(smax.gt.1.1) then
+
+!  Look for JT65 sync patterns and shorthand square-wave patterns.
+           call timer('ccf65   ',0)
+!           ssmax=4.0*(rmsdd/22.5)**2
+           ssmax=savg(jpmax,i)
+           call ccf65(ss(1,1,i),nhsym,ssmax,sync1,ipol,jpz,dt,flipk,     &amp;
+                syncshort,snr2,ipol2,dt2)
+           call timer('ccf65   ',1)
+
+! ########################### Search for Shorthand Messages #################
+!  Is there a shorthand tone above threshold?
+           thresh0=1.0
+!  Use lower thresh0 at fQSO
+           if(nqd.eq.1 .and. ntol.le.100) thresh0=0.
+           if(syncshort.gt.thresh0) then
+! ### Do shorthand AFC here (or maybe after finding a pair?) ###
+              short(1,i)=syncshort
+              short(2,i)=dt2
+              short(3,i)=ipol2
+           
+!  Check to see if lower tone of shorthand pair was found.
+              do j=2,4
+                 i0=i-nint(j*mode65*10.0*(11025.0/4096.0)/df)
+!  Should this be i0 +/- 1, or just i0?
+!  Should we also insist that difference in DT be either 1.5 or -1.5 s?
+                 if(short(1,i0).gt.thresh0) then
+                    fshort=0.001*(i0-16385)*df
+                    noffset=0
+                    if(nqd.eq.1) noffset=nint(1000.0*(fshort-fqso)-mousedf)
+                    if(abs(noffset).le.ntol) then
+!  Keep only the best candidate within ftol.
+!### NB: sync2 was not defined here!
+!                       sync2=syncshort                   !### try this ???
+                       if(fshort-fshort0.le.ftol .and. syncshort.gt.syncshort0 &amp;
+                            .and. nkm.eq.2) km=km-1
+                       if(fshort-fshort0.gt.ftol .or.                     &amp;
+                            syncshort.gt.syncshort0) then
+                          if(km.lt.MAXMSG) km=km+1
+                          sig(km,1)=nfile
+                          sig(km,2)=nutc
+                          sig(km,3)=fshort + 0.5*(nfa+nfb)
+                          sig(km,4)=syncshort
+                          sig(km,5)=dt2
+                          sig(km,6)=45*(ipol2-1)/57.2957795
+                          sig(km,7)=0
+                          sig(km,8)=snr2
+                          sig(km,9)=0
+                          sig(km,10)=0
+!                           sig(km,11)=rms0
+                          sig(km,12)=savg(ipol2,i)
+                          sig(km,13)=0
+                          sig(km,14)=0
+                          sig(km,15)=0
+                          sig(km,16)=0
+!                           sig(km,17)=0
+                          sig(km,18)=0
+                          msg(km)=shmsg0(j)
+                          fshort0=fshort
+                          syncshort0=syncshort
+                          nkm=2
+                       endif
+                    endif
+                 endif
+              enddo
+           endif
+
+! ########################### Search for Normal Messages ###########
+!  Is sync1 above threshold?
+           thresh1=1.0
+!  Use lower thresh1 at fQSO
+           if(nqd.eq.1 .and. ntol.le.100) thresh1=0.
+           noffset=0
+           if(nqd.eq.1) noffset=nint(1000.0*(freq-fqso)-mousedf)
+
+           if(sync1.gt.thresh1 .and. abs(noffset).le.ntol) then
+!  Keep only the best candidate within ftol.
+!  (Am I deleting any good decodes by doing this?)
+              if(freq-freq0.le.ftol .and. sync1.gt.sync10 .and.       &amp;
+                   nkm.eq.1) km=km-1
+              if(freq-freq0.gt.ftol .or. sync1.gt.sync10) then
+                 nflip=nint(flipk)
+                 f00=(i-1)*df          !Freq of detected sync tone (0-96000 Hz)
+                 ntry=ntry+1
+                 if((nqd.eq.1 .and. ntry.ge.40) .or.                  &amp;
+                          (nqd.eq.0 .and. ntry.ge.400)) then
+! Too many calls to decode1a!
+                    write(*,*) '! Signal too strong?  Decoding aborted.'
+                    write(13,*) 'Signal too strong?  Decoding aborted.'
+                    call flush(13)
+                    go to 999
+                 endif
+                 call timer('decode1a',0)
+                 ifreq=i
+                 ikHz=nint(freq+0.5*(nfa+nfb)-foffset)-nfshift
+                 idf=nint(1000.0*(freq+0.5*(nfa+nfb)-foffset-(ikHz+nfshift)))
+                 call decode1a(dd,newdat,f00,nflip,mode65,nfsample,xpol,  &amp;
+                      mycall,hiscall,hisgrid,neme,ndepth,nqd,dphi,        &amp;
+                      nutc,ikHz,idf,ipol,sync2,a,dt,pol,nkv,nhist,qual,decoded)
+                 dt=dt+0.8                           !### empirical tweak
+                 call timer('decode1a',1)
+
+                 if(km.lt.MAXMSG) km=km+1
+                 sig(km,1)=nfile
+                 sig(km,2)=nutc
+                 sig(km,3)=freq + 0.5*(nfa+nfb)
+                 sig(km,4)=sync1
+                 sig(km,5)=dt
+                 sig(km,6)=pol
+                 sig(km,7)=flipk
+                 sig(km,8)=sync2
+                 sig(km,9)=nkv
+                 sig(km,10)=qual
+!                 sig(km,11)=idphi
+                 sig(km,12)=savg(ipol,i)
+                 sig(km,13)=a(1)
+                 sig(km,14)=a(2)
+                 sig(km,15)=a(3)
+                 sig(km,16)=a(4)
+!                     sig(km,17)=a(5)
+                 sig(km,18)=nhist
+                 msg(km)=decoded
+                 freq0=freq
+                 sync10=sync1
+                 nkm=1
+              endif
+           endif
+        endif
+!70      continue
+     enddo
+
+     if(nqd.eq.1) then
+        nwrite=0
+        do k=1,km
+           decoded=msg(k)
+           if(decoded.ne.'                      ') then
+              nutc=sig(k,2)
+              freq=sig(k,3)
+              sync1=sig(k,4)
+              dt=sig(k,5)
+              npol=nint(57.2957795*sig(k,6))
+              flip=sig(k,7)
+              sync2=sig(k,8)
+              nkv=sig(k,9)
+              nqual=sig(k,10)
+!              idphi=nint(sig(k,11))
+              if(flip.lt.0.0) then
+                 do i=22,1,-1
+                    if(decoded(i:i).ne.' ') go to 8
+                 enddo
+                 stop 'Error in message format'
+8                if(i.le.18) decoded(i+2:i+4)='OOO'
+              endif
+              nkHz=nint(freq-foffset)-nfshift
+              mhz=fcenter                         ! ... +fadd ???
+              f0=mhz+0.001*nkHz
+              ndf=nint(1000.0*(freq-foffset-(nkHz+nfshift)))
+              nsync1=sync1
+              nsync2=nint(10.0*log10(sync2)) - 40 !### empirical ###
+              if(decoded(1:4).eq.'RO  ' .or. decoded(1:4).eq.'RRR  ' .or.  &amp;
+                   decoded(1:4).eq.'73  ') nsync2=nsync2-6
+              nwrite=nwrite+1
+              if(nxant.ne.0) then
+                 npol=npol-45
+                 if(npol.lt.0) npol=npol+180
+              endif
+
+!  If Tx station's grid is in decoded message, compute optimum TxPol
+              i1=index(decoded,' ')
+              i2=index(decoded(i1+1:),' ') + i1
+              grid='      '
+              if(i2.ge.8 .and. i2.le.18) grid=decoded(i2+1:i2+4)//'mm'
+              ntxpol=0
+              cp=' '
+              if(xpol) then
+                 if(grid(1:1).ge.'A' .and. grid(1:1).le.'R' .and.           &amp;
+                      grid(2:2).ge.'A' .and. grid(2:2).le.'R' .and.         &amp;
+                      grid(3:3).ge.'0' .and. grid(3:3).le.'9' .and.         &amp;
+                      grid(4:4).ge.'0' .and. grid(4:4).le.'9') then                 
+                    ntxpol=mod(npol-nint(2.0*dpol(mygrid,grid))+720,180)
+                    if(nxant.eq.0) then
+                       cp='H'
+                       if(ntxpol.gt.45 .and. ntxpol.le.135) cp='V'
+                    else
+                       cp='/'
+                       if(ntxpol.ge.90 .and. ntxpol.lt.180) cp='\\'
+                    endif
+                 endif
+              endif
+              
+              if(ndphi.eq.0) then
+                 write(*,1010) nkHz,ndf,npol,nutc,dt,nsync2,    &amp;
+                      decoded,nkv,nqual,ntxpol,cp
+1010             format('!',i3,i5,i4,i5.4,f5.1,i4,2x,a22,i5,i4,i5,1x,a1)
+              else
+                 if(iloop.ge.1) qphi(iloop)=sig(k,10)
+                 write(*,1010) nkHz,ndf,npol,nutc,dt,nsync2,    &amp;
+                      decoded,nkv,nqual,30*iloop
+                 write(27,1011) 30*iloop,nkHz,ndf,npol,nutc,  &amp;
+                      dt,sync2,nkv,nqual,decoded
+1011             format(i3,i4,i5,i4,i5.4,f5.1,f7.1,i3,i5,2x,a22)
+              endif
+           endif
+        enddo
+
+        if(nwrite.eq.0) then
+           write(*,1012) mousefqso,nutc
+1012       format('!',i3,9x,i5.4,' ')
+        endif
+   
+     endif
+     if(ndphi.eq.1 .and.iloop.lt.12) then
+        iloop=iloop+1
+        go to 2
+     endif
+     
+     if(ndphi.eq.1 .and.iloop.eq.12) call getdphi(qphi)
+     if(nagain.eq.1) go to 999
+  enddo
+
+!  Trim the list and produce a sorted index and sizes of groups.
+!  (Should trimlist remove all but best SNR for given UTC and message content?)
+  call trimlist(sig,km,ftol,indx,nsiz,nz)
+
+  do i=1,km
+     done(i)=.false.
+  enddo
+  j=0
+  ilatest=-1
+  do n=1,nz
+     ifile0=0
+     do m=1,nsiz(n)
+        i=indx(j+m)
+        ifile=sig(i,1)
+        if(ifile.gt.ifile0 .and.msg(i).ne.blank) then
+           ilatest=i
+           ifile0=ifile
+        endif
+     enddo
+     i=ilatest
+
+     if(i.ge.1) then
+        if(.not.done(i)) then
+           done(i)=.true.
+           nutc=sig(i,2)
+           freq=sig(i,3)
+           sync1=sig(i,4)
+           dt=sig(i,5)
+           npol=nint(57.2957795*sig(i,6))
+           flip=sig(i,7)
+           sync2=sig(i,8)
+           nkv=sig(i,9)
+           nqual=min(sig(i,10),10.0)
+!                  rms0=sig(i,11)
+           do k=1,5
+              a(k)=sig(i,12+k)
+           enddo
+           nhist=sig(i,18)
+           decoded=msg(i)
+           
+           if(flip.lt.0.0) then
+              do i=22,1,-1
+                 if(decoded(i:i).ne.' ') go to 10
+              enddo
+              stop 'Error in message format'
+10            if(i.le.18) decoded(i+2:i+4)='OOO'
+           endif
+           mhz=fcenter                             !... +fadd ???
+           nkHz=nint(freq-foffset)-nfshift
+           f0=mhz+0.001*nkHz
+           ndf=nint(1000.0*(freq-foffset-(nkHz+nfshift)))
+           ndf0=nint(a(1))
+           ndf1=nint(a(2))
+           ndf2=nint(a(3))
+           nsync1=sync1
+           nsync2=nint(10.0*log10(sync2)) - 40 !### empirical ###
+           if(decoded(1:4).eq.'RO  ' .or. decoded(1:4).eq.'RRR  ' .or.  &amp;
+                decoded(1:4).eq.'73  ') nsync2=nsync2-6
+           if(nxant.ne.0) then
+              npol=npol-45
+              if(npol.lt.0) npol=npol+180
+           endif
+
+!  If Tx station's grid is in decoded message, compute optimum TxPol
+           i1=index(decoded,' ')
+           i2=index(decoded(i1+1:),' ') + i1
+           grid='      '
+           if(i2.ge.8 .and. i2.le.18) grid=decoded(i2+1:i2+4)//'mm'
+           ntxpol=0
+           cp=' '
+           if(xpol) then
+              if(grid(1:1).ge.'A' .and. grid(1:1).le.'R' .and.           &amp;
+                   grid(2:2).ge.'A' .and. grid(2:2).le.'R' .and.         &amp;
+                   grid(3:3).ge.'0' .and. grid(3:3).le.'9' .and.         &amp;
+                   grid(4:4).ge.'0' .and. grid(4:4).le.'9') then                 
+                 ntxpol=mod(npol-nint(2.0*dpol(mygrid,grid))+720,180)
+                 if(nxant.eq.0) then
+                    cp='H'
+                    if(ntxpol.gt.45 .and. ntxpol.le.135) cp='V'
+                 else
+                    cp='/'
+                    if(ntxpol.ge.90 .and. ntxpol.lt.180) cp='\\'
+                 endif
+              endif
+           endif
+           write(26,1014) f0,ndf,ndf0,ndf1,ndf2,dt,npol,nsync1,       &amp;
+                nsync2,nutc,decoded,nkv,nqual,nhist,cp
+           write(21,1014) f0,ndf,ndf0,ndf1,ndf2,dt,npol,nsync1,       &amp;
+                nsync2,nutc,decoded,nkv,nqual,nhist
+1014       format(f8.3,i5,3i3,f5.1,i4,i3,i4,i5.4,2x,a22,3i3,1x,a1)
+
+        endif
+     endif
+     j=j+nsiz(n)
+  enddo
+  write(26,1015) nutc
+1015 format(39x,i4.4)
+  call flush(21)
+  call flush(26)
+  call display(nkeep,ftol)
+  ndecdone=2
+
+999 close(23)
+  ndphi=0
+  nagain=0
+  mcall3b=mcall3a
+
+  return
+end subroutine map65a

Added: branches/map65/libm65/moon2.f
===================================================================
--- branches/map65/libm65/moon2.f	                        (rev 0)
+++ branches/map65/libm65/moon2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,167 @@
+      subroutine moon2(y,m,Day,UT,lon,lat,RA,Dec,topRA,topDec,
+     +  LST,HA,Az,El,dist)
+
+      implicit none
+
+      integer y                           !Year
+      integer m                           !Month
+      integer Day                         !Day
+      real*8 UT                           !UTC in hours
+      real*8 RA,Dec                       !RA and Dec of moon
+
+C  NB: Double caps are single caps in the writeup.
+
+      real*8 NN                           !Longitude of ascending node
+      real*8 i                            !Inclination to the ecliptic
+      real*8 w                            !Argument of perigee
+      real*8 a                            !Semi-major axis
+      real*8 e                            !Eccentricity
+      real*8 MM                           !Mean anomaly
+
+      real*8 v                            !True anomaly
+      real*8 EE                           !Eccentric anomaly
+      real*8 ecl                          !Obliquity of the ecliptic
+
+      real*8 d                            !Ephemeris time argument in days
+      real*8 r                            !Distance to sun, AU
+      real*8 xv,yv                        !x and y coords in ecliptic
+      real*8 lonecl,latecl                !Ecliptic long and lat of moon
+      real*8 xg,yg,zg                     !Ecliptic rectangular coords
+      real*8 Ms                           !Mean anomaly of sun
+      real*8 ws                           !Argument of perihelion of sun
+      real*8 Ls                           !Mean longitude of sun (Ns=0)
+      real*8 Lm                           !Mean longitude of moon
+      real*8 DD                           !Mean elongation of moon
+      real*8 FF                           !Argument of latitude for moon
+      real*8 xe,ye,ze                     !Equatorial geocentric coords of moon
+      real*8 mpar                         !Parallax of moon (r_E / d)
+      real*8 lat,lon                      !Station coordinates on earth
+      real*8 gclat                        !Geocentric latitude
+      real*8 rho                          !Earth radius factor
+      real*8 GMST0,LST,HA
+      real*8 g
+      real*8 topRA,topDec                 !Topocentric coordinates of Moon
+      real*8 Az,El
+      real*8 dist
+
+      real*8 rad,twopi,pi,pio2
+      data rad/57.2957795131d0/,twopi/6.283185307d0/
+
+      d=367*y - 7*(y+(m+9)/12)/4 + 275*m/9 + Day - 730530 + UT/24.d0
+      ecl = 23.4393d0 - 3.563d-7 * d
+
+C  Orbital elements for Moon:  
+      NN = 125.1228d0 - 0.0529538083d0 * d
+      i = 5.1454d0
+      w = mod(318.0634d0 + 0.1643573223d0 * d + 360000.d0,360.d0)
+      a = 60.2666d0
+      e = 0.054900d0
+      MM = mod(115.3654d0 + 13.0649929509d0 * d + 360000.d0,360.d0)
+
+      EE = MM + e*rad*sin(MM/rad) * (1.d0 + e*cos(MM/rad))
+      EE = EE - (EE - e*rad*sin(EE/rad)-MM) / (1.d0 - e*cos(EE/rad))
+      EE = EE - (EE - e*rad*sin(EE/rad)-MM) / (1.d0 - e*cos(EE/rad))
+
+      xv = a * (cos(EE/rad) - e)
+      yv = a * (sqrt(1.d0-e*e) * sin(EE/rad))
+
+      v = mod(rad*atan2(yv,xv)+720.d0,360.d0)
+      r = sqrt(xv*xv + yv*yv)
+
+C  Get geocentric position in ecliptic rectangular coordinates:
+
+      xg = r * (cos(NN/rad)*cos((v+w)/rad) -
+     +          sin(NN/rad)*sin((v+w)/rad)*cos(i/rad))
+      yg = r * (sin(NN/rad)*cos((v+w)/rad) + 
+     +          cos(NN/rad)*sin((v+w)/rad)*cos(i/rad))
+      zg = r * (sin((v+w)/rad)*sin(i/rad))
+
+C  Ecliptic longitude and latitude of moon:
+      lonecl = mod(rad*atan2(yg/rad,xg/rad)+720.d0,360.d0)
+      latecl = rad*atan2(zg/rad,sqrt(xg*xg + yg*yg)/rad)
+
+C  Now include orbital perturbations:
+      Ms = mod(356.0470d0 + 0.9856002585d0 * d + 3600000.d0,360.d0)
+      ws = 282.9404d0 + 4.70935d-5*d
+      Ls = mod(Ms + ws + 720.d0,360.d0)
+      Lm = mod(MM + w + NN+720.d0,360.d0)
+      DD = mod(Lm - Ls + 360.d0,360.d0)
+      FF = mod(Lm - NN + 360.d0,360.d0)
+
+      lonecl = lonecl 
+     +  -1.274d0 * sin((MM-2.d0*DD)/rad)
+     +  +0.658d0 * sin(2.d0*DD/rad)
+     +  -0.186d0 * sin(Ms/rad)
+     +  -0.059d0 * sin((2.d0*MM-2.d0*DD)/rad)
+     +  -0.057d0 * sin((MM-2.d0*DD+Ms)/rad)
+     +  +0.053d0 * sin((MM+2.d0*DD)/rad)
+     +  +0.046d0 * sin((2.d0*DD-Ms)/rad)
+     +  +0.041d0 * sin((MM-Ms)/rad)
+     +  -0.035d0 * sin(DD/rad)
+     +  -0.031d0 * sin((MM+Ms)/rad)
+     +  -0.015d0 * sin((2.d0*FF-2.d0*DD)/rad)
+     +  +0.011d0 * sin((MM-4.d0*DD)/rad)
+
+      latecl = latecl
+     +  -0.173d0 * sin((FF-2.d0*DD)/rad)
+     +  -0.055d0 * sin((MM-FF-2.d0*DD)/rad)
+     +  -0.046d0 * sin((MM+FF-2.d0*DD)/rad)
+     +  +0.033d0 * sin((FF+2.d0*DD)/rad)
+     +  +0.017d0 * sin((2.d0*MM+FF)/rad)
+
+      r = 60.36298d0
+     +  - 3.27746d0*cos(MM/rad)
+     +  - 0.57994d0*cos((MM-2.d0*DD)/rad)
+     +  - 0.46357d0*cos(2.d0*DD/rad)
+     +  - 0.08904d0*cos(2.d0*MM/rad)
+     +  + 0.03865d0*cos((2.d0*MM-2.d0*DD)/rad)
+     +  - 0.03237d0*cos((2.d0*DD-Ms)/rad)
+     +  - 0.02688d0*cos((MM+2.d0*DD)/rad)
+     +  - 0.02358d0*cos((MM-2.d0*DD+Ms)/rad)
+     +  - 0.02030d0*cos((MM-Ms)/rad)
+     +  + 0.01719d0*cos(DD/rad)
+     +  + 0.01671d0*cos((MM+Ms)/rad)
+
+      dist=r*6378.140d0
+
+C  Geocentric coordinates:
+C  Rectangular ecliptic coordinates of the moon:
+
+      xg = r * cos(lonecl/rad)*cos(latecl/rad)
+      yg = r * sin(lonecl/rad)*cos(latecl/rad)
+      zg = r *                 sin(latecl/rad)
+
+C  Rectangular equatorial coordinates of the moon:
+      xe = xg
+      ye = yg*cos(ecl/rad) - zg*sin(ecl/rad)
+      ze = yg*sin(ecl/rad) + zg*cos(ecl/rad)
+   
+C  Right Ascension, Declination:
+      RA = mod(rad*atan2(ye,xe)+360.d0,360.d0)
+      Dec = rad*atan2(ze,sqrt(xe*xe + ye*ye))
+
+C  Now convert to topocentric system:
+      mpar=rad*asin(1.d0/r)
+C      alt_topoc = alt_geoc - mpar*cos(alt_geoc)
+      gclat = lat - 0.1924d0*sin(2.d0*lat/rad)
+      rho = 0.99883d0 + 0.00167d0*cos(2.d0*lat/rad)
+      GMST0 = (Ls + 180.d0)/15.d0
+      LST = mod(GMST0+UT+lon/15.d0+48.d0,24.d0)    !LST in hours
+      HA = 15.d0*LST - RA                          !HA in degrees
+      g = rad*atan(tan(gclat/rad)/cos(HA/rad))
+      topRA = RA - mpar*rho*cos(gclat/rad)*sin(HA/rad)/cos(Dec/rad)
+      topDec = Dec - mpar*rho*sin(gclat/rad)*sin((g-Dec)/rad)/sin(g/rad)
+
+      HA = 15.d0*LST - topRA                       !HA in degrees
+      if(HA.gt.180.d0) HA=HA-360.d0
+      if(HA.lt.-180.d0) HA=HA+360.d0
+
+      pi=0.5d0*twopi
+      pio2=0.5d0*pi
+      call dcoord(pi,pio2-lat/rad,0.d0,lat/rad,ha*twopi/360,
+     +  topDec/rad,az,el)
+      Az=az*rad
+      El=El*rad
+
+      return
+      end

Added: branches/map65/libm65/moondop.f
===================================================================
--- branches/map65/libm65/moondop.f	                        (rev 0)
+++ branches/map65/libm65/moondop.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,73 @@
+      subroutine MoonDop(nyear,month,nday,uth4,lon4,lat4,RAMoon4,
+     +  DecMoon4,LST4,HA4,AzMoon4,ElMoon4,vr4,dist4)
+
+      implicit real*8 (a-h,o-z)
+      real*4 uth4                    !UT in hours
+      real*4 lon4                    !West longitude, degrees
+      real*4 lat4                    !Latitude, degrees
+      real*4 RAMoon4                 !Topocentric RA of moon, hours
+      real*4 DecMoon4                !Topocentric Dec of Moon, degrees
+      real*4 LST4                    !Locat sidereal time, hours
+      real*4 HA4                     !Local Hour angle, degrees
+      real*4 AzMoon4                 !Topocentric Azimuth of moon, degrees
+      real*4 ElMoon4                 !Topocentric Elevation of moon, degrees
+      real*4 vr4                     !Radial velocity of moon wrt obs, km/s
+      real*4 dist4                   !Echo time, seconds
+
+      real*8 LST
+      real*8 RME(6)                  !Vector from Earth center to Moon
+      real*8 RAE(6)                  !Vector from Earth center to Obs
+      real*8 RMA(6)                  !Vector from Obs to Moon
+      real*8 pvsun(6)
+      real*8 rme0(6)
+      logical km,bary
+
+      data rad/57.2957795130823d0/,twopi/6.28310530717959d0/
+
+      km=.true.
+      dlat=lat4/rad
+      dlong1=lon4/rad
+      elev1=200.d0
+      call geocentric(dlat,elev1,dlat1,erad1)
+
+      dt=100.d0                       !For numerical derivative, in seconds
+      UT=uth4
+
+C  NB: geodetic latitude used here, but geocentric latitude used when 
+C  determining Earth-rotation contribution to Doppler.
+
+      call moon2(nyear,month,nDay,UT-dt/3600.d0,dlong1*rad,dlat*rad,
+     +  RA,Dec,topRA,topDec,LST,HA,Az0,El0,dist)
+      call toxyz(RA/rad,Dec/rad,dist,rme0)      !Convert to rectangular coords
+
+      call moon2(nyear,month,nDay,UT,dlong1*rad,dlat*rad,
+     +  RA,Dec,topRA,topDec,LST,HA,Az,El,dist)
+      call toxyz(RA/rad,Dec/rad,dist,rme)       !Convert to rectangular coords
+
+      phi=LST*twopi/24.d0
+      call toxyz(phi,dlat1,erad1,rae)           !Gencentric numbers used here!
+      radps=twopi/(86400.d0/1.002737909d0)
+      rae(4)=-rae(2)*radps                      !Vel of Obs wrt Earth center
+      rae(5)=rae(1)*radps
+      rae(6)=0.d0
+
+      do i=1,3
+         rme(i+3)=(rme(i)-rme0(i))/dt
+         rma(i)=rme(i)-rae(i)
+         rma(i+3)=rme(i+3)-rae(i+3)
+      enddo
+
+      call fromxyz(rma,alpha1,delta1,dtopo0)     !Get topocentric coords
+      vr=dot(rma(4),rma)/dtopo0
+
+      RAMoon4=topRA
+      DecMoon4=topDec
+      LST4=LST
+      HA4=HA
+      AzMoon4=Az
+      ElMoon4=El
+      vr4=vr
+      dist4=dist
+
+      return
+      end

Added: branches/map65/libm65/nchar.f
===================================================================
--- branches/map65/libm65/nchar.f	                        (rev 0)
+++ branches/map65/libm65/nchar.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,23 @@
+      function nchar(c)
+
+C  Convert ascii number, letter, or space to 0-36 for callsign packing.
+
+      character c*1
+
+      n=0                                    !Silence compiler warning
+      if(c.ge.'0' .and. c.le.'9') then
+         n=ichar(c)-ichar('0')
+      else if(c.ge.'A' .and. c.le.'Z') then
+         n=ichar(c)-ichar('A') + 10
+      else if(c.ge.'a' .and. c.le.'z') then
+         n=ichar(c)-ichar('a') + 10
+      else if(c.ge.' ') then
+         n=36
+      else
+         Print*,'Invalid character in callsign ',c,' ',ichar(c)
+         stop
+      endif
+      nchar=n
+
+      return
+      end

Added: branches/map65/libm65/packcall.f
===================================================================
--- branches/map65/libm65/packcall.f	                        (rev 0)
+++ branches/map65/libm65/packcall.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,79 @@
+      subroutine packcall(callsign,ncall,text)
+
+C  Pack a valid callsign into a 28-bit integer.
+
+      parameter (NBASE=37*36*10*27*27*27)
+      character callsign*6,c*1,tmp*6
+      logical text
+
+      text=.false.
+
+C  Work-around for Swaziland prefix:
+      if(callsign(1:4).eq.'3DA0') callsign='3D0'//callsign(5:6)
+
+      if(callsign(1:3).eq.'CQ ') then
+         ncall=NBASE + 1
+         if(callsign(4:4).ge.'0' .and. callsign(4:4).le.'9' .and. 
+     +      callsign(5:5).ge.'0' .and. callsign(5:5).le.'9' .and. 
+     +      callsign(6:6).ge.'0' .and. callsign(6:6).le.'9') then
+            read(callsign(4:6),*) nfreq
+            ncall=NBASE + 3 + nfreq
+         endif
+         return
+      else if(callsign(1:4).eq.'QRZ ') then
+         ncall=NBASE + 2
+         return
+      else if(callsign(1:3).eq.'DE ') then
+         ncall=267796945
+         return
+      endif
+
+      tmp='      '
+      if(callsign(3:3).ge.'0' .and. callsign(3:3).le.'9') then
+         tmp=callsign
+      else if(callsign(2:2).ge.'0' .and. callsign(2:2).le.'9') then
+         if(callsign(6:6).ne.' ') then
+            text=.true.
+            return
+         endif
+         tmp=' '//callsign(:5)
+      else
+         text=.true.
+         return
+      endif
+
+      do i=1,6
+         c=tmp(i:i)
+         if(c.ge.'a' .and. c.le.'z') 
+     +     tmp(i:i)=char(ichar(c)-ichar('a')+ichar('A'))
+      enddo
+
+      n1=0
+      if((tmp(1:1).ge.'A'.and.tmp(1:1).le.'Z').or.tmp(1:1).eq.' ') n1=1
+      if(tmp(1:1).ge.'0' .and. tmp(1:1).le.'9') n1=1
+      n2=0
+      if(tmp(2:2).ge.'A' .and. tmp(2:2).le.'Z') n2=1
+      if(tmp(2:2).ge.'0' .and. tmp(2:2).le.'9') n2=1
+      n3=0
+      if(tmp(3:3).ge.'0' .and. tmp(3:3).le.'9') n3=1
+      n4=0
+      if((tmp(4:4).ge.'A'.and.tmp(4:4).le.'Z').or.tmp(4:4).eq.' ') n4=1
+      n5=0
+      if((tmp(5:5).ge.'A'.and.tmp(5:5).le.'Z').or.tmp(5:5).eq.' ') n5=1
+      n6=0
+      if((tmp(6:6).ge.'A'.and.tmp(6:6).le.'Z').or.tmp(6:6).eq.' ') n6=1
+
+      if(n1+n2+n3+n4+n5+n6 .ne. 6) then
+         text=.true.
+         return 
+      endif
+
+      ncall=nchar(tmp(1:1))
+      ncall=36*ncall+nchar(tmp(2:2))
+      ncall=10*ncall+nchar(tmp(3:3))
+      ncall=27*ncall+nchar(tmp(4:4))-10
+      ncall=27*ncall+nchar(tmp(5:5))-10
+      ncall=27*ncall+nchar(tmp(6:6))-10
+
+      return
+      end

Added: branches/map65/libm65/packdxcc.f
===================================================================
--- branches/map65/libm65/packdxcc.f	                        (rev 0)
+++ branches/map65/libm65/packdxcc.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,64 @@
+      subroutine packdxcc(c,ng,ldxcc)
+
+      character*3 c
+      logical ldxcc
+
+      parameter (NZ=303)
+      character*5 pfx(NZ)
+      data pfx/
+     +  '1A   ','1S   ','3A   ','3B6  ','3B8  ','3B9  ','3C   ','3C0  ',
+     +  '3D2  ',                '3DA  ','3V   ','3W   ','3X   ','3Y   ',
+     +          '4J   ','4L   ','4S   ','4U1  ',                '4W   ',
+     +  '4X   ','5A   ','5B   ','5H   ','5N   ','5R   ','5T   ','5U   ',
+     +  '5V   ','5W   ','5X   ','5Z   ','6W   ','6Y   ','7O   ','7P   ',
+     +  '7Q   ','7X   ','8P   ','8Q   ','8R   ','9A   ','9G   ','9H   ',
+     +  '9J   ','9K   ','9L   ','9M2  ','9M6  ','9N   ','9Q   ','9U   ',
+     +  '9V   ','9X   ','9Y   ','A2   ','A3   ','A4   ','A5   ','A6   ',
+     +  'A7   ','A9   ','AP   ','BS7  ','BV   ','BV9  ','BY   ','C2   ',
+     +  'C3   ','C5   ','C6   ','C9   ','CE   ','CE0  ',                
+     +  'CE9  ','CM   ','CN   ','CP   ','CT   ','CT3  ','CU   ','CX   ',
+     +  'CY0  ','CY9  ','D2   ','D4   ','D6   ','DL   ','DU   ','E3   ',
+     +  'E4   ','EA   ','EA6  ','EA8  ','EA9  ','EI   ','EK   ','EL   ',
+     +  'EP   ','ER   ','ES   ','ET   ','EU   ','EX   ','EY   ','EZ   ',
+     +  'F    ','FG   ','FH   ','FJ   ','FK   ',        'FM   ','FO   ',
+     +                          'FP   ','FR   ',                        
+     +  'FT5  ',                'FW   ','FY   ','M    ','MD   ','MI   ',
+     +  'MJ   ','MM   ',        'MU   ','MW   ','H4   ','H40  ','HA   ',
+     +  'HB   ','HB0  ','HC   ','HC8  ','HH   ','HI   ','HK   ','HK0  ',
+     +          'HL   ','HM   ','HP   ','HR   ','HS   ','HV   ','HZ   ',
+     +  'I    ','IG9  ','IS   ','IT9  ','J2   ','J3   ','J5   ','J6   ',
+     +  'J7   ','J8   ','JA   ','JD   ',        'JT   ','JW   ',        
+     +  'JX   ','JY   ','K    ','KG4  ','KH0  ','KH1  ','KH2  ','KH3  ',
+     +  'KH4  ','KH5  ',        'KH6  ','KH7  ','KH8  ','KH9  ','KL   ',
+     +  'KP1  ','KP2  ','KP4  ','KP5  ','LA   ','LU   ','LX   ','LY   ',
+     +  'LZ   ','OA   ','OD   ','OE   ','OH   ','OH0  ','OJ0  ','OK   ',
+     +  'OM   ','ON   ','OX   ','OY   ','OZ   ','P2   ','P4   ','PA   ',
+     +  'PJ2  ','PJ7  ','PY   ','PY0  ',                'PZ   ','R1F  ',
+     +  'R1M  ','S0   ','S2   ','S5   ','S7   ','S9   ','SM   ','SP   ',
+     +  'ST   ','SU   ','SV   ',        'SV5  ','SV9  ','T2   ','T30  ',
+     +  'T31  ','T32  ','T33  ','T5   ','T7   ','T8   ','T9   ','TA   ',
+     +  'TA1  ','TF   ','TG   ','TI   ','TI9  ','TJ   ','TK   ','TL   ',
+     +  'TN   ','TR   ','TT   ','TU   ','TY   ','TZ   ','UA   ','UA2  ',
+     +  'UA9  ','UK   ','UN   ','UR   ','V2   ','V3   ','V4   ','V5   ',
+     +  'V6   ','V7   ','V8   ','VE   ','VK   ','VK0  ',        'VK9  ',
+     +                                          'VP2  ',                
+     +  'VP5  ','VP6  ',        'VP8  ',                                
+     +  'VP9  ','VQ9  ','VR   ','VU   ','VU4  ','VU7  ','XE   ','XF4  ',
+     +  'XT   ','XU   ','XW   ','XX9  ','XZ   ','YA   ','YB   ','YI   ',
+     +  'YJ   ','YK   ','YL   ','YN   ','YO   ','YS   ','YU   ','YV   ',
+     +  'YV0  ','Z2   ','Z3   ','ZA   ','ZB   ','ZC4  ','ZD7  ','ZD8  ',
+     +  'ZD9  ','ZF   ','ZK1  ',        'ZK2  ','ZK3  ','ZL   ','ZL7  ',
+     +  'ZL8  ','ZL9  ','ZP   ','ZS   ','ZS8  '/
+
+      ldxcc=.false.
+      ng=0
+      do i=1,NZ
+         if(pfx(i)(1:3).eq.c) go to 10
+      enddo
+      go to 20
+
+ 10   ng=180*180+61+i
+      ldxcc=.true.
+
+ 20   return
+      end

Added: branches/map65/libm65/packgrid.f
===================================================================
--- branches/map65/libm65/packgrid.f	                        (rev 0)
+++ branches/map65/libm65/packgrid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,47 @@
+      subroutine packgrid(grid,ng,text)
+
+      parameter (NGBASE=180*180)
+      character*4 grid
+      logical text
+
+      text=.false.
+      if(grid.eq.'    ') go to 90                 !Blank grid is OK
+
+C  Test for numerical signal report, etc.
+      if(grid(1:1).eq.'-') then
+         read(grid(2:3),*,err=1,end=1) n
+ 1       ng=NGBASE+1+n
+         go to 100
+      else if(grid(1:2).eq.'R-') then
+         read(grid(3:4),*,err=2,end=2) n
+ 2       if(n.eq.0) go to 90
+         ng=NGBASE+31+n
+         go to 100
+      else if(grid(1:2).eq.'RO') then
+         ng=NGBASE+62
+         go to 100
+      else if(grid(1:3).eq.'RRR') then
+         ng=NGBASE+63
+         go to 100
+      else if(grid(1:2).eq.'73') then
+         ng=NGBASE+64
+         go to 100
+      endif
+
+      if(grid(1:1).lt.'A' .or. grid(1:1).gt.'R') text=.true.
+      if(grid(2:2).lt.'A' .or. grid(2:2).gt.'R') text=.true.
+      if(grid(3:3).lt.'0' .or. grid(3:3).gt.'9') text=.true.
+      if(grid(4:4).lt.'0' .or. grid(4:4).gt.'9') text=.true.
+      if(text) go to 100
+
+      call grid2deg(grid//'mm',dlong,dlat)
+      long=dlong
+      lat=dlat+ 90.0
+      ng=((long+180)/2)*180 + lat
+      go to 100
+
+ 90   ng=NGBASE + 1
+
+ 100  return
+      end
+

Added: branches/map65/libm65/packmsg.f
===================================================================
--- branches/map65/libm65/packmsg.f	                        (rev 0)
+++ branches/map65/libm65/packmsg.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,103 @@
+      subroutine packmsg(msg,dat)
+
+      parameter (NBASE=37*36*10*27*27*27)
+      parameter (NBASE2=262178562)
+      character*22 msg
+      integer dat(12)
+      character*12 c1,c2,c2z
+      character*4 c3
+      character*6 grid6
+c      character*3 dxcc                  !Where is DXCC implemented?
+      logical text1,text2,text3
+
+C  Convert all letters to upper case
+      do i=1,22
+         if(msg(i:i).ge.'a' .and. msg(i:i).le.'z') 
+     +     msg(i:i)= char(ichar(msg(i:i))+ichar('A')-ichar('a'))
+      enddo
+
+C  See if it's a CQ message
+      if(msg(1:3).eq.'CQ ') then
+         i=3
+C  ... and if so, does it have a reply frequency?
+         if(msg(4:4).ge.'0' .and. msg(4:4).le.'9' .and. 
+     +      msg(5:5).ge.'0' .and. msg(5:5).le.'9' .and. 
+     +      msg(6:6).ge.'0' .and. msg(6:6).le.'9') i=7
+         go to 1
+      endif
+
+      do i=1,22
+         if(msg(i:i).eq.' ') go to 1       !Get 1st blank
+      enddo 
+      go to 10                             !Consider msg as plain text
+      
+ 1    ia=i
+      c1=msg(1:ia-1)
+      do i=ia+1,22
+         if(msg(i:i).eq.' ') go to 2       !Get 2nd blank
+      enddo
+      go to 10                             !Consider msg as plain text
+
+ 2    ib=i
+      c2=msg(ia+1:ib-1)
+
+      do i=ib+1,22
+         if(msg(i:i).eq.' ') go to 3       !Get 3rd blank
+      enddo
+      go to 10                             !Consider msg as plain text
+
+ 3    ic=i
+      c3='    '
+      if(ic.ge.ib+1) c3=msg(ib+1:ic)
+      if(c3.eq.'OOO ') c3='    '           !Strip out the OOO flag
+      call getpfx1(c1,k1,junk)
+      call packcall(c1,nc1,text1)
+      c2z=c2
+      call getpfx1(c2,k2,nv2)
+      call packcall(c2,nc2,text2)
+      if(nv2.eq.0) then
+         if(k1.lt.0 .or. k2.lt.0 .or. k1*k2.ne.0) go to 10
+         if(k2.gt.0) k2=k2+450
+         k=max(k1,k2)
+         if(k.gt.0) then
+            call k2grid(k,grid6)
+            c3=grid6(:4)
+         endif
+      endif
+      call packgrid(c3,ng,text3)
+      if(nv2.eq.0 .and. (.not.text1) .and. (.not.text2) .and. 
+     +        (.not.text3)) go to 20
+      if(nv2.gt.0) then
+         if(nv2.eq.1) then
+            if(c1(1:3).eq.'CQ ')  nc1=262178563 + k2
+            if(c1(1:4).eq.'QRZ ') nc1=264002072 + k2 
+            if(c1(1:3).eq.'DE ')  nc1=265825581 + k2
+         endif
+         if(nv2.eq.2) then
+            if(c1(1:3).eq.'CQ ')  nc1=267649090 + k2
+            if(c1(1:4).eq.'QRZ ') nc1=267698375 + k2
+            if(c1(1:3).eq.'DE ')  nc1=267747660 + k2
+         endif
+         go to 20
+      endif
+
+C  The message will be treated as plain text.
+ 10   call packtext(msg,nc1,nc2,ng)
+      ng=ng+32768
+
+C  Encode data into 6-bit words
+ 20   dat(1)=iand(ishft(nc1,-22),63)                !6 bits
+      dat(2)=iand(ishft(nc1,-16),63)                !6 bits
+      dat(3)=iand(ishft(nc1,-10),63)                !6 bits
+      dat(4)=iand(ishft(nc1, -4),63)                !6 bits
+      dat(5)=4*iand(nc1,15)+iand(ishft(nc2,-26),3)  !4+2 bits
+      dat(6)=iand(ishft(nc2,-20),63)                !6 bits
+      dat(7)=iand(ishft(nc2,-14),63)                !6 bits
+      dat(8)=iand(ishft(nc2, -8),63)                !6 bits
+      dat(9)=iand(ishft(nc2, -2),63)                !6 bits
+      dat(10)=16*iand(nc2,3)+iand(ishft(ng,-12),15) !2+4 bits
+      dat(11)=iand(ishft(ng,-6),63)
+      dat(12)=iand(ng,63)
+
+      return
+      end

Added: branches/map65/libm65/packtext.f
===================================================================
--- branches/map65/libm65/packtext.f	                        (rev 0)
+++ branches/map65/libm65/packtext.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,47 @@
+      subroutine packtext(msg,nc1,nc2,nc3)
+
+      parameter (MASK28=2**28 - 1)
+      character*13 msg
+      character*44 c
+      data c/'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ +-./?'/
+
+      nc1=0
+      nc2=0
+      nc3=0
+
+      do i=1,5                                !First 5 characters in nc1
+         do j=1,44                            !Get character code
+            if(msg(i:i).eq.c(j:j)) go to 10
+         enddo
+         j=37
+ 10      j=j-1                                !Codes should start at zero
+         nc1=42*nc1 + j
+      enddo
+
+      do i=6,10                               !Characters 6-10 in nc2
+         do j=1,44                            !Get character code
+            if(msg(i:i).eq.c(j:j)) go to 20
+         enddo
+         j=37
+ 20      j=j-1                                !Codes should start at zero
+         nc2=42*nc2 + j
+      enddo
+
+      do i=11,13                              !Characters 11-13 in nc3
+         do j=1,44                            !Get character code
+            if(msg(i:i).eq.c(j:j)) go to 30
+         enddo
+         j=37
+ 30      j=j-1                                !Codes should start at zero
+         nc3=42*nc3 + j
+      enddo
+
+C  We now have used 17 bits in nc3.  Must move one each to nc1 and nc2.
+      nc1=nc1+nc1
+      if(iand(nc3,32768).ne.0) nc1=nc1+1
+      nc2=nc2+nc2
+      if(iand(nc3,65536).ne.0) nc2=nc2+1
+      nc3=iand(nc3,32767)
+
+      return
+      end

Added: branches/map65/libm65/pctile.f
===================================================================
--- branches/map65/libm65/pctile.f	                        (rev 0)
+++ branches/map65/libm65/pctile.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,13 @@
+      subroutine pctile(x,tmp,nmax,npct,xpct)
+      real x(nmax),tmp(nmax)
+
+      do i=1,nmax
+         tmp(i)=x(i)
+      enddo
+      call sort(nmax,tmp)
+      j=nint(nmax*0.01*npct)
+      if(j.lt.1) j=1
+      xpct=tmp(j)
+
+      return
+      end

Added: branches/map65/libm65/pfx.f
===================================================================
--- branches/map65/libm65/pfx.f	                        (rev 0)
+++ branches/map65/libm65/pfx.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,50 @@
+      parameter (NZ=339)                     !Total number of prefixes
+      parameter (NZ2=12)                     !Total number of suffixes
+      character*1 sfx(NZ2)
+      character*5 pfx(NZ)
+
+      data sfx/'P','0','1','2','3','4','5','6','7','8','9','A'/
+      data pfx/
+     +  '1A   ','1S   ','3A   ','3B6  ','3B8  ','3B9  ','3C   ','3C0  ',
+     +  '3D2  ','3D2C ','3D2R ','3DA  ','3V   ','3W   ','3X   ','3Y   ',
+     +  '3YB  ','3YP  ','4J   ','4L   ','4S   ','4U1I ','4U1U ','4W   ',
+     +  '4X   ','5A   ','5B   ','5H   ','5N   ','5R   ','5T   ','5U   ',
+     +  '5V   ','5W   ','5X   ','5Z   ','6W   ','6Y   ','7O   ','7P   ',
+     +  '7Q   ','7X   ','8P   ','8Q   ','8R   ','9A   ','9G   ','9H   ',
+     +  '9J   ','9K   ','9L   ','9M2  ','9M6  ','9N   ','9Q   ','9U   ',
+     +  '9V   ','9X   ','9Y   ','A2   ','A3   ','A4   ','A5   ','A6   ',
+     +  'A7   ','A9   ','AP   ','BS7  ','BV   ','BV9  ','BY   ','C2   ',
+     +  'C3   ','C5   ','C6   ','C9   ','CE   ','CE0X ','CE0Y ','CE0Z ',
+     +  'CE9  ','CM   ','CN   ','CP   ','CT   ','CT3  ','CU   ','CX   ',
+     +  'CY0  ','CY9  ','D2   ','D4   ','D6   ','DL   ','DU   ','E3   ',
+     +  'E4   ','EA   ','EA6  ','EA8  ','EA9  ','EI   ','EK   ','EL   ',
+     +  'EP   ','ER   ','ES   ','ET   ','EU   ','EX   ','EY   ','EZ   ',
+     +  'F    ','FG   ','FH   ','FJ   ','FK   ','FKC  ','FM   ','FO   ',
+     +  'FOA  ','FOC  ','FOM  ','FP   ','FR   ','FRG  ','FRJ  ','FRT  ',
+     +  'FT5W ','FT5X ','FT5Z ','FW   ','FY   ','M    ','MD   ','MI   ',
+     +  'MJ   ','MM   ',        'MU   ','MW   ','H4   ','H40  ','HA   ',
+     +  'HB   ','HB0  ','HC   ','HC8  ','HH   ','HI   ','HK   ','HK0A ',
+     +  'HK0M ','HL   ','HM   ','HP   ','HR   ','HS   ','HV   ','HZ   ',
+     +  'I    ','IS   ','IS0  ',        'J2   ','J3   ','J5   ','J6   ',
+     +  'J7   ','J8   ','JA   ','JDM  ','JDO  ','JT   ','JW   ',        
+     +  'JX   ','JY   ','K    ','KG4  ','KH0  ','KH1  ','KH2  ','KH3  ',
+     +  'KH4  ','KH5  ','KH5K ','KH6  ','KH7  ','KH8  ','KH9  ','KL   ',
+     +  'KP1  ','KP2  ','KP4  ','KP5  ','LA   ','LU   ','LX   ','LY   ',
+     +  'LZ   ','OA   ','OD   ','OE   ','OH   ','OH0  ','OJ0  ','OK   ',
+     +  'OM   ','ON   ','OX   ','OY   ','OZ   ','P2   ','P4   ','PA   ',
+     +  'PJ2  ','PJ7  ','PY   ','PY0F ','PT0S ','PY0T ','PZ   ','R1F  ',
+     +  'R1M  ','S0   ','S2   ','S5   ','S7   ','S9   ','SM   ','SP   ',
+     +  'ST   ','SU   ','SV   ','SVA  ','SV5  ','SV9  ','T2   ','T30  ',
+     +  'T31  ','T32  ','T33  ','T5   ','T7   ','T8   ','T9   ','TA   ',
+     +          'TF   ','TG   ','TI   ','TI9  ','TJ   ','TK   ','TL   ',
+     +  'TN   ','TR   ','TT   ','TU   ','TY   ','TZ   ','UA   ','UA2  ',
+     +  'UA9  ','UK   ','UN   ','UR   ','V2   ','V3   ','V4   ','V5   ',
+     +  'V6   ','V7   ','V8   ','VE   ','VK   ','VK0H ','VK0M ','VK9C ',
+     +  'VK9L ','VK9M ','VK9N ','VK9W ','VK9X ','VP2E ','VP2M ','VP2V ',
+     +  'VP5  ','VP6  ','VP6D ','VP8  ','VP8G ','VP8H ','VP8O ','VP8S ',
+     +  'VP9  ','VQ9  ','VR   ','VU   ','VU4  ','VU7  ','XE   ','XF4  ',
+     +  'XT   ','XU   ','XW   ','XX9  ','XZ   ','YA   ','YB   ','YI   ',
+     +  'YJ   ','YK   ','YL   ','YN   ','YO   ','YS   ','YU   ','YV   ',
+     +  'YV0  ','Z2   ','Z3   ','ZA   ','ZB   ','ZC4  ','ZD7  ','ZD8  ',
+     +  'ZD9  ','ZF   ','ZK1N ','ZK1S ','ZK2  ','ZK3  ','ZL   ','ZL7  ',
+     +  'ZL8  ','ZL9  ','ZP   ','ZS   ','ZS8  ','KC4  ','E5   '/

Added: branches/map65/libm65/pfxdump.f
===================================================================
--- branches/map65/libm65/pfxdump.f	                        (rev 0)
+++ branches/map65/libm65/pfxdump.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,13 @@
+      subroutine pfxdump(fname)
+      character*(*) fname
+      include 'pfx.f'
+
+      open(11,file=fname,status='unknown')
+      write(11,1001) sfx
+ 1001 format('Supported Suffixes:'/(11('/',a1,2x)))
+      write(11,1002) pfx
+ 1002 format(/'Supported Add-On DXCC Prefixes:'/(15(a5,1x)))
+      close(11)
+
+      return
+      end

Added: branches/map65/libm65/ptt.c
===================================================================
--- branches/map65/libm65/ptt.c	                        (rev 0)
+++ branches/map65/libm65/ptt.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,42 @@
+#include &lt;windows.h&gt;
+#include &lt;stdio.h&gt;
+
+int ptt_(int *nport, int *ntx, int *iptt)
+{
+  static HANDLE hFile;
+  static int open=0;
+  char s[10];
+  int i3,i4,i5,i6,i9,i00;
+
+  if(*nport==0) {
+    *iptt=*ntx;
+    return(0);
+  }
+
+  if(*ntx &amp;&amp; (!open)) {
+    sprintf(s,&quot;COM%d&quot;,*nport);
+    hFile=CreateFile(TEXT(s),GENERIC_WRITE,0,NULL,OPEN_EXISTING,
+		     FILE_ATTRIBUTE_NORMAL,NULL);
+    if(hFile==INVALID_HANDLE_VALUE) {
+      //      printf(&quot;PTT: Cannot open COM port %d.\n&quot;,*nport);
+      return 1;
+    }
+    open=1;
+  }
+
+  if(*ntx &amp;&amp; open) {
+    EscapeCommFunction(hFile,3);
+    EscapeCommFunction(hFile,5);
+    *iptt=1;
+  }
+
+  else {
+    EscapeCommFunction(hFile,4);
+    EscapeCommFunction(hFile,6);
+    EscapeCommFunction(hFile,9);
+    i00=CloseHandle(hFile);
+    *iptt=0;
+    open=0;
+  }
+  return 0;
+}

Added: branches/map65/libm65/ptt_unix.c
===================================================================
--- branches/map65/libm65/ptt_unix.c	                        (rev 0)
+++ branches/map65/libm65/ptt_unix.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,391 @@
+/*
+ * WSJT is Copyright (c) 2001-2006 by Joseph H. Taylor, Jr., K1JT, 
+ * and is licensed under the GNU General Public License (GPL).
+ *
+ * Code used from cwdaemon for parallel port ptt only.
+ *
+ * cwdaemon - morse sounding daemon for the parallel or serial port
+ * Copyright (C) 2002 -2005 Joop Stakenborg &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">pg4i at amsat.org</A>&gt;
+ *                       and many authors, see the AUTHORS file.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ * GNU Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+# if HAVE_STDIO_H
+# include &lt;stdio.h&gt;
+#endif
+#if STDC_HEADERS
+# include &lt;stdlib.h&gt;
+# include &lt;stddef.h&gt;
+#else
+# if HAVE_STDLIB_H
+#  include &lt;stdlib.h&gt;
+# endif
+#endif
+#if HAVE_UNISTD_H
+# include &lt;unistd.h&gt;
+#endif
+#if HAVE_SYS_IOCTL_H
+# include &lt;sys/ioctl.h&gt;
+#endif
+#if HAVE_FCNTL_H
+# include &lt;fcntl.h&gt;
+#endif
+
+#ifdef HAVE_LINUX_PPDEV_H
+# include &lt;linux/ppdev.h&gt;
+# include &lt;linux/parport.h&gt;
+#endif
+#ifdef HAVE_DEV_PPBUS_PPI_H
+# include &lt;dev/ppbus/ppi.h&gt;
+# include &lt;dev/ppbus/ppbconf.h&gt;
+#endif
+
+int lp_reset (int fd);
+int lp_ptt (int fd, int onoff);
+
+#ifdef HAVE_SYS_STAT_H
+# include &lt;sys/stat.h&gt;
+#endif
+#if (defined(__unix__) || defined(unix)) &amp;&amp; !defined(USG)
+# include &lt;sys/param.h&gt;
+#endif
+
+#include &lt;string.h&gt;
+/* parport functions */
+
+int dev_is_parport(int fd);
+int ptt_parallel(int fd, int *ntx, int *iptt);
+int ptt_serial(int fd, int *ntx, int *iptt);
+
+int fd=-1;		/* Used for both serial and parallel */
+
+/*
+ * ptt_
+ *
+ * generic unix PTT routine called from Fortran
+ *
+ * Inputs	
+ * unused	Unused, to satisfy old windows calling convention
+ * ptt_port	device name serial or parallel
+ * ntx		pointer to fortran command on or off
+ * iptt		pointer to fortran command status on or off
+ * Returns	- non 0 if error
+*/
+
+/* Tiny state machine */
+#define STATE_PORT_CLOSED		0
+#define STATE_PORT_OPEN_PARALLEL	1
+#define STATE_PORT_OPEN_SERIAL		2
+
+//int ptt_(int *unused, char *ptt_port, int *ntx, int *iptt)
+int ptt_(int *unused, int *ntx, int *iptt)
+{
+  static int state=0;
+  char *p;
+
+// ### Temporary:
+  char* ptt_port;
+  if(*unused != -99) {
+    *iptt=*ntx;
+    return 0;
+  }
+// ###
+
+  /* In the very unlikely event of a NULL pointer, just return.
+   * Yes, I realise this should not be possible in WSJT.
+   */
+  if (ptt_port == NULL) {
+    *iptt = *ntx;
+    return (0);
+  }
+    
+  switch (state) {
+  case STATE_PORT_CLOSED:
+
+     /* Remove trailing ' ' */
+    if ((p = strchr(ptt_port, ' ')) != NULL)
+      *p = '\0';
+
+    /* If all that is left is a '\0' then also just return */
+    if (*ptt_port == '\0') {
+      *iptt = *ntx;
+      return(0);
+    }
+
+    if ((fd = open(ptt_port, O_RDWR|O_NONBLOCK)) &lt; 0) {
+	fprintf(stderr, &quot;Can't open %s.\n&quot;, ptt_port);
+	return (1);
+    }
+
+    if (dev_is_parport(fd)) {
+      state = STATE_PORT_OPEN_PARALLEL;
+      lp_reset(fd);
+      ptt_parallel(fd, ntx, iptt);
+    } else {
+      state = STATE_PORT_OPEN_SERIAL;
+      ptt_serial(fd, ntx, iptt);
+    }
+    break;
+
+  case STATE_PORT_OPEN_PARALLEL:
+    ptt_parallel(fd, ntx, iptt);
+    break;
+
+  case STATE_PORT_OPEN_SERIAL:
+    ptt_serial(fd, ntx, iptt);
+    break;
+
+  default:
+    close(fd);
+    fd = -1;
+    state = STATE_PORT_CLOSED;
+    break;
+  }
+  return(0);
+}
+
+/*
+ * ptt_serial
+ *
+ * generic serial unix PTT routine called indirectly from Fortran
+ *
+ * fd		- already opened file descriptor
+ * ntx		- pointer to fortran command on or off
+ * iptt		- pointer to fortran command status on or off
+ */
+
+int
+ptt_serial(int fd, int *ntx, int *iptt)
+{
+  int control = TIOCM_RTS | TIOCM_DTR;
+
+  if(*ntx) {
+    ioctl(fd, TIOCMBIS, &amp;control);               /* Set DTR and RTS */
+    *iptt = 1;
+  } else {
+    ioctl(fd, TIOCMBIC, &amp;control);
+    *iptt = 0;
+  }
+  return(0);
+}
+
+
+/* parport functions */
+
+/*
+ * dev_is_parport(fd):
+ *
+ * inputs	- Already open fd
+ * output	- 1 if parallel port, 0 if not
+ * side effects	- Unfortunately, this is platform specific.
+ */
+
+#if defined(HAVE_LINUX_PPDEV_H)                /* Linux (ppdev) */
+
+int
+dev_is_parport(int fd)
+{
+       struct stat st;
+       int m;
+
+       if ((fstat(fd, &amp;st) == -1) ||
+	   ((st.st_mode &amp; S_IFMT) != S_IFCHR) ||
+	   (ioctl(fd, PPGETMODE, &amp;m) == -1))
+	 return(0);
+
+       return(1);
+}
+
+#elif defined(HAVE_DEV_PPBUS_PPI_H)    /* FreeBSD (ppbus/ppi) */
+
+int
+dev_is_parport(int fd)
+{
+       struct stat st;
+       unsigned char c;
+
+       if ((fstat(fd, &amp;st) == -1) ||
+	   ((st.st_mode &amp; S_IFMT) != S_IFCHR) ||
+	   (ioctl(fd, PPISSTATUS, &amp;c) == -1))
+	 return(0);
+
+       return(1);
+}
+
+#else                                  /* Fallback (nothing) */
+
+int
+dev_is_parport(int fd)
+{
+       return(0);
+}
+
+#endif
+/* Linux wrapper around PPFCONTROL */
+#ifdef HAVE_LINUX_PPDEV_H
+static void
+parport_control (int fd, unsigned char controlbits, int values)
+{
+	struct ppdev_frob_struct frob;
+	frob.mask = controlbits;
+	frob.val = values;
+
+	if (ioctl (fd, PPFCONTROL, &amp;frob) == -1)
+	{
+		fprintf(stderr, &quot;Parallel port PPFCONTROL&quot;);
+		exit (1);
+	}
+}
+#endif
+
+/* FreeBSD wrapper around PPISCTRL */
+#ifdef HAVE_DEV_PPBUS_PPI_H
+static void
+parport_control (int fd, unsigned char controlbits, int values)
+{
+	unsigned char val;
+
+	if (ioctl (fd, PPIGCTRL, &amp;val) == -1)
+	{
+		fprintf(stderr, &quot;Parallel port PPIGCTRL&quot;);
+		exit (1);
+	}
+
+	val &amp;= ~controlbits;
+	val |= values;
+
+	if (ioctl (fd, PPISCTRL, &amp;val) == -1)
+	{
+		fprintf(stderr, &quot;Parallel port PPISCTRL&quot;);
+		exit (1);
+	}
+}
+#endif
+
+/* Initialise a parallel port, given open fd */
+int
+lp_init (int fd)
+{
+#ifdef HAVE_LINUX_PPDEV_H
+	int mode;
+#endif
+
+#ifdef HAVE_LINUX_PPDEV_H
+	mode = PARPORT_MODE_PCSPP;
+
+	if (ioctl (fd, PPSETMODE, &amp;mode) == -1)
+	{
+		fprintf(stderr, &quot;Setting parallel port mode&quot;);
+		close (fd);
+		return(-1);
+	}
+
+	if (ioctl (fd, PPEXCL, NULL) == -1)
+	{
+		fprintf(stderr, &quot;Parallel port is already in use.\n&quot;);
+		close (fd);
+		return(-1);
+	}
+	if (ioctl (fd, PPCLAIM, NULL) == -1)
+	{
+		fprintf(stderr, &quot;Claiming parallel port.\n&quot;);
+		fprintf(stderr, &quot;HINT: did you unload the lp kernel module?&quot;);
+		close (fd);
+		return(-1);
+	}
+
+	/* Enable CW &amp; PTT - /STROBE bit (pin 1) */
+	parport_control (fd, PARPORT_CONTROL_STROBE, PARPORT_CONTROL_STROBE);
+#endif
+#ifdef HAVE_DEV_PPBUS_PPI_H
+	parport_control (fd, STROBE, STROBE);
+#endif
+	lp_reset (fd);
+	return(0);
+}
+
+/* release ppdev and close port */
+int
+lp_free (int fd)
+{
+#ifdef HAVE_LINUX_PPDEV_H
+	lp_reset (fd);
+
+	/* Disable CW &amp; PTT - /STROBE bit (pin 1) */
+	parport_control (fd, PARPORT_CONTROL_STROBE, 0);
+
+	ioctl (fd, PPRELEASE);
+#endif
+#ifdef HAVE_DEV_PPBUS_PPI_H
+	/* Disable CW &amp; PTT - /STROBE bit (pin 1) */
+	parport_control (fd, STROBE, 0);
+#endif
+	close (fd);
+	return(0);
+}
+
+/* set to a known state */
+int
+lp_reset (int fd)
+{
+#if defined (HAVE_LINUX_PPDEV_H) || defined (HAVE_DEV_PPBUS_PPI_H)
+	lp_ptt (fd, 0);
+#endif
+	return(0);
+}
+
+/* SSB PTT keying - /INIT bit (pin 16) (inverted) */
+int
+lp_ptt (int fd, int onoff)
+{
+#ifdef HAVE_LINUX_PPDEV_H
+	if (onoff == 1)
+		parport_control (fd, PARPORT_CONTROL_INIT,
+				PARPORT_CONTROL_INIT);
+	else
+		parport_control (fd, PARPORT_CONTROL_INIT, 0);
+#endif
+#ifdef HAVE_DEV_PPBUS_PPI_H
+	if (onoff == 1)
+		parport_control (fd, nINIT,
+				nINIT);
+	else
+		parport_control (fd, nINIT, 0);
+#endif
+	return(0);
+}
+
+/*
+ * ptt_parallel
+ *
+ * generic parallel unix PTT routine called indirectly from Fortran
+ *
+ * fd		- already opened file descriptor
+ * ntx		- pointer to fortran command on or off
+ * iptt		- pointer to fortran command status on or off
+ */
+
+int
+ptt_parallel(int fd, int *ntx, int *iptt)
+{
+  if(*ntx) {
+    lp_ptt(fd, 1);
+    *iptt=1;
+  }  else {
+    lp_ptt(fd, 0);
+    *iptt=0;
+  }
+  return(0);
+}

Added: branches/map65/libm65/recvpkt.f90
===================================================================
--- branches/map65/libm65/recvpkt.f90	                        (rev 0)
+++ branches/map65/libm65/recvpkt.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,70 @@
+subroutine recvpkt(nsam,nblock2,userx_no,k,buf4,buf8,buf16)
+
+! Reformat timf2 data from Linrad and stuff data into r*4 array dd().
+
+  parameter (NSMAX=60*96000)          !Total sample intervals per minute
+  parameter (NFFT=32768)
+  integer*1 userx_no
+  real*4 d4,buf4(*)                   !(348)
+  real*8 d8,buf8(*)                   !(174)
+  complex*16 c16,buf16(*)             !(87)
+  integer*2 jd(4),kd(2),nblock2
+  real*4 xd(4),yd(2)
+  real*8 fcenter
+  common/datcom/dd(4,5760000),ss(4,322,NFFT),savg(4,NFFT),fcenter,nutc,junk(34)
+  equivalence (kd,d4)
+  equivalence (jd,d8,yd)
+  equivalence (xd,c16)
+
+  if(nsam.eq.-1) then
+! Move data from the UDP packet buffer into array dd().
+     if(userx_no.eq.-1) then
+        do i=1,174                    !One RF channel, r*4 data
+           k=k+1
+           d8=buf8(i)
+           dd(1,k)=yd(1)
+           dd(2,k)=yd(2)
+        enddo
+     else if(userx_no.eq.1) then
+        do i=1,348                    !One RF channel, i*2 data
+           k=k+1
+           d4=buf4(i)
+           dd(1,k)=kd(1)
+           dd(2,k)=kd(2)
+        enddo
+     else if(userx_no.eq.-2) then
+        do i=1,87                    !Two RF channels, r*4 data
+           k=k+1
+           c16=buf16(i)
+           dd(1,k)=xd(1)
+           dd(2,k)=xd(2)
+           dd(3,k)=xd(3)
+           dd(4,k)=xd(4)
+        enddo
+     else if(userx_no.eq.2) then
+        do i=1,174                    !Two RF channels, i*2 data
+           k=k+1
+           d8=buf8(i)
+           dd(1,k)=jd(1)
+           dd(2,k)=jd(2)
+           dd(3,k)=jd(3)
+           dd(4,k)=jd(4)
+        enddo
+     endif
+  else
+     if(userx_no.eq.1) then
+        do i=1,nsam                    !One RF channel, r*4 data
+           k=k+1
+           d4=buf4(i)
+           dd(1,k)=kd(1)
+           dd(2,k)=kd(2)
+
+           k=k+1
+           dd(1,k)=kd(1)
+           dd(2,k)=kd(2)
+        enddo
+     endif
+  endif
+
+  return
+end subroutine recvpkt

Added: branches/map65/libm65/rfile3a.f90
===================================================================
--- branches/map65/libm65/rfile3a.f90	                        (rev 0)
+++ branches/map65/libm65/rfile3a.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,14 @@
+subroutine rfile3a(infile,ibuf,n,fcenter,ierr)
+
+  character*(*) infile
+  integer*8 ibuf(n)
+  real*8 fcenter
+
+  open(10,file=infile,access='stream',status='old',err=998)
+  read(10,end=998) (ibuf(i),i=1,n/8),fcenter
+  ierr=0
+  go to 999
+998 ierr=1002
+999 close(10)
+  return
+end subroutine rfile3a

Added: branches/map65/libm65/rs.h
===================================================================
--- branches/map65/libm65/rs.h	                        (rev 0)
+++ branches/map65/libm65/rs.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,35 @@
+/* User include file for the Reed-Solomon codec
+ * Copyright 2002, Phil Karn KA9Q
+ * May be used under the terms of the GNU General Public License (GPL)
+ */
+
+/* General purpose RS codec, 8-bit symbols */
+void encode_rs_char(void *rs,unsigned char *data,unsigned char *parity);
+int decode_rs_char(void *rs,unsigned char *data,int *eras_pos,
+		   int no_eras);
+void *init_rs_char(int symsize,int gfpoly,
+		   int fcr,int prim,int nroots,
+		   int pad);
+void free_rs_char(void *rs);
+
+/* General purpose RS codec, integer symbols */
+void encode_rs_int(void *rs,int *data,int *parity);
+int decode_rs_int(void *rs,int *data,int *eras_pos,int no_eras);
+void *init_rs_int(int symsize,int gfpoly,int fcr,
+		  int prim,int nroots,int pad);
+void free_rs_int(void *rs);
+
+/* CCSDS standard (255,223) RS codec with conventional (*not* dual-basis)
+ * symbol representation
+ */
+void encode_rs_8(unsigned char *data,unsigned char *parity,int pad);
+int decode_rs_8(unsigned char *data,int *eras_pos,int no_eras,int pad);
+
+/* CCSDS standard (255,223) RS codec with dual-basis symbol representation */
+void encode_rs_ccsds(unsigned char *data,unsigned char *parity,int pad);
+int decode_rs_ccsds(unsigned char *data,int *eras_pos,int no_eras,int pad);
+
+/* Tables to map from conventional-&gt;dual (Taltab) and
+ * dual-&gt;conventional (Tal1tab) bases
+ */
+extern unsigned char Taltab[],Tal1tab[];

Added: branches/map65/libm65/s3avg.f90
===================================================================
--- branches/map65/libm65/s3avg.f90	                        (rev 0)
+++ branches/map65/libm65/s3avg.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,42 @@
+subroutine s3avg(nsave,mode65,nutc,ndf,xdt,npol,s3,nkv,decoded)
+
+  real s3(64,63),s3b(64,63)
+  real s3a(64,63,32)
+  integer iutc(32),idf(32),ipol(32)
+  real dt(32)
+  character*22 decoded
+  logical ltext
+  save
+  
+  n=nsave
+  iutc(n)=nutc
+  idf(n)=ndf
+  ipol(n)=npol
+  dt(n)=xdt
+  s3a(1:64,1:63,n)=s3
+
+  s3b=0.
+  nsum=0
+  idfdiff=100
+  dtdiff=0.2
+  do i=1,n
+     if(mod(iutc(i),2).ne.mod(nutc,2)) cycle
+     if(abs(ndf-idf(i)).gt.idfdiff) cycle
+     if(abs(xdt-dt(i)).gt.dtdiff) cycle
+     s3b=s3b + s3a(1:64,1:63,i)
+     nsum=nsum+1
+  enddo
+
+  decoded='                      '
+  if(nsum.ge.2) then
+     nadd=mode65*nsum
+     call extract(s3b,nadd,ncount,nhist,decoded,ltext)     !Extract the message
+     nkv=nsum
+     if(ncount.lt.0) then 
+        nkv=0
+        decoded='                      '
+     endif
+  endif
+
+  return
+end subroutine s3avg

Added: branches/map65/libm65/sec_midn.f90
===================================================================
--- branches/map65/libm65/sec_midn.f90	                        (rev 0)
+++ branches/map65/libm65/sec_midn.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,11 @@
+real function sec_midn()
+  sec_midn=secnds(0.0)
+  return
+end function sec_midn
+
+subroutine sleep_msec(n)
+
+  call usleep(1000*n)
+
+  return
+end subroutine sleep_msec

Added: branches/map65/libm65/set.f
===================================================================
--- branches/map65/libm65/set.f	                        (rev 0)
+++ branches/map65/libm65/set.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,31 @@
+      subroutine set(a,y,n)
+      real y(n)
+      do i=1,n
+         y(i)=a
+      enddo
+      return
+      end
+
+      subroutine move(x,y,n)
+      real x(n),y(n)
+      do i=1,n
+         y(i)=x(i)
+      enddo
+      return
+      end
+
+      subroutine zero(x,n)
+      real x(n)
+      do i=1,n
+         x(i)=0.0
+      enddo
+      return
+      end
+
+      subroutine add(a,b,c,n)
+      real a(n),b(n),c(n)
+      do i=1,n
+         c(i)=a(i)+b(i)
+      enddo
+      return
+      end

Added: branches/map65/libm65/setup65.f
===================================================================
--- branches/map65/libm65/setup65.f	                        (rev 0)
+++ branches/map65/libm65/setup65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,96 @@
+      subroutine setup65
+
+C  Defines arrays related to the JT65 pseudo-random synchronizing pattern.
+C  Executed at program start.
+
+      integer nprc(126)
+      common/prcom/pr(126),mdat(126),mref(126,2),mdat2(126),mref2(126,2)
+
+C  JT65
+      data nprc/
+     + 1,0,0,1,1,0,0,0,1,1,1,1,1,1,0,1,0,1,0,0,
+     + 0,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,1,1,1,1,
+     + 0,1,1,0,1,1,1,1,0,0,0,1,1,0,1,0,1,0,1,1,
+     + 0,0,1,1,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,
+     + 1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,0,1,
+     + 0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,
+     + 1,1,1,1,1,1/
+      data mr2/0/                !Silence compiler warning
+
+C  Put the appropriate pseudo-random sequence into pr
+      nsym=126
+      do i=1,nsym
+         pr(i)=2*nprc(i)-1
+      enddo
+
+C  Determine locations of data and reference symbols
+      k=0
+      mr1=0
+      do i=1,nsym
+         if(pr(i).lt.0.0) then
+            k=k+1
+            mdat(k)=i
+         else
+            mr2=i
+            if(mr1.eq.0) mr1=i
+         endif
+      enddo
+      nsig=k
+
+C  Determine the reference symbols for each data symbol.
+      do k=1,nsig
+         m=mdat(k)
+         mref(k,1)=mr1
+         do n=1,10                     !Get ref symbol before data
+            if((m-n).gt.0) then
+               if (pr(m-n).gt.0.0) go to 10
+            endif
+         enddo
+         go to 12
+ 10      mref(k,1)=m-n
+ 12      mref(k,2)=mr2
+         do n=1,10                     !Get ref symbol after data
+            if((m+n).le.nsym) then
+               if (pr(m+n).gt.0.0) go to 20
+            endif
+         enddo
+         go to 22
+ 20      mref(k,2)=m+n
+ 22   enddo
+
+C  Now do it all again, using opposite logic on pr(i)
+      k=0
+      mr1=0
+      do i=1,nsym
+         if(pr(i).gt.0.0) then
+            k=k+1
+            mdat2(k)=i
+         else
+            mr2=i
+            if(mr1.eq.0) mr1=i
+         endif
+      enddo
+      nsig=k
+
+      do k=1,nsig
+         m=mdat2(k)
+         mref2(k,1)=mr1
+         do n=1,10
+            if((m-n).gt.0) then
+               if (pr(m-n).lt.0.0) go to 110
+            endif
+         enddo
+         go to 112
+ 110      mref2(k,1)=m-n
+ 112      mref2(k,2)=mr2
+         do n=1,10
+            if((m+n).le.nsym) then
+               if (pr(m+n).lt.0.0) go to 120
+            endif
+         enddo
+         go to 122
+ 120     mref2(k,2)=m+n
+ 122  enddo
+
+      return
+      end

Added: branches/map65/libm65/sleep.h
===================================================================
--- branches/map65/libm65/sleep.h	                        (rev 0)
+++ branches/map65/libm65/sleep.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,32 @@
+/*
+ * sleep.h  1.0 02/03/10
+ *
+ * Defines cross-platform sleep, usleep, etc.
+ *
+ * By Wu Yongwei
+ *
+ */
+
+#ifndef _SLEEP_H
+#define _SLEEP_H
+
+#ifdef _WIN32
+# if defined(_NEED_SLEEP_ONLY) &amp;&amp; (defined(_MSC_VER) || defined(__MINGW32__))
+#  include &lt;stdlib.h&gt;
+#  define sleep(t) _sleep((t) * 1000)
+# else
+#  include &lt;windows.h&gt;
+#  define sleep(t)  Sleep((t) * 1000)
+# endif
+# ifndef _NEED_SLEEP_ONLY
+#  define msleep(t) Sleep(t)
+#  define usleep(t) Sleep((t) / 1000)
+# endif
+#else
+# include &lt;unistd.h&gt;
+# ifndef _NEED_SLEEP_ONLY
+#  define msleep(t) usleep((t) * 1000)
+# endif
+#endif
+
+#endif /* _SLEEP_H */

Added: branches/map65/libm65/sleep_msec.f90
===================================================================
--- branches/map65/libm65/sleep_msec.f90	                        (rev 0)
+++ branches/map65/libm65/sleep_msec.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,3 @@
+subroutine sleep_msec(n)
+  return
+end subroutine sleep_msec

Added: branches/map65/libm65/sort.f
===================================================================
--- branches/map65/libm65/sort.f	                        (rev 0)
+++ branches/map65/libm65/sort.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,4 @@
+      subroutine sort(n,arr)
+      call ssort(arr,tmp,n,1)
+      return
+      end

Added: branches/map65/libm65/ssort.f
===================================================================
--- branches/map65/libm65/ssort.f	                        (rev 0)
+++ branches/map65/libm65/ssort.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,287 @@
+      subroutine ssort (x,y,n,kflag)
+c***purpose  sort an array and optionally make the same interchanges in
+c            an auxiliary array.  the array may be sorted in increasing
+c            or decreasing order.  a slightly modified quicksort
+c            algorithm is used.
+c
+c   ssort sorts array x and optionally makes the same interchanges in
+c   array y.  the array x may be sorted in increasing order or
+c   decreasing order.  a slightly modified quicksort algorithm is used.
+c
+c   description of parameters
+c      x - array of values to be sorted
+c      y - array to be (optionally) carried along
+c      n - number of values in array x to be sorted
+c      kflag - control parameter
+c            =  2  means sort x in increasing order and carry y along.
+c            =  1  means sort x in increasing order (ignoring y)
+c            = -1  means sort x in decreasing order (ignoring y)
+c            = -2  means sort x in decreasing order and carry y along.
+
+      integer kflag, n
+!      real x(n), y(n)
+!      real r, t, tt, tty, ty
+      integer x(n), y(n)
+      integer r, t, tt, tty, ty
+      integer i, ij, j, k, kk, l, m, nn
+      integer il(21), iu(21)
+
+      nn = n
+      if (nn .lt. 1) then
+!         print*,'ssort: The number of sort elements is not positive.'
+!         print*,'ssort: n = ',nn,'   kflag = ',kflag
+         return
+      endif
+c
+      kk = abs(kflag)
+      if (kk.ne.1 .and. kk.ne.2) then
+         print *,
+     +      'the sort control parameter, k, is not 2, 1, -1, or -2.'
+         return
+      endif
+c
+c     alter array x to get decreasing order if needed
+c
+      if (kflag .le. -1) then
+         do 10 i=1,nn
+            x(i) = -x(i)
+   10    continue
+      endif
+c
+      if (kk .eq. 2) go to 100
+c
+c     sort x only
+c
+      m = 1
+      i = 1
+      j = nn
+      r = 0.375e0
+c
+   20 if (i .eq. j) go to 60
+      if (r .le. 0.5898437e0) then
+         r = r+3.90625e-2
+      else
+         r = r-0.21875e0
+      endif
+c
+   30 k = i
+c
+c     select a central element of the array and save it in location t
+c
+      ij = i + int((j-i)*r)
+      t = x(ij)
+c
+c     if first element of array is greater than t, interchange with t
+c
+      if (x(i) .gt. t) then
+         x(ij) = x(i)
+         x(i) = t
+         t = x(ij)
+      endif
+      l = j
+c
+c     if last element of array is less than than t, interchange with t
+c
+      if (x(j) .lt. t) then
+         x(ij) = x(j)
+         x(j) = t
+         t = x(ij)
+c
+c        if first element of array is greater than t, interchange with t
+c
+         if (x(i) .gt. t) then
+            x(ij) = x(i)
+            x(i) = t
+            t = x(ij)
+         endif
+      endif
+c
+c     find an element in the second half of the array which is smaller
+c     than t
+c
+   40 l = l-1
+      if (x(l) .gt. t) go to 40
+c
+c     find an element in the first half of the array which is greater
+c     than t
+c
+   50 k = k+1
+      if (x(k) .lt. t) go to 50
+c
+c     interchange these elements
+c
+      if (k .le. l) then
+         tt = x(l)
+         x(l) = x(k)
+         x(k) = tt
+         go to 40
+      endif
+c
+c     save upper and lower subscripts of the array yet to be sorted
+c
+      if (l-i .gt. j-k) then
+         il(m) = i
+         iu(m) = l
+         i = k
+         m = m+1
+      else
+         il(m) = k
+         iu(m) = j
+         j = l
+         m = m+1
+      endif
+      go to 70
+c
+c     begin again on another portion of the unsorted array
+c
+   60 m = m-1
+      if (m .eq. 0) go to 190
+      i = il(m)
+      j = iu(m)
+c
+   70 if (j-i .ge. 1) go to 30
+      if (i .eq. 1) go to 20
+      i = i-1
+c
+   80 i = i+1
+      if (i .eq. j) go to 60
+      t = x(i+1)
+      if (x(i) .le. t) go to 80
+      k = i
+c
+   90 x(k+1) = x(k)
+      k = k-1
+      if (t .lt. x(k)) go to 90
+      x(k+1) = t
+      go to 80
+c
+c     sort x and carry y along
+c
+  100 m = 1
+      i = 1
+      j = nn
+      r = 0.375e0
+c
+  110 if (i .eq. j) go to 150
+      if (r .le. 0.5898437e0) then
+         r = r+3.90625e-2
+      else
+         r = r-0.21875e0
+      endif
+c
+  120 k = i
+c
+c     select a central element of the array and save it in location t
+c
+      ij = i + int((j-i)*r)
+      t = x(ij)
+      ty = y(ij)
+c
+c     if first element of array is greater than t, interchange with t
+c
+      if (x(i) .gt. t) then
+         x(ij) = x(i)
+         x(i) = t
+         t = x(ij)
+         y(ij) = y(i)
+         y(i) = ty
+         ty = y(ij)
+      endif
+      l = j
+c
+c     if last element of array is less than t, interchange with t
+c
+      if (x(j) .lt. t) then
+         x(ij) = x(j)
+         x(j) = t
+         t = x(ij)
+         y(ij) = y(j)
+         y(j) = ty
+         ty = y(ij)
+c
+c        if first element of array is greater than t, interchange with t
+c
+         if (x(i) .gt. t) then
+            x(ij) = x(i)
+            x(i) = t
+            t = x(ij)
+            y(ij) = y(i)
+            y(i) = ty
+            ty = y(ij)
+         endif
+      endif
+c
+c     find an element in the second half of the array which is smaller
+c     than t
+c
+  130 l = l-1
+      if (x(l) .gt. t) go to 130
+c
+c     find an element in the first half of the array which is greater
+c     than t
+c
+  140 k = k+1
+      if (x(k) .lt. t) go to 140
+c
+c     interchange these elements
+c
+      if (k .le. l) then
+         tt = x(l)
+         x(l) = x(k)
+         x(k) = tt
+         tty = y(l)
+         y(l) = y(k)
+         y(k) = tty
+         go to 130
+      endif
+c
+c     save upper and lower subscripts of the array yet to be sorted
+c
+      if (l-i .gt. j-k) then
+         il(m) = i
+         iu(m) = l
+         i = k
+         m = m+1
+      else
+         il(m) = k
+         iu(m) = j
+         j = l
+         m = m+1
+      endif
+      go to 160
+c
+c     begin again on another portion of the unsorted array
+c
+  150 m = m-1
+      if (m .eq. 0) go to 190
+      i = il(m)
+      j = iu(m)
+c
+  160 if (j-i .ge. 1) go to 120
+      if (i .eq. 1) go to 110
+      i = i-1
+c
+  170 i = i+1
+      if (i .eq. j) go to 150
+      t = x(i+1)
+      ty = y(i+1)
+      if (x(i) .le. t) go to 170
+      k = i
+c
+  180 x(k+1) = x(k)
+      y(k+1) = y(k)
+      k = k-1
+      if (t .lt. x(k)) go to 180
+      x(k+1) = t
+      y(k+1) = ty
+      go to 170
+c
+c     clean up
+c
+  190 if (kflag .le. -1) then
+         do 200 i=1,nn
+            x(i) = -x(i)
+  200    continue
+      endif
+      return
+      end

Added: branches/map65/libm65/sun.f
===================================================================
--- branches/map65/libm65/sun.f	                        (rev 0)
+++ branches/map65/libm65/sun.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,88 @@
+      subroutine sun(y,m,DD,UT,lon,lat,RA,Dec,LST,Az,El,mjd,day)
+
+      implicit none
+
+      integer y                         !Year
+      integer m                         !Month
+      integer DD                        !Day
+      integer mjd                       !Modified Julian Date
+      real UT                           !UTC in hours
+      real RA,Dec                       !RA and Dec of sun
+
+C  NB: Double caps here are single caps in the writeup.
+
+C  Orbital elements of the Sun (also N=0, i=0, a=1):
+      real w                            !Argument of perihelion
+      real e                            !Eccentricity
+      real MM                           !Mean anomaly
+      real Ls                           !Mean longitude
+
+C  Other standard variables:
+      real v                            !True anomaly
+      real EE                           !Eccentric anomaly
+      real ecl                          !Obliquity of the ecliptic
+      real d                            !Ephemeris time argument in days
+      real r                            !Distance to sun, AU
+      real xv,yv                        !x and y coords in ecliptic
+      real lonsun                       !Ecliptic long and lat of sun
+C Ecliptic coords of sun (geocentric)
+      real xs,ys
+C Equatorial coords of sun (geocentric)
+      real xe,ye,ze
+      real lon,lat
+      real GMST0,LST,HA
+      real xx,yy,zz
+      real xhor,yhor,zhor
+      real Az,El
+
+      real day
+      real rad
+      data rad/57.2957795/
+
+C  Time in days, with Jan 0, 2000 equal to 0.0:
+      d=367*y - 7*(y+(m+9)/12)/4 + 275*m/9 + DD - 730530 + UT/24.0
+      mjd=d + 51543
+      ecl = 23.4393 - 3.563e-7 * d
+
+C  Compute updated orbital elements for Sun:
+      w = 282.9404 + 4.70935e-5 * d
+      e = 0.016709 - 1.151e-9 * d
+      MM = mod(356.0470d0 + 0.9856002585d0 * d + 360000.d0,360.d0)
+      Ls = mod(w+MM+720.0,360.0)
+
+      EE = MM + e*rad*sin(MM/rad) * (1.0 + e*cos(M/rad))
+      EE = EE - (EE - e*rad*sin(EE/rad)-MM) / (1.0 - e*cos(EE/rad))
+
+      xv = cos(EE/rad) - e
+      yv = sqrt(1.0-e*e) * sin(EE/rad)
+      v = rad*atan2(yv,xv)
+      r = sqrt(xv*xv + yv*yv)
+      lonsun = mod(v + w + 720.0,360.0)
+C  Ecliptic coordinates of sun (rectangular):
+      xs = r * cos(lonsun/rad)
+      ys = r * sin(lonsun/rad)
+
+C  Equatorial coordinates of sun (rectangular):
+      xe = xs
+      ye = ys * cos(ecl/rad)
+      ze = ys * sin(ecl/rad)
+
+C  RA and Dec in degrees:
+      RA = rad*atan2(ye,xe)
+      Dec = rad*atan2(ze,sqrt(xe*xe + ye*ye))
+
+      GMST0 = (Ls + 180.0)/15.0
+      LST = mod(GMST0+UT+lon/15.0+48.0,24.0)    !LST in hours
+      HA = 15.0*LST - RA                        !HA in degrees
+      xx = cos(HA/rad)*cos(Dec/rad)
+      yy = sin(HA/rad)*cos(Dec/rad)
+      zz =             sin(Dec/rad)
+      xhor = xx*sin(lat/rad) - zz*cos(lat/rad)
+      yhor = yy
+      zhor = xx*cos(lat/rad) + zz*sin(lat/rad)
+      Az = mod(rad*atan2(yhor,xhor) + 180.0 + 360.0,360.0)
+      El = rad*asin(zhor)
+      day=d-1.5
+
+      return
+      end

Added: branches/map65/libm65/symspec.f90
===================================================================
--- branches/map65/libm65/symspec.f90	                        (rev 0)
+++ branches/map65/libm65/symspec.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,193 @@
+subroutine symspec(k,nxpol,ndiskdat,nb,nbslider,idphi,nfsample,fgreen,   &amp;
+     iqadjust,iqapply,gainx,gainy,phasex,phasey,rejectx,rejecty,         &amp;
+     pxdb,pydb,ssz5a,nkhz,ihsym,nzap,slimit,lstrong)
+
+!  k        pointer to the most recent new data
+!  nxpol    0/1 to indicate single- or dual-polarization
+!  ndiskdat 0/1 to indicate if data from disk
+!  nb       0/1 status of noise blanker
+!  idphi    Phase correction for Y channel, degrees
+!  nfsample sample rate (Hz)
+!  fgreen   Frequency of green marker in I/Q calibrate mode (-48.0 to +48.0 kHz)
+!  iqadjust 0/1 to indicate whether IQ adjustment is active
+!  iqapply  0/1 to indicate whether to apply I/Q calibration
+!  pxdb     power in x channel (0-60 dB)
+!  pydb     power in y channel (0-60 dB)
+!  ssz5a    polarized spectrum, for waterfall display
+!  nkhz     integer kHz portion of center frequency, e.g., 125 for 144.125
+!  ihsym    index number of this half-symbol (1-322)
+!  nzap     number of samples zero'ed by noise blanker
+
+  parameter (NSMAX=60*96000)          !Total sample intervals per minute
+  parameter (NFFT=32768)              !Length of FFTs
+  real*8 ts,hsym
+  real*8 fcenter
+  common/datcom/dd(4,5760000),ss(4,322,NFFT),savg(4,NFFT),fcenter,nutc,junk(34)
+  real*4 ssz5a(NFFT),w(NFFT)
+  complex z,zfac
+  complex zsumx,zsumy
+  complex cx(NFFT),cy(NFFT)
+  complex cx0(0:1023),cx1(0:1023)
+  complex cy0(0:1023),cy1(0:1023)
+  logical*1 lstrong(0:1023)
+  data rms/999.0/,k0/99999999/,nadjx/0/,nadjy/0/
+  save
+
+  if(k.gt.5751000) go to 999
+  if(k.lt.NFFT) then
+     ihsym=0
+     go to 999             !Wait for enough samples to start
+  endif
+  if(k.lt.k0) k1=0
+  if(k0.eq.99999999) then
+     pi=4.0*atan(1.0)
+     do i=1,NFFT
+        w(i)=(sin(i*pi/NFFT))**2
+     enddo
+  endif
+
+  nzap=0
+  sigmas=1.5*(10.0**(0.01*nbslider)) + 0.7
+  peaklimit=sigmas*max(10.0,rms)
+  faclim=3.0
+  px=0.
+  py=0.
+
+  iqapply0=0
+  iqadjust0=0
+  if(iqadjust.ne.0) iqapply0=0
+  nwindow=2
+  nfft2=1024
+  kstep=nfft2
+  if(nwindow.ne.0) kstep=nfft2/2
+  nblks=(k-k1)/kstep
+  do nblk=1,nblks
+     j=k1+1
+     do i=0,nfft2-1
+        cx0(i)=cmplx(dd(1,j+i),dd(2,j+i))
+        if(nxpol.ne.0) cy0(i)=cmplx(dd(3,j+i),dd(4,j+i))
+     enddo
+     call timf2(nxpol,nfft2,nwindow,nb,peaklimit,iqadjust0,iqapply0,faclim,  &amp;
+          cx0,cy0,gainx,gainy,phasex,phasey,cx1,cy1,slimit,lstrong,          &amp;
+          px,py,nzap)
+
+     do i=0,kstep-1
+        dd(1,j+i)=real(cx1(i))
+        dd(2,j+i)=aimag(cx1(i))
+        if(nxpol.ne.0) then
+           dd(3,j+i)=real(cy1(i))
+           dd(4,j+i)=aimag(cy1(i))
+        endif
+     enddo
+     k1=k1+kstep
+  enddo
+
+  hsym=2048.d0*96000.d0/11025.d0      !Samples per JT65 half-symbol
+  if(nfsample.eq.95238)   hsym=2048.d0*95238.1d0/11025.d0
+  npts=NFFT                           !Samples used in each half-symbol FFT
+
+  if(k.lt.k0) then
+     ts=1.d0 - hsym
+     savg=0.
+     ihsym=0
+  endif
+  k0=k
+  ihsym=ihsym+1
+  ja=ts+hsym                          !Index of first sample
+  jb=ja+npts-1                        !Last sample
+
+  ts=ts+hsym
+  i=0
+  fac=0.0002
+  dphi=idphi/57.2957795
+  zfac=fac*cmplx(cos(dphi),sin(dphi))
+  do j=ja,jb                          !Copy data into cx, cy
+     x1=dd(1,j)
+     x2=dd(2,j)
+     if(nxpol.ne.0) then
+        x3=dd(3,j)
+        x4=dd(4,j)
+     else
+        x3=0.
+        x4=0.
+     endif
+     i=i+1
+     cx(i)=fac*cmplx(x1,x2)
+     cy(i)=zfac*cmplx(x3,x4)          !NB: cy includes dphi correction
+  enddo
+
+  if(nzap/178.lt.50 .and. (ndiskdat.eq.0 .or. ihsym.lt.280)) then
+     nsum=nblks*kstep - nzap
+     if(nsum.le.0) nsum=1
+     rmsx=sqrt(0.5*px/nsum)
+     rmsy=sqrt(0.5*py/nsum)
+     rms=rmsx
+     if(nxpol.ne.0) rms=sqrt((px+py)/(4.0*nsum))
+  endif
+  pxdb=0.
+  pydb=0.
+  if(rmsx.gt.1.0) pxdb=20.0*log10(rmsx)
+  if(rmsy.gt.1.0) pydb=20.0*log10(rmsy)
+  if(pxdb.gt.60.0) pxdb=60.0
+  if(pydb.gt.60.0) pydb=60.0
+
+  cx=w*cx                             !Apply window for 2nd forward FFT
+  if(nxpol.ne.0) cy=w*cy
+
+  call four2a(cx,NFFT,1,1,1)          !Second forward FFT
+  if(iqadjust.eq.0) nadjx=0
+  if(iqadjust.ne.0 .and. nadjx.lt.50) call iqcal(nadjx,cx,NFFT,gainx,phasex, &amp;
+                                                 zsumx,ipkx,rejectx0)
+  if(iqapply.ne.0) call iqfix(cx,NFFT,gainx,phasex)
+
+  if(nxpol.ne.0) then
+     call four2a(cy,NFFT,1,1,1)
+     if(iqadjust.eq.0) nadjy=0
+     if(iqadjust.ne.0 .and. nadjy.lt.50) call iqcal(nadjy,cy,NFFT,gainy,phasey,&amp;
+                                                 zsumy,ipky,rejecty)
+     if(iqapply.ne.0) call iqfix(cy,NFFT,gainy,phasey)
+  endif
+
+  n=ihsym
+  do i=1,NFFT
+     sx=real(cx(i))**2 + aimag(cx(i))**2  
+     ss(1,n,i)=sx                    ! Pol = 0
+     savg(1,i)=savg(1,i) + sx
+     
+     if(nxpol.ne.0) then
+        z=cx(i) + cy(i)
+        s45=0.5*(real(z)**2 + aimag(z)**2)
+        ss(2,n,i)=s45                   ! Pol = 45
+        savg(2,i)=savg(2,i) + s45
+
+        sy=real(cy(i))**2 + aimag(cy(i))**2
+        ss(3,n,i)=sy                    ! Pol = 90
+        savg(3,i)=savg(3,i) + sy
+        
+        z=cx(i) - cy(i)
+        s135=0.5*(real(z)**2 + aimag(z)**2)
+        ss(4,n,i)=s135                  ! Pol = 135
+        savg(4,i)=savg(4,i) + s135
+
+        z=cx(i)*conjg(cy(i))
+        q=sx - sy
+        u=2.0*real(z)
+        ssz5a(i)=0.707*sqrt(q*q + u*u)    !Spectrum of linear polarization
+! Leif's formula:
+!     ssz5a(i)=0.5*(sx+sy) + (real(z)**2 + aimag(z)**2 - sx*sy)/(sx+sy)
+     else
+        ssz5a(i)=sx
+     endif
+  enddo
+  if(ihsym.eq.278) then
+     if(iqadjust.ne.0 .and. ipkx.ne.0 .and. ipky.ne.0) then
+        rejectx=10.0*log10(savg(1,1+nfft-ipkx)/savg(1,1+ipkx))
+        rejecty=10.0*log10(savg(3,1+nfft-ipky)/savg(3,1+ipky))
+     endif
+  endif
+
+  nkhz=nint(1000.d0*(fcenter-int(fcenter)))
+  if(fcenter.eq.0.d0) nkhz=125
+
+999 return
+end subroutine symspec

Added: branches/map65/libm65/tastro.f90
===================================================================
--- branches/map65/libm65/tastro.f90	                        (rev 0)
+++ branches/map65/libm65/tastro.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,35 @@
+program tastro
+
+  implicit real*8 (a-h,o-z)
+
+  character grid*6
+  character*9 cauxra,cauxdec
+
+  character*12 clock(3)
+  integer nt(8)
+  equivalence (nt(1),nyear)
+
+  grid='FN20qi'
+  nfreq=144
+  cauxra='00:00:00'
+  
+10 call date_and_time(clock(1),clock(2),clock(3),nt)
+  ih=ihour-ntz/60
+  if(ih.le.0) then
+     ih=ih+24
+     nday=nday+1
+  endif
+  uth8=ih + imin/60.d0 + isec/3600.d0 + ims/3600000.d0 
+  call astro0(nyear,month,nday,uth8,nfreq,grid,cauxra,cauxdec,       &amp;
+     AzSun8,ElSun8,AzMoon8,ElMoon8,AzMoonB8,ElMoonB8,ntsky,ndop,ndop00,  &amp;
+     dbMoon8,RAMoon8,DecMoon8,HA8,Dgrd8,sd8,poloffset8,xnr8,dfdt,dfdt0,  &amp;
+     RaAux8,DecAux8,AzAux8,ElAux8,width1,width2,w501,w502,xlst8)
+  
+  write(*,1010) nyear,month,nday,ih,imin,isec,AzMoon8,ElMoon8,          &amp;
+       AzSun8,ElSun8,ndop,dgrd8,ntsky
+1010 format(i4,i3,i3,i4.2,':',i2.2,':',i2.2,4f8.1,i6,f6.1,i6)
+
+  call system('sleep 1')
+  go to 10
+
+end program tastro

Added: branches/map65/libm65/timer.f90
===================================================================
--- branches/map65/libm65/timer.f90	                        (rev 0)
+++ branches/map65/libm65/timer.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,110 @@
+subroutine timer(dname,k)
+
+! Times procedure number n between a call with k=0 (tstart) and with
+! k=1 (tstop). Accumulates sums of these times in array ut (user time).
+! Also traces all calls (for debugging purposes) if limtrace.gt.0
+
+  character*8 dname,name(50),space,ename
+  character*16 sname
+  logical on(50)
+  real ut(50),ut0(50),dut(50),tt(2)
+  integer ncall(50),nlevel(50),nparent(50)
+  integer onlevel(0:10)
+  common/tracer/ limtrace,lu
+  data eps/0.000001/,ntrace/0/
+  data level/0/,nmax/0/,space/'        '/
+  data limtrace/0/,lu/-1/
+  save
+
+  if(limtrace.lt.0) go to 999
+  if(lu.lt.1) lu=6
+  if(k.gt.1) go to 40                        !Check for &quot;all done&quot; (k&gt;1)
+  onlevel(0)=0
+
+  do n=1,nmax                                !Check for existing name
+     if(name(n).eq.dname) go to 20
+  enddo
+
+  nmax=nmax+1                                !This is a new one
+  n=nmax
+  ncall(n)=0
+  on(n)=.false.
+  ut(n)=eps
+  name(n)=dname
+
+20 if(k.eq.0) then                                !Get start times (k=0)
+     if(on(n)) print*,'Error in timer: ',dname,' already on.'
+     level=level+1                                !Increment the level
+     on(n)=.true.
+     ut0(n)=etime(tt)
+     ncall(n)=ncall(n)+1
+     if(ncall(n).gt.1.and.nlevel(n).ne.level) then
+        nlevel(n)=-1
+     else
+        nlevel(n)=level
+     endif
+     nparent(n)=onlevel(level-1)
+     onlevel(level)=n
+
+  else if(k.eq.1) then        !Get stop times and accumulate sums. (k=1)
+     if(on(n)) then
+        on(n)=.false.
+        ut1=etime(tt)
+        ut(n)=ut(n)+ut1-ut0(n)
+     endif
+     level=level-1
+  endif
+
+  ntrace=ntrace+1
+  if(ntrace.lt.limtrace) write(lu,1020) ntrace,dname,k,level,nparent(n)
+1020 format(i8,': ',a8,3i5)
+  go to 998
+
+! Write out the timer statistics
+
+40 write(lu,1040)
+1040 format(/'     name                 time  frac     dtime',       &amp;
+             ' dfrac  calls level parent'/73('-'))
+
+  if(k.gt.100) then
+     ndiv=k-100
+     do i=1,nmax
+        ncall(i)=ncall(i)/ndiv
+        ut(i)=ut(i)/ndiv
+     enddo
+  endif
+
+  total=ut(1)
+  sum=0.
+  sumf=0.
+  do i=1,nmax
+     dut(i)=ut(i)
+     do j=i,nmax
+        if(nparent(j).eq.i) dut(i)=dut(i)-ut(j)
+     enddo
+     utf=ut(i)/total
+     dutf=dut(i)/total
+     sum=sum+dut(i)
+     sumf=sumf+dutf
+     kk=nlevel(i)
+     sname=space(1:kk)//name(i)//space(1:8-kk)
+     ename=space
+     if(i.ge.2) ename=name(nparent(i))
+     write(lu,1060) float(i),sname,ut(i),utf,dut(i),dutf,           &amp;
+          ncall(i),nlevel(i),ename
+1060 format(f4.0,a16,2(f10.2,f6.2),i7,i5,2x,a8)
+  enddo
+
+  write(lu,1070) sum,sumf
+1070 format(/36x,f10.2,f6.2)
+  nmax=0
+  eps=0.000001
+  ntrace=0
+  level=0
+  space='        '
+  onlevel(0)=0
+
+998 flush(lu)
+
+999 return
+end subroutine timer

Added: branches/map65/libm65/timeval.h
===================================================================
--- branches/map65/libm65/timeval.h	                        (rev 0)
+++ branches/map65/libm65/timeval.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,74 @@
+/*
+ * timeval.h    1.0 01/12/19
+ *
+ * Defines gettimeofday, timeval, etc. for Win32
+ *
+ * By Wu Yongwei
+ *
+ */
+
+#ifndef _TIMEVAL_H
+#define _TIMEVAL_H
+
+#ifdef _WIN32
+
+#define WIN32_LEAN_AND_MEAN
+#include &lt;windows.h&gt;
+#include &lt;time.h&gt;
+
+#ifndef __GNUC__
+#define EPOCHFILETIME (116444736000000000i64)
+#else
+#define EPOCHFILETIME (116444736000000000LL)
+#endif
+
+//struct timeval {
+//    long tv_sec;        /* seconds */
+//    long tv_usec;  /* microseconds */
+//};
+
+struct timezone {
+    int tz_minuteswest; /* minutes W of Greenwich */
+    int tz_dsttime;     /* type of dst correction */
+};
+
+__inline int gettimeofday(struct timeval *tv, struct timezone *tz)
+{
+    FILETIME        ft;
+    LARGE_INTEGER   li;
+    __int64         t;
+    static int      tzflag;
+
+    if (tv)
+    {
+        GetSystemTimeAsFileTime(&amp;ft);
+        li.LowPart  = ft.dwLowDateTime;
+        li.HighPart = ft.dwHighDateTime;
+        t  = li.QuadPart;       /* In 100-nanosecond intervals */
+        t -= EPOCHFILETIME;     /* Offset to the Epoch time */
+        t /= 10;                /* In microseconds */
+        tv-&gt;tv_sec  = (long)(t / 1000000);
+        tv-&gt;tv_usec = (long)(t % 1000000);
+    }
+
+    if (tz)
+    {
+        if (!tzflag)
+        {
+            _tzset();
+            tzflag++;
+        }
+        tz-&gt;tz_minuteswest = _timezone / 60;
+        tz-&gt;tz_dsttime = _daylight;
+    }
+
+    return 0;
+}
+
+#else  /* _WIN32 */
+
+#include &lt;sys/time.h&gt;
+
+#endif /* _WIN32 */
+
+#endif /* _TIMEVAL_H */

Added: branches/map65/libm65/timf2.f90
===================================================================
--- branches/map65/libm65/timf2.f90	                        (rev 0)
+++ branches/map65/libm65/timf2.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,220 @@
+subroutine timf2(nxpol,nfft,nwindow,nb,peaklimit,iqadjust,iqapply,faclim,   &amp;
+  cx0,cy0,gainx,gainy,phasex,phasey,cx1,cy1,slimit,lstrong,px,py,nzap)
+
+! Sequential processing of time-domain I/Q data, using Linrad-like
+! &quot;first FFT&quot; and &quot;first backward FFT&quot;.  
+
+!  cx0,cy0      - complex input data
+!  nfft      - length of FFTs
+!  nwindow   - 0 for no window, 2 for sin^2 window
+!  iqapply   - 0/1 determines if I/Q phase and amplitude corrections applied
+!  gainx,y   - gain error in Q channel, relative to I
+!  phasex,y  - phase error
+!  cx1,cy1   - output data
+
+! Non-windowed processing means no overlap, so kstep=nfft.  
+! Sin^2 window has 50% overlap, kstep=nfft/2.
+
+! Frequencies with strong signals are identified and separated.  The back
+! transforms are done separately for weak and strong signals, so that
+! noise blanking can be applied to the weak-signal portion.  Strong and
+! weak are finally re-combined in the time domain.
+
+  parameter (MAXFFT=1024,MAXNH=MAXFFT/2)
+  parameter (MAXSIGS=100)
+  complex cx0(0:nfft-1),cx1(0:nfft-1)
+  complex cy0(0:nfft-1),cy1(0:nfft-1)
+  complex cx(0:MAXFFT-1),cxt(0:MAXFFT-1)
+  complex cy(0:MAXFFT-1),cyt(0:MAXFFT-1)
+  complex cxs(0:MAXFFT-1),covxs(0:MAXNH-1)     !Strong X signals
+  complex cys(0:MAXFFT-1),covys(0:MAXNH-1)     !Strong Y signals
+  complex cxw(0:MAXFFT-1),covxw(0:MAXNH-1)     !Weak X signals
+  complex cyw(0:MAXFFT-1),covyw(0:MAXNH-1)     !Weak Y signals
+  real*4 w(0:MAXFFT-1)
+  real*4 s(0:MAXFFT-1),stmp(0:MAXFFT-1)
+  logical*1 lstrong(0:MAXFFT-1),lprev
+  integer ia(MAXSIGS),ib(MAXSIGS)
+  complex h,u,v
+  logical first
+  data first/.true./
+  save w,covxs,covxw,covys,covyw,s,ntc,ntot,nh,kstep,fac,first
+
+  if(first) then
+     pi=4.0*atan(1.0)
+     do i=0,nfft-1
+        w(i)=(sin(i*pi/nfft))**2
+     enddo
+     covxs=0.
+     covxw=0.
+     covys=0.
+     covyw=0.
+     s=0.
+     ntc=0
+     ntot=0
+     nh=nfft/2
+     kstep=nfft
+     if(nwindow.eq.2) kstep=nh
+     fac=1.0/nfft
+     slimit=1.e30
+     first=.false.
+  endif
+
+  cx(0:nfft-1)=cx0
+  if(nwindow.eq.2) cx(0:nfft-1)=w(0:nfft-1)*cx(0:nfft-1)
+  call four2a(cx,nfft,1,1,1)                       !First forward FFT
+
+  if(nxpol.ne.0) then
+     cy(0:nfft-1)=cy0
+     if(nwindow.eq.2) cy(0:nfft-1)=w(0:nfft-1)*cy(0:nfft-1)
+     call four2a(cy,nfft,1,1,1)                    !First forward FFT
+  endif
+
+  if(iqapply.ne.0) then                            !Apply I/Q corrections
+     h=gainx*cmplx(cos(phasex),sin(phasex))
+     v=0.
+     do i=0,nfft-1
+        u=cx(i)
+        if(i.gt.0) v=cx(nfft-i)
+        x=real(u)  + real(v)  - (aimag(u) + aimag(v))*aimag(h) +         &amp;
+             (real(u) - real(v))*real(h)
+        y=aimag(u) - aimag(v) + (aimag(u) + aimag(v))*real(h)  +         &amp;
+             (real(u) - real(v))*aimag(h)
+        cxt(i)=0.5*cmplx(x,y)
+     enddo
+  else
+     cxt(0:nfft-1)=cx(0:nfft-1)
+  endif
+
+  if(nxpol.ne.0) then
+     if(iqapply.ne.0) then                         !Apply I/Q corrections
+        h=gainy*cmplx(cos(phasey),sin(phasey))
+        v=0.
+        do i=0,nfft-1
+           u=cy(i)
+           if(i.gt.0) v=cy(nfft-i)
+           x=real(u)  + real(v)  - (aimag(u) + aimag(v))*aimag(h) +         &amp;
+                (real(u) - real(v))*real(h)
+           y=aimag(u) - aimag(v) + (aimag(u) + aimag(v))*real(h)  +         &amp;
+                (real(u) - real(v))*aimag(h)
+           cyt(i)=0.5*cmplx(x,y)
+        enddo
+     else
+        cyt(0:nfft-1)=cy(0:nfft-1)
+     endif
+  endif
+
+! Identify frequencies with strong signals, copy frequency-domain
+! data into array cs (strong) or cw (weak).
+
+  ntot=ntot+1
+  if(mod(ntot,128).eq.5) then
+     call pctile(s,stmp,1024,50,xmedian)
+     slimit=faclim*xmedian
+  endif
+
+  if(ntc.lt.96000/nfft) ntc=ntc+1
+  uu=1.0/ntc
+  smax=0.
+  do i=0,nfft-1
+     p=real(cxt(i))**2 + aimag(cxt(i))**2
+     if(nxpol.ne.0) p=p + real(cyt(i))**2 + aimag(cyt(i))**2
+     s(i)=(1.0-uu)*s(i) + uu*p
+     lstrong(i)=(s(i).gt.slimit)
+     if(s(i).gt.smax) smax=s(i)
+  enddo
+
+  nsigs=0
+  lprev=.false.
+  iwid=1
+  ib=-99
+  do i=0,nfft-1
+     if(lstrong(i) .and. (.not.lprev)) then
+        if(nsigs.lt.MAXSIGS) nsigs=nsigs+1
+        ia(nsigs)=i-iwid
+        if(ia(nsigs).lt.0) ia(nsigs)=0
+     endif
+     if(.not.lstrong(i) .and. lprev) then
+        ib(nsigs)=i-1+iwid
+        if(ib(nsigs).gt.nfft-1) ib(nsigs)=nfft-1
+     endif
+     lprev=lstrong(i)
+  enddo
+
+  if(nsigs.gt.0) then
+     do i=1,nsigs
+        ja=ia(i)
+        jb=ib(i)
+        if(ja.lt.0 .or. ja.gt.nfft-1 .or. jb.lt.0 .or. jb.gt.nfft-1) then
+           cycle
+        endif
+        if(jb.eq.-99) jb=ja + min(2*iwid,nfft-1)
+        lstrong(ja:jb)=.true.
+     enddo
+  endif
+
+  do i=0,nfft-1
+     if(lstrong(i)) then
+        cxs(i)=fac*cxt(i)
+        cxw(i)=0.
+        if(nxpol.ne.0) then
+           cys(i)=fac*cyt(i)
+           cyw(i)=0.
+        endif
+     else
+        cxw(i)=fac*cxt(i)
+        cxs(i)=0.
+        if(nxpol.ne.0) then
+           cyw(i)=fac*cyt(i)
+           cys(i)=0.
+        endif
+     endif
+  enddo
+
+  call four2a(cxw,nfft,1,-1,1)                 !Transform weak and strong X
+  call four2a(cxs,nfft,1,-1,1)                 !back to time domain, separately
+
+  if(nxpol.ne.0) then
+     call four2a(cyw,nfft,1,-1,1)              !Transform weak and strong Y
+     call four2a(cys,nfft,1,-1,1)              !back to time domain, separately
+  endif
+
+  if(nwindow.eq.2) then
+     cxw(0:nh-1)=cxw(0:nh-1)+covxw(0:nh-1)     !Add previous segment's 2nd half
+     covxw(0:nh-1)=cxw(nh:nfft-1)              !Save 2nd half
+     cxs(0:nh-1)=cxs(0:nh-1)+covxs(0:nh-1)     !Ditto for strong signals
+     covxs(0:nh-1)=cxs(nh:nfft-1)
+
+     if(nxpol.ne.0) then
+        cyw(0:nh-1)=cyw(0:nh-1)+covyw(0:nh-1)  !Add previous segment's 2nd half
+        covyw(0:nh-1)=cyw(nh:nfft-1)           !Save 2nd half
+        cys(0:nh-1)=cys(0:nh-1)+covys(0:nh-1)  !Ditto for strong signals
+        covys(0:nh-1)=cys(nh:nfft-1)
+     endif
+  endif
+
+! Apply noise blanking to weak data
+  if(nb.ne.0) then
+     do i=0,kstep-1
+        peak=abs(cxw(i))
+        if(nxpol.ne.0) peak=max(peak,abs(cyw(i)))
+        if(peak.gt.peaklimit) then
+           cxw(i)=0.
+           if(nxpol.ne.0) cyw(i)=0.
+           nzap=nzap+1
+        endif
+     enddo
+  endif
+
+! Compute power levels from weak data only
+  do i=0,kstep-1
+     px=px + real(cxw(i))**2 + aimag(cxw(i))**2
+     if(nxpol.ne.0) py=py + real(cyw(i))**2 + aimag(cyw(i))**2
+  enddo
+
+  cx1(0:kstep-1)=cxw(0:kstep-1) + cxs(0:kstep-1)     !Recombine weak + strong
+  if(nxpol.ne.0) then
+     cy1(0:kstep-1)=cyw(0:kstep-1) + cys(0:kstep-1)    !Weak + strong
+  endif
+
+  return
+end subroutine timf2

Added: branches/map65/libm65/tm2.f90
===================================================================
--- branches/map65/libm65/tm2.f90	                        (rev 0)
+++ branches/map65/libm65/tm2.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,14 @@
+subroutine tm2(day,xlat4,xlon4,xl4,b4)
+
+  implicit real*8 (a-h,o-z)
+  parameter (RADS=0.0174532925199433d0)
+
+  real*4 day4,xlat4,xlon4,xl4,b4
+
+  glat=xlat4*RADS
+  glong=xlon4*RADS
+  call tmoonsub(day,glat,glong,el,rv,xl,b,pax)
+  xl4=xl
+  b4=b
+
+end subroutine tm2

Added: branches/map65/libm65/tmoonsub.c
===================================================================
--- branches/map65/libm65/tmoonsub.c	                        (rev 0)
+++ branches/map65/libm65/tmoonsub.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,514 @@
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;math.h&gt;
+
+#define RADS 0.0174532925199433
+#define DEGS 57.2957795130823
+#define TPI 6.28318530717959
+#define PI 3.1415927
+
+/* ratio of     earth radius to astronomical unit */
+#define ER_OVER_AU 0.0000426352325194252
+
+/* all prototypes here */
+
+double getcoord(int coord);
+void getargs(int argc, char *argv[], int *y, int *m, double *tz, double *glong, double *glat);
+double range(double y);
+double rangerad(double y);
+double days(int y, int m, int dn, double hour);
+double days_(int *y, int *m, int *dn, double *hour);
+void moonpos(double, double *, double *, double *);
+void sunpos(double , double *, double *, double *);
+double moontransit(int y, int m, int d, double timezone, double glat, double glong, int *nt);
+double atan22(double y, double x);
+double epsilon(double d);
+void equatorial(double d, double *lon, double *lat, double *r);
+void ecliptic(double d, double *lon, double *lat, double *r);
+double gst(double d);
+void topo(double lst, double glat, double *alp, double *dec, double *r);
+double alt(double glat, double ha, double dec);
+void libration(double day, double lambda, double beta, double alpha, double *l, double *b, double *p);
+void illumination(double day, double lra, double ldec, double dr, double sra, double sdec, double *pabl, double *ill);
+int daysinmonth(int y, int m);
+int isleap(int y);
+void tmoonsub_(double *day, double *glat, double *glong, double *moonalt, 
+   double *mrv, double *l, double *b, double *paxis);
+
+static const char
+*usage = &quot;  Usage: tmoon date[yyyymm] timz[+/-h.hh] long[+/-dddmm] lat[+/-ddmm]\n&quot;
+            &quot;example: tmoon 200009 0 -00155 5230\n&quot;;
+
+/*
+  getargs() gets the arguments from the command line, does some basic error
+  checking, and converts arguments into numerical form. Arguments are passed
+  back in pointers. Error messages print to stderr so re-direction of output
+  to file won't leave users blind. Error checking prints list of all errors
+  in a command line before quitting.
+*/
+void getargs(int argc, char *argv[], int *y, int *m, double *tz,
+             double *glong, double *glat) {
+
+  int date, latitude, longitude;
+  int mflag = 0, yflag = 0, longflag = 0, latflag = 0, tzflag = 0;
+  int longminflag = 0, latminflag = 0, dflag = 0;
+
+  /* if not right number of arguments, then print example command line */
+
+  if (argc !=5) {
+    fprintf(stderr, usage);
+    exit(EXIT_FAILURE);
+  }
+
+  date = atoi(argv[1]);
+  *y = date / 100;
+  *m = date - *y * 100;
+  *tz = (double) atof(argv[2]);
+  longitude = atoi(argv[3]);
+  latitude = atoi(argv[4]);
+  *glong = RADS * getcoord(longitude);
+  *glat = RADS * getcoord(latitude);
+
+  /* set a flag for each error found */
+
+  if (*m &gt; 12 || *m &lt; 1) mflag = 1;
+  if (*y &gt; 2500) yflag = 1;
+  if (date &lt; 150001) dflag = 1;
+  if (fabs((float) *glong) &gt; 180 * RADS) longflag = 1;
+  if (abs(longitude) % 100 &gt; 59) longminflag = 1;
+  if (fabs((float) *glat) &gt; 90 * RADS) latflag = 1;
+  if (abs(latitude) % 100 &gt; 59) latminflag = 1;
+  if (fabs((float) *tz) &gt; 12) tzflag = 1;
+
+  /* print all the errors found */
+  
+  if (dflag == 1) {
+    fprintf(stderr, &quot;date: dates must be in form yyyymm, gregorian, and later than 1500 AD\n&quot;);
+  }
+  if (yflag == 1) {
+    fprintf(stderr, &quot;date: too far in future - accurate from 1500 to 2500\n&quot;);
+  }
+  if (mflag == 1) {
+    fprintf(stderr, &quot;date: month must be in range 0 to 12, eg - August 2000 is entered as 200008\n&quot;);
+  }
+  if (tzflag == 1) {
+    fprintf(stderr, &quot;timz: must be in range +/- 12 hours, eg -6 for Chicago\n&quot;);
+  }
+  if (longflag == 1) {
+    fprintf(stderr, &quot;long: must be in range +/- 180 degrees\n&quot;);
+  }
+  if (longminflag == 1) {
+    fprintf(stderr, &quot;long: last two digits are arcmin - max 59\n&quot;);
+  }
+  if (latflag == 1) {
+    fprintf(stderr, &quot; lat: must be in range +/- 90 degrees\n&quot;);
+  }
+  if (latminflag == 1) {
+    fprintf(stderr, &quot; lat: last two digits are arcmin - max 59\n&quot;);
+  }
+
+  /* quits if one or more flags set */
+
+  if (dflag + mflag + yflag + longflag + latflag + tzflag + longminflag + latminflag &gt; 0) {
+    exit(EXIT_FAILURE);
+  }
+  
+}
+
+/*
+   returns coordinates in decimal degrees given the
+   coord as a ddmm value stored in an integer.
+*/
+double getcoord(int coord) {
+  int west = 1;
+  double glg, deg;
+  if (coord &lt; 0) west = -1;
+  glg = fabs((double) coord/100);
+  deg = floor(glg);
+  glg = west* (deg + (glg - deg)*100 / 60);
+  return(glg);
+}
+
+/*
+  days() takes the year, month, day in the month and decimal hours
+  in the day and returns the number of days since J2000.0.
+  Assumes Gregorian calendar.
+*/
+double days(int y, int m, int d, double h) {
+  int a, b;
+  double day;
+  
+  /*
+    The lines below work from 1900 march to feb 2100
+    a = 367 * y - 7 * (y + (m + 9) / 12) / 4 + 275 * m / 9 + d;
+    day = (double)a - 730531.5 + hour / 24;
+  */
+
+  /*  These lines work for any Gregorian date since 0 AD */
+  if (m ==1 || m==2) {
+    m +=12;
+    y -= 1;
+  }
+  a = y / 100;
+  b = 2 - a + a/4;
+  day = floor(365.25*(y + 4716)) + floor(30.6001*(m + 1))
+    + d + b - 1524.5 - 2451545 + h/24;
+  return(day);
+}
+double days_(int *y0, int *m0, int *d0, double *h0) 
+{
+  return days(*y0,*m0,*d0,*h0);
+}
+
+/*
+Returns 1 if y a leap year, and 0 otherwise, according
+to the Gregorian calendar
+*/
+int isleap(int y) {
+  int a = 0;
+  if(y % 4 == 0) a = 1;
+  if(y % 100 == 0) a = 0;
+  if(y % 400 == 0) a = 1;
+  return(a);
+}
+
+/*
+Given the year and the month, function returns the
+number of days in the month. Valid for Gregorian
+calendar.
+*/
+int daysinmonth(int y, int m) {
+  int b = 31;
+  if(m == 2) {
+    if(isleap(y) == 1) b= 29;
+    else b = 28;
+  }
+  if(m == 4 || m == 6 || m == 9 || m == 11) b = 30;
+  return(b);
+}
+
+/*
+moonpos() takes days from J2000.0 and returns ecliptic coordinates
+of moon in the pointers. Note call by reference.
+This function is within a couple of arcminutes most of the time,
+and is truncated from the Meeus Ch45 series, themselves truncations of
+ELP-2000. Returns moon distance in earth radii.
+Terms have been written out explicitly rather than using the
+table based method as only a small number of terms is
+retained.
+*/
+void moonpos(double d, double *lambda, double *beta, double *rvec) {
+  double dl, dB, dR, L, D, M, M1, F, e, lm, bm, rm, t;
+
+  t = d / 36525;
+
+  L = range(218.3164591  + 481267.88134236  * t) * RADS;
+  D = range(297.8502042  + 445267.1115168  * t) * RADS;
+  M = range(357.5291092  + 35999.0502909  * t) * RADS;
+  M1 = range(134.9634114  + 477198.8676313  * t - .008997 * t * t) * RADS;
+  F = range(93.27209929999999  + 483202.0175273  * t - .0034029*t*t)*RADS;
+  e = 1 - .002516 * t;
+
+  dl =      6288774 * sin(M1);
+  dl +=     1274027 * sin(2 * D - M1);
+  dl +=      658314 * sin(2 * D);
+  dl +=      213618 * sin(2 * M1);
+  dl -=  e * 185116 * sin(M);
+  dl -=      114332 * sin(2 * F) ;
+  dl +=       58793 * sin(2 * D - 2 * M1);
+  dl +=   e * 57066 * sin(2 * D - M - M1) ;
+  dl +=       53322 * sin(2 * D + M1);
+  dl +=   e * 45758 * sin(2 * D - M);
+  dl -=   e * 40923 * sin(M - M1);
+  dl -=       34720 * sin(D) ;
+  dl -=   e * 30383 * sin(M + M1) ;
+  dl +=       15327 * sin(2 * D - 2 * F) ;
+  dl -=       12528 * sin(M1 + 2 * F);
+  dl +=       10980 * sin(M1 - 2 * F);
+  lm = rangerad(L + dl / 1000000 * RADS);
+
+  dB =   5128122 * sin(F);
+  dB +=   280602 * sin(M1 + F);
+  dB +=   277693 * sin(M1 - F);
+  dB +=   173237 * sin(2 * D - F);
+  dB +=    55413 * sin(2 * D - M1 + F);
+  dB +=    46271 * sin(2 * D - M1 - F);
+  dB +=    32573 * sin(2 * D + F);
+  dB +=    17198 * sin(2 * M1 + F);
+  dB +=     9266 * sin(2 * D + M1 - F);
+  dB +=     8822 * sin(2 * M1 - F);
+  dB += e * 8216 * sin(2 * D - M - F);
+  dB +=     4324 * sin(2 * D - 2 * M1 - F);
+  bm = dB / 1000000 * RADS;
+
+  dR =    -20905355 * cos(M1);
+  dR -=     3699111 * cos(2 * D - M1);
+  dR -=     2955968 * cos(2 * D);
+  dR -=      569925 * cos(2 * M1);
+  dR +=   e * 48888 * cos(M);
+  dR -=        3149 * cos(2 * F);
+  dR +=      246158 * cos(2 * D - 2 * M1);
+  dR -=  e * 152138 * cos(2 * D - M - M1) ;
+  dR -=      170733 * cos(2 * D + M1);
+  dR -=  e * 204586 * cos(2 * D - M);
+  dR -=  e * 129620 * cos(M - M1);
+  dR +=      108743 * cos(D);
+  dR +=  e * 104755 * cos(M + M1);
+  dR +=       79661 * cos(M1 - 2 * F);
+  rm = 385000.56  + dR / 1000;
+
+  *lambda = lm;
+  *beta = bm;
+  /* distance to Moon must be in Earth radii */
+  *rvec = rm / 6378.14;
+}
+
+/*
+topomoon() takes the local siderial time, the geographical
+latitude of the observer, and pointers to the geocentric
+equatorial coordinates. The function overwrites the geocentric
+coordinates with topocentric coordinates on a simple spherical
+earth model (no polar flattening). Expects Moon-Earth distance in
+Earth radii.    Formulas scavenged from Astronomical Almanac 'low
+precision formulae for Moon position' page D46.
+*/
+
+void topo(double lst, double glat, double *alp, double *dec, double *r) {
+  double x, y, z, r1;
+  x = *r * cos(*dec) * cos(*alp) - cos(glat) * cos(lst);
+  y = *r * cos(*dec) * sin(*alp) - cos(glat) * sin(lst);
+  z = *r * sin(*dec)  - sin(glat);
+  r1 = sqrt(x*x + y*y + z*z);
+  *alp = atan22(y, x);
+  *dec = asin(z / r1);
+  *r = r1;
+}
+
+/*
+moontransit() takes date, the time zone and geographic longitude
+of observer and returns the time (decimal hours) of lunar transit
+on that day if there is one, and sets the notransit flag if there
+isn't. See Explanatory Supplement to Astronomical Almanac
+section 9.32 and 9.31 for the method.
+*/
+
+double moontransit(int y, int m, int d, double tz, double glat, double glong, int *notransit) {
+  double hm, ht, ht1, lon, lat, rv, dnew, lst;
+  int itcount;
+
+  ht1 = 180 * RADS;
+  ht = 0;
+  itcount = 0;
+  *notransit = 0;
+  do {
+    ht = ht1;
+    itcount++;
+    dnew = days(y, m, d, ht * DEGS/15) - tz/24;
+    lst = gst(dnew) + glong;
+    /* find the topocentric Moon ra (hence hour angle) and dec */
+    moonpos(dnew, &amp;lon, &amp;lat, &amp;rv);
+    equatorial(dnew, &amp;lon, &amp;lat, &amp;rv);
+    topo(lst, glat, &amp;lon, &amp;lat, &amp;rv);
+    hm = rangerad(lst -  lon);
+    ht1 = rangerad(ht - hm);
+    /* if no convergence, then no transit on that day */
+    if (itcount &gt; 30) {
+      *notransit = 1;
+      break;
+    }
+  }
+  while (fabs(ht - ht1) &gt; 0.04 * RADS);
+  return(ht1);
+}
+
+/*
+  Calculates the selenographic coordinates of either the sub Earth point
+  (optical libration) or the sub-solar point (selen. coords of centre of
+  bright hemisphere).  Based on Meeus chapter 51 but neglects physical
+  libration and nutation, with some simplification of the formulas.
+*/
+void libration(double day, double lambda, double beta, double alpha, double *l, double *b, double *p) {
+  double i, f, omega, w, y, x, a, t, eps;
+  t = day / 36525;
+  i = 1.54242 * RADS;
+  eps = epsilon(day);
+  f = range(93.2720993 + 483202.0175273 * t - .0034029 * t * t) * RADS;
+  omega = range(125.044555 - 1934.1361849 * t + .0020762 * t * t) * RADS;
+  w = lambda - omega;
+  y = sin(w) * cos(beta) * cos(i) - sin(beta) * sin(i);
+  x = cos(w) * cos(beta);
+  a = atan22(y, x);
+  *l = a - f;
+
+  /*  kludge to catch cases of 'round the back' angles  */
+  if (*l &lt; -90 * RADS) *l += TPI;
+  if (*l &gt; 90 * RADS)  *l -= TPI;
+  *b = asin(-sin(w) * cos(beta) * sin(i) - sin(beta) * cos(i));
+
+  /*  pa pole axis - not used for Sun stuff */
+  x = sin(i) * sin(omega);
+  y = sin(i) * cos(omega) * cos(eps) - cos(i) * sin(eps);
+  w = atan22(x, y);
+  *p = rangerad(asin(sqrt(x*x + y*y) * cos(alpha - w) / cos(*b)));
+}
+
+/*
+  Takes: days since J2000.0, eq coords Moon, ratio of moon to sun distance,
+  eq coords Sun
+  Returns: position angle of bright limb wrt NCP, percentage illumination
+  of Sun
+*/
+void illumination(double day, double lra, double ldec, double dr, double sra, double sdec, double *pabl, double *ill) {
+  double x, y, phi, i;
+  y = cos(sdec) * sin(sra - lra);
+  x = sin(sdec) * cos(ldec) - cos(sdec) * sin(ldec) * cos (sra - lra);
+  *pabl = atan22(y, x);
+  phi = acos(sin(sdec) * sin(ldec) + cos(sdec) * cos(ldec) * cos(sra-lra));
+  i = atan22(sin(phi) , (dr - cos(phi)));
+  *ill = 0.5*(1 + cos(i));
+}
+
+/*
+sunpos() takes days from J2000.0 and returns ecliptic longitude
+of Sun in the pointers. Latitude is zero at this level of precision,
+but pointer left in for consistency in number of arguments.
+This function is within 0.01 degree (1 arcmin) almost all the time
+for a century either side of J2000.0. This is from the 'low precision
+fomulas for the Sun' from C24 of Astronomical Alamanac
+*/
+void sunpos(double d, double *lambda, double *beta, double *rvec) {
+  double L, g, ls, bs, rs;
+
+  L = range(280.461 + .9856474 * d) * RADS;
+  g = range(357.528 + .9856003 * d) * RADS;
+  ls = L + (1.915 * sin(g) + .02 * sin(2 * g)) * RADS;
+  bs = 0;
+  rs = 1.00014 - .01671 * cos(g) - .00014 * cos(2 * g);
+  *lambda = ls;
+  *beta = bs;
+  *rvec = rs;
+}
+
+/*
+this routine returns the altitude given the days since J2000.0
+the hour angle and declination of the object and the latitude
+of the observer. Used to find the Sun's altitude to put a letter
+code on the transit time, and to find the Moon's altitude at
+transit just to make sure that the Moon is visible.
+*/
+double alt(double glat, double ha, double dec) {
+  return(asin(sin(dec) * sin(glat) + cos(dec) * cos(glat) * cos(ha)));
+}
+
+/* returns an angle in degrees in the range 0 to 360 */
+double range(double x) {
+  double a, b;
+  b = x / 360;
+  a = 360 * (b - floor(b));
+  if (a &lt; 0)
+    a = 360 + a;
+  return(a);
+}
+
+/* returns an angle in rads in the range 0 to two pi */
+double rangerad(double x) {
+  double a, b;
+  b = x / TPI;
+  a = TPI * (b - floor(b));
+  if (a &lt; 0)
+    a = TPI + a;
+  return(a);
+}
+
+/*
+gets the atan2 function returning angles in the right
+order and  range
+*/
+double atan22(double y, double x) {
+  double a;
+
+  a = atan2(y, x);
+  if (a &lt; 0) a += TPI;
+  return(a);
+}
+
+/*
+returns mean obliquity of ecliptic in radians given days since
+J2000.0.
+*/
+double epsilon(double d) {
+  double t = d/ 36525;
+  return((23.4392911111111 - (t* (46.8150 + 0.00059*t)/3600)) *RADS);
+}
+
+/*
+replaces ecliptic coordinates with equatorial coordinates
+note: call by reference destroys original values
+R is unchanged.
+*/
+void equatorial(double d, double *lon, double *lat, double *r) {
+  double  eps, ceps, seps, l, b;
+
+  l = *lon;
+  b = * lat;
+  eps = epsilon(d);
+  ceps = cos(eps);
+  seps = sin(eps);
+  *lon = atan22(sin(l)*ceps - tan(b)*seps, cos(l));
+  *lat = asin(sin(b)*ceps + cos(b)*seps*sin(l));
+}
+
+/*
+replaces equatorial coordinates with ecliptic ones. Inverse
+of above, but used to find topocentric ecliptic coords.
+*/
+void ecliptic(double d, double *lon, double *lat, double *r) {
+  double  eps, ceps, seps, alp, dec;
+  alp = *lon;
+  dec = *lat;
+  eps = epsilon(d);
+  ceps = cos(eps);
+  seps = sin(eps);
+  *lon = atan22(sin(alp)*ceps + tan(dec)*seps, cos(alp));
+  *lat = asin(sin(dec)*ceps - cos(dec)*seps*sin(alp));
+}
+
+/*
+returns the siderial time at greenwich meridian as
+an angle in radians given the days since J2000.0
+*/
+double gst( double d) {
+  double t = d / 36525;
+  double theta;
+  theta = range(280.46061837 + 360.98564736629 * d + 0.000387933 * t * t);
+  return(theta * RADS);
+}
+
+void tmoonsub_(double *day, double *glat, double *glong, double *moonalt, 
+   double *mrv, double *l, double *b, double *paxis)
+{
+  double mlambda, mbeta;
+  double malpha, mdelta;
+  double lst, mhr;
+  double tlambda, tbeta, trv;
+
+  lst = gst(*day) + *glong;
+      
+  /* find Moon topocentric coordinates for libration calculations */
+
+  moonpos(*day, &amp;mlambda, &amp;mbeta, mrv);
+  malpha = mlambda;
+  mdelta = mbeta;
+  equatorial(*day, &amp;malpha, &amp;mdelta, mrv);
+  topo(lst, *glat, &amp;malpha, &amp;mdelta, mrv);
+  mhr = rangerad(lst - malpha);
+  *moonalt = alt(*glat, mhr, mdelta);
+      
+  /* Optical libration and Position angle of the Pole */
+
+  tlambda = malpha;
+  tbeta = mdelta;
+  trv = *mrv;
+  ecliptic(*day, &amp;tlambda, &amp;tbeta, &amp;trv);
+  libration(*day, tlambda, tbeta, malpha,  l, b, paxis);
+}

Added: branches/map65/libm65/toxyz.f
===================================================================
--- branches/map65/libm65/toxyz.f	                        (rev 0)
+++ branches/map65/libm65/toxyz.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,25 @@
+      subroutine toxyz(alpha,delta,r,vec)
+
+      implicit real*8 (a-h,o-z)
+      real*8 vec(3)
+
+      vec(1)=r*cos(delta)*cos(alpha)
+      vec(2)=r*cos(delta)*sin(alpha)
+      vec(3)=r*sin(delta)
+
+      return
+      end
+
+      subroutine fromxyz(vec,alpha,delta,r)
+
+      implicit real*8 (a-h,o-z)
+      real*8 vec(3)
+      data twopi/6.283185307d0/
+
+      r=sqrt(vec(1)**2 + vec(2)**2 + vec(3)**2)
+      alpha=atan2(vec(2),vec(1))
+      if(alpha.lt.0.d0) alpha=alpha+twopi
+      delta=asin(vec(3)/r)
+
+      return
+      end

Added: branches/map65/libm65/trimlist.f
===================================================================
--- branches/map65/libm65/trimlist.f	                        (rev 0)
+++ branches/map65/libm65/trimlist.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,28 @@
+      subroutine trimlist(sig,km,ftol,indx,nsiz,nz)
+
+      parameter (MAXMSG=1000)             !Size of decoded message list
+      real sig(MAXMSG,30)
+      integer indx(MAXMSG),nsiz(MAXMSG)
+
+C     1      2     3    4    5    6     7     8
+C   nfile  nutc  freq  snr  dt  ipol  flip  sync
+
+      call indexx(km,sig(1,3),indx)            !Sort list by frequency
+
+      n=1
+      i0=1
+      do i=2,km         
+         j0=indx(i-1)
+         j=indx(i)
+         if(sig(j,3)-sig(j0,3).gt.ftol) then
+            nsiz(n)=i-i0
+            i0=i
+            n=n+1
+         endif
+      enddo
+      nz=n
+      nsiz(nz)=km+1-i0
+      nsiz(nz+1)=-1
+
+      return
+      end

Added: branches/map65/libm65/twkfreq.f
===================================================================
--- branches/map65/libm65/twkfreq.f	                        (rev 0)
+++ branches/map65/libm65/twkfreq.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,29 @@
+      subroutine twkfreq(c4aa,c4bb,n5,a)
+
+      complex c4aa(n5)
+      complex c4bb(n5)
+      real a(5)
+      complex w,wstep
+      data twopi/6.283185307/
+
+C  Apply AFC corrections to the c4aa and c4bb data
+      w=1.0
+      wstep=1.0
+      x0=0.5*(n5+1)
+      s=2.0/n5
+      do i=1,n5
+         x=s*(i-x0)
+         if(mod(i,1000).eq.1) then
+            p2=1.5*x*x - 0.5
+!            p3=2.5*(x**3) - 1.5*x
+!            p4=4.375*(x**4) - 3.75*(x**2) + 0.375
+            dphi=(a(1) + x*a(2) + p2*a(3)) * (twopi/1378.125)
+            wstep=cmplx(cos(dphi),sin(dphi))
+         endif
+         w=w*wstep
+         c4aa(i)=w*c4aa(i)
+         c4bb(i)=w*c4bb(i)
+      enddo
+
+      return
+      end

Added: branches/map65/libm65/unpackcall.f
===================================================================
--- branches/map65/libm65/unpackcall.f	                        (rev 0)
+++ branches/map65/libm65/unpackcall.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,142 @@
+      subroutine unpackcall(ncall,word,iv2,psfx)
+
+      parameter (NBASE=37*36*10*27*27*27)
+      character word*12,c*37,psfx*4
+
+      data c/'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ '/
+
+      n=ncall
+      iv2=0
+      if(n.ge.262177560) go to 20
+      word='......'
+      if(n.ge.262177560) go to 999            !Plain text message ...
+      i=mod(n,27)+11
+      word(6:6)=c(i:i)
+      n=n/27
+      i=mod(n,27)+11
+      word(5:5)=c(i:i)
+      n=n/27
+      i=mod(n,27)+11
+      word(4:4)=c(i:i)
+      n=n/27
+      i=mod(n,10)+1
+      word(3:3)=c(i:i)
+      n=n/10
+      i=mod(n,36)+1
+      word(2:2)=c(i:i)
+      n=n/36
+      i=n+1
+      word(1:1)=c(i:i)
+      do i=1,4
+         if(word(i:i).ne.' ') go to 10
+      enddo
+      go to 999
+ 10   word=word(i:)
+      go to 999
+
+ 20   if(n.ge.267796946) go to 999
+
+! We have a JT65v2 message
+      if((n.ge.262178563) .and. (n.le.264002071)) Then
+! CQ with prefix
+         iv2=1
+         n=n-262178563
+         i=mod(n,37)+1
+         psfx(4:4)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(3:3)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(2:2)=c(i:i)
+         n=n/37
+         i=n+1
+         psfx(1:1)=c(i:i)
+      endif
+
+      if((n.ge.264002072) .and. (n.le.265825580)) Then
+! QRZ with prefix
+         iv2=2
+         n=n-264002072
+         i=mod(n,37)+1
+         psfx(4:4)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(3:3)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(2:2)=c(i:i)
+         n=n/37
+         i=n+1
+         psfx(1:1)=c(i:i)
+      endif
+
+      if((n.ge.265825581) .and. (n.le.267649089)) Then
+! DE with prefix
+         iv2=3
+         n=n-265825581
+         i=mod(n,37)+1
+         psfx(4:4)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(3:3)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(2:2)=c(i:i)
+         n=n/37
+         i=n+1
+         psfx(1:1)=c(i:i)
+      endif
+
+      if((n.ge.267649090) .and. (n.le.267698374)) Then
+! CQ with suffix
+         iv2=4
+         n=n-267649090
+         i=mod(n,37)+1
+         psfx(3:3)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(2:2)=c(i:i)
+         n=n/37
+         i=n+1
+         psfx(1:1)=c(i:i)
+      endif
+
+      if((n.ge.267698375) .and. (n.le.267747659)) Then
+! QRZ with suffix
+         iv2=5
+         n=n-267698375
+         i=mod(n,37)+1
+         psfx(3:3)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(2:2)=c(i:i)
+         n=n/37
+         i=n+1
+         psfx(1:1)=c(i:i)
+      endif
+
+      if((n.ge.267747660) .and. (n.le.267796944)) Then
+! DE with suffix
+         iv2=6
+         n=n-267747660
+         i=mod(n,37)+1
+         psfx(3:3)=c(i:i)
+         n=n/37
+         i=mod(n,37)+1
+         psfx(2:2)=c(i:i)
+         n=n/37
+         i=n+1
+         psfx(1:1)=c(i:i)
+      endif
+
+      if(n.eq.267796945) Then
+! DE with no prefix or suffix
+         iv2=7
+         psfx = '    '
+      endif
+
+ 999  if(word(1:3).eq.'3D0') word='3DA0'//word(4:)
+
+      return
+      end

Added: branches/map65/libm65/unpackgrid.f
===================================================================
--- branches/map65/libm65/unpackgrid.f	                        (rev 0)
+++ branches/map65/libm65/unpackgrid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,32 @@
+      subroutine unpackgrid(ng,grid)
+
+      parameter (NGBASE=180*180)
+      character grid*4,grid6*6
+
+      grid='    '
+      if(ng.ge.32400) go to 10
+      dlat=mod(ng,180)-90
+      dlong=(ng/180)*2 - 180 + 2
+      call deg2grid(dlong,dlat,grid6)
+      grid=grid6(:4)
+      go to 100
+
+ 10   n=ng-NGBASE-1
+      if(n.ge.1 .and.n.le.30) then
+         write(grid,1012) -n
+ 1012    format(i3.2)
+      else if(n.ge.31 .and.n.le.60) then
+         n=n-30
+         write(grid,1022) -n
+ 1022    format('R',i3.2)
+      else if(n.eq.61) then
+         grid='RO'
+      else if(n.eq.62) then
+         grid='RRR'
+      else if(n.eq.63) then
+         grid='73'
+      endif
+
+ 100  return
+      end
+

Added: branches/map65/libm65/unpackmsg.f
===================================================================
--- branches/map65/libm65/unpackmsg.f	                        (rev 0)
+++ branches/map65/libm65/unpackmsg.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,100 @@
+      subroutine unpackmsg(dat,msg)
+
+      parameter (NBASE=37*36*10*27*27*27)
+      parameter (NGBASE=180*180)
+      integer dat(12)
+      character c1*12,c2*12,grid*4,msg*22,grid6*6,psfx*4,junk2*4
+      logical cqnnn
+
+      cqnnn=.false.
+      nc1=ishft(dat(1),22) + ishft(dat(2),16) + ishft(dat(3),10)+
+     +  ishft(dat(4),4) + iand(ishft(dat(5),-2),15)
+
+      nc2=ishft(iand(dat(5),3),26) + ishft(dat(6),20) + 
+     +  ishft(dat(7),14) + ishft(dat(8),8) + ishft(dat(9),2) + 
+     +  iand(ishft(dat(10),-4),3)
+
+      ng=ishft(iand(dat(10),15),12) + ishft(dat(11),6) + dat(12)
+
+      if(ng.gt.32768) then
+         call unpacktext(nc1,nc2,ng,msg)
+         go to 100
+      endif
+
+      call unpackcall(nc1,c1,iv2,psfx)
+      if(iv2.eq.0) then
+! This is an &quot;original JT65&quot; message
+         if(nc1.eq.NBASE+1) c1='CQ    '
+         if(nc1.eq.NBASE+2) c1='QRZ   '
+         nfreq=nc1-NBASE-3
+         if(nfreq.ge.0 .and. nfreq.le.999) then
+            write(c1,1002) nfreq
+ 1002       format('CQ ',i3.3)
+            cqnnn=.true.
+         endif
+      endif
+
+      call unpackcall(nc2,c2,junk1,junk2)
+      call unpackgrid(ng,grid)
+
+      if(iv2.gt.0) then
+! This is a JT65v2 message
+         n1=len_trim(psfx)
+         n2=len_trim(c2)
+         if(iv2.eq.1) msg='CQ '//psfx(:n1)//'/'//c2(:n2)//' '//grid
+         if(iv2.eq.2) msg='QRZ '//psfx(:n1)//'/'//c2(:n2)//' '//grid
+         if(iv2.eq.3) msg='DE '//psfx(:n1)//'/'//c2(:n2)//' '//grid
+         if(iv2.eq.4) msg='CQ '//c2(:n2)//'/'//psfx(:n1)//' '//grid
+         if(iv2.eq.5) msg='QRZ '//c2(:n2)//'/'//psfx(:n1)//' '//grid
+         if(iv2.eq.6) msg='DE '//c2(:n2)//'/'//psfx(:n1)//' '//grid
+         if(iv2.eq.7) msg='DE '//c2(:n2)//' '//grid
+         go to 100
+      else
+         
+      endif
+
+      grid6=grid//'ma'
+      call grid2k(grid6,k)
+      if(k.ge.1 .and. k.le.450)   call getpfx2(k,c1)
+      if(k.ge.451 .and. k.le.900) call getpfx2(k,c2)
+
+      i=index(c1,char(0))
+      if(i.ge.3) c1=c1(1:i-1)//'            '
+      i=index(c2,char(0))
+      if(i.ge.3) c2=c2(1:i-1)//'            '
+
+      msg='                      '
+      j=0
+      if(cqnnn) then
+         msg=c1//'          '
+         j=7                                  !### ??? ###
+         go to 10
+      endif
+
+      do i=1,12
+         j=j+1
+         msg(j:j)=c1(i:i)
+         if(c1(i:i).eq.' ') go to 10
+      enddo
+      j=j+1
+      msg(j:j)=' '
+
+ 10   do i=1,12
+         if(j.le.21) j=j+1
+         msg(j:j)=c2(i:i)
+         if(c2(i:i).eq.' ') go to 20
+      enddo
+      if(j.le.21) j=j+1
+      msg(j:j)=' '
+
+ 20   if(k.eq.0) then
+         do i=1,4
+            if(j.le.21) j=j+1
+            msg(j:j)=grid(i:i)
+         enddo
+         if(j.le.21) j=j+1
+         msg(j:j)=' '
+      endif
+
+ 100  return
+      end

Added: branches/map65/libm65/unpacktext.f
===================================================================
--- branches/map65/libm65/unpacktext.f	                        (rev 0)
+++ branches/map65/libm65/unpacktext.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,35 @@
+      subroutine unpacktext(nc1,nc2,nc3,msg)
+
+      character*22 msg
+      character*44 c
+      data c/'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ +-./?'/
+
+      nc3=iand(nc3,32767)                      !Remove the &quot;plain text&quot; bit
+      if(iand(nc1,1).ne.0) nc3=nc3+32768
+      nc1=nc1/2
+      if(iand(nc2,1).ne.0) nc3=nc3+65536
+      nc2=nc2/2
+
+      do i=5,1,-1
+         j=mod(nc1,42)+1
+         msg(i:i)=c(j:j)
+         nc1=nc1/42
+      enddo
+
+      do i=10,6,-1
+         j=mod(nc2,42)+1
+         msg(i:i)=c(j:j)
+         nc2=nc2/42
+      enddo
+
+      do i=13,11,-1
+         j=mod(nc3,42)+1
+         msg(i:i)=c(j:j)
+         nc3=nc3/42
+      enddo
+      msg(14:22) = '         '
+
+      return
+      end
+
+

Added: branches/map65/libm65/wrapkarn.c
===================================================================
--- branches/map65/libm65/wrapkarn.c	                        (rev 0)
+++ branches/map65/libm65/wrapkarn.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,70 @@
+#include &lt;math.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;float.h&gt;
+#include &lt;limits.h&gt;
+#include &lt;stdlib.h&gt;
+#include &quot;rs.h&quot;
+
+static void *rs;
+static int first=1;
+
+void rs_encode_(int *dgen, int *sent)
+// Encode JT65 data dgen[12], producing sent[63].
+{
+  int dat1[12];
+  int b[51];
+  int i;
+
+  if(first) {
+    // Initialize the JT65 codec
+    rs=init_rs_int(6,0x43,3,1,51,0);
+    first=0;
+  }
+
+  // Reverse data order for the Karn codec.
+  for(i=0; i&lt;12; i++) {
+    dat1[i]=dgen[11-i];
+  }
+  // Compute the parity symbols
+  encode_rs_int(rs,dat1,b);
+
+  // Move parity symbols and data into sent[] array, in reverse order.
+  for (i = 0; i &lt; 51; i++) sent[50-i] = b[i];
+  for (i = 0; i &lt; 12; i++) sent[i+51] = dat1[11-i];
+}
+
+void rs_decode_(int *recd0, int *era0, int *numera0, int *decoded, int *nerr)
+// Decode JT65 received data recd0[63], producing decoded[12].
+// Erasures are indicated in era0[numera].  The number of corrected
+// errors is *nerr.  If the data are uncorrectable, *nerr=-1 is returned.
+{
+  int numera;
+  int i;
+  int era_pos[50];
+  int recd[63];
+
+  if(first) {
+    rs=init_rs_int(6,0x43,3,1,51,0);
+    first=0;
+  }
+
+  numera=*numera0;
+  for(i=0; i&lt;12; i++) recd[i]=recd0[62-i];
+  for(i=0; i&lt;51; i++) recd[12+i]=recd0[50-i];
+  if(numera) 
+    for(i=0; i&lt;numera; i++) era_pos[i]=era0[i];
+  *nerr=decode_rs_int(rs,recd,era_pos,numera);
+  for(i=0; i&lt;12; i++) decoded[i]=recd[11-i];
+}
+
+
+void rs_encode__(int *dgen, int *sent)
+{
+  rs_encode_(dgen, sent);
+}
+
+void rs_decode__(int *recd0, int *era0, int *numera0, int *decoded, int *nerr)
+{
+  rs_decode_(recd0, era0, numera0, decoded, nerr);
+}
+

Deleted: branches/map65/libsamplerate.lib
===================================================================
(Binary files differ)

Deleted: branches/map65/loc.c
===================================================================
--- branches/map65/loc.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/loc.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,4 +0,0 @@
-int loc_(void *a)
-{
-  return (int)a;
-}

Added: branches/map65/main.cpp
===================================================================
--- branches/map65/main.cpp	                        (rev 0)
+++ branches/map65/main.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,11 @@
+#include &lt;QtGui&gt;
+#include &lt;QtGui/QApplication&gt;
+#include &quot;mainwindow.h&quot;
+
+int main(int argc, char *argv[])
+{
+    QApplication a(argc, argv);
+    MainWindow w;
+    w.show();
+    return a.exec();
+}

Added: branches/map65/mainwindow.cpp
===================================================================
--- branches/map65/mainwindow.cpp	                        (rev 0)
+++ branches/map65/mainwindow.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,1970 @@
+//------------------------------------------------------------- MainWindow
+#include &quot;mainwindow.h&quot;
+#include &quot;ui_mainwindow.h&quot;
+#include &quot;devsetup.h&quot;
+#include &quot;plotter.h&quot;
+#include &quot;about.h&quot;
+#include &quot;astro.h&quot;
+#include &quot;widegraph.h&quot;
+#include &quot;messages.h&quot;
+#include &quot;bandmap.h&quot;
+#include &quot;sleep.h&quot;
+#include &lt;portaudio.h&gt;
+
+#define NFFT 32768
+
+short int iwave[60*11025];            //Wave file for Tx audio
+int nwave;                            //Length of Tx waveform
+bool btxok;                           //True if OK to transmit
+double outputLatency;                 //Latency in seconds
+qint16 id[4*60*96000];
+
+
+Astro*     g_pAstro = NULL;
+WideGraph* g_pWideGraph = NULL;
+Messages*  g_pMessages = NULL;
+
+BandMap*   g_pBandMap = NULL;
+QSharedMemory mem_m65(&quot;mem_m65&quot;);
+
+QString rev=&quot;$Rev: 631 $&quot;;
+QString Program_Title_Version=&quot;  MAP65   v2.3.0, r&quot; + rev.mid(6,3) +
+                              &quot;    by K1JT&quot;;
+
+extern const int RxDataFrequency = 96000;
+extern const int TxDataFrequency = 11025;
+
+//-------------------------------------------------- MainWindow constructor
+MainWindow::MainWindow(QWidget *parent) :
+  QMainWindow(parent),
+  ui(new Ui::MainWindow)
+{
+  ui-&gt;setupUi(this);
+
+  on_EraseButton_clicked();
+  ui-&gt;labUTC-&gt;setStyleSheet( \
+        &quot;QLabel { background-color : black; color : yellow; }&quot;);
+  ui-&gt;labTol1-&gt;setStyleSheet( \
+        &quot;QLabel { background-color : white; color : black; }&quot;);
+  ui-&gt;labTol1-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);
+  ui-&gt;dxStationGroupBox-&gt;setStyleSheet(&quot;QFrame{border: 5px groove red}&quot;);
+
+  QActionGroup* paletteGroup = new QActionGroup(this);
+  ui-&gt;actionCuteSDR-&gt;setActionGroup(paletteGroup);
+  ui-&gt;actionLinrad-&gt;setActionGroup(paletteGroup);
+  ui-&gt;actionAFMHot-&gt;setActionGroup(paletteGroup);
+  ui-&gt;actionBlue-&gt;setActionGroup(paletteGroup);
+
+  QActionGroup* modeGroup = new QActionGroup(this);
+  ui-&gt;actionJT65A-&gt;setActionGroup(modeGroup);
+  ui-&gt;actionJT65B-&gt;setActionGroup(modeGroup);
+  ui-&gt;actionJT65C-&gt;setActionGroup(modeGroup);
+
+  QActionGroup* saveGroup = new QActionGroup(this);
+  ui-&gt;actionSave_all-&gt;setActionGroup(saveGroup);
+  ui-&gt;actionNone-&gt;setActionGroup(saveGroup);
+
+  QActionGroup* DepthGroup = new QActionGroup(this);
+  ui-&gt;actionNo_Deep_Search-&gt;setActionGroup(DepthGroup);
+  ui-&gt;actionNormal_Deep_Search-&gt;setActionGroup(DepthGroup);
+  ui-&gt;actionAggressive_Deep_Search-&gt;setActionGroup(DepthGroup);
+
+  QButtonGroup* txMsgButtonGroup = new QButtonGroup;
+  txMsgButtonGroup-&gt;addButton(ui-&gt;txrb1,1);
+  txMsgButtonGroup-&gt;addButton(ui-&gt;txrb2,2);
+  txMsgButtonGroup-&gt;addButton(ui-&gt;txrb3,3);
+  txMsgButtonGroup-&gt;addButton(ui-&gt;txrb4,4);
+  txMsgButtonGroup-&gt;addButton(ui-&gt;txrb5,5);
+  txMsgButtonGroup-&gt;addButton(ui-&gt;txrb6,6);
+  connect(txMsgButtonGroup,SIGNAL(buttonClicked(int)),SLOT(set_ntx(int)));
+  connect(ui-&gt;decodedTextBrowser,SIGNAL(selectCallsign(bool)),this,
+          SLOT(selectCall2(bool)));
+
+  setWindowTitle(Program_Title_Version);
+
+  connect(&amp;soundInThread, SIGNAL(readyForFFT(int)),
+             this, SLOT(dataSink(int)));
+  connect(&amp;soundInThread, SIGNAL(error(QString)), this,
+          SLOT(showSoundInError(QString)));
+  connect(&amp;soundInThread, SIGNAL(status(QString)), this,
+          SLOT(showStatusMessage(QString)));
+  createStatusBar();
+
+  connect(&amp;proc_m65, SIGNAL(readyReadStandardOutput()),
+                    this, SLOT(readFromStdout()));
+
+  connect(&amp;proc_m65, SIGNAL(error(QProcess::ProcessError)),
+          this, SLOT(m65_error()));
+
+  connect(&amp;proc_m65, SIGNAL(readyReadStandardError()),
+          this, SLOT(readFromStderr()));
+
+  QTimer *guiTimer = new QTimer(this);
+  connect(guiTimer, SIGNAL(timeout()), this, SLOT(guiUpdate()));
+  guiTimer-&gt;start(100);                            //Don't change the 100 ms!
+
+  m_auto=false;
+  m_waterfallAvg = 1;
+  m_network = true;
+  m_txFirst=false;
+  m_txMute=false;
+  btxok=false;
+  m_restart=false;
+  m_transmitting=false;
+  m_killAll=false;
+  m_widebandDecode=false;
+  m_ntx=1;
+  m_myCall=&quot;K1JT&quot;;
+  m_myGrid=&quot;FN20qi&quot;;
+  m_appDir = QApplication::applicationDirPath();
+  m_saveDir=&quot;/users/joe/map65/install/save&quot;;
+  m_azelDir=&quot;/users/joe/map65/install/&quot;;
+  m_txFreq=125;
+  m_setftx=0;
+  m_loopall=false;
+  m_startAnother=false;
+  m_saveAll=false;
+  m_onlyEME=false;
+  m_sec0=-1;
+  m_hsym0=-1;
+  m_palette=&quot;CuteSDR&quot;;
+  m_map65RxLog=1;                     //Write Date and Time to all65.txt
+  m_nutc0=9999;
+  m_kb8rq=false;
+  m_NB=false;
+  m_mode=&quot;JT65B&quot;;
+  m_mode65=2;
+  m_fs96000=true;
+  m_udpPort=50004;
+  m_adjustIQ=0;
+  m_applyIQcal=0;
+  m_colors=&quot;000066ff0000ffff00969696646464&quot;;
+
+  ui-&gt;xThermo-&gt;setFillBrush(Qt::green);
+  ui-&gt;yThermo-&gt;setFillBrush(Qt::magenta);
+
+#ifdef WIN32
+  while(true) {
+      int iret=killbyname(&quot;m65.exe&quot;);
+      if(iret == 603) break;
+      if(iret != 0) msgBox(&quot;KillByName return code: &quot; +
+                           QString::number(iret));
+  }
+#endif
+
+  if(!mem_m65.attach()) {
+    if (!mem_m65.create(sizeof(datcom_))) {
+      msgBox(&quot;Unable to create shared memory segment.&quot;);
+    }
+  }
+  char *to = (char*)mem_m65.data();
+  int size=sizeof(datcom_);
+  if(datcom_.newdat==0) {
+    int noffset = 4*4*5760000 + 4*4*322*32768 + 4*4*32768;
+    to += noffset;
+    size -= noffset;
+  }
+  memset(to,0,size);         //Zero all decoding params in shared memory
+
+  PaError paerr=Pa_Initialize();                    //Initialize Portaudio
+  if(paerr!=paNoError) {
+    msgBox(&quot;Unable to initialize PortAudio.&quot;);
+  }
+  readSettings();		             //Restore user's setup params
+  QFile lockFile(m_appDir + &quot;/.lock&quot;); //Create .lock so m65 will wait
+  lockFile.open(QIODevice::ReadWrite);
+  QFile quitFile(m_appDir + &quot;/.lock&quot;);
+  quitFile.remove();
+  proc_m65.start(QDir::toNativeSeparators(m_appDir + &quot;/m65 -s&quot;));
+
+  m_pbdecoding_style1=&quot;QPushButton{background-color: cyan; \
+      border-style: outset; border-width: 1px; border-radius: 5px; \
+      border-color: black; min-width: 5em; padding: 3px;}&quot;;
+  m_pbmonitor_style=&quot;QPushButton{background-color: #00ff00; \
+      border-style: outset; border-width: 1px; border-radius: 5px; \
+      border-color: black; min-width: 5em; padding: 3px;}&quot;;
+  m_pbAutoOn_style=&quot;QPushButton{background-color: red; \
+      border-style: outset; border-width: 1px; border-radius: 5px; \
+      border-color: black; min-width: 5em; padding: 3px;}&quot;;
+
+  genStdMsgs(&quot;&quot;);
+
+  on_actionAstro_Data_triggered();           //Create the other windows
+  on_actionWide_Waterfall_triggered();
+  on_actionMessages_triggered();
+  on_actionBand_Map_triggered();
+  g_pMessages-&gt;setColors(m_colors);
+  g_pBandMap-&gt;setColors(m_colors);
+  g_pAstro-&gt;setFontSize(m_astroFont);
+  if(m_mode==&quot;JT65A&quot;) on_actionJT65A_triggered();
+  if(m_mode==&quot;JT65B&quot;) on_actionJT65B_triggered();
+  if(m_mode==&quot;JT65C&quot;) on_actionJT65C_triggered();
+
+  future1 = new QFuture&lt;void&gt;;
+  watcher1 = new QFutureWatcher&lt;void&gt;;
+  connect(watcher1, SIGNAL(finished()),this,SLOT(diskDat()));
+
+  future2 = new QFuture&lt;void&gt;;
+  watcher2 = new QFutureWatcher&lt;void&gt;;
+  connect(watcher2, SIGNAL(finished()),this,SLOT(diskWriteFinished()));
+
+// Assign input device and start input thread
+  soundInThread.setInputDevice(m_paInDevice);
+  if(m_fs96000) soundInThread.setRate(96000.0);
+  if(!m_fs96000) soundInThread.setRate(95238.1);
+  soundInThread.setBufSize(10*7056);
+  soundInThread.setNetwork(m_network);
+  soundInThread.setPort(m_udpPort);
+  if(!m_xpol) soundInThread.setNrx(1);
+  if(m_xpol) soundInThread.setNrx(2);
+  soundInThread.start(QThread::HighestPriority);
+
+  // Assign output device and start output thread
+  soundOutThread.setOutputDevice(m_paOutDevice);
+//  soundOutThread.start(QThread::HighPriority);
+
+  m_monitoring=true;                           // Start with Monitoring ON
+  soundInThread.setMonitoring(m_monitoring);
+  m_diskData=false;
+  m_tol=500;
+  g_pWideGraph-&gt;setTol(m_tol);
+  g_pWideGraph-&gt;setFcal(m_fCal);
+  if(m_fs96000) g_pWideGraph-&gt;setFsample(96000);
+  if(!m_fs96000) g_pWideGraph-&gt;setFsample(95238);
+  g_pWideGraph-&gt;m_mult570=m_mult570;
+  g_pWideGraph-&gt;m_cal570=m_cal570;
+  if(m_initIQplus) g_pWideGraph-&gt;initIQplus();
+
+// Create &quot;m_worked&quot;, a dictionary of all calls in wsjt.log
+  QFile f(&quot;wsjt.log&quot;);
+  f.open(QIODevice::ReadOnly);
+  QTextStream in(&amp;f);
+  QString line,t,callsign;
+  for(int i=0; i&lt;99999; i++) {
+    line=in.readLine();
+    if(line.length()&lt;=0) break;
+    t=line.mid(18,12);
+    callsign=t.mid(0,t.indexOf(&quot;,&quot;));
+    m_worked[callsign]=true;
+  }
+  f.close();
+
+  if(ui-&gt;actionLinrad-&gt;isChecked()) on_actionLinrad_triggered();
+  if(ui-&gt;actionCuteSDR-&gt;isChecked()) on_actionCuteSDR_triggered();
+  if(ui-&gt;actionAFMHot-&gt;isChecked()) on_actionAFMHot_triggered();
+  if(ui-&gt;actionBlue-&gt;isChecked()) on_actionBlue_triggered();
+                                             // End of MainWindow constructor
+}
+
+  //--------------------------------------------------- MainWindow destructor
+MainWindow::~MainWindow()
+{
+  writeSettings();
+  if (soundInThread.isRunning()) {
+    soundInThread.quit();
+    soundInThread.wait(3000);
+  }
+  if (soundOutThread.isRunning()) {
+    soundOutThread.quitExecution=true;
+    soundOutThread.wait(3000);
+  }
+  if(!m_decoderBusy) {
+    QFile lockFile(m_appDir + &quot;/.lock&quot;);
+    lockFile.remove();
+  }
+  delete ui;
+}
+
+//-------------------------------------------------------- writeSettings()
+void MainWindow::writeSettings()
+{
+  QString inifile = m_appDir + &quot;/map65.ini&quot;;
+  QSettings settings(inifile, QSettings::IniFormat);
+
+  settings.beginGroup(&quot;MainWindow&quot;);
+  settings.setValue(&quot;geometry&quot;, saveGeometry());
+  settings.setValue(&quot;MRUdir&quot;, m_path);
+  settings.setValue(&quot;TxFirst&quot;,m_txFirst);
+  settings.setValue(&quot;DXcall&quot;,ui-&gt;dxCallEntry-&gt;text());
+  settings.setValue(&quot;DXgrid&quot;,ui-&gt;dxGridEntry-&gt;text());
+
+  if(g_pAstro-&gt;isVisible()) {
+    m_astroGeom = g_pAstro-&gt;geometry();
+    settings.setValue(&quot;AstroGeom&quot;,m_astroGeom);
+  }
+
+  if(g_pWideGraph-&gt;isVisible()) {
+    m_wideGraphGeom = g_pWideGraph-&gt;geometry();
+    settings.setValue(&quot;WideGraphGeom&quot;,m_wideGraphGeom);
+  }
+  if(g_pMessages-&gt;isVisible()) {
+    m_messagesGeom = g_pMessages-&gt;geometry();
+    settings.setValue(&quot;MessagesGeom&quot;,m_messagesGeom);
+  }
+  if(g_pBandMap-&gt;isVisible()) {
+    m_bandMapGeom = g_pBandMap-&gt;geometry();
+    settings.setValue(&quot;BandMapGeom&quot;,m_bandMapGeom);
+  }
+  settings.endGroup();
+
+  settings.beginGroup(&quot;Common&quot;);
+  settings.setValue(&quot;MyCall&quot;,m_myCall);
+  settings.setValue(&quot;MyGrid&quot;,m_myGrid);
+  settings.setValue(&quot;IDint&quot;,m_idInt);
+  settings.setValue(&quot;PTTport&quot;,m_pttPort);
+  settings.setValue(&quot;AstroFont&quot;,m_astroFont);
+  settings.setValue(&quot;Xpol&quot;,m_xpol);
+  settings.setValue(&quot;XpolX&quot;,m_xpolx);
+  settings.setValue(&quot;SaveDir&quot;,m_saveDir);
+  settings.setValue(&quot;AzElDir&quot;,m_azelDir);
+  settings.setValue(&quot;DXCCpfx&quot;,m_dxccPfx);
+  settings.setValue(&quot;Timeout&quot;,m_timeout);
+  settings.setValue(&quot;IQamp&quot;,m_IQamp);
+  settings.setValue(&quot;IQphase&quot;,m_IQphase);
+  settings.setValue(&quot;ApplyIQcal&quot;,m_applyIQcal);
+  settings.setValue(&quot;dPhi&quot;,m_dPhi);
+  settings.setValue(&quot;Fcal&quot;,m_fCal);
+  settings.setValue(&quot;Fadd&quot;,m_fAdd);
+  settings.setValue(&quot;NetworkInput&quot;, m_network);
+  settings.setValue(&quot;FSam96000&quot;, m_fs96000);
+  settings.setValue(&quot;SoundInIndex&quot;,m_nDevIn);
+  settings.setValue(&quot;paInDevice&quot;,m_paInDevice);
+  settings.setValue(&quot;SoundOutIndex&quot;,m_nDevOut);
+  settings.setValue(&quot;paOutDevice&quot;,m_paOutDevice);
+  settings.setValue(&quot;IQswap&quot;,m_IQswap);
+  settings.setValue(&quot;Plus10dB&quot;,m_10db);
+  settings.setValue(&quot;InitIQplus&quot;,m_initIQplus);
+  settings.setValue(&quot;UDPport&quot;,m_udpPort);
+  settings.setValue(&quot;PaletteCuteSDR&quot;,ui-&gt;actionCuteSDR-&gt;isChecked());
+  settings.setValue(&quot;PaletteLinrad&quot;,ui-&gt;actionLinrad-&gt;isChecked());
+  settings.setValue(&quot;PaletteAFMHot&quot;,ui-&gt;actionAFMHot-&gt;isChecked());
+  settings.setValue(&quot;PaletteBlue&quot;,ui-&gt;actionBlue-&gt;isChecked());
+  settings.setValue(&quot;Mode&quot;,m_mode);
+  settings.setValue(&quot;SaveNone&quot;,ui-&gt;actionNone-&gt;isChecked());
+  settings.setValue(&quot;SaveAll&quot;,ui-&gt;actionSave_all-&gt;isChecked());
+  settings.setValue(&quot;NDepth&quot;,m_ndepth);
+  settings.setValue(&quot;NEME&quot;,m_onlyEME);
+  settings.setValue(&quot;KB8RQ&quot;,m_kb8rq);
+  settings.setValue(&quot;NB&quot;,m_NB);
+  settings.setValue(&quot;NBslider&quot;,m_NBslider);
+  settings.setValue(&quot;GainX&quot;,(double)m_gainx);
+  settings.setValue(&quot;GainY&quot;,(double)m_gainy);
+  settings.setValue(&quot;PhaseX&quot;,(double)m_phasex);
+  settings.setValue(&quot;PhaseY&quot;,(double)m_phasey);
+  settings.setValue(&quot;Mult570&quot;,m_mult570);
+  settings.setValue(&quot;Cal570&quot;,m_cal570);
+  settings.setValue(&quot;Colors&quot;,m_colors);
+  settings.endGroup();
+}
+
+//---------------------------------------------------------- readSettings()
+void MainWindow::readSettings()
+{
+  QString inifile = m_appDir + &quot;/map65.ini&quot;;
+  QSettings settings(inifile, QSettings::IniFormat);
+  settings.beginGroup(&quot;MainWindow&quot;);
+  restoreGeometry(settings.value(&quot;geometry&quot;).toByteArray());
+  ui-&gt;dxCallEntry-&gt;setText(settings.value(&quot;DXcall&quot;,&quot;&quot;).toString());
+  ui-&gt;dxGridEntry-&gt;setText(settings.value(&quot;DXgrid&quot;,&quot;&quot;).toString());
+
+  m_astroGeom = settings.value(&quot;AstroGeom&quot;, QRect(71,390,227,403)).toRect();
+
+  m_wideGraphGeom = settings.value(&quot;WideGraphGeom&quot;, \
+                                   QRect(45,30,1023,340)).toRect();
+  m_messagesGeom = settings.value(&quot;MessagesGeom&quot;, \
+                                  QRect(800,400,381,400)).toRect();
+  m_bandMapGeom = settings.value(&quot;BandMapGeom&quot;, \
+                                  QRect(280,400,142,400)).toRect();
+  m_path = settings.value(&quot;MRUdir&quot;, m_appDir + &quot;/save&quot;).toString();
+  m_txFirst = settings.value(&quot;TxFirst&quot;,false).toBool();
+  ui-&gt;txFirstCheckBox-&gt;setChecked(m_txFirst);
+  settings.endGroup();
+
+  settings.beginGroup(&quot;Common&quot;);
+  m_myCall=settings.value(&quot;MyCall&quot;,&quot;&quot;).toString();
+  m_myGrid=settings.value(&quot;MyGrid&quot;,&quot;&quot;).toString();
+  m_idInt=settings.value(&quot;IDint&quot;,0).toInt();
+  m_pttPort=settings.value(&quot;PTTport&quot;,0).toInt();
+  m_astroFont=settings.value(&quot;AstroFont&quot;,20).toInt();
+  m_xpol=settings.value(&quot;Xpol&quot;,false).toBool();
+  ui-&gt;actionFind_Delta_Phi-&gt;setEnabled(m_xpol);
+  m_xpolx=settings.value(&quot;XpolX&quot;,false).toBool();
+  m_saveDir=settings.value(&quot;SaveDir&quot;,m_appDir + &quot;/save&quot;).toString();
+  m_azelDir=settings.value(&quot;AzElDir&quot;,m_appDir).toString();
+  m_dxccPfx=settings.value(&quot;DXCCpfx&quot;,&quot;&quot;).toString();
+  m_timeout=settings.value(&quot;Timeout&quot;,20).toInt();
+  m_IQamp=settings.value(&quot;IQamp&quot;,1.0000).toDouble();
+  m_IQphase=settings.value(&quot;IQphase&quot;,0.0).toDouble();
+  m_applyIQcal=settings.value(&quot;ApplyIQcal&quot;,0).toInt();
+  ui-&gt;actionApply_IQ_Calibration-&gt;setChecked(m_applyIQcal!=0);
+  m_dPhi=settings.value(&quot;dPhi&quot;,0).toInt();
+  m_fCal=settings.value(&quot;Fcal&quot;,0).toInt();
+  m_fAdd=settings.value(&quot;FAdd&quot;,0).toDouble();
+  soundInThread.setFadd(m_fAdd);
+  m_network = settings.value(&quot;NetworkInput&quot;,true).toBool();
+  m_fs96000 = settings.value(&quot;FSam96000&quot;,true).toBool();
+  m_nDevIn = settings.value(&quot;SoundInIndex&quot;, 0).toInt();
+  m_paInDevice = settings.value(&quot;paInDevice&quot;,0).toInt();
+  m_nDevOut = settings.value(&quot;SoundOutIndex&quot;, 0).toInt();
+  m_paOutDevice = settings.value(&quot;paOutDevice&quot;,0).toInt();
+  m_IQswap = settings.value(&quot;IQswap&quot;,false).toBool();
+  m_10db = settings.value(&quot;Plus10dB&quot;,false).toBool();
+  m_initIQplus = settings.value(&quot;InitIQplus&quot;,false).toBool();
+  m_udpPort = settings.value(&quot;UDPport&quot;,50004).toInt();
+  soundInThread.setSwapIQ(m_IQswap);
+  soundInThread.set10db(m_10db);
+  soundInThread.setPort(m_udpPort);
+  ui-&gt;actionCuteSDR-&gt;setChecked(settings.value(
+                                  &quot;PaletteCuteSDR&quot;,true).toBool());
+  ui-&gt;actionLinrad-&gt;setChecked(settings.value(
+                                 &quot;PaletteLinrad&quot;,false).toBool());
+  ui-&gt;actionAFMHot-&gt;setChecked(settings.value(
+                                 &quot;PaletteAFMHot&quot;,false).toBool());
+  ui-&gt;actionBlue-&gt;setChecked(settings.value(
+                                 &quot;PaletteBlue&quot;,false).toBool());
+  m_mode=settings.value(&quot;Mode&quot;,&quot;JT65B&quot;).toString();
+  ui-&gt;actionNone-&gt;setChecked(settings.value(&quot;SaveNone&quot;,true).toBool());
+  ui-&gt;actionSave_all-&gt;setChecked(settings.value(&quot;SaveAll&quot;,false).toBool());
+  m_saveAll=ui-&gt;actionSave_all-&gt;isChecked();
+  m_ndepth=settings.value(&quot;NDepth&quot;,0).toInt();
+  m_onlyEME=settings.value(&quot;NEME&quot;,false).toBool();
+  ui-&gt;actionOnly_EME_calls-&gt;setChecked(m_onlyEME);
+  m_kb8rq=settings.value(&quot;KB8RQ&quot;,false).toBool();
+  ui-&gt;actionF4_sets_Tx6-&gt;setChecked(m_kb8rq);
+  m_NB=settings.value(&quot;NB&quot;,false).toBool();
+  ui-&gt;NBcheckBox-&gt;setChecked(m_NB);
+  m_NBslider=settings.value(&quot;NBslider&quot;,40).toInt();
+  ui-&gt;NBslider-&gt;setValue(m_NBslider);
+  m_gainx=settings.value(&quot;GainX&quot;,1.0).toFloat();
+  m_gainy=settings.value(&quot;GainY&quot;,1.0).toFloat();
+  m_phasex=settings.value(&quot;PhaseX&quot;,0.0).toFloat();
+  m_phasey=settings.value(&quot;PhaseY&quot;,0.0).toFloat();
+  m_mult570=settings.value(&quot;Mult570&quot;,2).toInt();
+  m_cal570=settings.value(&quot;Cal570&quot;,0.0).toDouble();
+  m_colors=settings.value(&quot;Colors&quot;,&quot;000066ff0000ffff00969696646464&quot;).toString();
+  settings.endGroup();
+
+  if(!ui-&gt;actionLinrad-&gt;isChecked() &amp;&amp; !ui-&gt;actionCuteSDR-&gt;isChecked() &amp;&amp;
+    !ui-&gt;actionAFMHot-&gt;isChecked() &amp;&amp; !ui-&gt;actionBlue-&gt;isChecked()) {
+    on_actionLinrad_triggered();
+    ui-&gt;actionLinrad-&gt;setChecked(true);
+  }
+  if(m_ndepth==0) ui-&gt;actionNo_Deep_Search-&gt;setChecked(true);
+  if(m_ndepth==1) ui-&gt;actionNormal_Deep_Search-&gt;setChecked(true);
+  if(m_ndepth==2) ui-&gt;actionAggressive_Deep_Search-&gt;setChecked(true);
+}
+
+//-------------------------------------------------------------- dataSink()
+void MainWindow::dataSink(int k)
+{
+  static float s[NFFT],splot[NFFT];
+  static int n=0;
+  static int ihsym=0;
+  static int nzap=0;
+  static int n60z=0;
+  static int nkhz;
+  static int nfsample=96000;
+  static int nxpol=0;
+  static float fgreen;
+  static int ndiskdat;
+  static int nb;
+  static int nadj=0;
+  static float px=0.0,py=0.0;
+  static uchar lstrong[1024];
+  static float rejectx;
+  static float rejecty;
+  static float slimit;
+
+
+  if(m_diskData) {
+    ndiskdat=1;
+    datcom_.ndiskdat=1;
+  } else {
+    ndiskdat=0;
+    datcom_.ndiskdat=0;
+  }
+// Get x and y power, polarized spectrum, nkhz, and ihsym
+  nb=0;
+  if(m_NB) nb=1;
+  nfsample=96000;
+  if(!m_fs96000) nfsample=95238;
+  nxpol=0;
+  if(m_xpol) nxpol=1;
+  fgreen=(float)g_pWideGraph-&gt;fGreen();
+  nadj++;
+  if(m_adjustIQ==0) nadj=0;
+  symspec_(&amp;k, &amp;nxpol, &amp;ndiskdat, &amp;nb, &amp;m_NBslider, &amp;m_dPhi, &amp;nfsample,
+           &amp;fgreen, &amp;m_adjustIQ, &amp;m_applyIQcal, &amp;m_gainx, &amp;m_gainy, &amp;m_phasex,
+           &amp;m_phasey, &amp;rejectx, &amp;rejecty, &amp;px, &amp;py, s, &amp;nkhz,
+           &amp;ihsym, &amp;nzap, &amp;slimit, lstrong);
+  QString t;
+  m_pctZap=nzap/178.3;
+  if(m_xpol) t.sprintf(&quot; Rx noise: %5.1f  %5.1f %5.1f %% &quot;,px,py,m_pctZap);
+  if(!m_xpol) t.sprintf(&quot; Rx noise: %5.1f  %5.1f %% &quot;,px,m_pctZap);
+  lab4-&gt;setText(t);
+  ui-&gt;xThermo-&gt;setValue((double)px);   //Update the bargraphs
+  ui-&gt;yThermo-&gt;setValue((double)py);
+  if(m_monitoring || m_diskData) {
+    g_pWideGraph-&gt;dataSink2(s,nkhz,ihsym,m_diskData,lstrong);
+  }
+
+  if(nadj == 10) {
+    if(m_xpol) {
+      t.sprintf(&quot;Amp: %6.4f %6.4f   Phase: %6.4f %6.4f&quot;,
+                m_gainx,m_gainy,m_phasex,m_phasey);
+    } else {
+      t.sprintf(&quot;Amp: %6.4f   Phase: %6.4f&quot;,m_gainx,m_phasex);
+    }
+    ui-&gt;decodedTextBrowser-&gt;append(t);
+    m_adjustIQ=0;
+  }
+
+  //Average over specified number of spectra
+  if (n==0) {
+    for (int i=0; i&lt;NFFT; i++)
+      splot[i]=s[i];
+  } else {
+    for (int i=0; i&lt;NFFT; i++)
+      splot[i] += s[i];
+  }
+  n++;
+
+  if (n&gt;=m_waterfallAvg) {
+    for (int i=0; i&lt;NFFT; i++) {
+        splot[i] /= n;                           //Normalize the average
+    }
+
+// Time according to this computer
+    qint64 ms = QDateTime::currentMSecsSinceEpoch() % 86400000;
+    int n60 = (ms/1000) % 60;
+    if((m_diskData &amp;&amp; ihsym &lt;= m_waterfallAvg) || (!m_diskData &amp;&amp; n60&lt;n60z)) {
+      for (int i=0; i&lt;NFFT; i++) {
+        splot[i] = 1.e30;
+      }
+    }
+    n60z=n60;
+    n=0;
+  }
+  if(ihsym == 279) {
+    datcom_.newdat=1;
+    datcom_.nagain=0;
+    QDateTime t = QDateTime::currentDateTimeUtc();
+    m_dateTime=t.toString(&quot;yyyy-MMM-dd hh:mm&quot;);
+    decode();                                           //Start the decoder
+    if(m_saveAll) {
+      QString fname=m_saveDir + &quot;/&quot; + t.date().toString(&quot;yyMMdd&quot;) + &quot;_&quot; +
+          t.time().toString(&quot;hhmm&quot;);
+      if(m_xpol) fname += &quot;.tf2&quot;;
+      if(!m_xpol) fname += &quot;.iq&quot;;
+      *future2 = QtConcurrent::run(savetf2, fname, m_xpol);
+      watcher2-&gt;setFuture(*future2);
+    }
+  }
+  soundInThread.m_dataSinkBusy=false;
+}
+
+void MainWindow::showSoundInError(const QString&amp; errorMsg)
+ {QMessageBox::critical(this, tr(&quot;Error in SoundIn&quot;), errorMsg);}
+
+void MainWindow::showStatusMessage(const QString&amp; statusMsg)
+ {statusBar()-&gt;showMessage(statusMsg);}
+
+void MainWindow::on_actionDeviceSetup_triggered()               //Setup Dialog
+{
+  DevSetup dlg(this);
+  dlg.m_myCall=m_myCall;
+  dlg.m_myGrid=m_myGrid;
+  dlg.m_idInt=m_idInt;
+  dlg.m_pttPort=m_pttPort;
+  dlg.m_astroFont=m_astroFont;
+  dlg.m_xpol=m_xpol;
+  dlg.m_xpolx=m_xpolx;
+  dlg.m_saveDir=m_saveDir;
+  dlg.m_azelDir=m_azelDir;
+  dlg.m_dxccPfx=m_dxccPfx;
+  dlg.m_timeout=m_timeout;
+  dlg.m_dPhi=m_dPhi;
+  dlg.m_fCal=m_fCal;
+  dlg.m_fAdd=m_fAdd;
+  dlg.m_network=m_network;
+  dlg.m_fs96000=m_fs96000;
+  dlg.m_nDevIn=m_nDevIn;
+  dlg.m_nDevOut=m_nDevOut;
+  dlg.m_udpPort=m_udpPort;
+  dlg.m_IQswap=m_IQswap;
+  dlg.m_10db=m_10db;
+  dlg.m_initIQplus=m_initIQplus;
+  dlg.m_cal570=m_cal570;
+  dlg.m_mult570=m_mult570;
+  dlg.m_colors=m_colors;
+
+  dlg.initDlg();
+  if(dlg.exec() == QDialog::Accepted) {
+    m_myCall=dlg.m_myCall;
+    m_myGrid=dlg.m_myGrid;
+    m_idInt=dlg.m_idInt;
+    m_pttPort=dlg.m_pttPort;
+    m_astroFont=dlg.m_astroFont;
+    if(g_pAstro-&gt;isVisible()) g_pAstro-&gt;setFontSize(m_astroFont);
+    m_xpol=dlg.m_xpol;
+    ui-&gt;actionFind_Delta_Phi-&gt;setEnabled(m_xpol);
+    m_xpolx=dlg.m_xpolx;
+    m_saveDir=dlg.m_saveDir;
+    m_azelDir=dlg.m_azelDir;
+    m_dxccPfx=dlg.m_dxccPfx;
+    m_timeout=dlg.m_timeout;
+    m_dPhi=dlg.m_dPhi;
+    m_fCal=dlg.m_fCal;
+    m_fAdd=dlg.m_fAdd;
+    g_pWideGraph-&gt;setFcal(m_fCal);
+    m_fs96000=dlg.m_fs96000;
+    m_network=dlg.m_network;
+    m_nDevIn=dlg.m_nDevIn;
+    m_paInDevice=dlg.m_paInDevice;
+    m_nDevOut=dlg.m_nDevOut;
+    m_paOutDevice=dlg.m_paOutDevice;
+    m_udpPort=dlg.m_udpPort;
+    m_IQswap=dlg.m_IQswap;
+    m_10db=dlg.m_10db;
+    m_initIQplus=dlg.m_initIQplus;
+    m_colors=dlg.m_colors;
+    g_pMessages-&gt;setColors(m_colors);
+    g_pBandMap-&gt;setColors(m_colors);
+    m_cal570=dlg.m_cal570;
+    m_mult570=dlg.m_mult570;
+    g_pWideGraph-&gt;m_mult570=m_mult570;
+    g_pWideGraph-&gt;m_cal570=m_cal570;
+    soundInThread.setSwapIQ(m_IQswap);
+    soundInThread.set10db(m_10db);
+
+    if(dlg.m_restartSoundIn) {
+      soundInThread.quit();
+      soundInThread.wait(1000);
+      soundInThread.setNetwork(m_network);
+      if(m_fs96000) soundInThread.setRate(96000.0);
+      if(!m_fs96000) soundInThread.setRate(95238.1);
+      soundInThread.setFadd(m_fAdd);
+      if(!m_xpol) soundInThread.setNrx(1);
+      if(m_xpol) soundInThread.setNrx(2);
+      soundInThread.setInputDevice(m_paInDevice);
+      soundInThread.start(QThread::HighestPriority);
+    }
+
+    if(dlg.m_restartSoundOut) {
+      soundOutThread.quitExecution=true;
+      soundOutThread.wait(1000);
+      soundOutThread.setOutputDevice(m_paOutDevice);
+//      soundOutThread.start(QThread::HighPriority);
+    }
+  }
+}
+
+void MainWindow::on_monitorButton_clicked()                  //Monitor
+{
+  m_monitoring=true;
+  soundInThread.setMonitoring(true);
+  m_diskData=false;
+}
+void MainWindow::on_actionLinrad_triggered()                 //Linrad palette
+{
+  if(g_pWideGraph != NULL) g_pWideGraph-&gt;setPalette(&quot;Linrad&quot;);
+}
+
+void MainWindow::on_actionCuteSDR_triggered()                //CuteSDR palette
+{
+  if(g_pWideGraph != NULL) g_pWideGraph-&gt;setPalette(&quot;CuteSDR&quot;);
+}
+
+void MainWindow::on_actionAFMHot_triggered()
+{
+  if(g_pWideGraph != NULL) g_pWideGraph-&gt;setPalette(&quot;AFMHot&quot;);
+}
+
+void MainWindow::on_actionBlue_triggered()
+{
+  if(g_pWideGraph != NULL) g_pWideGraph-&gt;setPalette(&quot;Blue&quot;);
+}
+
+void MainWindow::on_actionAbout_triggered()                  //Display &quot;About&quot;
+{
+  CAboutDlg dlg(this,Program_Title_Version);
+  dlg.exec();
+}
+
+void MainWindow::on_autoButton_clicked()                     //Auto
+{
+  m_auto = !m_auto;
+  if(m_auto) {
+    ui-&gt;autoButton-&gt;setStyleSheet(m_pbAutoOn_style);
+    ui-&gt;autoButton-&gt;setText(&quot;Auto is ON&quot;);
+  } else {
+    btxok=false;
+    ui-&gt;autoButton-&gt;setStyleSheet(&quot;&quot;);
+    ui-&gt;autoButton-&gt;setText(&quot;Auto is OFF&quot;);
+    on_monitorButton_clicked();
+  }
+}
+
+void MainWindow::on_stopTxButton_clicked()                    //Stop Tx
+{
+  if(m_auto) on_autoButton_clicked();
+  btxok=false;
+}
+
+void MainWindow::keyPressEvent( QKeyEvent *e )                //keyPressEvent
+{
+  switch(e-&gt;key())
+  {
+  case Qt::Key_F3:
+    m_txMute=!m_txMute;
+    break;
+  case Qt::Key_F4:
+    ui-&gt;dxCallEntry-&gt;setText(&quot;&quot;);
+    ui-&gt;dxGridEntry-&gt;setText(&quot;&quot;);
+    if(m_kb8rq) {
+      m_ntx=6;
+      ui-&gt;txrb6-&gt;setChecked(true);
+    }
+  case Qt::Key_F6:
+    if(e-&gt;modifiers() &amp; Qt::ShiftModifier) {
+      on_actionDecode_remaining_files_in_directory_triggered();
+    }
+    break;
+  case Qt::Key_F11:
+    if(e-&gt;modifiers() &amp; Qt::ShiftModifier) {
+    } else {
+      int n0=g_pWideGraph-&gt;DF();
+      int n=(n0 + 10000) % 5;
+      if(n==0) n=5;
+      g_pWideGraph-&gt;setDF(n0-n);
+    }
+    break;
+  case Qt::Key_F12:
+    if(e-&gt;modifiers() &amp; Qt::ShiftModifier) {
+    } else {
+      int n0=g_pWideGraph-&gt;DF();
+      int n=(n0 + 10000) % 5;
+      if(n==0) n=5;
+      g_pWideGraph-&gt;setDF(n0+n);
+    }
+    break;
+  case Qt::Key_G:
+    if(e-&gt;modifiers() &amp; Qt::AltModifier) {
+      genStdMsgs(&quot;&quot;);
+      break;
+    }
+  case Qt::Key_L:
+    if(e-&gt;modifiers() &amp; Qt::ControlModifier) {
+      lookup();
+      genStdMsgs(&quot;&quot;);
+      break;
+    }
+  }
+}
+
+void MainWindow::bumpDF(int n)                                  //bumpDF()
+{
+  if(n==11) {
+    int n0=g_pWideGraph-&gt;DF();
+    int n=(n0 + 10000) % 5;
+    if(n==0) n=5;
+    g_pWideGraph-&gt;setDF(n0-n);
+  }
+  if(n==12) {
+    int n0=g_pWideGraph-&gt;DF();
+    int n=(n0 + 10000) % 5;
+    if(n==0) n=5;
+    g_pWideGraph-&gt;setDF(n0+n);
+  }
+}
+
+bool MainWindow::eventFilter(QObject *object, QEvent *event)  //eventFilter()
+{
+  if (event-&gt;type() == QEvent::KeyPress) {
+    //Use the event in parent using its keyPressEvent()
+    QKeyEvent *keyEvent = static_cast&lt;QKeyEvent *&gt;(event);
+    MainWindow::keyPressEvent(keyEvent);
+    return QObject::eventFilter(object, event);
+  }
+  return QObject::eventFilter(object, event);
+}
+
+void MainWindow::createStatusBar()                           //createStatusBar
+{
+  lab1 = new QLabel(&quot;Receiving&quot;);
+  lab1-&gt;setAlignment(Qt::AlignHCenter);
+  lab1-&gt;setMinimumSize(QSize(80,10));
+  lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #00ff00}&quot;);
+  lab1-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);
+  statusBar()-&gt;addWidget(lab1);
+
+  lab2 = new QLabel(&quot;QSO freq:  125&quot;);
+  lab2-&gt;setAlignment(Qt::AlignHCenter);
+  lab2-&gt;setMinimumSize(QSize(90,10));
+  lab2-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);
+  statusBar()-&gt;addWidget(lab2);
+
+  lab3 = new QLabel(&quot;QSO DF:   0&quot;);
+  lab3-&gt;setAlignment(Qt::AlignHCenter);
+  lab3-&gt;setMinimumSize(QSize(80,10));
+  lab3-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);
+  statusBar()-&gt;addWidget(lab3);
+
+  lab4 = new QLabel(&quot;&quot;);
+  lab4-&gt;setAlignment(Qt::AlignHCenter);
+  lab4-&gt;setMinimumSize(QSize(80,10));
+  lab4-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);
+  statusBar()-&gt;addWidget(lab4);
+
+  lab5 = new QLabel(&quot;&quot;);
+  lab5-&gt;setAlignment(Qt::AlignHCenter);
+  lab5-&gt;setMinimumSize(QSize(50,10));
+  lab5-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);
+  statusBar()-&gt;addWidget(lab5);
+}
+
+void MainWindow::on_tolSpinBox_valueChanged(int i)             //tolSpinBox
+{
+  static int ntol[] = {10,20,50,100,200,500,1000};
+  m_tol=ntol[i];
+  g_pWideGraph-&gt;setTol(m_tol);
+  ui-&gt;labTol1-&gt;setText(QString::number(ntol[i]));
+}
+
+void MainWindow::on_actionExit_triggered()                     //Exit()
+{
+  OnExit();
+}
+
+void MainWindow::closeEvent(QCloseEvent*)
+{
+  OnExit();
+}
+
+void MainWindow::OnExit()
+{
+  g_pWideGraph-&gt;saveSettings();
+  m_killAll=true;
+  mem_m65.detach();
+  QFile quitFile(m_appDir + &quot;/.quit&quot;);
+  quitFile.open(QIODevice::ReadWrite);
+  QFile lockFile(m_appDir + &quot;/.lock&quot;);
+  lockFile.remove();                      // Allow m65 to terminate
+  bool b=proc_m65.waitForFinished(1000);
+  if(!b) proc_m65.kill();
+  quitFile.remove();
+  qApp-&gt;exit(0);                          // Exit the event loop
+}
+
+void MainWindow::on_stopButton_clicked()                       //stopButton
+{
+  m_monitoring=false;
+  soundInThread.setMonitoring(m_monitoring);
+  m_loopall=false;  
+}
+
+void MainWindow::msgBox(QString t)                             //msgBox
+{
+  msgBox0.setText(t);
+  msgBox0.exec();
+}
+
+void MainWindow::stub()                                        //stub()
+{
+  msgBox(&quot;Not yet implemented.&quot;);
+}
+
+void MainWindow::on_actionOnline_Users_Guide_triggered()      //Display manual
+{
+  QDesktopServices::openUrl(QUrl(
+  &quot;<A HREF="http://www.physics.princeton.edu/pulsar/K1JT/MAP65_Beta_Release.pdf">http://www.physics.princeton.edu/pulsar/K1JT/MAP65_Beta_Release.pdf</A>&quot;,
+                              QUrl::TolerantMode));
+}
+
+void MainWindow::on_actionAstro_Data_triggered()             //Display Astro
+{
+  if(g_pAstro==NULL) {
+    g_pAstro = new Astro(0);
+    g_pAstro-&gt;setWindowTitle(&quot;Astronomical Data&quot;);
+    Qt::WindowFlags flags = Qt::Dialog | Qt::WindowCloseButtonHint |
+        Qt::WindowMinimizeButtonHint;
+    g_pAstro-&gt;setWindowFlags(flags);
+    g_pAstro-&gt;setGeometry(m_astroGeom);
+  }
+  g_pAstro-&gt;show();
+}
+
+void MainWindow::on_actionWide_Waterfall_triggered()      //Display Waterfalls
+{
+  if(g_pWideGraph==NULL) {
+    g_pWideGraph = new WideGraph(0);
+    g_pWideGraph-&gt;setWindowTitle(&quot;Wide Graph&quot;);
+    g_pWideGraph-&gt;setGeometry(m_wideGraphGeom);
+    Qt::WindowFlags flags = Qt::WindowCloseButtonHint |
+        Qt::WindowMinimizeButtonHint;
+    g_pWideGraph-&gt;setWindowFlags(flags);
+    connect(g_pWideGraph, SIGNAL(freezeDecode2(int)),this,
+            SLOT(freezeDecode(int)));
+    connect(g_pWideGraph, SIGNAL(f11f12(int)),this,
+            SLOT(bumpDF(int)));
+  }
+  g_pWideGraph-&gt;show();
+}
+
+void MainWindow::on_actionBand_Map_triggered()              //Display BandMap
+{
+  if(g_pBandMap==NULL) {
+    g_pBandMap = new BandMap(0);
+    g_pBandMap-&gt;setWindowTitle(&quot;Band Map&quot;);
+    Qt::WindowFlags flags = Qt::Dialog | Qt::WindowCloseButtonHint |
+        Qt::WindowMinimizeButtonHint;
+    g_pBandMap-&gt;setWindowFlags(flags);
+    g_pBandMap-&gt;setGeometry(m_bandMapGeom);
+  }
+  g_pBandMap-&gt;show();
+}
+
+void MainWindow::on_actionMessages_triggered()              //Display Messages
+{
+  if(g_pMessages==NULL) {
+    g_pMessages = new Messages(0);
+    g_pMessages-&gt;setWindowTitle(&quot;Messages&quot;);
+    Qt::WindowFlags flags = Qt::Dialog | Qt::WindowCloseButtonHint |
+        Qt::WindowMinimizeButtonHint;
+    g_pMessages-&gt;setWindowFlags(flags);
+    g_pMessages-&gt;setGeometry(m_messagesGeom);
+    connect(g_pMessages, SIGNAL(click2OnCallsign(QString, QString)),this,
+            SLOT(doubleClickOnMessages(QString, QString)));
+  }
+  g_pMessages-&gt;show();
+}
+
+void MainWindow::on_actionOpen_triggered()                     //Open File
+{
+  m_monitoring=false;
+  soundInThread.setMonitoring(m_monitoring);
+  QString fname;
+  if(m_xpol) {
+    fname=QFileDialog::getOpenFileName(this, &quot;Open File&quot;, m_path,
+                                       &quot;MAP65 Files (*.tf2)&quot;);
+  } else {
+    fname=QFileDialog::getOpenFileName(this, &quot;Open File&quot;, m_path,
+                                       &quot;MAP65 Files (*.iq)&quot;);
+  }
+  if(fname != &quot;&quot;) {
+    m_path=fname;
+    int i;
+    i=fname.indexOf(&quot;.iq&quot;) - 11;
+    if(m_xpol) i=fname.indexOf(&quot;.tf2&quot;) - 11;
+    if(i&gt;=0) {
+      lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #66ff66}&quot;);
+      lab1-&gt;setText(&quot; &quot; + fname.mid(i,15) + &quot; &quot;);
+    }
+    on_stopButton_clicked();
+    m_diskData=true;
+    int dbDgrd=0;
+    if(m_myCall==&quot;K1JT&quot; and m_idInt&lt;0) dbDgrd=m_idInt;
+    *future1 = QtConcurrent::run(getfile, fname, m_xpol, dbDgrd);
+    watcher1-&gt;setFuture(*future1);
+  }
+}
+
+void MainWindow::on_actionOpen_next_in_directory_triggered()   //Open Next
+{
+  int i,len;
+  QFileInfo fi(m_path);
+  QStringList list;
+  list= fi.dir().entryList().filter(&quot;.iq&quot;);
+  len=14;
+  if(m_xpol) {
+      list= fi.dir().entryList().filter(&quot;.tf2&quot;);
+      len=15;
+  }
+  for (i = 0; i &lt; list.size()-1; ++i) {
+    if(i==list.size()-2) m_loopall=false;
+    if(list.at(i)==m_path.right(len)) {
+      int n=m_path.length();
+      QString fname=m_path.replace(n-len,len,list.at(i+1));
+      m_path=fname;
+      int i;
+      i=fname.indexOf(&quot;.iq&quot;) - 11;
+      if(m_xpol) i=fname.indexOf(&quot;.tf2&quot;) - 11;
+      if(i&gt;=0) {
+        lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #66ff66}&quot;);
+        lab1-&gt;setText(&quot; &quot; + fname.mid(i,len) + &quot; &quot;);
+      }
+      m_diskData=true;
+      int dbDgrd=0;
+      if(m_myCall==&quot;K1JT&quot; and m_idInt&lt;0) dbDgrd=m_idInt;
+      *future1 = QtConcurrent::run(getfile, fname, m_xpol, dbDgrd);
+      watcher1-&gt;setFuture(*future1);
+      return;
+    }
+  }
+}
+                                                   //Open all remaining files
+void MainWindow::on_actionDecode_remaining_files_in_directory_triggered()
+{
+  m_loopall=true;
+  on_actionOpen_next_in_directory_triggered();
+}
+
+void MainWindow::diskDat()                                   //diskDat()
+{
+  double hsym;
+  //These may be redundant??
+  m_diskData=true;
+  datcom_.newdat=1;
+
+  if(m_fs96000) hsym=2048.0*96000.0/11025.0;   //Samples per JT65 half-symbol
+  if(!m_fs96000) hsym=2048.0*95238.1/11025.0;
+  for(int i=0; i&lt;281; i++) {              // Do the half-symbol FFTs
+    int k = i*hsym + 2048.5;
+    dataSink(k);
+    if(i%10 == 0) qApp-&gt;processEvents();   //Keep the GUI responsive
+  }
+}
+
+void MainWindow::diskWriteFinished()                       //diskWriteFinished
+{
+//  qDebug() &lt;&lt; &quot;diskWriteFinished&quot;;
+}
+                                                        //Delete ../save/*.tf2
+void MainWindow::on_actionDelete_all_tf2_files_in_SaveDir_triggered()
+{
+  int i;
+  QString fname;
+  int ret = QMessageBox::warning(this, &quot;Confirm Delete&quot;,
+      &quot;Are you sure you want to delete all *.tf2 and *.iq files in\n&quot; +
+       QDir::toNativeSeparators(m_saveDir) + &quot; ?&quot;,
+       QMessageBox::Yes | QMessageBox::No, QMessageBox::Yes);
+  if(ret==QMessageBox::Yes) {
+    QDir dir(m_saveDir);
+    QStringList files=dir.entryList(QDir::Files);
+    QList&lt;QString&gt;::iterator f;
+    for(f=files.begin(); f!=files.end(); ++f) {
+      fname=*f;
+      i=(fname.indexOf(&quot;.tf2&quot;));
+      if(i==11) dir.remove(fname);
+      i=(fname.indexOf(&quot;.iq&quot;));
+      if(i==11) dir.remove(fname);
+    }
+  }
+}
+                                          //Clear BandMap and Messages windows
+void MainWindow::on_actionErase_Band_Map_and_Messages_triggered()
+{
+  g_pBandMap-&gt;setText(&quot;&quot;);
+  g_pMessages-&gt;setText(&quot;&quot;);
+  m_map65RxLog |= 4;
+}
+
+void MainWindow::on_actionFind_Delta_Phi_triggered()              //Find dPhi
+{
+  m_map65RxLog |= 8;
+  on_DecodeButton_clicked();
+}
+
+void MainWindow::on_actionF4_sets_Tx6_triggered()                //F4 sets Tx6
+{
+  m_kb8rq = !m_kb8rq;
+}
+
+void MainWindow::on_actionOnly_EME_calls_triggered()          //EME calls only
+{
+  m_onlyEME = ui-&gt;actionOnly_EME_calls-&gt;isChecked();
+}
+
+void MainWindow::on_actionNo_shorthands_if_Tx1_triggered()
+{
+  stub();
+}
+
+void MainWindow::on_actionNo_Deep_Search_triggered()          //No Deep Search
+{
+  m_ndepth=0;
+}
+
+void MainWindow::on_actionNormal_Deep_Search_triggered()      //Normal DS
+{
+  m_ndepth=1;
+}
+
+void MainWindow::on_actionAggressive_Deep_Search_triggered()  //Aggressive DS
+{
+  m_ndepth=2;
+}
+
+void MainWindow::on_actionNone_triggered()                    //Save None
+{
+  m_saveAll=false;
+}
+
+// ### Implement &quot;Save Last&quot; here? ###
+
+void MainWindow::on_actionSave_all_triggered()                //Save All
+{
+  m_saveAll=true;
+}
+                                          //Display list of keyboard shortcuts
+void MainWindow::on_actionKeyboard_shortcuts_triggered()
+{
+  stub();
+}
+                                              //Display list of mouse commands
+void MainWindow::on_actionSpecial_mouse_commands_triggered()
+{
+  stub();
+}
+                                              //Diaplay list of Add-On pfx/sfx
+void MainWindow::on_actionAvailable_suffixes_and_add_on_prefixes_triggered()
+{
+  stub();
+}
+
+void MainWindow::on_DecodeButton_clicked()                    //Decode request
+{
+  int n=m_sec0%60;
+  if(m_monitoring and n&gt;47 and (n&lt;52 or m_decoderBusy)) return;
+  if(!m_decoderBusy) {
+    datcom_.newdat=0;
+    datcom_.nagain=1;
+    decode();
+  }
+}
+
+void MainWindow::freezeDecode(int n)                          //freezeDecode()
+{
+  if(n==2) {
+    ui-&gt;tolSpinBox-&gt;setValue(5);
+    datcom_.ntol=m_tol;
+    datcom_.mousedf=0;
+  } else {
+    ui-&gt;tolSpinBox-&gt;setValue(3);
+    datcom_.ntol=m_tol;
+  }
+  if(!m_decoderBusy) {
+    datcom_.nagain=1;
+    datcom_.newdat=0;
+    decode();
+  }
+}
+
+void MainWindow::decode()                                       //decode()
+{
+  ui-&gt;DecodeButton-&gt;setStyleSheet(m_pbdecoding_style1);
+  if(datcom_.nagain==0 &amp;&amp; (!m_diskData)) {
+    qint64 ms = QDateTime::currentMSecsSinceEpoch() % 86400000;
+    int imin=ms/60000;
+    int ihr=imin/60;
+    imin=imin % 60;
+    datcom_.nutc=100*ihr + imin;
+  }
+
+  datcom_.idphi=m_dPhi;
+  datcom_.mousedf=g_pWideGraph-&gt;DF();
+  datcom_.mousefqso=g_pWideGraph-&gt;QSOfreq();
+  datcom_.ndepth=m_ndepth;
+  datcom_.ndiskdat=0;
+  if(m_diskData) datcom_.ndiskdat=1;
+  datcom_.neme=0;
+  if(ui-&gt;actionOnly_EME_calls-&gt;isChecked()) datcom_.neme=1;
+
+  int ispan=int(g_pWideGraph-&gt;fSpan());
+  if(ispan%2 == 1) ispan++;
+  int ifc=int(1000.0*(datcom_.fcenter - int(datcom_.fcenter))+0.5);
+  int nfa=g_pWideGraph-&gt;nStartFreq();
+  int nfb=nfa+ispan;
+  int nfshift=nfa + ispan/2 - ifc;
+
+  datcom_.nfa=nfa;
+  datcom_.nfb=nfb;
+  datcom_.nfcal=m_fCal;
+  datcom_.nfshift=nfshift;
+  datcom_.mcall3=0;
+  if(m_call3Modified) datcom_.mcall3=1;
+  datcom_.ntimeout=m_timeout;
+  datcom_.ntol=m_tol;
+  datcom_.nxant=0;
+  if(m_xpolx) datcom_.nxant=1;
+  if(datcom_.nutc &lt; m_nutc0) m_map65RxLog |= 1;  //Date and Time to all65.txt
+  m_nutc0=datcom_.nutc;
+  datcom_.map65RxLog=m_map65RxLog;
+  datcom_.nfsample=96000;
+  if(!m_fs96000) datcom_.nfsample=95238;
+  datcom_.nxpol=0;
+  if(m_xpol) datcom_.nxpol=1;
+  datcom_.mode65=m_mode65;
+
+  QString mcall=(m_myCall+&quot;            &quot;).mid(0,12);
+  QString mgrid=(m_myGrid+&quot;            &quot;).mid(0,6);
+  QString hcall=(ui-&gt;dxCallEntry-&gt;text()+&quot;            &quot;).mid(0,12);
+  QString hgrid=(ui-&gt;dxGridEntry-&gt;text()+&quot;      &quot;).mid(0,6);
+
+  strncpy(datcom_.mycall, mcall.toAscii(), 12);
+  strncpy(datcom_.mygrid, mgrid.toAscii(), 6);
+  strncpy(datcom_.hiscall, hcall.toAscii(), 12);
+  strncpy(datcom_.hisgrid, hgrid.toAscii(), 6);
+  strncpy(datcom_.datetime, m_dateTime.toAscii(), 20);
+
+  //newdat=1  ==&gt; this is new data, must do the big FFT
+  //nagain=1  ==&gt; decode only at fQSO +/- Tol
+
+  char *to = (char*)mem_m65.data();
+  char *from = (char*) datcom_.d4;
+  int size=sizeof(datcom_);
+  if(datcom_.newdat==0) {
+    int noffset = 4*4*5760000 + 4*4*322*32768 + 4*4*32768;
+    to += noffset;
+    from += noffset;
+    size -= noffset;
+  }
+  memcpy(to, from, qMin(mem_m65.size(), size));
+  datcom_.nagain=0;
+  datcom_.ndiskdat=0;
+  m_call3Modified=false;
+
+  QFile lockFile(m_appDir + &quot;/.lock&quot;);       // Allow m65 to start
+  lockFile.remove();
+
+  decodeBusy(true);
+}
+
+void MainWindow::m65_error()                                     //m65_error
+{
+  if(!m_killAll) {
+    msgBox(&quot;Error starting or running\n&quot; + m_appDir + &quot;/m65 -s&quot;);
+    exit(1);
+  }
+}
+
+void MainWindow::readFromStderr()                             //readFromStderr
+{
+  QByteArray t=proc_m65.readAllStandardError();
+  msgBox(t);
+}
+
+
+void MainWindow::readFromStdout()                             //readFromStdout
+{
+  while(proc_m65.canReadLine())
+  {
+    QByteArray t=proc_m65.readLine();
+    if(t.indexOf(&quot;&lt;m65aFinished&gt;&quot;) &gt;= 0) {
+      if(m_widebandDecode) {
+        g_pMessages-&gt;setText(m_messagesText);
+        g_pBandMap-&gt;setText(m_bandmapText);
+        m_widebandDecode=false;
+      }
+      QFile lockFile(m_appDir + &quot;/.lock&quot;);
+      lockFile.open(QIODevice::ReadWrite);
+      ui-&gt;DecodeButton-&gt;setStyleSheet(&quot;&quot;);
+      decodeBusy(false);
+      m_map65RxLog=0;
+      m_startAnother=m_loopall;
+      return;
+    }
+
+    if(t.indexOf(&quot;!&quot;) &gt;= 0) {
+      int n=t.length();
+      if(n&gt;=30) ui-&gt;decodedTextBrowser-&gt;append(t.mid(1,n-3));
+      if(n&lt;30) ui-&gt;decodedTextBrowser-&gt;append(t.mid(1,n-3));
+      n=ui-&gt;decodedTextBrowser-&gt;verticalScrollBar()-&gt;maximum();
+      ui-&gt;decodedTextBrowser-&gt;verticalScrollBar()-&gt;setValue(n);
+      m_messagesText=&quot;&quot;;
+      m_bandmapText=&quot;&quot;;
+    }
+
+    if(t.indexOf(&quot;@&quot;) &gt;= 0) {
+      m_messagesText += t.mid(1);
+      m_widebandDecode=true;
+    }
+
+    if(t.indexOf(&quot;&amp;&quot;) &gt;= 0) {
+      QString q(t);
+      QString callsign=q.mid(5);
+      callsign=callsign.mid(0,callsign.indexOf(&quot; &quot;));
+      if(callsign.length()&gt;2) {
+        if(m_worked[callsign]) {
+          q=q.mid(1,4) + &quot;  &quot; + q.mid(5);
+        } else {
+          q=q.mid(1,4) + &quot; *&quot; + q.mid(5);
+        }
+        m_bandmapText += q;
+      }
+    }
+  }
+}
+
+void MainWindow::on_EraseButton_clicked()                          //Erase
+{
+  ui-&gt;decodedTextBrowser-&gt;clear();
+}
+
+void MainWindow::decodeBusy(bool b)                             //decodeBusy()
+{
+  m_decoderBusy=b;
+  ui-&gt;DecodeButton-&gt;setEnabled(!b);
+  ui-&gt;actionOpen-&gt;setEnabled(!b);
+  ui-&gt;actionOpen_next_in_directory-&gt;setEnabled(!b);
+  ui-&gt;actionDecode_remaining_files_in_directory-&gt;setEnabled(!b);
+}
+
+//------------------------------------------------------------- //guiUpdate()
+void MainWindow::guiUpdate()
+{
+  static int iptt0=0;
+  static int iptt=0;
+  static bool btxok0=false;
+  static int nc0=1;
+  static int nc1=1;
+  static char msgsent[23];
+  static int nsendingsh=0;
+  int khsym=0;
+
+  double tx1=0.0;
+  double tx2=126.0*4096.0/11025.0 + 1.8;          //### depend on TxDelay? ###
+
+  if(!m_txFirst) {
+    tx1 += 60.0;
+    tx2 += 60.0;
+  }
+  qint64 ms = QDateTime::currentMSecsSinceEpoch() % 86400000;
+  int nsec=ms/1000;
+  double tsec=0.001*ms;
+  double t120=fmod(tsec,120.0);
+  bool bTxTime = t120 &gt;= tx1 &amp;&amp; t120 &lt; tx2;
+
+  if(m_auto) {
+    if(bTxTime and iptt==0 and !m_txMute) {
+      int itx=1;
+      int ierr = ptt_(&amp;m_pttPort,&amp;itx,&amp;iptt);       // Raise PTT
+      if(ierr != 0) {
+        on_stopTxButton_clicked();
+        char s[18];
+        sprintf(s,&quot;Cannot open COM%d&quot;,m_pttPort);
+        msgBox(s);
+      }
+      if(!soundOutThread.isRunning()) {
+        soundOutThread.start(QThread::HighPriority);
+      }
+    }
+    if(!bTxTime || m_txMute) {
+      btxok=false;
+    }
+  }
+
+// Calculate Tx waveform when needed
+  if((iptt==1 &amp;&amp; iptt0==0) || m_restart) {
+    char message[23];
+    QByteArray ba;
+    if(m_ntx == 1) ba=ui-&gt;tx1-&gt;text().toLocal8Bit();
+    if(m_ntx == 2) ba=ui-&gt;tx2-&gt;text().toLocal8Bit();
+    if(m_ntx == 3) ba=ui-&gt;tx3-&gt;text().toLocal8Bit();
+    if(m_ntx == 4) ba=ui-&gt;tx4-&gt;text().toLocal8Bit();
+    if(m_ntx == 5) ba=ui-&gt;tx5-&gt;text().toLocal8Bit();
+    if(m_ntx == 6) ba=ui-&gt;tx6-&gt;text().toLocal8Bit();
+
+    ba2msg(ba,message);
+    int len1=22;
+    int mode65=m_mode65;
+    double samfac=1.0;
+
+    gen65_(message,&amp;mode65,&amp;samfac,&amp;nsendingsh,msgsent,iwave,&amp;nwave,len1,len1);
+    msgsent[22]=0;
+
+    if(m_restart) {
+      QFile f(&quot;map65_tx.log&quot;);
+      f.open(QIODevice::WriteOnly | QIODevice::Text | QIODevice::Append);
+      QTextStream out(&amp;f);
+      out &lt;&lt; QDateTime::currentDateTimeUtc().toString(&quot;yyyy-MMM-dd hh:mm&quot;)
+          &lt;&lt; &quot;  Tx message:  &quot; &lt;&lt; QString::fromAscii(msgsent) &lt;&lt; endl;
+      f.close();
+    }
+
+    m_restart=false;
+  }
+
+// If PTT was just raised, start a countdown for raising TxOK:
+  if(iptt==1 &amp;&amp; iptt0==0) nc1=-9;    // TxDelay = 0.8 s
+  if(nc1 &lt;= 0) nc1++;
+  if(nc1 == 0) {
+    ui-&gt;xThermo-&gt;setValue(0.0);   //Set the Thermos to zero
+    ui-&gt;yThermo-&gt;setValue(0.0);
+    m_monitoring=false;
+    soundInThread.setMonitoring(false);
+    btxok=true;
+    m_transmitting=true;
+
+    QFile f(&quot;map65_tx.log&quot;);
+    f.open(QIODevice::WriteOnly | QIODevice::Text | QIODevice::Append);
+    QTextStream out(&amp;f);
+    out &lt;&lt; QDateTime::currentDateTimeUtc().toString(&quot;yyyy-MMM-dd hh:mm&quot;)
+        &lt;&lt; &quot;  Tx message:  &quot; &lt;&lt; QString::fromAscii(msgsent) &lt;&lt; endl;
+    f.close();
+  }
+
+// If btxok was just lowered, start a countdown for lowering PTT
+  if(!btxok &amp;&amp; btxok0 &amp;&amp; iptt==1) nc0=-11;  //RxDelay = 1.0 s
+  if(nc0 &lt;= 0) nc0++;
+  if(nc0 == 0) {
+    int itx=0;
+    ptt_(&amp;m_pttPort,&amp;itx,&amp;iptt);       // Lower PTT
+    if(!m_txMute) soundOutThread.quitExecution=true;
+    m_transmitting=false;
+    if(m_auto) {
+      m_monitoring=true;
+      soundInThread.setMonitoring(m_monitoring);
+    }
+  }
+
+  if(iptt == 0 &amp;&amp; !btxok) {
+    // sending=&quot;&quot;
+    // nsendingsh=0
+  }
+
+  if(m_monitoring) {
+    ui-&gt;monitorButton-&gt;setStyleSheet(m_pbmonitor_style);
+  } else {
+    ui-&gt;monitorButton-&gt;setStyleSheet(&quot;&quot;);
+  }
+
+  lab2-&gt;setText(&quot;QSO Freq:  &quot; + QString::number(g_pWideGraph-&gt;QSOfreq()));
+  lab3-&gt;setText(&quot;QSO DF:  &quot; + QString::number(g_pWideGraph-&gt;DF()));
+
+  if(m_startAnother) {
+    m_startAnother=false;
+    on_actionOpen_next_in_directory_triggered();
+  }
+
+  if(nsec != m_sec0) {                                     //Once per second
+    soundInThread.setForceCenterFreqMHz(g_pWideGraph-&gt;m_dForceCenterFreq);
+    soundInThread.setForceCenterFreqBool(g_pWideGraph-&gt;m_bForceCenterFreq);
+
+    if(m_pctZap&gt;30.0 and !m_transmitting) {
+      lab4-&gt;setStyleSheet(&quot;QLabel{background-color: #ff0000}&quot;);
+    } else {
+      lab4-&gt;setStyleSheet(&quot;&quot;);
+    }
+
+    if(m_transmitting) {
+      if(nsendingsh==1) {
+        lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #66ffff}&quot;);
+      } else if(nsendingsh==-1) {
+        lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #ffccff}&quot;);
+      } else {
+        lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #ffff33}&quot;);
+      }
+      char s[37];
+      sprintf(s,&quot;Tx: %s&quot;,msgsent);
+      lab1-&gt;setText(s);
+    } else if(m_monitoring) {
+      lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #00ff00}&quot;);
+      m_nrx=soundInThread.nrx();
+      khsym=soundInThread.mhsym();
+      QString t;
+      if(m_network) {
+        if(m_nrx==-1) t=&quot;F1&quot;;
+        if(m_nrx==1) t=&quot;I1&quot;;
+        if(m_nrx==-2) t=&quot;F2&quot;;
+        if(m_nrx==+2) t=&quot;I2&quot;;
+      } else {
+        if(m_nrx==1) t=&quot;S1&quot;;
+        if(m_nrx==2) t=&quot;S2&quot;;
+      }
+      if((abs(m_nrx)==1 and m_xpol) or (abs(m_nrx)==2 and !m_xpol))
+        lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #ff1493}&quot;);
+      if(khsym==m_hsym0) {
+        t=&quot;Nil&quot;;
+        lab1-&gt;setStyleSheet(&quot;QLabel{background-color: #ffc0cb}&quot;);
+      }
+      lab1-&gt;setText(&quot;Receiving &quot; + t);
+    } else if (!m_diskData) {
+      lab1-&gt;setStyleSheet(&quot;&quot;);
+      lab1-&gt;setText(&quot;&quot;);
+    }
+
+    QDateTime t = QDateTime::currentDateTimeUtc();
+    int fQSO=g_pWideGraph-&gt;QSOfreq();
+    g_pAstro-&gt;astroUpdate(t, m_myGrid, m_hisGrid, fQSO, m_setftx,
+                          m_txFreq, m_azelDir);
+    m_setftx=0;
+    QString utc = &quot; &quot; + t.time().toString() + &quot; &quot;;
+    ui-&gt;labUTC-&gt;setText(utc);
+    if((!m_monitoring and !m_diskData) or (khsym==m_hsym0)) {
+      ui-&gt;xThermo-&gt;setValue(0.0);                      // Set Rx levels to 0
+      ui-&gt;yThermo-&gt;setValue(0.0);
+      lab4-&gt;setText(&quot; Rx noise:    0.0     0.0  0.0% &quot;);
+    }
+    m_hsym0=khsym;
+    m_sec0=nsec;
+  }
+  iptt0=iptt;
+  btxok0=btxok;
+}
+
+void MainWindow::ba2msg(QByteArray ba, char message[])             //ba2msg()
+{
+  bool eom;
+  eom=false;
+  for(int i=0;i&lt;22; i++) {
+    if((int)ba[i] == 0) eom=true;
+    if(eom) {
+      message[i]=32;
+    } else {
+      message[i]=ba[i];
+    }
+  }
+  message[22]=0;
+}
+
+void MainWindow::on_txFirstCheckBox_stateChanged(int nstate)        //TxFirst
+{
+  m_txFirst = (nstate==2);
+}
+
+void MainWindow::set_ntx(int n)                                   //set_ntx()
+{
+  m_ntx=n;
+}
+
+void MainWindow::on_txb1_clicked()                                //txb1
+{
+  m_ntx=1;
+  ui-&gt;txrb1-&gt;setChecked(true);
+  m_restart=true;
+}
+
+void MainWindow::on_txb2_clicked()                                //txb2
+{
+  m_ntx=2;
+  ui-&gt;txrb2-&gt;setChecked(true);
+  m_restart=true;
+}
+
+void MainWindow::on_txb3_clicked()                                //txb3
+{
+  m_ntx=3;
+  ui-&gt;txrb3-&gt;setChecked(true);
+  m_restart=true;
+}
+
+void MainWindow::on_txb4_clicked()                                //txb4
+{
+  m_ntx=4;
+  ui-&gt;txrb4-&gt;setChecked(true);
+  m_restart=true;
+}
+
+void MainWindow::on_txb5_clicked()                                //txb5
+{
+  m_ntx=5;
+  ui-&gt;txrb5-&gt;setChecked(true);
+  m_restart=true;
+}
+
+void MainWindow::on_txb6_clicked()                                //txb6
+{
+  m_ntx=6;
+  ui-&gt;txrb6-&gt;setChecked(true);
+  m_restart=true;
+}
+
+void MainWindow::selectCall2(bool ctrl)                                //selectCall2
+{
+  QString t = ui-&gt;decodedTextBrowser-&gt;toPlainText();   //Full contents
+  int i=ui-&gt;decodedTextBrowser-&gt;textCursor().position();
+  int i0=t.lastIndexOf(&quot; &quot;,i);
+  int i1=t.indexOf(&quot; &quot;,i);
+  QString hiscall=t.mid(i0+1,i1-i0-1);
+  if(hiscall!=&quot;&quot;) {
+    if(hiscall.length() &lt; 13) doubleClickOnCall(hiscall, ctrl);
+  }
+}
+                                                          //doubleClickOnCall
+void MainWindow::doubleClickOnCall(QString hiscall, bool ctrl)
+{
+  if(m_worked[hiscall]) {
+    msgBox(&quot;Possible dupe: &quot; + hiscall + &quot; already in log.&quot;);
+  }
+  ui-&gt;dxCallEntry-&gt;setText(hiscall);
+  QString t = ui-&gt;decodedTextBrowser-&gt;toPlainText();   //Full contents
+  int i2=ui-&gt;decodedTextBrowser-&gt;textCursor().position();
+  QString t1 = t.mid(0,i2);              //contents up to text cursor
+  int i1=t1.lastIndexOf(&quot;\n&quot;) + 1;
+  QString t2 = t1.mid(i1,i2-i1);         //selected line
+  int n = 60*t2.mid(13,2).toInt() + t2.mid(15,2).toInt();
+  m_txFirst = ((n%2) == 1);
+  ui-&gt;txFirstCheckBox-&gt;setChecked(m_txFirst);
+  QString rpt=&quot;&quot;;
+  if(ctrl) rpt=t2.mid(23,3);
+  lookup();
+  genStdMsgs(rpt);
+  if(t2.indexOf(m_myCall)&gt;0) {
+    m_ntx=2;
+    ui-&gt;txrb2-&gt;setChecked(true);
+  } else {
+    m_ntx=1;
+    ui-&gt;txrb1-&gt;setChecked(true);
+  }
+}
+                                                      //doubleClickOnMessages
+void MainWindow::doubleClickOnMessages(QString hiscall, QString t2)
+{
+  if(m_worked[hiscall]) {
+    msgBox(&quot;Possible dupe: &quot; + hiscall + &quot; already in log.&quot;);
+  }
+  ui-&gt;dxCallEntry-&gt;setText(hiscall);
+  int n = 60*t2.mid(13,2).toInt() + t2.mid(15,2).toInt();
+  m_txFirst = ((n%2) == 1);
+  ui-&gt;txFirstCheckBox-&gt;setChecked(m_txFirst);
+  lookup();
+  genStdMsgs(&quot;&quot;);
+  if(t2.indexOf(m_myCall)&gt;0) {
+    m_ntx=2;
+    ui-&gt;txrb2-&gt;setChecked(true);
+  } else {
+    m_ntx=1;
+    ui-&gt;txrb1-&gt;setChecked(true);
+  }
+}
+
+void MainWindow::genStdMsgs(QString rpt)                       //genStdMsgs()
+{
+  QString hiscall=ui-&gt;dxCallEntry-&gt;text().toUpper().trimmed();
+  ui-&gt;dxCallEntry-&gt;setText(hiscall);
+  QString t0=hiscall + &quot; &quot; + m_myCall + &quot; &quot;;
+  QString t=t0 + m_myGrid.mid(0,4);
+  msgtype(t, ui-&gt;tx1);
+  if(rpt == &quot;&quot;) {
+    t=t+&quot; OOO&quot;;
+    msgtype(t, ui-&gt;tx2);
+    msgtype(&quot;RO&quot;, ui-&gt;tx3);
+    msgtype(&quot;RRR&quot;, ui-&gt;tx4);
+    msgtype(&quot;73&quot;, ui-&gt;tx5);
+  } else {
+    t=t0 + rpt;
+    msgtype(t, ui-&gt;tx2);
+    t=t0 + &quot;R&quot; + rpt;
+    msgtype(t, ui-&gt;tx3);
+    t=t0 + &quot;RRR&quot;;
+    msgtype(t, ui-&gt;tx4);
+    t=t0 + &quot;73&quot;;
+    msgtype(t, ui-&gt;tx5);
+  }
+  t=&quot;CQ &quot; + m_myCall + &quot; &quot; + m_myGrid.mid(0,4);
+  msgtype(t, ui-&gt;tx6);
+  m_ntx=1;
+  ui-&gt;txrb1-&gt;setChecked(true);
+}
+
+void MainWindow::lookup()                                       //lookup()
+{
+  QString hiscall=ui-&gt;dxCallEntry-&gt;text().toUpper().trimmed();
+  ui-&gt;dxCallEntry-&gt;setText(hiscall);
+  QString call3File = m_appDir + &quot;/CALL3.TXT&quot;;
+  QFile f(call3File);
+  if(!f.open(QIODevice::ReadOnly | QIODevice::Text)) {
+    msgBox(&quot;Cannot open &quot; + call3File);
+    return;
+  }
+  char c[132];
+  qint64 n=0;
+  for(int i=0; i&lt;999999; i++) {
+    n=f.readLine(c,sizeof(c));
+    if(n &lt;= 0) {
+      ui-&gt;dxGridEntry-&gt;setText(&quot;&quot;);
+      break;
+     }
+    QString t=QString(c);
+    if(t.indexOf(hiscall)==0) {
+      int i1=t.indexOf(&quot;,&quot;);
+      QString hisgrid=t.mid(i1+1,6);
+      i1=hisgrid.indexOf(&quot;,&quot;);
+      if(i1&gt;0) {
+        hisgrid=hisgrid.mid(0,4);
+      } else {
+        hisgrid=hisgrid.mid(0,4) + hisgrid.mid(4,2).toLower();
+      }
+      ui-&gt;dxGridEntry-&gt;setText(hisgrid);
+      break;
+    }
+  }
+  f.close();
+}
+
+void MainWindow::on_lookupButton_clicked()                    //Lookup button
+{
+  lookup();
+}
+
+void MainWindow::on_addButton_clicked()                       //Add button
+{
+  if(ui-&gt;dxGridEntry-&gt;text()==&quot;&quot;) {
+    msgBox(&quot;Please enter a valid grid locator.&quot;);
+    return;
+  }
+  m_call3Modified=false;
+  QString hiscall=ui-&gt;dxCallEntry-&gt;text().toUpper().trimmed();
+  QString hisgrid=ui-&gt;dxGridEntry-&gt;text().trimmed();
+  QString newEntry=hiscall + &quot;,&quot; + hisgrid;
+
+  int ret = QMessageBox::warning(this, &quot;Add&quot;,
+       newEntry + &quot;\n&quot; + &quot;Is this station known to be active on EME?&quot;,
+       QMessageBox::Yes | QMessageBox::No, QMessageBox::Yes);
+  if(ret==QMessageBox::Yes) {
+    newEntry += &quot;,EME,,&quot;;
+  } else {
+    newEntry += &quot;,,,&quot;;
+  }
+  QString call3File = m_appDir + &quot;/CALL3.TXT&quot;;
+  QFile f1(call3File);
+  if(!f1.open(QIODevice::ReadOnly | QIODevice::Text)) {
+    msgBox(&quot;Cannot open &quot; + call3File);
+    return;
+  }
+  QString tmpFile = m_appDir + &quot;/CALL3.TMP&quot;;
+  QFile f2(tmpFile);
+  if(!f2.open(QIODevice::WriteOnly | QIODevice::Text)) {
+    msgBox(&quot;Cannot open &quot; + tmpFile);
+    return;
+  }
+  QTextStream in(&amp;f1);
+  QTextStream out(&amp;f2);
+  QString hc=hiscall;
+  QString hc1=&quot;&quot;;
+  QString hc2=&quot;&quot;;
+  QString s;
+  do {
+    s=in.readLine();
+    hc1=hc2;
+    if(s.mid(0,2)==&quot;//&quot;) {
+      out &lt;&lt; s + &quot;\n&quot;;
+    } else {
+      int i1=s.indexOf(&quot;,&quot;);
+      hc2=s.mid(0,i1);
+      if(hc&gt;hc1 &amp;&amp; hc&lt;hc2) {
+        out &lt;&lt; newEntry + &quot;\n&quot;;
+        m_call3Modified=true;
+      } else if(hc==hc2) {
+        QString t=s + &quot;\n\n is already in CALL3.TXT\n&quot; +
+            &quot;Do you wish to replace it?&quot;;
+        int ret = QMessageBox::warning(this, &quot;Add&quot;,t,
+             QMessageBox::Yes | QMessageBox::No, QMessageBox::Yes);
+        if(ret==QMessageBox::Yes) {
+          out &lt;&lt; newEntry + &quot;\n&quot;;
+          m_call3Modified=true;
+        }
+      } else {
+        out &lt;&lt; s + &quot;\n&quot;;
+      }
+    }
+  } while(!s.isNull());
+
+  f1.close();
+  if(hc&gt;hc1 &amp;&amp; !m_call3Modified)
+    out &lt;&lt; newEntry + &quot;\n&quot;;
+  if(m_call3Modified) {
+    QFile f0(m_appDir + &quot;/CALL3.OLD&quot;);
+    if(f0.exists()) f0.remove();
+    QFile f1(m_appDir + &quot;/CALL3.TXT&quot;);
+    f1.rename(m_appDir + &quot;/CALL3.OLD&quot;);
+    f2.rename(m_appDir + &quot;/CALL3.TXT&quot;);
+    f2.close();
+  }
+}
+
+void MainWindow::msgtype(QString t, QLineEdit* tx)                //msgtype()
+{
+//  if(t.length()&lt;1) return 0;
+  char message[23];
+  char msgsent[23];
+  int len1=22;
+  int mode65=0;            //mode65 ==&gt; check message but don't make wave()
+  double samfac=1.0;
+  int nsendingsh=0;
+  int mwave;
+  t=t.toUpper();
+  int i1=t.indexOf(&quot; OOO&quot;);
+  QByteArray s=t.toUpper().toLocal8Bit();
+  ba2msg(s,message);
+  gen65_(message,&amp;mode65,&amp;samfac,&amp;nsendingsh,msgsent,iwave,&amp;mwave,len1,len1);
+
+  QPalette p(tx-&gt;palette());
+  if(nsendingsh==1) {
+    p.setColor(QPalette::Base,&quot;#66ffff&quot;);
+  } else if(nsendingsh==-1) {
+    p.setColor(QPalette::Base,&quot;#ffccff&quot;);
+  } else {
+    p.setColor(QPalette::Base,Qt::white);
+  }
+  tx-&gt;setPalette(p);
+  int len=t.length();
+  if(nsendingsh==-1) {
+    len=qMin(len,13);
+    if(i1&gt;10) {
+      tx-&gt;setText(t.mid(0,len).toUpper() + &quot; OOO&quot;);
+    } else {
+      tx-&gt;setText(t.mid(0,len).toUpper());
+    }
+  } else {
+    tx-&gt;setText(t);
+  }
+}
+
+void MainWindow::on_tx1_editingFinished()                       //tx1 edited
+{
+  QString t=ui-&gt;tx1-&gt;text();
+  msgtype(t, ui-&gt;tx1);
+}
+
+void MainWindow::on_tx2_editingFinished()                       //tx2 edited
+{
+  QString t=ui-&gt;tx2-&gt;text();
+  msgtype(t, ui-&gt;tx2);
+}
+
+void MainWindow::on_tx3_editingFinished()                       //tx3 edited
+{
+  QString t=ui-&gt;tx3-&gt;text();
+  msgtype(t, ui-&gt;tx3);
+}
+
+void MainWindow::on_tx4_editingFinished()                       //tx4 edited
+{
+  QString t=ui-&gt;tx4-&gt;text();
+  msgtype(t, ui-&gt;tx4);
+}
+
+void MainWindow::on_tx5_editingFinished()                       //tx5 edited
+{
+  QString t=ui-&gt;tx5-&gt;text();
+  msgtype(t, ui-&gt;tx5);
+}
+
+void MainWindow::on_tx6_editingFinished()                       //tx6 edited
+{
+  QString t=ui-&gt;tx6-&gt;text();
+  msgtype(t, ui-&gt;tx6);
+}
+
+void MainWindow::on_setTxFreqButton_clicked()                  //Set Tx Freq
+{
+  m_setftx=1;
+  m_txFreq=g_pWideGraph-&gt;QSOfreq();
+}
+
+void MainWindow::on_dxCallEntry_textChanged(const QString &amp;t) //dxCall changed
+{
+  m_hisCall=t.toUpper().trimmed();
+  ui-&gt;dxCallEntry-&gt;setText(m_hisCall);
+}
+
+void MainWindow::on_dxGridEntry_textChanged(const QString &amp;t) //dxGrid changed
+{
+  int n=t.length();
+  if(n!=4 and n!=6) return;
+  if(!t[0].isLetter() or !t[1].isLetter()) return;
+  if(!t[2].isDigit() or !t[3].isDigit()) return;
+  if(n==4) m_hisGrid=t.mid(0,2).toUpper() + t.mid(2,2);
+  if(n==6) m_hisGrid=t.mid(0,2).toUpper() + t.mid(2,2) +
+      t.mid(4,2).toLower();
+  ui-&gt;dxGridEntry-&gt;setText(m_hisGrid);
+}
+
+void MainWindow::on_genStdMsgsPushButton_clicked()         //genStdMsgs button
+{
+  genStdMsgs(&quot;&quot;);
+}
+
+void MainWindow::on_logQSOButton_clicked()                 //Log QSO button
+{
+  int nMHz=int(datcom_.fcenter);
+  QDateTime t = QDateTime::currentDateTimeUtc();
+  QString logEntry=t.date().toString(&quot;yyyy-MMM-dd,&quot;) +
+      t.time().toString(&quot;hh:mm,&quot;) + m_hisCall + &quot;,&quot; + m_hisGrid + &quot;,&quot; +
+      QString::number(nMHz) + &quot;,JT65B\n&quot;;
+  QFile f(&quot;wsjt.log&quot;);
+  if(!f.open(QFile::Append)) {
+    msgBox(&quot;Cannot open file \&quot;wsjt.log\&quot;.&quot;);
+    return;
+  }
+  QTextStream out(&amp;f);
+  out &lt;&lt; logEntry;
+  f.close();
+  m_worked[m_hisCall]=true;
+}
+
+void MainWindow::on_actionErase_map65_rx_log_triggered()     //Erase Rx log
+{
+  int ret = QMessageBox::warning(this, &quot;Confirm Erase&quot;,
+      &quot;Are you sure you want to erase file map65_rx.log ?&quot;,
+       QMessageBox::Yes | QMessageBox::No, QMessageBox::Yes);
+  if(ret==QMessageBox::Yes) {
+    m_map65RxLog |= 2;                      // Rewind map65_rx.log
+  }
+}
+
+void MainWindow::on_actionErase_map65_tx_log_triggered()     //Erase Tx log
+{
+  int ret = QMessageBox::warning(this, &quot;Confirm Erase&quot;,
+      &quot;Are you sure you want to erase file map65_tx.log ?&quot;,
+       QMessageBox::Yes | QMessageBox::No, QMessageBox::Yes);
+  if(ret==QMessageBox::Yes) {
+    QFile f(&quot;map65_tx.log&quot;);
+    f.remove();
+  }
+}
+
+void MainWindow::on_actionJT65A_triggered()
+{
+  m_mode=&quot;JT65A&quot;;
+  m_mode65=1;
+  g_pWideGraph-&gt;setMode65(m_mode65);
+  lab5-&gt;setText(m_mode);
+  ui-&gt;actionJT65A-&gt;setChecked(true);
+}
+
+void MainWindow::on_actionJT65B_triggered()
+{
+  m_mode=&quot;JT65B&quot;;
+  m_mode65=2;
+  g_pWideGraph-&gt;setMode65(m_mode65);
+  lab5-&gt;setText(m_mode);
+  ui-&gt;actionJT65B-&gt;setChecked(true);
+}
+
+void MainWindow::on_actionJT65C_triggered()
+{
+  m_mode=&quot;JT65C&quot;;
+  m_mode65=4;
+  g_pWideGraph-&gt;setMode65(m_mode65);
+  lab5-&gt;setText(m_mode);
+  ui-&gt;actionJT65C-&gt;setChecked(true);
+}
+
+void MainWindow::on_NBcheckBox_toggled(bool checked)
+{
+  m_NB=checked;
+  ui-&gt;NBslider-&gt;setEnabled(m_NB);
+}
+
+void MainWindow::on_NBslider_valueChanged(int n)
+{
+  m_NBslider=n;
+}
+
+void MainWindow::on_actionAdjust_IQ_Calibration_triggered()
+{
+  m_adjustIQ=1;
+}
+
+void MainWindow::on_actionApply_IQ_Calibration_triggered()
+{
+  m_applyIQcal= 1-m_applyIQcal;
+}
+
+void MainWindow::on_actionFUNcube_Dongle_triggered()
+{
+  proc_qthid.start(QDir::toNativeSeparators(m_appDir + &quot;/qthid&quot;));
+}

Added: branches/map65/mainwindow.h
===================================================================
--- branches/map65/mainwindow.h	                        (rev 0)
+++ branches/map65/mainwindow.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,274 @@
+#ifndef MAINWINDOW_H
+#define MAINWINDOW_H
+#include &lt;QtGui&gt;
+#include &lt;QLabel&gt;
+#include &lt;QTimer&gt;
+#include &lt;QDateTime&gt;
+#include &lt;QHash&gt;
+#include &quot;soundin.h&quot;
+#include &quot;soundout.h&quot;
+#include &quot;commons.h&quot;
+#include &quot;sleep.h&quot;
+
+#define NFFT 32768
+#define NSMAX 5760000
+
+//--------------------------------------------------------------- MainWindow
+namespace Ui {
+    class MainWindow;
+}
+
+class MainWindow : public QMainWindow
+{
+  Q_OBJECT
+
+public:
+  explicit MainWindow(QWidget *parent = 0);
+  ~MainWindow();
+  bool m_network;
+
+public slots:
+  void showSoundInError(const QString&amp; errorMsg);
+  void showStatusMessage(const QString&amp; statusMsg);
+  void dataSink(int k);
+  void diskDat();
+  void diskWriteFinished();
+  void freezeDecode(int n);
+  void readFromStdout();
+  void readFromStderr();
+  void m65_error();
+  void guiUpdate();
+  void doubleClickOnCall(QString hiscall, bool ctrl);
+  void doubleClickOnMessages(QString hiscall, QString t2);
+
+protected:
+  virtual void keyPressEvent( QKeyEvent *e );
+  void  closeEvent(QCloseEvent*);
+  virtual bool eventFilter(QObject *object, QEvent *event);
+
+private slots:
+  void on_tx1_editingFinished();
+  void on_tx2_editingFinished();
+  void on_tx3_editingFinished();
+  void on_tx4_editingFinished();
+  void on_tx5_editingFinished();
+  void on_tx6_editingFinished();
+  void on_actionDeviceSetup_triggered();
+  void on_monitorButton_clicked();
+  void on_actionExit_triggered();
+  void on_actionAbout_triggered();
+  void OnExit();
+  void on_actionLinrad_triggered();
+  void on_actionCuteSDR_triggered();
+  void on_autoButton_clicked();
+  void on_stopTxButton_clicked();
+  void on_tolSpinBox_valueChanged(int arg1);
+  void on_actionAstro_Data_triggered();
+  void on_stopButton_clicked();
+  void on_actionOnline_Users_Guide_triggered();
+  void on_actionWide_Waterfall_triggered();
+  void on_actionBand_Map_triggered();
+  void on_actionMessages_triggered();
+  void on_actionOpen_triggered();
+  void on_actionOpen_next_in_directory_triggered();
+  void on_actionDecode_remaining_files_in_directory_triggered();
+  void on_actionDelete_all_tf2_files_in_SaveDir_triggered();
+  void on_actionErase_Band_Map_and_Messages_triggered();
+  void on_actionFind_Delta_Phi_triggered();
+  void on_actionF4_sets_Tx6_triggered();
+  void on_actionOnly_EME_calls_triggered();
+  void on_actionNo_shorthands_if_Tx1_triggered();
+  void on_actionNo_Deep_Search_triggered();
+  void on_actionNormal_Deep_Search_triggered();
+  void on_actionAggressive_Deep_Search_triggered();
+  void on_actionNone_triggered();
+  void on_actionSave_all_triggered();
+  void on_actionKeyboard_shortcuts_triggered();
+  void on_actionSpecial_mouse_commands_triggered();
+  void on_actionAvailable_suffixes_and_add_on_prefixes_triggered();
+  void on_DecodeButton_clicked();
+  void decode();
+  void decodeBusy(bool b);
+  void on_EraseButton_clicked();
+  void on_txb1_clicked();
+  void on_txFirstCheckBox_stateChanged(int arg1);
+  void set_ntx(int n);
+  void on_txb2_clicked();
+  void on_txb3_clicked();
+  void on_txb4_clicked();
+  void on_txb5_clicked();
+  void on_txb6_clicked();
+  void on_lookupButton_clicked();
+  void on_addButton_clicked();
+  void on_setTxFreqButton_clicked();
+  void on_dxCallEntry_textChanged(const QString &amp;arg1);
+  void on_dxGridEntry_textChanged(const QString &amp;arg1);
+  void selectCall2(bool ctrl);
+  void on_genStdMsgsPushButton_clicked();
+  void bumpDF(int n);
+  void on_logQSOButton_clicked();
+  void on_actionErase_map65_rx_log_triggered();
+  void on_actionErase_map65_tx_log_triggered();
+  void on_NBcheckBox_toggled(bool checked);
+  void on_actionJT65A_triggered();
+  void on_actionJT65B_triggered();
+  void on_actionJT65C_triggered();
+  void on_NBslider_valueChanged(int value);
+  void on_actionAdjust_IQ_Calibration_triggered();
+  void on_actionApply_IQ_Calibration_triggered();
+
+  void on_actionAFMHot_triggered();
+
+  void on_actionBlue_triggered();
+
+  void on_actionFUNcube_Dongle_triggered();
+
+private:
+    Ui::MainWindow *ui;
+    qint32  m_nDevIn;
+    qint32  m_nDevOut;
+    qint32  m_idInt;
+    qint32  m_waterfallAvg;
+    qint32  m_DF;
+    qint32  m_tol;
+    qint32  m_QSOfreq0;
+    qint32  m_ntx;
+    qint32  m_pttPort;
+    qint32  m_astroFont;
+    qint32  m_timeout;
+    qint32  m_dPhi;
+    qint32  m_fCal;
+    qint32  m_txFreq;
+    qint32  m_setftx;
+    qint32  m_ndepth;
+    qint32  m_sec0;
+    qint32  m_map65RxLog;
+    qint32  m_nutc0;
+    qint32  m_mode65;
+    qint32  m_nrx;
+    qint32  m_hsym0;
+    qint32  m_paInDevice;
+    qint32  m_paOutDevice;
+    qint32  m_udpPort;
+    qint32  m_NBslider;
+    qint32  m_adjustIQ;
+    qint32  m_applyIQcal;
+    qint32  m_mult570;
+
+    double  m_fAdd;
+    double  m_IQamp;
+    double  m_IQphase;
+    double  m_cal570;
+
+    bool    m_monitoring;
+    bool    m_transmitting;
+    bool    m_diskData;
+    bool    m_loopall;
+    bool    m_decoderBusy;
+    bool    m_txFirst;
+    bool    m_auto;
+    bool    m_txMute;
+    bool    m_restart;
+    bool    m_killAll;
+    bool    m_xpol;
+    bool    m_xpolx;
+    bool    m_call3Modified;
+    bool    m_startAnother;
+    bool    m_saveAll;
+    bool    m_onlyEME;
+    bool    m_widebandDecode;
+    bool    m_kb8rq;
+    bool    m_NB;
+    bool    m_fs96000;
+    bool    m_IQswap;
+    bool    m_10db;
+    bool    m_initIQplus;
+
+    float   m_gainx;
+    float   m_gainy;
+    float   m_phasex;
+    float   m_phasey;
+    float   m_pctZap;
+
+    QRect   m_astroGeom;
+    QRect   m_wideGraphGeom;
+    QRect   m_messagesGeom;
+    QRect   m_bandMapGeom;
+
+    QLabel* lab1;                            // labels in status bar
+    QLabel* lab2;
+    QLabel* lab3;
+    QLabel* lab4;
+    QLabel* lab5;
+    QLabel* lab6;
+
+    QMessageBox msgBox0;
+
+    QFuture&lt;void&gt;* future1;
+    QFuture&lt;void&gt;* future2;
+    QFutureWatcher&lt;void&gt;* watcher1;
+    QFutureWatcher&lt;void&gt;* watcher2;
+
+    QProcess proc_m65;
+    QProcess proc_qthid;
+
+    QString m_path;
+    QString m_pbdecoding_style1;
+    QString m_pbmonitor_style;
+    QString m_pbAutoOn_style;
+    QString m_messagesText;
+    QString m_bandmapText;
+    QString m_myCall;
+    QString m_myGrid;
+    QString m_hisCall;
+    QString m_hisGrid;
+    QString m_appDir;
+    QString m_saveDir;
+    QString m_azelDir;
+    QString m_dxccPfx;
+    QString m_palette;
+    QString m_dateTime;
+    QString m_mode;
+    QString m_colors;
+
+    QHash&lt;QString,bool&gt; m_worked;
+
+    SoundInThread soundInThread;             //Instantiate the audio threads
+    SoundOutThread soundOutThread;
+
+//---------------------------------------------------- private functions
+    void readSettings();
+    void writeSettings();
+    void createStatusBar();
+    void updateStatusBar();
+    void msgBox(QString t);
+    void genStdMsgs(QString rpt);
+    void lookup();
+    void ba2msg(QByteArray ba, char* message);
+    void msgtype(QString t, QLineEdit* tx);
+    void stub();
+};
+
+extern void getfile(QString fname, bool xpol, int idInt);
+extern void savetf2(QString fname, bool xpol);
+extern int killbyname(const char* progName);
+extern void getDev(int* numDevices,char hostAPI_DeviceName[][50],
+                   int minChan[], int maxChan[],
+                   int minSpeed[], int maxSpeed[]);
+
+extern &quot;C&quot; {
+//----------------------------------------------------- C and Fortran routines
+  void symspec_(int* k, int* nxpol, int* ndiskdat, int* nb, int* m_NBslider,
+                int* idphi, int* nfsample, float* fgreen, int* iqadjust,
+                int* iqapply, float* gainx, float* gainy, float* phasex,
+                float* phasey, float* rejectx, float* rejecty, float* px,
+                float* py, float s[], int* nkhz, int* nhsym, int* nzap,
+                float* slimit, uchar lstrong[]);
+
+  void gen65_(char* msg, int* mode65, double* samfac, int* nsendingsh,
+              char* msgsent, short iwave[], int* nwave, int len1, int len2);
+
+  int ptt_(int* nport, int* itx, int* iptt);
+  }
+
+#endif // MAINWINDOW_H

Added: branches/map65/mainwindow.ui
===================================================================
--- branches/map65/mainwindow.ui	                        (rev 0)
+++ branches/map65/mainwindow.ui	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,1611 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;class&gt;MainWindow&lt;/class&gt;
+ &lt;widget class=&quot;QMainWindow&quot; name=&quot;MainWindow&quot;&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;616&lt;/width&gt;
+    &lt;height&gt;477&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;sizePolicy&quot;&gt;
+   &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Preferred&quot;&gt;
+    &lt;horstretch&gt;0&lt;/horstretch&gt;
+    &lt;verstretch&gt;0&lt;/verstretch&gt;
+   &lt;/sizepolicy&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;maximumSize&quot;&gt;
+   &lt;size&gt;
+    &lt;width&gt;2048&lt;/width&gt;
+    &lt;height&gt;800&lt;/height&gt;
+   &lt;/size&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;SpecJT   by K1JT&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;styleSheet&quot;&gt;
+   &lt;string notr=&quot;true&quot;/&gt;
+  &lt;/property&gt;
+  &lt;widget class=&quot;QWidget&quot; name=&quot;centralWidget&quot;&gt;
+   &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_8&quot;&gt;
+    &lt;item&gt;
+     &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_7&quot;&gt;
+      &lt;item&gt;
+       &lt;widget class=&quot;QGroupBox&quot; name=&quot;groupBox&quot;&gt;
+        &lt;property name=&quot;sizePolicy&quot;&gt;
+         &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Expanding&quot;&gt;
+          &lt;horstretch&gt;0&lt;/horstretch&gt;
+          &lt;verstretch&gt;0&lt;/verstretch&gt;
+         &lt;/sizepolicy&gt;
+        &lt;/property&gt;
+        &lt;property name=&quot;minimumSize&quot;&gt;
+         &lt;size&gt;
+          &lt;width&gt;453&lt;/width&gt;
+          &lt;height&gt;170&lt;/height&gt;
+         &lt;/size&gt;
+        &lt;/property&gt;
+        &lt;property name=&quot;maximumSize&quot;&gt;
+         &lt;size&gt;
+          &lt;width&gt;620&lt;/width&gt;
+          &lt;height&gt;16777215&lt;/height&gt;
+         &lt;/size&gt;
+        &lt;/property&gt;
+        &lt;property name=&quot;title&quot;&gt;
+         &lt;string&gt;   Freq        DF      Pol      UTC         DT        dB                                                                           KV     DS         TxPol&lt;/string&gt;
+        &lt;/property&gt;
+        &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_9&quot;&gt;
+         &lt;item&gt;
+          &lt;widget class=&quot;DisplayText&quot; name=&quot;decodedTextBrowser&quot;&gt;
+           &lt;property name=&quot;sizePolicy&quot;&gt;
+            &lt;sizepolicy hsizetype=&quot;Maximum&quot; vsizetype=&quot;Expanding&quot;&gt;
+             &lt;horstretch&gt;0&lt;/horstretch&gt;
+             &lt;verstretch&gt;0&lt;/verstretch&gt;
+            &lt;/sizepolicy&gt;
+           &lt;/property&gt;
+           &lt;property name=&quot;minimumSize&quot;&gt;
+            &lt;size&gt;
+             &lt;width&gt;421&lt;/width&gt;
+             &lt;height&gt;100&lt;/height&gt;
+            &lt;/size&gt;
+           &lt;/property&gt;
+           &lt;property name=&quot;maximumSize&quot;&gt;
+            &lt;size&gt;
+             &lt;width&gt;610&lt;/width&gt;
+             &lt;height&gt;400&lt;/height&gt;
+            &lt;/size&gt;
+           &lt;/property&gt;
+           &lt;property name=&quot;font&quot;&gt;
+            &lt;font&gt;
+             &lt;family&gt;Courier New&lt;/family&gt;
+             &lt;pointsize&gt;10&lt;/pointsize&gt;
+            &lt;/font&gt;
+           &lt;/property&gt;
+           &lt;property name=&quot;verticalScrollBarPolicy&quot;&gt;
+            &lt;enum&gt;Qt::ScrollBarAlwaysOn&lt;/enum&gt;
+           &lt;/property&gt;
+           &lt;property name=&quot;horizontalScrollBarPolicy&quot;&gt;
+            &lt;enum&gt;Qt::ScrollBarAsNeeded&lt;/enum&gt;
+           &lt;/property&gt;
+           &lt;property name=&quot;html&quot;&gt;
+            &lt;string&gt;&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0//EN&quot; &quot;<A HREF="http://www.w3.org/TR/REC-html40/strict.dtd&amp;quot;&amp;gt;">http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;</A>
+&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;qrichtext&quot; content=&quot;1&quot; /&gt;&lt;style type=&quot;text/css&quot;&gt;
+p, li { white-space: pre-wrap; }
+&lt;/style&gt;&lt;/head&gt;&lt;body style=&quot; font-family:'Courier New'; font-size:10pt; font-weight:400; font-style:normal;&quot;&gt;
+&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&lt;/string&gt;
+           &lt;/property&gt;
+           &lt;property name=&quot;acceptRichText&quot;&gt;
+            &lt;bool&gt;false&lt;/bool&gt;
+           &lt;/property&gt;
+          &lt;/widget&gt;
+         &lt;/item&gt;
+        &lt;/layout&gt;
+       &lt;/widget&gt;
+      &lt;/item&gt;
+      &lt;item&gt;
+       &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_2&quot;&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QPushButton&quot; name=&quot;logQSOButton&quot;&gt;
+          &lt;property name=&quot;minimumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;50&lt;/width&gt;
+            &lt;height&gt;0&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;Log &amp;QSO&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QPushButton&quot; name=&quot;stopButton&quot;&gt;
+          &lt;property name=&quot;minimumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;50&lt;/width&gt;
+            &lt;height&gt;0&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;&amp;Stop&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QPushButton&quot; name=&quot;monitorButton&quot;&gt;
+          &lt;property name=&quot;sizePolicy&quot;&gt;
+           &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Fixed&quot;&gt;
+            &lt;horstretch&gt;0&lt;/horstretch&gt;
+            &lt;verstretch&gt;0&lt;/verstretch&gt;
+           &lt;/sizepolicy&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;minimumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;50&lt;/width&gt;
+            &lt;height&gt;0&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;maximumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;16777215&lt;/width&gt;
+            &lt;height&gt;16777215&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;&amp;Monitor&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QPushButton&quot; name=&quot;DecodeButton&quot;&gt;
+          &lt;property name=&quot;minimumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;50&lt;/width&gt;
+            &lt;height&gt;0&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;&amp;Decode&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QPushButton&quot; name=&quot;EraseButton&quot;&gt;
+          &lt;property name=&quot;minimumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;50&lt;/width&gt;
+            &lt;height&gt;0&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;&amp;Erase&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QPushButton&quot; name=&quot;autoButton&quot;&gt;
+          &lt;property name=&quot;sizePolicy&quot;&gt;
+           &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Fixed&quot;&gt;
+            &lt;horstretch&gt;0&lt;/horstretch&gt;
+            &lt;verstretch&gt;0&lt;/verstretch&gt;
+           &lt;/sizepolicy&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;minimumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;50&lt;/width&gt;
+            &lt;height&gt;0&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;&amp;Auto is OFF&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QPushButton&quot; name=&quot;stopTxButton&quot;&gt;
+          &lt;property name=&quot;sizePolicy&quot;&gt;
+           &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Fixed&quot;&gt;
+            &lt;horstretch&gt;0&lt;/horstretch&gt;
+            &lt;verstretch&gt;0&lt;/verstretch&gt;
+           &lt;/sizepolicy&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;minimumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;50&lt;/width&gt;
+            &lt;height&gt;0&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;St&amp;op Tx&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+       &lt;/layout&gt;
+      &lt;/item&gt;
+      &lt;item&gt;
+       &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_5&quot;&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot;&gt;
+          &lt;property name=&quot;sizePolicy&quot;&gt;
+           &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Minimum&quot;&gt;
+            &lt;horstretch&gt;0&lt;/horstretch&gt;
+            &lt;verstretch&gt;0&lt;/verstretch&gt;
+           &lt;/sizepolicy&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;maximumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;16777215&lt;/width&gt;
+            &lt;height&gt;26&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;text&quot;&gt;
+           &lt;string&gt;dB&lt;/string&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QwtThermo&quot; name=&quot;xThermo&quot; native=&quot;true&quot;&gt;
+          &lt;property name=&quot;sizePolicy&quot;&gt;
+           &lt;sizepolicy hsizetype=&quot;Minimum&quot; vsizetype=&quot;Fixed&quot;&gt;
+            &lt;horstretch&gt;0&lt;/horstretch&gt;
+            &lt;verstretch&gt;0&lt;/verstretch&gt;
+           &lt;/sizepolicy&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;maximumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;43&lt;/width&gt;
+            &lt;height&gt;180&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;borderWidth&quot; stdset=&quot;0&quot;&gt;
+           &lt;number&gt;1&lt;/number&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;maxValue&quot; stdset=&quot;0&quot;&gt;
+           &lt;double&gt;60.000000000000000&lt;/double&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;minValue&quot; stdset=&quot;0&quot;&gt;
+           &lt;double&gt;0.000000000000000&lt;/double&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;pipeWidth&quot; stdset=&quot;0&quot;&gt;
+           &lt;number&gt;8&lt;/number&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;value&quot; stdset=&quot;0&quot;&gt;
+           &lt;double&gt;0.000000000000000&lt;/double&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;widget class=&quot;QwtThermo&quot; name=&quot;yThermo&quot; native=&quot;true&quot;&gt;
+          &lt;property name=&quot;sizePolicy&quot;&gt;
+           &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+            &lt;horstretch&gt;0&lt;/horstretch&gt;
+            &lt;verstretch&gt;0&lt;/verstretch&gt;
+           &lt;/sizepolicy&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;maximumSize&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;12&lt;/width&gt;
+            &lt;height&gt;177&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;borderWidth&quot; stdset=&quot;0&quot;&gt;
+           &lt;number&gt;1&lt;/number&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;maxValue&quot; stdset=&quot;0&quot;&gt;
+           &lt;double&gt;60.000000000000000&lt;/double&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;minValue&quot; stdset=&quot;0&quot;&gt;
+           &lt;double&gt;0.000000000000000&lt;/double&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;pipeWidth&quot; stdset=&quot;0&quot;&gt;
+           &lt;number&gt;8&lt;/number&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;value&quot; stdset=&quot;0&quot;&gt;
+           &lt;double&gt;0.000000000000000&lt;/double&gt;
+          &lt;/property&gt;
+         &lt;/widget&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout&quot;&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;verticalSpacer_2&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Vertical&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;20&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QGroupBox&quot; name=&quot;dxStationGroupBox&quot;&gt;
+            &lt;property name=&quot;sizePolicy&quot;&gt;
+             &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Preferred&quot;&gt;
+              &lt;horstretch&gt;0&lt;/horstretch&gt;
+              &lt;verstretch&gt;0&lt;/verstretch&gt;
+             &lt;/sizepolicy&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;minimumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;0&lt;/width&gt;
+              &lt;height&gt;40&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;290&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;styleSheet&quot;&gt;
+             &lt;string notr=&quot;true&quot;/&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;title&quot;&gt;
+             &lt;string&gt;    DX   Call              Grid&lt;/string&gt;
+            &lt;/property&gt;
+            &lt;widget class=&quot;QPushButton&quot; name=&quot;pushButton&quot;&gt;
+             &lt;property name=&quot;geometry&quot;&gt;
+              &lt;rect&gt;
+               &lt;x&gt;231&lt;/x&gt;
+               &lt;y&gt;13&lt;/y&gt;
+               &lt;width&gt;50&lt;/width&gt;
+               &lt;height&gt;23&lt;/height&gt;
+              &lt;/rect&gt;
+             &lt;/property&gt;
+             &lt;property name=&quot;maximumSize&quot;&gt;
+              &lt;size&gt;
+               &lt;width&gt;50&lt;/width&gt;
+               &lt;height&gt;16777215&lt;/height&gt;
+              &lt;/size&gt;
+             &lt;/property&gt;
+             &lt;property name=&quot;text&quot;&gt;
+              &lt;string&gt;SetMsgs&lt;/string&gt;
+             &lt;/property&gt;
+            &lt;/widget&gt;
+            &lt;widget class=&quot;QWidget&quot; name=&quot;layoutWidget_2&quot;&gt;
+             &lt;property name=&quot;geometry&quot;&gt;
+              &lt;rect&gt;
+               &lt;x&gt;7&lt;/x&gt;
+               &lt;y&gt;13&lt;/y&gt;
+               &lt;width&gt;150&lt;/width&gt;
+               &lt;height&gt;64&lt;/height&gt;
+              &lt;/rect&gt;
+             &lt;/property&gt;
+             &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_6&quot;&gt;
+              &lt;item&gt;
+               &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_3&quot;&gt;
+                &lt;item&gt;
+                 &lt;widget class=&quot;QLineEdit&quot; name=&quot;dxCallEntry&quot;&gt;
+                  &lt;property name=&quot;sizePolicy&quot;&gt;
+                   &lt;sizepolicy hsizetype=&quot;Minimum&quot; vsizetype=&quot;Fixed&quot;&gt;
+                    &lt;horstretch&gt;0&lt;/horstretch&gt;
+                    &lt;verstretch&gt;0&lt;/verstretch&gt;
+                   &lt;/sizepolicy&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;minimumSize&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;0&lt;/width&gt;
+                    &lt;height&gt;23&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;maximumSize&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;70&lt;/width&gt;
+                    &lt;height&gt;16777215&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;text&quot;&gt;
+                   &lt;string/&gt;
+                  &lt;/property&gt;
+                 &lt;/widget&gt;
+                &lt;/item&gt;
+                &lt;item&gt;
+                 &lt;widget class=&quot;QLineEdit&quot; name=&quot;dxGridEntry&quot;&gt;
+                  &lt;property name=&quot;sizePolicy&quot;&gt;
+                   &lt;sizepolicy hsizetype=&quot;Minimum&quot; vsizetype=&quot;Fixed&quot;&gt;
+                    &lt;horstretch&gt;0&lt;/horstretch&gt;
+                    &lt;verstretch&gt;0&lt;/verstretch&gt;
+                   &lt;/sizepolicy&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;minimumSize&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;0&lt;/width&gt;
+                    &lt;height&gt;23&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;maximumSize&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;70&lt;/width&gt;
+                    &lt;height&gt;16777215&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;text&quot;&gt;
+                   &lt;string/&gt;
+                  &lt;/property&gt;
+                 &lt;/widget&gt;
+                &lt;/item&gt;
+               &lt;/layout&gt;
+              &lt;/item&gt;
+              &lt;item&gt;
+               &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_4&quot;&gt;
+                &lt;item&gt;
+                 &lt;widget class=&quot;QPushButton&quot; name=&quot;lookupButton&quot;&gt;
+                  &lt;property name=&quot;maximumSize&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;50&lt;/width&gt;
+                    &lt;height&gt;16777215&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;text&quot;&gt;
+                   &lt;string&gt;&amp;Lookup&lt;/string&gt;
+                  &lt;/property&gt;
+                 &lt;/widget&gt;
+                &lt;/item&gt;
+                &lt;item&gt;
+                 &lt;widget class=&quot;QPushButton&quot; name=&quot;addButton&quot;&gt;
+                  &lt;property name=&quot;maximumSize&quot;&gt;
+                   &lt;size&gt;
+                    &lt;width&gt;50&lt;/width&gt;
+                    &lt;height&gt;16777215&lt;/height&gt;
+                   &lt;/size&gt;
+                  &lt;/property&gt;
+                  &lt;property name=&quot;text&quot;&gt;
+                   &lt;string&gt;Add&lt;/string&gt;
+                  &lt;/property&gt;
+                 &lt;/widget&gt;
+                &lt;/item&gt;
+               &lt;/layout&gt;
+              &lt;/item&gt;
+             &lt;/layout&gt;
+            &lt;/widget&gt;
+            &lt;widget class=&quot;QPushButton&quot; name=&quot;genStdMsgsPushButton&quot;&gt;
+             &lt;property name=&quot;geometry&quot;&gt;
+              &lt;rect&gt;
+               &lt;x&gt;40&lt;/x&gt;
+               &lt;y&gt;80&lt;/y&gt;
+               &lt;width&gt;70&lt;/width&gt;
+               &lt;height&gt;23&lt;/height&gt;
+              &lt;/rect&gt;
+             &lt;/property&gt;
+             &lt;property name=&quot;maximumSize&quot;&gt;
+              &lt;size&gt;
+               &lt;width&gt;70&lt;/width&gt;
+               &lt;height&gt;16777215&lt;/height&gt;
+              &lt;/size&gt;
+             &lt;/property&gt;
+             &lt;property name=&quot;text&quot;&gt;
+              &lt;string&gt;&amp;GenStdMsgs&lt;/string&gt;
+             &lt;/property&gt;
+            &lt;/widget&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QLabel&quot; name=&quot;labUTC&quot;&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;150&lt;/width&gt;
+              &lt;height&gt;40&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;font&quot;&gt;
+             &lt;font&gt;
+              &lt;pointsize&gt;20&lt;/pointsize&gt;
+             &lt;/font&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;frameShape&quot;&gt;
+             &lt;enum&gt;QFrame::Panel&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt; 01:23:45 &lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;spacer name=&quot;horizontalSpacer&quot;&gt;
+          &lt;property name=&quot;orientation&quot;&gt;
+           &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;sizeType&quot;&gt;
+           &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+          &lt;/property&gt;
+          &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+           &lt;size&gt;
+            &lt;width&gt;30&lt;/width&gt;
+            &lt;height&gt;20&lt;/height&gt;
+           &lt;/size&gt;
+          &lt;/property&gt;
+         &lt;/spacer&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_5&quot;&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;verticalSpacer_3&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Vertical&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;20&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QCheckBox&quot; name=&quot;txFirstCheckBox&quot;&gt;
+            &lt;property name=&quot;minimumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;0&lt;/width&gt;
+              &lt;height&gt;23&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;70&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Tx first&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QPushButton&quot; name=&quot;setTxFreqButton&quot;&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;70&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;Set Tx Freq&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;spacer name=&quot;verticalSpacer&quot;&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Vertical&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeType&quot;&gt;
+             &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;20&lt;/width&gt;
+              &lt;height&gt;20&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+           &lt;/spacer&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QCheckBox&quot; name=&quot;NBcheckBox&quot;&gt;
+            &lt;property name=&quot;text&quot;&gt;
+             &lt;string&gt;NB&lt;/string&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;widget class=&quot;QSlider&quot; name=&quot;NBslider&quot;&gt;
+            &lt;property name=&quot;enabled&quot;&gt;
+             &lt;bool&gt;false&lt;/bool&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;sizePolicy&quot;&gt;
+             &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+              &lt;horstretch&gt;0&lt;/horstretch&gt;
+              &lt;verstretch&gt;0&lt;/verstretch&gt;
+             &lt;/sizepolicy&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximumSize&quot;&gt;
+             &lt;size&gt;
+              &lt;width&gt;70&lt;/width&gt;
+              &lt;height&gt;16777215&lt;/height&gt;
+             &lt;/size&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;minimum&quot;&gt;
+             &lt;number&gt;0&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;maximum&quot;&gt;
+             &lt;number&gt;100&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;value&quot;&gt;
+             &lt;number&gt;40&lt;/number&gt;
+            &lt;/property&gt;
+            &lt;property name=&quot;orientation&quot;&gt;
+             &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+            &lt;/property&gt;
+           &lt;/widget&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout&quot;&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;labTol1&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Preferred&quot;&gt;
+                &lt;horstretch&gt;0&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;30&lt;/width&gt;
+                &lt;height&gt;0&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;25&lt;/width&gt;
+                &lt;height&gt;18&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;500&lt;/string&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;alignment&quot;&gt;
+               &lt;set&gt;Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter&lt;/set&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QSpinBox&quot; name=&quot;tolSpinBox&quot;&gt;
+              &lt;property name=&quot;enabled&quot;&gt;
+               &lt;bool&gt;true&lt;/bool&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;0&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;23&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;18&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimum&quot;&gt;
+               &lt;number&gt;0&lt;/number&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximum&quot;&gt;
+               &lt;number&gt;6&lt;/number&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;value&quot;&gt;
+               &lt;number&gt;5&lt;/number&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLabel&quot; name=&quot;labTol2&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Preferred&quot;&gt;
+                &lt;horstretch&gt;0&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Tol&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+        &lt;item&gt;
+         &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_9&quot;&gt;
+          &lt;item&gt;
+           &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_2&quot;&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;tx1&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;160&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;180&lt;/width&gt;
+                &lt;height&gt;24&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;font&quot;&gt;
+               &lt;font&gt;
+                &lt;family&gt;MS Shell Dlg 2&lt;/family&gt;
+               &lt;/font&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string/&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;tx2&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;160&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;180&lt;/width&gt;
+                &lt;height&gt;24&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;tx3&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;160&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;180&lt;/width&gt;
+                &lt;height&gt;24&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;tx4&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;160&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;180&lt;/width&gt;
+                &lt;height&gt;24&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;tx5&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;160&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;180&lt;/width&gt;
+                &lt;height&gt;24&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QLineEdit&quot; name=&quot;tx6&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;160&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;180&lt;/width&gt;
+                &lt;height&gt;24&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_3&quot;&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QRadioButton&quot; name=&quot;txrb1&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;16&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string/&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;checked&quot;&gt;
+               &lt;bool&gt;true&lt;/bool&gt;
+              &lt;/property&gt;
+              &lt;attribute name=&quot;buttonGroup&quot;&gt;
+               &lt;string&gt;buttonGroup&lt;/string&gt;
+              &lt;/attribute&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QRadioButton&quot; name=&quot;txrb2&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;16&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string/&gt;
+              &lt;/property&gt;
+              &lt;attribute name=&quot;buttonGroup&quot;&gt;
+               &lt;string&gt;buttonGroup&lt;/string&gt;
+              &lt;/attribute&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QRadioButton&quot; name=&quot;txrb3&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;16&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string/&gt;
+              &lt;/property&gt;
+              &lt;attribute name=&quot;buttonGroup&quot;&gt;
+               &lt;string&gt;buttonGroup&lt;/string&gt;
+              &lt;/attribute&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QRadioButton&quot; name=&quot;txrb4&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;16&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string/&gt;
+              &lt;/property&gt;
+              &lt;attribute name=&quot;buttonGroup&quot;&gt;
+               &lt;string&gt;buttonGroup&lt;/string&gt;
+              &lt;/attribute&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QRadioButton&quot; name=&quot;txrb5&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;16&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string/&gt;
+              &lt;/property&gt;
+              &lt;attribute name=&quot;buttonGroup&quot;&gt;
+               &lt;string&gt;buttonGroup&lt;/string&gt;
+              &lt;/attribute&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QRadioButton&quot; name=&quot;txrb6&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;16&lt;/horstretch&gt;
+                &lt;verstretch&gt;0&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;20&lt;/width&gt;
+                &lt;height&gt;16777215&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string/&gt;
+              &lt;/property&gt;
+              &lt;attribute name=&quot;buttonGroup&quot;&gt;
+               &lt;string&gt;buttonGroup&lt;/string&gt;
+              &lt;/attribute&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/item&gt;
+          &lt;item&gt;
+           &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_4&quot;&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QPushButton&quot; name=&quot;txb1&quot;&gt;
+              &lt;property name=&quot;sizePolicy&quot;&gt;
+               &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+                &lt;horstretch&gt;50&lt;/horstretch&gt;
+                &lt;verstretch&gt;20&lt;/verstretch&gt;
+               &lt;/sizepolicy&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;16&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;29&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Tx1&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QPushButton&quot; name=&quot;txb2&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;16&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;29&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Tx2&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QPushButton&quot; name=&quot;txb3&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;16&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;29&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Tx3&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QPushButton&quot; name=&quot;txb4&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;16&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;29&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Tx4&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QPushButton&quot; name=&quot;txb5&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;16&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;29&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Tx5&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+            &lt;item&gt;
+             &lt;widget class=&quot;QPushButton&quot; name=&quot;txb6&quot;&gt;
+              &lt;property name=&quot;minimumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;0&lt;/width&gt;
+                &lt;height&gt;16&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;maximumSize&quot;&gt;
+               &lt;size&gt;
+                &lt;width&gt;29&lt;/width&gt;
+                &lt;height&gt;20&lt;/height&gt;
+               &lt;/size&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;text&quot;&gt;
+               &lt;string&gt;Tx6&lt;/string&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
+            &lt;/item&gt;
+           &lt;/layout&gt;
+          &lt;/item&gt;
+         &lt;/layout&gt;
+        &lt;/item&gt;
+       &lt;/layout&gt;
+      &lt;/item&gt;
+     &lt;/layout&gt;
+    &lt;/item&gt;
+   &lt;/layout&gt;
+  &lt;/widget&gt;
+  &lt;widget class=&quot;QMenuBar&quot; name=&quot;menuBar&quot;&gt;
+   &lt;property name=&quot;geometry&quot;&gt;
+    &lt;rect&gt;
+     &lt;x&gt;0&lt;/x&gt;
+     &lt;y&gt;0&lt;/y&gt;
+     &lt;width&gt;616&lt;/width&gt;
+     &lt;height&gt;21&lt;/height&gt;
+    &lt;/rect&gt;
+   &lt;/property&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuFile&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;File&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;addaction name=&quot;actionOpen&quot;/&gt;
+    &lt;addaction name=&quot;actionOpen_next_in_directory&quot;/&gt;
+    &lt;addaction name=&quot;actionDecode_remaining_files_in_directory&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionDelete_all_tf2_files_in_SaveDir&quot;/&gt;
+    &lt;addaction name=&quot;actionErase_Band_Map_and_Messages&quot;/&gt;
+    &lt;addaction name=&quot;actionErase_map65_rx_log&quot;/&gt;
+    &lt;addaction name=&quot;actionErase_map65_tx_log&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionExit&quot;/&gt;
+   &lt;/widget&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuSetup&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;Setup&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;addaction name=&quot;actionDeviceSetup&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionAdjust_IQ_Calibration&quot;/&gt;
+    &lt;addaction name=&quot;actionApply_IQ_Calibration&quot;/&gt;
+    &lt;addaction name=&quot;actionFind_Delta_Phi&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionF4_sets_Tx6&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionFUNcube_Dongle&quot;/&gt;
+   &lt;/widget&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuView&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;View&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;widget class=&quot;QMenu&quot; name=&quot;menuWaterfall_palette&quot;&gt;
+     &lt;property name=&quot;title&quot;&gt;
+      &lt;string&gt;Waterfall palette&lt;/string&gt;
+     &lt;/property&gt;
+     &lt;addaction name=&quot;actionLinrad&quot;/&gt;
+     &lt;addaction name=&quot;actionCuteSDR&quot;/&gt;
+     &lt;addaction name=&quot;actionAFMHot&quot;/&gt;
+     &lt;addaction name=&quot;actionBlue&quot;/&gt;
+    &lt;/widget&gt;
+    &lt;addaction name=&quot;actionAstro_Data&quot;/&gt;
+    &lt;addaction name=&quot;actionBand_Map&quot;/&gt;
+    &lt;addaction name=&quot;actionMessages&quot;/&gt;
+    &lt;addaction name=&quot;actionWide_Waterfall&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;menuWaterfall_palette&quot;/&gt;
+   &lt;/widget&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuDecode&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;Decode&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;addaction name=&quot;actionOnly_EME_calls&quot;/&gt;
+    &lt;addaction name=&quot;actionNo_shorthands_if_Tx1&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionNo_Deep_Search&quot;/&gt;
+    &lt;addaction name=&quot;actionNormal_Deep_Search&quot;/&gt;
+    &lt;addaction name=&quot;actionAggressive_Deep_Search&quot;/&gt;
+   &lt;/widget&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuSave&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;Save&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;addaction name=&quot;actionNone&quot;/&gt;
+    &lt;addaction name=&quot;actionSave_all&quot;/&gt;
+   &lt;/widget&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuHelp&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;Help&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;addaction name=&quot;actionOnline_Users_Guide&quot;/&gt;
+    &lt;addaction name=&quot;actionKeyboard_shortcuts&quot;/&gt;
+    &lt;addaction name=&quot;actionSpecial_mouse_commands&quot;/&gt;
+    &lt;addaction name=&quot;actionAvailable_suffixes_and_add_on_prefixes&quot;/&gt;
+    &lt;addaction name=&quot;actionAbout&quot;/&gt;
+   &lt;/widget&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuMode&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;Mode&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;addaction name=&quot;actionJT65A&quot;/&gt;
+    &lt;addaction name=&quot;actionJT65B&quot;/&gt;
+    &lt;addaction name=&quot;actionJT65C&quot;/&gt;
+   &lt;/widget&gt;
+   &lt;addaction name=&quot;menuFile&quot;/&gt;
+   &lt;addaction name=&quot;menuSetup&quot;/&gt;
+   &lt;addaction name=&quot;menuView&quot;/&gt;
+   &lt;addaction name=&quot;menuMode&quot;/&gt;
+   &lt;addaction name=&quot;menuDecode&quot;/&gt;
+   &lt;addaction name=&quot;menuSave&quot;/&gt;
+   &lt;addaction name=&quot;menuHelp&quot;/&gt;
+  &lt;/widget&gt;
+  &lt;widget class=&quot;QToolBar&quot; name=&quot;mainToolBar&quot;&gt;
+   &lt;attribute name=&quot;toolBarArea&quot;&gt;
+    &lt;enum&gt;TopToolBarArea&lt;/enum&gt;
+   &lt;/attribute&gt;
+   &lt;attribute name=&quot;toolBarBreak&quot;&gt;
+    &lt;bool&gt;false&lt;/bool&gt;
+   &lt;/attribute&gt;
+  &lt;/widget&gt;
+  &lt;widget class=&quot;QStatusBar&quot; name=&quot;statusBar&quot;/&gt;
+  &lt;action name=&quot;actionExit&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Exit&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionDeviceSetup&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Options&lt;/string&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;shortcut&quot;&gt;
+    &lt;string&gt;F2&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionAbout&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt; About MAP65&lt;/string&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;shortcut&quot;&gt;
+    &lt;string&gt;Ctrl+F1&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionAstro_Data&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Astro Data&lt;/string&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;shortcut&quot;&gt;
+    &lt;string&gt;Shift+F10&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionBand_Map&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Band Map&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionMessages&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Messages&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionWide_Waterfall&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Wide Waterfall&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionOpen&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Open&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionOpen_next_in_directory&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Open next in directory&lt;/string&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;shortcut&quot;&gt;
+    &lt;string&gt;F6&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionDecode_remaining_files_in_directory&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Decode remaining files in directory&lt;/string&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;shortcut&quot;&gt;
+    &lt;string&gt;Shift+F6&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionDelete_all_tf2_files_in_SaveDir&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Delete all *.tf2 and *.iq files in SaveDir&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionErase_Band_Map_and_Messages&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Erase Band Map and Messages&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionErase_map65_rx_log&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Erase map65_rx.log&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionLinrad&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;checked&quot;&gt;
+    &lt;bool&gt;false&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Linrad&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionCuteSDR&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;checked&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;CuteSDR&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionFind_Delta_Phi&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Find Delta Phi&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionF4_sets_Tx6&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;F4 sets Tx6&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionOnly_EME_calls&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Only EME calls&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionNo_shorthands_if_Tx1&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;No shorthand decodes if Tx1&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionNo_Deep_Search&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;checked&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;No Deep Search&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionNormal_Deep_Search&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Normal Deep Search&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionAggressive_Deep_Search&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Aggressive Deep Search&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionNone&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;checked&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;None&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionSave_all&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Save all&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;action50&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;50&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;action144&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;checked&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;144&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;action222&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;222&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;action432&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;432&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;action1296&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;1296&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;action2304&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;2304&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionOnline_Users_Guide&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Online User's Guide&lt;/string&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;shortcut&quot;&gt;
+    &lt;string&gt;F1&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionKeyboard_shortcuts&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Keyboard shortcuts&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionSpecial_mouse_commands&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Special mouse commands&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionAvailable_suffixes_and_add_on_prefixes&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Available suffixes and add-on-prefixes&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionErase_map65_tx_log&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Erase map65_tx.log&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionJT65A&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;JT65A&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionJT65B&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;checked&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;JT65B&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionJT65C&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;JT65C&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionI_Q_Calibration&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;I/Q Calibration&lt;/string&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;shortcut&quot;&gt;
+    &lt;string&gt;F7&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionAdjust_IQ_Calibration&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Adjust I/Q Calibration&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionApply_IQ_Calibration&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Apply I/Q Calibration&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionAFMHot&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;AFMHot&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionBlue&quot;&gt;
+   &lt;property name=&quot;checkable&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Blue&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionFUNcube_Dongle&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;FUNcube Dongle Settings&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+ &lt;/widget&gt;
+ &lt;layoutdefault spacing=&quot;6&quot; margin=&quot;11&quot;/&gt;
+ &lt;customwidgets&gt;
+  &lt;customwidget&gt;
+   &lt;class&gt;DisplayText&lt;/class&gt;
+   &lt;extends&gt;QTextBrowser&lt;/extends&gt;
+   &lt;header&gt;displaytext.h&lt;/header&gt;
+  &lt;/customwidget&gt;
+  &lt;customwidget&gt;
+   &lt;class&gt;QwtThermo&lt;/class&gt;
+   &lt;extends&gt;QWidget&lt;/extends&gt;
+   &lt;header&gt;qwt_thermo.h&lt;/header&gt;
+  &lt;/customwidget&gt;
+ &lt;/customwidgets&gt;
+ &lt;resources/&gt;
+ &lt;connections&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;monitorButton&lt;/sender&gt;
+   &lt;signal&gt;toggled(bool)&lt;/signal&gt;
+   &lt;receiver&gt;MainWindow&lt;/receiver&gt;
+   &lt;slot&gt;update()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot;&gt;
+     &lt;x&gt;264&lt;/x&gt;
+     &lt;y&gt;275&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot;&gt;
+     &lt;x&gt;126&lt;/x&gt;
+     &lt;y&gt;515&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+ &lt;/connections&gt;
+ &lt;buttongroups&gt;
+  &lt;buttongroup name=&quot;buttonGroup&quot;&gt;
+   &lt;property name=&quot;exclusive&quot;&gt;
+    &lt;bool&gt;true&lt;/bool&gt;
+   &lt;/property&gt;
+  &lt;/buttongroup&gt;
+ &lt;/buttongroups&gt;
+&lt;/ui&gt;

Deleted: branches/map65/map65.iss
===================================================================
--- branches/map65/map65.iss	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/map65.iss	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,21 +0,0 @@
-[Setup]
-AppName=MAP65
-AppVerName=MAP65 Version 1.1 r24254
-AppCopyright=Copyright (C) 2001-2011 by Joe Taylor, K1JT
-DefaultDirName={pf}\MAP65
-DefaultGroupName=MAP65
-
-[Files]
-Source: &quot;c:\Users\joe\wsjt\map65\map65.exe&quot;;         DestDir: &quot;{app}&quot;
-Source: &quot;c:\Users\joe\wsjt\map65\CALL3.TXT&quot;;         DestDir: &quot;{app}&quot;; Flags: onlyifdoesntexist
-Source: &quot;c:\Users\joe\wsjt\map65\wsjt.ico&quot;;          DestDir: &quot;{app}&quot;; Flags: onlyifdoesntexist
-Source: &quot;c:\Users\joe\wsjt\map65\TSKY.DAT&quot;;          DestDir: &quot;{app}&quot;; Flags: onlyifdoesntexist
-Source: &quot;c:\Users\joe\wsjt\map65\KVASD_G95.EXE&quot;;     DestDir: &quot;{app}&quot;;
-Source: &quot;c:\Users\joe\wsjt\map65\map65rc.win&quot;;       DestDir: &quot;{app}&quot;;
-Source: &quot;c:\Users\joe\wsjt\map65\WSJT.LOG&quot;;          DestDir: &quot;{app}&quot;;
-
-[Icons]
-Name: &quot;{group}\MAP65&quot;;        Filename: &quot;{app}\map65.exe&quot;; WorkingDir: {app}
-Name: &quot;{userdesktop}\MAP65&quot;;  Filename: &quot;{app}\map65.exe&quot;; WorkingDir: {app}
-
-

Added: branches/map65/map65.iss
===================================================================
--- branches/map65/map65.iss	                        (rev 0)
+++ branches/map65/map65.iss	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,31 @@
+[Setup]
+AppName=MAP65
+AppVerName=MAP65 Version 2.3.0 r631
+AppCopyright=Copyright (C) 2001-2012 by Joe Taylor, K1JT
+DefaultDirName=c:\MAP65
+DefaultGroupName=MAP65
+
+[Files]
+Source: &quot;c:\Users\joe\map65\install\m65.exe&quot;;           DestDir: &quot;{app}&quot;
+Source: &quot;c:\Users\joe\map65\install\map65.exe&quot;;         DestDir: &quot;{app}&quot;
+Source: &quot;c:\Users\joe\map65\install\wsjt.ico&quot;;          DestDir: &quot;{app}&quot;
+Source: &quot;c:\Users\joe\map65\install\kvasd.exe&quot;;         DestDir: &quot;{app}&quot;
+Source: &quot;c:\Users\joe\map65\install\CALL3.TXT&quot;;         DestDir: &quot;{app}&quot;; Flags: onlyifdoesntexist
+Source: &quot;c:\Users\joe\map65\install\fftwf-wisdom.exe&quot;;  DestDir: &quot;{app}&quot;; Flags: onlyifdoesntexist
+Source: &quot;c:\Users\joe\map65\install\wisdom1.bat&quot;;       DestDir: &quot;{app}&quot;;
+Source: &quot;c:\Users\joe\map65\install\wisdom2.bat&quot;;       DestDir: &quot;{app}&quot;;
+Source: &quot;c:\Users\joe\map65\install\afmhot.dat&quot;;        DestDir: &quot;{app}&quot;;
+Source: &quot;c:\Users\joe\map65\install\blue.dat&quot;;          DestDir: &quot;{app}&quot;;
+Source: &quot;c:\Users\joe\map65\install\qthid.exe&quot;;         DestDir: &quot;{app}&quot;;
+
+Source: &quot;c:\Users\joe\map65\QtSupport\*.dll&quot;;           DestDir: &quot;{sys}&quot;;  Flags: onlyifdoesntexist
+
+Source: &quot;c:\Users\joe\map65\install\save\dummy&quot;;        DestDir: &quot;{app}\save&quot;;
+
+[Icons]
+Name: &quot;{group}\MAP65&quot;;        Filename: &quot;{app}\map65.exe&quot;;   WorkingDir: {app}; IconFilename: {app}\wsjt.ico
+Name: &quot;{userdesktop}\MAP65&quot;;  Filename: &quot;{app}\map65.exe&quot;;   WorkingDir: {app}; IconFilename: {app}\wsjt.ico
+
+[Run]
+Filename: &quot;{app}\wisdom1.bat&quot;; Description: &quot;Optimize plans for FFTs (takes a few minutes)&quot;; Flags: postinstall
+Filename: &quot;{app}\wisdom2.bat&quot;; Description: &quot;Patiently optimize plans for FFTs (up to one hour)&quot;; Flags: postinstall unchecked

Added: branches/map65/map65.pro
===================================================================
--- branches/map65/map65.pro	                        (rev 0)
+++ branches/map65/map65.pro	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,77 @@
+#-------------------------------------------------
+#
+# Project created by QtCreator 2011-07-07T08:39:24
+#
+#-------------------------------------------------
+
+QT       += core gui network
+CONFIG   += qwt thread
+#CONFIG   += console
+
+TARGET = map65
+VERSION = 2.3.0
+TEMPLATE = app
+
+win32 {
+DEFINES = WIN32
+DESTDIR = ../install
+F90 = g95
+g95.output = ${QMAKE_FILE_BASE}.o
+g95.commands = $$F90 -c -O2 -o ${QMAKE_FILE_OUT} ${QMAKE_FILE_NAME}
+g95.input = F90_SOURCES
+QMAKE_EXTRA_COMPILERS += g95
+}
+
+unix {
+DEFINES = UNIX
+DESTDIR = ../install
+F90 = gfortran
+gfortran.output = ${QMAKE_FILE_BASE}.o
+gfortran.commands = $$F90 -c -O2 -o ${QMAKE_FILE_OUT} ${QMAKE_FILE_NAME}
+gfortran.input = F90_SOURCES
+QMAKE_EXTRA_COMPILERS += gfortran
+}
+
+SOURCES += main.cpp mainwindow.cpp plotter.cpp about.cpp \
+    soundin.cpp soundout.cpp devsetup.cpp \
+    widegraph.cpp getfile.cpp messages.cpp bandmap.cpp \
+    astro.cpp displaytext.cpp getdev.cpp
+
+win32 {
+SOURCES += killbyname.cpp     set570.cpp
+}
+
+HEADERS  += mainwindow.h plotter.h soundin.h soundout.h \
+            about.h devsetup.h widegraph.h getfile.h messages.h \
+            bandmap.h commons.h sleep.h astro.h displaytext.h \
+
+DEFINES += __cplusplus
+
+FORMS    += mainwindow.ui about.ui devsetup.ui widegraph.ui \
+    messages.ui bandmap.ui astro.ui
+
+RC_FILE = map65.rc
+
+unix {
+INCLUDEPATH += $$quote(/usr/include/qwt-qt4)
+LIBS += -lfftw3f /usr/lib/libgfortran.so.3
+LIBS += ../trunk/libm65/libm65.a
+LIBS += /usr/lib/libqwt-qt4.so
+LIBS += -lportaudio
+#LIBS +- -lusb
+}
+
+win32 {
+INCLUDEPATH += c:/qwt-6.0.1/include
+LIBS += ../trunk/libm65/libm65.a
+LIBS += ../trunk/libfftw3f_win.a
+LIBS += ../QtSupport/palir-02.dll
+LIBS += libwsock32
+LIBS += C:/MinGW/lib/libf95.a
+CONFIG(release) {
+   LIBS += C:/qwt-6.0.1/lib/qwt.dll
+} else {
+   LIBS += C:/qwt-6.0.1/lib/qwtd.dll
+}
+LIBS += -lusb
+}

Deleted: branches/map65/map65.py
===================================================================
--- branches/map65/map65.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/map65.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,1996 +0,0 @@
-#--------------------------------------------------------------------- MAP65
-# $Date$ $Revision$
-#
-from Tkinter import *
-from tkFileDialog import *
-import Pmw
-from tkMessageBox import showwarning
-import g,os,time
-import Audio
-from math import log10
-try:
-    from numpy.oldnumeric import zeros
-except: 
-    from Numeric import zeros
-import dircache
-import Image,ImageTk  #, ImageDraw
-from palettes import colormapblue, colormapgray0, colormapHot, \
-     colormapAFMHot, colormapgray1, colormapLinrad, Colormap2Palette
-from types import *
-import array
-
-root = Tk()
-Version=&quot;1.1 r&quot; + &quot;$Rev$&quot;[6:-1]
-Version=Version.strip()
-print &quot;******************************************************************&quot;
-print &quot;MAP65 Version &quot; + Version + &quot;, by K1JT&quot;
-print &quot;Revision date: &quot; + \
-      &quot;$Date$&quot;[7:-1]
-print &quot;Run date:   &quot; + time.asctime(time.gmtime()) + &quot; UTC&quot;
-
-#See if we are running in Windows
-g.Win32=0
-if sys.platform==&quot;win32&quot;:
-    g.Win32=1
-    try:
-        root.option_readfile('map65rc.win')
-    except:
-        pass
-else:
-    try:
-        root.option_readfile('map65rc')
-    except:
-        pass
-root_geom=&quot;&quot;
-
-
-#------------------------------------------------------ Global variables
-appdir=os.getcwd()
-g.appdir=appdir
-isync=1
-isync_save=0
-iclip=0
-itol=5                                       #Default tol=500 Hz
-ntol=(10,20,50,100,200,500,1000)             #List of available tolerances
-idsec=0
-lauto=0
-altmsg=0
-bm_geom=&quot;&quot;
-bm2_geom=&quot;&quot;
-cmap0=&quot;Linrad&quot;
-fileopened=&quot;&quot;
-font1='Helvetica'
-fqso0=125
-hiscall=&quot;&quot;
-hisgrid=&quot;&quot;
-hisgrid0=&quot;&quot;
-isec0=-99
-isec00=-99
-k2txb=IntVar()
-kb8rq=IntVar()
-kxp0=0
-loopall=0
-mode=StringVar()
-mode.set(&quot;&quot;)
-mrudir=os.getcwd()
-multicast=IntVar()
-nafc=IntVar()
-naz=0
-ndepth=IntVar()
-nel=0
-nblank=IntVar()
-ncall=0
-ndmiles=0
-ndkm=0
-ndebug=IntVar()
-ndebug2=IntVar()
-ndebug.set(0)
-ndebug2.set(0)
-neme=IntVar()
-nfreeze=IntVar()
-nopen=0
-nosh441=IntVar()
-noshjt65=IntVar()
-setseq=IntVar()
-tx6alt=&quot;&quot;
-txminute=0
-txsnrdb=99.
-TxFirst=IntVar()
-worked={}
-green=zeros(500,'f')
-im=Image.new('P',(500,120))
-im.putpalette(Colormap2Palette(colormapLinrad),&quot;RGB&quot;)
-pim=ImageTk.PhotoImage(im)
-balloon=Pmw.Balloon(root)
-
-g.freeze_decode=0
-g.mode=&quot;&quot;
-g.ndecphase=0
-g.ndevin=IntVar()
-g.ndevout=IntVar()
-g.DevinName=StringVar()
-g.DevoutName=StringVar()
-
-g.fc=[&quot;&quot; for i in range(200)]
-
-#------------------------------------------------------ showspecjt
-def showspecjt(event=NONE):
-    if g.showspecjt==0: g.showspecjt=1
-
-#------------------------------------------------------ restart
-def restart():
-    Audio.gcom2.nrestart=1
-    Audio.gcom2.mantx=1
-
-#------------------------------------------------------ restart2
-def restart2():
-    Audio.gcom2.nrestart=1
-
-#------------------------------------------------------ toggle_freeze
-def toggle_freeze(event=NONE):
-    nfreeze.set(1-nfreeze.get())
-
-#------------------------------------------------------ toggle_zap
-def toggle_zap(event=NONE):
-    nzap.set(1-nzap.get())
-
-#------------------------------------------------------ btx (1-6)
-def btx1(event=NONE):
-    ntx.set(1)
-    Audio.gcom2.txmsg=(tx1.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=1
-    restart()
-def btx2(event=NONE):
-    ntx.set(2)
-    Audio.gcom2.txmsg=(tx2.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=2
-    restart()
-def btx3(event=NONE):
-    ntx.set(3)
-    Audio.gcom2.txmsg=(tx3.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=3
-    restart()
-def btx4(event=NONE):
-    ntx.set(4)
-    Audio.gcom2.txmsg=(tx4.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=4
-    restart()
-def btx5(event=NONE):
-    ntx.set(5)
-    Audio.gcom2.txmsg=(tx5.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=5
-    restart()
-def btx6(event=NONE):
-    ntx.set(6)
-    Audio.gcom2.txmsg=(tx6.get()+'                            ')[:28]
-    Audio.gcom2.ntxreq=6
-    restart()
-
-#------------------------------------------------------ quit
-def quit():
-    root.destroy()
-
-#------------------------------------------------------ testmsgs
-def testmsgs():
-    for m in (tx1, tx2, tx3, tx4, tx5, tx6):
-        m.delete(0,99)
-    tx1.insert(0,&quot;@A&quot;)
-    tx2.insert(0,&quot;@B&quot;)
-    tx3.insert(0,&quot;@C&quot;)
-    tx4.insert(0,&quot;@D&quot;)
-    tx5.insert(0,&quot;@1000&quot;)
-    tx6.insert(0,&quot;@2000&quot;)
-
-#------------------------------------------------------ delta_phi
-def delta_phi():
-    global lauto
-    Audio.gcom2.monitoring=0
-    lauto=0
-    Audio.gcom2.lauto=0
-    Audio.gcom2.ndphi=1
-    decode()
-
-#------------------------------------------------------ 
-def messages(event=NONE):
-    global Version,bm,bm_geom,msgtext
-    bm=Toplevel(root)
-    bm.title(&quot;Messages&quot;)
-    bm.geometry(bm_geom)
-    if g.Win32: bm.iconbitmap(&quot;wsjt.ico&quot;)
-    iframe_bm1 = Frame(bm, bd=1, relief=SUNKEN)
-    Label(iframe_bm1,text='Freq      DF     Pol     UTC     dB').pack(anchor=W, \
-        pady=0,side='top')
-    msgtext=Text(iframe_bm1, height=35, width=45, bg=&quot;Navy&quot;, fg=&quot;yellow&quot;)
-    msgtext.bind('&lt;Double-Button-1&gt;',dbl_click_msgtext)
-    msgtext.pack(side=LEFT, fill=X, padx=1, pady=3)
-    bmsb = Scrollbar(iframe_bm1, orient=VERTICAL, command=msgtext.yview)
-    bmsb.pack(side=RIGHT, fill=Y)
-    msgtext.configure(yscrollcommand=bmsb.set)
-    msgtext.tag_configure('age0',foreground='red')
-    msgtext.tag_configure('age1',foreground='yellow')
-    msgtext.tag_configure('age2',foreground='gray75')
-    msgtext.tag_configure('age3',foreground='gray50')
-    iframe_bm1.pack(expand=1, fill=X, padx=4)
-
-#------------------------------------------------------ bandmap
-def bandmap(event=NONE):
-    global Version,bm2,bm2_geom,bmtext
-    bm2=Toplevel(root)
-    bm2.title(&quot;Band Map&quot;)
-    bm2.geometry(bm2_geom)
-    if g.Win32: bm2.iconbitmap(&quot;wsjt.ico&quot;)
-    iframe_bm2 = Frame(bm2, bd=1, relief=SUNKEN)
-    bmtext=Text(iframe_bm2, height=24, width=39, bg=&quot;Navy&quot;, fg=&quot;yellow&quot;)
-    bmtext.bind('&lt;Double-Button-1&gt;',dbl_click_bmtext)
-    bmtext.pack(side=LEFT, fill=X, padx=1, pady=3)
-    bmtext.tag_configure('age0',foreground='red')
-    bmtext.tag_configure('age1',foreground='yellow')
-    bmtext.tag_configure('age2',foreground='gray75')
-    bmtext.tag_configure('age3',foreground='gray50')
-    iframe_bm2.pack(expand=1, fill=X, padx=4,pady=5)
-
-#------------------------------------------------------ logqso
-def logqso(event=NONE):
-    t=time.strftime(&quot;%Y-%b-%d,%H:%M&quot;,time.gmtime())
-#    t=t+&quot;,&quot;+hiscall+&quot;,&quot;+hisgrid+&quot;,&quot;+str(g.nfreq)+&quot;,&quot;+g.mode+&quot;\n&quot;
-    t=t+&quot;,&quot;+ToRadio.get()+&quot;,&quot;+HisGrid.get()+&quot;,&quot;+str(g.nfreq)+&quot;,&quot;+g.mode+&quot;\n&quot;
-    t2=&quot;Please confirm making the following entry in MAP65.LOG:\n\n&quot; + t
-    if worked.has_key(hiscall.strip()):
-        t2=t2 + &quot;\n\n*** Dupe: &quot; + hiscall + &quot;is already in LOG ***&quot;
-    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),message_text=t2)
-    msg.geometry(msgpos())
-    if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
-    msg.focus_set()
-    result=msg.activate()
-    if result == 'Yes':
-        f=open(appdir+'/WSJT.LOG','a')
-        f.write(t)
-        f.close()
-        worked[hiscall.strip()]=1
-    
-#------------------------------------------------------ monitor
-def monitor(event=NONE):
-    bmonitor.configure(bg='green')
-    Audio.gcom2.monitoring=1
-
-#------------------------------------------------------ stopmon
-def stopmon(event=NONE):
-    global loopall
-    loopall=0
-    bmonitor.configure(bg='gray85')
-    Audio.gcom2.monitoring=0
-
-#------------------------------------------------------ dbl_click_text
-def dbl_click_text(event):
-    t=text.get('1.0',END)           #Entire contents of text box
-    t1=text.get('1.0',CURRENT)      #Contents from start to cursor
-    dbl_click_call(t,t1,'OOO',1,event)
-#------------------------------------------------------ dbl_click3_text
-def dbl_click3_text(event):
-        t=text.get('1.0',END)           #Entire contents of text box
-        t1=text.get('1.0',CURRENT)      #Contents from start to mouse pointer
-        n=t1.rfind(&quot;\n&quot;)
-        rpt=t1[n+24:n+27]
-        if rpt[0:1] == &quot; &quot;: rpt=rpt[1:]
-        dbl_click_call(t,t1,rpt,1,event)
-#------------------------------------------------------ dbl_click_msgtext
-def dbl_click_msgtext(event):
-    t=msgtext.get('1.0',END)           #Entire contents of text box
-    t1=msgtext.get('1.0',CURRENT)      #Contents from start to cursor
-    dbl_click_call(t,t1,'OOO',2,event)
-#------------------------------------------------------ dbl_click_bmtext
-def dbl_click_bmtext(event):
-    t=bmtext.get('1.0',END)           #Entire contents of text box
-    t1=bmtext.get('1.0',CURRENT)      #Contents from start to cursor
-    dbl_click_call(t,t1,'OOO',3,event)
-###------------------------------------------------------ dbl_click_ave
-##def dbl_click_ave(event):
-##    t=avetext.get('1.0',END)        #Entire contents of text box
-##    t1=avetext.get('1.0',CURRENT)   #Contents from start to cursor
-##    dbl_click_call(t,t1,'OOO',1,event)
-#------------------------------------------------------ dbl_click_call
-def dbl_click_call(t,t1,rpt,nbox,event):
-    global hiscall
-    i=len(t1)                       #Length to mouse pointer
-    i1=t1.rfind(' ')+1              #index of preceding space
-    i2=i1+t[i1:].find(' ')          #index of next space
-    hiscall=t[i1:i2]                #selected word, assumed as callsign
-    if hiscall[:1]=='*': hiscall=hiscall[1:]
-    if worked.has_key(hiscall.strip()):
-#        MsgBox(&quot;Possible dupe: &quot; + hiscall)
-        t3=&quot;Possible dupe: &quot; + hiscall
-        msg=Pmw.MessageDialog(root,buttons=('OK','Cancel'),message_text=t3)
-        msg.geometry(msgpos())
-        if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
-        msg.focus_set()
-        result=msg.activate()
-    else:
-        result='OK'
-    if result == 'OK':
-        ToRadio.delete(0,END)
-        ToRadio.insert(0,hiscall)
-        i3=t1.rfind('\n')+1             #start of selected line
-        if i&gt;=4 and i2&gt;i1:
-            nsec=0
-            try:
-                nsec=3600*int(t1[i3+13:i3+15]) + 60*int(t1[i3+15:i3+17])
-            except:
-                pass
-            if setseq.get() and nbox!=3:
-                TxFirst.set((nsec/int(Audio.gcom1.trperiod))%2)
-            lookup()
-            GenStdMsgs()
-            if rpt &lt;&gt; &quot;OOO&quot;:
-                n=tx1.get().rfind(&quot; &quot;)
-                t2=tx1.get()[0:n+1]
-                tx2.delete(0,END)
-                tx2.insert(0,t2+rpt)
-                tx3.delete(0,END)
-                tx3.insert(0,t2+&quot;R&quot;+rpt)
-                tx4.delete(0,END)
-                tx4.insert(0,t2+&quot;RRR&quot;)
-                tx5.delete(0,END)
-                tx5.insert(0,t2+&quot;73&quot;)
-            i3=t[:i1].strip().rfind(' ')+1
-            if t[i3:i1].strip() == 'CQ' or nbox &gt;= 2:
-                ntx.set(1)
-            else:
-                ntx.set(2)
-            if event.num==3 and not lauto: toggleauto()
-
-#----------------------------------------------------------- textkey
-def textkey(event=NONE):
-    text.configure(state=DISABLED)
-##def avetextkey(event=NONE):
-##    avetext.configure(state=DISABLED)
-
-#------------------------------------------------------ decode
-def decode(event=NONE):
-    if Audio.gcom2.ndecoding==0:        #If already busy, ignore request
-        if isec0&gt;=45 and txminute==0 and Audio.gcom2.monitoring==1 and \
-          Audio.datcom.kkdone!=-99 and Audio.gcom2.ndiskdat!=1:
-            bc='yellow'
-            bdecode.configure(bg=bc,activebackground=bc,state=DISABLED)
-        else:
-            Audio.gcom2.nagain=1
-            n=1
-            Audio.gcom2.mousebutton=0
-            if Audio.gcom2.ndecoding0==4: n=4
-            Audio.gcom2.ndecoding=n         #Standard decode, full file (d2a)
-
-#------------------------------------------------------ decode_include
-def decode_include(event=NONE):
-    global isync,isync_save
-    isync_save=isync
-    isync=-99
-    Audio.gcom2.minsigdb=-99
-    decode()
-
-#------------------------------------------------------ decode_exclude
-def decode_exclude(event=NONE):
-    global isync,isync_save
-    isync_save=isync
-    isync=99
-    Audio.gcom2.minsigdb=99
-    decode()
-
-#------------------------------------------------------ openfile
-def openfile(event=NONE):
-    global mrudir,fileopened,nopen
-    nopen=1                         #Work-around for &quot;click feedthrough&quot; bug
-    try:
-        os.chdir(mrudir)
-    except:
-        pass
-    fname=askopenfilename(filetypes=[(&quot;Linrad timf2 files&quot;,&quot;*.tf2 *.TF2&quot;)])
-    if fname:
-        Audio.getfile(fname,len(fname))
-        if Audio.gcom2.ierr: print 'Error ',Audio.gcom2.ierr, \
-           'when trying to read file',fname
-        mrudir=os.path.dirname(fname)
-        fileopened=os.path.basename(fname)
-    os.chdir(appdir)
- 
-#------------------------------------------------------ opennext
-def opennext(event=NONE):
-    global ncall,fileopened,loopall,mrudir
-    if fileopened==&quot;&quot; and ncall==0:
-        openfile()
-        ncall=1
-    else:
-# Make a list of *.tf2 files in mrudir
-        la=os.listdir(mrudir)
-        la.sort()
-        lb=[]
-        for i in range(len(la)):
-            j=la[i].find(&quot;.tf2&quot;) + la[i].find(&quot;.TF2&quot;)
-            if j&gt;0: lb.append(la[i])
-        for i in range(len(lb)):
-            if lb[i]==fileopened:
-                break
-        if i&lt;len(lb)-1:
-            fname=mrudir+&quot;/&quot;+lb[i+1]
-#            if not lauto: stopmon()
-            Audio.getfile(fname,len(fname))
-            if Audio.gcom2.ierr: print 'Error ',Audio.gcom2.ierr, \
-               'when trying to read file',fname
-            mrudir=os.path.dirname(fname)
-            fileopened=os.path.basename(fname)
-        else:
-            t=&quot;No more files to process.&quot;
-            msg=Pmw.MessageDialog(root,buttons=('OK',),message_text=t)
-            msg.geometry(msgpos())
-            if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
-            msg.focus_set()
-            ncall=0
-            loopall=0
-
-#------------------------------------------------------ decodeall
-def decodeall(event=NONE):
-    global loopall
-    loopall=1
-    opennext()
-
-#------------------------------------------------------ astro1
-def astro1(event=NONE):
-    astro.astro2(g.astro_geom0)
-
-#------------------------------------------------------ options1
-def options1(event=NONE):
-    options.options2(root_geom[root_geom.index(&quot;+&quot;):])
-
-#------------------------------------------------------ txmute
-def txmute(event=NONE):
-    Audio.gcom1.mute=1-Audio.gcom1.mute
-    if Audio.gcom1.mute:
-        lab7.configure(bg='red',fg='black')
-    else:
-        lab7.configure(bg='gray85',fg='gray85')
-
-#------------------------------------------------------ MsgBox
-def MsgBox(t):
-    msg=Pmw.MessageDialog(root,buttons=('OK',),message_text=t)
-    result=msg.activate()
-    msg.focus_set()
-
-#------------------------------------------------------ txstop
-def txstop(event=NONE):
-    if lauto: toggleauto()
-    Audio.gcom1.txok=0
-    Audio.gcom2.mantx=0
-#    specjt.pal_gray0()      ????
-    
-#------------------------------------------------------ lookup
-def lookup(event=NONE):
-    global hiscall,hisgrid
-    hiscall=ToRadio.get().upper().strip()
-    ToRadio.delete(0,END)
-    ToRadio.insert(0,hiscall)
-    s=whois(hiscall)
-    balloon.bind(ToRadio,s[:-1])
-    hisgrid=&quot;&quot;
-    if s:
-        i1=s.find(',')
-        i2=s.find(',',i1+1)
-        hisgrid=s[i1+1:i2]
-        hisgrid=hisgrid[:2].upper()+hisgrid[2:4]+hisgrid[4:6].lower()
-    if len(hisgrid)==4: hisgrid=hisgrid+&quot;mm&quot;
-    if len(hisgrid)==5: hisgrid=hisgrid+&quot;m&quot;
-    HisGrid.delete(0,99)
-    HisGrid.insert(0,hisgrid)
-
-def lookup_gen(event):
-    lookup()
-    GenStdMsgs()
-
-#-------------------------------------------------------- addtodb
-def addtodb():
-    global hiscall
-    if HisGrid.get()==&quot;&quot;:
-        MsgBox(&quot;Please enter a valid grid locator.&quot;)
-    else:
-        modified=0
-        hiscall=ToRadio.get().upper().strip()
-        hisgrid=HisGrid.get().strip()
-        hc=hiscall
-        NewEntry=hc + &quot;,&quot; + hisgrid
-        msg=Pmw.MessageDialog(root,buttons=('Yes','No'),
-            message_text=&quot;Is this station known to be active on EME?&quot;)
-        result=msg.activate()
-        msg.focus_set()
-        if result==&quot;Yes&quot;:
-            NewEntry=NewEntry + &quot;,EME,,&quot;
-        else:
-            NewEntry=NewEntry + &quot;,,,&quot;
-        try:
-            f=open(appdir+'/CALL3.TXT','r')
-            s=f.readlines()
-        except:
-            print 'Error opening CALL3.TXT'
-            s=&quot;&quot;
-        f.close()
-        hc2=&quot;&quot;
-        stmp=[]
-        for i in range(len(s)):
-            hc1=hc2
-            if s[i][:2]==&quot;//&quot;:
-                stmp.append(s[i])
-            else:
-                i1=s[i].find(&quot;,&quot;)
-                hc2=s[i][:i1]
-                if hc&gt;hc1 and hc&lt;hc2:
-                    stmp.append(NewEntry+&quot;\n&quot;)
-                    modified=1
-                elif hc==hc2:
-                    t=s[i] + &quot;\n\n is already in CALL3.TXT\nDo you wish to replace this entry?&quot;
-                    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),
-                        message_text=t)
-                    result=msg.activate()
-                    msg.focus_set()
-                    if result==&quot;Yes&quot;:
-                        i1=s[i].find(&quot;,&quot;)
-                        i2=s[i].find(&quot;,&quot;,i1+1)
-                        i3=s[i].find(&quot;,&quot;,i2+1)
-                        i4=len(NewEntry)
-                        s[i]=NewEntry[:i4-1] + s[i][i3+1:]
-                        modified=1
-                stmp.append(s[i])
-        if hc&gt;hc1 and modified==0:
-            stmp.append(NewEntry+&quot;\n&quot;)
-        try:
-            f=open(appdir+'/CALL3.TMP','w')
-            f.writelines(stmp)
-            f.close()
-        except:
-            print 'Error in opening or writing to CALL3.TMP'
-
-        if modified:
-            if os.path.exists(&quot;CALL3.OLD&quot;): os.remove(&quot;CALL3.OLD&quot;)
-            os.rename(&quot;CALL3.TXT&quot;,&quot;CALL3.OLD&quot;)
-            os.rename(&quot;CALL3.TMP&quot;,&quot;CALL3.TXT&quot;)
-            Audio.gcom2.mcall3=1
-
-#-------------------------------------------------------- clrToRadio
-def clrToRadio(event):
-    ToRadio.delete(0,END)
-    HisGrid.delete(0,99)
-    ToRadio.focus_set()
-    if kb8rq.get():
-        ntx.set(6)
-        nfreeze.set(0)
-
-#------------------------------------------------------ whois
-def whois(hiscall):
-    whodat=&quot;&quot;
-    try:
-        f=open(appdir+'/CALL3.TXT','r')
-        s=f.readlines()
-        f.close()
-    except:
-        print 'Error when searching CALL3.TXT, or no such file present'
-        s=&quot;&quot;
-    for i in range(len(s)):
-        if s[i][:2] != '//':
-            i1=s[i].find(',')
-            if s[i][:i1] == hiscall:
-                return s[i]
-    return &quot;&quot;
-
-#------------------------------------------------------ cleartext
-def cleartext():
-    f=open(appdir+'/decoded.txt',mode='w')
-    f.truncate(0)                           #Delete contents of decoded.txt
-    f.close()
-    f=open(appdir+'/decoded.ave',mode='w')
-    f.truncate(0)                           #Delete contents of decoded.ave
-    f.close()
-
-#------------------------------------------------------ ModeJT65
-def ModeJT65():
-    global isync,itol
-    cleartext()
-    Audio.gcom1.trperiod=60
-##    iframe4b.pack(after=iframe4,expand=1, fill=X, padx=4)
-##    bclravg.configure(state=NORMAL)
-##    binclude.configure(state=NORMAL)
-##    bexclude.configure(state=NORMAL)
-    itol=4
-    inctol()
-    nfreeze.set(0)
-    ntx.set(1)
-    GenStdMsgs()
-    erase()
-
-#------------------------------------------------------ ModeJT65A
-def ModeJT65A(event=NONE):
-    if g.mode != &quot;JT65A&quot;:
-        if lauto: toggleauto()
-        mode.set(&quot;JT65A&quot;)
-        ModeJT65()
-
-#------------------------------------------------------ ModeJT65B
-def ModeJT65B(event=NONE):
-    if g.mode != &quot;JT65B&quot;:
-        if lauto: toggleauto()
-        mode.set(&quot;JT65B&quot;)
-        ModeJT65()
-
-#------------------------------------------------------ ModeJT65C
-def ModeJT65C(event=NONE):
-    if g.mode != &quot;JT65C&quot;:
-        if lauto: toggleauto()
-        mode.set(&quot;JT65C&quot;)
-        ModeJT65()
-
-#------------------------------------------------------ msgpos
-def msgpos():
-    g=root_geom[root_geom.index(&quot;+&quot;):]
-    t=g[1:]
-    x=int(t[:t.index(&quot;+&quot;)])          # + 70
-    y=int(t[t.index(&quot;+&quot;)+1:])        # + 70
-    return &quot;+%d+%d&quot; % (x,y)    
-
-#------------------------------------------------------ about
-def about(event=NONE):
-    global Version
-    about=Toplevel(root)
-    about.geometry(msgpos())
-    if g.Win32: about.iconbitmap(&quot;wsjt.ico&quot;)
-    t=&quot;MAP65 Version &quot; + Version + &quot;, by K1JT&quot;
-    Label(about,text=t,font=(font1,16)).pack(padx=20,pady=5)
-    t=&quot;&quot;&quot;
-MAP65 is a weak signal communications program designed primarily
-for the Earth-Moon-Earth (EME) propagation path.
-
-Copyright (c) 2001-2007 by Joseph H. Taylor, Jr., K1JT, with
-contributions from additional authors.  MAP65 is Open Source 
-software, licensed under the GNU General Public License (GPL).
-Source code and programming information may be found at 
-<A HREF="http://developer.berlios.de/projects/wsjt/.">http://developer.berlios.de/projects/wsjt/.</A>
-&quot;&quot;&quot;
-    Label(about,text=t,justify=LEFT).pack(padx=20)
-    t=&quot;Revision date: &quot; + \
-      &quot;$Date$&quot;[7:-1]
-    Label(about,text=t,justify=LEFT).pack(padx=20)
-    about.focus_set()
-
-#------------------------------------------------------ shortcuts
-def shortcuts(event=NONE):
-    scwid=Toplevel(root)
-    scwid.geometry(msgpos())
-    if g.Win32: scwid.iconbitmap(&quot;wsjt.ico&quot;)
-    t=&quot;&quot;&quot;
-F1	List keyboard shortcuts
-Shift+F1	List special mouse commands
-Ctrl+F1	About MAP65
-F2	Options
-F3	Tx Mute
-F4	Clear &quot;To Radio&quot;
-F5	What message to send?
-F6	Open next file in directory
-Shift+F6	Decode all wave files in directory
-Shift+F8  JT65B
-F10	Show Waterfall
-Shift+F10   Show astronomical data
-F11	Decrease DF
-F12	Increase DF
-Shift+F11   Decrease QSO Frequency
-Shift+F12   Increase QSO Frequency
-Alt+1 to Alt+6	Tx1 to Tx6
-Alt+A	Toggle Auto On/Off
-Alt+D	Decode
-Alt+E	Erase
-Alt+G	Generate Standard Messages
-Ctrl+G	Generate Alternate JT65 Messages
-Alt+I	Include
-Alt+L	Lookup
-Ctrl+L	Lookup, then Generate Standard Messages
-Alt+M	Monitor
-Alt+O	Tx Stop
-Alt+Q	Log QSO
-Alt+S	Stop Monitoring or Decoding
-Alt+X	Exclude
-&quot;&quot;&quot;
-    Label(scwid,text=t,justify=LEFT).pack(padx=20)
-    scwid.focus_set()
-
-#------------------------------------------------------ mouse_commands
-def mouse_commands(event=NONE):
-    scwid=Toplevel(root)
-    scwid.geometry(msgpos())
-    if g.Win32: scwid.iconbitmap(&quot;wsjt.ico&quot;)
-    t=&quot;&quot;&quot;
-Click on          Action
---------------------------------------------------------
-Waterfall (upper)   Click to set QSO frequency; double-click to set
-                               QSO frequency and Decode
-
-Waterfall (lower)   Click to set target DF; double-click to set
-                               target DF and Decode
-
-Main screen,          Double-click puts callsign in Tx messages
-text area
-&quot;&quot;&quot;
-    Label(scwid,text=t,justify=LEFT).pack(padx=20)
-    scwid.focus_set()
-
-#------------------------------------------------------ what2send
-def what2send(event=NONE):
-    screenf5=Toplevel(root)
-    screenf5.geometry(root_geom[root_geom.index(&quot;+&quot;):])
-    if g.Win32: screenf5.iconbitmap(&quot;wsjt.ico&quot;)
-    t=&quot;&quot;&quot;
-To optimize your chances of completing a valid JT65 QSO, use
-the following standard procedures and *do not* exchange pertinent
-information by other means (e.g., internet, telephone, ...) while
-the QSO is in progress!
-
-If you have received
-    ... less than both calls, send both calls and your grid locator.
-    ... both calls, send both calls, your grid locator, and OOO.
-    ... both calls and OOO, send RO.
-    ... RO, send RRR.
-    ... RRR, the QSO is complete.  However, the other station may not
-know this, so it is conventional to send 73 to signify that you are done.
-
-Sending grid locators is conventional in JT65, but numerical signal
-reports such as &quot;-22&quot; or &quot;R-24&quot; may be substituted.
-&quot;&quot;&quot;
-    Label(screenf5,text=t,justify=LEFT).pack(padx=20)
-    screenf5.focus_set()
-
-#------------------------------------------------------ prefixes
-def prefixes(event=NONE):
-    pfx=Toplevel(root)
-    pfx.geometry(msgpos())
-    if g.Win32: pfx.iconbitmap(&quot;wsjt.ico&quot;)
-    f=open(appdir+'/prefixes.txt','r')
-    s=f.readlines()
-    t2=&quot;&quot;
-    for i in range(4):
-        t2=t2+s[i]
-    t=&quot;&quot;
-    for i in range(len(s)-4):
-        t=t+s[i+4]
-    t=t.split()
-    t.sort()
-    t1=&quot;&quot;
-    n=0
-    for i in range(len(t)):
-        t1=t1+t[i]+&quot;  &quot;
-        n=n+len(t[i])+2
-        if n&gt;60:
-            t1=t1+&quot;\n&quot;
-            n=0
-    t1=t1+&quot;\n&quot;
-    if options.addpfx.get().lstrip():
-        t1=t1+&quot;\nOptional prefix:  &quot;+(options.addpfx.get().lstrip()+'    ')[:8]
-    t2=t2+&quot;\n&quot;+t1
-    Label(pfx,text=t2,justify=LEFT).pack(padx=20)
-    pfx.focus_set()
-
-#------------------------------------------------------ azdist
-def azdist():
-    if len(HisGrid.get().strip())&lt;4:
-        labAz.configure(text=&quot;&quot;)
-        labDist.configure(text=&quot;&quot;)
-    else:
-        labAz.configure(text=&quot;Az: %d&quot; % (naz,))
-    if options.mileskm.get()==0:
-        labDist.configure(text=str(ndmiles)+&quot; mi&quot;)
-    else:
-        labDist.configure(text=str(int(1.609344*ndmiles))+&quot; km&quot;)
-    
-#------------------------------------------------------ inctol
-def inctol(event=NONE):
-    global itol
-    maxitol=6
-    if itol&lt;maxitol: itol=itol+1
-    ltol.configure(text='Tol    '+str(ntol[itol]))
-
-#------------------------------------------------------ dectol
-def dectol(event):
-    global itol
-    if itol&gt;0 : itol=itol-1
-    ltol.configure(text='Tol    '+str(ntol[itol]))
-
-#------------------------------------------------------ incdsec
-def incdsec(event):
-    global idsec
-    idsec=idsec+5
-    bg='red'
-    if idsec==0: bg='white'
-    ldsec.configure(text='Dsec  '+str(0.1*idsec),bg=bg)
-    Audio.gcom1.ndsec=idsec
-
-#------------------------------------------------------ decdsec
-def decdsec(event):
-    global idsec
-    idsec=idsec-5
-    bg='red'
-    if idsec==0: bg='white'
-    ldsec.configure(text='Dsec  '+str(0.1*idsec),bg=bg)
-    Audio.gcom1.ndsec=idsec
-
-#------------------------------------------------------ erase
-def erase(event=NONE):
-    text.configure(state=NORMAL)
-    text.delete('1.0',END)
-    text.configure(state=DISABLED)
-##    avetext.configure(state=NORMAL)
-##    avetext.delete('1.0',END)
-##    avetext.configure(state=DISABLED)
-    Audio.gcom2.decodedfile=&quot;                        &quot;
-###------------------------------------------------------ clear_avg
-##def clear_avg(event=NONE):
-##    avetext.configure(state=NORMAL)
-##    avetext.delete('1.0',END)
-##    avetext.configure(state=DISABLED)
-##    f=open(appdir+'/decoded.ave',mode='w')
-##    f.truncate(0)                           #Delete contents of decoded.ave
-##    f.close()
-##    Audio.gcom2.nclearave=1
-
-#------------------------------------------------------ delwav
-def delwav():
-    t=&quot;Are you sure you want to delete\nall *.tf2 files in &quot; + \
-       options.savedir.get() + &quot; ?&quot;
-    msg=Pmw.MessageDialog(root,buttons=('Yes','No'),message_text=t)
-    msg.geometry(msgpos())
-    if g.Win32: msg.iconbitmap(&quot;wsjt.ico&quot;)
-    msg.focus_set()
-    result=msg.activate()
-    if result == 'Yes':
-# Make a list of *.tf2 in SaveDir
-        la=dircache.listdir(options.savedir.get())
-        lb=[]
-        for i in range(len(la)):
-            j=la[i].find(&quot;.tf2&quot;) + la[i].find(&quot;.TF2&quot;)
-            if j&gt;0: lb.append(la[i])
-# Now delete them all.
-        savedir=options.savedir.get()
-        if savedir[-1:] != '/' and savedir[-1:] != '\\':
-            savedir=savedir + '/'
-        for i in range(len(lb)):
-            fname=savedir+lb[i]
-            os.remove(fname)
-
-#------------------------------------------------------ del_all
-def del_all():
-    Audio.gcom1.ns0=-999999
-
-#------------------------------------------------------ clr_all
-def clr_all():
-    Audio.gcom2.nrw26=1                 #Request rewind of tmp26.txt
-    msgtext.delete('1.0',END)
-    bmtext.delete('1.0',END)
-
-#------------------------------------------------------ toggleauto
-def toggleauto(event=NONE):
-    global lauto
-    lauto=1-lauto
-    Audio.gcom2.lauto=lauto
-    if lauto:
-        monitor()
-    else:
-        Audio.gcom1.txok=0
-        Audio.gcom2.mantx=0
-    if lauto==0: auto.configure(text='Auto is OFF',bg='gray85',relief=RAISED)
-    if lauto==1: auto.configure(text='Auto is ON',bg='red',relief=SOLID)
-    
-#----------------------------------------------------- dtdf_change
-# Readout of graphical cursor location
-def dtdf_change(event):
-    if event.y&lt;40 and Audio.gcom2.nspecial==0:
-        lab1.configure(text='Time (s)',bg=&quot;#33FFFF&quot;)   #light blue
-        t=&quot;%.1f&quot; % (12.0*event.x/500.0-2.0,)
-        lab6.configure(text=t,bg=&quot;#33FFFF&quot;)
-    elif (event.y&gt;=40 and event.y&lt;95) or \
-             (event.y&lt;95 and Audio.gcom2.nspecial&gt;0):
-        lab1.configure(text='DF (Hz)',bg='red')
-        idf=Audio.gcom2.idf
-        t=&quot;%d&quot; % int(idf+1200.0*event.x/500.0-600.0,)
-        lab6.configure(text=t,bg=&quot;red&quot;)
-    else:
-        lab1.configure(text='Time (s)',bg='green')
-        t=&quot;%.1f&quot; % (53.0*event.x/500.0,)
-        lab6.configure(text=t,bg=&quot;green&quot;)
-
-#---------------------------------------------------- mouse_click_g1
-def mouse_click_g1(event):
-    global nopen
-    if not nopen:
-        Audio.gcom2.mousedf=int(Audio.gcom2.idf+(event.x-250)*2.4)
-    nopen=0
-
-#------------------------------------------------------ double-click_g1
-def double_click_g1(event):
-    if Audio.gcom2.ndecoding==0:
-        g.freeze_decode=1
-    
-#------------------------------------------------------ mouse_up_g1
-def mouse_up_g1(event):
-# This is a fix for certain mouse-clicks
-    pass
-
-#------------------------------------------------------ right_arrow
-def right_arrow(event=NONE):
-    n=5*int(Audio.gcom2.mousedf/5)
-    if n!=0: n=n+5
-    if n==Audio.gcom2.mousedf: n=n+5
-    Audio.gcom2.mousedf=n
-    
-#------------------------------------------------------ left_arrow
-def left_arrow(event=NONE):
-    n=5*int(Audio.gcom2.mousedf/5)
-    if n==Audio.gcom2.mousedf: n=n-5
-    Audio.gcom2.mousedf=n
-
-#------------------------------------------------------ inc_fqso
-def inc_fqso(event=NONE):
-    Audio.gcom2.mousefqso=Audio.gcom2.mousefqso + 1
-
-#------------------------------------------------------ dec_fqso
-def dec_fqso(event=NONE):
-    Audio.gcom2.mousefqso=Audio.gcom2.mousefqso - 1
-    
-#------------------------------------------------------ set_ftx
-def set_ftx(event=NONE):
-    Audio.gcom2.nsetftx=1
-
-#------------------------------------------------------ GenStdMsgs
-def GenStdMsgs(event=NONE):
-    global altmsg
-    t=ToRadio.get().upper().strip()
-    ToRadio.delete(0,99)
-    ToRadio.insert(0,t)
-    if k2txb.get()!=0: ntx.set(1)
-    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
-    for m in (tx1, tx2, tx3, tx4, tx5, tx6):
-        m.delete(0,99)
-    if ToRadio.get().find(&quot;/&quot;) == -1 and \
-           options.MyCall.get().find(&quot;/&quot;) == -1:
-        t=ToRadio.get() + &quot; &quot;+options.MyCall.get() + &quot; &quot;+options.MyGrid.get()[:4]
-        tx1.insert(0,t.upper())
-    else:
-        tx1.insert(0,ToRadio.get() + &quot; &quot;+options.MyCall.get())
-    tx2.insert(0,tx1.get()+&quot; OOO&quot;)
-    tx3.insert(0,&quot;RO&quot;)
-    tx4.insert(0,&quot;RRR&quot;)
-    tx5.insert(0,&quot;73&quot;)
-    t=&quot;CQ &quot; + options.MyCall.get()+ &quot; &quot;+options.MyGrid.get()[:4]
-    tx6.insert(0,t.upper())
-    altmsg=0
-    
-#------------------------------------------------------ GenAltMsgs
-def GenAltMsgs(event=NONE):
-    global altmsg,tx6alt
-    t=ToRadio.get().upper().strip()
-    ToRadio.delete(0,99)
-    ToRadio.insert(0,t)
-    if k2txb.get()!=0: ntx.set(1)
-    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
-    if ToRadio.get().find(&quot;/&quot;) == -1 and options.MyCall.get().find(&quot;/&quot;) == -1:
-        for m in (tx1, tx2, tx3, tx4, tx5, tx6):
-            m.delete(0,99)
-        t=ToRadio.get() + &quot; &quot;+options.MyCall.get()
-        tx1.insert(0,t.upper())
-        tx2.insert(0,tx1.get()+&quot; OOO&quot;)
-        tx3.insert(0,tx1.get()+&quot; RO&quot;)
-        tx4.insert(0,tx1.get()+&quot; RRR&quot;)
-        tx5.insert(0,&quot;TNX 73 GL &quot;)
-        tx6.insert(0,tx6alt.upper())
-        altmsg=1
-
-#------------------------------------------------------ update
-def update():
-    global root_geom,isec0,naz,nel,ndmiles,ndkm,nopen,kxp0, \
-           im,pim,cmap0,isync,isync_save,idsec,first,itol,txsnrdb,tx6alt,\
-           bm_geom,bm2_geom,hisgrid0,fqso0,isec00,worked,txminute
-    
-    utc=time.gmtime(time.time()+0.1*idsec)
-    isec=utc[5]
-    txminute=0
-    if Audio.gcom2.lauto and utc[4]%2 != Audio.gcom1.txfirst: txminute=1
-
-    if isec != isec0:                           #Do once per second
-        isec0=isec
-        t=time.strftime('%y%m%d',utc)
-        Audio.gcom2.fnamedate=t[:6]
-        t=time.strftime('%Y %b %d\n%H:%M:%S',utc)
-        Audio.gcom2.utcdate=t[:12]
-        ldate.configure(text=t)
-        t=&quot;Rx: %.1f dB  %.1f %% %d&quot; % (Audio.gcom2.rxnoise, \
-                        Audio.gcom2.pctblank,Audio.gcom2.nfloat)
-        msg4.configure(text=t)
-        t=&quot;Drop: %.2f %%&quot; % Audio.gcom2.pctlost
-        msg5.configure(text=t)
-        root_geom=root.geometry()
-        try:
-            bm_geom=bm.geometry()
-            bm2_geom=bm2.geometry()
-        except:
-            pass        
-        utchours=utc[3]+utc[4]/60.0 + utc[5]/3600.0
-        naz,nel,ndmiles,ndkm,nhotaz,nhotabetter=Audio.azdist0( \
-            options.MyGrid.get().upper(),HisGrid.get().upper(),utchours)
-        azdist()
-        g.nfreq=nfreq.get()
-        kxp=int(Audio.datcom.kxp)
-        if kxp-kxp0 &gt;=0 and kxp-kxp0 &lt; 50000 and \
-           ((not Audio.gcom2.lauto) or (not Audio.gcom1.transmitting)):
-            msg5.configure(text='No Rx data',bg='red')
-        else:
-            msg5.configure(bg='gray85')            
-        kxp0=kxp
-
-        if Audio.gcom2.ndecoding==0:
-            g.AzSun,g.ElSun,g.AzMoon,g.ElMoon,g.AzMoonB,g.ElMoonB,g.ntsky, \
-                g.ndop,g.ndop00,g.dbMoon,g.RAMoon,g.DecMoon,g.HA8,g.Dgrd,  \
-                g.sd,g.poloffset,g.MaxNR,g.dfdt,g.dfdt0,g.RaAux,g.DecAux, \
-                g.AzAux,g.ElAux = Audio.astro0(utc[0],utc[1],utc[2],  \
-                utchours,nfreq.get(),options.MyGrid.get().upper(), \
-                    options.auxra.get()+'         '[:9],     \
-                    options.auxdec.get()+'         '[:9])
-
-            if len(HisGrid.get().strip())&lt;4:
-                g.ndop=g.ndop00
-                g.dfdt=g.dfdt0
-
-        if (len(HisGrid.get().strip())&lt;4) or (hisgrid != hisgrid0):
-            msg6.configure(text=&quot;        &quot;,bg='gray85')
-            hisgrid0=hisgrid
-            Audio.gcom2.nhispol=-999
-
-        astrotext.delete(1.0,END)
-        astrotext.insert(END,'   Moon\n')
-        astrotext.insert(END,&quot;Az: %7.1f\n&quot; % g.AzMoon)
-        astrotext.insert(END,&quot;El: %7.1f\n&quot; % g.ElMoon)
-        astrotext.insert(END,&quot;DxAz: %5.1f\n&quot; % g.AzMoonB)
-        astrotext.insert(END,&quot;DxEl: %5.1f\n&quot; % g.ElMoonB)
-        astrotext.insert(END,'    Sun\n')
-        astrotext.insert(END,&quot;Az: %7.1f\n&quot; % g.AzSun)
-        astrotext.insert(END,&quot;El: %7.1f\n\n&quot; % g.ElSun)
-        astrotext.insert(END,&quot;Dop:%7d\n&quot; % g.ndop)
-        astrotext.insert(END,&quot;Dgrd:%6.1f\n&quot; % g.Dgrd)
-
-    if g.freeze_decode and mode.get()[:4]=='JT65':
-        if g.freeze_decode==1:
-            itol=5
-            ltol.configure(text='Tol    '+str(500))
-            Audio.gcom2.dftolerance=500
-            Audio.gcom2.mousedf=0
-        else:
-            itol=3
-            ltol.configure(text='Tol    '+str(100))
-            Audio.gcom2.dftolerance=100
-        nfreeze.set(1)
-        Audio.gcom2.nfreeze=1
-        if Audio.gcom2.monitoring:
-            Audio.gcom2.ndecoding=1
- #           Audio.gcom2.nagain=0
-            Audio.gcom2.nagain=1
-        else:
-            Audio.gcom2.ndecoding=4
-            Audio.gcom2.nagain=1
-        g.freeze_decode=0
-
-    t=g.ftnstr(Audio.gcom2.decodedfile)
-    i=g.rfnd(t,&quot;.&quot;)
-    t=t[:i]
-    if mode.get() != g.mode or first:
-        if mode.get()[:4]=='JT65':
-            msg1.configure(bg='#00FFFF')
-        elif mode.get()=='Measure':
-            msg1.configure(bg='yellow')
-        g.mode=mode.get()
-        first=0
-
-    samfac_out=Audio.gcom1.mfsample2/110250.0
-    t=&quot;%6.4f&quot; % (samfac_out)
-    options.meas_rateout.setvalue(t)
-    msg1.configure(text=mode.get())
-    t=&quot;QSO Freq:%4d&quot; % (int(Audio.gcom2.mousefqso),)
-    msg2.configure(text=t)    
-    t=&quot;QSO DF:%4d&quot; % (int(Audio.gcom2.mousedf),)
-    msg3.configure(text=t)
-    if int(Audio.gcom2.mousefqso) != fqso0:
-        itol=5
-        ltol.configure(text='Tol    '+str(500))
-        Audio.gcom2.dftolerance=500
-        fqso0=int(Audio.gcom2.mousefqso)
-
-##    if mode.get()[:4]=='JT65' and (Audio.gcom2.ndecoding&gt;0 or \
-##         (isec&gt;=options.nt1.get() and txminute==0 and \
-##          Audio.gcom2.monitoring==1 and \
-##          Audio.datcom.kkdone!=-99 and Audio.gcom2.ndiskdat!=1)):
-    if mode.get()[:4]=='JT65' and Audio.gcom2.ndecoding&gt;0:
-#Set button bg while decoding
-        bc='#66FFFF'
-        bdecode.configure(bg=bc,activebackground=bc,state=DISABLED)
-    else:
-        bdecode.configure(bg='gray85',activebackground='gray85',state=ACTIVE)
-        g.ndecphase=0
-
-    tx1.configure(bg='white')
-    tx2.configure(bg='white')
-    tx3.configure(bg='white')
-    tx4.configure(bg='white')
-    tx5.configure(bg='white')
-    tx6.configure(bg='white')
-    if len(tx5.get())&gt;13: tx5.configure(bg='pink')
-
-    if tx6.get()[:1]=='#':
-        try:
-            txsnrdb=float(tx6.get()[1:])
-            if txsnrdb&gt;-99.0 and txsnrdb&lt;40.0:
-                Audio.gcom1.txsnrdb=txsnrdb
-                tx6.configure(bg='orange')
-        except:
-            txsnrdb=99.0
-    else:
-        txsnrdb=99.0
-        Audio.gcom1.txsnrdb=txsnrdb
-    if Audio.gcom2.monitoring and not Audio.gcom1.transmitting:
-        bmonitor.configure(bg='green')
-    else:
-        bmonitor.configure(bg='gray85')    
-    if Audio.gcom1.transmitting:
-        nmsg=int(Audio.gcom2.nmsg)
-        t=g.ftnstr(Audio.gcom2.sending)
-        t=&quot;Txing:  &quot;+t[:nmsg]
-        bgcolor='yellow'
-        if Audio.gcom2.sendingsh==1:  bgcolor='#66FFFF'    #Shorthand (lt blue)
-        if Audio.gcom2.sendingsh==-1: bgcolor='red'        #Plain Text
-        if Audio.gcom2.sendingsh==2: bgcolor='pink'        #Test file
-        if txsnrdb&lt;90.0: bgcolor='orange'                  #Simulation mode
-        if Audio.gcom2.ntxnow==1: tx1.configure(bg=bgcolor)
-        elif Audio.gcom2.ntxnow==2: tx2.configure(bg=bgcolor)
-        elif Audio.gcom2.ntxnow==3: tx3.configure(bg=bgcolor)
-        elif Audio.gcom2.ntxnow==4: tx4.configure(bg=bgcolor)
-        elif Audio.gcom2.ntxnow==5: tx5.configure(bg=bgcolor)
-        else: tx6.configure(bg=bgcolor)
-    else:
-        bgcolor='green'
-        t='Receiving'
-    msg8.configure(text=t,bg=bgcolor)
-
-    if Audio.gcom2.ndecdone&gt;0 or g.cmap != cmap0:
-        if Audio.gcom2.ndecdone==1:
-            if isync==-99 or isync==99:
-                isync=isync_save
-                Audio.gcom2.minsigdb=isync
-            try:
-                f=open(appdir+'/decoded.txt',mode='r')
-                lines=f.readlines()
-                f.close()
-            except:
-                lines=&quot;&quot;
-            text.configure(state=NORMAL)
-            for i in range(len(lines)-1):
-                text.insert(END,lines[i])
-            text.see(END)
-            g.ndecphase=1
-
-            if Audio.gcom2.nhispol != -999:
-                npol=int(Audio.gcom2.nhispol)
-                npol=180-npol                           #Reverse sign of x
-                txpol=(npol - 2*g.poloffset + 360) % 180
-                t=&quot;Tx pol: %d  &quot; % txpol
-                if txpol &lt; 45 or txpol &gt; 135:
-                    t=t + 'H'
-                    color='pink'
-                else:
-                    t=t + 'V'
-                    color='yellow'
-                msg6.configure(text=t,bg=color)
-
-#            text.configure(state=DISABLED)
-
-            try:
-                f=open(appdir+'/decoded.ave',mode='r')
-                lines=f.readlines()
-                f.close()
-            except:
-                lines[0]=&quot;&quot;
-                lines[1]=&quot;&quot;
-##            avetext.configure(state=NORMAL)
-##            avetext.delete('1.0',END)
-##            if len(lines)&gt;1:
-##                avetext.insert(END,lines[0])
-##                avetext.insert(END,lines[1])
-###            avetext.configure(state=DISABLED)
-            cleartext()
-            Audio.gcom2.ndecdone=0
-
-        if Audio.gcom2.ndecdone==2:
-            try:
-                f=open(appdir+'/messages.txt',mode='r')
-                lines=f.readlines()
-                f.close()
-            except:
-                lines=&quot;&quot;
-            msgtext.configure(state=NORMAL)
-            msgtext.delete('1.0',END)
-            for i in range(len(lines)):
-                try:
-                    nage=int(lines[i][45:])
-                except:
-                    nage=0
-                lines[i]=lines[i][:45]+'\n'
-                if nage==0: attr='age0'
-                if nage==1: attr='age1'
-                if nage==2: attr='age2'
-                if nage&gt;=3: attr='age3'
-                msgtext.insert(END,lines[i],attr)
-            msgtext.see(END)
-
-# Display Band Map information:
-            try:
-                f=open(appdir+'/bandmap.txt',mode='r')
-                lines=f.readlines()
-                f.close()
-            except:
-                lines=&quot;&quot;
-            bmtext.configure(state=NORMAL)
-            bmtext.delete('1.0',END)
-            g.fc=[&quot;&quot; for i in range(200)]
-            for i in range(len(lines)):
-                for j in range(3):
-                    ka=14*j
-                    kb=ka+12
-                    t=lines[i][ka:kb]
-                    try:
-                        nage=int(t[10:])
-                    except:
-                        nage=0
-                    t=t[:11]+' '
-                    t2=&quot;&quot;
-                    if t[0]!=' ':
-                        fqso=t[:3]
-                        tcall=t[4:10]
-                        cstar=' *'
-                        if worked.has_key(tcall.strip()): cstar='  '
-                        t2=fqso + cstar + tcall + '  '
-                    if j==2:
-                        t=t+'\n'
-                        t2=t2+'\n'
-                    if nage==0: attr='age0'
-                    if nage==1: attr='age1'
-                    if nage==2: attr='age2'
-                    if nage&gt;=3: attr='age3'
-                    bmtext.insert(END,t2,attr)
-                    t=t[:12]
-                    if t!=&quot;            &quot;:
-                        try:
-                            k=int(t[:3])
-                            c=t[4:10]
-                            if c!=NONE:
-                                t=g.fc[k]
-                                if t.find(c+&quot; &quot;) == -1:
-                                    g.fc[k]=g.fc[k] + c + &quot; &quot;
-                        except:
-                            pass
-            bmtext.see(END)
-
-            Audio.gcom2.ndecdone=0
-            if loopall: opennext()
-            nopen=0
-
-        if g.cmap != cmap0:
-            im.putpalette(g.palette)
-            cmap0=g.cmap
-            
-# Save some parameters
-    g.mode=mode.get()
-    Audio.gcom1.txfirst=TxFirst.get()
-    try:
-        Audio.gcom1.samfacin=options.samfacin.get()
-    except:
-        Audio.gcom1.samfacin=1.0
-    try:
-        Audio.gcom1.samfacout=options.samfacout.get()
-    except:
-        Audio.gcom1.samfacout=1.0
-    Audio.gcom2.mycall=(options.MyCall.get()+'            ')[:12]
-    Audio.gcom2.hiscall=(ToRadio.get()+'            ')[:12]
-    Audio.gcom2.hisgrid=(HisGrid.get()+'      ')[:6]
-    Audio.gcom4.addpfx=(options.addpfx.get().lstrip()+'        ')[:8]
-    Audio.gcom2.ntxreq=ntx.get()
-    tx=(tx1,tx2,tx3,tx4,tx5,tx6)
-    Audio.gcom2.txmsg=(tx[ntx.get()-1].get()+'                            ')[:28]
-    Audio.gcom2.mode=(mode.get()+'      ')[:6]
-    Audio.gcom2.nsave=nsave.get()
-    Audio.gcom2.nzap=nzap.get()
-    n=ndebug.get()
-    if ndebug2.get(): n=2
-    Audio.gcom2.ndebug=n
-    Audio.gcom2.minsigdb=isync
-    Audio.gcom2.nclip=iclip
-    Audio.gcom2.nblank=nblank.get()
-    Audio.gcom2.nafc=nafc.get()
-    Audio.gcom2.nfreeze=nfreeze.get()
-    Audio.gcom2.dftolerance=ntol[itol]
-    Audio.gcom2.neme=neme.get()
-    Audio.gcom2.ndepth=ndepth.get()
-    Audio.gcom2.multicast=multicast.get()
-    Audio.gcom2.nxant=options.xant.get()
-    try:
-        Audio.gcom2.idinterval=options.IDinterval.get()
-    except:
-        Audio.gcom2.idinterval=0
-    Audio.gcom2.ntx2=0
-    try:
-        Audio.gcom2.nkeep=options.nkeep.get()
-    except:
-        Audio.gcom2.nkeep=20
-    try:
-        Audio.gcom2.idphi=options.dphi.get()
-    except:
-        Audio.gcom2.idphi=0
-    try:
-        Audio.gcom2.nfa=options.fa.get()
-    except:
-        Audio.gcom2.nfa=100
-    try:
-        Audio.gcom2.nfb=options.fb.get()
-    except:
-        Audio.gcom2.nfa=160
-    try:
-        Audio.gcom2.nfcal=options.fcal.get()
-    except:
-        Audio.gcom2.nfcal=0
-    try:
-        Audio.gcom2.nt1=options.nt1.get()
-    except:
-        Audio.gcom2.nt1=48
-    try:
-        Audio.gcom2.forcefcenter=options.forceFcenter.get()
-    except:
-        Audio.gcom2.forcefcenter=0.0
-    t=options.savedir.get() + \
-        '                                        ' + \
-        '                                        '
-    Audio.gcom2.savedir=t[:80]
-    
-#    Audio.gcom1.rxdelay=float('0'+options.RxDelay.get())
-#    Audio.gcom1.txdelay=float('0'+options.TxDelay.get())
-    if ntx.get()==1 and noshjt65.get()==1: Audio.gcom2.ntx2=1
-    Audio.gcom2.nslim2=isync-4
-    try:
-        Audio.gcom2.nport=int(options.PttPort.get())
-    except:
-        Audio.gcom2.nport=0
-    Audio.gcom2.pttport=(options.PttPort.get() + '            ')[:12]
-    if altmsg: tx6alt=tx6.get()    
-    ldate.after(100,update)                       # Queue up the next update
-    
-#------------------------------------------------------ Top level frame
-frame = Frame(root)
-
-#------------------------------------------------------ Menu Bar
-mbar = Frame(frame)
-mbar.pack(fill = X)
-
-#------------------------------------------------------ File Menu
-filebutton = Menubutton(mbar, text = 'File')
-filebutton.pack(side = LEFT)
-filemenu = Menu(filebutton, tearoff=0)
-filebutton['menu'] = filemenu
-filemenu.add('command', label = 'Open', command = openfile, \
-             accelerator='Ctrl+O')
-filemenu.add('command', label = 'Open next in directory', command = opennext, \
-             accelerator='F6')
-filemenu.add('command', label = 'Decode remaining files in directory', \
-             command = decodeall, accelerator='Shift+F6')
-filemenu.add_separator()
-filemenu.add('command', label = 'Delete all *.tf2 files in SaveDir', \
-             command = delwav)
-filemenu.add('command', label = 'Erase Band Map and Messages', command = clr_all)
-filemenu.add('command', label = 'Erase ALL65.TXT', command = del_all)
-filemenu.add_separator()
-filemenu.add('command', label = 'Exit', command = quit)
-
-#------------------------------------------------------ Setup menu
-setupbutton = Menubutton(mbar, text = 'Setup')
-setupbutton.pack(side = LEFT)
-setupmenu = Menu(setupbutton, tearoff=0)
-setupbutton['menu'] = setupmenu
-setupmenu.add('command', label = 'Options', command = options1, \
-              accelerator='F2')
-setupmenu.add_separator()
-setupmenu.add('command', label = 'Generate messages for test tones', command=testmsgs)
-setupmenu.add('command', label = 'Find Delta Phi', command=delta_phi)
-setupmenu.add_separator()
-setupmenu.add_checkbutton(label = 'F4 sets Tx6',variable=kb8rq)
-setupmenu.add_checkbutton(label = 'Double-click on callsign sets TxFirst',
-                          variable=setseq)
-setupmenu.add_checkbutton(label = 'GenStdMsgs sets Tx1',variable=k2txb)
-setupmenu.add_separator()
-setupmenu.add_radiobutton(label = 'Input data multicast', variable=multicast, \
-            value=1)
-setupmenu.add_radiobutton(label = 'Input data unicast', variable=multicast, \
-            value=0)
-setupmenu.add_separator()
-setupmenu.add_checkbutton(label = 'Enable diagnostics',variable=ndebug)
-setupmenu.add_checkbutton(label = 'Verbose diagnostics',variable=ndebug2)
-
-#------------------------------------------------------ View menu
-viewbutton=Menubutton(mbar,text='View')
-viewbutton.pack(side=LEFT)
-viewmenu=Menu(viewbutton,tearoff=0)
-viewbutton['menu']=viewmenu
-viewmenu.add('command', label = 'SpecJT', command = showspecjt, \
-             accelerator='F10')
-viewmenu.add('command', label = 'Messages', command = messages)
-viewmenu.add('command', label = 'Band Map', command = bandmap)
-viewmenu.add('command', label = 'Astronomical data', command = astro1, \
-             accelerator='Shift+F10')
-
-#------------------------------------------------------ Mode menu
-modebutton = Menubutton(mbar, text = 'Mode')
-modebutton.pack(side = LEFT)
-modemenu = Menu(modebutton, tearoff=0)
-modebutton['menu'] = modemenu
-
-# To enable menu item 0:
-# modemenu.entryconfig(0,state=NORMAL)
-# Can use the following to retrieve the state:
-# state=modemenu.entrycget(0,&quot;state&quot;)
-
-#modemenu.add_radiobutton(label = 'JT65A', variable=mode, command = ModeJT65A, \
-#            state=DISABLED, accelerator='F8')
-modemenu.add_radiobutton(label = 'JT65B', variable=mode, command = ModeJT65B, \
-                         accelerator='Shift+F8')
-#modemenu.add_radiobutton(label = 'JT65C', variable=mode, command = ModeJT65C, \
-#            state=DISABLED, accelerator='Ctrl+F8')
-modemenu.add_radiobutton(label = 'Measure', variable=mode)
-modemenu.add_radiobutton(label = 'Pulsar', variable=mode,state=DISABLED)
-
-#------------------------------------------------------ Decode menu
-decodebutton = Menubutton(mbar, text = 'Decode')
-decodebutton.pack(side = LEFT)
-decodemenu = Menu(decodebutton, tearoff=0)
-decodebutton['menu'] = decodemenu
-decodemenu.add_checkbutton(label='Only EME calls',variable=neme)
-decodemenu.add_checkbutton(label='No Shorthands if Tx 1',variable=noshjt65)
-decodemenu.add_separator()
-decodemenu.add_radiobutton(label = 'No Deep Search',
-                                variable=ndepth, value=0)
-decodemenu.add_radiobutton(label = 'Normal Deep Search',
-                                variable=ndepth, value=1)
-decodemenu.add_radiobutton(label = 'Aggressive Deep Search',
-                                variable=ndepth, value=2)
-#decodemenu.add_radiobutton(label ='Include Average in Aggressive Deep Search',
-#                                variable=ndepth, value=3)
-
-#------------------------------------------------------ Save menu
-savebutton = Menubutton(mbar, text = 'Save')
-savebutton.pack(side = LEFT)
-savemenu = Menu(savebutton, tearoff=1)
-savebutton['menu'] = savemenu
-nsave=IntVar()
-savemenu.add_radiobutton(label = 'None', variable=nsave,value=0)
-savemenu.add_radiobutton(label = 'Save all', variable=nsave,value=1)
-nsave.set(0)
-
-#------------------------------------------------------ Band menu
-bandbutton = Menubutton(mbar, text = 'Band')
-bandbutton.pack(side = LEFT)
-bandmenu = Menu(bandbutton, tearoff=1)
-bandbutton['menu'] = bandmenu
-nfreq=IntVar()
-bandmenu.add_radiobutton(label = '50', variable=nfreq,value=50)
-bandmenu.add_radiobutton(label = '144', variable=nfreq,value=144)
-bandmenu.add_radiobutton(label = '222', variable=nfreq,value=222)
-bandmenu.add_radiobutton(label = '432', variable=nfreq,value=432)
-bandmenu.add_radiobutton(label = '1296', variable=nfreq,value=1296)
-bandmenu.add_radiobutton(label = '2304', variable=nfreq,value=2304)
-nfreq.set(144)
-#------------------------------------------------------ Help menu
-helpbutton = Menubutton(mbar, text = 'Help')
-helpbutton.pack(side = LEFT)
-helpmenu = Menu(helpbutton, tearoff=0)
-helpbutton['menu'] = helpmenu
-helpmenu.add('command', label = 'Keyboard shortcuts', command = shortcuts, \
-             accelerator='F1')
-helpmenu.add('command', label = 'Special mouse commands', \
-             command = mouse_commands, accelerator='Shift+F1')
-helpmenu.add('command', label = 'What message to send?', \
-             command = what2send, accelerator='F5')
-helpmenu.add('command', label = 'Available suffixes and add-on prefixes', \
-             command = prefixes)
-helpmenu.add('command', label = 'About MAP65', command = about, \
-             accelerator='Ctrl+F1')
-
-#------------------------------------------------------ Label above text
-iframe2 = Frame(frame, bd=1, relief=FLAT,height=15)
-lab2=Label(iframe2, text='Freq      DF    Pol     UTC       DT      dB')
-lab2.place(x=3,y=6, anchor='w')
-lab7=Label(iframe2,text='F3',fg='gray85')
-lab7.place(x=495,y=6, anchor=CENTER)
-iframe2.pack(expand=1, fill=BOTH, padx=4)
-
-#-------------------------------------------------------- Decoded text
-iframe4 = Frame(frame, bd=2, relief=SUNKEN)
-text=Text(iframe4, height=16, width=65)
-text.bind('&lt;Double-Button-1&gt;',dbl_click_text)
-text.bind('&lt;Double-Button-3&gt;',dbl_click3_text)
-text.bind('&lt;Key&gt;',textkey)
-
-root.bind_all('&lt;F1&gt;', shortcuts)
-root.bind_all('&lt;Shift-F1&gt;', mouse_commands)
-root.bind_all('&lt;Control-F1&gt;', about)
-root.bind_all('&lt;F2&gt;', options1)
-root.bind_all('&lt;F3&gt;', txmute)
-root.bind_all('&lt;F4&gt;', clrToRadio)
-root.bind_all('&lt;F5&gt;', what2send)
-root.bind_all('&lt;F6&gt;', opennext)
-root.bind_all('&lt;Shift-F6&gt;', decodeall)
-#root.bind_all('&lt;F8&gt;', ModeJT65A)
-root.bind_all('&lt;Shift-F8&gt;', ModeJT65B)
-#root.bind_all('&lt;Control-F8&gt;', ModeJT65C)
-root.bind_all('&lt;F10&gt;', showspecjt)
-root.bind_all('&lt;Shift-F10&gt;', astro1)
-root.bind_all('&lt;F11&gt;',left_arrow)
-root.bind_all('&lt;Shift-F11&gt;',dec_fqso)
-root.bind_all('&lt;F12&gt;',right_arrow)
-root.bind_all('&lt;Shift-F12&gt;',inc_fqso)
-root.bind_all('&lt;Alt-Key-1&gt;',btx1)
-root.bind_all('&lt;Alt-Key-2&gt;',btx2)
-root.bind_all('&lt;Alt-Key-3&gt;',btx3)
-root.bind_all('&lt;Alt-Key-4&gt;',btx4)
-root.bind_all('&lt;Alt-Key-5&gt;',btx5)
-root.bind_all('&lt;Alt-Key-6&gt;',btx6)
-
-root.bind_all('&lt;Alt-a&gt;',toggleauto)
-root.bind_all('&lt;Alt-A&gt;',toggleauto)
-##root.bind_all('&lt;Alt-c&gt;',clear_avg)
-##root.bind_all('&lt;Alt-C&gt;',clear_avg)
-root.bind_all('&lt;Alt-d&gt;',decode)
-root.bind_all('&lt;Alt-D&gt;',decode)
-root.bind_all('&lt;Alt-e&gt;',erase)
-root.bind_all('&lt;Alt-E&gt;',erase)
-root.bind_all('&lt;Alt-f&gt;',toggle_freeze)
-root.bind_all('&lt;Alt-F&gt;',toggle_freeze)
-root.bind_all('&lt;Alt-g&gt;',GenStdMsgs)
-root.bind_all('&lt;Alt-G&gt;',GenStdMsgs)
-root.bind_all('&lt;Control-g&gt;', GenAltMsgs)
-root.bind_all('&lt;Control-G&gt;', GenAltMsgs)
-root.bind_all('&lt;Alt-i&gt;',decode_include)
-root.bind_all('&lt;Alt-I&gt;',decode_include)
-root.bind_all('&lt;Alt-l&gt;',lookup)
-root.bind_all('&lt;Alt-L&gt;',lookup)
-root.bind_all('&lt;Alt-m&gt;',monitor)
-root.bind_all('&lt;Alt-M&gt;',monitor)
-root.bind_all('&lt;Alt-o&gt;',txstop)
-root.bind_all('&lt;Alt-O&gt;',txstop)
-root.bind_all('&lt;Control-o&gt;',openfile)
-root.bind_all('&lt;Control-O&gt;',openfile)
-root.bind_all('&lt;Alt-q&gt;',logqso)
-root.bind_all('&lt;Alt-Q&gt;',logqso)
-root.bind_all('&lt;Alt-s&gt;',set_ftx)
-root.bind_all('&lt;Alt-S&gt;',set_ftx)
-root.bind_all('&lt;Alt-x&gt;',decode_exclude)
-root.bind_all('&lt;Alt-X&gt;',decode_exclude)
-root.bind_all('&lt;Alt-z&gt;',toggle_zap)
-root.bind_all('&lt;Alt-Z&gt;',toggle_zap)
-root.bind_all('&lt;Control-l&gt;',lookup_gen)
-root.bind_all('&lt;Control-L&gt;',lookup_gen)
-
-text.pack(side=LEFT, fill=X, padx=1)
-sb = Scrollbar(iframe4, orient=VERTICAL, command=text.yview)
-sb.pack(side=LEFT, fill=Y)
-text.configure(yscrollcommand=sb.set)
-
-astrotext_font='&quot;Lucida Console&quot; 16'
-astrotext=Text(iframe4, bg=&quot;#66FFFF&quot;,height=10,width=11,font=astrotext_font)
-astrotext.pack(side=LEFT, fill=BOTH, padx=4)
-g2font=astrotext_font
-if g2font!=&quot;&quot;: g.g2font=g2font
-iframe4.pack(expand=1, fill=X, padx=4)
-
-##iframe4b = Frame(frame, bd=2, relief=SUNKEN)
-##avetext=Text(iframe4b, height=2, width=65)
-##avetext.bind('&lt;Double-Button-1&gt;',dbl_click_ave)
-###avetext.bind('&lt;Double-Button-3&gt;',dbl_click_ave)
-##avetext.bind('&lt;Key&gt;',avetextkey)
-##avetext.pack(side=LEFT, fill=X, padx=1)
-##iframe4b.pack(expand=1, fill=X, padx=4)
-
-#------------------------------------------------------- Button Bar
-iframe4c = Frame(frame, bd=1, relief=SUNKEN)
-blogqso=Button(iframe4c, text='Log QSO',underline=4,command=logqso,
-                padx=1,pady=1)
-bstop=Button(iframe4c, text='Stop',command=stopmon,
-                padx=1,pady=1)
-bmonitor=Button(iframe4c, text='Monitor',underline=0,command=monitor,
-                padx=1,pady=1)
-bdecode=Button(iframe4c, text='Decode',underline=0,command=decode,
-                padx=1,pady=1)
-berase=Button(iframe4c, text='Erase',underline=0,command=erase,
-                padx=1,pady=1)
-##bclravg=Button(iframe4c, text='Clear Avg',underline=0,command=clear_avg,
-##                padx=1,pady=1)
-##binclude=Button(iframe4c, text='Include',underline=0,
-##                command=decode_include,padx=1,pady=1)
-##bexclude=Button(iframe4c, text='Exclude',underline=1,
-##                command=decode_exclude,padx=1,pady=1)
-btxstop=Button(iframe4c,text='TxStop',underline=4,command=txstop,
-                padx=1,pady=1)
-
-blogqso.pack(side=LEFT,expand=1,fill=X)
-bstop.pack(side=LEFT,expand=1,fill=X)
-bmonitor.pack(side=LEFT,expand=1,fill=X)
-bdecode.pack(side=LEFT,expand=1,fill=X)
-berase.pack(side=LEFT,expand=1,fill=X)
-##bclravg.pack(side=LEFT,expand=1,fill=X)
-##binclude.pack(side=LEFT,expand=1,fill=X)
-##bexclude.pack(side=LEFT,expand=1,fill=X)
-btxstop.pack(side=LEFT,expand=1,fill=X)
-iframe4c.pack(expand=1, fill=X, padx=4)
-
-#-----------------------------------------------------General control area
-iframe5 = Frame(frame, bd=1, relief=FLAT,height=180)
-
-#------------------------------------------------------ &quot;Other station&quot; info
-f5a=Frame(iframe5,height=170,bd=2,relief=GROOVE)
-labToRadio=Label(f5a,text='To radio:', width=9, relief=FLAT)
-labToRadio.grid(column=0,row=0)
-ToRadio=Entry(f5a,width=9)
-ToRadio.insert(0,'W8WN')
-ToRadio.grid(column=1,row=0,pady=3)
-bLookup=Button(f5a, text='Lookup',underline=0,command=lookup,padx=1,pady=1)
-bLookup.grid(column=2,row=0,sticky='EW',padx=4)
-labGrid=Label(f5a,text='Grid:', width=9, relief=FLAT)
-labGrid.grid(column=0,row=1)
-HisGrid=Entry(f5a,width=9)
-HisGrid.grid(column=1,row=1,pady=1)
-bAdd=Button(f5a, text='Add',command=addtodb,padx=1,pady=1)
-bAdd.grid(column=2,row=1,sticky='EW',padx=4)
-labAz=Label(f5a,text='Az 257  El 15',width=11)
-labAz.grid(column=1,row=2)
-labDist=Label(f5a,text='16753 km')
-labDist.grid(column=2,row=2)
-
-#------------------------------------------------------ Date and Time
-ldate=Label(f5a, bg='black', fg='yellow', width=11, bd=4,
-        text='2005 Apr 22\n01:23:45', relief=RIDGE,
-        justify=CENTER, font=(font1,16))
-ldate.grid(column=0,columnspan=3,row=3,rowspan=2,pady=2)
-f5a.pack(side=LEFT,expand=1,fill=BOTH)
-
-#------------------------------------------------------ Receiving parameters
-f5b=Frame(iframe5,bd=2,relief=GROOVE)
-nzap=IntVar()
-bblank=Checkbutton(f5b,text='NB',justify=RIGHT,variable=nblank)
-bblank.grid(column=0,row=0,padx=2,pady=20,sticky='EW')
-ltol=Label(f5b, bg='white', fg='black', text='Tol    400', width=8, relief=RIDGE)
-ltol.grid(column=0,row=1,padx=2,pady=1,sticky='EW')
-Widget.bind(ltol,'&lt;Button-1&gt;',inctol)
-Widget.bind(ltol,'&lt;Button-3&gt;',dectol)
-ldsec=Label(f5b, bg='white', fg='black', text='Dsec  0.0', width=8, relief=RIDGE)
-ldsec.grid(column=0,row=2,ipadx=3,padx=2,pady=5,sticky='EW')
-Widget.bind(ldsec,'&lt;Button-1&gt;',incdsec)
-Widget.bind(ldsec,'&lt;Button-3&gt;',decdsec)
-
-f5b.pack(side=LEFT,expand=1,fill=BOTH)
-
-#------------------------------------------------------ Tx params and msgs
-f5c=Frame(iframe5,bd=2,relief=GROOVE)
-txfirst=Checkbutton(f5c,text='Tx First',justify=RIGHT,variable=TxFirst)
-f5c2=Frame(f5c,bd=0)
-ftx=Button(f5c,text='Set Tx Freq',underline=0,command=set_ftx,
-            padx=1,pady=1)
-genmsg=Button(f5c,text='GenStdMsgs',underline=0,command=GenStdMsgs,
-            padx=1,pady=1)
-auto=Button(f5c,text='Auto is Off',underline=0,command=toggleauto,
-            padx=1,pady=1)
-auto.focus_set()
-
-txfirst.grid(column=0,row=0,sticky='W',padx=4)
-f5c2.grid(column=0,row=1,sticky='W',padx=4)
-#sked.grid(column=0,row=3,sticky='W',padx=4)
-ftx.grid(column=0,row=2,sticky='EW',padx=4)
-genmsg.grid(column=0,row=4,sticky='W',padx=4)
-auto.grid(column=0,row=5,sticky='EW',padx=4)
-
-ntx=IntVar()
-tx1=Entry(f5c,width=24)
-rb1=Radiobutton(f5c,value=1,variable=ntx)
-b1=Button(f5c, text='Tx1',underline=2,command=btx1,padx=1,pady=1)
-tx1.grid(column=1,row=0)
-rb1.grid(column=2,row=0)
-b1.grid(column=3,row=0)
-
-tx2=Entry(f5c,width=24)
-rb2=Radiobutton(f5c,value=2,variable=ntx)
-b2=Button(f5c, text='Tx2',underline=2,command=btx2,padx=1,pady=1)
-tx2.grid(column=1,row=1)
-rb2.grid(column=2,row=1)
-b2.grid(column=3,row=1)
-
-tx3=Entry(f5c,width=24)
-rb3=Radiobutton(f5c,value=3,variable=ntx)
-b3=Button(f5c, text='Tx3',underline=2,command=btx3,padx=1,pady=1)
-tx3.grid(column=1,row=2)
-rb3.grid(column=2,row=2)
-b3.grid(column=3,row=2)
-
-tx4=Entry(f5c,width=24)
-rb4=Radiobutton(f5c,value=4,variable=ntx)
-b4=Button(f5c, text='Tx4',underline=2,command=btx4,padx=1,pady=1)
-tx4.grid(column=1,row=3)
-rb4.grid(column=2,row=3)
-b4.grid(column=3,row=3)
-
-tx5=Entry(f5c,width=24)
-rb5=Radiobutton(f5c,value=5,variable=ntx)
-b5=Button(f5c, text='Tx5',underline=2,command=btx5,padx=1,pady=1)
-tx5.grid(column=1,row=4)
-rb5.grid(column=2,row=4)
-b5.grid(column=3,row=4)
-
-tx6=Entry(f5c,width=24)
-rb6=Radiobutton(f5c,value=6,variable=ntx)
-b6=Button(f5c, text='Tx6',underline=2,command=btx6,padx=1,pady=1)
-tx6.grid(column=1,row=5)
-rb6.grid(column=2,row=5)
-b6.grid(column=3,row=5)
-
-f5c.pack(side=LEFT,expand=1,fill=BOTH)
-iframe5.pack(expand=1, fill=X, padx=4)
-
-#------------------------------------------------------------ Status Bar
-iframe6 = Frame(frame, bd=1, relief=SUNKEN)
-msg1=Message(iframe6, text=&quot;Message #2&quot;, width=300,relief=SUNKEN)
-msg1.pack(side=LEFT, fill=X, padx=1)
-msg2=Message(iframe6,width=300,relief=SUNKEN)
-msg2.pack(side=LEFT, fill=X, padx=1)
-msg3=Message(iframe6, text=&quot;&quot;, width=300,relief=SUNKEN)
-msg3.pack(side=LEFT, fill=X, padx=1)
-msg4=Message(iframe6, text=&quot;&quot;, width=300,relief=SUNKEN)
-msg4.pack(side=LEFT, fill=X, padx=1)
-msg5=Message(iframe6, text=&quot;&quot;, width=300,relief=SUNKEN)
-msg5.pack(side=LEFT, fill=X, padx=1)
-msg6=Message(iframe6, text=&quot;&quot;, width=300,relief=SUNKEN)
-msg6.pack(side=LEFT, fill=X, padx=1)
-##msg7=Message(iframe6, text=&quot;&quot;, width=300,relief=SUNKEN)
-##msg7.pack(side=LEFT, fill=X, padx=1)
-msg8=Message(iframe6, text='                        ', width=300,relief=SUNKEN)
-msg8.pack(side=RIGHT, fill=X, padx=1)
-iframe6.pack(expand=1, fill=X, padx=4)
-frame.pack()
-
-# Create &quot;worked&quot;, a dictionary of all calls in WSJT.LOG
-try:
-    f=open(appdir+'/WSJT.LOG','r')
-    s=f.readlines()
-except:
-    print 'Error opening WSJT.LOG'
-    s=&quot;&quot;
-f.close()
-tcall=&quot;&quot;
-for i in range(len(s)):
-    tcall=s[i].split(',',3)[2]
-    worked[tcall]=1
-
-ldate.after(100,update)
-lauto=0
-isync=1
-ntx.set(1)
-ndepth.set(1)
-import options
-ModeJT65B()
-lookup()
-balloon.unbind(ToRadio)
-g.astro_geom0=&quot;+0+0&quot;
-Audio.gcom1.mute=0
-
-#---------------------------------------------------------- Process INI file
-try:
-    f=open(appdir+'/MAP65.INI',mode='r')
-    params=f.readlines()
-except:
-    params=&quot;&quot;
-    if g.Win32:
-        options.PttPort.set(&quot;0&quot;)
-    else:
-        options.PttPort.set(&quot;/dev/ttyS0&quot;)
-    Audio.gcom2.nport=0
-
-try:
-    for i in range(len(params)):
-        key,value=params[i].split()
-        if   key == 'MAP65Geometry': root.geometry(value)
-        elif key == 'BMGeometry': bm_geom=value
-        elif key == 'BM2Geometry': bm2_geom=value
-        elif key == 'Mode':
-            mode.set(value)
-            if value=='JT65A':
-                ModeJT65A()
-            elif value=='JT65B':
-                ModeJT65B()
-            elif value=='JT65C':
-                ModeJT65C()
-        elif key == 'MyCall': options.MyCall.set(value)
-        elif key == 'MyGrid': options.MyGrid.set(value)
-        elif key == 'HisCall':
-            hiscall=value
-            if hiscall==&quot;______&quot;: hiscall=&quot;&quot;
-            ToRadio.delete(0,END)
-            ToRadio.insert(0,hiscall)
-        elif key == 'HisGrid':
-            hisgrid=value
-            if hisgrid == &quot;XX00xx&quot;:
-                lookup()
-            HisGrid.delete(0,END)
-            HisGrid.insert(0,hisgrid)
-#        elif key == 'RxDelay': options.RxDelay.set(value)
-#        elif key == 'TxDelay': options.TxDelay.set(value)
-        elif key == 'IDinterval': options.IDinterval.set(value)
-        elif key == 'PttPort':
-            try:
-                options.PttPort.set(value)
-                try:
-                    Audio.gcom2.nport=int(options.PttPort.get())
-                except:
-                    Audio.gcom2.nport=0
-            except:
-                if g.Win32:
-                    options.PttPort.set(&quot;0&quot;)
-                else:
-                    options.PttPort.set(&quot;/dev/ttyS0&quot;)
-                Audio.gcom2.nport=0
-            Audio.gcom2.pttport=(options.PttPort.get()+'            ')[:12]
-        elif key == 'Mileskm': options.mileskm.set(value)
-        elif key == 'Xant': options.xant.set(value)
-        elif key == 'AudioOut':
-            try:
-                g.ndevout.set(value)
-            except:
-                g.ndevout.set(0)
-            g.DevoutName.set(value)
-            options.DevoutName.set(value)
-            Audio.gcom1.devout_name=(options.DevoutName.get()+'            ')[:12]
-        elif key == 'SamFacOut': options.samfacout.set(value)
-        elif key == 'AddPrefix': options.addpfx.set(value.replace(&quot;_&quot;,&quot; &quot;).lstrip())
-        elif key == 'AuxRA': options.auxra.set(value)
-        elif key == 'AuxDEC': options.auxdec.set(value)
-        
-        elif key == 'nkeep': options.nkeep.set(value)
-        elif key == 'fa': options.fa.set(value)
-        elif key == 'fb': options.fb.set(value)
-        elif key == 'fcal': options.fcal.set(value)
-        elif key == 'Nt1': options.nt1.set(value)
-        elif key == 'ForceFcenter': options.forceFcenter.set(value)
-        elif key == 'dphi': options.dphi.set(value)
-        elif key == 'SaveDir': options.savedir.set(value.replace(&quot;#&quot;,&quot; &quot;))
-        elif key == 'AzElDir': options.azeldir.set(value.replace(&quot;#&quot;,&quot; &quot;))
-        elif key == 'TxFirst': TxFirst.set(value)
-        elif key == 'KB8RQ': kb8rq.set(value)
-        elif key == 'K2TXB': k2txb.set(value)
-        elif key == 'SetSeq': setseq.set(value)
-        elif key == 'Nsave': nsave.set(value)
-        elif key == 'Band': nfreq.set(value)
-        elif key == 'Sync': isync=int(value)
-        elif key == 'Clip': iclip=int(value)
-        elif key == 'Zap': nzap.set(value)
-        elif key == 'NB': nblank.set(value)
-        elif key == 'NAFC': nafc.set(value)
-#        elif key == 'Sked': nsked.set(value)
-        elif key == 'NoSh441': nosh441.set(value)
-        elif key == 'NoShJT65': noshjt65.set(value)
-        elif key == 'NEME': neme.set(value)
-        elif key == 'NDepth': ndepth.set(value)
-        elif key == 'Multicast': multicast.set(value)
-        elif key == 'Debug': ndebug.set(value)
-        elif key == 'Debug2': ndebug2.set(value)
-        elif key == 'HisCall':
-            Audio.gcom2.hiscall=(value+'            ')[:12]
-            ToRadio.delete(0,99)
-            ToRadio.insert(0,value)
-            lookup()                       #Maybe should save HisGrid, instead?
-        elif key == 'MRUDir': mrudir=value.replace(&quot;#&quot;,&quot; &quot;)
-        elif key == 'AstroGeometry': g.astro_geom0 =value
-        else: pass
-except:
-    print 'Error reading MAP65.INI, continuing with defaults.'
-    print key,value
-
-g.mode=mode.get()
-Audio.gcom2.appdir=(appdir+'                                                                                          ')[:80]
-Audio.gcom2.azeldir=(options.azeldir.get()+'                                                                                          ')[:80]
-Audio.gcom2.ndepth=ndepth.get()
-Audio.gcom2.multicast=multicast.get()
-f=open(appdir+'/tmp26.txt','w')
-f.truncate(0)
-f.close
-Audio.ftn_init()
-GenStdMsgs()
-Audio.gcom4.addpfx=(options.addpfx.get().lstrip()+'        ')[:8]
-Audio.gcom2.mousefqso=125
-Audio.gcom2.nhispol=-999
-monitor()
-first=1
-if g.Win32: root.iconbitmap(&quot;wsjt.ico&quot;)
-root.title('  MAP65     by K1JT')
-messages()
-bandmap()
-import astro
-import specjt
-
-# SpecJT has a &quot;mainloop&quot;, so it does not return until terminated.
-#root.mainloop()   #Superseded by mainloop in SpecJT
-
-# Clean up and save user options before terminating
-f=open(appdir+'/MAP65.INI',mode='a')
-root_geom=root_geom[root_geom.index(&quot;+&quot;):]
-f.write(&quot;MAP65Geometry &quot; + root_geom + &quot;\n&quot;)
-bm_geom=bm_geom[bm_geom.index(&quot;+&quot;):]
-f.write(&quot;BMGeometry &quot; + bm_geom + &quot;\n&quot;)
-bm2_geom=bm2_geom[bm2_geom.index(&quot;+&quot;):]
-f.write(&quot;BM2Geometry &quot; + bm2_geom + &quot;\n&quot;)
-f.write(&quot;Mode &quot; + g.mode + &quot;\n&quot;)
-f.write(&quot;MyCall &quot; + options.MyCall.get() + &quot;\n&quot;)
-f.write(&quot;MyGrid &quot; + options.MyGrid.get() + &quot;\n&quot;)
-t=g.ftnstr(Audio.gcom2.hiscall)
-if t[:1]==&quot; &quot;: t=&quot;______&quot;
-f.write(&quot;HisCall &quot; + t + &quot;\n&quot;)
-t=g.ftnstr(Audio.gcom2.hisgrid)
-if t==&quot;      &quot;: t=&quot;XX00xx&quot;
-f.write(&quot;HisGrid &quot; + t + &quot;\n&quot;)
-#f.write(&quot;RxDelay &quot; + str(options.RxDelay.get()) + &quot;\n&quot;)
-#f.write(&quot;TxDelay &quot; + str(options.TxDelay.get()) + &quot;\n&quot;)
-f.write(&quot;IDinterval &quot; + str(options.IDinterval.get()) + &quot;\n&quot;)
-f.write(&quot;PttPort &quot; + str(options.PttPort.get()) + &quot;\n&quot;)
-f.write(&quot;Mileskm &quot; + str(options.mileskm.get()) + &quot;\n&quot;)
-f.write(&quot;Xant &quot; + str(options.xant.get()) + &quot;\n&quot;)
-f.write(&quot;AudioOut &quot; + options.DevoutName.get() + &quot;\n&quot;)
-f.write(&quot;SamFacOut &quot; + str(options.samfacout.get()) + &quot;\n&quot;)
-if options.addpfx.get().lstrip()==&quot;&quot;: options.addpfx.set(&quot;_&quot;)
-f.write(&quot;AddPrefix &quot; + options.addpfx.get().lstrip() + &quot;\n&quot;)
-if options.auxra.get()==&quot;&quot;: options.auxra.set(&quot;0&quot;)
-if options.auxdec.get()==&quot;&quot;: options.auxdec.set(&quot;0&quot;)
-f.write(&quot;AuxRA &quot; + options.auxra.get() + &quot;\n&quot;)
-f.write(&quot;AuxDEC &quot; + options.auxdec.get() + &quot;\n&quot;)
-f.write(&quot;nkeep &quot; + str(options.nkeep.get()) + &quot;\n&quot;)
-f.write(&quot;dphi &quot; + str(options.dphi.get()) + &quot;\n&quot;)
-f.write(&quot;fa &quot; + str(options.fa.get()) + &quot;\n&quot;)
-f.write(&quot;fb &quot; + str(options.fb.get()) + &quot;\n&quot;)
-f.write(&quot;fcal &quot; + str(options.fcal.get()) + &quot;\n&quot;)
-f.write(&quot;Nt1 &quot; + str(options.nt1.get()) + &quot;\n&quot;)
-f.write(&quot;ForceFcenter &quot; + str(options.forceFcenter.get()) + &quot;\n&quot;)
-savedir2=options.savedir.get().replace(&quot; &quot;,&quot;#&quot;)
-azeldir2=options.azeldir.get().replace(&quot; &quot;,&quot;#&quot;)
-f.write(&quot;SaveDir &quot; + str(savedir2) + &quot;\n&quot;)
-f.write(&quot;AzElDir &quot; + str(azeldir2) + &quot;\n&quot;)
-f.write(&quot;TxFirst &quot; + str(TxFirst.get()) + &quot;\n&quot;)
-f.write(&quot;KB8RQ &quot; + str(kb8rq.get()) + &quot;\n&quot;)
-f.write(&quot;K2TXB &quot; + str(k2txb.get()) + &quot;\n&quot;)
-f.write(&quot;SetSeq &quot; + str(setseq.get()) + &quot;\n&quot;)
-f.write(&quot;Nsave &quot; + str(nsave.get()) + &quot;\n&quot;)
-f.write(&quot;Band &quot; + str(nfreq.get()) + &quot;\n&quot;)
-f.write(&quot;Sync &quot; + str(isync) + &quot;\n&quot;)
-f.write(&quot;Clip &quot; + str(iclip) + &quot;\n&quot;)
-f.write(&quot;Zap &quot; + str(nzap.get()) + &quot;\n&quot;)
-f.write(&quot;NB &quot; + str(nblank.get()) + &quot;\n&quot;)
-f.write(&quot;NAFC &quot; + str(nafc.get()) + &quot;\n&quot;)
-f.write(&quot;NoSh441 &quot; + str(nosh441.get()) + &quot;\n&quot;)
-f.write(&quot;NoShJT65 &quot; + str(noshjt65.get()) + &quot;\n&quot;)
-f.write(&quot;NEME &quot; + str(neme.get()) + &quot;\n&quot;)
-f.write(&quot;NDepth &quot; + str(ndepth.get()) + &quot;\n&quot;)
-f.write(&quot;Multicast &quot; + str(multicast.get()) + &quot;\n&quot;)
-f.write(&quot;Debug &quot; + str(ndebug.get()) + &quot;\n&quot;)
-f.write(&quot;Debug2 &quot; + str(ndebug2.get()) + &quot;\n&quot;)
-mrudir2=mrudir.replace(&quot; &quot;,&quot;#&quot;)
-f.write(&quot;MRUDir &quot; + mrudir2 + &quot;\n&quot;)
-if g.astro_geom[:7]==&quot;200x200&quot;: g.astro_geom=&quot;316x373&quot; + g.astro_geom[7:]
-f.write(&quot;AstroGeometry &quot; + g.astro_geom + &quot;\n&quot;)
-f.close()
-
-Audio.ftn_quit()
-Audio.gcom1.ngo=0                         #Terminate audio streams
-Audio.gcom2.lauto=0
-Audio.gcom1.txok=0
-time.sleep(0.5)

Added: branches/map65/map65.rc
===================================================================
--- branches/map65/map65.rc	                        (rev 0)
+++ branches/map65/map65.rc	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1 @@
+IDI_ICON1       ICON    DISCARDABLE     &quot;wsjt.ico&quot;

Deleted: branches/map65/map65a.f90
===================================================================
--- branches/map65/map65a.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/map65a.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,411 +0,0 @@
-subroutine map65a(newdat)
-
-!  Processes timf2 data from Linrad to find and decode JT65 signals.
-
-  parameter (MAXMSG=1000)            !Size of decoded message list
-  real tavg(-50:50)                  !Temp for finding local base level
-  real base(4)                       !Local basel level at 4 pol'ns
-  real tmp (200)                     !Temp storage for pctile sorting
-  real sig(MAXMSG,30)                !Parameters of detected signals
-  real a(5)
-  character*22 msg(MAXMSG)
-  character*3 shmsg0(4)
-  integer indx(MAXMSG),nsiz(MAXMSG)
-  logical done(MAXMSG)
-  character decoded*22,blank*22
-  include 'spcom.f90'
-  real short(3,NFFT)                 !SNR dt ipol for potential shorthands
-  real qphi(12)
-  include 'gcom2.f90'
-  include 'datcom.f90'
-  common/c3com/ mcall3a
-  
-  data blank/'                      '/
-  data shmsg0/'ATT','RO ','RRR','73 '/
-  data nfile/0/,nutc0/-999/,nid/0/,ip000/1/,ip001/1/,mousefqso0/-999/
-  save
-
-  mcall3a=mcall3
-  if(mcall3.eq.1) mcall3=0
-  if(mousefqso.ne.mousefqso0 .and. nagain.eq.1) newspec=2
-  mousefqso0=mousefqso
-  nfoffset=nint(1000*(fcenter-144.125d0))
-  mfqso=mousefqso - nfoffset
-
-  rewind 11
-  rewind 12
-  if(nrw26.ne.0) then
-     endfile (26)              !Compiler bug?  Don't write &quot;end file 26&quot; !!!
-     rewind 26
-     rewind 19
-     endfile (19)
-     rewind 19
-     nrw26=0
-  endif
-
-#ifdef CVF
-  open(23,file='CALL3.TXT',status='unknown',share='denynone')
-#else
-  open(23,file='CALL3.TXT',status='unknown')
-#endif
-
-  if(nutc.ne.nutc0) nfile=nfile+1
-  nutc0=nutc
-  df=96000.0/NFFT                     !df = 96000/NFFT = 2.930 Hz
-  ftol=0.020                          !Frequency tolerance (kHz)
-  foffset=0.001*(1270 + nfcal)
-  fselect=mfqso + foffset
-  dphi=idphi/57.2957795
-
-  do i=12,3,-1
-     if(hiscall(i:i).ne.' ') go to 1
-  enddo
-  i=0
-1 len_hiscall=i
-
-  iloop=0
-2 if(ndphi.eq.1) dphi=30*iloop/57.2957795
-  do nqd=1,0,-1
-     if(nqd.eq.1) then                     !Quick decode, at fQSO
-        fa=1000.0*(fselect+0.001*mousedf-100.0) - dftolerance
-        fb=1000.0*(fselect+0.001*mousedf-100.0) + dftolerance + 4*53.8330078
-        ia=nint((fa+23000.0)/df + 1.0)     ! 23000 = 48000 - 25000
-        ib=nint((fb+23000.0)/df + 1.0)
-     else                                  !Wideband decode at all freqs
-        fa=1000*(nfa-100)
-        fb=1000*(nfb-100)
-        ia=nint((fa+23000.0)/df + 1.0)     ! 23000 = 48000 - 25000
-        ib=nint((fb+23000.0)/df + 1.0)
-     endif
-
-     km=0
-     nkm=1
-     nz=n/8
-
-     do i=1,NFFT
-        short(1,i)=0.
-        short(2,i)=0.
-        short(3,i)=0.
-     enddo
-
-     freq0=-999.
-     sync10=-999.
-     fshort0=-999.
-     sync20=-999.
-     ntry=0
-     do i=ia,ib                               !Search over freq range
-        call sleep_msec(0)
-        freq=0.001*((i-1)*df - 23000) + 100.0
-!  Find the local base level for each polarization; update every 10 bins.
-        if(mod(i-ia,10).eq.0) then
-           do jp=1,4
-              do ii=-50,50
-                 iii=i+ii
-                 if(iii.ge.1 .and. iii.le.32768) then
-                    tavg(ii)=savg(jp,iii)
-                 else
-                    print*,'Error in iii:',iii,ia,ib,fa,fb
-                    go to 999
-                 endif
-              enddo
-              call pctile(tavg,tmp,101,50,base(jp))
-           enddo
-           bmax=max(base(1),base(2),base(3),base(4))
-        endif
-
-!  Do not process extremely strong signals
-        if(nqd.eq.0 .and. bmax.gt.1000.0) go to 70
-
-!  Find max signal at this frequency
-        smax=0.
-        do jp=1,4
-           if(savg(jp,i)/base(jp).gt.smax) smax=savg(jp,i)/base(jp)
-        enddo
-
-        if(smax.gt.1.1) then
-           ntry=ntry+1
-!  Look for JT65 sync patterns and shorthand square-wave patterns.
-           call ccf65(ss(1,1,i),nhsym,sync1,ipol,dt,flipk,              &amp;
-                syncshort,snr2,ipol2,dt2)
-
-! ########################### Search for Shorthand Messages #################
-!  Is there a shorthand tone above threshold?
-           thresh0=1.0
-!  Use lower thresh0 at fQSO
-           if(nqd.eq.1 .and. dftolerance.le.100) thresh0=0.
-
-           if(syncshort.gt.thresh0) then
-! ### Do shorthand AFC here (or maybe after finding a pair?) ###
-              short(1,i)=syncshort
-              short(2,i)=dt2
-              short(3,i)=ipol2
-!  Check to see if lower tone of shorthand pair was found.
-              do j=2,4
-                 i0=i-nint(j*53.8330078/df)
-!  Should this be i0 +/- 1, or just i0?
-!  Should we also insist that difference in DT be either 1.5 or -1.5 s?
-                 if(short(1,i0).gt.1.0) then
-                    fshort=0.001*((i0-1)*df - 23000) + 100.0
-
-                    noffset=0
-                    if(nqd.eq.1) noffset=nint(1000.0*  &amp;
-                         (fshort-foffset-mfqso)-mousedf)
-                    if(abs(noffset).le.dftolerance) then
-!  Keep only the best candidate within ftol.
-!### NB: sync2 was not defined here!
-                       sync2=syncshort                   !### try this ???
-                       if(fshort-fshort0.le.ftol .and. sync2.gt.sync20    &amp;
-                            .and. nkm.eq.2) km=km-1
-                       if(fshort-fshort0.gt.ftol .or.                     &amp;
-                            sync2.gt.sync20) then
-                          km=km+1
-                          sig(km,1)=nfile
-                          sig(km,2)=nutc
-                          sig(km,3)=fshort
-                          sig(km,4)=syncshort
-                          sig(km,5)=dt2
-                          sig(km,6)=45*(ipol2-1)/57.2957795
-                          sig(km,7)=0
-                          sig(km,8)=snr2
-                          sig(km,9)=0
-                          sig(km,10)=0
-!                           sig(km,11)=rms0
-                          sig(km,12)=savg(ipol2,i)
-                          sig(km,13)=0
-                          sig(km,14)=0
-                          sig(km,15)=0
-                          sig(km,16)=0
-!                           sig(km,17)=0
-                          sig(km,18)=0
-                          msg(km)=shmsg0(j)
-                          fshort0=fshort
-                          sync20=sync2
-                          nkm=2
-                       endif
-                    endif
-                 endif
-              enddo
-           endif
-
-! ########################### Search for Normal Messages ###########
-!  Is sync1 above threshold?
-           thresh1=1.0
-!  Use lower thresh1 at fQSO
-           if(nqd.eq.1 .and. dftolerance.le.100) thresh1=0.
-           noffset=0
-           if(nqd.eq.1) noffset=nint(1000.0*(freq-foffset-mfqso)-mousedf)
-           if(sync1.gt.thresh1 .and. abs(noffset).le.dftolerance) then
-!  Keep only the best candidate within ftol.
-!  (Am I deleting any good decodes by doing this?)
-              if(freq-freq0.le.ftol .and. sync1.gt.sync10 .and.               &amp;
-                   nkm.eq.1) km=km-1
-              if(freq-freq0.gt.ftol .or. sync1.gt.sync10) then
-                 nflip=nint(flipk)
-                 call decode1a(dd(1,1,kbuf),newdat,freq,nflip,        &amp;
-                      mycall,hiscall,hisgrid,neme,ndepth,nqd,dphi,ndphi,    &amp;
-                      ipol,sync2,a,dt,pol,nkv,nhist,qual,decoded)
-
-!  If hiscall or hisgrid is in decoded message, save the pol'n angle.
-                 i1=index(decoded,hiscall(1:len_hiscall))
-                 i2=index(decoded,hisgrid(1:4))
-                 if(i1.ge.5 .or. i2.ge.9) then
-                    nhispol=nint(57.2957795*pol)
-                 endif
-                 km=km+1
-                 sig(km,1)=nfile
-                 sig(km,2)=nutc
-                 sig(km,3)=freq
-                 sig(km,4)=sync1
-                 sig(km,5)=dt
-                 sig(km,6)=pol
-                 sig(km,7)=flipk
-                 sig(km,8)=sync2
-                 sig(km,9)=nkv
-                 sig(km,10)=qual
-!                 sig(km,11)=idphi
-                 sig(km,12)=savg(ipol,i)
-                 sig(km,13)=a(1)
-                 sig(km,14)=a(2)
-                 sig(km,15)=a(3)
-                 sig(km,16)=a(4)
-!                     sig(km,17)=a(5)
-                 sig(km,18)=nhist
-                 msg(km)=decoded
-                 freq0=freq
-                 sync10=sync1
-                 nkm=1
-              endif
-           endif
-        endif
-70      continue
-     enddo
-     if(nqd.eq.1) then
-        nwrite=0
-        do k=1,km
-           decoded=msg(k)
-           if(decoded.ne.'                      ') then
-              nutc=sig(k,2)
-              freq=sig(k,3)
-              sync1=sig(k,4)
-              dt=sig(k,5)
-              npol=nint(57.2957795*sig(k,6))
-              flip=sig(k,7)
-              sync2=sig(k,8)
-              nkv=sig(k,9)
-              nqual=sig(k,10)
-!              idphi=nint(sig(k,11))
-              if(flip.lt.0.0) then
-                 do i=22,1,-1
-                    if(decoded(i:i).ne.' ') go to 8
-                 enddo
-                 stop 'Error in message format'
-8                if(i.le.18) decoded(i+2:i+4)='OOO'
-              endif
-              nkHz=nint(freq-foffset) + nfoffset
-              f0=144.0+0.001*nkHz
-              ndf=nint(1000.0*(freq-foffset-nkHz+nfoffset))
-
-!              ndf0=nint(a(1))
-!              ndf1=nint(a(2))
-!              ndf2=nint(a(3))
-              nsync1=sync1
-              nsync2=nint(10.0*log10(sync2)) - 40 !### empirical ###
-              if(decoded(1:4).eq.'RO  ' .or. decoded(1:4).eq.'RRR  ' .or.  &amp;
-                 decoded(1:4).eq.'73  ') nsync2=nsync2-6
-              nwrite=nwrite+1
-              if(nxant.ne.0) then
-                 npol=npol-45
-                 if(npol.lt.0) npol=npol+180
-              endif
-              call cs_lock('map65aa')
-              if(ndphi.eq.0) then
-                 write(11,1010) nkHz,ndf,npol,nutc,dt,nsync2,decoded,nkv,nqual
-1010             format(i3,i5,i4,i5.4,f5.1,i4,2x,a22,i5,i4,i4)
-              else
-		 if(iloop.ge.1) qphi(iloop)=sig(k,10)
-                 write(11,1010) nkHz,ndf,npol,nutc,dt,nsync2,decoded,nkv,  &amp;
-                      nqual,30*iloop
-                 write(27,1011) 30*iloop,nkHz,ndf,npol,nutc,  &amp;
-                      dt,sync2,nkv,nqual,decoded
-1011             format(i3,i4,i5,i4,i5.4,f5.1,f7.1,i3,i5,2x,a22)
-              endif
-              call cs_unlock
-           endif
-        enddo
-        if(nwrite.eq.0) then
-           nfqso=mfqso + nfoffset
-           call cs_lock('map65ab')
-           write(11,1012) nfqso,nutc
-1012          format(i3,9x,i5.4)
-           call cs_unlock
-        endif
-   
-     endif
-     if(ndphi.eq.1 .and.iloop.lt.12) then
-        iloop=iloop+1
-        go to 2
-     endif
-     if(ndphi.eq.1 .and.iloop.eq.12) call getdphi(qphi)
-     if(nqd.eq.1) then
-        write(11,*) '$EOF'
-        call flushqqq(11)
-        ndecdone=1
-     endif
-     if(nagain.eq.1) go to 999
-  enddo
-
-!  Trim the list and produce a sorted index and sizes of groups.
-!  (Should trimlist remove all but best SNR for given UTC and message content?)
-  call trimlist(sig,km,indx,nsiz,nz)
-
-  do i=1,km
-     done(i)=.false.
-  enddo
-  j=0
-  ilatest=-1
-  do n=1,nz
-     ifile0=0
-     do m=1,nsiz(n)
-        i=indx(j+m)
-        ifile=sig(i,1)
-        if(ifile.gt.ifile0 .and.msg(i).ne.blank) then
-           ilatest=i
-           ifile0=ifile
-        endif
-     enddo
-     i=ilatest
-
-     if(i.ge.1) then
-        if(.not.done(i)) then
-           done(i)=.true.
-           nutc=sig(i,2)
-           freq=sig(i,3)
-           sync1=sig(i,4)
-           dt=sig(i,5)
-           npol=nint(57.2957795*sig(i,6))
-           flip=sig(i,7)
-           sync2=sig(i,8)
-           nkv=sig(i,9)
-           nqual=min(sig(i,10),10.0)
-!                  rms0=sig(i,11)
-           do k=1,5
-              a(k)=sig(i,12+k)
-           enddo
-           nhist=sig(i,18)
-           decoded=msg(i)
-           
-           if(flip.lt.0.0) then
-              do i=22,1,-1
-                 if(decoded(i:i).ne.' ') go to 10
-              enddo
-              stop 'Error in message format'
-10            if(i.le.18) decoded(i+2:i+4)='OOO'
-           endif
-           nkHz=nint(freq-foffset) + nfoffset
-           f0=144.0+0.001*nkHz
-           ndf=nint(1000.0*(freq-foffset-nkHz+nfoffset))
-           ndf0=nint(a(1))
-           ndf1=nint(a(2))
-           ndf2=nint(a(3))
-           nsync1=sync1
-           nsync2=nint(10.0*log10(sync2)) - 40 !### empirical ###
-           if(decoded(1:4).eq.'RO  ' .or. decoded(1:4).eq.'RRR  ' .or.  &amp;
-                decoded(1:4).eq.'73  ') nsync2=nsync2-6
-           if(nxant.ne.0) then
-              npol=npol-45
-              if(npol.lt.0) npol=npol+180
-           endif
-           call cs_lock('map65ac')
-           write(26,1014) f0,ndf,ndf0,ndf1,ndf2,dt,npol,nsync1,       &amp;
-                nsync2,nutc,decoded,nkv,nqual,nhist
-           write(21,1014) f0,ndf,ndf0,ndf1,ndf2,dt,npol,nsync1,       &amp;
-                nsync2,nutc,decoded,nkv,nqual,nhist
-1014       format(f7.3,i5,3i3,f5.1,i5,i3,i4,i5.4,2x,a22,3i3)
-           call cs_unlock
-
-        endif
-     endif
-     j=j+nsiz(n)
-  enddo
-  call cs_lock('map65ad')
-  write(26,1015) nutc
-1015 format(39x,i4.4)
-  call flushqqq(26)
-  call cs_unlock
-  call display(nkeep)
-  ndecdone=2
-
-!### Temporarily disable the optional saving of raw data
-!  if(nsave.gt.0 .and. ndiskdat.eq.0) call savetf2(id(1,1,kbuf),       &amp;
-!       fnamedate,savedir)
-!###
-
-999 close(23)
-  ndphi=0
-  if(kbuf.eq.1) kkdone=60*96000
-  if(kbuf.eq.2 .or. ndiskdat.eq.1) kkdone=0
-  kk=kkdone
-  nagain=0
-
-  return
-end subroutine map65a

Deleted: branches/map65/map65rc
===================================================================
--- branches/map65/map65rc	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/map65rc	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,9 +0,0 @@
-*font:			Arial 10
-*Label*font:		Arial 10
-*Text*font:		&quot;Courier New&quot; 12
-*Canvas*font:           &quot;Lucida Console&quot; 16
-*background:		gray85
-*Text*background:	white
-*Entry*background:	white
-*foreground:		black
-*Listbox*foreground:	RoyalBlue

Deleted: branches/map65/map65rc.win
===================================================================
--- branches/map65/map65rc.win	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/map65rc.win	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,9 +0,0 @@
-*font:			Arial 8
-*Label*font:		Arial 8
-*Text*font:		&quot;Courier New&quot; 9
-*Canvas*font:           &quot;Lucida Console&quot; 16
-*background:		gray85
-*Text*background:	white
-*Entry*background:	white
-*foreground:		black
-*Listbox*foreground:	RoyalBlue

Added: branches/map65/messages.cpp
===================================================================
--- branches/map65/messages.cpp	                        (rev 0)
+++ branches/map65/messages.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,81 @@
+#include &quot;messages.h&quot;
+#include &quot;ui_messages.h&quot;
+#include &quot;mainwindow.h&quot;
+
+Messages::Messages(QWidget *parent) :
+  QDialog(parent),
+  ui(new Ui::Messages)
+{
+  ui-&gt;setupUi(this);
+  ui-&gt;messagesTextBrowser-&gt;setStyleSheet( \
+          &quot;QTextBrowser { background-color : #000066; color : red; }&quot;);
+  ui-&gt;messagesTextBrowser-&gt;clear();
+  m_cqOnly=false;
+  connect(ui-&gt;messagesTextBrowser,SIGNAL(selectCallsign(bool)),this,
+          SLOT(selectCallsign2(bool)));
+}
+
+Messages::~Messages()
+{
+  delete ui;
+}
+
+void Messages::setText(QString t)
+{
+  QString cfreq,cfreq0;
+  m_t=t;
+
+  QString s=&quot;QTextBrowser{background-color: &quot;+m_colorBackground+&quot;}&quot;;
+  ui-&gt;messagesTextBrowser-&gt;setStyleSheet(s);
+
+  ui-&gt;messagesTextBrowser-&gt;clear();
+  QStringList lines = t.split( &quot;\n&quot;, QString::SkipEmptyParts );
+  foreach( QString line, lines ) {
+    QString t1=line.mid(0,48);
+    if(m_cqOnly and t1.indexOf(&quot; CQ &quot;) &lt; 0) continue;
+    int n=line.mid(48,2).toInt();
+    if(n==0) ui-&gt;messagesTextBrowser-&gt;setTextColor(m_color0);
+    if(n==1) ui-&gt;messagesTextBrowser-&gt;setTextColor(m_color1);
+    if(n==2) ui-&gt;messagesTextBrowser-&gt;setTextColor(m_color2);
+    if(n&gt;=3) ui-&gt;messagesTextBrowser-&gt;setTextColor(m_color3);
+    cfreq=t1.mid(0,3);
+    if(cfreq == cfreq0) {
+      t1=&quot;   &quot; + t1.mid(3,-1);
+    }
+    cfreq0=cfreq;
+    ui-&gt;messagesTextBrowser-&gt;append(t1);
+  }
+}
+
+void Messages::selectCallsign2(bool ctrl)
+{
+  QString t = ui-&gt;messagesTextBrowser-&gt;toPlainText();   //Full contents
+  int i=ui-&gt;messagesTextBrowser-&gt;textCursor().position();
+  int i0=t.lastIndexOf(&quot; &quot;,i);
+  int i1=t.indexOf(&quot; &quot;,i);
+  QString hiscall=t.mid(i0+1,i1-i0-1);
+  if(hiscall!=&quot;&quot;) {
+    if(hiscall.length() &lt; 13) {
+      QString t1 = t.mid(0,i);              //contents up to text cursor
+      int i1=t1.lastIndexOf(&quot;\n&quot;) + 1;
+      QString t2 = t1.mid(i1,i-i1);         //selected line
+      emit click2OnCallsign(hiscall,t2);
+    }
+  }
+}
+
+void Messages::on_checkBox_stateChanged(int n)
+{
+  m_cqOnly = (n!=0);
+  setText(m_t);
+}
+
+void Messages::setColors(QString t)
+{
+  m_colorBackground = &quot;#&quot;+t.mid(0,6);
+  m_color0 = &quot;#&quot;+t.mid(6,6);
+  m_color1 = &quot;#&quot;+t.mid(12,6);
+  m_color2 = &quot;#&quot;+t.mid(18,6);
+  m_color3 = &quot;#&quot;+t.mid(24,6);
+  setText(m_t);
+}

Added: branches/map65/messages.h
===================================================================
--- branches/map65/messages.h	                        (rev 0)
+++ branches/map65/messages.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,40 @@
+#ifndef MESSAGES_H
+#define MESSAGES_H
+
+#include &lt;QDialog&gt;
+
+namespace Ui {
+  class Messages;
+}
+
+class Messages : public QDialog
+{
+  Q_OBJECT
+
+public:
+  explicit Messages(QWidget *parent = 0);
+  void setText(QString t);
+  void setColors(QString t);
+
+    ~Messages();
+
+signals:
+  void click2OnCallsign(QString hiscall, QString t2);
+
+private slots:
+  void selectCallsign2(bool ctrl);
+  void on_checkBox_stateChanged(int arg1);
+
+private:
+    Ui::Messages *ui;
+    QString m_t;
+    QString m_colorBackground;
+    QString m_color0;
+    QString m_color1;
+    QString m_color2;
+    QString m_color3;
+
+    bool m_cqOnly;
+};
+
+#endif // MESSAGES_H

Added: branches/map65/messages.ui
===================================================================
--- branches/map65/messages.ui	                        (rev 0)
+++ branches/map65/messages.ui	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,100 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;class&gt;Messages&lt;/class&gt;
+ &lt;widget class=&quot;QDialog&quot; name=&quot;Messages&quot;&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;399&lt;/width&gt;
+    &lt;height&gt;595&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;sizePolicy&quot;&gt;
+   &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Expanding&quot;&gt;
+    &lt;horstretch&gt;0&lt;/horstretch&gt;
+    &lt;verstretch&gt;0&lt;/verstretch&gt;
+   &lt;/sizepolicy&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;Dialog&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;layout class=&quot;QGridLayout&quot; name=&quot;gridLayout&quot;&gt;
+   &lt;item row=&quot;0&quot; column=&quot;0&quot;&gt;
+    &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout&quot;&gt;
+     &lt;property name=&quot;sizeConstraint&quot;&gt;
+      &lt;enum&gt;QLayout::SetDefaultConstraint&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;item&gt;
+      &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout&quot;&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QLabel&quot; name=&quot;lab1&quot;&gt;
+         &lt;property name=&quot;sizePolicy&quot;&gt;
+          &lt;sizepolicy hsizetype=&quot;Preferred&quot; vsizetype=&quot;Preferred&quot;&gt;
+           &lt;horstretch&gt;0&lt;/horstretch&gt;
+           &lt;verstretch&gt;0&lt;/verstretch&gt;
+          &lt;/sizepolicy&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt; Freq     DF     Pol     UTC       dB&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;40&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox&quot;&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;CQ Only&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+      &lt;/layout&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;DisplayText&quot; name=&quot;messagesTextBrowser&quot;&gt;
+       &lt;property name=&quot;sizePolicy&quot;&gt;
+        &lt;sizepolicy hsizetype=&quot;MinimumExpanding&quot; vsizetype=&quot;MinimumExpanding&quot;&gt;
+         &lt;horstretch&gt;0&lt;/horstretch&gt;
+         &lt;verstretch&gt;0&lt;/verstretch&gt;
+        &lt;/sizepolicy&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;minimumSize&quot;&gt;
+        &lt;size&gt;
+         &lt;width&gt;340&lt;/width&gt;
+         &lt;height&gt;0&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;font&quot;&gt;
+        &lt;font&gt;
+         &lt;family&gt;Courier New&lt;/family&gt;
+         &lt;pointsize&gt;9&lt;/pointsize&gt;
+        &lt;/font&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+    &lt;/layout&gt;
+   &lt;/item&gt;
+  &lt;/layout&gt;
+ &lt;/widget&gt;
+ &lt;customwidgets&gt;
+  &lt;customwidget&gt;
+   &lt;class&gt;DisplayText&lt;/class&gt;
+   &lt;extends&gt;QTextBrowser&lt;/extends&gt;
+   &lt;header&gt;displaytext.h&lt;/header&gt;
+  &lt;/customwidget&gt;
+ &lt;/customwidgets&gt;
+ &lt;resources/&gt;
+ &lt;connections/&gt;
+&lt;/ui&gt;

Deleted: branches/map65/moon2.f
===================================================================
--- branches/map65/moon2.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/moon2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,167 +0,0 @@
-      subroutine moon2(y,m,Day,UT,lon,lat,RA,Dec,topRA,topDec,
-     +  LST,HA,Az,El,dist)
-
-      implicit none
-
-      integer y                           !Year
-      integer m                           !Month
-      integer Day                         !Day
-      real*8 UT                           !UTC in hours
-      real*8 RA,Dec                       !RA and Dec of moon
-
-C  NB: Double caps are single caps in the writeup.
-
-      real*8 NN                           !Longitude of ascending node
-      real*8 i                            !Inclination to the ecliptic
-      real*8 w                            !Argument of perigee
-      real*8 a                            !Semi-major axis
-      real*8 e                            !Eccentricity
-      real*8 MM                           !Mean anomaly
-
-      real*8 v                            !True anomaly
-      real*8 EE                           !Eccentric anomaly
-      real*8 ecl                          !Obliquity of the ecliptic
-
-      real*8 d                            !Ephemeris time argument in days
-      real*8 r                            !Distance to sun, AU
-      real*8 xv,yv                        !x and y coords in ecliptic
-      real*8 lonecl,latecl                !Ecliptic long and lat of moon
-      real*8 xg,yg,zg                     !Ecliptic rectangular coords
-      real*8 Ms                           !Mean anomaly of sun
-      real*8 ws                           !Argument of perihelion of sun
-      real*8 Ls                           !Mean longitude of sun (Ns=0)
-      real*8 Lm                           !Mean longitude of moon
-      real*8 DD                           !Mean elongation of moon
-      real*8 FF                           !Argument of latitude for moon
-      real*8 xe,ye,ze                     !Equatorial geocentric coords of moon
-      real*8 mpar                         !Parallax of moon (r_E / d)
-      real*8 lat,lon                      !Station coordinates on earth
-      real*8 gclat                        !Geocentric latitude
-      real*8 rho                          !Earth radius factor
-      real*8 GMST0,LST,HA
-      real*8 g
-      real*8 topRA,topDec                 !Topocentric coordinates of Moon
-      real*8 Az,El
-      real*8 dist
-
-      real*8 rad,twopi,pi,pio2
-      data rad/57.2957795131d0/,twopi/6.283185307d0/
-
-      d=367*y - 7*(y+(m+9)/12)/4 + 275*m/9 + Day - 730530 + UT/24.d0
-      ecl = 23.4393d0 - 3.563d-7 * d
-
-C  Orbital elements for Moon:  
-      NN = 125.1228d0 - 0.0529538083d0 * d
-      i = 5.1454d0
-      w = mod(318.0634d0 + 0.1643573223d0 * d + 360000.d0,360.d0)
-      a = 60.2666d0
-      e = 0.054900d0
-      MM = mod(115.3654d0 + 13.0649929509d0 * d + 360000.d0,360.d0)
-
-      EE = MM + e*rad*sin(MM/rad) * (1.d0 + e*cos(MM/rad))
-      EE = EE - (EE - e*rad*sin(EE/rad)-MM) / (1.d0 - e*cos(EE/rad))
-      EE = EE - (EE - e*rad*sin(EE/rad)-MM) / (1.d0 - e*cos(EE/rad))
-
-      xv = a * (cos(EE/rad) - e)
-      yv = a * (sqrt(1.d0-e*e) * sin(EE/rad))
-
-      v = mod(rad*atan2(yv,xv)+720.d0,360.d0)
-      r = sqrt(xv*xv + yv*yv)
-
-C  Get geocentric position in ecliptic rectangular coordinates:
-
-      xg = r * (cos(NN/rad)*cos((v+w)/rad) -
-     +          sin(NN/rad)*sin((v+w)/rad)*cos(i/rad))
-      yg = r * (sin(NN/rad)*cos((v+w)/rad) + 
-     +          cos(NN/rad)*sin((v+w)/rad)*cos(i/rad))
-      zg = r * (sin((v+w)/rad)*sin(i/rad))
-
-C  Ecliptic longitude and latitude of moon:
-      lonecl = mod(rad*atan2(yg/rad,xg/rad)+720.d0,360.d0)
-      latecl = rad*atan2(zg/rad,sqrt(xg*xg + yg*yg)/rad)
-
-C  Now include orbital perturbations:
-      Ms = mod(356.0470d0 + 0.9856002585d0 * d + 3600000.d0,360.d0)
-      ws = 282.9404d0 + 4.70935d-5*d
-      Ls = mod(Ms + ws + 720.d0,360.d0)
-      Lm = mod(MM + w + NN+720.d0,360.d0)
-      DD = mod(Lm - Ls + 360.d0,360.d0)
-      FF = mod(Lm - NN + 360.d0,360.d0)
-
-      lonecl = lonecl 
-     +  -1.274d0 * sin((MM-2.d0*DD)/rad)
-     +  +0.658d0 * sin(2.d0*DD/rad)
-     +  -0.186d0 * sin(Ms/rad)
-     +  -0.059d0 * sin((2.d0*MM-2.d0*DD)/rad)
-     +  -0.057d0 * sin((MM-2.d0*DD+Ms)/rad)
-     +  +0.053d0 * sin((MM+2.d0*DD)/rad)
-     +  +0.046d0 * sin((2.d0*DD-Ms)/rad)
-     +  +0.041d0 * sin((MM-Ms)/rad)
-     +  -0.035d0 * sin(DD/rad)
-     +  -0.031d0 * sin((MM+Ms)/rad)
-     +  -0.015d0 * sin((2.d0*FF-2.d0*DD)/rad)
-     +  +0.011d0 * sin((MM-4.d0*DD)/rad)
-
-      latecl = latecl
-     +  -0.173d0 * sin((FF-2.d0*DD)/rad)
-     +  -0.055d0 * sin((MM-FF-2.d0*DD)/rad)
-     +  -0.046d0 * sin((MM+FF-2.d0*DD)/rad)
-     +  +0.033d0 * sin((FF+2.d0*DD)/rad)
-     +  +0.017d0 * sin((2.d0*MM+FF)/rad)
-
-      r = 60.36298d0
-     +  - 3.27746d0*cos(MM/rad)
-     +  - 0.57994d0*cos((MM-2.d0*DD)/rad)
-     +  - 0.46357d0*cos(2.d0*DD/rad)
-     +  - 0.08904d0*cos(2.d0*MM/rad)
-     +  + 0.03865d0*cos((2.d0*MM-2.d0*DD)/rad)
-     +  - 0.03237d0*cos((2.d0*DD-Ms)/rad)
-     +  - 0.02688d0*cos((MM+2.d0*DD)/rad)
-     +  - 0.02358d0*cos((MM-2.d0*DD+Ms)/rad)
-     +  - 0.02030d0*cos((MM-Ms)/rad)
-     +  + 0.01719d0*cos(DD/rad)
-     +  + 0.01671d0*cos((MM+Ms)/rad)
-
-      dist=r*6378.140d0
-
-C  Geocentric coordinates:
-C  Rectangular ecliptic coordinates of the moon:
-
-      xg = r * cos(lonecl/rad)*cos(latecl/rad)
-      yg = r * sin(lonecl/rad)*cos(latecl/rad)
-      zg = r *                 sin(latecl/rad)
-
-C  Rectangular equatorial coordinates of the moon:
-      xe = xg
-      ye = yg*cos(ecl/rad) - zg*sin(ecl/rad)
-      ze = yg*sin(ecl/rad) + zg*cos(ecl/rad)
-   
-C  Right Ascension, Declination:
-      RA = mod(rad*atan2(ye,xe)+360.d0,360.d0)
-      Dec = rad*atan2(ze,sqrt(xe*xe + ye*ye))
-
-C  Now convert to topocentric system:
-      mpar=rad*asin(1.d0/r)
-C      alt_topoc = alt_geoc - mpar*cos(alt_geoc)
-      gclat = lat - 0.1924d0*sin(2.d0*lat/rad)
-      rho = 0.99883d0 + 0.00167d0*cos(2.d0*lat/rad)
-      GMST0 = (Ls + 180.d0)/15.d0
-      LST = mod(GMST0+UT+lon/15.d0+48.d0,24.d0)    !LST in hours
-      HA = 15.d0*LST - RA                          !HA in degrees
-      g = rad*atan(tan(gclat/rad)/cos(HA/rad))
-      topRA = RA - mpar*rho*cos(gclat/rad)*sin(HA/rad)/cos(Dec/rad)
-      topDec = Dec - mpar*rho*sin(gclat/rad)*sin((g-Dec)/rad)/sin(g/rad)
-
-      HA = 15.d0*LST - topRA                       !HA in degrees
-      if(HA.gt.180.d0) HA=HA-360.d0
-      if(HA.lt.-180.d0) HA=HA+360.d0
-
-      pi=0.5d0*twopi
-      pio2=0.5d0*pi
-      call dcoord(pi,pio2-lat/rad,0.d0,lat/rad,ha*twopi/360,
-     +  topDec/rad,az,el)
-      Az=az*rad
-      El=El*rad
-
-      return
-      end

Deleted: branches/map65/morse.f
===================================================================
--- branches/map65/morse.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/morse.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,90 +0,0 @@
-      subroutine morse(msg,idat,n)
-
-C  Convert ascii message to a Morse code bit string.
-C     Dash = 3 dots
-C     Space between dots, dashes = 1 dot
-C     Space between letters = 3 dots
-C     Space between words = 7 dots
-
-      character*22 msg
-      integer*1 idat(460)
-      integer*1 ic(21,38)
-      data ic/
-     + 1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,20,
-     + 1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,18,
-     + 1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,16,
-     + 1,0,1,0,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,14,
-     + 1,0,1,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,12,
-     + 1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,10,
-     + 1,1,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,12,
-     + 1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,0,0,0,0,14,
-     + 1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,0,0,0,0,16,
-     + 1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,0,0,18,
-     + 1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 6,
-     + 1,1,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,10,
-     + 1,1,1,0,1,0,1,1,1,0,1,0,0,0,0,0,0,0,0,0,12,
-     + 1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0, 8,
-     + 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 2,
-     + 1,0,1,0,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,10,
-     + 1,1,1,0,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,10,
-     + 1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0, 8,
-     + 1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 4,
-     + 1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,14,
-     + 1,1,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,10,
-     + 1,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,10,
-     + 1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0, 8,
-     + 1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 6,
-     + 1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,12,
-     + 1,0,1,1,1,0,1,1,1,0,1,0,0,0,0,0,0,0,0,0,12,
-     + 1,1,1,0,1,1,1,0,1,0,1,1,1,0,0,0,0,0,0,0,14,
-     + 1,0,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0, 8,
-     + 1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 6,
-     + 1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 4,
-     + 1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0, 8,
-     + 1,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,10,
-     + 1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,10,
-     + 1,1,1,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,12,
-     + 1,1,1,0,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,14,
-     + 1,1,1,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,12,
-     + 1,1,1,0,1,0,1,0,1,1,1,0,1,0,0,0,0,0,0,0,14,
-     + 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 2/   !Incremental word space
-      save
-
-C  Find length of message
-      do i=22,1,-1
-         if(msg(i:i).ne.' ') go to 1
-      enddo
- 1    msglen=i
-
-      n=0
-      do k=1,msglen
-         jj=ichar(msg(k:k))
-         if(jj.ge.97 .and. jj.le.122) jj=jj-32  !Convert lower to upper case
-         if(jj.ge.48 .and. jj.le.57) j=jj-48    !Numbers
-         if(jj.ge.65 .and. jj.le.90) j=jj-55    !Letters
-         if(jj.eq.47) j=36                      !Slash (/)
-         if(jj.eq.32) j=37                      !Word space
-         j=j+1
-
-C  Insert this character
-         nmax=ic(21,j)
-         do i=1,nmax
-            n=n+1
-            idat(n)=ic(i,j)
-         enddo
-
-C  Insert character space of 2 dit lengths:
-         n=n+1
-         idat(n)=0
-         n=n+1
-         idat(n)=0
-      enddo
-
-C  Insert word space at end of message
-      do j=1,4
-         n=n+1
-         idat(n)=0
-      enddo
-
-      return
-      end

Deleted: branches/map65/msgtrim.f90
===================================================================
--- branches/map65/msgtrim.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/msgtrim.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,37 +0,0 @@
-subroutine msgtrim(msg,msglen)
-
-  character*28 msg
-
-! Remove leading blanks
-  do i=1,28
-     if(msg(1:1).ne.' ') go to 2
-     msg=msg(2:)
-  enddo
-
-2 do i=28,1,-1
-     if(msg(i:i).ne.' ') go to 3
-  enddo
-  i=1
-3 iz=i
-
-! Collapse multiple blanks to one
-  ib2=index(msg,'  ')
-  if(ib2.eq.0 .or. ib2.eq.iz+1) go to 10
-  msg=msg(:ib2-1)//msg(ib2+1:)
-  iz=iz-1
-  go to 2
-
-! Convert letters to upper case
-10 do i=1,22
-     if(msg(i:i).ge.'a' .and. msg(i:i).le.'z')                      &amp;
-          msg(i:i)= char(ichar(msg(i:i))+ichar('A')-ichar('a'))
-  enddo
-
-  do i=28,1,-1
-     if(msg(i:i).ne.' ') go to 20
-  enddo
-  i=28
-20  msglen=i
-
-  return
-end subroutine msgtrim

Deleted: branches/map65/nchar.f
===================================================================
--- branches/map65/nchar.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/nchar.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,22 +0,0 @@
-      function nchar(c)
-
-C  Convert ascii number, letter, or space to 0-36 for callsign packing.
-
-      character c*1
-
-      if(c.ge.'0' .and. c.le.'9') then
-         n=ichar(c)-ichar('0')
-      else if(c.ge.'A' .and. c.le.'Z') then
-         n=ichar(c)-ichar('A') + 10
-      else if(c.ge.'a' .and. c.le.'z') then
-         n=ichar(c)-ichar('a') + 10
-      else if(c.ge.' ') then
-         n=36
-      else
-         Print*,'Invalid character in callsign ',c,' ',ichar(c)
-         stop
-      endif
-      nchar=n
-
-      return
-      end

Deleted: branches/map65/options.py
===================================================================
--- branches/map65/options.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/options.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,133 +0,0 @@
-#------------------------------------------------------ options
-from Tkinter import *
-import Pmw
-import g
-
-def done():
-    root.withdraw()
-
-root=Toplevel()
-root.withdraw()
-root.protocol('WM_DELETE_WINDOW',done)
-if g.Win32: root.iconbitmap(&quot;wsjt.ico&quot;)
-root.title(&quot;Options&quot;)
-
-def options2(t):
-    root.geometry(t)
-    root.deiconify()
-    root.focus_set()
-
-#-------------------------------------------------------- Create GUI widgets
-g1=Pmw.Group(root,tag_text=&quot;Station parameters&quot;)
-MyCall=StringVar()
-MyGrid=StringVar()
-#RxDelay=StringVar()
-#TxDelay=StringVar()
-IDinterval=IntVar()
-ComPort=IntVar()
-PttPort=StringVar()
-ndevin=IntVar()
-ndevout=IntVar()
-DevinName=StringVar()
-DevoutName=StringVar()
-forceFcenter=DoubleVar()
-samfacin=DoubleVar()
-samfacout=DoubleVar()
-Template1=StringVar()
-Template2=StringVar()
-Template3=StringVar()
-Template4=StringVar()
-Template5=StringVar()
-Template6=StringVar()
-addpfx=StringVar()
-auxra=StringVar()
-auxdec=StringVar()
-nkeep=IntVar()
-dphi=IntVar()
-fa=IntVar()
-fb=IntVar()
-fcal=IntVar()
-nt1=IntVar()
-savedir=StringVar()
-azeldir=StringVar()
-
-mycall=Pmw.EntryField(g1.interior(),labelpos=W,label_text='My Call:',
-        value='K1JT',entry_textvariable=MyCall,entry_width=12)
-mygrid=Pmw.EntryField(g1.interior(),labelpos=W,label_text='Grid Locator:',
-        value='FN20qi',entry_textvariable=MyGrid,entry_width=12)
-##rxdelay=Pmw.EntryField(g1.interior(),labelpos=W,label_text='Rx Delay (s):',
-##        value='0.2',entry_textvariable=RxDelay)
-##txdelay=Pmw.EntryField(g1.interior(),labelpos=W,label_text='Tx Delay (s):',
-##        value='0.2',entry_textvariable=TxDelay)
-idinterval=Pmw.EntryField(g1.interior(),labelpos=W,label_text='ID Interval (m):',
-        value=10,validate={'validator':'numeric','min':0,'max':60}, \
-        entry_textvariable=IDinterval,entry_width=12)
-comport=Pmw.EntryField(g1.interior(),labelpos=W,label_text='PTT Port:',
-        value='/dev/ttyS0',entry_textvariable=PttPort,entry_width=12)
-audioout=Pmw.EntryField(g1.interior(),labelpos=W,label_text='Audio Out:',
-        value='0',entry_textvariable=DevoutName,entry_width=12)
-rateout=Pmw.EntryField(g1.interior(),labelpos=W,label_text='Rate Out:',
-        value=1.0000,entry_textvariable=samfacout,entry_width=12)
-meas_rateout=Pmw.EntryField(g1.interior(),labelpos=W,label_text='Measured:',
-        value=1.0000,entry_width=12)
-#widgets = (mycall, mygrid, rxdelay,txdelay,idinterval,comport,audioin,audioout)
-widgets = (mycall, mygrid,idinterval,comport,audioout,rateout,meas_rateout)
-for widget in widgets:
-    widget.pack(fill=X,expand=1,padx=10,pady=2)
-
-Pmw.alignlabels(widgets)
-mycall.component('entry').focus_set()
-f1=Frame(g1.interior(),width=100,height=20)
-mileskm=IntVar()
-Label(f1,text='Distance unit:').pack(side=LEFT)
-rb5=Radiobutton(f1,text='mi',value=0,variable=mileskm)
-rb6=Radiobutton(f1,text='km',value=1,variable=mileskm)
-rb5.pack(anchor=W,side=LEFT,padx=2,pady=2)
-rb6.pack(anchor=W,side=LEFT,padx=2,pady=2)
-f1.pack()
-
-f2=Frame(g1.interior(),width=100,height=20)
-xant=IntVar()
-Label(f2,text='Antennas:  ').pack(side=LEFT)
-rb7=Radiobutton(f2,text='+ ',value=0,variable=xant)
-rb8=Radiobutton(f2,text='x',value=1,variable=xant)
-rb7.pack(anchor=W,side=LEFT,padx=2,pady=2)
-rb8.pack(anchor=W,side=LEFT,padx=2,pady=2)
-f2.pack()
-
-#g3=Pmw.Group(root)
-g3=Pmw.Group(root,tag_text=&quot;Miscellaneous&quot;)
-temp_prefix=Pmw.EntryField(g3.interior(),labelpos=W,label_text='DXCC prefix:',
-    entry_width=9,entry_textvariable=addpfx)
-aux_ra=Pmw.EntryField(g3.interior(),labelpos=W,label_text='Source RA:',
-    entry_width=9,entry_textvariable=auxra)
-aux_dec=Pmw.EntryField(g3.interior(),labelpos=W,label_text='Source DEC:',
-    entry_width=9,entry_textvariable=auxdec)
-nkeep_entry=Pmw.EntryField(g3.interior(),labelpos=W,label_text='Timeout (min):',
-    entry_width=9,value=20,entry_textvariable=nkeep)
-dphi_entry=Pmw.EntryField(g3.interior(),labelpos=W,label_text='Dphi (deg):',
-    entry_width=9,entry_textvariable=dphi)
-fa_entry=Pmw.EntryField(g3.interior(),labelpos=W,label_text='Fmin (kHz):',
-    entry_width=9,value=100,entry_textvariable=fa)
-fb_entry=Pmw.EntryField(g3.interior(),labelpos=W,label_text='Fmax (kHz):',
-    entry_width=9,value=160,entry_textvariable=fb)
-fcal_entry=Pmw.EntryField(g3.interior(),labelpos=W,label_text='Fcal (Hz):',
-    entry_width=9,entry_textvariable=fcal)
-nt1_entry=Pmw.EntryField(g3.interior(),labelpos=W, \
-    label_text='Rx t1:',entry_width=9,value=48,entry_textvariable=nt1)
-forceFreq_entry=Pmw.EntryField(g3.interior(),labelpos=W, \
-    label_text='Force Fcenter:',entry_width=9,value=0,entry_textvariable=forceFcenter)
-savedir_entry=Pmw.EntryField(g3.interior(),labelpos=W,label_text='SaveDir:',
-    entry_width=23,value=g.appdir+'\save',entry_textvariable=savedir)
-azeldir_entry=Pmw.EntryField(g3.interior(),labelpos=W,label_text='AzElDir:',
-    entry_width=23,value=g.appdir,entry_textvariable=azeldir)
-widgets = (temp_prefix,aux_ra,aux_dec,nkeep_entry,dphi_entry, \
-           fa_entry,fb_entry,fcal_entry,nt1_entry,forceFreq_entry, \
-           savedir_entry,azeldir_entry)
-for widget in widgets:
-    widget.pack(padx=2,pady=2)
-Pmw.alignlabels(widgets)
-
-g1.pack(side=LEFT,fill=BOTH,expand=1,padx=6,pady=6)
-g3.pack(side=LEFT,fill=BOTH,expand=1,padx=6,pady=6)
-

Deleted: branches/map65/pa.lib
===================================================================
(Binary files differ)

Added: branches/map65/paInputDevice.c
===================================================================
--- branches/map65/paInputDevice.c	                        (rev 0)
+++ branches/map65/paInputDevice.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,56 @@
+#include &lt;stdlib.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;string.h&gt;
+
+void paInputDevice(int id, char* hostAPI_DeviceName, int* minChan, 
+		   int* maxChan, int* minSpeed, int* maxSpeed)
+{
+  int i, j, k;
+  char pa_device_name[128];     
+  char pa_device_hostapi[128]; 
+  double pa_device_max_speed;
+  double pa_device_min_speed;
+  int pa_device_max_bytes;
+  int pa_device_min_bytes;
+  int pa_device_max_channels;
+  int pa_device_min_channels;
+  char p2[50];
+  char *p,*p1;
+  static int iret, numDevices, valid_dev_cnt;
+
+  iret=pa_get_device_info (id,
+                          &amp;pa_device_name,
+                          &amp;pa_device_hostapi,
+			  &amp;pa_device_max_speed,
+			  &amp;pa_device_min_speed,
+			  &amp;pa_device_max_bytes,
+			  &amp;pa_device_min_bytes,
+			  &amp;pa_device_max_channels,
+			  &amp;pa_device_min_channels);
+
+  if (iret &gt;= 0 ) {
+    valid_dev_cnt++;
+
+    p1=&quot;&quot;;
+    p=strstr(pa_device_hostapi,&quot;MME&quot;);
+    if(p!=NULL) p1=&quot;MME&quot;;
+    p=strstr(pa_device_hostapi,&quot;Direct&quot;);
+    if(p!=NULL) p1=&quot;DirectX&quot;;
+    p=strstr(pa_device_hostapi,&quot;WASAPI&quot;);
+    if(p!=NULL) p1=&quot;WASAPI&quot;;
+    p=strstr(pa_device_hostapi,&quot;ASIO&quot;);
+    if(p!=NULL) p1=&quot;ASIO&quot;;
+    p=strstr(pa_device_hostapi,&quot;WDM-KS&quot;);
+    if(p!=NULL) p1=&quot;WDM-KS&quot;;
+
+    sprintf(p2,&quot;%-8s %-39s&quot;,p1,pa_device_name);
+    for(i=0; i&lt;50; i++) {
+      hostAPI_DeviceName[i]=p2[i];
+      if(p2[i]==0) break;
+    }
+    *minChan=pa_device_min_channels;
+    *maxChan=pa_device_max_channels;
+    *minSpeed=(int)pa_device_min_speed;
+    *maxSpeed=(int)pa_device_max_speed;
+  }
+}

Added: branches/map65/pa_get_device_info.c
===================================================================
--- branches/map65/pa_get_device_info.c	                        (rev 0)
+++ branches/map65/pa_get_device_info.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,172 @@
+#include &lt;portaudio.h&gt;
+#include &lt;stdio.h&gt;
+
+#define MAX_LATENCY 20
+
+PaStream *in_stream;
+//------------------------------------------------------- pa_get_device_info
+int pa_get_device_info (int  n,
+                        void *pa_device_name,
+                        void *pa_device_hostapi, 
+			double *pa_device_max_speed,
+			double *pa_device_min_speed,
+			int *pa_device_max_bytes,
+			int *pa_device_min_bytes,
+			int *pa_device_max_channels,
+			int *pa_device_min_channels )
+{
+
+  (void) n ;
+  (void) pa_device_name;
+  (void) pa_device_hostapi; 
+  (void) pa_device_max_speed;
+  (void) pa_device_min_speed;
+  (void) pa_device_max_bytes;
+  (void) pa_device_min_bytes;
+  (void) pa_device_max_channels;
+  (void) pa_device_min_channels;
+  const PaDeviceInfo *deviceInfo;
+  PaError pa_err;
+  PaStreamParameters inputParameters;
+  int i,j, speed_warning;
+  int minBytes, maxBytes;
+  double maxStandardSampleRate;
+  double minStandardSampleRate;
+  int minInputChannels;
+  int maxInputChannels;
+
+// negative terminated  list
+  static double standardSampleRates[] = {8000.0, 9600.0, 
+        11025.0, 12000.0, 16000.0, 22050.0, 24000.0, 32000.0,
+        44100.0, 48000.0, 88200.0, 96000.0, 192000.0, -1};
+// *******************************************************
+
+
+  *pa_device_max_speed=0;
+  *pa_device_min_speed=0;
+  *pa_device_max_bytes=0;
+  *pa_device_min_bytes=0;
+  *pa_device_max_channels=0;
+  *pa_device_min_channels=0;
+  minInputChannels=0;
+  if(n &gt;= Pa_GetDeviceCount() ) return -1;
+  deviceInfo = Pa_GetDeviceInfo(n);
+  if (deviceInfo-&gt;maxInputChannels==0) return -1; 
+  sprintf((char*)(pa_device_name),&quot;%s&quot;,deviceInfo-&gt;name);
+  sprintf((char*)(pa_device_hostapi),&quot;%s&quot;,
+	  Pa_GetHostApiInfo( deviceInfo-&gt;hostApi )-&gt;name);
+  speed_warning=0;
+
+// bypass bug in Juli@ ASIO driver: 
+// this driver hangs after a Pa_IsFormatSupported call 
+  i = strncmp(deviceInfo-&gt;name, &quot;ASIO 2.0 - ESI Juli@&quot;, 19);
+  if (i == 0) {
+    minStandardSampleRate=44100;
+    maxStandardSampleRate=192000;
+    minBytes=1;
+    maxBytes=4;
+    maxInputChannels= deviceInfo-&gt;maxInputChannels;
+    minInputChannels= 1;
+    goto end_pa_get_device_info;
+  }
+
+// Investigate device capabilities.
+// Check min and max samplerates  with 16 bit data.
+  maxStandardSampleRate=0;
+  minStandardSampleRate=0;
+  inputParameters.device = n;
+  inputParameters.channelCount = deviceInfo-&gt;maxInputChannels;
+  inputParameters.sampleFormat = paInt16;
+  inputParameters.suggestedLatency = 0;
+  inputParameters.hostApiSpecificStreamInfo = NULL;
+
+// ************************************************************************
+//filter for portaudio Windows hostapi's with non experts.
+//only allow ASIO or WASAPI or WDM-KS
+  i = strncmp(Pa_GetHostApiInfo(deviceInfo-&gt;hostApi)-&gt;name, &quot;ASIO&quot;, 4);
+  if (i==0 ) goto end_filter_hostapi;
+  i = strncmp(Pa_GetHostApiInfo(deviceInfo-&gt;hostApi)-&gt;name, 
+	      &quot;Windows WASAPI&quot;, 14);
+  if (i==0 ) goto end_filter_hostapi;
+  i = strncmp(Pa_GetHostApiInfo(deviceInfo-&gt;hostApi)-&gt;name, 
+	      &quot;Windows WDM-KS&quot;, 14);
+  if (i==0 ) goto end_filter_hostapi;
+  speed_warning=1;
+end_filter_hostapi:;
+
+// ************************************************************************
+  i=0;
+  while(standardSampleRates[i] &gt; 0 &amp;&amp; minStandardSampleRate==0) {
+    pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL, 
+				standardSampleRates[i] );
+    if(pa_err == paDeviceUnavailable) return -1;
+    if(pa_err == paInvalidDevice) return -1;
+    if(pa_err == paFormatIsSupported ) { 
+      minStandardSampleRate=standardSampleRates[i];
+    }
+    i++;
+  }
+  if(minStandardSampleRate == 0) return -1;
+  j=i;
+  while(standardSampleRates[i] &gt; 0 ) i++;
+  i--;
+  while(i &gt;= j &amp;&amp; maxStandardSampleRate==0) {
+      pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL, 
+				  standardSampleRates[i] );
+    if(pa_err == paDeviceUnavailable) return -1;
+    if(pa_err == paInvalidDevice) return -1;
+    if( pa_err == paFormatIsSupported ) { 
+      maxStandardSampleRate=standardSampleRates[i];
+    }
+    i--;
+  }
+
+// check if min SampleRate  = max SampleRate 
+  if(maxStandardSampleRate==0 &amp;&amp; (minStandardSampleRate != 0)) {
+    maxStandardSampleRate= minStandardSampleRate;
+  }
+
+// check min and max bytes
+  minBytes=2;
+  maxBytes=2;
+  inputParameters.sampleFormat = paUInt8;
+  pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL, 
+				maxStandardSampleRate );
+  if( pa_err == paFormatIsSupported ) { 
+    minBytes=1;
+  }
+    inputParameters.sampleFormat = paInt32;
+    pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL, 
+				maxStandardSampleRate );
+  if( pa_err == paFormatIsSupported ) { 
+    maxBytes=4;
+  }
+
+// check min channel count
+  maxInputChannels= deviceInfo-&gt;maxInputChannels;
+  inputParameters.channelCount = 1;
+  inputParameters.sampleFormat = paInt16;
+  pa_err=paFormatIsSupported+32000;
+  while(pa_err != paFormatIsSupported &amp;&amp;
+	  ( inputParameters.channelCount &lt; (maxInputChannels+1)) ) {
+    pa_err=Pa_IsFormatSupported(&amp;inputParameters, NULL, 
+				maxStandardSampleRate );
+    inputParameters.channelCount++;
+  }
+  if( pa_err == paFormatIsSupported ) {
+    minInputChannels=inputParameters.channelCount-1;
+  } else {
+    return -1;
+  }
+
+end_pa_get_device_info:;
+
+  *pa_device_max_speed=maxStandardSampleRate;
+  *pa_device_min_speed=minStandardSampleRate;
+  *pa_device_max_bytes=maxBytes;
+  *pa_device_min_bytes=minBytes;
+  *pa_device_max_channels= maxInputChannels;
+  *pa_device_min_channels= minInputChannels;
+
+  return speed_warning;
+}

Deleted: branches/map65/packcall.f
===================================================================
--- branches/map65/packcall.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/packcall.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,76 +0,0 @@
-      subroutine packcall(callsign,ncall,text)
-
-C  Pack a valid callsign into a 28-bit integer.
-
-      parameter (NBASE=37*36*10*27*27*27)
-      character callsign*6,c*1,tmp*6
-      logical text
-
-      text=.false.
-
-C  Work-around for Swaziland prefix:
-      if(callsign(1:4).eq.'3DA0') callsign='3D0'//callsign(5:6)
-
-      if(callsign(1:3).eq.'CQ ') then
-         ncall=NBASE + 1
-         if(callsign(4:4).ge.'0' .and. callsign(4:4).le.'9' .and. 
-     +      callsign(5:5).ge.'0' .and. callsign(5:5).le.'9' .and. 
-     +      callsign(6:6).ge.'0' .and. callsign(6:6).le.'9') then
-            read(callsign(4:6),*) nfreq
-            ncall=NBASE + 3 + nfreq
-         endif
-         return
-      else if(callsign(1:4).eq.'QRZ ') then
-         ncall=NBASE + 2
-         return
-      endif
-
-      tmp='      '
-      if(callsign(3:3).ge.'0' .and. callsign(3:3).le.'9') then
-         tmp=callsign
-      else if(callsign(2:2).ge.'0' .and. callsign(2:2).le.'9') then
-         if(callsign(6:6).ne.' ') then
-            text=.true.
-            return
-         endif
-         tmp=' '//callsign
-      else
-         text=.true.
-         return
-      endif
-
-      do i=1,6
-         c=tmp(i:i)
-         if(c.ge.'a' .and. c.le.'z') 
-     +     tmp(i:i)=char(ichar(c)-ichar('a')+ichar('A'))
-      enddo
-
-      n1=0
-      if((tmp(1:1).ge.'A'.and.tmp(1:1).le.'Z').or.tmp(1:1).eq.' ') n1=1
-      if(tmp(1:1).ge.'0' .and. tmp(1:1).le.'9') n1=1
-      n2=0
-      if(tmp(2:2).ge.'A' .and. tmp(2:2).le.'Z') n2=1
-      if(tmp(2:2).ge.'0' .and. tmp(2:2).le.'9') n2=1
-      n3=0
-      if(tmp(3:3).ge.'0' .and. tmp(3:3).le.'9') n3=1
-      n4=0
-      if((tmp(4:4).ge.'A'.and.tmp(4:4).le.'Z').or.tmp(4:4).eq.' ') n4=1
-      n5=0
-      if((tmp(5:5).ge.'A'.and.tmp(5:5).le.'Z').or.tmp(5:5).eq.' ') n5=1
-      n6=0
-      if((tmp(6:6).ge.'A'.and.tmp(6:6).le.'Z').or.tmp(6:6).eq.' ') n6=1
-
-      if(n1+n2+n3+n4+n5+n6 .ne. 6) then
-         text=.true.
-         return 
-      endif
-
-      ncall=nchar(tmp(1:1))
-      ncall=36*ncall+nchar(tmp(2:2))
-      ncall=10*ncall+nchar(tmp(3:3))
-      ncall=27*ncall+nchar(tmp(4:4))-10
-      ncall=27*ncall+nchar(tmp(5:5))-10
-      ncall=27*ncall+nchar(tmp(6:6))-10
-
-      return
-      end

Deleted: branches/map65/packdxcc.f
===================================================================
--- branches/map65/packdxcc.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/packdxcc.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,64 +0,0 @@
-      subroutine packdxcc(c,ng,ldxcc)
-
-      character*3 c
-      logical ldxcc
-
-      parameter (NZ=303)
-      character*5 pfx(NZ)
-      data pfx/
-     +  '1A   ','1S   ','3A   ','3B6  ','3B8  ','3B9  ','3C   ','3C0  ',
-     +  '3D2  ',                '3DA  ','3V   ','3W   ','3X   ','3Y   ',
-     +          '4J   ','4L   ','4S   ','4U1  ',                '4W   ',
-     +  '4X   ','5A   ','5B   ','5H   ','5N   ','5R   ','5T   ','5U   ',
-     +  '5V   ','5W   ','5X   ','5Z   ','6W   ','6Y   ','7O   ','7P   ',
-     +  '7Q   ','7X   ','8P   ','8Q   ','8R   ','9A   ','9G   ','9H   ',
-     +  '9J   ','9K   ','9L   ','9M2  ','9M6  ','9N   ','9Q   ','9U   ',
-     +  '9V   ','9X   ','9Y   ','A2   ','A3   ','A4   ','A5   ','A6   ',
-     +  'A7   ','A9   ','AP   ','BS7  ','BV   ','BV9  ','BY   ','C2   ',
-     +  'C3   ','C5   ','C6   ','C9   ','CE   ','CE0  ',                
-     +  'CE9  ','CM   ','CN   ','CP   ','CT   ','CT3  ','CU   ','CX   ',
-     +  'CY0  ','CY9  ','D2   ','D4   ','D6   ','DL   ','DU   ','E3   ',
-     +  'E4   ','EA   ','EA6  ','EA8  ','EA9  ','EI   ','EK   ','EL   ',
-     +  'EP   ','ER   ','ES   ','ET   ','EU   ','EX   ','EY   ','EZ   ',
-     +  'F    ','FG   ','FH   ','FJ   ','FK   ',        'FM   ','FO   ',
-     +                          'FP   ','FR   ',                        
-     +  'FT5  ',                'FW   ','FY   ','M    ','MD   ','MI   ',
-     +  'MJ   ','MM   ',        'MU   ','MW   ','H4   ','H40  ','HA   ',
-     +  'HB   ','HB0  ','HC   ','HC8  ','HH   ','HI   ','HK   ','HK0  ',
-     +          'HL   ','HM   ','HP   ','HR   ','HS   ','HV   ','HZ   ',
-     +  'I    ','IG9  ','IS   ','IT9  ','J2   ','J3   ','J5   ','J6   ',
-     +  'J7   ','J8   ','JA   ','JD   ',        'JT   ','JW   ',        
-     +  'JX   ','JY   ','K    ','KG4  ','KH0  ','KH1  ','KH2  ','KH3  ',
-     +  'KH4  ','KH5  ',        'KH6  ','KH7  ','KH8  ','KH9  ','KL   ',
-     +  'KP1  ','KP2  ','KP4  ','KP5  ','LA   ','LU   ','LX   ','LY   ',
-     +  'LZ   ','OA   ','OD   ','OE   ','OH   ','OH0  ','OJ0  ','OK   ',
-     +  'OM   ','ON   ','OX   ','OY   ','OZ   ','P2   ','P4   ','PA   ',
-     +  'PJ2  ','PJ7  ','PY   ','PY0  ',                'PZ   ','R1F  ',
-     +  'R1M  ','S0   ','S2   ','S5   ','S7   ','S9   ','SM   ','SP   ',
-     +  'ST   ','SU   ','SV   ',        'SV5  ','SV9  ','T2   ','T30  ',
-     +  'T31  ','T32  ','T33  ','T5   ','T7   ','T8   ','T9   ','TA   ',
-     +  'TA1  ','TF   ','TG   ','TI   ','TI9  ','TJ   ','TK   ','TL   ',
-     +  'TN   ','TR   ','TT   ','TU   ','TY   ','TZ   ','UA   ','UA2  ',
-     +  'UA9  ','UK   ','UN   ','UR   ','V2   ','V3   ','V4   ','V5   ',
-     +  'V6   ','V7   ','V8   ','VE   ','VK   ','VK0  ',        'VK9  ',
-     +                                          'VP2  ',                
-     +  'VP5  ','VP6  ',        'VP8  ',                                
-     +  'VP9  ','VQ9  ','VR   ','VU   ','VU4  ','VU7  ','XE   ','XF4  ',
-     +  'XT   ','XU   ','XW   ','XX9  ','XZ   ','YA   ','YB   ','YI   ',
-     +  'YJ   ','YK   ','YL   ','YN   ','YO   ','YS   ','YU   ','YV   ',
-     +  'YV0  ','Z2   ','Z3   ','ZA   ','ZB   ','ZC4  ','ZD7  ','ZD8  ',
-     +  'ZD9  ','ZF   ','ZK1  ',        'ZK2  ','ZK3  ','ZL   ','ZL7  ',
-     +  'ZL8  ','ZL9  ','ZP   ','ZS   ','ZS8  '/
-
-      ldxcc=.false.
-      ng=0
-      do i=1,NZ
-         if(pfx(i)(1:3).eq.c) go to 10
-      enddo
-      go to 20
-
- 10   ng=180*180+61+i
-      ldxcc=.true.
-
- 20   return
-      end

Deleted: branches/map65/packgrid.f
===================================================================
--- branches/map65/packgrid.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/packgrid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,47 +0,0 @@
-      subroutine packgrid(grid,ng,text)
-
-      parameter (NGBASE=180*180)
-      character*4 grid
-      logical text
-
-      text=.false.
-      if(grid.eq.'    ') go to 90                 !Blank grid is OK
-
-C  Test for numerical signal report, etc.
-      if(grid(1:1).eq.'-') then
-         read(grid(2:3),*,err=1,end=1) n
- 1       ng=NGBASE+1+n
-         go to 100
-      else if(grid(1:2).eq.'R-') then
-         read(grid(3:4),*,err=2,end=2) n
- 2       if(n.eq.0) go to 90
-         ng=NGBASE+31+n
-         go to 100
-      else if(grid(1:2).eq.'RO') then
-         ng=NGBASE+62
-         go to 100
-      else if(grid(1:3).eq.'RRR') then
-         ng=NGBASE+63
-         go to 100
-      else if(grid(1:2).eq.'73') then
-         ng=NGBASE+64
-         go to 100
-      endif
-
-      if(grid(1:1).lt.'A' .or. grid(1:1).gt.'R') text=.true.
-      if(grid(2:2).lt.'A' .or. grid(2:2).gt.'R') text=.true.
-      if(grid(3:3).lt.'0' .or. grid(3:3).gt.'9') text=.true.
-      if(grid(4:4).lt.'0' .or. grid(4:4).gt.'9') text=.true.
-      if(text) go to 100
-
-      call grid2deg(grid//'mm',dlong,dlat)
-      long=dlong
-      lat=dlat+ 90.0
-      ng=((long+180)/2)*180 + lat
-      go to 100
-
- 90   ng=NGBASE + 1
-
- 100  return
-      end
-

Deleted: branches/map65/packmsg.f
===================================================================
--- branches/map65/packmsg.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/packmsg.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,85 +0,0 @@
-      subroutine packmsg(msg,dat)
-
-      parameter (NBASE=37*36*10*27*27*27)
-      character*22 msg
-      integer dat(12)
-      character*12 c1,c2
-      character*4 c3
-      character*6 grid6
-c      character*3 dxcc                  !Where is DXCC implemented?
-      logical text1,text2,text3
-
-C  Convert all letters to upper case
-      do i=1,22
-         if(msg(i:i).ge.'a' .and. msg(i:i).le.'z') 
-     +     msg(i:i)= char(ichar(msg(i:i))+ichar('A')-ichar('a'))
-      enddo
-
-C  See if it's a CQ message
-      if(msg(1:3).eq.'CQ ') then
-         i=3
-C  ... and if so, does it have a reply frequency?
-         if(msg(4:4).ge.'0' .and. msg(4:4).le.'9' .and. 
-     +      msg(5:5).ge.'0' .and. msg(5:5).le.'9' .and. 
-     +      msg(6:6).ge.'0' .and. msg(6:6).le.'9') i=7
-         go to 1
-      endif
-
-      do i=1,22
-         if(msg(i:i).eq.' ') go to 1       !Get 1st blank
-      enddo 
-      go to 10                             !Consider msg as plain text
-      
- 1    ia=i
-      c1=msg(1:ia-1)
-      do i=ia+1,22
-         if(msg(i:i).eq.' ') go to 2       !Get 2nd blank
-      enddo
-      go to 10                             !Consider msg as plain text
-
- 2    ib=i
-      c2=msg(ia+1:ib-1)
-
-      do i=ib+1,22
-         if(msg(i:i).eq.' ') go to 3       !Get 3rd blank
-      enddo
-      go to 10                             !Consider msg as plain text
-
- 3    ic=i
-      c3='    '
-      if(ic.ge.ib+1) c3=msg(ib+1:ic)
-      if(c3.eq.'OOO ') c3='    '           !Strip out the OOO flag
-      call getpfx1(c1,k1)
-      call packcall(c1,nc1,text1)
-      call getpfx1(c2,k2)
-      call packcall(c2,nc2,text2)
-      if(k1.lt.0 .or. k2.lt.0 .or. k1*k2.ne.0) go to 10
-      if(k2.gt.0) k2=k2+450
-      k=max(k1,k2)
-      if(k.gt.0) then
-         call k2grid(k,grid6)
-         c3=grid6
-      endif
-      call packgrid(c3,ng,text3)
-      if((.not.text1) .and. (.not.text2) .and. (.not.text3)) go to 20
-
-C  The message will be treated as plain text.
- 10   call packtext(msg,nc1,nc2,ng)
-      ng=ng+32768
-
-C  Encode data into 6-bit words
- 20   dat(1)=iand(ishft(nc1,-22),63)                !6 bits
-      dat(2)=iand(ishft(nc1,-16),63)                !6 bits
-      dat(3)=iand(ishft(nc1,-10),63)                !6 bits
-      dat(4)=iand(ishft(nc1, -4),63)                !6 bits
-      dat(5)=4*iand(nc1,15)+iand(ishft(nc2,-26),3)  !4+2 bits
-      dat(6)=iand(ishft(nc2,-20),63)                !6 bits
-      dat(7)=iand(ishft(nc2,-14),63)                !6 bits
-      dat(8)=iand(ishft(nc2, -8),63)                !6 bits
-      dat(9)=iand(ishft(nc2, -2),63)                !6 bits
-      dat(10)=16*iand(nc2,3)+iand(ishft(ng,-12),15) !2+4 bits
-      dat(11)=iand(ishft(ng,-6),63)
-      dat(12)=iand(ng,63)
-
-      return
-      end

Deleted: branches/map65/packtext.f
===================================================================
--- branches/map65/packtext.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/packtext.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,47 +0,0 @@
-      subroutine packtext(msg,nc1,nc2,nc3)
-
-      parameter (MASK28=2**28 - 1)
-      character*13 msg
-      character*44 c
-      data c/'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ +-./?'/
-
-      nc1=0
-      nc2=0
-      nc3=0
-
-      do i=1,5                                !First 5 characters in nc1
-         do j=1,44                            !Get character code
-            if(msg(i:i).eq.c(j:j)) go to 10
-         enddo
-         j=37
- 10      j=j-1                                !Codes should start at zero
-         nc1=42*nc1 + j
-      enddo
-
-      do i=6,10                               !Characters 6-10 in nc2
-         do j=1,44                            !Get character code
-            if(msg(i:i).eq.c(j:j)) go to 20
-         enddo
-         j=37
- 20      j=j-1                                !Codes should start at zero
-         nc2=42*nc2 + j
-      enddo
-
-      do i=11,13                              !Characters 11-13 in nc3
-         do j=1,44                            !Get character code
-            if(msg(i:i).eq.c(j:j)) go to 30
-         enddo
-         j=37
- 30      j=j-1                                !Codes should start at zero
-         nc3=42*nc3 + j
-      enddo
-
-C  We now have used 17 bits in nc3.  Must move one each to nc1 and nc2.
-      nc1=nc1+nc1
-      if(iand(nc3,32768).ne.0) nc1=nc1+1
-      nc2=nc2+nc2
-      if(iand(nc3,65536).ne.0) nc2=nc2+1
-      nc3=iand(nc3,32767)
-
-      return
-      end

Deleted: branches/map65/palettes.py
===================================================================
--- branches/map65/palettes.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/palettes.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,1566 +0,0 @@
-import string
-import g
-
-# Several colormaps
-colormapblue =  &quot;&quot;&quot;
-    0.0       0.0       0.0
-    0.0902    0.0902    0.2558
-    0.1176    0.1176    0.2694
-    0.1412    0.1412    0.2820
-    0.1569    0.1569    0.2938
-    0.1725    0.1725    0.3049
-    0.1843    0.1843    0.3154
-    0.1961    0.1961    0.3254
-    0.2039    0.2039    0.3349
-    0.2157    0.2157    0.3440
-    0.2235    0.2235    0.3528
-    0.2314    0.2314    0.3612
-    0.2392    0.2392    0.3693
-    0.2471    0.2471    0.3772
-    0.2549    0.2549    0.3848
-    0.2588    0.2588    0.3921
-    0.2667    0.2667    0.3992
-    0.2706    0.2706    0.4061
-    0.2784    0.2784    0.4129
-    0.2824    0.2824    0.4194
-    0.2902    0.2902    0.4258
-    0.2941    0.2941    0.4319
-    0.2980    0.2980    0.4380
-    0.3059    0.3059    0.4439
-    0.3098    0.3098    0.4496
-    0.3137    0.3137    0.4553
-    0.3176    0.3176    0.4608
-    0.3216    0.3216    0.4661
-    0.3294    0.3294    0.4714
-    0.3333    0.3333    0.4765
-    0.3373    0.3373    0.4815
-    0.3412    0.3412    0.4865
-    0.3451    0.3451    0.4913
-    0.3490    0.3490    0.4960
-    0.3529    0.3529    0.5006
-    0.3569    0.3569    0.5052
-    0.3608    0.3608    0.5096
-    0.3647    0.3647    0.5140
-    0.3686    0.3686    0.5183
-    0.3725    0.3725    0.5225
-    0.3765    0.3765    0.5266
-    0.3804    0.3804    0.5306
-    0.3843    0.3843    0.5346
-    0.3843    0.3843    0.5385
-    0.3882    0.3882    0.5423
-    0.3922    0.3922    0.5460
-    0.3961    0.3961    0.5497
-    0.4000    0.4000    0.5533
-    0.4039    0.4039    0.5569
-    0.4078    0.4078    0.5603
-    0.4118    0.4118    0.5638
-    0.4118    0.4118    0.5671
-    0.4157    0.4157    0.5704
-    0.4196    0.4196    0.5736
-    0.4235    0.4235    0.5768
-    0.4275    0.4275    0.5799
-    0.4314    0.4314    0.5829
-    0.4314    0.4314    0.5859
-    0.4353    0.4353    0.5889
-    0.4392    0.4392    0.5917
-    0.4431    0.4431    0.5946
-    0.4471    0.4471    0.5973
-    0.4471    0.4471    0.6001
-    0.4510    0.4510    0.6027
-    0.4549    0.4549    0.6053
-    0.4588    0.4588    0.6079
-    0.4627    0.4627    0.6104
-    0.4627    0.4627    0.6129
-    0.4667    0.4667    0.6153
-    0.4706    0.4706    0.6176
-    0.4745    0.4745    0.6199
-    0.4745    0.4745    0.6222
-    0.4784    0.4784    0.6244
-    0.4824    0.4824    0.6266
-    0.4863    0.4863    0.6287
-    0.4863    0.4863    0.6308
-    0.4902    0.4902    0.6328
-    0.4941    0.4941    0.6348
-    0.4980    0.4980    0.6367
-    0.5020    0.5020    0.6386
-    0.5020    0.5020    0.6404
-    0.5059    0.5059    0.6422
-    0.5098    0.5098    0.6440
-    0.5098    0.5098    0.6457
-    0.5137    0.5137    0.6474
-    0.5176    0.5176    0.6490
-    0.5216    0.5216    0.6506
-    0.5216    0.5216    0.6521
-    0.5255    0.5255    0.6536
-    0.5294    0.5294    0.6551
-    0.5333    0.5333    0.6565
-    0.5333    0.5333    0.6578
-    0.5373    0.5373    0.6591
-    0.5412    0.5412    0.6604
-    0.5451    0.5451    0.6617
-    0.5451    0.5451    0.6629
-    0.5490    0.5490    0.6640
-    0.5529    0.5529    0.6651
-    0.5569    0.5569    0.6662
-    0.5569    0.5569    0.6672
-    0.5608    0.5608    0.6682
-    0.5647    0.5647    0.6692
-    0.5647    0.5647    0.6701
-    0.5686    0.5686    0.6710
-    0.5725    0.5725    0.6718
-    0.5765    0.5765    0.6726
-    0.5765    0.5765    0.6733
-    0.5804    0.5804    0.6740
-    0.5843    0.5843    0.6747
-    0.5843    0.5843    0.6753
-    0.5882    0.5882    0.6759
-    0.5922    0.5922    0.6765
-    0.5961    0.5961    0.6770
-    0.5961    0.5961    0.6774
-    0.6000    0.6000    0.6779
-    0.6039    0.6039    0.6783
-    0.6039    0.6039    0.6786
-    0.6078    0.6078    0.6789
-    0.6118    0.6118    0.6792
-    0.6157    0.6157    0.6794
-    0.6157    0.6157    0.6796
-    0.6196    0.6196    0.6798
-    0.6235    0.6235    0.6799
-    0.6235    0.6235    0.6800
-    0.6275    0.6275    0.6800
-    0.6314    0.6314    0.6800
-    0.6353    0.6353    0.6799
-    0.6353    0.6353    0.6799
-    0.6392    0.6392    0.6797
-    0.6431    0.6431    0.6796
-    0.6431    0.6431    0.6794
-    0.6471    0.6471    0.6791
-    0.6510    0.6510    0.6789
-    0.6549    0.6549    0.6785
-    0.6549    0.6549    0.6782
-    0.6588    0.6588    0.6778
-    0.6627    0.6627    0.6773
-    0.6627    0.6627    0.6769
-    0.6667    0.6667    0.6763
-    0.6706    0.6706    0.6758
-    0.6745    0.6745    0.6752
-    0.6745    0.6745    0.6746
-    0.6784    0.6784    0.6739
-    0.6824    0.6824    0.6732
-    0.6824    0.6824    0.6724
-    0.6863    0.6863    0.6716
-    0.6902    0.6902    0.6708
-    0.6941    0.6941    0.6699
-    0.6941    0.6941    0.6690
-    0.6980    0.6980    0.6680
-    0.7020    0.7020    0.6670
-    0.7020    0.7020    0.6660
-    0.7059    0.7059    0.6649
-    0.7098    0.7098    0.6638
-    0.7098    0.7098    0.6626
-    0.7137    0.7137    0.6614
-    0.7176    0.7176    0.6601
-    0.7216    0.7216    0.6589
-    0.7216    0.7216    0.6575
-    0.7255    0.7255    0.6561
-    0.7294    0.7294    0.6547
-    0.7294    0.7294    0.6533
-    0.7333    0.7333    0.6518
-    0.7373    0.7373    0.6502
-    0.7412    0.7412    0.6486
-    0.7412    0.7412    0.6470
-    0.7451    0.7451    0.6453
-    0.7490    0.7490    0.6436
-    0.7490    0.7490    0.6418
-    0.7529    0.7529    0.6400
-    0.7569    0.7569    0.6382
-    0.7608    0.7608    0.6363
-    0.7608    0.7608    0.6343
-    0.7647    0.7647    0.6324
-    0.7686    0.7686    0.6303
-    0.7686    0.7686    0.6282
-    0.7725    0.7725    0.6261
-    0.7765    0.7765    0.6239
-    0.7804    0.7804    0.6217
-    0.7804    0.7804    0.6194
-    0.7843    0.7843    0.6171
-    0.7882    0.7882    0.6147
-    0.7882    0.7882    0.6123
-    0.7922    0.7922    0.6098
-    0.7961    0.7961    0.6073
-    0.8000    0.8000    0.6047
-    0.8000    0.8000    0.6021
-    0.8039    0.8039    0.5994
-    0.8078    0.8078    0.5967
-    0.8078    0.8078    0.5939
-    0.8118    0.8118    0.5911
-    0.8157    0.8157    0.5882
-    0.8196    0.8196    0.5853
-    0.8196    0.8196    0.5823
-    0.8235    0.8235    0.5792
-    0.8275    0.8275    0.5761
-    0.8275    0.8275    0.5729
-    0.8314    0.8314    0.5697
-    0.8353    0.8353    0.5664
-    0.8392    0.8392    0.5630
-    0.8392    0.8392    0.5596
-    0.8431    0.8431    0.5561
-    0.8471    0.8471    0.5525
-    0.8471    0.8471    0.5489
-    0.8510    0.8510    0.5452
-    0.8549    0.8549    0.5414
-    0.8588    0.8588    0.5376
-    0.8588    0.8588    0.5337
-    0.8627    0.8627    0.5297
-    0.8667    0.8667    0.5257
-    0.8667    0.8667    0.5215
-    0.8706    0.8706    0.5173
-    0.8745    0.8745    0.5130
-    0.8784    0.8784    0.5086
-    0.8784    0.8784    0.5042
-    0.8824    0.8824    0.4996
-    0.8863    0.8863    0.4950
-    0.8863    0.8863    0.4902
-    0.8902    0.8902    0.4854
-    0.8941    0.8941    0.4804
-    0.8980    0.8980    0.4754
-    0.8980    0.8980    0.4702
-    0.9020    0.9020    0.4649
-    0.9059    0.9059    0.4595
-    0.9098    0.9098    0.4540
-    0.9098    0.9098    0.4484
-    0.9137    0.9137    0.4426
-    0.9176    0.9176    0.4366
-    0.9176    0.9176    0.4306
-    0.9216    0.9216    0.4243
-    0.9255    0.9255    0.4179
-    0.9294    0.9294    0.4114
-    0.9294    0.9294    0.4046
-    0.9333    0.9333    0.3977
-    0.9373    0.9373    0.3905
-    0.9373    0.9373    0.3831
-    0.9412    0.9412    0.3754
-    0.9451    0.9451    0.3675
-    0.9490    0.9490    0.3594
-    0.9490    0.9490    0.3509
-    0.9529    0.9529    0.3420
-    0.9569    0.9569    0.3328
-    0.9608    0.9608    0.3232
-    0.9608    0.9608    0.3131
-    0.9647    0.9647    0.3024
-    0.9686    0.9686    0.2912
-    0.9686    0.9686    0.2792
-    0.9725    0.9725    0.2664
-    0.9765    0.9765    0.2526
-    0.9804    0.9804    0.2375
-    0.9804    0.9804    0.2208
-    0.9843    0.9843    0.2020
-    0.9882    0.9882    0.1800
-    1.0       0.0       0.0
-    1.0       1.0       0.0
-    0.0       1.000     0.0
-&quot;&quot;&quot;
-colormapgray0 =  &quot;&quot;&quot;
-    0.0000    0.0000    0.0000
-    0.0039    0.0039    0.0039
-    0.0078    0.0078    0.0078
-    0.0118    0.0118    0.0118
-    0.0157    0.0157    0.0157
-    0.0196    0.0196    0.0196
-    0.0235    0.0235    0.0235
-    0.0275    0.0275    0.0275
-    0.0314    0.0314    0.0314
-    0.0353    0.0353    0.0353
-    0.0392    0.0392    0.0392
-    0.0431    0.0431    0.0431
-    0.0471    0.0471    0.0471
-    0.0510    0.0510    0.0510
-    0.0549    0.0549    0.0549
-    0.0588    0.0588    0.0588
-    0.0627    0.0627    0.0627
-    0.0667    0.0667    0.0667
-    0.0706    0.0706    0.0706
-    0.0745    0.0745    0.0745
-    0.0784    0.0784    0.0784
-    0.0824    0.0824    0.0824
-    0.0863    0.0863    0.0863
-    0.0902    0.0902    0.0902
-    0.0941    0.0941    0.0941
-    0.0980    0.0980    0.0980
-    0.1020    0.1020    0.1020
-    0.1059    0.1059    0.1059
-    0.1098    0.1098    0.1098
-    0.1137    0.1137    0.1137
-    0.1176    0.1176    0.1176
-    0.1216    0.1216    0.1216
-    0.1255    0.1255    0.1255
-    0.1294    0.1294    0.1294
-    0.1333    0.1333    0.1333
-    0.1373    0.1373    0.1373
-    0.1412    0.1412    0.1412
-    0.1451    0.1451    0.1451
-    0.1490    0.1490    0.1490
-    0.1529    0.1529    0.1529
-    0.1569    0.1569    0.1569
-    0.1608    0.1608    0.1608
-    0.1647    0.1647    0.1647
-    0.1686    0.1686    0.1686
-    0.1725    0.1725    0.1725
-    0.1765    0.1765    0.1765
-    0.1804    0.1804    0.1804
-    0.1843    0.1843    0.1843
-    0.1882    0.1882    0.1882
-    0.1922    0.1922    0.1922
-    0.1961    0.1961    0.1961
-    0.2000    0.2000    0.2000
-    0.2039    0.2039    0.2039
-    0.2078    0.2078    0.2078
-    0.2118    0.2118    0.2118
-    0.2157    0.2157    0.2157
-    0.2196    0.2196    0.2196
-    0.2235    0.2235    0.2235
-    0.2275    0.2275    0.2275
-    0.2314    0.2314    0.2314
-    0.2353    0.2353    0.2353
-    0.2392    0.2392    0.2392
-    0.2431    0.2431    0.2431
-    0.2471    0.2471    0.2471
-    0.2510    0.2510    0.2510
-    0.2549    0.2549    0.2549
-    0.2588    0.2588    0.2588
-    0.2627    0.2627    0.2627
-    0.2667    0.2667    0.2667
-    0.2706    0.2706    0.2706
-    0.2745    0.2745    0.2745
-    0.2784    0.2784    0.2784
-    0.2824    0.2824    0.2824
-    0.2863    0.2863    0.2863
-    0.2902    0.2902    0.2902
-    0.2941    0.2941    0.2941
-    0.2980    0.2980    0.2980
-    0.3020    0.3020    0.3020
-    0.3059    0.3059    0.3059
-    0.3098    0.3098    0.3098
-    0.3137    0.3137    0.3137
-    0.3176    0.3176    0.3176
-    0.3216    0.3216    0.3216
-    0.3255    0.3255    0.3255
-    0.3294    0.3294    0.3294
-    0.3333    0.3333    0.3333
-    0.3373    0.3373    0.3373
-    0.3412    0.3412    0.3412
-    0.3451    0.3451    0.3451
-    0.3490    0.3490    0.3490
-    0.3529    0.3529    0.3529
-    0.3569    0.3569    0.3569
-    0.3608    0.3608    0.3608
-    0.3647    0.3647    0.3647
-    0.3686    0.3686    0.3686
-    0.3725    0.3725    0.3725
-    0.3765    0.3765    0.3765
-    0.3804    0.3804    0.3804
-    0.3843    0.3843    0.3843
-    0.3882    0.3882    0.3882
-    0.3922    0.3922    0.3922
-    0.3961    0.3961    0.3961
-    0.4000    0.4000    0.4000
-    0.4039    0.4039    0.4039
-    0.4078    0.4078    0.4078
-    0.4118    0.4118    0.4118
-    0.4157    0.4157    0.4157
-    0.4196    0.4196    0.4196
-    0.4235    0.4235    0.4235
-    0.4275    0.4275    0.4275
-    0.4314    0.4314    0.4314
-    0.4353    0.4353    0.4353
-    0.4392    0.4392    0.4392
-    0.4431    0.4431    0.4431
-    0.4471    0.4471    0.4471
-    0.4510    0.4510    0.4510
-    0.4549    0.4549    0.4549
-    0.4588    0.4588    0.4588
-    0.4627    0.4627    0.4627
-    0.4667    0.4667    0.4667
-    0.4706    0.4706    0.4706
-    0.4745    0.4745    0.4745
-    0.4784    0.4784    0.4784
-    0.4824    0.4824    0.4824
-    0.4863    0.4863    0.4863
-    0.4902    0.4902    0.4902
-    0.4941    0.4941    0.4941
-    0.4980    0.4980    0.4980
-    0.5020    0.5020    0.5020
-    0.5059    0.5059    0.5059
-    0.5098    0.5098    0.5098
-    0.5137    0.5137    0.5137
-    0.5176    0.5176    0.5176
-    0.5216    0.5216    0.5216
-    0.5255    0.5255    0.5255
-    0.5294    0.5294    0.5294
-    0.5333    0.5333    0.5333
-    0.5373    0.5373    0.5373
-    0.5412    0.5412    0.5412
-    0.5451    0.5451    0.5451
-    0.5490    0.5490    0.5490
-    0.5529    0.5529    0.5529
-    0.5569    0.5569    0.5569
-    0.5608    0.5608    0.5608
-    0.5647    0.5647    0.5647
-    0.5686    0.5686    0.5686
-    0.5725    0.5725    0.5725
-    0.5765    0.5765    0.5765
-    0.5804    0.5804    0.5804
-    0.5843    0.5843    0.5843
-    0.5882    0.5882    0.5882
-    0.5922    0.5922    0.5922
-    0.5961    0.5961    0.5961
-    0.6000    0.6000    0.6000
-    0.6039    0.6039    0.6039
-    0.6078    0.6078    0.6078
-    0.6118    0.6118    0.6118
-    0.6157    0.6157    0.6157
-    0.6196    0.6196    0.6196
-    0.6235    0.6235    0.6235
-    0.6275    0.6275    0.6275
-    0.6314    0.6314    0.6314
-    0.6353    0.6353    0.6353
-    0.6392    0.6392    0.6392
-    0.6431    0.6431    0.6431
-    0.6471    0.6471    0.6471
-    0.6510    0.6510    0.6510
-    0.6549    0.6549    0.6549
-    0.6588    0.6588    0.6588
-    0.6627    0.6627    0.6627
-    0.6667    0.6667    0.6667
-    0.6706    0.6706    0.6706
-    0.6745    0.6745    0.6745
-    0.6784    0.6784    0.6784
-    0.6824    0.6824    0.6824
-    0.6863    0.6863    0.6863
-    0.6902    0.6902    0.6902
-    0.6941    0.6941    0.6941
-    0.6980    0.6980    0.6980
-    0.7020    0.7020    0.7020
-    0.7059    0.7059    0.7059
-    0.7098    0.7098    0.7098
-    0.7137    0.7137    0.7137
-    0.7176    0.7176    0.7176
-    0.7216    0.7216    0.7216
-    0.7255    0.7255    0.7255
-    0.7294    0.7294    0.7294
-    0.7333    0.7333    0.7333
-    0.7373    0.7373    0.7373
-    0.7412    0.7412    0.7412
-    0.7451    0.7451    0.7451
-    0.7490    0.7490    0.7490
-    0.7529    0.7529    0.7529
-    0.7569    0.7569    0.7569
-    0.7608    0.7608    0.7608
-    0.7647    0.7647    0.7647
-    0.7686    0.7686    0.7686
-    0.7725    0.7725    0.7725
-    0.7765    0.7765    0.7765
-    0.7804    0.7804    0.7804
-    0.7843    0.7843    0.7843
-    0.7882    0.7882    0.7882
-    0.7922    0.7922    0.7922
-    0.7961    0.7961    0.7961
-    0.8000    0.8000    0.8000
-    0.8039    0.8039    0.8039
-    0.8078    0.8078    0.8078
-    0.8118    0.8118    0.8118
-    0.8157    0.8157    0.8157
-    0.8196    0.8196    0.8196
-    0.8235    0.8235    0.8235
-    0.8275    0.8275    0.8275
-    0.8314    0.8314    0.8314
-    0.8353    0.8353    0.8353
-    0.8392    0.8392    0.8392
-    0.8431    0.8431    0.8431
-    0.8471    0.8471    0.8471
-    0.8510    0.8510    0.8510
-    0.8549    0.8549    0.8549
-    0.8588    0.8588    0.8588
-    0.8627    0.8627    0.8627
-    0.8667    0.8667    0.8667
-    0.8706    0.8706    0.8706
-    0.8745    0.8745    0.8745
-    0.8784    0.8784    0.8784
-    0.8824    0.8824    0.8824
-    0.8863    0.8863    0.8863
-    0.8902    0.8902    0.8902
-    0.8941    0.8941    0.8941
-    0.8980    0.8980    0.8980
-    0.9020    0.9020    0.9020
-    0.9059    0.9059    0.9059
-    0.9098    0.9098    0.9098
-    0.9137    0.9137    0.9137
-    0.9176    0.9176    0.9176
-    0.9216    0.9216    0.9216
-    0.9255    0.9255    0.9255
-    0.9294    0.9294    0.9294
-    0.9333    0.9333    0.9333
-    0.9373    0.9373    0.9373
-    0.9412    0.9412    0.9412
-    0.9451    0.9451    0.9451
-    0.9490    0.9490    0.9490
-    0.9529    0.9529    0.9529
-    0.9569    0.9569    0.9569
-    0.9608    0.9608    0.9608
-    0.9647    0.9647    0.9647
-    0.9686    0.9686    0.9686
-    0.9725    0.9725    0.9725
-    0.9765    0.9765    0.9765
-    0.9804    0.9804    0.9804
-    0.9843    0.9843    0.9843
-    0.9882    0.9882    0.9882
-    1.0       0.0       0.0
-    1.0       1.0       0.0
-    0.0       1.000    0.0
-&quot;&quot;&quot;
-
-colormapHot=&quot;&quot;&quot;
-    0.0000    0.0000    0.0000
-    0.0118    0.0000    0.0000
-    0.0235    0.0000    0.0000
-    0.0353    0.0000    0.0000
-    0.0471    0.0000    0.0000
-    0.0588    0.0000    0.0000
-    0.0706    0.0000    0.0000
-    0.0824    0.0000    0.0000
-    0.0941    0.0000    0.0000
-    0.1059    0.0000    0.0000
-    0.1176    0.0000    0.0000
-    0.1294    0.0000    0.0000
-    0.1412    0.0000    0.0000
-    0.1529    0.0000    0.0000
-    0.1647    0.0000    0.0000
-    0.1765    0.0000    0.0000
-    0.1882    0.0000    0.0000
-    0.2000    0.0000    0.0000
-    0.2118    0.0000    0.0000
-    0.2235    0.0000    0.0000
-    0.2353    0.0000    0.0000
-    0.2471    0.0000    0.0000
-    0.2588    0.0000    0.0000
-    0.2706    0.0000    0.0000
-    0.2824    0.0000    0.0000
-    0.2941    0.0000    0.0000
-    0.3059    0.0000    0.0000
-    0.3176    0.0000    0.0000
-    0.3294    0.0000    0.0000
-    0.3412    0.0000    0.0000
-    0.3529    0.0000    0.0000
-    0.3647    0.0000    0.0000
-    0.3765    0.0000    0.0000
-    0.3882    0.0000    0.0000
-    0.4000    0.0000    0.0000
-    0.4118    0.0000    0.0000
-    0.4235    0.0000    0.0000
-    0.4353    0.0000    0.0000
-    0.4471    0.0000    0.0000
-    0.4588    0.0000    0.0000
-    0.4706    0.0000    0.0000
-    0.4824    0.0000    0.0000
-    0.4941    0.0000    0.0000
-    0.5059    0.0000    0.0000
-    0.5176    0.0000    0.0000
-    0.5294    0.0000    0.0000
-    0.5412    0.0000    0.0000
-    0.5529    0.0000    0.0000
-    0.5647    0.0000    0.0000
-    0.5765    0.0000    0.0000
-    0.5882    0.0000    0.0000
-    0.6000    0.0000    0.0000
-    0.6118    0.0000    0.0000
-    0.6235    0.0000    0.0000
-    0.6353    0.0000    0.0000
-    0.6471    0.0000    0.0000
-    0.6588    0.0000    0.0000
-    0.6706    0.0000    0.0000
-    0.6824    0.0000    0.0000
-    0.6941    0.0000    0.0000
-    0.7059    0.0000    0.0000
-    0.7176    0.0000    0.0000
-    0.7294    0.0000    0.0000
-    0.7412    0.0000    0.0000
-    0.7529    0.0000    0.0000
-    0.7647    0.0000    0.0000
-    0.7765    0.0000    0.0000
-    0.7882    0.0000    0.0000
-    0.8000    0.0000    0.0000
-    0.8118    0.0000    0.0000
-    0.8235    0.0000    0.0000
-    0.8353    0.0000    0.0000
-    0.8471    0.0000    0.0000
-    0.8588    0.0000    0.0000
-    0.8706    0.0000    0.0000
-    0.8824    0.0000    0.0000
-    0.8941    0.0000    0.0000
-    0.9059    0.0000    0.0000
-    0.9176    0.0000    0.0000
-    0.9294    0.0000    0.0000
-    0.9412    0.0000    0.0000
-    0.9529    0.0000    0.0000
-    0.9647    0.0000    0.0000
-    0.9765    0.0000    0.0000
-    0.9882    0.0000    0.0000
-    1.0000    0.0000    0.0000
-    1.0000    0.0118    0.0000
-    1.0000    0.0235    0.0000
-    1.0000    0.0353    0.0000
-    1.0000    0.0471    0.0000
-    1.0000    0.0588    0.0000
-    1.0000    0.0706    0.0000
-    1.0000    0.0824    0.0000
-    1.0000    0.0941    0.0000
-    1.0000    0.1059    0.0000
-    1.0000    0.1176    0.0000
-    1.0000    0.1294    0.0000
-    1.0000    0.1412    0.0000
-    1.0000    0.1529    0.0000
-    1.0000    0.1647    0.0000
-    1.0000    0.1765    0.0000
-    1.0000    0.1882    0.0000
-    1.0000    0.2000    0.0000
-    1.0000    0.2118    0.0000
-    1.0000    0.2235    0.0000
-    1.0000    0.2353    0.0000
-    1.0000    0.2471    0.0000
-    1.0000    0.2588    0.0000
-    1.0000    0.2706    0.0000
-    1.0000    0.2824    0.0000
-    1.0000    0.2941    0.0000
-    1.0000    0.3059    0.0000
-    1.0000    0.3176    0.0000
-    1.0000    0.3294    0.0000
-    1.0000    0.3412    0.0000
-    1.0000    0.3529    0.0000
-    1.0000    0.3647    0.0000
-    1.0000    0.3765    0.0000
-    1.0000    0.3882    0.0000
-    1.0000    0.4000    0.0000
-    1.0000    0.4118    0.0000
-    1.0000    0.4235    0.0000
-    1.0000    0.4353    0.0000
-    1.0000    0.4471    0.0000
-    1.0000    0.4588    0.0000
-    1.0000    0.4706    0.0000
-    1.0000    0.4824    0.0000
-    1.0000    0.4941    0.0000
-    1.0000    0.5059    0.0000
-    1.0000    0.5176    0.0000
-    1.0000    0.5294    0.0000
-    1.0000    0.5412    0.0000
-    1.0000    0.5529    0.0000
-    1.0000    0.5647    0.0000
-    1.0000    0.5765    0.0000
-    1.0000    0.5882    0.0000
-    1.0000    0.6000    0.0000
-    1.0000    0.6118    0.0000
-    1.0000    0.6235    0.0000
-    1.0000    0.6353    0.0000
-    1.0000    0.6471    0.0000
-    1.0000    0.6588    0.0000
-    1.0000    0.6706    0.0000
-    1.0000    0.6824    0.0000
-    1.0000    0.6941    0.0000
-    1.0000    0.7059    0.0000
-    1.0000    0.7176    0.0000
-    1.0000    0.7294    0.0000
-    1.0000    0.7412    0.0000
-    1.0000    0.7529    0.0000
-    1.0000    0.7647    0.0000
-    1.0000    0.7765    0.0000
-    1.0000    0.7882    0.0000
-    1.0000    0.8000    0.0000
-    1.0000    0.8118    0.0000
-    1.0000    0.8235    0.0000
-    1.0000    0.8353    0.0000
-    1.0000    0.8471    0.0000
-    1.0000    0.8588    0.0000
-    1.0000    0.8706    0.0000
-    1.0000    0.8824    0.0000
-    1.0000    0.8941    0.0000
-    1.0000    0.9059    0.0000
-    1.0000    0.9176    0.0000
-    1.0000    0.9294    0.0000
-    1.0000    0.9412    0.0000
-    1.0000    0.9529    0.0000
-    1.0000    0.9647    0.0000
-    1.0000    0.9765    0.0000
-    1.0000    0.9882    0.0000
-    1.0000    1.0000    0.0000
-    1.0000    1.0000    0.0118
-    1.0000    1.0000    0.0235
-    1.0000    1.0000    0.0353
-    1.0000    1.0000    0.0471
-    1.0000    1.0000    0.0588
-    1.0000    1.0000    0.0706
-    1.0000    1.0000    0.0824
-    1.0000    1.0000    0.0941
-    1.0000    1.0000    0.1059
-    1.0000    1.0000    0.1176
-    1.0000    1.0000    0.1294
-    1.0000    1.0000    0.1412
-    1.0000    1.0000    0.1529
-    1.0000    1.0000    0.1647
-    1.0000    1.0000    0.1765
-    1.0000    1.0000    0.1882
-    1.0000    1.0000    0.2000
-    1.0000    1.0000    0.2118
-    1.0000    1.0000    0.2235
-    1.0000    1.0000    0.2353
-    1.0000    1.0000    0.2471
-    1.0000    1.0000    0.2588
-    1.0000    1.0000    0.2706
-    1.0000    1.0000    0.2824
-    1.0000    1.0000    0.2941
-    1.0000    1.0000    0.3059
-    1.0000    1.0000    0.3176
-    1.0000    1.0000    0.3294
-    1.0000    1.0000    0.3412
-    1.0000    1.0000    0.3529
-    1.0000    1.0000    0.3647
-    1.0000    1.0000    0.3765
-    1.0000    1.0000    0.3882
-    1.0000    1.0000    0.4000
-    1.0000    1.0000    0.4118
-    1.0000    1.0000    0.4235
-    1.0000    1.0000    0.4353
-    1.0000    1.0000    0.4471
-    1.0000    1.0000    0.4588
-    1.0000    1.0000    0.4706
-    1.0000    1.0000    0.4824
-    1.0000    1.0000    0.4941
-    1.0000    1.0000    0.5059
-    1.0000    1.0000    0.5176
-    1.0000    1.0000    0.5294
-    1.0000    1.0000    0.5412
-    1.0000    1.0000    0.5529
-    1.0000    1.0000    0.5647
-    1.0000    1.0000    0.5765
-    1.0000    1.0000    0.5882
-    1.0000    1.0000    0.6000
-    1.0000    1.0000    0.6118
-    1.0000    1.0000    0.6235
-    1.0000    1.0000    0.6353
-    1.0000    1.0000    0.6471
-    1.0000    1.0000    0.6588
-    1.0000    1.0000    0.6706
-    1.0000    1.0000    0.6824
-    1.0000    1.0000    0.6941
-    1.0000    1.0000    0.7059
-    1.0000    1.0000    0.7176
-    1.0000    1.0000    0.7294
-    1.0000    1.0000    0.7412
-    1.0000    1.0000    0.7529
-    1.0000    1.0000    0.7647
-    1.0000    1.0000    0.7765
-    1.0000    1.0000    0.7882
-    1.0000    1.0000    0.8000
-    1.0000    1.0000    0.8118
-    1.0000    1.0000    0.8235
-    1.0000    1.0000    0.8353
-    1.0000    1.0000    0.8471
-    1.0000    1.0000    0.8588
-    1.0000    1.0000    0.8706
-    1.0000    1.0000    0.8824
-    1.0000    1.0000    0.8941
-    1.0000    1.0000    0.9059
-    1.0000    1.0000    0.9176
-    1.0000    1.0000    0.9294
-    1.0000    1.0000    0.9412
-    1.0000    1.0000    0.9529
-    1.0000    1.0000    0.9647
-    1.0       0.0       0.0
-    1.0       1.0       0.0
-    0.0       1.000     0.0
-&quot;&quot;&quot;
-
-colormapAFMHot=&quot;&quot;&quot;
-    0.0000    0.0000    0.0000
-    0.0078    0.0000    0.0000
-    0.0157    0.0000    0.0000
-    0.0235    0.0000    0.0000
-    0.0314    0.0000    0.0000
-    0.0392    0.0000    0.0000
-    0.0471    0.0000    0.0000
-    0.0549    0.0000    0.0000
-    0.0627    0.0000    0.0000
-    0.0706    0.0000    0.0000
-    0.0784    0.0000    0.0000
-    0.0863    0.0000    0.0000
-    0.0941    0.0000    0.0000
-    0.1020    0.0000    0.0000
-    0.1098    0.0000    0.0000
-    0.1176    0.0000    0.0000
-    0.1255    0.0000    0.0000
-    0.1333    0.0000    0.0000
-    0.1412    0.0000    0.0000
-    0.1490    0.0000    0.0000
-    0.1569    0.0000    0.0000
-    0.1647    0.0000    0.0000
-    0.1725    0.0000    0.0000
-    0.1804    0.0000    0.0000
-    0.1882    0.0000    0.0000
-    0.1961    0.0000    0.0000
-    0.2039    0.0000    0.0000
-    0.2118    0.0000    0.0000
-    0.2196    0.0000    0.0000
-    0.2275    0.0000    0.0000
-    0.2353    0.0000    0.0000
-    0.2431    0.0000    0.0000
-    0.2510    0.0000    0.0000
-    0.2588    0.0000    0.0000
-    0.2667    0.0000    0.0000
-    0.2745    0.0000    0.0000
-    0.2824    0.0000    0.0000
-    0.2902    0.0000    0.0000
-    0.2980    0.0000    0.0000
-    0.3059    0.0000    0.0000
-    0.3137    0.0000    0.0000
-    0.3216    0.0000    0.0000
-    0.3294    0.0000    0.0000
-    0.3373    0.0000    0.0000
-    0.3451    0.0000    0.0000
-    0.3529    0.0000    0.0000
-    0.3608    0.0000    0.0000
-    0.3686    0.0000    0.0000
-    0.3765    0.0000    0.0000
-    0.3843    0.0000    0.0000
-    0.3922    0.0000    0.0000
-    0.4000    0.0000    0.0000
-    0.4078    0.0000    0.0000
-    0.4157    0.0000    0.0000
-    0.4235    0.0000    0.0000
-    0.4314    0.0000    0.0000
-    0.4392    0.0000    0.0000
-    0.4471    0.0000    0.0000
-    0.4549    0.0000    0.0000
-    0.4627    0.0000    0.0000
-    0.4706    0.0000    0.0000
-    0.4784    0.0000    0.0000
-    0.4863    0.0000    0.0000
-    0.4941    0.0000    0.0000
-    0.5020    0.0000    0.0000
-    0.5098    0.0098    0.0000
-    0.5176    0.0176    0.0000
-    0.5255    0.0255    0.0000
-    0.5333    0.0333    0.0000
-    0.5412    0.0412    0.0000
-    0.5490    0.0490    0.0000
-    0.5569    0.0569    0.0000
-    0.5647    0.0647    0.0000
-    0.5725    0.0725    0.0000
-    0.5804    0.0804    0.0000
-    0.5882    0.0882    0.0000
-    0.5961    0.0961    0.0000
-    0.6039    0.1039    0.0000
-    0.6118    0.1118    0.0000
-    0.6196    0.1196    0.0000
-    0.6275    0.1275    0.0000
-    0.6353    0.1353    0.0000
-    0.6431    0.1431    0.0000
-    0.6510    0.1510    0.0000
-    0.6588    0.1588    0.0000
-    0.6667    0.1667    0.0000
-    0.6745    0.1745    0.0000
-    0.6824    0.1824    0.0000
-    0.6902    0.1902    0.0000
-    0.6980    0.1980    0.0000
-    0.7059    0.2059    0.0000
-    0.7137    0.2137    0.0000
-    0.7216    0.2216    0.0000
-    0.7294    0.2294    0.0000
-    0.7373    0.2373    0.0000
-    0.7451    0.2451    0.0000
-    0.7529    0.2529    0.0000
-    0.7608    0.2608    0.0000
-    0.7686    0.2686    0.0000
-    0.7765    0.2765    0.0000
-    0.7843    0.2843    0.0000
-    0.7922    0.2922    0.0000
-    0.8000    0.3000    0.0000
-    0.8078    0.3078    0.0000
-    0.8157    0.3157    0.0000
-    0.8235    0.3235    0.0000
-    0.8314    0.3314    0.0000
-    0.8392    0.3392    0.0000
-    0.8471    0.3471    0.0000
-    0.8549    0.3549    0.0000
-    0.8627    0.3627    0.0000
-    0.8706    0.3706    0.0000
-    0.8784    0.3784    0.0000
-    0.8863    0.3863    0.0000
-    0.8941    0.3941    0.0000
-    0.9020    0.4020    0.0000
-    0.9098    0.4098    0.0000
-    0.9176    0.4176    0.0000
-    0.9255    0.4255    0.0000
-    0.9333    0.4333    0.0000
-    0.9412    0.4412    0.0000
-    0.9490    0.4490    0.0000
-    0.9569    0.4569    0.0000
-    0.9647    0.4647    0.0000
-    0.9725    0.4725    0.0000
-    0.9804    0.4804    0.0000
-    0.9882    0.4882    0.0000
-    0.9961    0.4961    0.0000
-    1.0000    0.5039    0.0000
-    1.0000    0.5118    0.0118
-    1.0000    0.5196    0.0196
-    1.0000    0.5275    0.0275
-    1.0000    0.5353    0.0353
-    1.0000    0.5431    0.0431
-    1.0000    0.5510    0.0510
-    1.0000    0.5588    0.0588
-    1.0000    0.5667    0.0667
-    1.0000    0.5745    0.0745
-    1.0000    0.5824    0.0824
-    1.0000    0.5902    0.0902
-    1.0000    0.5980    0.0980
-    1.0000    0.6059    0.1059
-    1.0000    0.6137    0.1137
-    1.0000    0.6216    0.1216
-    1.0000    0.6294    0.1294
-    1.0000    0.6373    0.1373
-    1.0000    0.6451    0.1451
-    1.0000    0.6529    0.1529
-    1.0000    0.6608    0.1608
-    1.0000    0.6686    0.1686
-    1.0000    0.6765    0.1765
-    1.0000    0.6843    0.1843
-    1.0000    0.6922    0.1922
-    1.0000    0.7000    0.2000
-    1.0000    0.7078    0.2078
-    1.0000    0.7157    0.2157
-    1.0000    0.7235    0.2235
-    1.0000    0.7314    0.2314
-    1.0000    0.7392    0.2392
-    1.0000    0.7471    0.2471
-    1.0000    0.7549    0.2549
-    1.0000    0.7627    0.2627
-    1.0000    0.7706    0.2706
-    1.0000    0.7784    0.2784
-    1.0000    0.7863    0.2863
-    1.0000    0.7941    0.2941
-    1.0000    0.8020    0.3020
-    1.0000    0.8098    0.3098
-    1.0000    0.8176    0.3176
-    1.0000    0.8255    0.3255
-    1.0000    0.8333    0.3333
-    1.0000    0.8412    0.3412
-    1.0000    0.8490    0.3490
-    1.0000    0.8569    0.3569
-    1.0000    0.8647    0.3647
-    1.0000    0.8725    0.3725
-    1.0000    0.8804    0.3804
-    1.0000    0.8882    0.3882
-    1.0000    0.8961    0.3961
-    1.0000    0.9039    0.4039
-    1.0000    0.9118    0.4118
-    1.0000    0.9196    0.4196
-    1.0000    0.9275    0.4275
-    1.0000    0.9353    0.4353
-    1.0000    0.9431    0.4431
-    1.0000    0.9510    0.4510
-    1.0000    0.9588    0.4588
-    1.0000    0.9667    0.4667
-    1.0000    0.9745    0.4745
-    1.0000    0.9824    0.4824
-    1.0000    0.9902    0.4902
-    1.0000    0.9980    0.4980
-    1.0000    1.0000    0.5059
-    1.0000    1.0000    0.5137
-    1.0000    1.0000    0.5216
-    1.0000    1.0000    0.5294
-    1.0000    1.0000    0.5373
-    1.0000    1.0000    0.5451
-    1.0000    1.0000    0.5529
-    1.0000    1.0000    0.5608
-    1.0000    1.0000    0.5686
-    1.0000    1.0000    0.5765
-    1.0000    1.0000    0.5843
-    1.0000    1.0000    0.5922
-    1.0000    1.0000    0.6000
-    1.0000    1.0000    0.6078
-    1.0000    1.0000    0.6157
-    1.0000    1.0000    0.6235
-    1.0000    1.0000    0.6314
-    1.0000    1.0000    0.6392
-    1.0000    1.0000    0.6471
-    1.0000    1.0000    0.6549
-    1.0000    1.0000    0.6627
-    1.0000    1.0000    0.6706
-    1.0000    1.0000    0.6784
-    1.0000    1.0000    0.6863
-    1.0000    1.0000    0.6941
-    1.0000    1.0000    0.7020
-    1.0000    1.0000    0.7098
-    1.0000    1.0000    0.7176
-    1.0000    1.0000    0.7255
-    1.0000    1.0000    0.7333
-    1.0000    1.0000    0.7412
-    1.0000    1.0000    0.7490
-    1.0000    1.0000    0.7569
-    1.0000    1.0000    0.7647
-    1.0000    1.0000    0.7725
-    1.0000    1.0000    0.7804
-    1.0000    1.0000    0.7882
-    1.0000    1.0000    0.7961
-    1.0000    1.0000    0.8039
-    1.0000    1.0000    0.8118
-    1.0000    1.0000    0.8196
-    1.0000    1.0000    0.8275
-    1.0000    1.0000    0.8353
-    1.0000    1.0000    0.8431
-    1.0000    1.0000    0.8510
-    1.0000    1.0000    0.8588
-    1.0000    1.0000    0.8667
-    1.0000    1.0000    0.8745
-    1.0000    1.0000    0.8824
-    1.0000    1.0000    0.8902
-    1.0000    1.0000    0.8980
-    1.0000    1.0000    0.9059
-    1.0000    1.0000    0.9137
-    1.0000    1.0000    0.9216
-    1.0000    1.0000    0.9294
-    1.0000    1.0000    0.9373
-    1.0000    1.0000    0.9451
-    1.0000    1.0000    0.9529
-    1.0000    1.0000    0.9608
-    1.0000    1.0000    0.9686
-    1.0000    1.0000    0.9765
-    1.0       0.0       0.0
-    1.0       1.0       0.0
-    0.0       1.000     0.0
-&quot;&quot;&quot;
-colormapgray1 =  &quot;&quot;&quot;
-    1.0000    1.0000    1.0000
-    0.9961    0.9961    0.9961
-    0.9922    0.9922    0.9922
-    0.9882    0.9882    0.9882
-    0.9843    0.9843    0.9843
-    0.9804    0.9804    0.9804
-    0.9765    0.9765    0.9765
-    0.9725    0.9725    0.9725
-    0.9686    0.9686    0.9686
-    0.9647    0.9647    0.9647
-    0.9608    0.9608    0.9608
-    0.9569    0.9569    0.9569
-    0.9529    0.9529    0.9529
-    0.9490    0.9490    0.9490
-    0.9451    0.9451    0.9451
-    0.9412    0.9412    0.9412
-    0.9373    0.9373    0.9373
-    0.9333    0.9333    0.9333
-    0.9294    0.9294    0.9294
-    0.9255    0.9255    0.9255
-    0.9216    0.9216    0.9216
-    0.9176    0.9176    0.9176
-    0.9137    0.9137    0.9137
-    0.9098    0.9098    0.9098
-    0.9059    0.9059    0.9059
-    0.9020    0.9020    0.9020
-    0.8980    0.8980    0.8980
-    0.8941    0.8941    0.8941
-    0.8902    0.8902    0.8902
-    0.8863    0.8863    0.8863
-    0.8824    0.8824    0.8824
-    0.8784    0.8784    0.8784
-    0.8745    0.8745    0.8745
-    0.8706    0.8706    0.8706
-    0.8667    0.8667    0.8667
-    0.8627    0.8627    0.8627
-    0.8588    0.8588    0.8588
-    0.8549    0.8549    0.8549
-    0.8510    0.8510    0.8510
-    0.8471    0.8471    0.8471
-    0.8431    0.8431    0.8431
-    0.8392    0.8392    0.8392
-    0.8353    0.8353    0.8353
-    0.8314    0.8314    0.8314
-    0.8275    0.8275    0.8275
-    0.8235    0.8235    0.8235
-    0.8196    0.8196    0.8196
-    0.8157    0.8157    0.8157
-    0.8118    0.8118    0.8118
-    0.8078    0.8078    0.8078
-    0.8039    0.8039    0.8039
-    0.8000    0.8000    0.8000
-    0.7961    0.7961    0.7961
-    0.7922    0.7922    0.7922
-    0.7882    0.7882    0.7882
-    0.7843    0.7843    0.7843
-    0.7804    0.7804    0.7804
-    0.7765    0.7765    0.7765
-    0.7725    0.7725    0.7725
-    0.7686    0.7686    0.7686
-    0.7647    0.7647    0.7647
-    0.7608    0.7608    0.7608
-    0.7569    0.7569    0.7569
-    0.7529    0.7529    0.7529
-    0.7490    0.7490    0.7490
-    0.7451    0.7451    0.7451
-    0.7412    0.7412    0.7412
-    0.7373    0.7373    0.7373
-    0.7333    0.7333    0.7333
-    0.7294    0.7294    0.7294
-    0.7255    0.7255    0.7255
-    0.7216    0.7216    0.7216
-    0.7176    0.7176    0.7176
-    0.7137    0.7137    0.7137
-    0.7098    0.7098    0.7098
-    0.7059    0.7059    0.7059
-    0.7020    0.7020    0.7020
-    0.6980    0.6980    0.6980
-    0.6941    0.6941    0.6941
-    0.6902    0.6902    0.6902
-    0.6863    0.6863    0.6863
-    0.6824    0.6824    0.6824
-    0.6784    0.6784    0.6784
-    0.6745    0.6745    0.6745
-    0.6706    0.6706    0.6706
-    0.6667    0.6667    0.6667
-    0.6627    0.6627    0.6627
-    0.6588    0.6588    0.6588
-    0.6549    0.6549    0.6549
-    0.6510    0.6510    0.6510
-    0.6471    0.6471    0.6471
-    0.6431    0.6431    0.6431
-    0.6392    0.6392    0.6392
-    0.6353    0.6353    0.6353
-    0.6314    0.6314    0.6314
-    0.6275    0.6275    0.6275
-    0.6235    0.6235    0.6235
-    0.6196    0.6196    0.6196
-    0.6157    0.6157    0.6157
-    0.6118    0.6118    0.6118
-    0.6078    0.6078    0.6078
-    0.6039    0.6039    0.6039
-    0.6000    0.6000    0.6000
-    0.5961    0.5961    0.5961
-    0.5922    0.5922    0.5922
-    0.5882    0.5882    0.5882
-    0.5843    0.5843    0.5843
-    0.5804    0.5804    0.5804
-    0.5765    0.5765    0.5765
-    0.5725    0.5725    0.5725
-    0.5686    0.5686    0.5686
-    0.5647    0.5647    0.5647
-    0.5608    0.5608    0.5608
-    0.5569    0.5569    0.5569
-    0.5529    0.5529    0.5529
-    0.5490    0.5490    0.5490
-    0.5451    0.5451    0.5451
-    0.5412    0.5412    0.5412
-    0.5373    0.5373    0.5373
-    0.5333    0.5333    0.5333
-    0.5294    0.5294    0.5294
-    0.5255    0.5255    0.5255
-    0.5216    0.5216    0.5216
-    0.5176    0.5176    0.5176
-    0.5137    0.5137    0.5137
-    0.5098    0.5098    0.5098
-    0.5059    0.5059    0.5059
-    0.5020    0.5020    0.5020
-    0.4980    0.4980    0.4980
-    0.4941    0.4941    0.4941
-    0.4902    0.4902    0.4902
-    0.4863    0.4863    0.4863
-    0.4824    0.4824    0.4824
-    0.4784    0.4784    0.4784
-    0.4745    0.4745    0.4745
-    0.4706    0.4706    0.4706
-    0.4667    0.4667    0.4667
-    0.4627    0.4627    0.4627
-    0.4588    0.4588    0.4588
-    0.4549    0.4549    0.4549
-    0.4510    0.4510    0.4510
-    0.4471    0.4471    0.4471
-    0.4431    0.4431    0.4431
-    0.4392    0.4392    0.4392
-    0.4353    0.4353    0.4353
-    0.4314    0.4314    0.4314
-    0.4275    0.4275    0.4275
-    0.4235    0.4235    0.4235
-    0.4196    0.4196    0.4196
-    0.4157    0.4157    0.4157
-    0.4118    0.4118    0.4118
-    0.4078    0.4078    0.4078
-    0.4039    0.4039    0.4039
-    0.4000    0.4000    0.4000
-    0.3961    0.3961    0.3961
-    0.3922    0.3922    0.3922
-    0.3882    0.3882    0.3882
-    0.3843    0.3843    0.3843
-    0.3804    0.3804    0.3804
-    0.3765    0.3765    0.3765
-    0.3725    0.3725    0.3725
-    0.3686    0.3686    0.3686
-    0.3647    0.3647    0.3647
-    0.3608    0.3608    0.3608
-    0.3569    0.3569    0.3569
-    0.3529    0.3529    0.3529
-    0.3490    0.3490    0.3490
-    0.3451    0.3451    0.3451
-    0.3412    0.3412    0.3412
-    0.3373    0.3373    0.3373
-    0.3333    0.3333    0.3333
-    0.3294    0.3294    0.3294
-    0.3255    0.3255    0.3255
-    0.3216    0.3216    0.3216
-    0.3176    0.3176    0.3176
-    0.3137    0.3137    0.3137
-    0.3098    0.3098    0.3098
-    0.3059    0.3059    0.3059
-    0.3020    0.3020    0.3020
-    0.2980    0.2980    0.2980
-    0.2941    0.2941    0.2941
-    0.2902    0.2902    0.2902
-    0.2863    0.2863    0.2863
-    0.2824    0.2824    0.2824
-    0.2784    0.2784    0.2784
-    0.2745    0.2745    0.2745
-    0.2706    0.2706    0.2706
-    0.2667    0.2667    0.2667
-    0.2627    0.2627    0.2627
-    0.2588    0.2588    0.2588
-    0.2549    0.2549    0.2549
-    0.2510    0.2510    0.2510
-    0.2471    0.2471    0.2471
-    0.2431    0.2431    0.2431
-    0.2392    0.2392    0.2392
-    0.2353    0.2353    0.2353
-    0.2314    0.2314    0.2314
-    0.2275    0.2275    0.2275
-    0.2235    0.2235    0.2235
-    0.2196    0.2196    0.2196
-    0.2157    0.2157    0.2157
-    0.2118    0.2118    0.2118
-    0.2078    0.2078    0.2078
-    0.2039    0.2039    0.2039
-    0.2000    0.2000    0.2000
-    0.1961    0.1961    0.1961
-    0.1922    0.1922    0.1922
-    0.1882    0.1882    0.1882
-    0.1843    0.1843    0.1843
-    0.1804    0.1804    0.1804
-    0.1765    0.1765    0.1765
-    0.1725    0.1725    0.1725
-    0.1686    0.1686    0.1686
-    0.1647    0.1647    0.1647
-    0.1608    0.1608    0.1608
-    0.1569    0.1569    0.1569
-    0.1529    0.1529    0.1529
-    0.1490    0.1490    0.1490
-    0.1451    0.1451    0.1451
-    0.1412    0.1412    0.1412
-    0.1373    0.1373    0.1373
-    0.1333    0.1333    0.1333
-    0.1294    0.1294    0.1294
-    0.1255    0.1255    0.1255
-    0.1216    0.1216    0.1216
-    0.1176    0.1176    0.1176
-    0.1137    0.1137    0.1137
-    0.1098    0.1098    0.1098
-    0.1059    0.1059    0.1059
-    0.1020    0.1020    0.1020
-    0.0980    0.0980    0.0980
-    0.0941    0.0941    0.0941
-    0.0902    0.0902    0.0902
-    0.0863    0.0863    0.0863
-    0.0824    0.0824    0.0824
-    0.0784    0.0784    0.0784
-    0.0745    0.0745    0.0745
-    0.0706    0.0706    0.0706
-    0.0667    0.0667    0.0667
-    0.0627    0.0627    0.0627
-    0.0588    0.0588    0.0588
-    0.0549    0.0549    0.0549
-    0.0510    0.0510    0.0510
-    0.0471    0.0471    0.0471
-    0.0431    0.0431    0.0431
-    0.0392    0.0392    0.0392
-    0.0353    0.0353    0.0353
-    0.0314    0.0314    0.0314
-    0.0275    0.0275    0.0275
-    0.0235    0.0235    0.0235
-    0.0196    0.0196    0.0196
-    0.0157    0.0157    0.0157
-    0.0118    0.0118    0.0118
-    1.0       0.0       0.0
-    1.0       1.0       0.0
-    0.0       1.000     0.0
-&quot;&quot;&quot;
-colormapLinrad =  &quot;&quot;&quot;
-    0.0000    0.0000    0.0000
-    0.0000    0.0000    0.0123
-    0.0000    0.0000    0.0246
-    0.0000    0.0000    0.0368
-    0.0000    0.0000    0.0490
-    0.0000    0.0000    0.0612
-    0.0000    0.0000    0.0734
-    0.0000    0.0000    0.0855
-    0.0000    0.0000    0.0975
-    0.0000    0.0000    0.1094
-    0.0000    0.0000    0.1213
-    0.0000    0.0000    0.1331
-    0.0000    0.0000    0.1448
-    0.0000    0.0000    0.1564
-    0.0000    0.0000    0.1678
-    0.0000    0.0000    0.1792
-    0.0000    0.0000    0.1904
-    0.0000    0.0000    0.2015
-    0.0000    0.0000    0.2124
-    0.0000    0.0000    0.2232
-    0.0000    0.0000    0.2338
-    0.0000    0.0000    0.2442
-    0.0000    0.0000    0.2545
-    0.0000    0.0000    0.2645
-    0.0000    0.0000    0.2744
-    0.0000    0.0000    0.2841
-    0.0000    0.0000    0.2935
-    0.0000    0.0000    0.3028
-    0.0000    0.0000    0.3118
-    0.0000    0.0000    0.3206
-    0.0000    0.0000    0.3292
-    0.0000    0.0000    0.3375
-    0.0000    0.0000    0.3456
-    0.0000    0.0000    0.3534
-    0.0000    0.0000    0.3609
-    0.0000    0.0036    0.3682
-    0.0000    0.0149    0.3752
-    0.0000    0.0262    0.3820
-    0.0000    0.0375    0.3885
-    0.0000    0.0487    0.3946
-    0.0000    0.0600    0.4005
-    0.0000    0.0712    0.4061
-    0.0000    0.0824    0.4114
-    0.0000    0.0936    0.4164
-    0.0000    0.1047    0.4211
-    0.0000    0.1158    0.4255
-    0.0000    0.1269    0.4295
-    0.0000    0.1379    0.4333
-    0.0000    0.1489    0.4367
-    0.0000    0.1599    0.4398
-    0.0000    0.1707    0.4426
-    0.0000    0.1816    0.4451
-    0.0000    0.1923    0.4472
-    0.0000    0.2030    0.4490
-    0.0000    0.2137    0.4505
-    0.0000    0.2243    0.4517
-    0.0000    0.2348    0.4525
-    0.0000    0.2452    0.4530
-    0.0000    0.2555    0.4531
-    0.0000    0.2658    0.4529
-    0.0000    0.2760    0.4524
-    0.0000    0.2860    0.4516
-    0.0000    0.2960    0.4504
-    0.0000    0.3059    0.4489
-    0.0000    0.3157    0.4471
-    0.0000    0.3254    0.4449
-    0.0000    0.3350    0.4424
-    0.0000    0.3445    0.4396
-    0.0000    0.3538    0.4364
-    0.0000    0.3631    0.4330
-    0.0000    0.3722    0.4292
-    0.0000    0.3812    0.4251
-    0.0000    0.3901    0.4207
-    0.0000    0.3988    0.4160
-    0.0000    0.4075    0.4109
-    0.0000    0.4160    0.4056
-    0.0000    0.4243    0.4000
-    0.0000    0.4325    0.3941
-    0.0000    0.4406    0.3879
-    0.0000    0.4486    0.3814
-    0.0000    0.4563    0.3746
-    0.0000    0.4640    0.3676
-    0.0000    0.4715    0.3603
-    0.0000    0.4788    0.3527
-    0.0000    0.4860    0.3448
-    0.0000    0.4930    0.3367
-    0.0000    0.4998    0.3284
-    0.0000    0.5065    0.3198
-    0.0000    0.5131    0.3110
-    0.0000    0.5194    0.3020
-    0.0000    0.5256    0.2927
-    0.0000    0.5316    0.2832
-    0.0000    0.5375    0.2735
-    0.0000    0.5432    0.2636
-    0.0000    0.5487    0.2535
-    0.0000    0.5540    0.2433
-    0.0000    0.5591    0.2328
-    0.0000    0.5641    0.2222
-    0.0000    0.5688    0.2114
-    0.0000    0.5734    0.2005
-    0.0000    0.5778    0.1894
-    0.0000    0.5820    0.1782
-    0.0000    0.5860    0.1668
-    0.0000    0.5899    0.1553
-    0.0000    0.5935    0.1437
-    0.0120    0.5969    0.1320
-    0.0289    0.6002    0.1202
-    0.0458    0.6032    0.1084
-    0.0628    0.6061    0.0964
-    0.0797    0.6088    0.0844
-    0.0966    0.6112    0.0723
-    0.1134    0.6135    0.0601
-    0.1302    0.6155    0.0479
-    0.1470    0.6174    0.0357
-    0.1638    0.6190    0.0234
-    0.1805    0.6205    0.0112
-    0.1971    0.6217   -0.0011
-    0.2137    0.6228    0.0000
-    0.2302    0.6236    0.0000
-    0.2467    0.6243    0.0000
-    0.2631    0.6247    0.0000
-    0.2794    0.6250    0.0000
-    0.2957    0.6250    0.0000
-    0.3118    0.6248    0.0000
-    0.3279    0.6244    0.0000
-    0.3438    0.6239    0.0000
-    0.3597    0.6231    0.0000
-    0.3755    0.6221    0.0000
-    0.3911    0.6209    0.0000
-    0.4067    0.6195    0.0000
-    0.4221    0.6179    0.0000
-    0.4374    0.6161    0.0000
-    0.4526    0.6141    0.0000
-    0.4676    0.6119    0.0000
-    0.4826    0.6095    0.0000
-    0.4973    0.6069    0.0000
-    0.5120    0.6041    0.0000
-    0.5265    0.6011    0.0000
-    0.5408    0.5980    0.0000
-    0.5550    0.5946    0.0000
-    0.5690    0.5910    0.0000
-    0.5829    0.5872    0.0000
-    0.5965    0.5833    0.0000
-    0.6101    0.5791    0.0000
-    0.6234    0.5748    0.0000
-    0.6366    0.5702    0.0000
-    0.6496    0.5655    0.0000
-    0.6623    0.5606    0.0000
-    0.6750    0.5556    0.0000
-    0.6874    0.5503    0.0000
-    0.6996    0.5449    0.0000
-    0.7116    0.5392    0.0000
-    0.7234    0.5334    0.0000
-    0.7350    0.5275    0.0000
-    0.7464    0.5213    0.0000
-    0.7576    0.5150    0.0000
-    0.7685    0.5085    0.0000
-    0.7793    0.5019    0.0000
-    0.7898    0.4951    0.0000
-    0.8000    0.4881    0.0000
-    0.8101    0.4810    0.0000
-    0.8199    0.4737    0.0000
-    0.8295    0.4663    0.0000
-    0.8389    0.4587    0.0000
-    0.8480    0.4509    0.0000
-    0.8568    0.4430    0.0000
-    0.8654    0.4350    0.0000
-    0.8738    0.4268    0.0000
-    0.8819    0.4185    0.0000
-    0.8898    0.4101    0.0000
-    0.8974    0.4015    0.0000
-    0.9048    0.3928    0.0000
-    0.9118    0.3839    0.0000
-    0.9187    0.3749    0.0000
-    0.9252    0.3658    0.0000
-    0.9315    0.3566    0.0000
-    0.9376    0.3473    0.0000
-    0.9433    0.3379    0.0000
-    0.9488    0.3283    0.0000
-    0.9540    0.3187    0.0000
-    0.9590    0.3089    0.0000
-    0.9636    0.2990    0.0000
-    0.9680    0.2891    0.0000
-    0.9721    0.2790    0.0000
-    0.9760    0.2689    0.0000
-    0.9795    0.2586    0.0000
-    0.9828    0.2483    0.0083
-    0.9858    0.2379    0.0219
-    0.9885    0.2274    0.0354
-    0.9909    0.2169    0.0489
-    0.9931    0.2063    0.0625
-    0.9949    0.1956    0.0760
-    0.9965    0.1848    0.0896
-    0.9978    0.1740    0.1031
-    0.9987    0.1632    0.1167
-    0.9995    0.1522    0.1303
-    0.9999    0.1413    0.1439
-    1.0000    0.1302    0.1575
-    1.0000    0.1712    0.1712
-    1.0000    0.1848    0.1848
-    1.0000    0.1986    0.1986
-    1.0000    0.2123    0.2123
-    1.0000    0.2261    0.2261
-    1.0000    0.2400    0.2400
-    1.0000    0.2539    0.2539
-    1.0000    0.2678    0.2678
-    1.0000    0.2819    0.2819
-    1.0000    0.2960    0.2960
-    1.0000    0.3102    0.3102
-    1.0000    0.3245    0.3245
-    1.0000    0.3389    0.3389
-    1.0000    0.3535    0.3535
-    1.0000    0.3681    0.3681
-    1.0000    0.3829    0.3829
-    1.0000    0.3978    0.3978
-    1.0000    0.4129    0.4129
-    1.0000    0.4282    0.4282
-    1.0000    0.4436    0.4436
-    1.0000    0.4592    0.4592
-    1.0000    0.4750    0.4750
-    1.0000    0.4910    0.4910
-    1.0000    0.5072    0.5072
-    1.0000    0.5237    0.5237
-    1.0000    0.5405    0.5405
-    1.0000    0.5574    0.5574
-    1.0000    0.5747    0.5747
-    1.0000    0.5923    0.5923
-    1.0000    0.6102    0.6102
-    1.0000    0.6284    0.6284
-    1.0000    0.6469    0.6469
-    1.0000    0.6658    0.6658
-    1.0000    0.6851    0.6851
-    1.0000    0.7047    0.7047
-    1.0000    0.7248    0.7248
-    1.0000    0.7453    0.7453
-    1.0000    0.7662    0.7662
-    1.0000    0.7876    0.7876
-    1.0000    0.8095    0.8095
-    1.0000    0.8319    0.8319
-    1.0000    0.8548    0.8548
-    1.0000    0.8782    0.8782
-    1.0000    0.9022    0.9022
-    1.0000    0.9268    0.9268
-    1.0000    0.9519    0.9519
-    1.0000    0.9777    0.9777
-    1.0000    1.0000    1.0000
-    1.0000    1.0000    1.0000
-    1.0000    1.0000    1.0000
-    1.0000    1.0000    1.0000
-    1.0000    1.0000    1.0000
-    1.0000    1.0000    1.0000
-    1.0000    1.0000    1.0000
-    1.0000    1.0000    1.0000
-    1.0       0.0       0.0
-    1.0       1.0       0.0
-    0.0       1.000     0.0
-&quot;&quot;&quot;
-
-#----------------------------------------------------- Colormap2Palette
-def Colormap2Palette(colormap=colormapLinrad):
-    &quot;&quot;&quot; convert a matlab type colormap to a PIL palette &quot;&quot;&quot;
-    x = map(lambda x,colormap=colormap: int(string.atof(x)*255), string.split(colormap))
-    palette = [(0,0,0)] * 256
-    for i in range(len(x)/3):
-	palette[i] = (x[i*3], x[i*3+1], x[i*3+2])
-    palette = map(lambda a: chr(a[0])+chr(a[1])+chr(a[2]), palette)
-    palette = string.join(palette, &quot;&quot;)
-    g.palette=palette
-    return palette

Deleted: branches/map65/pctile.f
===================================================================
--- branches/map65/pctile.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/pctile.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,13 +0,0 @@
-	subroutine pctile(x,tmp,nmax,npct,xpct)
-	real x(nmax),tmp(nmax)
-
-	do i=1,nmax
-	  tmp(i)=x(i)
-	enddo
-	call sort(nmax,tmp)
-	j=nint(nmax*0.01*npct)
-	if(j.lt.1) j=1
-	xpct=tmp(j)
-
-	return
-	end

Deleted: branches/map65/peakup.f
===================================================================
--- branches/map65/peakup.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/peakup.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,8 +0,0 @@
-      subroutine peakup(ym,y0,yp,dx)
-
-      b=(yp-ym)/2.0
-      c=(yp+ym-2.0*y0)/2.0
-      dx=-b/(2.0*c)
-
-      return
-      end

Deleted: branches/map65/pfx.f
===================================================================
--- branches/map65/pfx.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/pfx.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,50 +0,0 @@
-      parameter (NZ=339)                     !Total number of prefixes
-      parameter (NZ2=12)                     !Total number of suffixes
-      character*1 sfx(NZ2)
-      character*5 pfx(NZ)
-
-      data sfx/'P','0','1','2','3','4','5','6','7','8','9','A'/
-      data pfx/
-     +  '1A   ','1S   ','3A   ','3B6  ','3B8  ','3B9  ','3C   ','3C0  ',
-     +  '3D2  ','3D2C ','3D2R ','3DA  ','3V   ','3W   ','3X   ','3Y   ',
-     +  '3YB  ','3YP  ','4J   ','4L   ','4S   ','4U1I ','4U1U ','4W   ',
-     +  '4X   ','5A   ','5B   ','5H   ','5N   ','5R   ','5T   ','5U   ',
-     +  '5V   ','5W   ','5X   ','5Z   ','6W   ','6Y   ','7O   ','7P   ',
-     +  '7Q   ','7X   ','8P   ','8Q   ','8R   ','9A   ','9G   ','9H   ',
-     +  '9J   ','9K   ','9L   ','9M2  ','9M6  ','9N   ','9Q   ','9U   ',
-     +  '9V   ','9X   ','9Y   ','A2   ','A3   ','A4   ','A5   ','A6   ',
-     +  'A7   ','A9   ','AP   ','BS7  ','BV   ','BV9  ','BY   ','C2   ',
-     +  'C3   ','C5   ','C6   ','C9   ','CE   ','CE0X ','CE0Y ','CE0Z ',
-     +  'CE9  ','CM   ','CN   ','CP   ','CT   ','CT3  ','CU   ','CX   ',
-     +  'CY0  ','CY9  ','D2   ','D4   ','D6   ','DL   ','DU   ','E3   ',
-     +  'E4   ','EA   ','EA6  ','EA8  ','EA9  ','EI   ','EK   ','EL   ',
-     +  'EP   ','ER   ','ES   ','ET   ','EU   ','EX   ','EY   ','EZ   ',
-     +  'F    ','FG   ','FH   ','FJ   ','FK   ','FKC  ','FM   ','FO   ',
-     +  'FOA  ','FOC  ','FOM  ','FP   ','FR   ','FRG  ','FRJ  ','FRT  ',
-     +  'FT5W ','FT5X ','FT5Z ','FW   ','FY   ','M    ','MD   ','MI   ',
-     +  'MJ   ','MM   ',        'MU   ','MW   ','H4   ','H40  ','HA   ',
-     +  'HB   ','HB0  ','HC   ','HC8  ','HH   ','HI   ','HK   ','HK0A ',
-     +  'HK0M ','HL   ','HM   ','HP   ','HR   ','HS   ','HV   ','HZ   ',
-     +  'I    ','IS   ','IS0  ',        'J2   ','J3   ','J5   ','J6   ',
-     +  'J7   ','J8   ','JA   ','JDM  ','JDO  ','JT   ','JW   ',        
-     +  'JX   ','JY   ','K    ','KG4  ','KH0  ','KH1  ','KH2  ','KH3  ',
-     +  'KH4  ','KH5  ','KH5K ','KH6  ','KH7  ','KH8  ','KH9  ','KL   ',
-     +  'KP1  ','KP2  ','KP4  ','KP5  ','LA   ','LU   ','LX   ','LY   ',
-     +  'LZ   ','OA   ','OD   ','OE   ','OH   ','OH0  ','OJ0  ','OK   ',
-     +  'OM   ','ON   ','OX   ','OY   ','OZ   ','P2   ','P4   ','PA   ',
-     +  'PJ2  ','PJ7  ','PY   ','PY0F ','PT0S ','PY0T ','PZ   ','R1F  ',
-     +  'R1M  ','S0   ','S2   ','S5   ','S7   ','S9   ','SM   ','SP   ',
-     +  'ST   ','SU   ','SV   ','SVA  ','SV5  ','SV9  ','T2   ','T30  ',
-     +  'T31  ','T32  ','T33  ','T5   ','T7   ','T8   ','T9   ','TA   ',
-     +          'TF   ','TG   ','TI   ','TI9  ','TJ   ','TK   ','TL   ',
-     +  'TN   ','TR   ','TT   ','TU   ','TY   ','TZ   ','UA   ','UA2  ',
-     +  'UA9  ','UK   ','UN   ','UR   ','V2   ','V3   ','V4   ','V5   ',
-     +  'V6   ','V7   ','V8   ','VE   ','VK   ','VK0H ','VK0M ','VK9C ',
-     +  'VK9L ','VK9M ','VK9N ','VK9W ','VK9X ','VP2E ','VP2M ','VP2V ',
-     +  'VP5  ','VP6  ','VP6D ','VP8  ','VP8G ','VP8H ','VP8O ','VP8S ',
-     +  'VP9  ','VQ9  ','VR   ','VU   ','VU4  ','VU7  ','XE   ','XF4  ',
-     +  'XT   ','XU   ','XW   ','XX9  ','XZ   ','YA   ','YB   ','YI   ',
-     +  'YJ   ','YK   ','YL   ','YN   ','YO   ','YS   ','YU   ','YV   ',
-     +  'YV0  ','Z2   ','Z3   ','ZA   ','ZB   ','ZC4  ','ZD7  ','ZD8  ',
-     +  'ZD9  ','ZF   ','ZK1N ','ZK1S ','ZK2  ','ZK3  ','ZL   ','ZL7  ',
-     +  'ZL8  ','ZL9  ','ZP   ','ZS   ','ZS8  ','KC4  ','E5   '/

Deleted: branches/map65/pfxdump.f
===================================================================
--- branches/map65/pfxdump.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/pfxdump.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,13 +0,0 @@
-      subroutine pfxdump(fname)
-      character*(*) fname
-      include 'pfx.f'
-
-      open(11,file=fname,status='unknown')
-      write(11,1001) sfx
- 1001 format('Supported Suffixes:'/(11('/',a1,2x)))
-      write(11,1002) pfx
- 1002 format(/'Supported Add-On DXCC Prefixes:'/(15(a5,1x)))
-      close(11)
-
-      return
-      end

Deleted: branches/map65/pix2d65.f90
===================================================================
--- branches/map65/pix2d65.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/pix2d65.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,28 +0,0 @@
-subroutine pix2d65(d2,jz)
-
-! Compute data for green line in JT65 mode.
-
-  integer*2 d2(jz)            !Raw input data
-  include 'gcom2.f90'
-
-  sum=0.
-  do i=1,jz
-     sum=sum+d2(i)
-  enddo
-  nave=nint(sum/jz)
-  nadd=nint(53.0*11025.0/500.0)
-  ngreen=min(jz/nadd,500)
-  k=0
-  do i=1,ngreen
-     sq=0.
-     do n=1,nadd
-        k=k+1
-        d2(k)=d2(k)-nave
-        x=d2(k)
-        sq=sq + x*x
-     enddo
-     green(i)=db(sq)-96.0
-  enddo
-
-  return
-end subroutine pix2d65

Added: branches/map65/plotter.cpp
===================================================================
--- branches/map65/plotter.cpp	                        (rev 0)
+++ branches/map65/plotter.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,711 @@
+#include &quot;plotter.h&quot;
+#include &lt;math.h&gt;
+#include &lt;QDebug&gt;
+
+#define MAX_SCREENSIZE 2048
+
+
+CPlotter::CPlotter(QWidget *parent) :                  //CPlotter Constructor
+  QFrame(parent)
+{
+  setSizePolicy(QSizePolicy::Expanding, QSizePolicy::Expanding);
+  setFocusPolicy(Qt::StrongFocus);
+  setAttribute(Qt::WA_PaintOnScreen,false);
+  setAutoFillBackground(false);
+  setAttribute(Qt::WA_OpaquePaintEvent, false);
+  setAttribute(Qt::WA_NoSystemBackground, true);
+
+  m_StartFreq = 100;
+  m_nSpan=65;                    //Units: kHz
+  m_fSpan=(float)m_nSpan;
+  m_hdivs = HORZ_DIVS;
+  m_FreqUnits = 1;
+  m_Running = false;
+  m_paintEventBusy=false;
+  m_WaterfallPixmap = QPixmap(0,0);
+  m_ZoomWaterfallPixmap = QPixmap(0,0);
+  m_2DPixmap = QPixmap(0,0);
+  m_ScalePixmap = QPixmap(0,0);
+  m_ZoomScalePixmap = QPixmap(0,0);
+  m_Size = QSize(0,0);
+  m_fQSO = 125;
+  m_line = 0;
+  m_fSample = 96000;
+  m_paintAllZoom = false;
+}
+
+CPlotter::~CPlotter() { }                                      // Destructor
+
+QSize CPlotter::minimumSizeHint() const
+{
+  return QSize(50, 50);
+}
+
+QSize CPlotter::sizeHint() const
+{
+  return QSize(180, 180);
+}
+
+void CPlotter::resizeEvent(QResizeEvent* )                    //resizeEvent()
+{
+  if(!size().isValid()) return;
+  if( m_Size != size() ) {
+    //if changed, resize pixmaps to new screensize
+    m_Size = size();
+    int w = m_Size.width();
+    int h = (m_Size.height()-60)/2;
+    m_WaterfallPixmap = QPixmap(w,h);
+    m_ZoomWaterfallPixmap = QPixmap(w,h);
+    m_2DPixmap = QPixmap(w,h);
+    m_WaterfallPixmap.fill(Qt::black);
+    m_ZoomWaterfallPixmap.fill(Qt::black);
+    m_2DPixmap.fill(Qt::black);
+    memset(m_zwf,0,32768*h);
+    m_ScalePixmap = QPixmap(w,30);
+    m_ZoomScalePixmap = QPixmap(w,30);    //(no change on resize...)
+    m_ScalePixmap.fill(Qt::white);
+    m_ZoomScalePixmap.fill(Qt::yellow);
+  }
+  SetCenterFreq(-1);
+  DrawOverlay();
+}
+
+void CPlotter::paintEvent(QPaintEvent *)                    // paintEvent()
+{
+  static int x00=-99;
+  int ihr,imin;
+
+  if(m_paintEventBusy) return;
+  m_paintEventBusy=true;
+  QPainter painter(this);
+  int w = m_Size.width();
+  int h = (m_Size.height()-60)/2;
+  painter.drawPixmap(0,0,m_ScalePixmap);
+  painter.drawPixmap(0,30,m_WaterfallPixmap);
+  if(m_2Dspec) {
+    painter.drawPixmap(0,h+30,m_ScalePixmap);
+    painter.drawPixmap(0,h+60,m_2DPixmap);
+    m_paintEventBusy=false;
+    return;
+  }
+
+  painter.drawPixmap(0,h+30,m_ZoomScalePixmap);
+  painter.drawPixmap(0,h+60,m_ZoomWaterfallPixmap);
+
+  QRect target(0,h+30,w,30);           // (x,y,width,height)
+  QRect source(0,0,w,30);
+  painter.drawPixmap(target,m_ZoomScalePixmap,source);
+
+  float df=m_fSample/32768.0;
+  int x0=16384 + (0.001*(m_ZoomStartFreq+m_fCal)+m_fQSO-m_nkhz+1.27046) * \
+      1000.0/df + 0.5;
+
+  QPainter painter2(&amp;m_ZoomWaterfallPixmap);
+  for(int i=0; i&lt;w; i++) {                      //Paint the top row
+    painter2.setPen(m_ColorTbl[m_zwf[x0+i]]);
+    painter2.drawPoint(i,0);
+  }
+  if(m_paintAllZoom or (x0 != x00 and x00 != -99)) {
+    // If new fQSO, paint all rows
+    int k=x0;
+    for(int j=1; j&lt;h; j++) {
+      k += 32768;
+      for(int i=0; i&lt;w; i++) {
+        painter2.setPen(m_ColorTbl[m_zwf[i+k]]);
+        painter2.drawPoint(i,j);
+      }
+      if(j == 15) {
+        painter2.setPen(m_ColorTbl[255]);
+        painter2.drawText(5,10,m_sutc);
+      }
+    }
+  } else if(m_line == 15) {
+    painter2.setPen(m_ColorTbl[255]);
+    UTCstr();
+    painter2.drawText(5,10,m_sutc);
+  }
+  m_paintAllZoom=false;
+  x00=x0;
+
+  QRect target2(0,h+60,w,h);           // (x,y,width,height)
+  QRect source2(0,0,w,h);
+  painter.drawPixmap(target2,m_ZoomWaterfallPixmap,source2);
+  m_paintEventBusy=false;
+}
+
+void CPlotter::draw(float s[], int i0, float splot[])                       //draw()
+{
+  int i,j,k,w,h;
+  int ihr,imin;
+  float y;
+
+  m_i0=i0;
+  w = m_WaterfallPixmap.width();
+  h = m_WaterfallPixmap.height();
+  double gain = pow(10.0,0.05*(m_plotGain+7));
+
+  //move current data down one line
+  //(must do this before attaching a QPainter object)
+  m_WaterfallPixmap.scroll(0,1,0,0,w,h);
+  m_ZoomWaterfallPixmap.scroll(0,1,0,0, w, h);
+  memmove(&amp;m_zwf[32768],m_zwf,32768*(h-1));
+  QPainter painter1(&amp;m_WaterfallPixmap);
+  QPainter painter2D(&amp;m_2DPixmap);
+
+  for(i=0; i&lt;256; i++) {                     //Zero the histograms
+    m_hist1[i]=0;
+    m_hist2[i]=0;
+  }
+
+  painter2D.setPen(Qt::green);
+  QRect tmp(0,0,w,h);
+  painter2D.fillRect(tmp,Qt::black);
+  QPoint LineBuf[MAX_SCREENSIZE];
+  j=0;
+  bool strong0=false;
+  bool strong=false;
+
+  for(i=0; i&lt;w; i++) {
+    strong=false;
+    if(s[i]&lt;0) {
+      strong=true;
+      s[i]=-s[i];
+    }
+    y = 10.0*log10(s[i]);
+    int y1 = 5.0*gain*(y + 29 -m_plotZero);
+    if (y1&lt;0) y1=0;
+    if (y1&gt;254) y1=254;
+    if (s[i]&gt;1.e29) y1=255;
+    m_hist1[y1]++;
+    painter1.setPen(m_ColorTbl[y1]);
+    painter1.drawPoint(i,0);
+    if(m_2Dspec) {
+      int y2 = gain*(y + 34 -m_plotZero);
+      if (y2&lt;0) y2=0;
+      if (y2&gt;254) y2=254;
+      if (s[i]&gt;1.e29) y2=255;
+      if(strong != strong0 or i==w-1) {
+        painter2D.drawPolyline(LineBuf,j);
+        j=0;
+        strong0=strong;
+        if(strong0) painter2D.setPen(Qt::red);
+        if(!strong0) painter2D.setPen(Qt::green);
+      }
+      LineBuf[j].setX(i);
+      LineBuf[j].setY(h-y2);
+      j++;
+    }
+  }
+
+  for(i=0; i&lt;32768; i++) {
+    y = 10.0*log10(splot[i]);
+    int y1 = 5.0*gain*(y + 30 - m_plotZero);
+    if (y1&lt;0) y1=0;
+    if (y1&gt;254) y1=254;
+    if (splot[i]&gt;1.e29) y1=255;
+    m_hist2[y1]++;
+    m_zwf[i]=y1;
+  }
+
+  if(s[0]&gt;1.0e29) m_line=0;
+  m_line++;
+  if(m_line == 15) {
+    UTCstr();
+    painter1.setPen(m_ColorTbl[255]);
+    painter1.drawText(5,10,m_sutc);
+  }
+  update();                              //trigger a new paintEvent
+}
+
+void CPlotter::UTCstr()
+{
+  int ihr,imin;
+  if(datcom_.ndiskdat != 0) {
+    ihr=datcom_.nutc/100;
+    imin=datcom_.nutc%100;
+  } else {
+    qint64 ms = QDateTime::currentMSecsSinceEpoch() % 86400000;
+    imin=ms/60000;
+    ihr=imin/60;
+    imin=imin % 60;
+  }
+  sprintf(m_sutc,&quot;%2.2d:%2.2d&quot;,ihr,imin);
+}
+
+void CPlotter::DrawOverlay()                                 //DrawOverlay()
+{
+  if(m_WaterfallPixmap.isNull()) return;
+  int w = m_WaterfallPixmap.width();
+  int x,y;
+  float pixperdiv;
+
+  QRect rect0;
+  QPainter painter0(&amp;m_ScalePixmap);
+  painter0.initFrom(this);
+
+  //create Font to use for scales
+  QFont Font(&quot;Arial&quot;);
+  Font.setPointSize(12);
+  QFontMetrics metrics(Font);
+  Font.setWeight(QFont::Normal);
+  painter0.setFont(Font);
+  painter0.setPen(Qt::black);
+
+  m_binsPerPixel = m_nSpan * 32768.0/(w*0.001*m_fSample) + 0.5;
+  double FreqPerDiv=5.0;
+  double df = m_binsPerPixel*0.001*m_fSample/32768.0;
+  m_hdivs = w*df/FreqPerDiv + 0.9999;
+  m_fSpan = w*df;
+  m_ScalePixmap.fill(Qt::white);
+  painter0.drawRect(0, 0, w, 30);
+
+  //draw tick marks on wideband (upper) scale
+  pixperdiv = FreqPerDiv/df;
+  for( int i=1; i&lt;m_hdivs; i++) {     //major ticks
+    x = (int)( (float)i*pixperdiv );
+    painter0.drawLine(x,18,x,30);
+  }
+  for( int i=1; i&lt;5*m_hdivs; i++) {   //minor ticks
+    x = i*pixperdiv/5.0;
+    painter0.drawLine(x,24,x,30);
+  }
+
+  //draw frequency values
+  MakeFrequencyStrs();
+  for( int i=0; i&lt;=m_hdivs; i++) {
+    if(0==i) {
+      //left justify the leftmost text
+      x = (int)( (float)i*pixperdiv);
+      rect0.setRect(x,0, (int)pixperdiv, 20);
+      painter0.drawText(rect0, Qt::AlignLeft|Qt::AlignVCenter,
+                       m_HDivText[i]);
+    }
+    else if(m_hdivs == i) {
+      //right justify the rightmost text
+      x = (int)( (float)i*pixperdiv - pixperdiv);
+      rect0.setRect(x,0, (int)pixperdiv, 20);
+      painter0.drawText(rect0, Qt::AlignRight|Qt::AlignVCenter,
+                       m_HDivText[i]);
+    } else {
+      //center justify the rest of the text
+      x = (int)( (float)i*pixperdiv - pixperdiv/2);
+      rect0.setRect(x,0, (int)pixperdiv, 20);
+      painter0.drawText(rect0, Qt::AlignHCenter|Qt::AlignVCenter,
+                       m_HDivText[i]);
+    }
+  }
+
+
+  if(m_2Dspec) {
+    QPen pen0(Qt::green, 3);                 //Mark Cal Freq with green tick
+    painter0.setPen(pen0);
+    x = m_xClick;
+    painter0.drawLine(x,15,x,30);
+    int x0=(16384-m_i0)/m_binsPerPixel;
+    m_fGreen=(x-x0)*df;
+    x0 += (x0-x);
+    QPen pen3(Qt::red, 3);
+    painter0.setPen(pen3);
+    if(x0&gt;0 and x0&lt;w) painter0.drawLine(x0,15,x0,30);
+  } else {
+    QPen pen0(Qt::green, 3);                 //Mark fQSO with green tick
+    painter0.setPen(pen0);
+    x = XfromFreq(float(fQSO()));
+    painter0.drawLine(x,15,x,30);
+  }
+
+  // Now make the zoomed scale, using m_ZoomScalePixmap and painter3
+  QRect rect1;
+  QPainter painter3(&amp;m_ZoomScalePixmap);
+  painter3.initFrom(this);
+  painter3.setFont(Font);
+  painter3.setPen(Qt::black);
+
+  FreqPerDiv=0.2;
+  df = 0.001*m_fSample/32768.0;
+  m_hdivs = 32768*df/FreqPerDiv + 0.9999;
+  int nlabs=df*w/0.2 + 1.0;
+  m_ZoomScalePixmap.fill(Qt::white);
+  painter3.drawRect(0, 0, w, 30);
+
+  pixperdiv = FreqPerDiv/df;
+  for( int i=0; i&lt;10*nlabs; i++) {
+    x = i*pixperdiv/10;
+    y=24;
+    if ((i%5) == 0) y=18;
+    painter3.drawLine(x,y,x,30);
+  }
+
+  //draw frequency values
+  MakeFrequencyStrs();
+  for( int i=0; i&lt;=nlabs; i++) {
+    x = (int)( (float)i*pixperdiv - pixperdiv/2);
+    rect1.setRect(x,0, (int)pixperdiv, 20);
+    painter3.drawText(rect1, Qt::AlignHCenter|Qt::AlignVCenter,
+                      m_HDivText[i]);
+  }
+
+  df=m_fSample/32768.0;
+  x = (m_DF + m_mode65*66*11025.0/4096.0 - m_ZoomStartFreq)/df;
+  QPen pen2(Qt::red, 3);            //Mark top JT65B tone with red tick
+  painter3.setPen(pen2);
+  painter3.drawLine(x,15,x,30);
+  x = (m_DF - m_ZoomStartFreq)/df;
+  QPen pen1(Qt::green, 3);                //Mark DF with a green tick
+  painter3.setPen(pen1);
+  painter3.drawLine(x,15,x,30);
+  for(int i=2; i&lt;5; i++) {                //Mark the shorthand freqs
+    x = (m_DF + m_mode65*10*i*11025.0/4096.0 - m_ZoomStartFreq)/df;
+    painter3.drawLine(x,20,x,30);
+  }
+  int x1=(m_DF - m_tol - m_ZoomStartFreq)/df;
+  int x2=(m_DF + m_tol - m_ZoomStartFreq)/df;
+  pen1.setWidth(6);
+  painter3.drawLine(x1,28,x2,28);
+}
+
+void CPlotter::MakeFrequencyStrs()                       //MakeFrequencyStrs
+{
+  float StartFreq = m_StartFreq;
+  float freq;
+  int i,j;
+  int FreqPerDiv=5;
+
+  if(m_hdivs &gt; 100) {
+    m_FreqUnits = 1;
+    FreqPerDiv = 200;
+    int w = m_WaterfallPixmap.width();
+    float df=m_fSample/32768.0;
+    StartFreq = -w*df/2;
+    int n=StartFreq/FreqPerDiv;
+    StartFreq=n*200;
+    m_ZoomStartFreq = (int)StartFreq;
+  }
+  int numfractdigits = (int)log10((double)m_FreqUnits);
+
+  if(1 == m_FreqUnits) {
+    //if units is Hz then just output integer freq
+    for(int i=0; i&lt;=m_hdivs; i++) {
+      freq = StartFreq/(float)m_FreqUnits;
+      m_HDivText[i].setNum((int)freq);
+      StartFreq += FreqPerDiv;
+    }
+    return;
+  }
+  //here if is fractional frequency values
+  //so create max sized text based on frequency units
+  for(int i=0; i&lt;=m_hdivs; i++) {
+    freq = StartFreq/(float)m_FreqUnits;
+    m_HDivText[i].setNum(freq,'f', numfractdigits);
+    StartFreq += FreqPerDiv;
+  }
+  //now find the division text with the longest non-zero digit
+  //to the right of the decimal point.
+  int max = 0;
+  for(i=0; i&lt;=m_hdivs; i++) {
+    int dp = m_HDivText[i].indexOf('.');
+    int l = m_HDivText[i].length()-1;
+    for(j=l; j&gt;dp; j--) {
+      if(m_HDivText[i][j] != '0')
+        break;
+    }
+    if( (j-dp) &gt; max)
+      max = j-dp;
+  }
+  //truncate all strings to maximum fractional length
+  StartFreq = m_CenterFreq - 0.5*m_fSpan;
+  for( i=0; i&lt;=m_hdivs; i++) {
+    freq = (float)StartFreq/(float)m_FreqUnits;
+    m_HDivText[i].setNum(freq,'f', max);
+    StartFreq += FreqPerDiv;
+  }
+}
+
+int CPlotter::XfromFreq(float f)                               //XfromFreq()
+{
+  float w = m_WaterfallPixmap.width();
+  int x = (int) w * (f - m_StartFreq)/m_fSpan;
+  if(x&lt;0 ) return 0;
+  if(x&gt;(int)w) return m_WaterfallPixmap.width();
+  return x;
+}
+
+float CPlotter::FreqfromX(int x)                               //FreqfromX()
+{
+  float w = m_WaterfallPixmap.width();
+  float f =m_CenterFreq - 0.5*m_fSpan + m_fSpan * x/w;
+  return f;
+}
+
+void CPlotter::SetRunningState(bool running)              //SetRunningState()
+{
+  m_Running = running;
+}
+
+void CPlotter::setPlotZero(int plotZero)                  //setPlotZero()
+{
+  m_plotZero=plotZero;
+}
+
+int CPlotter::getPlotZero()                               //getPlotZero()
+{
+  return m_plotZero;
+}
+
+void CPlotter::setPlotGain(int plotGain)                  //setPlotGain()
+{
+  m_plotGain=plotGain;
+}
+
+int CPlotter::getPlotGain()                               //getPlotGain()
+{
+  return m_plotGain;
+}
+
+void CPlotter::SetCenterFreq(int f)                   //setCenterFreq()
+{
+// f is the integer kHz portion of cfreq, from Linrad packets
+  if(f&lt;0) f=m_nkhz;
+  int ns = (f+m_FreqOffset-0.5*m_fSpan)/5.0 + 0.5;
+  double fs = 5*ns;
+  m_CenterFreq = fs + 0.5*m_fSpan;
+}
+
+qint64 CPlotter::centerFreq()                             //centerFreq()
+{
+  return m_CenterFreq;
+}
+
+void CPlotter::SetStartFreq(quint64 f)                    //SetStartFreq()
+{
+  m_StartFreq=f;
+//    resizeEvent(NULL);
+  DrawOverlay();
+}
+
+qint64 CPlotter::startFreq()                              //startFreq()
+{
+  return m_StartFreq;
+}
+
+void CPlotter::SetFreqOffset(quint64 f)                   //SetFreqOffset()
+{
+  m_FreqOffset=f;
+  DrawOverlay();
+}
+
+qint64 CPlotter::freqOffset() {return m_FreqOffset;}         //freqOffset()
+int CPlotter::plotWidth(){return m_WaterfallPixmap.width();}
+void CPlotter::UpdateOverlay() {DrawOverlay();}
+void CPlotter::setDataFromDisk(bool b) {m_dataFromDisk=b;}
+
+void CPlotter::setTol(int n)                                 //setTol()
+{
+  m_tol=n;
+  DrawOverlay();
+}
+
+void CPlotter::setBinsPerPixel(int n) {m_binsPerPixel = n;}  //set nbpp
+
+int CPlotter::binsPerPixel(){return m_binsPerPixel;}         //get nbpp
+
+void CPlotter::setFQSO(int x, bool bf)                       //setFQSO()
+{
+  if(bf) {
+    m_fQSO=x;         // x is freq in kHz
+  } else {
+    if(x&lt;0) x=0;      // x is pixel number
+    if(x&gt;m_Size.width()) x=m_Size.width();
+    m_fQSO = int(FreqfromX(x)+0.5);
+    m_xClick=x;
+  }
+  DrawOverlay();
+  update();
+}
+
+void CPlotter::setFcal(int n)                                  //setFcal()
+{
+  m_fCal=n;
+}
+
+void CPlotter::setNkhz(int n)                                  //setNkhz()
+{
+  m_nkhz=n;
+}
+
+int CPlotter::fQSO() {return m_fQSO;}                          //get fQSO
+
+int CPlotter::DF() {return m_DF;}                              // get DF
+
+void CPlotter::mousePressEvent(QMouseEvent *event)       //mousePressEvent
+{
+  int h = (m_Size.height()-60)/2;
+  int x=event-&gt;x();
+  int y=event-&gt;y();
+  if(y &lt; h+30) {
+    setFQSO(x,false);                               // Wideband waterfall
+  } else {
+    m_DF=int(m_ZoomStartFreq + x*m_fSample/32768.0);  // Zoomed waterfall
+    DrawOverlay();
+    update();
+  }
+}
+
+void CPlotter::mouseDoubleClickEvent(QMouseEvent *event)  //mouse2click
+{
+  int h = (m_Size.height()-60)/2;
+  int x=event-&gt;x();
+  int y=event-&gt;y();
+  if(y &lt; h+30) {
+    m_DF=0;
+    setFQSO(x,false);
+    emit freezeDecode1(2);                  //### ???
+  } else {
+    float f = m_ZoomStartFreq + x*m_fSample/32768.0;
+    m_DF=int(f);
+    emit freezeDecode1(1);
+    DrawOverlay();
+  }
+}
+
+int CPlotter::autoZero()                                        //autoZero()
+{
+  m_z1=0;
+  m_z2=0;
+  int sum1=0;
+  for(int i=0; i&lt;256; i++) {
+    sum1 += m_hist1[i];
+    if(sum1 &gt; m_Size.width()/2) {
+      m_z1=i;
+      break;
+    }
+  }
+  int sum2=0;
+  for(int i=0; i&lt;256; i++) {
+    sum2 += m_hist2[i];
+    if(sum2 &gt; 16384) {
+      m_z2=i;
+      break;
+    }
+  }
+  double gain = pow(10.0,0.05*(m_plotGain+7));
+//  double dz1 = (m_z1-38)/(5.0*gain);
+  double dz2 = (m_z2-28)/(5.0*gain);
+  if(m_z2 &lt; 255) m_plotZero = int(m_plotZero + dz2 + 0.5);
+  return m_plotZero;
+}
+
+void CPlotter::setNSpan(int n)                                  //setNSpan()
+{
+  m_nSpan=n;
+}
+
+void CPlotter::setPalette(QString palette)                      //setPalette()
+{
+  if(palette==&quot;Linrad&quot;) {
+    float twopi=6.2831853;
+    float r,g,b,phi,x;
+    for(int i=0; i&lt;256; i++) {
+      r=0.0;
+      if(i&gt;105 and i&lt;=198) {
+        phi=(twopi/4.0) * (i-105.0)/(198.0-105.0);
+        r=sin(phi);
+      } else if(i&gt;=198) {
+          r=1.0;
+      }
+
+      g=0.0;
+      if(i&gt;35 and i&lt;198) {
+        phi=(twopi/4.0) * (i-35.0)/(122.5-35.0);
+        g=0.625*sin(phi);
+      } else if(i&gt;=198) {
+        x=(i-186.0);
+        g=-0.014 + 0.0144*x -0.00007*x*x +0.000002*x*x*x;
+        if(g&gt;1.0) g=1.0;
+      }
+
+      b=0.0;
+      if(i&lt;=117) {
+        phi=(twopi/2.0) * i/117.0;
+        b=0.4531*sin(phi);
+      } else if(i&gt;186) {
+        x=(i-186.0);
+        b=-0.014 + 0.0144*x -0.00007*x*x +0.000002*x*x*x;
+        if(b&gt;1.0) b=1.0;
+      }
+      m_ColorTbl[i].setRgb(int(255.0*r),int(255.0*g),int(255.0*b));
+    }
+    m_ColorTbl[255].setRgb(255,255,100);
+
+  }
+
+  if(palette==&quot;CuteSDR&quot;) {
+      for( int i=0; i&lt;256; i++) {
+      if( (i&lt;43) )
+        m_ColorTbl[i].setRgb( 0,0, 255*(i)/43);
+      if( (i&gt;=43) &amp;&amp; (i&lt;87) )
+        m_ColorTbl[i].setRgb( 0, 255*(i-43)/43, 255 );
+      if( (i&gt;=87) &amp;&amp; (i&lt;120) )
+        m_ColorTbl[i].setRgb( 0,255, 255-(255*(i-87)/32));
+      if( (i&gt;=120) &amp;&amp; (i&lt;154) )
+        m_ColorTbl[i].setRgb( (255*(i-120)/33), 255, 0);
+      if( (i&gt;=154) &amp;&amp; (i&lt;217) )
+        m_ColorTbl[i].setRgb( 255, 255 - (255*(i-154)/62), 0);
+      if( (i&gt;=217)  )
+        m_ColorTbl[i].setRgb( 255, 0, 128*(i-217)/38);
+    }
+    m_ColorTbl[255].setRgb(255,255,100);
+  }
+
+  if(palette==&quot;Blue&quot;) {
+    FILE* fp=fopen(&quot;blue.dat&quot;,&quot;r&quot;);
+    int n,r,g,b;
+    float xr,xg,xb;
+    for(int i=0; i&lt;256; i++) {
+      fscanf(fp,&quot;%d%f%f%f&quot;,&amp;n,&amp;xr,&amp;xg,&amp;xb);
+      r=255.0*xr + 0.5;
+      g=255.0*xg + 0.5;
+      b=255.0*xb + 0.5;
+      m_ColorTbl[i].setRgb(r,g,b);
+    }
+  }
+
+  if(palette==&quot;AFMHot&quot;) {
+    FILE* fp=fopen(&quot;afmhot.dat&quot;,&quot;r&quot;);
+    int n,r,g,b;
+    float xr,xg,xb;
+    for(int i=0; i&lt;256; i++) {
+      fscanf(fp,&quot;%d%f%f%f&quot;,&amp;n,&amp;xr,&amp;xg,&amp;xb);
+      r=255.0*xr + 0.5;
+      g=255.0*xg + 0.5;
+      b=255.0*xb + 0.5;
+      m_ColorTbl[i].setRgb(r,g,b);
+    }
+  }
+
+}
+
+void CPlotter::setFsample(int n)
+{
+  m_fSample=n;
+}
+
+void CPlotter::setMode65(int n)
+{
+  m_mode65=n;
+  DrawOverlay();                         //Redraw scales and ticks
+  update();                              //trigger a new paintEvent
+}
+
+void CPlotter::set2Dspec(bool b)
+{
+  m_2Dspec=b;
+  m_paintAllZoom=!b;
+  DrawOverlay();                         //Redraw scales and ticks
+  update();                              //trigger a new paintEvent}
+}
+
+double CPlotter::fGreen()
+{
+  return m_fGreen;
+}

Added: branches/map65/plotter.h
===================================================================
--- branches/map65/plotter.h	                        (rev 0)
+++ branches/map65/plotter.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,127 @@
+///////////////////////////////////////////////////////////////////////////
+// Some code in this file and accompanying files is based on work by
+// Moe Wheatley, AE4Y, released under the &quot;Simplified BSD License&quot;.
+// For more details see the accompanying file LICENSE_WHEATLEY.TXT
+///////////////////////////////////////////////////////////////////////////
+
+#ifndef PLOTTER_H
+#define PLOTTER_H
+
+#include &lt;QtGui&gt;
+#include &lt;QFrame&gt;
+#include &lt;QImage&gt;
+#include &lt;cstring&gt;
+#include &quot;commons.h&quot;
+
+#define VERT_DIVS 7	//specify grid screen divisions
+#define HORZ_DIVS 20
+
+class CPlotter : public QFrame
+{
+  Q_OBJECT
+public:
+  explicit CPlotter(QWidget *parent = 0);
+  ~CPlotter();
+
+  QSize minimumSizeHint() const;
+  QSize sizeHint() const;
+  QColor  m_ColorTbl[256];
+  int     m_plotZero;
+  int     m_plotGain;
+  float   m_fSpan;
+  qint32  m_nSpan;
+  qint32  m_binsPerPixel;
+  qint32  m_fQSO;
+  qint32  m_DF;
+  qint32  m_tol;
+  qint32  m_fCal;
+
+  void draw(float sw[], int i0, float splot[]);		//Update the waterfalls
+  void SetRunningState(bool running);
+  void setPlotZero(int plotZero);
+  int  getPlotZero();
+  void setPlotGain(int plotGain);
+  int  getPlotGain();
+  void SetCenterFreq(int f);
+  qint64 centerFreq();
+  void SetStartFreq(quint64 f);
+  qint64 startFreq();
+  void SetFreqOffset(quint64 f);
+  qint64 freqOffset();
+  int  plotWidth();
+  void setNSpan(int n);
+  void UpdateOverlay();
+  void setDataFromDisk(bool b);
+  void setTol(int n);
+  void setBinsPerPixel(int n);
+  int  binsPerPixel();
+  void setFQSO(int n, bool bf);
+  void setFcal(int n);
+  void setNkhz(int n);
+  void DrawOverlay();
+  int  fQSO();
+  int  DF();
+  int  autoZero();
+  void setPalette(QString palette);
+  void setFsample(int n);
+  void setMode65(int n);
+  void set2Dspec(bool b);
+  double fGreen();
+
+signals:
+  void freezeDecode0(int n);
+  void freezeDecode1(int n);
+
+protected:
+  //re-implemented widget event handlers
+  void paintEvent(QPaintEvent *event);
+  void resizeEvent(QResizeEvent* event);
+
+private:
+
+  void MakeFrequencyStrs();
+  void UTCstr();
+  int XfromFreq(float f);
+  float FreqfromX(int x);
+  qint64 RoundFreq(qint64 freq, int resolution);
+
+  QPixmap m_WaterfallPixmap;
+  QPixmap m_ZoomWaterfallPixmap;
+  QPixmap m_2DPixmap;
+  unsigned char m_zwf[32768*400];
+  QPixmap m_ScalePixmap;
+  QPixmap m_ZoomScalePixmap;
+  QSize   m_Size;
+  QString m_Str;
+  QString m_HDivText[483];
+  bool    m_Running;
+  bool    m_paintEventBusy;
+  bool    m_2Dspec;
+  bool    m_paintAllZoom;
+  double  m_CenterFreq;
+  double  m_fGreen;
+  qint64  m_StartFreq;
+  qint64  m_ZoomStartFreq;
+  qint64  m_FreqOffset;
+  qint32  m_dBStepSize;
+  qint32  m_FreqUnits;
+  qint32  m_hdivs;
+  bool    m_dataFromDisk;
+  char    m_sutc[5];
+  qint32  m_line;
+  qint32  m_hist1[256];
+  qint32  m_hist2[256];
+  qint32  m_z1;
+  qint32  m_z2;
+  qint32  m_nkhz;
+  qint32  m_fSample;
+  qint32  m_mode65;
+  qint32  m_i0;
+  qint32  m_xClick;
+
+private slots:
+  void mousePressEvent(QMouseEvent *event);
+  void mouseDoubleClickEvent(QMouseEvent *event);
+};
+
+#endif // PLOTTER_H

Deleted: branches/map65/plrr.F90
===================================================================
--- branches/map65/plrr.F90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/plrr.F90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,43 +0,0 @@
-program plrr
-
-!  Pseudo-Linrad &quot;Receive&quot; program
-
-  integer*1 userx_no,iusb
-  integer*2 nblock,nblock0
-  real*8 center_freq,buf8
-  logical first
-  common/plrscom/center_freq,msec,fselect,iptr,nblock,userx_no,iusb,buf8(174)
-  data first/.true./
-
-  call setup_rsocket
-  ns0=-99
-  nlost=0
-
-10 call recv_pkt(center_freq)
-
-  lost=nblock-nblock0-1
-  if(lost.ne.0 .and. .not.first) then
-     nb=nblock
-     if(nb.lt.0) nb=nb+65536
-     nb0=nblock0
-     if(nb0.lt.0) nb0=nb0+65536
-     print*,'Lost packets:',nb,nb0,lost
-     nlost=nlost + lost               ! Insert zeros for the lost data.
-!     do i=1,174*lost
-!        k=k+1
-!        d8(k)=0
-!     enddo
-     first=.false.
-     nlost=nlost+lost
-  endif
-  nblock0=nblock
-
-  ns=mod(msec/1000,60)
-  if(ns.ne.ns0) write(*,1010) ns,center_freq,0.001*msec,sec_midn(),nlost
-1010 format('ns:',i3,'   f0:',f10.3,'   t1:',f10.3,'   t2:',f10.3,i8)
-  ns0=ns
-  go to 10
-
-end program plrr
-
-! To compile: % gfortran -o plrr plrr.f90 sec_midn.F90 plrr_subs.c

Deleted: branches/map65/plrr.exe
===================================================================
(Binary files differ)

Deleted: branches/map65/plrr_subs.c
===================================================================
--- branches/map65/plrr_subs.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/plrr_subs.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,67 +0,0 @@
-#include &lt;sys/types.h&gt;
-#include &lt;sys/socket.h&gt;
-#include &lt;netinet/in.h&gt;
-/*  The following don't seem to be needed?
-#include &lt;time.h&gt;
-#include &lt;stdio.h&gt;
-*/
-
-#include &lt;arpa/inet.h&gt;
-#include &lt;string.h&gt;
-#include &lt;stdlib.h&gt;
-
-#define HELLO_PORT 50004
-#define HELLO_GROUP &quot;239.255.0.0&quot;
-#define MSGBUFSIZE 1416
-
-struct sockaddr_in addr;
-int fd;
-
-void setup_rsocket_(void)
-{
-  struct ip_mreq mreq;
-  u_int yes=1;
-
-  /* create what looks like an ordinary UDP socket */
-  if ((fd=socket(AF_INET,SOCK_DGRAM,0)) &lt; 0) {
-    perror(&quot;socket&quot;);
-    exit(1);
-  }
-
-  /* allow multiple sockets to use the same PORT number */
-  if (setsockopt(fd,SOL_SOCKET,SO_REUSEADDR,&amp;yes,sizeof(yes)) &lt; 0) {
-    perror(&quot;Reusing ADDR failed&quot;);
-    exit(1);
-  }
-
-  /* set up destination address */
-  memset(&amp;addr,0,sizeof(addr));
-  addr.sin_family=AF_INET;
-  addr.sin_addr.s_addr=htonl(INADDR_ANY); /* N.B.: differs from sender */
-  addr.sin_port=htons(HELLO_PORT);
-     
-  /* bind to receive address */
-  if (bind(fd,(struct sockaddr *) &amp;addr,sizeof(addr)) &lt; 0) {
-    perror(&quot;bind&quot;);
-    exit(1);
-  }
-     
-  /* use setsockopt() to request that the kernel join a multicast group */
-  mreq.imr_multiaddr.s_addr=inet_addr(HELLO_GROUP);
-  mreq.imr_interface.s_addr=htonl(INADDR_ANY);
-  if (setsockopt(fd,IPPROTO_IP,IP_ADD_MEMBERSHIP,&amp;mreq,sizeof(mreq)) &lt; 0) {
-    perror(&quot;setsockopt&quot;);
-    exit(1);
-  }
-}
-
-void recv_pkt_(char buf[])
-{
-  int addrlen,nbytes;
-  addrlen=sizeof(addr);
-  if ((nbytes=recvfrom(fd,buf,1416,0, 
-		       (struct sockaddr *) &amp;addr,&amp;addrlen)) &lt; 0) {
-    perror(&quot;recvfrom&quot;);
-    exit(1);
-  }
-}

Deleted: branches/map65/plrr_subs_win.c
===================================================================
--- branches/map65/plrr_subs_win.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/plrr_subs_win.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,108 +0,0 @@
-#include &lt;winsock2.h&gt;
-#include &lt;ws2tcpip.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;stdio.h&gt;
-
-#define HELLO_PORT 50004                       // timf2 data
-//#define HELLO_PORT 50000                       // raw data
-#define HELLO_GROUP &quot;239.255.0.0&quot;
-#define MSGBUFSIZE 1416
-
-struct sockaddr_in addr;
-int fd;
-
-//void __stdcall SETUP_RSOCKET(void)
-void setup_rsocket_(int *multicast0)
-{
-  struct ip_mreq mreq;
-  u_int yes=1;
-  int i,j,k;
-
-  // Make sure that we have compatible Winsock support
-  WORD wVersionRequested;
-  WSADATA wsaData;
-  int err;
- 
-  wVersionRequested = MAKEWORD( 2, 2 );
-  err = WSAStartup( wVersionRequested, &amp;wsaData );
-  if ( err != 0 ) {
-    /* Tell the user that we could not find a usable */
-    /* WinSock DLL.                                  */
-    exit(1);
-  }
- 
-  /* Confirm that the WinSock DLL supports 2.2.*/
-  /* Note that if the DLL supports versions greater    */
-  /* than 2.2 in addition to 2.2, it will still return */
-  /* 2.2 in wVersion since that is the version we      */
-  /* requested.                                        */
- 
-  if ( LOBYTE( wsaData.wVersion ) != 2 ||
-       HIBYTE( wsaData.wVersion ) != 2 ) {
-    /* Tell the user that we could not find a usable */
-    /* WinSock DLL.                                  */
-    WSACleanup( );
-    exit(1); 
-  }
-  /* The WinSock DLL is acceptable. Proceed. */
-
-  /* create what looks like an ordinary UDP socket */
-  if ((fd=socket(AF_INET,SOCK_DGRAM,IPPROTO_UDP)) &lt; 0) {
-    perror(&quot;socket&quot;);
-    exit(1);
-  }
-
-  k=sizeof(int);
-  i=256*1024;
-  err=setsockopt(fd, SOL_SOCKET, SO_RCVBUF, (char *)&amp;i,k);
-  if (err&lt;0) {
-    j=WSAGetLastError();
-    printf(&quot;Error: %d   %d\n&quot;,err,j);
-  }
-
-  if (*multicast0) {
-    // allow multiple sockets to use the same PORT number
-    if (setsockopt(fd,SOL_SOCKET,SO_REUSEADDR,&amp;yes,sizeof(yes)) &lt; 0) {
-      perror(&quot;Reusing ADDR failed&quot;);
-      exit(1);
-    }
-    printf(&quot;Accepting multicast data from Linrad.\n&quot;);
-  }
-  else {
-    printf(&quot;Accepting unicast data from Linrad.\n&quot;);
-  }
-
-  /* set up destination address */
-  memset(&amp;addr,0,sizeof(addr));
-  addr.sin_family=AF_INET;
-  addr.sin_addr.s_addr=htonl(INADDR_ANY);
-  addr.sin_port=htons(HELLO_PORT);
-  /* Bind socket to a local source port */
-  if (bind(fd,(struct sockaddr *) &amp;addr,sizeof(addr)) &lt; 0) {
-    perror(&quot;bind&quot;);
-    exit(1);
-  }
-
-  if (*multicast0) {
-    // use setsockopt() to request that the kernel join a multicast group
-    mreq.imr_multiaddr.s_addr=inet_addr(HELLO_GROUP);
-    mreq.imr_interface.s_addr=htonl(INADDR_ANY);
-    // NG: mreq.imr_interface.s_addr=htonl(&quot;192.168.10.13&quot;);
-    if (setsockopt(fd,IPPROTO_IP,IP_ADD_MEMBERSHIP,&amp;mreq,sizeof(mreq)) &lt; 0) {
-      perror(&quot;setsockopt&quot;);
-      exit(1);
-    }
-  }
-}
-
-//void __stdcall RECV_PKT(char buf[])
-void recv_pkt_(char buf[])
-{
-  int addrlen,nbytes;
-  addrlen=sizeof(addr);
-  if ((nbytes=recvfrom(fd,buf,1416,0, 
-		       (struct sockaddr *) &amp;addr,&amp;addrlen)) &lt; 0) {
-    perror(&quot;recvfrom&quot;);
-    exit(1);
-  }
-}

Deleted: branches/map65/plrs.F90
===================================================================
--- branches/map65/plrs.F90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/plrs.F90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,156 +0,0 @@
-program plrs
-
-! Pseudo-Linrad &quot;Send&quot; program.  Reads recorded Linrad data from &quot;*.tf2&quot;
-! files, and multicasts it as Linrad would do for timf2 data.
-
-  integer RMODE
-  parameter(RMODE=0)
-  parameter (NBPP=1392)
-  parameter (NZ=60*96000)
-  parameter (NBYTES=8*NZ)
-  parameter (NPPR=NBYTES/NBPP)
-  integer*1 userx_no,iusb
-  integer*2 nblock
-  real*8 d(NZ),buf8
-
-  real*8 buf8a(174)
-  integer*2 id(4,174)
-  real*4 buf4(4,87)
-
-  integer fd
-  integer open,read,close
-  integer nm(11)
-  character*8 fname,arg,cjunk*1
-  logical fast,pause
-  real*8 center_freq,dmsec,dtmspacket,tmsec
-  common/plrscom/center_freq,msec2,fsample,iptr,nblock,userx_no,iusb,buf8(174)
-  equivalence (id,buf8a)
-  equivalence (buf8,buf4)
-  data nm/45,46,48,50,52,54,55,56,57,58,59/
-  data nblock/0/,fast/.false./,pause/.false./
-
-  nargs=iargc()
-  if(nargs.ne.5) then
-     print*,'Usage: plrs &lt;fast|pause|slow&gt; &lt;minutes&gt; &lt;iters&gt; &lt;iwait&gt; &lt;ifloat&gt;'
-     go to 999
-  endif
-
-  call getarg(1,arg)
-  if(arg(1:1).eq.'f' .or. arg(1:1).eq.'p') fast=.true.
-  if(arg(1:1).eq.'p') pause=.true.
-  call getarg(2,arg)
-  read(arg,*) nfiles
-  call getarg(3,arg)
-  read(arg,*) iters
-  call getarg(4,arg)
-  read(arg,*) iwait
-  call getarg(5,arg)
-  read(arg,*) ifloat
-
-  if(iwait.ne.0) then
-1    if(mod(int(sec_midn()),60).eq.0) go to 2
-     call sleep_msec(100)
-     go to 1
-  endif
-
-2 fname=&quot;all.tf2&quot;//char(0)
-  userx_no=2
-  if(ifloat.ne.0) userx_no=-2
-  iusb=1
-  center_freq=144.125d0
-  dtmspacket=1000.d0*NBPP/(8.d0*96000.d0)
-  if(ifloat.ne.0) dtmspacket=0.5*dtmspacket
-  fsample=96000.0
-  npkt=0
-
-  call setup_ssocket                       !Open a socket for multicasting
-
-  do iter=1,iters
-#ifdef CVF
-     open(10,file=fname,form='binary',status='old')
-#else
-     fd=open(fname,RMODE)                  !Open file for reading
-#endif
-     dmsec=-dtmspacket
-     sec0=sec_midn()
-
-     do ifile=1,nfiles
-        ns0=0
-        tmsec=1000*(3600*7 + 60*nm(ifile))-dtmspacket
-        k=0
-        do ipacket=1,NPPR
-           dmsec=dmsec+dtmspacket
-           tmsec=tmsec+dtmspacket
-           msec2=nint(tmsec)
-           msec=nint(dmsec)
-
-#ifdef CVF
-           read(10) buf8
-#else
-           nr=read(fd,buf8,NBPP)
-           if(nr.ne.NBPP) then
-              print*,'Error reading file all.tf2'
-              go to 999
-           endif
-#endif
-           if(ifloat.ne.0) then
-              buf8a=buf8
-              do i=1,87
-                 buf4(1,i)=id(1,i)
-                 buf4(2,i)=id(2,i)
-                 buf4(3,i)=id(3,i)
-                 buf4(4,i)=id(4,i)
-              enddo
-           endif
-
-           nblock=nblock+1
-           call send_pkt(center_freq)
-           npkt=npkt+1
-
-           if(ifloat.ne.0) then
-! Send a second packet if format is floating point
-              do i=1,87
-                 buf4(1,i)=id(1,i+87)
-                 buf4(2,i)=id(2,i+87)
-                 buf4(3,i)=id(3,i+87)
-                 buf4(4,i)=id(4,i+87)
-              enddo
-
-              dmsec=dmsec+dtmspacket
-              tmsec=tmsec+dtmspacket
-              msec2=nint(tmsec)
-              msec=nint(dmsec)
-              nblock=nblock+1
-              call send_pkt(center_freq)
-              npkt=npkt+1
-           endif
-
-
-              
-           if(mod(npkt,100).eq.0) then
-              sec=int(sec_midn())-sec0
-              nwait=msec-1000*sec
-!  Pace the data at close to its real-time rate
-              if(nwait.gt.0 .and. .not.fast) call sleep_msec(nwait)
-           endif
-           ns=mod(msec2/1000,60)
-           if(ns.ne.ns0) write(*,1010) ns,center_freq,0.001*msec2,sec_midn()
-1010       format('ns:',i3,'   f0:',f10.3,'   t1:',f10.3,'   t2:',f10.3)
-           ns0=ns
-        enddo
-        if(pause) then
-           print*,'Type anything to continue:'
-           read(*,*) cjunk,pause,fast
-        endif
-     enddo
-#ifdef CVF
-     close(10)
-#else
-     i=close(fd)
-#endif
-  enddo
-
-
-999 end program plrs
-
-! To compile: % gfortran -o plrs plrs.f90 plrs_subs.c cutil.c

Deleted: branches/map65/plrs_subs.c
===================================================================
--- branches/map65/plrs_subs.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/plrs_subs.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,41 +0,0 @@
-#include &lt;sys/types.h&gt;
-#include &lt;sys/socket.h&gt;
-#include &lt;netinet/in.h&gt;
-#include &lt;time.h&gt;
-#include &lt;stdio.h&gt;
-
-#include &lt;arpa/inet.h&gt;
-#include &lt;string.h&gt;
-#include &lt;stdlib.h&gt;
-
-#define HELLO_PORT 50004
-#define HELLO_GROUP &quot;239.255.0.0&quot;
-
-struct sockaddr_in addr;
-int fd;
-
-void setup_ssocket_(void)
-{
-  struct ip_mreq mreq;
-
-  /* create what looks like an ordinary UDP socket */
-  if ((fd=socket(AF_INET,SOCK_DGRAM,0)) &lt; 0) {
-    perror(&quot;socket&quot;);
-    exit(EXIT_FAILURE);
-  }
-
-  /* set up destination address */
-  memset(&amp;addr,0,sizeof(addr));
-  addr.sin_family=AF_INET;
-  //  addr.sin_addr.s_addr=inet_addr(HELLO_GROUP);
-  addr.sin_addr.s_addr=inet_addr(&quot;128.112.87.74&quot;);
-  addr.sin_port=htons(HELLO_PORT);
-}
-
-void send_pkt_(char buf[])
-{
-  if (sendto(fd,buf,1416,0,(struct sockaddr *) &amp;addr, 
-	     sizeof(addr)) &lt;  0) { 
-    perror(&quot;sendto&quot;);
-    exit(EXIT_FAILURE);}
-}

Deleted: branches/map65/plrs_subs_win.c
===================================================================
--- branches/map65/plrs_subs_win.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/plrs_subs_win.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,64 +0,0 @@
-#include &lt;winsock2.h&gt;
-#include &lt;ws2tcpip.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;stdio.h&gt;
-
-#define HELLO_PORT 50004
-//#define HELLO_GROUP &quot;239.255.0.0&quot;
-#define HELLO_GROUP &quot;127.0.0.1&quot;
-
-struct sockaddr_in addr;
-int fd;
-
-void __stdcall SETUP_SSOCKET(void)
-{
-  struct ip_mreq mreq;
-
-  // Make sure that we have compatible Winsock support
-  WORD wVersionRequested;
-  WSADATA wsaData;
-  int err;
- 
-  wVersionRequested = MAKEWORD( 2, 2 );
-  err = WSAStartup( wVersionRequested, &amp;wsaData );
-  if ( err != 0 ) {
-    /* Tell the user that we could not find a usable */
-    /* WinSock DLL.                                  */
-    exit(1);
-  }
- 
-  /* Confirm that the WinSock DLL supports 2.2.*/
-  /* Note that if the DLL supports versions greater    */
-  /* than 2.2 in addition to 2.2, it will still return */
-  /* 2.2 in wVersion since that is the version we      */
-  /* requested.                                        */
- 
-  if ( LOBYTE( wsaData.wVersion ) != 2 ||
-       HIBYTE( wsaData.wVersion ) != 2 ) {
-    /* Tell the user that we could not find a usable */
-    /* WinSock DLL.                                  */
-    WSACleanup( );
-    exit(1);
-  }
-  /* The WinSock DLL is acceptable. Proceed. */
-
-  /* create what looks like an ordinary UDP socket */
-  if ((fd=socket(AF_INET,SOCK_DGRAM,IPPROTO_UDP)) &lt; 0) {
-    perror(&quot;socket&quot;);
-    exit(1);
-  }
-
-  /* set up destination address */
-  memset(&amp;addr,0,sizeof(addr));
-  addr.sin_family=AF_INET;
-  addr.sin_addr.s_addr=inet_addr(HELLO_GROUP);
-  addr.sin_port=htons(HELLO_PORT);
-}
-
-void __stdcall SEND_PKT(char buf[])
-{
-  if (sendto(fd,buf,1416,0,
-	     (struct sockaddr *) &amp;addr, sizeof(addr)) &lt;  0) { 
-    perror(&quot;sendto&quot;);
-    exit(1);}
-}

Deleted: branches/map65/portaudio.h
===================================================================
--- branches/map65/portaudio.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/portaudio.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,1123 +0,0 @@
-
-#ifndef PORTAUDIO_H
-#define PORTAUDIO_H
-/*
- * $Id: portaudio.h,v 1.1 2005/11/29 21:27:24 joe Exp $
- * PortAudio Portable Real-Time Audio Library
- * PortAudio API Header File
- * Latest version available at: <A HREF="http://www.portaudio.com/">http://www.portaudio.com/</A>
- *
- * Copyright (c) 1999-2002 Ross Bencina and Phil Burk
- *
- * Permission is hereby granted, free of charge, to any person obtaining
- * a copy of this software and associated documentation files
- * (the &quot;Software&quot;), to deal in the Software without restriction,
- * including without limitation the rights to use, copy, modify, merge,
- * publish, distribute, sublicense, and/or sell copies of the Software,
- * and to permit persons to whom the Software is furnished to do so,
- * subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be
- * included in all copies or substantial portions of the Software.
- *
- * Any person wishing to distribute modifications to the Software is
- * requested to send the modifications to the original developer so that
- * they can be incorporated into the canonical version.
- *
- * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
- * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
- * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
- * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR
- * ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF
- * CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
- * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
- */
-
-/** @file
- @brief The PortAudio API.
-*/
-
-
-#ifdef __cplusplus
-extern &quot;C&quot;
-{
-#endif /* __cplusplus */
-
- 
-/** Retrieve the release number of the currently running PortAudio build,
- eg 1900.
-*/
-int Pa_GetVersion( void );
-
-
-/** Retrieve a textual description of the current PortAudio build,
- eg &quot;PortAudio V19-devel 13 October 2002&quot;.
-*/
-const char* Pa_GetVersionText( void );
-
-
-/** Error codes returned by PortAudio functions.
- Note that with the exception of paNoError, all PaErrorCodes are negative.
-*/
-
-typedef int PaError;
-typedef enum PaErrorCode
-{
-    paNoError = 0,
-
-    paNotInitialized = -10000,
-    paUnanticipatedHostError,
-    paInvalidChannelCount,
-    paInvalidSampleRate,
-    paInvalidDevice,
-    paInvalidFlag,
-    paSampleFormatNotSupported,
-    paBadIODeviceCombination,
-    paInsufficientMemory,
-    paBufferTooBig,
-    paBufferTooSmall,
-    paNullCallback,
-    paBadStreamPtr,
-    paTimedOut,
-    paInternalError,
-    paDeviceUnavailable,
-    paIncompatibleHostApiSpecificStreamInfo,
-    paStreamIsStopped,
-    paStreamIsNotStopped,
-    paInputOverflowed,
-    paOutputUnderflowed,
-    paHostApiNotFound,
-    paInvalidHostApi,
-    paCanNotReadFromACallbackStream,      /**&lt; @todo review error code name */
-    paCanNotWriteToACallbackStream,       /**&lt; @todo review error code name */
-    paCanNotReadFromAnOutputOnlyStream,   /**&lt; @todo review error code name */
-    paCanNotWriteToAnInputOnlyStream,     /**&lt; @todo review error code name */
-    paIncompatibleStreamHostApi
-} PaErrorCode;
-
-
-/** Translate the supplied PortAudio error code into a human readable
- message.
-*/
-const char *Pa_GetErrorText( PaError errorCode );
-
-
-/** Library initialization function - call this before using PortAudio.
- This function initialises internal data structures and prepares underlying
- host APIs for use. This function MUST be called before using any other
- PortAudio API functions.
-
- If Pa_Initialize() is called multiple times, each successful 
- call must be matched with a corresponding call to Pa_Terminate(). 
- Pairs of calls to Pa_Initialize()/Pa_Terminate() may overlap, and are not 
- required to be fully nested.
-
- Note that if Pa_Initialize() returns an error code, Pa_Terminate() should
- NOT be called.
-
- @return paNoError if successful, otherwise an error code indicating the cause
- of failure.
-
- @see Pa_Terminate
-*/
-PaError Pa_Initialize( void );
-
-
-/** Library termination function - call this when finished using PortAudio.
- This function deallocates all resources allocated by PortAudio since it was
- initializied by a call to Pa_Initialize(). In cases where Pa_Initialise() has
- been called multiple times, each call must be matched with a corresponding call
- to Pa_Terminate(). The final matching call to Pa_Terminate() will automatically
- close any PortAudio streams that are still open.
-
- Pa_Terminate() MUST be called before exiting a program which uses PortAudio.
- Failure to do so may result in serious resource leaks, such as audio devices
- not being available until the next reboot.
-
- @return paNoError if successful, otherwise an error code indicating the cause
- of failure.
- 
- @see Pa_Initialize
-*/
-PaError Pa_Terminate( void );
-
-
-
-/** The type used to refer to audio devices. Values of this type usually
- range from 0 to (Pa_DeviceCount-1), and may also take on the PaNoDevice
- and paUseHostApiSpecificDeviceSpecification values.
-
- @see Pa_DeviceCount, paNoDevice, paUseHostApiSpecificDeviceSpecification
-*/
-typedef int PaDeviceIndex;
-
-
-/** A special PaDeviceIndex value indicating that no device is available,
- or should be used.
-
- @see PaDeviceIndex
-*/
-#define paNoDevice ((PaDeviceIndex)-1)
-
-
-/** A special PaDeviceIndex value indicating that the device(s) to be used
- are specified in the host api specific stream info structure.
-
- @see PaDeviceIndex
-*/
-#define paUseHostApiSpecificDeviceSpecification ((PaDeviceIndex)-2)
-
-
-/* Host API enumeration mechanism */
-
-/** The type used to enumerate to host APIs at runtime. Values of this type
- range from 0 to (Pa_GetHostApiCount()-1).
-
- @see Pa_GetHostApiCount
-*/
-typedef int PaHostApiIndex;
-
-
-/** Retrieve the number of available host APIs. Even if a host API is
- available it may have no devices available.
-
- @return A non-negative value indicating the number of available host APIs
- or, a PaErrorCode (which are always negative) if PortAudio is not initialized
- or an error is encountered.
-
- @see PaHostApiIndex
-*/
-PaHostApiIndex Pa_GetHostApiCount( void );
-
-
-/** Retrieve the index of the default host API. The default host API will be
- the lowest common denominator host API on the current platform and is
- unlikely to provide the best performance.
-
- @return A non-negative value ranging from 0 to (Pa_GetHostApiCount()-1)
- indicating the default host API index or, a PaErrorCode (which are always
- negative) if PortAudio is not initialized or an error is encountered.
-*/
-PaHostApiIndex Pa_GetDefaultHostApi( void );
-
-
-/** Unchanging unique identifiers for each supported host API. This type
- is used in the PaHostApiInfo structure. The values are guaranteed to be
- unique and to never change, thus allowing code to be written that
- conditionally uses host API specific extensions.
-
- New type ids will be allocated when support for a host API reaches
- &quot;public alpha&quot; status, prior to that developers should use the
- paInDevelopment type id.
-
- @see PaHostApiInfo
-*/
-typedef enum PaHostApiTypeId
-{
-    paInDevelopment=0, /* use while developing support for a new host API */
-    paDirectSound=1,
-    paMME=2,
-    paASIO=3,
-    paSoundManager=4,
-    paCoreAudio=5,
-    paOSS=7,
-    paALSA=8,
-    paAL=9,
-    paBeOS=10,
-    paWDMKS=11,
-    paJACK=12
-} PaHostApiTypeId;
-
-
-/** A structure containing information about a particular host API. */
-
-typedef struct PaHostApiInfo
-{
-    /** this is struct version 1 */
-    int structVersion;
-    /** The well known unique identifier of this host API @see PaHostApiTypeId */
-    PaHostApiTypeId type;
-    /** A textual description of the host API for display on user interfaces. */
-    const char *name;
-
-    /**  The number of devices belonging to this host API. This field may be
-     used in conjunction with Pa_HostApiDeviceIndexToDeviceIndex() to enumerate
-     all devices for this host API.
-     @see Pa_HostApiDeviceIndexToDeviceIndex
-    */
-    int deviceCount;
-
-    /** The the default input device for this host API. The value will be a
-     device index ranging from 0 to (Pa_GetDeviceCount()-1), or paNoDevice
-     if no default input device is available.
-    */
-    PaDeviceIndex defaultInputDevice;
-
-    /** The the default output device for this host API. The value will be a
-     device index ranging from 0 to (Pa_GetDeviceCount()-1), or paNoDevice
-     if no default output device is available.
-    */
-    PaDeviceIndex defaultOutputDevice;
-    
-} PaHostApiInfo;
-
-
-/** Retrieve a pointer to a structure containing information about a specific
- host Api.
-
- @param hostApi A valid host API index ranging from 0 to (Pa_GetHostApiCount()-1)
-
- @return A pointer to an immutable PaHostApiInfo structure describing
- a specific host API. If the hostApi parameter is out of range or an error
- is encountered, the function returns NULL.
-
- The returned structure is owned by the PortAudio implementation and must not
- be manipulated or freed. The pointer is only guaranteed to be valid between
- calls to Pa_Initialize() and Pa_Terminate().
-*/
-const PaHostApiInfo * Pa_GetHostApiInfo( PaHostApiIndex hostApi );
-
-
-/** Convert a static host API unique identifier, into a runtime
- host API index.
-
- @param type A unique host API identifier belonging to the PaHostApiTypeId
- enumeration.
-
- @return A valid PaHostApiIndex ranging from 0 to (Pa_GetHostApiCount()-1) or,
- a PaErrorCode (which are always negative) if PortAudio is not initialized
- or an error is encountered.
- 
- The paHostApiNotFound error code indicates that the host API specified by the
- type parameter is not available.
-
- @see PaHostApiTypeId
-*/
-PaHostApiIndex Pa_HostApiTypeIdToHostApiIndex( PaHostApiTypeId type );
-
-
-/** Convert a host-API-specific device index to standard PortAudio device index.
- This function may be used in conjunction with the deviceCount field of
- PaHostApiInfo to enumerate all devices for the specified host API.
-
- @param hostApi A valid host API index ranging from 0 to (Pa_GetHostApiCount()-1)
-
- @param hostApiDeviceIndex A valid per-host device index in the range
- 0 to (Pa_GetHostApiInfo(hostApi)-&gt;deviceCount-1)
-
- @return A non-negative PaDeviceIndex ranging from 0 to (Pa_GetDeviceCount()-1)
- or, a PaErrorCode (which are always negative) if PortAudio is not initialized
- or an error is encountered.
-
- A paInvalidHostApi error code indicates that the host API index specified by
- the hostApi parameter is out of range.
-
- A paInvalidDevice error code indicates that the hostApiDeviceIndex parameter
- is out of range.
- 
- @see PaHostApiInfo
-*/
-PaDeviceIndex Pa_HostApiDeviceIndexToDeviceIndex( PaHostApiIndex hostApi,
-        int hostApiDeviceIndex );
-
-
-
-/** Structure used to return information about a host error condition.
-*/
-typedef struct PaHostErrorInfo{
-    PaHostApiTypeId hostApiType;    /**&lt; the host API which returned the error code */
-    long errorCode;                 /**&lt; the error code returned */
-    const char *errorText;          /**&lt; a textual description of the error if available, otherwise a zero-length string */
-}PaHostErrorInfo;
-
-
-/** Return information about the last host error encountered. The error
- information returned by Pa_GetLastHostErrorInfo() will never be modified
- asyncronously by errors occurring in other PortAudio owned threads
- (such as the thread that manages the stream callback.)
-
- This function is provided as a last resort, primarily to enhance debugging
- by providing clients with access to all available error information.
-
- @return A pointer to an immutable structure constaining information about
- the host error. The values in this structure will only be valid if a
- PortAudio function has previously returned the paUnanticipatedHostError
- error code.
-*/
-const PaHostErrorInfo* Pa_GetLastHostErrorInfo( void );
-
-
-
-/* Device enumeration and capabilities */
-
-/** Retrieve the number of available devices. The number of available devices
- may be zero.
-
- @return A non-negative value indicating the number of available devices or,
- a PaErrorCode (which are always negative) if PortAudio is not initialized
- or an error is encountered.
-*/
-PaDeviceIndex Pa_GetDeviceCount( void );
-
-
-/** Retrieve the index of the default input device. The result can be
- used in the inputDevice parameter to Pa_OpenStream().
-
- @return The default input device index for the default host API, or paNoDevice
- if no default input device is available or an error was encountered.
-*/
-PaDeviceIndex Pa_GetDefaultInputDevice( void );
-
-
-/** Retrieve the index of the default output device. The result can be
- used in the outputDevice parameter to Pa_OpenStream().
-
- @return The default output device index for the defualt host API, or paNoDevice
- if no default output device is available or an error was encountered.
-
- @note
- On the PC, the user can specify a default device by
- setting an environment variable. For example, to use device #1.
-&lt;pre&gt;
- set PA_RECOMMENDED_OUTPUT_DEVICE=1
-&lt;/pre&gt;
- The user should first determine the available device ids by using
- the supplied application &quot;pa_devs&quot;.
-*/
-PaDeviceIndex Pa_GetDefaultOutputDevice( void );
-
-
-/** The type used to represent monotonic time in seconds that can be used
- for syncronisation. The type is used for the outTime argument to the
- PaStreamCallback and as the result of Pa_GetStreamTime().
-     
- @see PaStreamCallback, Pa_GetStreamTime
-*/
-typedef double PaTime;
-
-
-/** A type used to specify one or more sample formats. Each value indicates
- a possible format for sound data passed to and from the stream callback,
- Pa_ReadStream and Pa_WriteStream.
-
- The standard formats paFloat32, paInt16, paInt32, paInt24, paInt8
- and aUInt8 are usually implemented by all implementations.
-
- The floating point representation (paFloat32) uses +1.0 and -1.0 as the
- maximum and minimum respectively.
-
- paUInt8 is an unsigned 8 bit format where 128 is considered &quot;ground&quot;
-
- The paNonInterleaved flag indicates that a multichannel buffer is passed
- as a set of non-interleaved pointers.
-
- @see Pa_OpenStream, Pa_OpenDefaultStream, PaDeviceInfo
- @see paFloat32, paInt16, paInt32, paInt24, paInt8
- @see paUInt8, paCustomFormat, paNonInterleaved
-*/
-typedef unsigned long PaSampleFormat;
-
-
-#define paFloat32        ((PaSampleFormat) 0x00000001) /**&lt; @see PaSampleFormat */
-#define paInt32          ((PaSampleFormat) 0x00000002) /**&lt; @see PaSampleFormat */
-#define paInt24          ((PaSampleFormat) 0x00000004) /**&lt; Packed 24 bit format. @see PaSampleFormat */
-#define paInt16          ((PaSampleFormat) 0x00000008) /**&lt; @see PaSampleFormat */
-#define paInt8           ((PaSampleFormat) 0x00000010) /**&lt; @see PaSampleFormat */
-#define paUInt8          ((PaSampleFormat) 0x00000020) /**&lt; @see PaSampleFormat */
-#define paCustomFormat   ((PaSampleFormat) 0x00010000)/**&lt; @see PaSampleFormat */
-
-#define paNonInterleaved ((PaSampleFormat) 0x80000000)
-
-/** A structure providing information and capabilities of PortAudio devices.
- Devices may support input, output or both input and output.
-*/
-typedef struct PaDeviceInfo
-{
-    int structVersion;  /* this is struct version 2 */
-    const char *name;
-    PaHostApiIndex hostApi; /* note this is a host API index, not a type id*/
-    
-    int maxInputChannels;
-    int maxOutputChannels;
-
-    /* Default latency values for interactive performance. */
-    PaTime defaultLowInputLatency;
-    PaTime defaultLowOutputLatency;
-    /* Default latency values for robust non-interactive applications (eg. playing sound files). */
-    PaTime defaultHighInputLatency;
-    PaTime defaultHighOutputLatency;
-
-    double defaultSampleRate;
-} PaDeviceInfo;
-
-
-/** Retrieve a pointer to a PaDeviceInfo structure containing information
- about the specified device.
- @return A pointer to an immutable PaDeviceInfo structure. If the device
- parameter is out of range the function returns NULL.
-
- @param device A valid device index in the range 0 to (Pa_GetDeviceCount()-1)
-
- @note PortAudio manages the memory referenced by the returned pointer,
- the client must not manipulate or free the memory. The pointer is only
- guaranteed to be valid between calls to Pa_Initialize() and Pa_Terminate().
-
- @see PaDeviceInfo, PaDeviceIndex
-*/
-const PaDeviceInfo* Pa_GetDeviceInfo( PaDeviceIndex device );
-
-
-/** Parameters for one direction (input or output) of a stream.
-*/
-typedef struct PaStreamParameters
-{
-    /** A valid device index in the range 0 to (Pa_GetDeviceCount()-1)
-     specifying the device to be used or the special constant
-     paUseHostApiSpecificDeviceSpecification which indicates that the actual
-     device(s) to use are specified in hostApiSpecificStreamInfo.
-     This field must not be set to paNoDevice.
-    */
-    PaDeviceIndex device;
-    
-    /** The number of channels of sound to be delivered to the
-     stream callback or accessed by Pa_ReadStream() or Pa_WriteStream().
-     It can range from 1 to the value of maxInputChannels in the
-     PaDeviceInfo record for the device specified by the device parameter.
-    */
-    int channelCount;
-
-    /** The sample format of the buffer provided to the stream callback,
-     a_ReadStream() or Pa_WriteStream(). It may be any of the formats described
-     by the PaSampleFormat enumeration.
-    */
-    PaSampleFormat sampleFormat;
-
-    /** The desired latency in seconds. Where practical, implementations should
-     configure their latency based on these parameters, otherwise they may
-     choose the closest viable latency instead. Unless the suggested latency
-     is greater than the absolute upper limit for the device implementations
-     shouldround the suggestedLatency up to the next practial value - ie to
-     provide an equal or higher latency than suggestedLatency whereever possibe.
-     Actual latency values for an open stream may be retrieved using the
-     inputLatency and outputLatency fields of the PaStreamInfo structure
-     returned by Pa_GetStreamInfo().
-     @see default*Latency in PaDeviceInfo, *Latency in PaStreamInfo
-    */
-    PaTime suggestedLatency;
-
-    /** An optional pointer to a host api specific data structure
-     containing additional information for device setup and/or stream processing.
-     hostApiSpecificStreamInfo is never required for correct operation,
-     if not used it should be set to NULL.
-    */
-    void *hostApiSpecificStreamInfo;
-
-} PaStreamParameters;
-
-
-/** Return code for Pa_IsFormatSupported indicating success. */
-#define paFormatIsSupported (0)
-
-/** Determine whether it would be possible to open a stream with the specified
- parameters.
-
- @param inputParameters A structure that describes the input parameters used to
- open a stream. The suggestedLatency field is ignored. See PaStreamParameters
- for a description of these parameters. inputParameters must be NULL for
- output-only streams.
-
- @param outputParameters A structure that describes the output parameters used
- to open a stream. The suggestedLatency field is ignored. See PaStreamParameters
- for a description of these parameters. outputParameters must be NULL for
- input-only streams.
-
- @param sampleRate The required sampleRate. For full-duplex streams it is the
- sample rate for both input and output
-
- @return Returns 0 if the format is supported, and an error code indicating why
- the format is not supported otherwise. The constant paFormatIsSupported is
- provided to compare with the return value for success.
-
- @see paFormatIsSupported, PaStreamParameters
-*/
-PaError Pa_IsFormatSupported( const PaStreamParameters *inputParameters,
-                              const PaStreamParameters *outputParameters,
-                              double sampleRate );
-
-
-
-/* Streaming types and functions */
-
-
-/**
- A single PaStream can provide multiple channels of real-time
- streaming audio input and output to a client application. A stream
- provides access to audio hardware represented by one or more
- PaDevices. Depending on the underlying Host API, it may be possible 
- to open multiple streams using the same device, however this behavior 
- is implementation defined. Portable applications should assume that 
- a PaDevice may be simultaneously used by at most one PaStream.
-
- Pointers to PaStream objects are passed between PortAudio functions that
- operate on streams.
-
- @see Pa_OpenStream, Pa_OpenDefaultStream, Pa_OpenDefaultStream, Pa_CloseStream,
- Pa_StartStream, Pa_StopStream, Pa_AbortStream, Pa_IsStreamActive,
- Pa_GetStreamTime, Pa_GetStreamCpuLoad
-
-*/
-typedef void PaStream;
-
-
-/** Can be passed as the framesPerBuffer parameter to Pa_OpenStream()
- or Pa_OpenDefaultStream() to indicate that the stream callback will
- accept buffers of any size.
-*/
-#define paFramesPerBufferUnspecified  (0)
-
-
-/** Flags used to control the behavior of a stream. They are passed as
- parameters to Pa_OpenStream or Pa_OpenDefaultStream. Multiple flags may be
- ORed together.
-
- @see Pa_OpenStream, Pa_OpenDefaultStream
- @see paNoFlag, paClipOff, paDitherOff, paNeverDropInput,
-  paPrimeOutputBuffersUsingStreamCallback, paPlatformSpecificFlags
-*/
-typedef unsigned long PaStreamFlags;
-
-/** @see PaStreamFlags */
-#define   paNoFlag          ((PaStreamFlags) 0)
-
-/** Disable default clipping of out of range samples.
- @see PaStreamFlags
-*/
-#define   paClipOff         ((PaStreamFlags) 0x00000001)
-
-/** Disable default dithering.
- @see PaStreamFlags
-*/
-#define   paDitherOff       ((PaStreamFlags) 0x00000002)
-
-/** Flag requests that where possible a full duplex stream will not discard
- overflowed input samples without calling the stream callback. This flag is
- only valid for full duplex callback streams and only when used in combination
- with the paFramesPerBufferUnspecified (0) framesPerBuffer parameter. Using
- this flag incorrectly results in a paInvalidFlag error being returned from
- Pa_OpenStream and Pa_OpenDefaultStream.
-
- @see PaStreamFlags, paFramesPerBufferUnspecified
-*/
-#define   paNeverDropInput  ((PaStreamFlags) 0x00000004)
-
-/** Call the stream callback to fill initial output buffers, rather than the
- default behavior of priming the buffers with zeros (silence). This flag has
- no effect for input-only and blocking read/write streams.
- 
- @see PaStreamFlags
-*/
-#define   paPrimeOutputBuffersUsingStreamCallback ((PaStreamFlags) 0x00000008)
-
-/** A mask specifying the platform specific bits.
- @see PaStreamFlags
-*/
-#define   paPlatformSpecificFlags ((PaStreamFlags)0xFFFF0000)
-
-/**
- Timing information for the buffers passed to the stream callback.
-*/
-typedef struct PaStreamCallbackTimeInfo{
-    PaTime inputBufferAdcTime;
-    PaTime currentTime;
-    PaTime outputBufferDacTime;
-} PaStreamCallbackTimeInfo;
-
-
-/**
- Flag bit constants for the statusFlags to PaStreamCallback.
-
- @see paInputUnderflow, paInputOverflow, paOutputUnderflow, paOutputOverflow,
- paPrimingOutput
-*/
-typedef unsigned long PaStreamCallbackFlags;
-
-/** In a stream opened with paFramesPerBufferUnspecified, indicates that
- input data is all silence (zeros) because no real data is available. In a
- stream opened without paFramesPerBufferUnspecified, it indicates that one or
- more zero samples have been inserted into the input buffer to compensate
- for an input underflow.
- @see PaStreamCallbackFlags
-*/
-#define paInputUnderflow   ((PaStreamCallbackFlags) 0x00000001)
-
-/** In a stream opened with paFramesPerBufferUnspecified, indicates that data
- prior to the first sample of the input buffer was discarded due to an
- overflow, possibly because the stream callback is using too much CPU time.
- Otherwise indicates that data prior to one or more samples in the
- input buffer was discarded.
- @see PaStreamCallbackFlags
-*/
-#define paInputOverflow    ((PaStreamCallbackFlags) 0x00000002)
-
-/** Indicates that output data (or a gap) was inserted, possibly because the
- stream callback is using too much CPU time.
- @see PaStreamCallbackFlags
-*/
-#define paOutputUnderflow  ((PaStreamCallbackFlags) 0x00000004)
-
-/** Indicates that output data will be discarded because no room is available.
- @see PaStreamCallbackFlags
-*/
-#define paOutputOverflow   ((PaStreamCallbackFlags) 0x00000008)
-
-/** Some of all of the output data will be used to prime the stream, input
- data may be zero.
- @see PaStreamCallbackFlags
-*/
-#define paPrimingOutput    ((PaStreamCallbackFlags) 0x00000010)
-
-/**
- Allowable return values for the PaStreamCallback.
- @see PaStreamCallback
-*/
-typedef enum PaStreamCallbackResult
-{
-    paContinue=0,
-    paComplete=1,
-    paAbort=2
-} PaStreamCallbackResult;
-
-
-/**
- Functions of type PaStreamCallback are implemented by PortAudio clients.
- They consume, process or generate audio in response to requests from an
- active PortAudio stream.
-     
- @param input and @param output are arrays of interleaved samples,
- the format, packing and number of channels used by the buffers are
- determined by parameters to Pa_OpenStream().
-     
- @param frameCount The number of sample frames to be processed by
- the stream callback.
-
- @param timeInfo The time in seconds when the first sample of the input
- buffer was received at the audio input, the time in seconds when the first
- sample of the output buffer will begin being played at the audio output, and
- the time in seconds when the stream callback was called.
- See also Pa_GetStreamTime()
-
- @param statusFlags Flags indicating whether input and/or output buffers
- have been inserted or will be dropped to overcome underflow or overflow
- conditions.
-
- @param userData The value of a user supplied pointer passed to
- Pa_OpenStream() intended for storing synthesis data etc.
-
- @return
- The stream callback should return one of the values in the
- PaStreamCallbackResult enumeration. To ensure that the callback continues
- to be called, it should return paContinue (0). Either paComplete or paAbort
- can be returned to finish stream processing, after either of these values is
- returned the callback will not be called again. If paAbort is returned the
- stream will finish as soon as possible. If paComplete is returned, the stream
- will continue until all buffers generated by the callback have been played.
- This may be useful in applications such as soundfile players where a specific
- duration of output is required. However, it is not necessary to utilise this
- mechanism as Pa_StopStream(), Pa_AbortStream() or Pa_CloseStream() can also
- be used to stop the stream. The callback must always fill the entire output
- buffer irrespective of its return value.
-
- @see Pa_OpenStream, Pa_OpenDefaultStream
-
- @note With the exception of Pa_GetStreamCpuLoad() it is not permissable to call
- PortAudio API functions from within the stream callback.
-*/
-typedef int PaStreamCallback(
-    const void *input, void *output,
-    unsigned long frameCount,
-    const PaStreamCallbackTimeInfo* timeInfo,
-    PaStreamCallbackFlags statusFlags,
-    void *userData );
-
-
-/** Opens a stream for either input, output or both.
-     
- @param stream The address of a PaStream pointer which will receive
- a pointer to the newly opened stream.
-     
- @param inputParameters A structure that describes the input parameters used by
- the opened stream. See PaStreamParameters for a description of these parameters.
- inputParameters must be NULL for output-only streams.
-
- @param outputParameters A structure that describes the output parameters used by
- the opened stream. See PaStreamParameters for a description of these parameters.
- outputParameters must be NULL for input-only streams.
- 
- @param sampleRate The desired sampleRate. For full-duplex streams it is the
- sample rate for both input and output
-     
- @param framesPerBuffer The number of frames passed to the stream callback
- function, or the preferred block granularity for a blocking read/write stream.
- The special value paFramesPerBufferUnspecified (0) may be used to request that
- the stream callback will recieve an optimal (and possibly varying) number of
- frames based on host requirements and the requested latency settings.
- Note: With some host APIs, the use of non-zero framesPerBuffer for a callback
- stream may introduce an additional layer of buffering which could introduce
- additional latency. PortAudio guarantees that the additional latency
- will be kept to the theoretical minimum however, it is strongly recommended
- that a non-zero framesPerBuffer value only be used when your algorithm
- requires a fixed number of frames per stream callback.
- 
- @param streamFlags Flags which modify the behaviour of the streaming process.
- This parameter may contain a combination of flags ORed together. Some flags may
- only be relevant to certain buffer formats.
-     
- @param streamCallback A pointer to a client supplied function that is responsible
- for processing and filling input and output buffers. If this parameter is NULL
- the stream will be opened in 'blocking read/write' mode. In blocking mode,
- the client can receive sample data using Pa_ReadStream and write sample data
- using Pa_WriteStream, the number of samples that may be read or written
- without blocking is returned by Pa_GetStreamReadAvailable and
- Pa_GetStreamWriteAvailable respectively.
-
- @param userData A client supplied pointer which is passed to the stream callback
- function. It could for example, contain a pointer to instance data necessary
- for processing the audio buffers. This parameter is ignored if streamCallback
- is NULL.
-     
- @return
- Upon success Pa_OpenStream() returns paNoError and places a pointer to a
- valid PaStream in the stream argument. The stream is inactive (stopped).
- If a call to Pa_OpenStream() fails, a non-zero error code is returned (see
- PaError for possible error codes) and the value of stream is invalid.
-
- @see PaStreamParameters, PaStreamCallback, Pa_ReadStream, Pa_WriteStream,
- Pa_GetStreamReadAvailable, Pa_GetStreamWriteAvailable
-*/
-PaError Pa_OpenStream( PaStream** stream,
-                       const PaStreamParameters *inputParameters,
-                       const PaStreamParameters *outputParameters,
-                       double sampleRate,
-                       unsigned long framesPerBuffer,
-                       PaStreamFlags streamFlags,
-                       PaStreamCallback *streamCallback,
-                       void *userData );
-
-
-/** A simplified version of Pa_OpenStream() that opens the default input
- and/or output devices.
-
- @param stream The address of a PaStream pointer which will receive
- a pointer to the newly opened stream.
- 
- @param numInputChannels  The number of channels of sound that will be supplied
- to the stream callback or returned by Pa_ReadStream. It can range from 1 to
- the value of maxInputChannels in the PaDeviceInfo record for the default input
- device. If 0 the stream is opened as an output-only stream.
-
- @param numOutputChannels The number of channels of sound to be delivered to the
- stream callback or passed to Pa_WriteStream. It can range from 1 to the value
- of maxOutputChannels in the PaDeviceInfo record for the default output dvice.
- If 0 the stream is opened as an output-only stream.
-
- @param sampleFormat The sample format of both the input and output buffers
- provided to the callback or passed to and from Pa_ReadStream and Pa_WriteStream.
- sampleFormat may be any of the formats described by the PaSampleFormat
- enumeration.
- 
- @param sampleRate Same as Pa_OpenStream parameter of the same name.
- @param framesPerBuffer Same as Pa_OpenStream parameter of the same name.
- @param streamCallback Same as Pa_OpenStream parameter of the same name.
- @param userData Same as Pa_OpenStream parameter of the same name.
-
- @return As for Pa_OpenStream
-
- @see Pa_OpenStream, PaStreamCallback
-*/
-PaError Pa_OpenDefaultStream( PaStream** stream,
-                              int numInputChannels,
-                              int numOutputChannels,
-                              PaSampleFormat sampleFormat,
-                              double sampleRate,
-                              unsigned long framesPerBuffer,
-                              PaStreamCallback *streamCallback,
-                              void *userData );
-
-
-/** Closes an audio stream. If the audio stream is active it
- discards any pending buffers as if Pa_AbortStream() had been called.
-*/
-PaError Pa_CloseStream( PaStream *stream );
-
-
-/** Functions of type PaStreamFinishedCallback are implemented by PortAudio 
- clients. They can be registered with a stream using the Pa_SetStreamFinishedCallback
- function. Once registered they are called when the stream becomes inactive
- (ie once a call to Pa_StopStream() will not block).
- A stream will become inactive after the stream callback returns non-zero,
- or when Pa_StopStream or Pa_AbortStream is called. For a stream providing audio
- output, if the stream callback returns paComplete, or Pa_StopStream is called,
- the stream finished callback will not be called until all generated sample data
- has been played.
- 
- @param userData The userData parameter supplied to Pa_OpenStream()
-
- @see Pa_SetStreamFinishedCallback
-*/
-typedef void PaStreamFinishedCallback( void *userData );
-
-
-/** Register a stream finished callback function which will be called when the 
- stream becomes inactive. See the description of PaStreamFinishedCallback for 
- further details about when the callback will be called.
-
- @param stream a pointer to a PaStream that is in the stopped state - if the
- stream is not stopped, the stream's finished callback will remain unchanged 
- and an error code will be returned.
-
- @param streamFinishedCallback a pointer to a function with the same signature
- as PaStreamFinishedCallback, that will be called when the stream becomes
- inactive. Passing NULL for this parameter will un-register a previously
- registered stream finished callback function.
-
- @return on success returns paNoError, otherwise an error code indicating the cause
- of the error.
-
- @see PaStreamFinishedCallback
-*/
-PaError Pa_SetStreamFinishedCallback( PaStream *stream, PaStreamFinishedCallback* streamFinishedCallback ); 
-
-
-/** Commences audio processing.
-*/
-PaError Pa_StartStream( PaStream *stream );
-
-
-/** Terminates audio processing. It waits until all pending
- audio buffers have been played before it returns.
-*/
-PaError Pa_StopStream( PaStream *stream );
-
-
-/** Terminates audio processing immediately without waiting for pending
- buffers to complete.
-*/
-PaError Pa_AbortStream( PaStream *stream );
-
-
-/** Determine whether the stream is stopped.
- A stream is considered to be stopped prior to a successful call to
- Pa_StartStream and after a successful call to Pa_StopStream or Pa_AbortStream.
- If a stream callback returns a value other than paContinue the stream is NOT
- considered to be stopped.
-
- @return Returns one (1) when the stream is stopped, zero (0) when
- the stream is running or, a PaErrorCode (which are always negative) if
- PortAudio is not initialized or an error is encountered.
-
- @see Pa_StopStream, Pa_AbortStream, Pa_IsStreamActive
-*/
-PaError Pa_IsStreamStopped( PaStream *stream );
-
-
-/** Determine whether the stream is active.
- A stream is active after a successful call to Pa_StartStream(), until it
- becomes inactive either as a result of a call to Pa_StopStream() or
- Pa_AbortStream(), or as a result of a return value other than paContinue from
- the stream callback. In the latter case, the stream is considered inactive
- after the last buffer has finished playing.
-
- @return Returns one (1) when the stream is active (ie playing or recording
- audio), zero (0) when not playing or, a PaErrorCode (which are always negative)
- if PortAudio is not initialized or an error is encountered.
-
- @see Pa_StopStream, Pa_AbortStream, Pa_IsStreamStopped
-*/
-PaError Pa_IsStreamActive( PaStream *stream );
-
-
-
-/** A structure containing unchanging information about an open stream.
- @see Pa_GetStreamInfo
-*/
-
-typedef struct PaStreamInfo
-{
-    /** this is struct version 1 */
-    int structVersion;
-
-    /** The input latency of the stream in seconds. This value provides the most
-     accurate estimate of input latency available to the implementation. It may
-     differ significantly from the suggestedLatency value passed to Pa_OpenStream().
-     The value of this field will be zero (0.) for output-only streams.
-     @see PaTime
-    */
-    PaTime inputLatency;
-
-    /** The output latency of the stream in seconds. This value provides the most
-     accurate estimate of output latency available to the implementation. It may
-     differ significantly from the suggestedLatency value passed to Pa_OpenStream().
-     The value of this field will be zero (0.) for input-only streams.
-     @see PaTime
-    */
-    PaTime outputLatency;
-
-    /** The sample rate of the stream in Hertz (samples per second). In cases
-     where the hardware sample rate is inaccurate and PortAudio is aware of it,
-     the value of this field may be different from the sampleRate parameter
-     passed to Pa_OpenStream(). If information about the actual hardware sample
-     rate is not available, this field will have the same value as the sampleRate
-     parameter passed to Pa_OpenStream().
-    */
-    double sampleRate;
-    
-} PaStreamInfo;
-
-
-/** Retrieve a pointer to a PaStreamInfo structure containing information
- about the specified stream.
- @return A pointer to an immutable PaStreamInfo structure. If the stream
- parameter invalid, or an error is encountered, the function returns NULL.
-
- @param stream A pointer to an open stream previously created with Pa_OpenStream.
-
- @note PortAudio manages the memory referenced by the returned pointer,
- the client must not manipulate or free the memory. The pointer is only
- guaranteed to be valid until the specified stream is closed.
-
- @see PaStreamInfo
-*/
-const PaStreamInfo* Pa_GetStreamInfo( PaStream *stream );
-
-
-/** Determine the current time for the stream according to the same clock used
- to generate buffer timestamps. This time may be used for syncronising other
- events to the audio stream, for example synchronizing audio to MIDI.
-                                        
- @return The stream's current time in seconds, or 0 if an error occurred.
-
- @see PaTime, PaStreamCallback
-*/
-PaTime Pa_GetStreamTime( PaStream *stream );
-
-
-/** Retrieve CPU usage information for the specified stream.
- The &quot;CPU Load&quot; is a fraction of total CPU time consumed by a callback stream's
- audio processing routines including, but not limited to the client supplied
- stream callback. This function does not work with blocking read/write streams.
-
- This function may be called from the stream callback function or the
- application.
-     
- @return
- A floating point value, typically between 0.0 and 1.0, where 1.0 indicates
- that the stream callback is consuming the maximum number of CPU cycles possible
- to maintain real-time operation. A value of 0.5 would imply that PortAudio and
- the stream callback was consuming roughly 50% of the available CPU time. The
- return value may exceed 1.0. A value of 0.0 will always be returned for a
- blocking read/write stream, or if an error occurrs.
-*/
-double Pa_GetStreamCpuLoad( PaStream* stream );
-
-
-/** Read samples from an input stream. The function doesn't return until
- the entire buffer has been filled - this may involve waiting for the operating
- system to supply the data.
-
- @param stream A pointer to an open stream previously created with Pa_OpenStream.
- 
- @param buffer A pointer to a buffer of sample frames. The buffer contains
- samples in the format specified by the inputParameters-&gt;sampleFormat field
- used to open the stream, and the number of channels specified by
- inputParameters-&gt;numChannels. If non-interleaved samples were requested,
- buffer is a pointer to the first element of an array of non-interleaved
- buffer pointers, one for each channel.
-
- @param frames The number of frames to be read into buffer. This parameter
- is not constrained to a specific range, however high performance applications
- will want to match this parameter to the framesPerBuffer parameter used
- when opening the stream.
-
- @return On success PaNoError will be returned, or PaInputOverflowed if input
- data was discarded by PortAudio after the previous call and before this call.
-*/
-PaError Pa_ReadStream( PaStream* stream,
-                       void *buffer,
-                       unsigned long frames );
-
-
-/** Write samples to an output stream. This function doesn't return until the
- entire buffer has been consumed - this may involve waiting for the operating
- system to consume the data.
-
- @param stream A pointer to an open stream previously created with Pa_OpenStream.
-
- @param buffer A pointer to a buffer of sample frames. The buffer contains
- samples in the format specified by the outputParameters-&gt;sampleFormat field
- used to open the stream, and the number of channels specified by
- outputParameters-&gt;numChannels. If non-interleaved samples were requested,
- buffer is a pointer to the first element of an array of non-interleaved
- buffer pointers, one for each channel.
-
- @param frames The number of frames to be written from buffer. This parameter
- is not constrained to a specific range, however high performance applications
- will want to match this parameter to the framesPerBuffer parameter used
- when opening the stream.
-
- @return On success PaNoError will be returned, or paOutputUnderflowed if
- additional output data was inserted after the previous call and before this
- call.
-*/
-PaError Pa_WriteStream( PaStream* stream,
-                        const void *buffer,
-                        unsigned long frames );
-
-
-/** Retrieve the number of frames that can be read from the stream without
- waiting.
-
- @return Returns a non-negative value representing the maximum number of frames
- that can be read from the stream without blocking or busy waiting or, a
- PaErrorCode (which are always negative) if PortAudio is not initialized or an
- error is encountered.
-*/
-signed long Pa_GetStreamReadAvailable( PaStream* stream );
-
-
-/** Retrieve the number of frames that can be written to the stream without
- waiting.
-
- @return Returns a non-negative value representing the maximum number of frames
- that can be written to the stream without blocking or busy waiting or, a
- PaErrorCode (which are always negative) if PortAudio is not initialized or an
- error is encountered.
-*/
-signed long Pa_GetStreamWriteAvailable( PaStream* stream );
-
-
-/* Miscellaneous utilities */
-
-
-/** Retrieve the size of a given sample format in bytes.
-
- @return The size in bytes of a single sample in the specified format,
- or paSampleFormatNotSupported if the format is not supported.
-*/
-PaError Pa_GetSampleSize( PaSampleFormat format );
-
-
-/** Put the caller to sleep for at least 'msec' milliseconds. This function is
- provided only as a convenience for authors of portable code (such as the tests
- and examples in the PortAudio distribution.)
-
- The function may sleep longer than requested so don't rely on this for accurate
- musical timing.
-*/
-void Pa_Sleep( long msec );
-
-
-
-#ifdef __cplusplus
-}
-#endif /* __cplusplus */
-#endif /* PORTAUDIO_H */

Deleted: branches/map65/prcom.h
===================================================================
--- branches/map65/prcom.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/prcom.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1 +0,0 @@
-      common/prcom/pr(135),mdat(126),mref(126,2),mdat2(126),mref2(126,2)

Deleted: branches/map65/ptt.c
===================================================================
--- branches/map65/ptt.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/ptt.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,42 +0,0 @@
-#include &lt;windows.h&gt;
-#include &lt;stdio.h&gt;
-
-int ptt_(int *nport, char *unused, int *ntx, int *iptt)
-{
-  static HANDLE hFile;
-  static int open=0;
-  char s[10];
-  int i3,i4,i5,i6,i9,i00;
-
-  if(*nport==0) {
-    *iptt=*ntx;
-    return(0);
-  }
-
-  if(*ntx &amp;&amp; (!open)) {
-    sprintf(s,&quot;COM%d&quot;,*nport);
-    hFile=CreateFile(TEXT(s),GENERIC_WRITE,0,NULL,OPEN_EXISTING,
-		     FILE_ATTRIBUTE_NORMAL,NULL);
-    if(hFile==INVALID_HANDLE_VALUE) {
-      printf(&quot;PTT: Cannot open COM port %d.\n&quot;,*nport);
-      return(1);
-    }
-    open=1;
-  }
-
-  if(*ntx &amp;&amp; open) {
-    EscapeCommFunction(hFile,3);
-    EscapeCommFunction(hFile,5);
-    *iptt=1;
-  }
-
-  else {
-    EscapeCommFunction(hFile,4);
-    EscapeCommFunction(hFile,6);
-    EscapeCommFunction(hFile,9);
-    i00=CloseHandle(hFile);
-    *iptt=0;
-    open=0;
-  }
-  return(0);
-}

Deleted: branches/map65/ptt_unix.c
===================================================================
--- branches/map65/ptt_unix.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/ptt_unix.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,383 +0,0 @@
-/*
- * WSJT is Copyright (c) 2001-2006 by Joseph H. Taylor, Jr., K1JT, 
- * and is licensed under the GNU General Public License (GPL).
- *
- * Code used from cwdaemon for parallel port ptt only.
- *
- * cwdaemon - morse sounding daemon for the parallel or serial port
- * Copyright (C) 2002 -2005 Joop Stakenborg &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">pg4i at amsat.org</A>&gt;
- *                       and many authors, see the AUTHORS file.
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU Library General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-# if HAVE_STDIO_H
-# include &lt;stdio.h&gt;
-#endif
-#if STDC_HEADERS
-# include &lt;stdlib.h&gt;
-# include &lt;stddef.h&gt;
-#else
-# if HAVE_STDLIB_H
-#  include &lt;stdlib.h&gt;
-# endif
-#endif
-#if HAVE_UNISTD_H
-# include &lt;unistd.h&gt;
-#endif
-#if HAVE_SYS_IOCTL_H
-# include &lt;sys/ioctl.h&gt;
-#endif
-#if HAVE_FCNTL_H
-# include &lt;fcntl.h&gt;
-#endif
-
-#ifdef HAVE_LINUX_PPDEV_H
-# include &lt;linux/ppdev.h&gt;
-# include &lt;linux/parport.h&gt;
-#endif
-#ifdef HAVE_DEV_PPBUS_PPI_H
-# include &lt;dev/ppbus/ppi.h&gt;
-# include &lt;dev/ppbus/ppbconf.h&gt;
-#endif
-
-int lp_reset (int fd);
-int lp_ptt (int fd, int onoff);
-
-#ifdef HAVE_SYS_STAT_H
-# include &lt;sys/stat.h&gt;
-#endif
-#if (defined(__unix__) || defined(unix)) &amp;&amp; !defined(USG)
-# include &lt;sys/param.h&gt;
-#endif
-
-#include &lt;string.h&gt;
-/* parport functions */
-
-int dev_is_parport(int fd);
-int ptt_parallel(int fd, int *ntx, int *iptt);
-int ptt_serial(int fd, int *ntx, int *iptt);
-
-int fd=-1;		/* Used for both serial and parallel */
-
-/*
- * ptt_
- *
- * generic unix PTT routine called from Fortran
- *
- * Inputs	
- * unused	Unused, to satisfy old windows calling convention
- * ptt_port	device name serial or parallel
- * ntx		pointer to fortran command on or off
- * iptt		pointer to fortran command status on or off
- * Returns	- non 0 if error
-*/
-
-/* Tiny state machine */
-#define STATE_PORT_CLOSED		0
-#define STATE_PORT_OPEN_PARALLEL	1
-#define STATE_PORT_OPEN_SERIAL		2
-
-int
-ptt_(int *unused, char *ptt_port, int *ntx, int *iptt)
-{
-  static int state=0;
-  char *p;
-
-  /* In the very unlikely event of a NULL pointer, just return.
-   * Yes, I realise this should not be possible in WSJT.
-   */
-  if (ptt_port == NULL) {
-    *iptt = *ntx;
-    return (0);
-  }
-    
-  switch (state) {
-  case STATE_PORT_CLOSED:
-
-     /* Remove trailing ' ' */
-    if ((p = strchr(ptt_port, ' ')) != NULL)
-      *p = '\0';
-
-    /* If all that is left is a '\0' then also just return */
-    if (*ptt_port == '\0') {
-      *iptt = *ntx;
-      return(0);
-    }
-
-    if ((fd = open(ptt_port, O_RDWR|O_NONBLOCK)) &lt; 0) {
-	fprintf(stderr, &quot;Can't open %s.\n&quot;, ptt_port);
-	return (1);
-    }
-
-    if (dev_is_parport(fd)) {
-      state = STATE_PORT_OPEN_PARALLEL;
-      lp_reset(fd);
-      ptt_parallel(fd, ntx, iptt);
-    } else {
-      state = STATE_PORT_OPEN_SERIAL;
-      ptt_serial(fd, ntx, iptt);
-    }
-    break;
-
-  case STATE_PORT_OPEN_PARALLEL:
-    ptt_parallel(fd, ntx, iptt);
-    break;
-
-  case STATE_PORT_OPEN_SERIAL:
-    ptt_serial(fd, ntx, iptt);
-    break;
-
-  default:
-    close(fd);
-    fd = -1;
-    state = STATE_PORT_CLOSED;
-    break;
-  }
-  return(0);
-}
-
-/*
- * ptt_serial
- *
- * generic serial unix PTT routine called indirectly from Fortran
- *
- * fd		- already opened file descriptor
- * ntx		- pointer to fortran command on or off
- * iptt		- pointer to fortran command status on or off
- */
-
-int
-ptt_serial(int fd, int *ntx, int *iptt)
-{
-  int control = TIOCM_RTS | TIOCM_DTR;
-
-  if(*ntx) {
-    ioctl(fd, TIOCMBIS, &amp;control);               /* Set DTR and RTS */
-    *iptt = 1;
-  } else {
-    ioctl(fd, TIOCMBIC, &amp;control);
-    *iptt = 0;
-  }
-  return(0);
-}
-
-
-/* parport functions */
-
-/*
- * dev_is_parport(fd):
- *
- * inputs	- Already open fd
- * output	- 1 if parallel port, 0 if not
- * side effects	- Unfortunately, this is platform specific.
- */
-
-#if defined(HAVE_LINUX_PPDEV_H)                /* Linux (ppdev) */
-
-int
-dev_is_parport(int fd)
-{
-       struct stat st;
-       int m;
-
-       if ((fstat(fd, &amp;st) == -1) ||
-	   ((st.st_mode &amp; S_IFMT) != S_IFCHR) ||
-	   (ioctl(fd, PPGETMODE, &amp;m) == -1))
-	 return(0);
-
-       return(1);
-}
-
-#elif defined(HAVE_DEV_PPBUS_PPI_H)    /* FreeBSD (ppbus/ppi) */
-
-int
-dev_is_parport(int fd)
-{
-       struct stat st;
-       unsigned char c;
-
-       if ((fstat(fd, &amp;st) == -1) ||
-	   ((st.st_mode &amp; S_IFMT) != S_IFCHR) ||
-	   (ioctl(fd, PPISSTATUS, &amp;c) == -1))
-	 return(0);
-
-       return(1);
-}
-
-#else                                  /* Fallback (nothing) */
-
-int
-dev_is_parport(int fd)
-{
-       return(0);
-}
-
-#endif
-/* Linux wrapper around PPFCONTROL */
-#ifdef HAVE_LINUX_PPDEV_H
-static void
-parport_control (int fd, unsigned char controlbits, int values)
-{
-	struct ppdev_frob_struct frob;
-	frob.mask = controlbits;
-	frob.val = values;
-
-	if (ioctl (fd, PPFCONTROL, &amp;frob) == -1)
-	{
-		fprintf(stderr, &quot;Parallel port PPFCONTROL&quot;);
-		exit (1);
-	}
-}
-#endif
-
-/* FreeBSD wrapper around PPISCTRL */
-#ifdef HAVE_DEV_PPBUS_PPI_H
-static void
-parport_control (int fd, unsigned char controlbits, int values)
-{
-	unsigned char val;
-
-	if (ioctl (fd, PPIGCTRL, &amp;val) == -1)
-	{
-		fprintf(stderr, &quot;Parallel port PPIGCTRL&quot;);
-		exit (1);
-	}
-
-	val &amp;= ~controlbits;
-	val |= values;
-
-	if (ioctl (fd, PPISCTRL, &amp;val) == -1)
-	{
-		fprintf(stderr, &quot;Parallel port PPISCTRL&quot;);
-		exit (1);
-	}
-}
-#endif
-
-/* Initialise a parallel port, given open fd */
-int
-lp_init (int fd)
-{
-#ifdef HAVE_LINUX_PPDEV_H
-	int mode;
-#endif
-
-#ifdef HAVE_LINUX_PPDEV_H
-	mode = PARPORT_MODE_PCSPP;
-
-	if (ioctl (fd, PPSETMODE, &amp;mode) == -1)
-	{
-		fprintf(stderr, &quot;Setting parallel port mode&quot;);
-		close (fd);
-		return(-1);
-	}
-
-	if (ioctl (fd, PPEXCL, NULL) == -1)
-	{
-		fprintf(stderr, &quot;Parallel port is already in use.\n&quot;);
-		close (fd);
-		return(-1);
-	}
-	if (ioctl (fd, PPCLAIM, NULL) == -1)
-	{
-		fprintf(stderr, &quot;Claiming parallel port.\n&quot;);
-		fprintf(stderr, &quot;HINT: did you unload the lp kernel module?&quot;);
-		close (fd);
-		return(-1);
-	}
-
-	/* Enable CW &amp; PTT - /STROBE bit (pin 1) */
-	parport_control (fd, PARPORT_CONTROL_STROBE, PARPORT_CONTROL_STROBE);
-#endif
-#ifdef HAVE_DEV_PPBUS_PPI_H
-	parport_control (fd, STROBE, STROBE);
-#endif
-	lp_reset (fd);
-	return(0);
-}
-
-/* release ppdev and close port */
-int
-lp_free (int fd)
-{
-#ifdef HAVE_LINUX_PPDEV_H
-	lp_reset (fd);
-
-	/* Disable CW &amp; PTT - /STROBE bit (pin 1) */
-	parport_control (fd, PARPORT_CONTROL_STROBE, 0);
-
-	ioctl (fd, PPRELEASE);
-#endif
-#ifdef HAVE_DEV_PPBUS_PPI_H
-	/* Disable CW &amp; PTT - /STROBE bit (pin 1) */
-	parport_control (fd, STROBE, 0);
-#endif
-	close (fd);
-	return(0);
-}
-
-/* set to a known state */
-int
-lp_reset (int fd)
-{
-#if defined (HAVE_LINUX_PPDEV_H) || defined (HAVE_DEV_PPBUS_PPI_H)
-	lp_ptt (fd, 0);
-#endif
-	return(0);
-}
-
-/* SSB PTT keying - /INIT bit (pin 16) (inverted) */
-int
-lp_ptt (int fd, int onoff)
-{
-#ifdef HAVE_LINUX_PPDEV_H
-	if (onoff == 1)
-		parport_control (fd, PARPORT_CONTROL_INIT,
-				PARPORT_CONTROL_INIT);
-	else
-		parport_control (fd, PARPORT_CONTROL_INIT, 0);
-#endif
-#ifdef HAVE_DEV_PPBUS_PPI_H
-	if (onoff == 1)
-		parport_control (fd, nINIT,
-				nINIT);
-	else
-		parport_control (fd, nINIT, 0);
-#endif
-	return(0);
-}
-
-/*
- * ptt_parallel
- *
- * generic parallel unix PTT routine called indirectly from Fortran
- *
- * fd		- already opened file descriptor
- * ntx		- pointer to fortran command on or off
- * iptt		- pointer to fortran command status on or off
- */
-
-int
-ptt_parallel(int fd, int *ntx, int *iptt)
-{
-  if(*ntx) {
-    lp_ptt(fd, 1);
-    *iptt=1;
-  }  else {
-    lp_ptt(fd, 0);
-    *iptt=0;
-  }
-  return(0);
-}

Deleted: branches/map65/pulsar.f90
===================================================================
--- branches/map65/pulsar.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/pulsar.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,82 +0,0 @@
-program pulsar
-
-!  Receives timf2 data from Linrad and saves it for pulsar processing.
-
-  parameter (NSPP=174)                     !Samples per UDP packet
-  integer*1 userx_no,iusb
-  integer*2 id
-  integer*2 nblock
-  integer*2 id2(1000)
-  integer nt(8)
-  character pname*12,cdate*8,ctime*12,czone*8
-  character*40 fname20,fname21
-  real*8 center_freq,tsec
-  common/plrscom/center_freq,msec,fselect,iptr,nblock,userx_no,iusb,id(4,NSPP)
-!                     8        4     4      4    2       1       1    1392
-  data nb0/0/,sqave/0.0/,u/0.001/,nw/0/
-  save
-
-  nargs=iargc()
-  if(nargs.ne.1) then
-     print*,'Usage: pulsar &lt;pname&gt;'
-     go to 999
-  endif
-  call getarg(1,pname)
-
-! nt: year, month, day, time difference in minutes, hours, minutes, 
-! seconds, and milliseconds. 
-  call date_and_time(cdate,ctime,czone,nt)
-
-  write(fname20,1001) nt(1)-2000,nt(2),nt(3),nt(5),nt(6),nt(7)
-1001 format(3i2.2,'_',3i2.2,'.raw')
-  open(20,file=fname20,access='stream',status='unknown')
-  write(20) cdate,ctime,czone,nt,pname       !Write header
-  fname21=fname20(1:13)//'.sq'
-  open(21,file=fname21,access='stream',status='unknown')
-  write(21) cdate,ctime,czone,nt,pname       !Write header
-
-  call setup_rsocket                         !Prepare to receive UDP packets
-  k=0
-
-10 call recv_pkt(center_freq)
-  nb=nblock
-  if(nb.lt.0) nb=nb+65536
-  lost=nb-nb0-1
-  if(lost.eq.-65536) lost=0
-  if(lost.ne.0 .and. nb0.ne.0) print*,'Lost packets:',lost,nb,nb0
-
-  write(20) id                               !Write raw data
-  sq=0.
-  do i=1,NSPP
-     sq=sq + float(int(id(1,i)))**2 + float(int(id(2,i)))**2 +      &amp;
-          float(int(id(3,i)))**2 + float(int(id(4,i)))**2
-  enddo
-  sqave=sqave + u*(sq-sqave)
-  rxnoise=10.0*log10(sqave) - 48.0
-
-  k=k+1
-  id2(k)=0.001*sq
-  if(k.eq.1000) then
-     tsec=0.001d0*msec
-     nsec=tsec
-     ih=nsec/3600
-     im=mod(nsec/60,60)
-     is=mod(nsec,60)
-     nw=nw+1
-     write(*,1000)  nw,center_freq,ih,im,is,nblock,sqave,rxnoise,id2(1)
-     write(13,1000) nw,center_freq,ih,im,is,nblock,sqave,rxnoise,id2(1)
-1000 format(i10,f7.3,i4,2i3.2,i7,f10.0,f8.2,i8)
-     write(21) id2
-
-     call flush(13)
-     call flush(20)
-     call flush(21)
-     k=0
-  endif
-
-  nb0=nb
-  go to 10
-
-999 end program pulsar
-
-! To compile: % gfortran -o pulsar pulsar.f90 plrr_subs.c

Deleted: branches/map65/recvpkt.f90
===================================================================
--- branches/map65/recvpkt.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/recvpkt.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,181 +0,0 @@
-subroutine recvpkt(iarg)
-
-! Receive timf2 packets from Linrad and stuff data into array dd().
-! (This routine runs in a background thread and will never return.)
-
-  parameter (NSZ=2*60*96000)
-  integer*1 userx_no,iusb
-  integer*2 nblock,nblock0
-  logical first,synced
-  real*8 center_freq,d8,buf8
-  complex*16 c16,buf16(87)
-  integer*2 jd(4)
-  real*4 xd(4)
-  common/plrscom/center_freq,msec,fqso,iptr,nblock,userx_no,iusb,buf8(174)
-  include 'datcom.f90'
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-  equivalence (jd,d8)
-  equivalence (xd,c16)
-  equivalence (buf8,buf16)
-  data nblock0/0/,kb/1/,ns00/99/,first/.true./
-  data sqave/0.0/,rxnoise/0.0/,pctblank/0.0/,kbuf/1/,lost_tot/0/
-  data multicast0/-99/
-  save
-
-1 continue
-  call cs_lock('recvpkt')
-  call setup_rsocket(multicast)     !Open socket for multicast/unicast data
-  call cs_unlock
-  k=0
-  kk=0
-  kxp=0
-  kb=1
-  nsec0=-999
-  fcenter=144.125                   !Default (startup) frequency)
-  multicast0=multicast
-  ntx=0
-  synced=.false.
-
-10 if(multicast.ne.multicast0) go to 1
-  call recv_pkt(center_freq)
-
-  if(userx_no.lt.0) then
-     nfloat=1
-  else
-     nfloat=0
-  endif
-
-  iz=174
-  if(nfloat.ne.0) iz=87
-
-! Should receive a new packet every 174/96000 = 0.0018125 s
-  nsec=mod(Tsec,86400.d0)           !Time according to MAP65
-  nseclr=msec/1000                  !Time according to Linrad
-  fcenter=center_freq
-  if(forcefcenter.gt.0.0) fcenter=forcefcenter
-
-! Reset buffer pointers at start of minute.
-  ns=mod(nsec,60)
-  if(ns.lt.ns00 .and. (lauto+monitoring.ne.0)) then
-!     print*,'new minute:',mod(nsec/60,60),ns00,ns,ntx,kb
-     if(ntx.eq.0) kb=3-kb
-     if(first) kb=1
-     k=(kb-1)*60*96000
-     kxp=k
-     ndone1=0
-     ndone2=0
-     lost_tot=0
-     synced=.true.
-     ntx=0
-  endif
-  ns00=ns
-
-  if(transmitting.eq.1) ntx=1
-
-! Test for buffer full
-  if((kb.eq.1 .and. (k+iz).gt.NSMAX) .or.                          &amp;
-       (kb.eq.2 .and. (k+iz).gt.2*NSMAX)) go to 20
-
-  if(.not.first) then
-! Check for lost packets
-     lost=nblock-nblock0-1
-     if(lost.ne.0) then
-        nb=nblock
-        if(nb.lt.0) nb=nb+65536
-        nb0=nblock0
-        if(nb0.lt.0) nb0=nb0+65536
-        lost_tot=lost_tot + lost               ! Insert zeros for the lost data.
-!###
-!        do i=1,iz*lost
-!           k=k+1
-!           d8(k)=0
-!        enddo
-!###
-     endif
-  endif
-  first=.false.
-  nblock0=nblock
-
-  tdiff=mod(0.001d0*msec,60.d0)-mod(Tsec,60.d0)
-  if(tdiff.lt.-30.) tdiff=tdiff+60.
-  if(tdiff.gt.30.) tdiff=tdiff-60.
-
-! Move data into Rx buffer and compute average signal level.
-  sq=0.
-  do i=1,iz
-     k=k+1
-     k2=k
-     n=1
-     if(k.gt.NSMAX) then
-        k2=k2-NSMAX
-        n=2
-     endif
-
-     if(nfloat.eq.0) then
-        d8=buf8(i)
-        x1=jd(1)
-        x2=jd(2)
-        x3=jd(3)
-        x4=jd(4)
-        dd(1,k2,n)=x1
-        dd(2,k2,n)=x2
-        dd(3,k2,n)=x3
-        dd(4,k2,n)=x4
-        sq=sq + x1*x1 + x2*x2 + x3*x3 + x4*x4
-     else
-        c16=buf16(i)
-        x1=xd(1)
-        x2=xd(2)
-        x3=xd(3)
-        x4=xd(4)
-        dd(1,k2,n)=x1
-        dd(2,k2,n)=x2
-        dd(3,k2,n)=x3
-        dd(4,k2,n)=x4
-        sq=sq + x1*x1 + x2*x2 + x3*x3 + x4*x4
-     endif
-  enddo
-  sq=sq/(2.0*iz)
-  u=0.001
-  if(nfloat.ne.1) u=2.0*u
-  sqave=sqave + u*(sq-sqave)
-  rxnoise=10.0*log10(sqave) - 20.0            ! Was -48.0
-  kxp=k
-
-20 if(nsec.ne.nsec0) then
-     nsec0=nsec
-     mutch=nseclr/3600
-     mutcm=mod(nseclr/60,60)
-     mutc=100*mutch + mutcm
-
-! If we have not transmitted in this minute, see if it's time to start FFTs
-     if(ntx.eq.0 .and. lauto+monitoring.ne.0) then
-        if(ns.ge.nt1 .and. ndone1.eq.0 .and. synced) then
-           nutc=mutc
-           fcenter=center_freq
-           if(forcefcenter.gt.0.0) fcenter=forcefcenter
-           kbuf=kb
-           kk=k
-           ndiskdat=0
-           ndone1=1
-        endif
-
-! See if it's time to start the full decoding procedure.
-        nhsym=(k-(kbuf-1)*60*96000)/17832.9252
-        if(ndone1.eq.1 .and. nhsym.ge.279 .and.ndone2.eq.0) then
-           kk=k
-           nlost=lost_tot                         ! Save stats for printout
-           ndone2=1
-!           print*,'recvpkt 2:',ns,kb,k
-        endif
-     endif
-
-!     if(ns.le.5 .or. ns.ge.46) write(*,3001) ns,ndone1,kb,  &amp;
-!          kbuf,ntx,kk,tdiff
-!3001 format(5i4,i11,f8.2)
-
-  endif
-  go to 10
-
-end subroutine recvpkt

Deleted: branches/map65/rfile.f90
===================================================================
--- branches/map65/rfile.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/rfile.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,13 +0,0 @@
-subroutine rfile(lu,ibuf,n,ierr)
-
-  integer*1 ibuf(n)
-
-  call cs_lock('rfile')
-  read(lu,end=998) ibuf
-  ierr=0
-  go to 999
-998 ierr=1002
-999 continue
-  call cs_unlock
-  return
-end subroutine rfile

Deleted: branches/map65/rfile2.f
===================================================================
--- branches/map65/rfile2.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/rfile2.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,26 +0,0 @@
-      subroutine rfile2(fname,buf,n,nr)
-
-C  Read data from disk.
-
-      integer RMODE
-      parameter(RMODE=0)
-      integer*1 buf(n)
-      integer open,read,close
-      integer fd
-      character fname*(*)
-      data iz/0/                            !Silence g77 warning
-
-      do i=80,1,-1
-         if(fname(i:i).ne.' ') then
-            iz=i
-            go to 10
-         endif
-      enddo
-
- 10   fname=fname(1:iz)//char(0)
-      fd=open(fname,RMODE)                  !Open file for reading
-      nr=read(fd,buf,n)
-      i=close(fd)
-
-      return
-      end

Deleted: branches/map65/rfile3.c
===================================================================
--- branches/map65/rfile3.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/rfile3.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,22 +0,0 @@
-#include &lt;stdio.h&gt;
-
-void rfile3_(char *infile, char buf[], int *nbytes0)
-{
-  int n,nbytes;
-  static int first=1;
-  static FILE *fd=NULL;
-
-  nbytes=*nbytes0;
-  if(first) {
-    fd = fopen(infile,&quot;rb&quot;);
-    if(fd == NULL) {
-      printf(&quot;Cannot open %s\n&quot;,infile);
-      exit(0);
-    }
-    first=0;
-  }
-
-  n=fread(buf,1,nbytes,fd);
-  printf(&quot;b: %d   %d\n&quot;,nbytes,n);
-  return(n);
-}

Deleted: branches/map65/rfile3a.f90
===================================================================
--- branches/map65/rfile3a.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/rfile3a.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,18 +0,0 @@
-!----------------------------------------------------- rfile3a
-subroutine rfile3a(infile,ibuf,n,ierr)
-
-  character*(*) infile
-  integer*1 ibuf(n)
-
-#ifdef CVF
-  open(10,file=infile,form='binary',status='old',err=998)
-#else
-  open(10,file=infile,access='stream',status='old',err=998)
-#endif
-  read(10,end=998) ibuf
-  ierr=0
-  go to 999
-998 ierr=1002
-999 close(10)
-  return
-end subroutine rfile3a

Deleted: branches/map65/rs.h
===================================================================
--- branches/map65/rs.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/rs.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,35 +0,0 @@
-/* User include file for the Reed-Solomon codec
- * Copyright 2002, Phil Karn KA9Q
- * May be used under the terms of the GNU General Public License (GPL)
- */
-
-/* General purpose RS codec, 8-bit symbols */
-void encode_rs_char(void *rs,unsigned char *data,unsigned char *parity);
-int decode_rs_char(void *rs,unsigned char *data,int *eras_pos,
-		   int no_eras);
-void *init_rs_char(int symsize,int gfpoly,
-		   int fcr,int prim,int nroots,
-		   int pad);
-void free_rs_char(void *rs);
-
-/* General purpose RS codec, integer symbols */
-void encode_rs_int(void *rs,int *data,int *parity);
-int decode_rs_int(void *rs,int *data,int *eras_pos,int no_eras);
-void *init_rs_int(int symsize,int gfpoly,int fcr,
-		  int prim,int nroots,int pad);
-void free_rs_int(void *rs);
-
-/* CCSDS standard (255,223) RS codec with conventional (*not* dual-basis)
- * symbol representation
- */
-void encode_rs_8(unsigned char *data,unsigned char *parity,int pad);
-int decode_rs_8(unsigned char *data,int *eras_pos,int no_eras,int pad);
-
-/* CCSDS standard (255,223) RS codec with dual-basis symbol representation */
-void encode_rs_ccsds(unsigned char *data,unsigned char *parity,int pad);
-int decode_rs_ccsds(unsigned char *data,int *eras_pos,int no_eras,int pad);
-
-/* Tables to map from conventional-&gt;dual (Taltab) and
- * dual-&gt;conventional (Tal1tab) bases
- */
-extern unsigned char Taltab[],Tal1tab[];

Deleted: branches/map65/runqqq.f90
===================================================================
--- branches/map65/runqqq.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/runqqq.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,17 +0,0 @@
-subroutine runqqq(fname,cmnd,iret)
-
-#ifdef CVF
-  use dflib
-#endif
-  integer system
-
-  character*(*) fname,cmnd
-
-#ifdef CVF
-  iret=runqq(fname,cmnd)
-#else
-  iret=system('KVASD_g95 -q &gt; dev_null')
-#endif
-
-  return
-end subroutine runqqq

Deleted: branches/map65/samplerate.h
===================================================================
--- branches/map65/samplerate.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/samplerate.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,196 +0,0 @@
-/*
-** Copyright (C) 2002-2004 Erik de Castro Lopo &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/wsjt-svn">erikd at mega-nerd.com</A>&gt;
-**
-** This program is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** This program is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with this program; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
-*/
-
-/*
-** API documentation is available here:
-**     <A HREF="http://www.mega-nerd.com/SRC/api.html">http://www.mega-nerd.com/SRC/api.html</A>
-*/
-
-#ifndef SAMPLERATE_H
-#define SAMPLERATE_H
-
-#ifdef __cplusplus
-extern &quot;C&quot; {
-#endif	/* __cplusplus */
-
-
-/* Opaque data type SRC_STATE. */
-typedef struct SRC_STATE_tag SRC_STATE ;
-
-/* SRC_DATA is used to pass data to src_simple() and src_process(). */
-typedef struct
-{	float	*data_in, *data_out ;
-
-	long	input_frames, output_frames ;
-	long	input_frames_used, output_frames_gen ;
-
-	int		end_of_input ;
-
-	double	src_ratio ;
-} SRC_DATA ;
-
-/* SRC_CB_DATA is used with callback based API. */
-typedef struct
-{	long	frames ;
-	float	*data_in ;
-} SRC_CB_DATA ;
-
-/*
-** User supplied callback function type for use with src_callback_new()
-** and src_callback_read(). First parameter is the same pointer that was
-** passed into src_callback_new(). Second parameter is pointer to a
-** pointer. The user supplied callback function must modify *data to
-** point to the start of the user supplied float array. The user supplied
-** function must return the number of frames that **data points to.
-*/
-
-typedef long (*src_callback_t) (void *cb_data, float **data) ;
-
-/*
-**	Standard initialisation function : return an anonymous pointer to the
-**	internal state of the converter. Choose a converter from the enums below.
-**	Error returned in *error.
-*/
-
-SRC_STATE* src_new (int converter_type, int channels, int *error) ;
-
-/*
-**	Initilisation for callback based API : return an anonymous pointer to the
-**	internal state of the converter. Choose a converter from the enums below.
-**	The cb_data pointer can point to any data or be set to NULL. Whatever the
-**	value, when processing, user supplied function &quot;func&quot; gets called with
-**	cb_data as first parameter.
-*/
-
-SRC_STATE* src_callback_new (src_callback_t func, int converter_type, int channels,
-				int *error, void* cb_data) ;
-
-/*
-**	Cleanup all internal allocations.
-**	Always returns NULL.
-*/
-
-SRC_STATE* src_delete (SRC_STATE *state) ;
-
-/*
-**	Standard processing function.
-**	Returns non zero on error.
-*/
-
-int src_process (SRC_STATE *state, SRC_DATA *data) ;
-
-/*
-**	Callback based processing function. Read up to frames worth of data from
-**	the converter int *data and return frames read or -1 on error.
-*/
-long src_callback_read (SRC_STATE *state, double src_ratio, long frames, float *data) ;
-
-/*
-**	Simple interface for performing a single conversion from input buffer to
-**	output buffer at a fixed conversion ratio.
-**	Simple interface does not require initialisation as it can only operate on
-**	a single buffer worth of audio.
-*/
-
-int src_simple (SRC_DATA *data, int converter_type, int channels) ;
-
-/*
-** This library contains a number of different sample rate converters,
-** numbered 0 through N.
-**
-** Return a string giving either a name or a more full description of each
-** sample rate converter or NULL if no sample rate converter exists for
-** the given value. The converters are sequentially numbered from 0 to N.
-*/
-
-const char *src_get_name (int converter_type) ;
-const char *src_get_description (int converter_type) ;
-const char *src_get_version (void) ;
-
-/*
-**	Set a new SRC ratio. This allows step responses
-**	in the conversion ratio.
-**	Returns non zero on error.
-*/
-
-int src_set_ratio (SRC_STATE *state, double new_ratio) ;
-
-/*
-**	Reset the internal SRC state.
-**	Does not modify the quality settings.
-**	Does not free any memory allocations.
-**	Returns non zero on error.
-*/
-
-int src_reset (SRC_STATE *state) ;
-
-/*
-** Return TRUE if ratio is a valid conversion ratio, FALSE
-** otherwise.
-*/
-
-int src_is_valid_ratio (double ratio) ;
-
-/*
-**	Return an error number.
-*/
-
-int src_error (SRC_STATE *state) ;
-
-/*
-**	Convert the error number into a string.
-*/
-const char* src_strerror (int error) ;
-
-/*
-** The following enums can be used to set the interpolator type
-** using the function src_set_converter().
-*/
-
-enum
-{
-	SRC_SINC_BEST_QUALITY		= 0,
-	SRC_SINC_MEDIUM_QUALITY		= 1,
-	SRC_SINC_FASTEST			= 2,
-	SRC_ZERO_ORDER_HOLD			= 3,
-	SRC_LINEAR					= 4
-} ;
-
-/*
-** Extra helper functions for converting from short to float and
-** back again.
-*/
-
-void src_short_to_float_array (const short *in, float *out, int len) ;
-void src_float_to_short_array (const float *in, short *out, int len) ;
-
-
-#ifdef __cplusplus
-}		/* extern &quot;C&quot; */
-#endif	/* __cplusplus */
-
-#endif	/* SAMPLERATE_H */
-
-/*
-** Do not edit or modify anything in this comment block.
-** The arch-tag line is a file identity tag for the GNU Arch
-** revision control system.
-**
-** arch-tag: 5421ef3e-c898-4ec3-8671-ea03d943ee00
-*/
-

Deleted: branches/map65/savetf2.f90
===================================================================
--- branches/map65/savetf2.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/savetf2.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,58 +0,0 @@
-subroutine savetf2(id,fnamedate,savedir)
-
-  parameter (NZ=60*96000)
-  parameter (NSPP=174)
-  parameter (NPKTS=NZ/NSPP)
-  integer*2 id(4,NZ)
-  character*80 savedir,fname
-  character cdate*8,ctime2*10,czone*5,fnamedate*6
-  integer  itt(8)
-  data nloc/-1/
-  save nloc
-
-  call cs_lock('savetf2')
-  call date_and_time(cdate,ctime2,czone,itt)
-  nh=itt(5)-itt(4)/60
-  nm=itt(6)
-  ns=itt(7)
-  if(ns.lt.50) nm=nm-1
-  if(nm.lt.0) then
-     nm=nm+60
-     nh=nh-1
-  endif
-  if(nh.lt.0) nh=nh+24
-  if(nh.ge.24) nh=nh-24
-  write(fname,1001) fnamedate,nh,nm
-1001 format('/',a6,'_',2i2.2,'.tf2')
-  do i=80,1,-1
-     if(savedir(i:i).ne.' ') go to 1
-  enddo
-1 iz=i
-  fname=savedir(1:iz)//fname
-#ifdef CVF
-  open(17,file=fname,status='unknown',form='binary',err=998)
-#else
-  open(17,file=fname,status='unknown',access='stream',err=998)
-#endif
-
-  if(nloc.eq.-1) nloc=loc(id)
-  n=abs(loc(id)-nloc)
-  if(n.eq.0 .or. n.eq.46080000) then
-     write(17,err=997) id
-  else
-     print*,'Address of id() clobbered???',nloc,loc(id)
-  endif
-  close(17)
-  go to 999
-
-997 print*,'Error writing tf2 file'
-  print*,fname
-  go to 999
-
-998 print*,'Cannot open file:'
-  print*,fname
-
-999 continue
-  call cs_unlock
-  return
-end subroutine savetf2

Deleted: branches/map65/sec_midn.f90
===================================================================
--- branches/map65/sec_midn.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/sec_midn.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,19 +0,0 @@
-real function sec_midn()
-  sec_midn=secnds(0.0)
-  return
-end function sec_midn
-
-subroutine sleep_msec(n)
-
-#ifdef CVF
-  use dflib
-#endif
-
-#ifdef CVF
-  call sleepqq(n)
-#else
-  call usleep(1000*n)
-#endif
-
-  return
-end subroutine sleep_msec

Deleted: branches/map65/set.f
===================================================================
--- branches/map65/set.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/set.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,31 +0,0 @@
-      subroutine set(a,y,n)
-      real y(n)
-      do i=1,n
-         y(i)=a
-      enddo
-      return
-      end
-
-      subroutine move(x,y,n)
-      real x(n),y(n)
-      do i=1,n
-         y(i)=x(i)
-      enddo
-      return
-      end
-
-      subroutine zero(x,n)
-      real x(n)
-      do i=1,n
-         x(i)=0.0
-      enddo
-      return
-      end
-
-      subroutine add(a,b,c,n)
-      real a(n),b(n),c(n)
-      do i=1,n
-         c(i)=a(i)+b(i)
-      enddo
-      return
-      end

Added: branches/map65/set570.cpp
===================================================================
--- branches/map65/set570.cpp	                        (rev 0)
+++ branches/map65/set570.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,275 @@
+
+/*   Linux / Windows program to control the frequency of a si570 synthesizer
+     ON5GN  6 jan 2012
+     Under Linux:
+       -use the linux version of function void si570_sleep(int us)
+       -compile with
+        gcc -Wall -o set_si570_freq set_si570_freq.c -lusb -lm
+       -run with sudo ./set_si570_freq
+     Under Windows:
+       -use the windows version of function void si570_sleep(int us)
+       -compile with mingw
+        C:\mingw\bin\mingw32-gcc -Wall -o set_si570_freq set_si570_freq.c -lusb -lm
+       -run with  set_si570_freq.exe
+*/
+
+#include &lt;stdio.h&gt;   /* Standard input/output definitions */
+#include &lt;string.h&gt;  /* String function definitions */
+#include &lt;unistd.h&gt;  /* UNIX standard function definitions */
+#include &lt;sys/time.h&gt;
+#include &lt;usb.h&gt;
+#include &lt;QDebug&gt;
+
+#define USB_SUCCESS	            0
+#define USB_ERROR_NOTFOUND      1
+#define USB_ERROR_ACCESS        2
+#define USB_ERROR_IO            3
+#define VENDOR_NAME	            &quot;www.obdev.at&quot;
+#define PRODUCT_NAME            &quot;DG8SAQ-I2C&quot;
+#define USBDEV_SHARED_VENDOR    0x16C0  // VOTI  VID
+#define USBDEV_SHARED_PRODUCT   0x05DC  // OBDEV PID
+                                     // Use obdev's generic shared VID/PID pair
+                                     // following the rules outlined in
+                                     // firmware/usbdrv/USBID-License.txt.
+#define REQUEST_SET_FREQ_BY_VALUE 0x32
+#define MAX_USB_ERR_CNT         6
+
+double freq_parm;
+double delay_average;
+int  from_freq;
+int  to_freq;
+int  increment_freq;
+int  retval = -1;
+int  display_freq = -1;
+int  delay;
+usb_dev_handle  *global_si570usb_handle = NULL;
+
+// ********sleep functions***************
+//use this function  under LINUX
+/*
+void si570_sleep(int us)
+{
+usleep(us);
+}
+*/
+
+//use this function under WINDOWS
+void si570_sleep(int us)
+{
+  Sleep(us/1000);
+}
+
+double round(double x)
+{
+  int i=x+0.5;
+  return (double)i;
+}
+
+double current_time(void) //for delay measurements
+{
+  struct timeval t;
+  gettimeofday(&amp;t,NULL);
+  return 0.000001*t.tv_usec+t.tv_sec;
+}
+
+int  usbGetStringAscii(usb_dev_handle *dev, int my_index,
+               int langid, char *buf, int buflen);
+unsigned char Si570usbOpenDevice(usb_dev_handle **device, char *usbSerialID);
+void setLongWord( int value, char * bytes);
+int setFreqByValue(usb_dev_handle * handle, double frequency);
+void sweepa_freq(void);
+void sweepm_freq(void);
+
+int set570(double freq_MHz)
+{
+  char * my_usbSerialID = NULL;
+
+// MAIN MENU DIALOG
+  retval=Si570usbOpenDevice(&amp;global_si570usb_handle, my_usbSerialID);
+  if (retval != 0) return -1;
+
+//SET FREQUENCY
+  if((freq_MHz &lt; 3.45)|(freq_MHz &gt; 866.0)) return -2;
+  retval=setFreqByValue(global_si570usb_handle,freq_MHz);
+  return 0;
+}
+
+int  usbGetStringAscii(usb_dev_handle *dev, int my_index,
+                       int langid, char *buf, int buflen)
+{
+  char    buffer[256];
+  int     rval, i;
+  if((rval = usb_control_msg(dev, USB_ENDPOINT_IN, USB_REQ_GET_DESCRIPTOR,
+     (USB_DT_STRING &lt;&lt; 8) + my_index, langid, buffer,
+     sizeof(buffer), 1000)) &lt; 0) return rval;
+  if(buffer[1] != USB_DT_STRING)  return 0;
+  if((unsigned char)buffer[0] &lt; rval) rval = (unsigned char)buffer[0];
+  rval /= 2;
+// lossy conversion to ISO Latin1
+  for(i=1;i&lt;rval;i++) {
+    if(i &gt; buflen) break;                       // destination buffer overflow
+    buf[i-1] = buffer[2 * i];
+    if(buffer[2 * i + 1] != 0)  buf[i-1] = '?'; // outside of ISO Latin1 range
+  }
+  buf[i-1] = 0;
+  return i-1;
+}
+
+unsigned char Si570usbOpenDevice(usb_dev_handle **device, char *usbSerialID)
+{
+  struct usb_bus      *bus;
+  struct usb_device   *dev;
+  usb_dev_handle      *handle = NULL;
+  unsigned char       errorCode = USB_ERROR_NOTFOUND;
+  char                string[256];
+  int                 len;
+  int  vendor        = USBDEV_SHARED_VENDOR;
+  char *vendorName   = VENDOR_NAME;
+  int  product       = USBDEV_SHARED_PRODUCT;
+  char *productName  = PRODUCT_NAME;
+  char serialNumberString[20];
+  static int  didUsbInit = 0;
+
+  if(!didUsbInit) {
+    didUsbInit = 1;
+    usb_init();
+  }
+  usb_find_busses();
+  usb_find_devices();
+  for(bus=usb_get_busses(); bus; bus=bus-&gt;next) {
+    for(dev=bus-&gt;devices; dev; dev=dev-&gt;next) {
+      if(dev-&gt;descriptor.idVendor == vendor &amp;&amp;
+     dev-&gt;descriptor.idProduct == product) {
+        handle = usb_open(dev); // open the device in order to query strings
+        if(!handle) {
+          errorCode = USB_ERROR_ACCESS;
+          printf(&quot;si570.c: Warning: cannot open Si570-USB device:\n&quot;);
+          printf(&quot;usb error message: %s\n&quot;,usb_strerror());
+          continue;
+    }
+        if(vendorName == NULL &amp;&amp; productName == NULL) {  //name does not matter
+          break;
+    }
+        // now check whether the names match
+        len = usbGetStringAscii(handle, dev-&gt;descriptor.iManufacturer, 0x0409, string, sizeof(string));
+        if(len &lt; 0) {
+          errorCode = USB_ERROR_IO;
+          printf(&quot;si570.c: Warning: cannot query manufacturer for Si570-USB device:\n&quot;);
+          printf(&quot;usb error message: %s\n&quot;,usb_strerror());
+    } else {
+          errorCode = USB_ERROR_NOTFOUND;
+           //fprintf(stderr, &quot;seen device from vendor -&gt;%s&lt;-\n&quot;, string);
+          if(strcmp(string, vendorName) == 0){
+            len = usbGetStringAscii(handle, dev-&gt;descriptor.iProduct,
+                    0x0409, string, sizeof(string));
+            if(len &lt; 0) {
+              errorCode = USB_ERROR_IO;
+              printf(&quot;si570.c: Warning: cannot query product for Si570-USB device: \n&quot;);
+              printf(&quot;usb error message: %s\n&quot;,usb_strerror());
+        } else {
+              errorCode = USB_ERROR_NOTFOUND;
+              // fprintf(stderr, &quot;seen product -&gt;%s&lt;-\n&quot;, string);
+              if(strcmp(string, productName) == 0) {
+        len = usbGetStringAscii(handle, dev-&gt;descriptor.iSerialNumber,
+             0x0409, serialNumberString, sizeof(serialNumberString));
+        if (len &lt; 0) {
+          errorCode = USB_ERROR_IO;
+          printf(&quot;si570.c: Warning: cannot query serial number for Si570-USB device: \n&quot;);
+                  printf(&quot;usb error message: %s\n&quot;,usb_strerror());
+        } else {
+          errorCode = USB_ERROR_NOTFOUND;
+          if ((usbSerialID == NULL) ||
+              (strcmp(serialNumberString, usbSerialID) == 0)) {
+//                    printf(&quot;\nOpen Si570 USB device: OK\n&quot;);
+//                    printf(&quot;usbSerialID          : %s\n&quot;,serialNumberString);
+            break;
+          }
+        }
+          }
+        }
+      }
+    }
+        usb_close(handle);
+        handle = NULL;
+      }
+    }
+    if(handle) break;
+  }
+  if(handle != NULL) {
+    errorCode = USB_SUCCESS;
+    *device = handle;
+  }
+  return errorCode;
+}
+
+void setLongWord( int value, char * bytes)
+{
+  bytes[0] = value &amp; 0xff;
+  bytes[1] = ((value &amp; 0xff00) &gt;&gt; 8) &amp; 0xff;
+  bytes[2] = ((value &amp; 0xff0000) &gt;&gt; 16) &amp; 0xff;
+  bytes[3] = ((value &amp; 0xff000000) &gt;&gt; 24) &amp; 0xff;
+}
+
+int setFreqByValue(usb_dev_handle * handle, double frequency)
+{
+// Windows Doc from PE0FKO:
+//
+// Command 0x32:
+// -------------
+// Set the oscillator frequency by value. The frequency is formatted in MHz
+// as 11.21 bits value.
+// The &quot;automatic band pass filter selection&quot;, &quot;smooth tune&quot;,
+// &quot;one side calibration&quot; and the &quot;frequency subtract multiply&quot; are all
+// done in this function. (if enabled in the firmware)
+//
+// Default:    None
+//
+// Parameters:
+//     requesttype:    USB_ENDPOINT_OUT
+//     request:         0x32
+//     value:           0
+//     index:           0
+//     bytes:           pointer 32 bits integer
+//     size:            4
+//
+// Code sample:
+//     uint32_t iFreq;
+//     double   dFreq;
+//
+//     dFreq = 30.123456; // MHz
+//     iFreq = (uint32_t)( dFreq * (1UL &lt;&lt; 21) )
+//     r = usbCtrlMsgOUT(0x32, 0, 0, (char *)&amp;iFreq, sizeof(iFreq));
+//     if (r &lt; 0) Error
+//
+
+  char   buffer[4];
+  int  i2cAddress = 0x55;
+  int    request = REQUEST_SET_FREQ_BY_VALUE;
+  int    value = 0x700 + i2cAddress;
+  int    my_index = 0;
+  int    retval;
+  int    err_cnt;
+
+  err_cnt =0;
+ set_again:;
+  setLongWord(round(frequency * 2097152.0), buffer);  //   2097152=2^21
+  retval=usb_control_msg(
+         handle, USB_TYPE_VENDOR | USB_RECIP_DEVICE | USB_ENDPOINT_OUT,
+         request,
+         value,
+         my_index,
+         buffer,
+         sizeof(buffer),
+         5000);
+  if (retval != 4) {
+    err_cnt ++;
+    if(err_cnt &lt; MAX_USB_ERR_CNT) {
+      si570_sleep(1000);          // delay 1000 microsec
+      goto set_again;
+    } else {
+      printf(&quot;Error when setting frequency, returncode=%i\n&quot;,retval);
+      printf(&quot;usb error message: %s\n&quot;, usb_strerror());
+    }
+  }
+  return retval;
+}

Deleted: branches/map65/setup65.f
===================================================================
--- branches/map65/setup65.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/setup65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,106 +0,0 @@
-      subroutine setup65
-
-C  Defines arrays related to the pseudo-random synchronizing pattern.
-C  Executed at program start.
-
-      integer npra(135),nprc(126)
-      include 'prcom.h'
-
-C  JT44
-      data npra/
-     +    1,1,1,0,1,0,0,0,0,1,1,1,0,0,1,1,0,0,0,0,
-     +    1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,1,1,1,
-     +    1,0,0,1,0,0,1,0,1,1,1,0,0,1,1,1,0,0,0,0,
-     +    0,0,1,1,1,0,1,1,1,0,1,0,0,1,1,1,1,0,1,0,
-     +    1,0,0,1,0,1,0,0,0,0,0,0,1,0,1,0,1,0,1,0,
-     +    1,1,1,1,1,0,1,0,1,1,0,1,0,0,0,0,0,1,1,0,
-     +    1,1,1,0,1,1,0,1,1,0,1,0,1,1,0/
-
-C  JT65
-      data nprc/
-     + 1,0,0,1,1,0,0,0,1,1,1,1,1,1,0,1,0,1,0,0,
-     + 0,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,1,1,1,1,
-     + 0,1,1,0,1,1,1,1,0,0,0,1,1,0,1,0,1,0,1,1,
-     + 0,0,1,1,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,
-     + 1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,0,1,
-     + 0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,
-     + 1,1,1,1,1,1/
-      data mr2/0/                !Silence g77 warning
-
-C  Put the appropriate pseudo-random sequence into pr
-      nsym=126
-      do i=1,nsym
-         pr(i)=2*nprc(i)-1
-      enddo
-
-C  Determine locations of data and reference symbols
-      k=0
-      mr1=0
-      do i=1,nsym
-         if(pr(i).lt.0.0) then
-            k=k+1
-            mdat(k)=i
-         else
-            mr2=i
-            if(mr1.eq.0) mr1=i
-         endif
-      enddo
-      nsig=k
-
-C  Determine the reference symbols for each data symbol.
-      do k=1,nsig
-         m=mdat(k)
-         mref(k,1)=mr1
-         do n=1,10                     !Get ref symbol before data
-            if((m-n).gt.0) then
-               if (pr(m-n).gt.0.0) go to 10
-            endif
-         enddo
-         go to 12
- 10      mref(k,1)=m-n
- 12      mref(k,2)=mr2
-         do n=1,10                     !Get ref symbol after data
-            if((m+n).le.nsym) then
-               if (pr(m+n).gt.0.0) go to 20
-            endif
-         enddo
-         go to 22
- 20      mref(k,2)=m+n
- 22   enddo
-
-C  Now do it all again, using opposite logic on pr(i)
-      k=0
-      mr1=0
-      do i=1,nsym
-         if(pr(i).gt.0.0) then
-            k=k+1
-            mdat2(k)=i
-         else
-            mr2=i
-            if(mr1.eq.0) mr1=i
-         endif
-      enddo
-      nsig=k
-
-      do k=1,nsig
-         m=mdat2(k)
-         mref2(k,1)=mr1
-         do n=1,10
-            if((m-n).gt.0) then
-               if (pr(m-n).lt.0.0) go to 110
-            endif
-         enddo
-         go to 112
- 110      mref2(k,1)=m-n
- 112      mref2(k,2)=mr2
-         do n=1,10
-            if((m+n).le.nsym) then
-               if (pr(m+n).lt.0.0) go to 120
-            endif
-         enddo
-         go to 122
- 120     mref2(k,2)=m+n
- 122  enddo
-
-      return
-      end

Deleted: branches/map65/short65.f
===================================================================
--- branches/map65/short65.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/short65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,190 +0,0 @@
-      subroutine short65(data,jz,NFreeze,MouseDF,DFTolerance,
-     +  mode65,nspecialbest,nstest,dfsh,iderrbest,idriftbest,
-     +  snrdb,ss1a,ss2a,nwsh,idfsh)
-
-C  Checks to see if this might be a shorthand message.
-C  This is done before zapping, downsampling, or normal decoding.
-
-      parameter (NP2=60*11025)               !Size of data array
-      parameter (NFFT=16384)                 !FFT length
-      parameter (NH=NFFT/2)                  !Step size
-      parameter (MAXSTEPS=60*11025/NH)       !Max # of steps
-
-      real data(jz)
-      integer DFTolerance
-      real s2(NH,MAXSTEPS)                   !2d spectrum
-      real ss(NH,4)                          !Save spectra in four phase bins
-      real psavg(NH)
-      real sigmax(4)                         !Peak of spectrum at each phase
-      real ss1a(-224:224)                    !Lower magenta curve
-      real ss2a(-224:224)                    !Upper magenta curve
-      real ss1(-473:1784)                    !Lower magenta curve (temp)
-      real ss2(-473:1784)                    !Upper magenta curve (temp)
-      real ssavg(-11:11)
-      integer ipk(4)                         !Peak bin at each phase
-      save
-
-      nspecialbest=0                         !Default return value
-      nstest=0
-      df=11025.0/NFFT
-
-C  Do 16 k FFTs, stepped by 8k.  (*** Maybe should step by 4k? ***)
-      call zero(psavg,NH)
-      nsteps=(jz-NH)/(4*NH)
-      nsteps=4*nsteps                        !Number of steps
-      do j=1,nsteps
-         k=(j-1)*NH + 1
-         call ps(data(k),NFFT,s2(1,j))       !Get power spectra
-         if(mode65.eq.4) then
-            call smooth(s2(1,j),NH)
-            call smooth(s2(1,j),NH)
-         endif
-         call add(psavg,s2(1,j),psavg,NH)
-      enddo
-
-      call flat1(psavg,s2,NH,nsteps,NH,MAXSTEPS)
-
-      nfac=40*mode65
-      dtstep=0.5/df
-      fac=dtstep/(60.0*df)
-
-C  Define range of frequencies to be searched
-      fa=max(200.0,1270.46+MouseDF-600.0)
-      fb=min(4800.0,1270.46+MouseDF+600.0)
-      ia=fa/df
-      ib=fb/df + 4.1*nfac  !Upper tone is above sync tone by 4*nfac*df Hz
-      if(NFreeze.eq.1) then
-         fa=max(200.0,1270.46+MouseDF-DFTolerance)
-         fb=min(4800.0,1270.46+MouseDF+DFTolerance)
-      endif
-      ia2=fa/df
-      ib2=fb/df + 4.1*nfac  !Upper tone is above sync tone by 4*nfac*df Hz
-      if(ib2.gt.NH) ib2=NH
-
-C  Find strongest line in each of the 4 phases, repeating for each drift rate.
-      sbest=0.
-      snrbest=0.
-      idz=6.0/df                !Is this the right drift range?
-      do idrift=-idz,idz
-         drift=idrift*df*60.0/49.04
-         call zero(ss,4*NH)     !Clear the accumulating array
-         do j=1,nsteps
-            n=mod(j-1,4)+1
-            k=nint((j-nsteps/2)*drift*fac) + ia
-            call add(ss(ia,n),s2(k,j),ss(ia,n),ib-ia+1)
-         enddo
-
-         do n=1,4
-            sigmax(n)=0.
-            do i=ia2,ib2
-               sig=ss(i,n)
-               if(sig.ge.sigmax(n)) then
-                  ipk(n)=i
-                  sigmax(n)=sig
-                  if(sig.ge.sbest) then
-                     sbest=sig
-                     nbest=n
-                     fdotsh=drift
-                  endif
-               endif
-            enddo
-         enddo
-         n2best=nbest+2
-         if(n2best.gt.4) n2best=nbest-2
-         xdf=min(ipk(nbest),ipk(n2best))*df - 1270.46
-         if(NFreeze.eq.1 .and. abs(xdf-mousedf).gt.DFTolerance) goto 10
-
-         idiff=abs(ipk(nbest)-ipk(n2best))
-         xk=float(idiff)/nfac
-         k=nint(xk)
-         iderr=nint((xk-k)*nfac)
-         nspecial=0
-         maxerr=nint(0.008*abs(idiff) + 0.51)
-         if(abs(iderr).le.maxerr .and. k.ge.2 .and. k.le.4) nspecial=k
-         if(nspecial.gt.0) then
-            call getsnr(ss(ia2,nbest),ib2-ia2+1,snr1)
-            call getsnr(ss(ia2,n2best),ib2-ia2+1,snr2)
-            snr=0.5*(snr1+snr2)
-            if(snr.gt.snrbest) then
-               snrbest=snr
-               nspecialbest=nspecial
-               nstest=snr/2.0 - 2.0             !Threshold set here
-               if(nstest.lt.0) nstest=0
-               if(nstest.gt.10) nstest=10
-               dfsh=nint(xdf)
-               iderrbest=iderr
-               idriftbest=idrift
-               snrdb=db(snr) - db(2500.0/df) - db(sqrt(nsteps/4.0))+1.8
-               n1=nbest
-               n2=n2best
-               ipk1=ipk(n1)
-               ipk2=ipk(n2)
-            endif
-         endif
-         if(nstest.eq.0) nspecial=0
- 10   enddo
-
-      if(nstest.eq.0) nspecialbest=0
-      df4=4.0*df
-      if(nstest.gt.0) then
-
-         if(ipk1.gt.ipk2) then
-            ntmp=n1
-            n1=n2
-            n2=ntmp
-            ntmp=ipk1
-            ipk1=ipk2
-            ipk2=ntmp
-         endif
-
-         call zero(ss1,2258)
-         call zero(ss2,2258)
-         do i=ia2,ib2,4
-            f=df*i
-            k=nint((f-1270.46)/df4)
-            ss1(k)=0.3 * (ss(i-2,n1) + ss(i-1,n1) + ss(i,n1) + 
-     +        ss(i+1,n1) + ss(i+2,n1))
-            ss2(k)=0.3 * (ss(i-2,n2) + ss(i-1,n2) + ss(i,n2) +
-     +        ss(i+1,n2) + ss(i+2,n2))
-         enddo
-
-         kpk1=nint(0.25*ipk1-472.0)
-         kpk2=kpk1 + nspecial*mode65*10
-         ssmax=0.
-         do i=-10,10
-            ssavg(i)=ss1(kpk1+i) + ss2(kpk2+i)
-            if(ssavg(i).gt.ssmax) then
-               ssmax=ssavg(i)
-               itop=i
-            endif
-         enddo
-         base=0.25*(ssavg(-10)+ssavg(-9)+ssavg(9)+ssavg(10))
-         shalf=0.5*(ssmax+base)
-         do k=1,8
-            if(ssavg(itop-k).lt.shalf) go to 110
-         enddo
-         k=8
- 110     x=(ssavg(itop-(k-1))-shalf)/(ssavg(itop-(k-1))-ssavg(itop-k))
-         do k=1,8
-            if(ssavg(itop+k).lt.shalf) go to 120
-         enddo
-         k=8
- 120     x=x+(ssavg(itop+(k-1))-shalf)/(ssavg(itop+(k-1))-ssavg(itop+k))
-         nwsh=nint(x*df4)
-      endif
-
-C  See if orange/magenta curves need to be shifted:
-      idfsh=0
-      if(mousedf.lt.-600) idfsh=-670
-      if(mousedf.gt.600) idfsh=1000
-      if(mousedf.gt.1600) idfsh=2000
-      if(mousedf.gt.2600) idfsh=3000
-      i0=nint(idfsh/df4)
-
-      do i=-224,224
-         ss1a(i)=ss1(i+i0)
-         ss2a(i)=ss2(i+i0)
-      enddo
-
-      return
-      end

Deleted: branches/map65/sleep.h
===================================================================
--- branches/map65/sleep.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/sleep.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,32 +0,0 @@
-/*
- * sleep.h  1.0 02/03/10
- *
- * Defines cross-platform sleep, usleep, etc.
- *
- * By Wu Yongwei
- *
- */
-
-#ifndef _SLEEP_H
-#define _SLEEP_H
-
-#ifdef _WIN32
-# if defined(_NEED_SLEEP_ONLY) &amp;&amp; (defined(_MSC_VER) || defined(__MINGW32__))
-#  include &lt;stdlib.h&gt;
-#  define sleep(t) _sleep((t) * 1000)
-# else
-#  include &lt;windows.h&gt;
-#  define sleep(t)  Sleep((t) * 1000)
-# endif
-# ifndef _NEED_SLEEP_ONLY
-#  define msleep(t) Sleep(t)
-#  define usleep(t) Sleep((t) / 1000)
-# endif
-#else
-# include &lt;unistd.h&gt;
-# ifndef _NEED_SLEEP_ONLY
-#  define msleep(t) usleep((t) * 1000)
-# endif
-#endif
-
-#endif /* _SLEEP_H */

Added: branches/map65/sleep.h
===================================================================
--- branches/map65/sleep.h	                        (rev 0)
+++ branches/map65/sleep.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,16 @@
+#ifndef SLEEP_H
+#define SLEEP_H
+#include &lt;qthread.h&gt;
+
+class Sleep : public QThread
+{
+public:
+  static void msleep(int ms) {
+    QThread::msleep(ms);
+  }
+  static int idealThreadCount() {
+    return QThread::idealThreadCount();
+  }
+};
+
+#endif // SLEEP_H

Deleted: branches/map65/slope.f
===================================================================
--- branches/map65/slope.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/slope.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,41 +0,0 @@
-      subroutine slope(y,npts,xpk)
-
-C  Remove best-fit slope from data in y(i).  When fitting the straight line,
-C  ignore the peak around xpk +/- 2.
-
-      real y(npts)
-      real x(100)
-
-      do i=1,npts
-         x(i)=i
-      enddo
-
-      sumw=0.
-      sumx=0.
-      sumy=0.
-      sumx2=0.
-      sumxy=0.
-      sumy2=0.
-
-      do i=1,npts
-         if(abs(i-xpk).gt.2.0) then
-            sumw=sumw + 1.0
-            sumx=sumx + x(i)
-            sumy=sumy + y(i)
-            sumx2=sumx2 + x(i)**2
-            sumxy=sumxy + x(i)*y(i)
-            sumy2=sumy2 + y(i)**2
-         endif
-      enddo
-
-      delta=sumw*sumx2 - sumx**2
-      a=(sumx2*sumy - sumx*sumxy) / delta
-      b=(sumw*sumxy - sumx*sumy) / delta
-
-      do i=1,npts
-         y(i)=y(i)-(a + b*x(i))
-      enddo
-
-      return
-      end
-

Deleted: branches/map65/smeter.py
===================================================================
--- branches/map65/smeter.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/smeter.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,73 +0,0 @@
-&quot;&quot;&quot;
-A  basic widget for showing the progress
-being made in a task.
-
-&quot;&quot;&quot;
-
-from Tkinter import *
-
-class Smeter:
-    def __init__(self, master=None, orientation=&quot;horizontal&quot;,
-                 min=0, max=100, width=100, height=18,
-                 doLabel=1, appearance=&quot;sunken&quot;,
-		 fillColor=&quot;blue&quot;, background=&quot;gray&quot;,
-                 labelColor=&quot;yellow&quot;, labelFont=&quot;Verdana&quot;,
-                 labelText=&quot;&quot;, labelFormat=&quot;%d%%&quot;,
-                 value=50, bd=2):
-	# preserve various values
-	self.master=master
-	self.orientation=orientation
-	self.min=min
-	self.max=max
-	self.width=width
-	self.height=height
-	self.doLabel=doLabel
-	self.fillColor=fillColor
-        self.labelFont= labelFont
-	self.labelColor=labelColor
-	self.background=background
-	self.labelText=labelText
-	self.labelFormat=labelFormat
-	self.value=value
-	self.frame=Frame(master, relief=appearance, bd=bd)
-	self.canvas=Canvas(self.frame, height=height, width=width, bd=0,
-                           highlightthickness=0, background=background)
-	self.scale=self.canvas.create_rectangle(0, 0, width, height,
-						fill=fillColor)
-	self.label=self.canvas.create_text(self.canvas.winfo_reqwidth() / 2,
-					   height / 2, text=labelText,
-					   anchor=&quot;c&quot;, fill=labelColor,
-					   font=self.labelFont)
-	self.update()
-	self.canvas.pack(side='top', fill='x', expand='no')
-
-    def updateProgress(self, newValue, newMax=None):
-        if newMax:
-            self.max = newMax
-        self.value = newValue
-        self.update()
-
-    def update(self):
-	# Trim the values to be between min and max
-	value=self.value
-	if value &gt; self.max:
-	    value = self.max
-	if value &lt; self.min:
-	    value = self.min
-	# Adjust the rectangle
-	if self.orientation == &quot;horizontal&quot;:
-	    self.canvas.coords(self.scale, 0, 0,
-		     float(value) / self.max * self.width, self.height)
-	else:
-	    self.canvas.coords(self.scale, 0,
-                     self.height - (float(value) / self.max*self.height),
-		     self.width, self.height)
-	# Now update the colors
-	self.canvas.itemconfig(self.scale, fill=self.fillColor)
-	self.canvas.itemconfig(self.label, fill=self.labelColor)
-	# And update the label
-	if self.doLabel:
-            dB=int((value-50.0)/2.5)
-            t='%d dB'%dB
-            self.canvas.itemconfig(self.label, text=t)
-	self.canvas.update_idletasks()

Deleted: branches/map65/smooth.f
===================================================================
--- branches/map65/smooth.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/smooth.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,13 +0,0 @@
-      subroutine smooth(x,nz)
-
-      real x(nz)
-
-      x0=x(1)
-      do i=2,nz-1
-         x1=x(i)
-         x(i)=0.5*x(i) + 0.25*(x0+x(i+1))
-         x0=x1
-      enddo
-
-      return
-      end

Deleted: branches/map65/sort.f
===================================================================
--- branches/map65/sort.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/sort.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,4 +0,0 @@
-      subroutine sort(n,arr)
-      call ssort(arr,tmp,n,1)
-      return
-      end

Added: branches/map65/soundin.cpp
===================================================================
--- branches/map65/soundin.cpp	                        (rev 0)
+++ branches/map65/soundin.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,403 @@
+#include &quot;soundin.h&quot;
+#include &lt;stdexcept&gt;
+
+#define NFFT 32768
+#define FRAMES_PER_BUFFER 1024
+
+extern &quot;C&quot; {
+#include &lt;portaudio.h&gt;
+extern struct {
+  double d8[2*60*96000];   //This is &quot;common/datcom/...&quot; in fortran
+  float ss[4*322*NFFT];
+  float savg[4*NFFT];
+  double fcenter;
+  int nutc;
+  int idphi;                        //Phase correction for Y pol'n, degrees
+  int mousedf;                      //User-selected DF
+  int mousefqso;                    //User-selected QSO freq (kHz)
+  int nagain;                       //1 ==&gt; decode only at fQSO +/- Tol
+  int ndepth;                       //How much hinted decoding to do?
+  int ndiskdat;                     //1 ==&gt; data read from *.tf2 or *.iq file
+  int neme;                         //Hinted decoding tries only for EME calls
+  int newdat;                       //1 ==&gt; new data, must do long FFT
+  int nfa;                          //Low decode limit (kHz)
+  int nfb;                          //High decode limit (kHz)
+  int nfcal;                        //Frequency correction, for calibration (Hz)
+  int nfshift;                      //Shift of displayed center freq (kHz)
+  int mcall3;                       //1 ==&gt; CALL3.TXT has been modified
+  int ntimeout;                     //Max for timeouts in Messages and BandMap
+  int ntol;                         //+/- decoding range around fQSO (Hz)
+  int nxant;                        //1 ==&gt; add 45 deg to measured pol angle
+  int map65RxLog;                   //Flags to control log files
+  int nfsample;                     //Input sample rate
+  int nxpol;                        //1 if using xpol antennas, 0 otherwise
+  int mode65;                       //JT65 sub-mode: A=1, B=2, C=4
+  char mycall[12];
+  char mygrid[6];
+  char hiscall[12];
+  char hisgrid[6];
+  char datetime[20];
+} datcom_;
+}
+
+typedef struct
+{
+  int kin;          //Parameters sent to/from the portaudio callback function
+  int nrx;
+  bool bzero;
+  bool iqswap;
+  bool b10db;
+} paUserData;
+
+//--------------------------------------------------------------- a2dCallback
+extern &quot;C&quot; int a2dCallback( const void *inputBuffer, void *outputBuffer,
+                         unsigned long framesToProcess,
+                         const PaStreamCallbackTimeInfo* timeInfo,
+                         PaStreamCallbackFlags statusFlags,
+                         void *userData )
+
+// This routine called by the PortAudio engine when samples are available.
+// It may be called at interrupt level, so don't do anything
+// that could mess up the system like calling malloc() or free().
+
+{
+  paUserData *udata=(paUserData*)userData;
+  (void) outputBuffer;          //Prevent unused variable warnings.
+  (void) timeInfo;
+  (void) userData;
+  int nbytes,i,j;
+  float d4[4*FRAMES_PER_BUFFER];
+  float d4a[4*FRAMES_PER_BUFFER];
+  float tmp;
+  float fac;
+
+  if( (statusFlags&amp;paInputOverflow) != 0) {
+    qDebug() &lt;&lt; &quot;Input Overflow&quot;;
+  }
+  if(udata-&gt;bzero) {           //Start of a new minute
+    udata-&gt;kin=0;              //Reset buffer pointer
+    udata-&gt;bzero=false;
+  }
+
+  nbytes=udata-&gt;nrx*8*framesToProcess;        //Bytes per frame
+  memcpy(d4,inputBuffer,nbytes);              //Copy all samples to d4
+
+  fac=32767.0;
+  if(udata-&gt;b10db) fac=103618.35;
+
+  if(udata-&gt;nrx==2) {
+    for(i=0; i&lt;4*int(framesToProcess); i++) {     //Negate odd-numbered frames
+      d4[i]=fac*d4[i];
+      j=i/4;
+      if((j%2)==1) d4[i]=-d4[i];
+    }
+    if(!udata-&gt;iqswap) {
+      for(i=0; i&lt;int(framesToProcess); i++) {
+        j=4*i;
+        tmp=d4[j];
+        d4[j]=d4[j+1];
+        d4[j+1]=tmp;
+        tmp=d4[j+2];
+        d4[j+2]=d4[j+3];
+        d4[j+3]=tmp;
+      }
+    }
+    memcpy(&amp;datcom_.d8[2*udata-&gt;kin],d4,nbytes); //Copy from d4 to dd()
+  } else {
+    int k=0;
+    for(i=0; i&lt;2*int(framesToProcess); i+=2) {    //Negate odd-numbered frames
+      j=i/2;
+      if(j%2==0) {
+        d4a[k++]=fac*d4[i];
+        d4a[k++]=fac*d4[i+1];
+      } else {
+        d4a[k++]=-fac*d4[i];
+        d4a[k++]=-fac*d4[i+1];
+      }
+      d4a[k++]=0.0;
+      d4a[k++]=0.0;
+    }
+    if(!udata-&gt;iqswap) {
+      for(i=0; i&lt;int(framesToProcess); i++) {
+        j=4*i;
+        tmp=d4a[j];
+        d4a[j]=d4a[j+1];
+        d4a[j+1]=tmp;
+      }
+    }
+    memcpy(&amp;datcom_.d8[2*udata-&gt;kin],d4a,2*nbytes); //Copy from d4a to dd()
+  }
+  udata-&gt;kin += framesToProcess;
+  return paContinue;
+}
+
+void SoundInThread::run()                           //SoundInThread::run()
+{
+  quitExecution = false;
+
+  if (m_net) {
+//    qDebug() &lt;&lt; &quot;Start inputUDP()&quot;;
+    inputUDP();
+//    qDebug() &lt;&lt; &quot;Finished inputUDP()&quot;;
+    return;
+  }
+
+//---------------------------------------------------- Soundcard Setup
+//  qDebug() &lt;&lt; &quot;Start souncard input&quot;;
+
+  PaError paerr;
+  PaStreamParameters inParam;
+  PaStream *inStream;
+  paUserData udata;
+
+  udata.kin=0;                              //Buffer pointer
+  udata.bzero=false;                        //Flag to request reset of kin
+  udata.nrx=m_nrx;                          //Number of polarizations
+  udata.iqswap=m_IQswap;
+  udata.b10db=m_10db;
+
+  inParam.device=m_nDevIn;                  //### Input Device Number ###
+  inParam.channelCount=2*m_nrx;             //Number of analog channels
+  inParam.sampleFormat=paFloat32;           //Get floats from Portaudio
+  inParam.suggestedLatency=0.05;
+  inParam.hostApiSpecificStreamInfo=NULL;
+
+  paerr=Pa_IsFormatSupported(&amp;inParam,NULL,96000.0);
+  if(paerr&lt;0) {
+    emit error(&quot;PortAudio says requested soundcard format not supported.&quot;);
+//    return;
+  }
+  paerr=Pa_OpenStream(&amp;inStream,            //Input stream
+        &amp;inParam,                           //Input parameters
+        NULL,                               //No output parameters
+        96000.0,                            //Sample rate
+        FRAMES_PER_BUFFER,                  //Frames per buffer
+//        paClipOff+paDitherOff,              //No clipping or dithering
+        paClipOff,                          //No clipping
+        a2dCallback,                        //Input callbeck routine
+        &amp;udata);                            //userdata
+
+  paerr=Pa_StartStream(inStream);
+  if(paerr&lt;0) {
+    emit error(&quot;Failed to start audio input stream.&quot;);
+    return;
+  }
+//  const PaStreamInfo* p=Pa_GetStreamInfo(inStream);
+
+  bool qe = quitExecution;
+  int n60z=99;
+  int k=0;
+  int nsec;
+  int n60;
+  int nBusy=0;
+  int nhsym0=0;
+
+//---------------------------------------------- Soundcard input loop
+  while (!qe) {
+    qe = quitExecution;
+    if (qe) break;
+    qint64 ms = QDateTime::currentMSecsSinceEpoch() % 86400000;
+    nsec = ms/1000;             // Time according to this computer
+    n60 = nsec % 60;
+
+// Reset buffer pointer and symbol number at start of minute
+    if(n60 &lt; n60z or !m_monitoring) {
+      nhsym0=0;
+      udata.bzero=true;
+    }
+    k=udata.kin;
+    udata.iqswap=m_IQswap;
+    udata.b10db=m_10db;
+    if(m_monitoring) {
+      if(m_bForceCenterFreq) {
+        datcom_.fcenter=m_dForceCenterFreq;\
+      } else {
+        datcom_.fcenter=144.125;
+      }
+      m_hsym=(k-2048)*11025.0/(2048.0*m_rate);
+      if(m_hsym != nhsym0) {
+        if(m_dataSinkBusy) {
+          nBusy++;
+        } else {
+          m_dataSinkBusy=true;
+          emit readyForFFT(k);         //Signal to compute new FFTs
+        }
+        nhsym0=m_hsym;
+      }
+    }
+    msleep(100);
+    n60z=n60;
+  }
+  Pa_StopStream(inStream);
+  Pa_CloseStream(inStream);
+}
+
+void SoundInThread::setSwapIQ(bool b)
+{
+  m_IQswap=b;
+}
+
+void SoundInThread::set10db(bool b)
+{
+  m_10db=b;
+}
+void SoundInThread::setPort(int n)                              //setPort()
+{
+  if (isRunning()) return;
+  this-&gt;m_udpPort=n;
+}
+
+void SoundInThread::setInputDevice(int n)                  //setInputDevice()
+{
+  if (isRunning()) return;
+  this-&gt;m_nDevIn=n;
+}
+
+void SoundInThread::setRate(double rate)                         //setRate()
+{
+  if (isRunning()) return;
+  this-&gt;m_rate = rate;
+}
+
+void SoundInThread::setBufSize(unsigned n)                      //setBufSize()
+{
+  if (isRunning()) return;
+  this-&gt;bufSize = n;
+}
+
+void SoundInThread::setFadd(double x)
+{
+  m_fAdd=x;
+}
+
+
+void SoundInThread::quit()                                       //quit()
+{
+  quitExecution = true;
+}
+
+void SoundInThread::setNetwork(bool b)                          //setNetwork()
+{
+  m_net = b;
+}
+
+void SoundInThread::setMonitoring(bool b)                    //setMonitoring()
+{
+  m_monitoring = b;
+}
+
+void SoundInThread::setForceCenterFreqBool(bool b)
+{
+  m_bForceCenterFreq=b;
+
+}
+
+void SoundInThread::setForceCenterFreqMHz(double d)
+{
+  m_dForceCenterFreq=d;
+}
+
+void SoundInThread::setNrx(int n)                              //setNrx()
+{
+  m_nrx = n;
+}
+
+int SoundInThread::nrx()
+{
+  return m_nrx;
+}
+
+int SoundInThread::mhsym()
+{
+  return m_hsym;
+}
+
+//--------------------------------------------------------------- inputUDP()
+void SoundInThread::inputUDP()
+{
+  udpSocket = new QUdpSocket();
+  if(!udpSocket-&gt;bind(m_udpPort,QUdpSocket::ShareAddress) )
+  {
+    emit error(tr(&quot;UDP Socket bind failed.&quot;));
+    return;
+  }
+
+  // Set this socket's total buffer space for received UDP packets
+  int v=141600;
+  ::setsockopt(udpSocket-&gt;socketDescriptor(), SOL_SOCKET, SO_RCVBUF,
+               (char *)&amp;v, sizeof(v));
+
+  bool qe = quitExecution;
+  struct linradBuffer {
+    double cfreq;
+    int msec;
+    float userfreq;
+    int iptr;
+    quint16 iblk;
+    qint8 nrx;
+    char iusb;
+    double d8[174];
+  } b;
+
+  int n60z=99;
+  int k=0;
+  int nsec;
+  int n60;
+  int nhsym0=0;
+  int iz=174;
+  int nBusy=0;
+
+  // Main loop for input of UDP packets over the network:
+  while (!qe) {
+    qe = quitExecution;
+    if (qe) break;
+    if (!udpSocket-&gt;hasPendingDatagrams()) {
+      msleep(2);                  // Sleep if no packet available
+    } else {
+      int nBytesRead = udpSocket-&gt;readDatagram((char *)&amp;b,1416);
+      if (nBytesRead != 1416) qDebug() &lt;&lt; &quot;UDP Read Error:&quot; &lt;&lt; nBytesRead;
+
+      qint64 ms = QDateTime::currentMSecsSinceEpoch() % 86400000;
+      nsec = ms/1000;             // Time according to this computer
+      n60 = nsec % 60;
+
+// Reset buffer pointer and symbol number at start of minute
+      if(n60 &lt; n60z) {
+        k=0;
+        nhsym0=0;
+      }
+      n60z=n60;
+
+      if(m_monitoring) {
+        m_nrx=b.nrx;
+        if(m_nrx == +1) iz=348;                 //One RF channel, i*2 data
+        if(m_nrx == -1 or m_nrx == +2) iz=174;  //One Rf channel, r*4 data
+                                                // or 2 RF channels, i*2 data
+        if(m_nrx == -2) iz=87;                  // Two RF channels, r*4 data
+
+        // If buffer will not overflow, move data into datcom_
+        if ((k+iz) &lt;= 60*96000) {
+          int nsam=-1;
+          recvpkt_(&amp;nsam, &amp;b.iblk, &amp;b.nrx, &amp;k, b.d8, b.d8, b.d8);
+          if(m_bForceCenterFreq) {
+            datcom_.fcenter=m_dForceCenterFreq;
+          } else {
+            datcom_.fcenter=b.cfreq + m_fAdd;
+          }
+        }
+
+        m_hsym=(k-2048)*11025.0/(2048.0*m_rate);
+        if(m_hsym != nhsym0) {
+          if(m_dataSinkBusy) {
+            nBusy++;
+          } else {
+            m_dataSinkBusy=true;
+            emit readyForFFT(k);         //Signal to compute new FFTs
+          }
+          nhsym0=m_hsym;
+        }
+      }
+    }
+  }
+  delete udpSocket;
+}

Added: branches/map65/soundin.h
===================================================================
--- branches/map65/soundin.h	                        (rev 0)
+++ branches/map65/soundin.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,85 @@
+#ifndef SOUNDIN_H
+#define SOUNDIN_H
+
+#include &lt;QtCore&gt;
+#include &lt;QtNetwork/QUdpSocket&gt;
+#include &lt;QDebug&gt;
+#include &lt;valarray&gt;
+
+#ifdef Q_OS_WIN32
+#include &lt;winsock.h&gt;
+#else
+#include &lt;sys/socket.h&gt;
+#endif //Q_OS_WIN32
+
+// Thread gets audio data from soundcard and signals when a buffer of
+// specified size is available.
+class SoundInThread : public QThread
+{
+  Q_OBJECT
+  bool quitExecution;           // if true, thread exits gracefully
+  double m_rate;                // sample rate
+  unsigned bufSize;             // user's buffer size
+
+protected:
+  virtual void run();
+
+public:
+  bool m_dataSinkBusy;
+
+  SoundInThread():
+    quitExecution(false),
+    m_dataSinkBusy(false),
+    m_rate(0),
+    bufSize(0)
+  {
+  }
+
+  void setSwapIQ(bool b);
+  void set10db(bool b);
+  void setPort(qint32 n);
+  void setInputDevice(qint32 n);
+  void setRate(double rate);
+  void setBufSize(unsigned bufSize);
+  void setNetwork(bool b);
+  void setMonitoring(bool b);
+  void setFadd(double x);
+  void setNrx(int n);
+  void setForceCenterFreqBool(bool b);
+  void setForceCenterFreqMHz(double d);
+  int  nrx();
+  int  mhsym();
+
+signals:
+  void bufferAvailable(std::valarray&lt;qint16&gt; samples, double rate);
+  void readyForFFT(int k);
+  void error(const QString&amp; message);
+  void status(const QString&amp; message);
+
+public slots:
+  void quit();
+
+private:
+  void inputUDP();
+
+  double m_fAdd;
+  bool   m_net;
+  bool   m_monitoring;
+  bool   m_bForceCenterFreq;
+  bool   m_IQswap;
+  bool   m_10db;
+  double m_dForceCenterFreq;
+  qint32 m_nrx;
+  qint32 m_hsym;
+  qint32 m_nDevIn;
+  qint32 m_udpPort;
+
+  QUdpSocket *udpSocket;
+};
+
+extern &quot;C&quot; {
+  void recvpkt_(int* nsam, quint16* iblk, qint8* nrx, int* k, double s1[],
+                double s2[], double s3[]);
+}
+
+#endif // SOUNDIN_H

Added: branches/map65/soundout.cpp
===================================================================
--- branches/map65/soundout.cpp	                        (rev 0)
+++ branches/map65/soundout.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,170 @@
+#include &quot;soundout.h&quot;
+
+#define FRAMES_PER_BUFFER 256
+
+extern &quot;C&quot; {
+#include &lt;portaudio.h&gt;
+}
+
+extern float gran();                  //Noise generator (for tests only)
+
+extern short int iwave[60*11025];     //Wave file for Tx audio
+extern int nwave;
+extern bool btxok;
+extern double outputLatency;
+
+typedef struct   //Parameters sent to or received from callback function
+{
+  int dummy;
+} paUserData;
+
+//--------------------------------------------------------------- d2aCallback
+extern &quot;C&quot; int d2aCallback(const void *inputBuffer, void *outputBuffer,
+                           unsigned long framesToProcess,
+                           const PaStreamCallbackTimeInfo* timeInfo,
+                           PaStreamCallbackFlags statusFlags,
+                           void *userData )
+{
+  paUserData *udata=(paUserData*)userData;
+  short *wptr = (short*)outputBuffer;
+  unsigned int i,n;
+  static int ic=0;
+//  static int ic0=0;
+//  static int nsec0=-99;
+  static bool btxok0=false;
+  static int nminStart=0;
+//  static t0,t1;
+  double tsec,tstart;
+
+  int nsec;
+
+  // Get System time
+  qint64 ms = QDateTime::currentMSecsSinceEpoch() % 86400000;
+  tsec = 0.001*ms;
+  nsec = ms/1000;
+
+  if(btxok and !btxok0) {       //Start (or re-start) a transmission
+    n=nsec/60;
+    tstart=tsec - n*60.0 - 1.0;
+
+    if(tstart&lt;1.0) {
+      ic=0;                      //Start of minute, set starting index to 0
+//      ic0=ic;
+      nminStart=n;
+//      t0=timeInfo-&gt;currentTime;
+    } else {
+      if(n != nminStart) { //Late start in new minute: compute starting index
+        ic=(int)(tstart*11025.0);
+//        ic0=ic;
+//        t0=timeInfo-&gt;currentTime;
+//        qDebug() &lt;&lt; &quot;B&quot; &lt;&lt; t0 &lt;&lt; ic0;
+        nminStart=n;
+      }
+    }
+    /*
+    qDebug() &lt;&lt; &quot;A&quot; &lt;&lt; n &lt;&lt; ic
+             &lt;&lt; QString::number( tsec, 'f', 3 )
+             &lt;&lt; QString::number( tstart, 'f', 3 )
+             &lt;&lt; QString::number( timeInfo-&gt;currentTime, 'f', 3 )
+             &lt;&lt; QString::number( timeInfo-&gt;outputBufferDacTime, 'f', 3 )
+             &lt;&lt; QString::number( timeInfo-&gt;outputBufferDacTime -
+                                 timeInfo-&gt;currentTime, 'f', 3 )
+             &lt;&lt; QString::number( timeInfo-&gt;currentTime - tsec, 'f', 3 );
+    */
+  }
+  btxok0=btxok;
+
+  /*
+  if(nsec!=nsec0) {
+    double txt=timeInfo-&gt;currentTime - t0;
+    double r=0.0;
+    if(txt&gt;0.0) r=(ic-ic0)/txt;
+    qDebug() &lt;&lt; &quot;C&quot; &lt;&lt; txt &lt;&lt; ic-ic0 &lt;&lt; r;
+    nsec0=nsec;
+  }
+  */
+
+  if(btxok) {
+    for(i=0 ; i&lt;framesToProcess; i++ )  {
+      short int i2=iwave[ic];
+      if(ic &gt; nwave) i2=0;
+//      i2 = 500.0*(i2/32767.0 + 5.0*gran());      //Add noise (tests only!)
+      if(!btxok) i2=0;
+      *wptr++ = i2;                   //left
+      *wptr++ = i2;                   //right
+      ic++;
+    }
+  } else {
+    for(i=0 ; i&lt;framesToProcess; i++ )  {
+      *wptr++ = 0;
+      *wptr++ = 0;
+      ic++;
+    }
+  }
+  if(ic &gt; nwave) {
+    btxok=0;
+    ic=0;
+  }
+  return 0;
+}
+
+void SoundOutThread::run()
+{
+  PaError paerr;
+  PaStreamParameters outParam;
+  PaStream *outStream;
+  paUserData udata;
+  quitExecution = false;
+
+  outParam.device=m_nDevOut;                 //Output device number
+  outParam.channelCount=2;                   //Number of analog channels
+  outParam.sampleFormat=paInt16;             //Send short ints to PortAudio
+  outParam.suggestedLatency=0.05;
+  outParam.hostApiSpecificStreamInfo=NULL;
+
+  paerr=Pa_IsFormatSupported(NULL,&amp;outParam,11025.0);
+  if(paerr&lt;0) {
+    qDebug() &lt;&lt; &quot;PortAudio says requested output format not supported.&quot;;
+    qDebug() &lt;&lt; paerr;
+    return;
+  }
+
+//  udata.nwave=m_nwave;
+//  udata.btxok=false;
+
+  paerr=Pa_OpenStream(&amp;outStream,           //Output stream
+        NULL,                               //No input parameters
+        &amp;outParam,                          //Output parameters
+        11025.0,                            //Sample rate
+        FRAMES_PER_BUFFER,                  //Frames per buffer
+        paClipOff,                          //No clipping
+        d2aCallback,                        //output callbeck routine
+        &amp;udata);                            //userdata
+
+  paerr=Pa_StartStream(outStream);
+  if(paerr&lt;0) {
+    qDebug() &lt;&lt; &quot;Failed to start audio output stream.&quot;;
+    return;
+  }
+  const PaStreamInfo* p=Pa_GetStreamInfo(outStream);
+  outputLatency = p-&gt;outputLatency;
+  bool qe = quitExecution;
+
+//---------------------------------------------- Soundcard output loop
+  while (!qe) {
+    qe = quitExecution;
+    if (qe) break;
+//    udata.nwave=m_nwave;
+//    if(m_txOK) udata.btxok=1;
+//    if(!m_txOK) udata.btxok=0;
+    msleep(100);
+  }
+  Pa_StopStream(outStream);
+  Pa_CloseStream(outStream);
+}
+
+void SoundOutThread::setOutputDevice(int n)      //setOutputDevice()
+{
+  if (isRunning()) return;
+  this-&gt;m_nDevOut=n;
+}

Added: branches/map65/soundout.h
===================================================================
--- branches/map65/soundout.h	                        (rev 0)
+++ branches/map65/soundout.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,42 @@
+#ifndef SOUNDOUT_H
+#define SOUNDOUT_H
+#include &lt;QtCore&gt;
+#include &lt;QDebug&gt;
+
+// An instance of this thread sends audio data to a specified soundcard.
+// Output can be muted while underway, preserving waveform timing when
+// transmission is resumed.
+
+class SoundOutThread : public QThread
+{
+  Q_OBJECT
+
+protected:
+  virtual void run();
+
+public:
+// Constructs (but does not start) a SoundOutThread
+  SoundOutThread()
+    :   quitExecution(false)           // Initialize some private members
+    ,   m_rate(0)
+    ,   m_nwave(48*11025)
+    ,   m_txOK(false)
+    ,   m_txMute(false)
+  {
+  }
+
+public:
+  void setOutputDevice(qint32 n);
+  bool quitExecution;           //If true, thread exits gracefully
+
+
+// Private members
+private:
+  double  m_rate;               //Sample rate
+  qint32  m_nDevOut;            //Output device number
+  qint32  m_nwave;              //Length of wave file
+  bool    m_txOK;               //Enable Tx audio
+  bool    m_txMute;             //Mute temporarily
+};
+
+#endif

Deleted: branches/map65/spcom.f90
===================================================================
--- branches/map65/spcom.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/spcom.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,3 +0,0 @@
-parameter (NFFT=32768)
-common/spcom/ss(4,322,NFFT),ss5(322,NFFT),savg(4,NFFT),nhsym,   &amp;
-            ssz(4,322,NFFT),ssz5(322,NFFT),szavg(4,NFFT)

Deleted: branches/map65/spec.f90
===================================================================
--- branches/map65/spec.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/spec.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,142 +0,0 @@
-subroutine spec(brightness,contrast,ngain,nspeed,a,a2)
-
-  parameter (NX=750,NY=130,NTOT=NX*NY)
-
-! Input:
-  integer brightness,contrast   !Display parameters
-  integer ngain                 !Digital gain for input audio
-  integer nspeed                !Scrolling speed index
-
-! Output:
-  integer*2 a(NTOT)             !Pixel values for NX x NY array
-  integer*2 a2(NTOT)            !Pixel values for NX x NY array
-
-  logical first
-  integer nstep(5)
-  integer hist(0:1000)
-!  Could save memory by doing the averaging-by-7 (or 10?) of ss5 in symspec.
-  include 'spcom.f90'
-  real s(NFFT,NY),savg2(NFFT)
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-  include 'gcom3.f90'
-  include 'gcom4.f90'
-  data first/.true./
-  data nstep/28,20,14,10,7/       !Integration limits
-  save
-
-  if(first) then
-     df=96000.0/nfft
-     call zero(a,NX*NY/2)
-     call zero(a2,NX*NY/2)
-     first=.false.
-  endif
-
-  nadd=nstep(nspeed)
-  nlines=322/nadd
-  call zero(s,NFFT*NY)
-  k=0
-  do j=1,nlines
-     do n=1,nadd
-        k=k+1
-        do i=1,NFFT
-           s(i,j)=s(i,j) + ss5(k,i)
-        enddo
-     enddo
-  enddo
-  call zero(savg2,NFFT)
-  do j=1,nlines
-     do i=1,NFFT
-        savg2(i)=savg2(i) + s(i,j)
-     enddo
-  enddo
-
-  ia=0.08*NFFT
-  ib=0.92*NFFT
-  smin=1.e30
-  smax=-smin
-  sum=0.
-  nsum=0
-  do i=ia,ib
-     smin=min(savg2(i),smin)
-     smax=max(savg2(i),smax)
-     if(savg2(i).lt.10000.0) then
-        sum=sum + savg2(i)
-        nsum=nsum+1
-     endif
-  enddo
-  ave=sum/nsum
-  call zero(hist,1001)
-  do i=ia,ib
-     n=savg2(i) * (300.0/ave)
-     if(n.gt.1000) n=1000
-     if(n.ge.0 .and. n.le.1000) hist(n)=hist(n)+1
-  enddo
-
-  sum=0.
-  do i=0,1000
-     sum=sum + float(hist(i))/(ib-ia+1)
-     if(sum.gt.0.4) go to 10
-  enddo
-10 base=i*ave/300.0
-  base=base/(nadd*nlines)
-
-  newpts=NX*nlines
-  do i=newpts+1,NX*NY
-     a(i)=a(i-newpts)
-     a2(i)=a2(i-newpts)
-  enddo
-
-  logmap=1
-  gamma=1.3 + 0.01*contrast
-  offset=(brightness+64.0)/2
-  if(logmap.eq.1) then
-     gain=40*sqrt(nstep(nspeed)/5.0) * 5.0**(0.01*contrast)
-     offset=brightness/2 + 10
-  endif
-  fac=20.0/nadd
-  fac=fac*0.065/base
- ! fac=fac*(0.1537/base)
-  foffset=0.001*(1270+nfcal)
-  nbpp=(nfb-nfa)*NFFT/(96.0*NX)  !Bins per pixel in wideband (upper) waterfall
-  fselect=mousefqso + foffset - 1000.d0*(fcenter-144.125d0)
-  imid=nint(1000.0*(fselect-125.0+48.0)/df)
-  fmid=0.5*(nfa+nfb) + foffset
-  imid0=nint(1000.0*(fmid-125.0+48.0)/df) - nbpp/2  !Last term is empirical
-  i0=imid-375
-  ii0=imid0-375*nbpp
-!  if(nfullspec.eq.1) then
-!     nbpp=NFFT/NX
-!     ii0=0
-!  endif
-
-  k=0
-  do j=nlines,1,-1               !Reverse order so last will be on top
-     do i=1,NX
-        k=k+1
-        n=0
-        x=0.
-        iia=(i-1)*nbpp + ii0 + 1
-        iib=i*nbpp + ii0
-        do ii=iia,iib
-           x=max(x,s(ii,j))
-        enddo
-        x=fac*x
-        if(x.gt.0.0 .and. logmap.eq.0) n=(2.0*x)**gamma + offset
-        if(x.gt.0.0 .and. logmap.eq.1) n=gain*log10(1.0*x) + offset
-        n=min(252,max(0,n))
-        a(k)=n
-
-!  Now do the lower (zoomed) waterfall with one FFT bin per pixel.
-        n=0
-        x=fac*s(i0+i-1,j)
-        if(x.gt.0.0 .and. logmap.eq.0) n=(3.0*x)**gamma + offset
-        if(x.gt.0.0 .and. logmap.eq.1) n=1.2*gain*log10(1.0*x) + offset
-        n=min(252,max(0,n))
-        a2(k)=n
-
-     enddo
-  enddo
-
-  return
-end subroutine spec

Deleted: branches/map65/specjt.py
===================================================================
--- branches/map65/specjt.py	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/specjt.py	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,574 +0,0 @@
-#----------------------------------------------------- SpecJT
-from Tkinter import *
-from tkMessageBox import showwarning
-import time
-import os
-import Pmw
-import Audio
-import g
-import string
-import cPickle
-#from Numeric import zeros, multiarray
-#import numpy
-try:
-    from numpy.oldnumeric import zeros, multiarray
-except:
-    from Numeric import zeros, multiarray
-import Image, ImageTk, ImageDraw
-from palettes import colormapblue, colormapgray0, colormapHot, \
-     colormapAFMHot, colormapgray1, colormapLinrad, Colormap2Palette
-#import wsjt                         #Is this OK to do?
-
-def hidespecjt():
-    root.withdraw()
-    g.showspecjt=0
-def showspecjt():
-    root.deiconify()
-    g.showspecjt=2
-
-if(__name__==&quot;__main__&quot;):
-    root = Tk()
-else:
-    root=Toplevel()
-    root.protocol('WM_DELETE_WINDOW',hidespecjt)
-    
-root.withdraw()
-
-#-------------------------------------------  Define globals and initialize.
-b0=0
-c0=0
-g0=0
-g.cmap=&quot;Linrad&quot;
-g.cmap0=&quot;Linrad&quot;
-bw=96.0
-df=2.69165
-fcenter0=0.
-fmid=1500
-fmid0=1500
-frange=2000
-frange0=2000
-isec0=-99
-mode0=&quot;&quot;
-mousedf0=0
-mousefqso0=0
-dftolerance0=500
-naxis=IntVar()
-ncall=0
-newMinute=0
-nflat=IntVar()
-nfr=IntVar()
-nfr.set(1)
-nfreeze0=0
-nmark=IntVar()
-nmark0=0
-nn=0
-npal=IntVar()
-npal.set(2)
-nscroll=0
-nspeed0=IntVar()
-root_geom=&quot;&quot;
-t0=&quot;&quot;
-tol0=400
-ttot=0.0
-
-c=Canvas()
-NX=750
-NY=130
-a=zeros(NX*NY,'s')
-#a=numpy.zeros(NX*NY,numpy.int16)
-im=Image.new('P',(NX,NY))
-line0=Image.new('P',(NX,1))  #Image fragment for top line of waterfall
-draw=ImageDraw.Draw(im)
-pim=ImageTk.PhotoImage(im)
-
-a2=zeros(NX*NY,'s')
-#a2=numpy.zeros(NX*NY,numpy.int16)
-im2=Image.new('P',(NX,NY))
-line02=Image.new('P',(NX,1)) #Image fragment for top line of zoomed waterfall
-draw2=ImageDraw.Draw(im2)
-pim2=ImageTk.PhotoImage(im2)
-balloon=Pmw.Balloon(root)
-
-def pal_gray0():
-    g.cmap=&quot;gray0&quot;
-    im.putpalette(Colormap2Palette(colormapgray0),&quot;RGB&quot;)
-    im2.putpalette(Colormap2Palette(colormapgray0),&quot;RGB&quot;)
-def pal_gray1():
-    g.cmap=&quot;gray1&quot;
-    im.putpalette(Colormap2Palette(colormapgray1),&quot;RGB&quot;)
-    im2.putpalette(Colormap2Palette(colormapgray1),&quot;RGB&quot;)
-def pal_linrad():
-    g.cmap=&quot;Linrad&quot;
-    im.putpalette(Colormap2Palette(colormapLinrad),&quot;RGB&quot;)
-    im2.putpalette(Colormap2Palette(colormapLinrad),&quot;RGB&quot;)
-def pal_blue():
-    g.cmap=&quot;blue&quot;
-    im.putpalette(Colormap2Palette(colormapblue),&quot;RGB&quot;)
-    im2.putpalette(Colormap2Palette(colormapblue),&quot;RGB&quot;)
-def pal_Hot():
-    g.cmap=&quot;Hot&quot;
-    im.putpalette(Colormap2Palette(colormapHot),&quot;RGB&quot;)
-    im2.putpalette(Colormap2Palette(colormapHot),&quot;RGB&quot;)
-def pal_AFMHot():
-    g.cmap=&quot;AFMHot&quot;
-    im.putpalette(Colormap2Palette(colormapAFMHot),&quot;RGB&quot;)
-    im2.putpalette(Colormap2Palette(colormapAFMHot),&quot;RGB&quot;)
-
-#--------------------------------------------------- Command button routines
-
-#---------------------------------------------------- fdf_change
-# Readout of graphical cursor location
-def fdf_change(event):
-    global bw
-    m=int(1000.0*Audio.gcom2.fcenter) % 1000 - 125
-    fmid=0.5*float(Audio.gcom2.nfa + Audio.gcom2.nfb) + m
-    df=bw/NX                                   #kHz per pixel
-    g.Freq=df*(event.x-375) + fmid
-    n=int(g.Freq+0.5)
-    t=&quot;%d&quot; % (n,)
-    if g.fc[n] != &quot;&quot;:
-        t=t + &quot;:  &quot; + g.fc[n]
-    fdf.configure(text=t)
-
-def fdf_change2(event):
-    g.DFreq=(2200.0/750.0)*(event.x-375)
-
-#---------------------------------------------------- set_fqso
-def set_fqso(event):
-    n=int(g.Freq + 0.5)
-    Audio.gcom2.mousefqso=n
-    df_mark()
-
-#---------------------------------------------------- set_freezedf
-def set_freezedf(event):
-    n=int(g.DFreq + 0.5)
-    Audio.gcom2.mousedf=n
-    df_mark()
-
-#------------------------------------------------------ ftnstr
-def ftnstr(x):
-    y=&quot;&quot;
-    for i in range(len(x)):
-        y=y+x[i]
-    return y
-
-#---------------------------------------------------- df_mark
-def df_mark():
-    global bw
-    draw_axis()
-# Mark QSO freq in top graph
-    color='green'
-    m=int(1000.0*Audio.gcom2.fcenter) % 1000 - 125
-    fmid=0.5*float(Audio.gcom2.nfa + Audio.gcom2.nfb) + m
-    df=bw/NX                                #kHz per pixel
-    x1=375.0 + (Audio.gcom2.mousefqso-fmid)/df    
-    c.create_line(x1,25,x1,12,fill=color,width=2)
-    df=96000.0/32768.0
-# Mark sync tone and top JT65 tone (green) and shorthand tones (red)
-    fstep=20.0*11025.0/4096.0
-    x1=375.0 + (Audio.gcom2.mousedf + 6.6*fstep)/df
-    c2.create_line(x1,25,x1,12,fill=color,width=2)
-    x1=375.0 + (Audio.gcom2.mousedf - Audio.gcom2.dftolerance)/df
-    x2=375.0 + (Audio.gcom2.mousedf + Audio.gcom2.dftolerance)/df
-    c2.create_line(x1,25,x2,25,fill=color,width=2)
-    for i in range(5):
-        x1=375.0 + (Audio.gcom2.mousedf + i*fstep)/df
-        j=12
-        if i&gt;0: j=15
-        if i!=1: c2.create_line(x1,25,x1,j,fill=color,width=2)
-        color='red'
-
-#-------------------------------------------------------- draw_axis
-def draw_axis():
-    c.delete(ALL)
-    xdf=bw/NX                                   #kHz per pixel
-    xmid=0.5*float(Audio.gcom2.nfb + Audio.gcom2.nfa)
-    x1=int(xmid-0.6*bw)                         #Make it too wide, to be
-    x2=int(xmid+0.6*bw)                         #sure to get all the numbers
-    ixadd=(int(1000.0*Audio.gcom2.fcenter) % 1000) - 125
-    ilab=10
-    if bw &lt;= 60.0: ilab=5
-    if bw &lt;= 30.0: ilab=2
-    for ix in range(x1,x2,1):
-        i=0.5*NX + (ix-xmid)/xdf
-        j=20
-        k=int(ix+ixadd+10000.5)%1000
-        if (k%5)==0: j=16
-        if (k%ilab)==0 :
-            j=16
-            x=i-1
-            if k&lt;100: x=x+1
-            y=8
-            c.create_text(x,y,text=str(k))
-        c.create_line(i,25,i,j,fill='black')     #Draw the upper scale
-            
-    c2.delete(ALL)
-    xmid2=0
-    bw2=750.0*96000.0/32768.0                     #approx 2197.27 Hz
-    x1=int(xmid-0.5*bw2)/100 - 1
-    x1=100*x1
-    x2=int(xmid+0.5*bw2)
-    xdf2=bw2/NX
-    for ix in range(x1,x2,20):
-        i=0.5*NX + (ix-xmid2)/xdf2
-        j=20
-#        if (ix%5)==0: j=16
-        if (ix%100)==0 :
-            j=16
-            x=i-1
-            if ix&lt;1000: x=x+2
-            if ix&lt;0: x=x-2
-            y=8
-            c2.create_text(x,y,text=str(ix))
-        c2.create_line(i,25,i,j,fill='black')
-
-#---------------------------------------------------- freq_range
-def freq_range(event):
-# Move frequency scale left or right in 100 Hz increments
-    global fmid
-    if event.num==1:
-        fmid=fmid+100
-    else:
-        if event.num==3:
-            fmid=fmid-100
-    if fmid&lt;1000*nfr.get(): fmid=1000*nfr.get()
-    if fmid&gt;5000-1000*nfr.get(): fmid=5000-1000*nfr.get()
-
-#---------------------------------------------------- freeze_decode1
-def freeze_decode1(event):
-# If decoder is busy, ignore request
-    if Audio.gcom2.ndecoding==0:
-        set_fqso(event)
-        g.freeze_decode=1
-
-#---------------------------------------------------- freeze_decode2
-def freeze_decode2(event):
-# If decoder is busy or we are not monitoring, ignore request
-    if Audio.gcom2.ndecoding==0 or Audio.gcom2.monitoring==0:
-        set_freezedf(event)
-        g.freeze_decode=2
-
-#---------------------------------------------------- update
-def update():
-    global a,a2,b0,c0,g0,im,im2,isec0,line0,line02,newMinute,\
-           nscroll,pim,pim2,nfa0,nfb0,bw, \
-           root_geom,t0,mousedf0,mousefqso0,nfreeze0,tol0,mode0,nmark0, \
-           fmid,fmid0,frange,frange0,dftolerance0,fcenter0
-    
-    utc=time.gmtime(time.time()+0.1*Audio.gcom1.ndsec)
-    isec=utc[5]
-
-    if isec != isec0:                           #Do once per second
-        isec0=isec
-        t0=time.strftime('%H:%M:%S',utc)
-        ltime.configure(text=t0)
-        root_geom=root.geometry()
-        g.rms=Audio.gcom1.rms
-        if isec==0: nscroll=0
-        if isec==59: newMinute=1
-
-    nbpp=int((Audio.gcom2.nfb - Audio.gcom2.nfa)*32768/(96.0*NX))
-    bw=750.0*(96.0/32768.0)*nbpp
-
-    if g.showspecjt==1:
-        showspecjt()
-    nspeed=nspeed0.get()                        #Waterfall update rate
-    brightness=sc1.get()
-    contrast=sc2.get()
-    g0=sc3.get()
-
-    newspec=Audio.gcom2.newspec                   #True if new data available
-    if newspec or brightness != b0 or contrast != c0 or g.cmap != g.cmap0:
-        Audio.spec(brightness,contrast,g0,nspeed,a,a2) #Call Fortran routine spec
-        n=Audio.gcom2.nlines
-        box=(0,0,NX,130-n)                  #Define region
-        region=im.crop(box)                 #Get all but last line(s)
-        region2=im2.crop(box)               #Get all but last line(s)
-        box=(125,0,624,120)
-        try:
-            if newspec==1:
-                im.paste(region,(0,n))      #Move waterfall down
-                im2.paste(region2,(0,n))        #Move waterfall down
-        except:
-            print &quot;Images did not match, continuing anyway.&quot;
-        for i in range(n):
-            line0.putdata(a[NX*i:NX*(i+1)]) #One row of pixels to line0
-            im.paste(line0,(0,i))           #Paste in new top line(s)
-            line02.putdata(a2[NX*i:NX*(i+1)])#One row of pixels to line0
-            im2.paste(line02,(0,i))         #Paste in new top line(s)
-        nscroll=nscroll+n
-
-    if newspec:
-        if Audio.gcom2.monitoring:
-            if newMinute:
-                draw.line((0,0,749,0),fill=128)     #Draw the minute separator
-                draw2.line((0,0,749,0),fill=128)    #Draw the minute separator
-#            if nscroll == 13:
-#                draw.text((5,2),t0[0:5],fill=253)   #Insert time label
-#                draw2.text((5,2),t0[0:5],fill=253)  #Insert time label
-        else:
-            draw.line((0,0,749,0),fill=128)     #Draw the minute separator
-            draw2.line((0,0,749,0),fill=128)    #Draw the minute separator
-
-        t=g.ftnstr(Audio.gcom2.utcdata)
-
-# This test shouldn.t be needed, but ...
-        try:
-            draw.text((4,1),t[0:5],fill=253)   #Insert time label
-            draw2.text((4,1),t[0:5],fill=253)  #Insert time label
-        except:
-            pass
-
-    if newspec or brightness != b0 or contrast != c0 or g.cmap != g.cmap0:
-        pim=ImageTk.PhotoImage(im)              #Convert Image to PhotoImage
-        graph1.delete(ALL)
-        pim2=ImageTk.PhotoImage(im2)            #Convert Image to PhotoImage
-        graph2.delete(ALL)
-        #For some reason, top two lines are invisible, so we move down 2
-        graph1.create_image(0,0+2,anchor='nw',image=pim)
-        graph2.create_image(0,0+2,anchor='nw',image=pim2)        
-        g.ndecphase=2
-        newMinute=0
-        Audio.gcom2.newspec=0
-        b0=brightness                           #Save scale values
-        c0=contrast
-        g.cmap0=g.cmap
-
-    if Audio.gcom2.nfreeze != nfreeze0:
-        if not Audio.gcom2.nfreeze: draw_axis()
-        if Audio.gcom2.nfreeze: df_mark()
-        nfreeze0=int(Audio.gcom2.nfreeze)
-
-    if Audio.gcom2.fcenter!=fcenter0:
-        draw_axis()
-        fcenter0=float(Audio.gcom2.fcenter)
-
-    if (Audio.gcom2.mousedf != mousedf0 or
-            Audio.gcom2.mousefqso != mousefqso0 or
-            Audio.gcom2.dftolerance != dftolerance0 or
-            Audio.gcom2.nfa != nfa0 or Audio.gcom2.nfb != nfb0): 
-        df_mark()
-# The following int() calls are to ensure that the values copied to
-# mousedf0 and mousefqso0 are static.
-        mousedf0=int(Audio.gcom2.mousedf)
-        mousefqso0=int(Audio.gcom2.mousefqso)
-        dftolerance0=int(Audio.gcom2.dftolerance)
-        nfa0=int(Audio.gcom2.nfa)
-        nfb0=int(Audio.gcom2.nfb)
-
-    if g.mode!=mode0:
-        df_mark()                        ### was draw_axis()
-        mode0=g.mode
-
-    if nmark.get()!=nmark0:
-        df_mark()
-        nmark0=nmark.get()
-
-#    if newspec: Audio.gcom2.ndiskdat=0
-    Audio.gcom2.nlines=0
-    Audio.gcom2.nflat=nflat.get()
-
-    frange=nfr.get()*2000
-    if(fmid&lt;&gt;fmid0 or frange&lt;&gt;frange0):
-        if fmid&lt;1000*nfr.get(): fmid=1000*nfr.get()
-        if fmid&gt;5000-1000*nfr.get(): fmid=5000-1000*nfr.get()
-        df_mark()
-        fmid0=fmid
-        frange0=frange
-    Audio.gcom2.nfmid=int(fmid)
-    Audio.gcom2.nfrange=int(frange)
-
-    ltime.after(200,update)                      #Reset the timer
-
-#-------------------------------------------------------- Create GUI widgets
-
-#-------------------------------------------------------- Menu bar
-frame = Frame(root)
-frame.pack()
-
-mbar = Frame(frame)
-mbar.pack(fill=X)
-
-#--------------------------------------------------------- Palette menu
-setupbutton = Menubutton(mbar, text = 'Palette', )
-setupbutton.pack(side = LEFT)
-setupmenu = Menu(setupbutton,tearoff=0)
-setupbutton['menu'] = setupmenu
-setupmenu.add_radiobutton(label='Gray0',command=pal_gray0,
-            value=0,variable=npal)
-setupmenu.add_radiobutton(label='Gray1',command=pal_gray1,
-            value=1,variable=npal)
-setupmenu.add_radiobutton(label='Linrad',command=pal_linrad,
-            value=2,variable=npal)
-setupmenu.add_radiobutton(label='Blue',command=pal_blue,
-            value=3,variable=npal)
-setupmenu.add_radiobutton(label='Hot',command=pal_Hot,
-            value=4,variable=npal)
-setupmenu.add_radiobutton(label='AFMHot',command=pal_AFMHot,
-            value=5,variable=npal)
-
-lab1=Label(mbar,width=20,padx=20,bd=0)
-lab1.pack(side=LEFT)
-fdf=Label(mbar,width=30,bd=0,anchor=W)
-fdf.pack(side=LEFT)
-lab3=Label(mbar,padx=13,bd=0)
-lab3.pack(side=LEFT)
-lab0=Label(mbar,padx=10,bd=0)
-lab0.pack(side=LEFT)
-
-#------------------------------------------------- Speed selection buttons
-for i in (5, 4, 3, 2, 1):
-    t=str(i)
-    Radiobutton(mbar,text=t,value=i,variable=nspeed0).pack(side=RIGHT)
-nspeed0.set(1)
-lab2=Label(mbar,text='Speed: ',bd=0)
-lab2.pack(side=RIGHT)
-#------------------------------------------------- Graphics frame
-iframe1 = Frame(frame, bd=1, relief=SUNKEN)
-c=Canvas(iframe1, bg='white', width=NX, height=25,bd=0)
-c.pack(side=TOP)
-Widget.bind(c,&quot;&lt;Shift-Button-1&gt;&quot;,freq_range)
-Widget.bind(c,&quot;&lt;Shift-Button-2&gt;&quot;,freq_range)
-Widget.bind(c,&quot;&lt;Shift-Button-3&gt;&quot;,freq_range)
-
-graph1=Canvas(iframe1, bg='black', width=NX, height=NY,bd=0,cursor='crosshair')
-graph1.pack(side=TOP)
-Widget.bind(graph1,&quot;&lt;Motion&gt;&quot;,fdf_change)
-Widget.bind(graph1,&quot;&lt;Button-1&gt;&quot;,set_fqso)
-Widget.bind(graph1,&quot;&lt;Double-Button-1&gt;&quot;,freeze_decode1)
-iframe1.pack(expand=1, fill=X)
-
-c2=Canvas(iframe1, bg='white', width=NX, height=25,bd=0)
-c2.pack(side=TOP)
-Widget.bind(c2,&quot;&lt;Shift-Button-1&gt;&quot;,freq_range)
-Widget.bind(c2,&quot;&lt;Shift-Button-2&gt;&quot;,freq_range)
-Widget.bind(c2,&quot;&lt;Shift-Button-3&gt;&quot;,freq_range)
-
-graph2=Canvas(iframe1, bg='black', width=NX, height=NY,bd=0,cursor='crosshair')
-graph2.pack(side=TOP)
-Widget.bind(graph2,&quot;&lt;Motion&gt;&quot;,fdf_change2)
-Widget.bind(graph2,&quot;&lt;Button-1&gt;&quot;,set_freezedf)
-Widget.bind(graph2,&quot;&lt;Double-Button-1&gt;&quot;,freeze_decode2)
-iframe1.pack(expand=1, fill=X)
-
-
-#-------------------------------------------------- Status frame
-iframe2 = Frame(frame, bd=1, relief=SUNKEN)
-status=Pmw.MessageBar(iframe2,entry_width=17,entry_relief=GROOVE)
-status.pack(side=LEFT)
-sc1=Scale(iframe2,from_=-100.0,to_=100.0,orient='horizontal',
-    showvalue=0,sliderlength=5)
-sc1.pack(side=LEFT)
-sc2=Scale(iframe2,from_=-100.0,to_=100.0,orient='horizontal',
-    showvalue=0,sliderlength=5)
-sc2.pack(side=LEFT)
-balloon.bind(sc1,&quot;Brightness&quot;, &quot;Brightness&quot;)
-balloon.bind(sc2,&quot;Contrast&quot;, &quot;Contrast&quot;)
-balloon.configure(statuscommand=status.helpmessage)
-ltime=Label(iframe2,bg='black',fg='yellow',width=8,bd=2,font=('Helvetica',16))
-ltime.pack(side=LEFT)
-msg1=Label(iframe2,padx=2,bd=2,text=&quot; &quot;)
-msg1.pack(side=LEFT)
-sc3=Scale(iframe2,from_=-100.0,to_=100.0,orient='horizontal',
-    showvalue=0,sliderlength=5)
-sc3.pack(side=LEFT)
-balloon.bind(sc3,&quot;Gain&quot;, &quot;Digital Gain&quot;)
-iframe2.pack(expand=1, fill=X)
-
-#----------------------------------------------- Restore params from INI file
-try:
-    f=open('MAP65.INI',mode='r')
-    params=f.readlines()
-except:
-    params=&quot;&quot;
-
-try:
-    for i in range(len(params)):
-        key,value=params[i].split()
-        if   key == 'SpecJTGeometry': root.geometry(value)
-        elif key == 'UpdateInterval': nspeed0.set(value)
-        elif key == 'Brightness':
-            sc1.set(value)
-            b0=sc1.get()
-        elif key == 'Contrast':
-            sc2.set(value)
-            c0=sc2.get()
-        elif key == 'DigitalGain': sc3.set(value)
-        elif key == 'AxisLabel': naxis.set(value)
-        elif key == 'MarkTones': nmark.set(value)
-        elif key == 'Flatten': nflat.set(value)
-        elif key == 'Palette':
-            g.cmap=value
-            g.cmap0=value
-        elif key == 'Frange': nfr.set(value)
-        elif key == 'Fmid': fmid=int(value)
-        else: pass
-except:
-    print 'Error reading MAP65.INI, continuing with defaults.'
-    print key,value
-        
-#------------------------------------------------------  Select palette
-if g.cmap == &quot;gray0&quot;:
-    pal_gray0()
-    npal.set(0)
-if g.cmap == &quot;gray1&quot;:
-    pal_gray1()
-    npal.set(1)
-if g.cmap == &quot;Linrad&quot;:
-    pal_linrad()
-    npal.set(2)
-if g.cmap == &quot;blue&quot;:
-    pal_blue()
-    npal.set(3)
-if g.cmap == &quot;Hot&quot;:
-    pal_Hot()
-    npal.set(4)
-if g.cmap == &quot;AFMHot&quot;:
-    pal_AFMHot()
-    npal.set(5)
-
-#---------------------------------------------- Display GUI and start mainloop
-#draw_axis()
-df_mark()
-
-try:
-    ndevin=g.ndevin.get()
-except:
-    ndevin=0
-Audio.gcom1.ndevin=ndevin
-
-try:
-    ndevout=g.ndevout.get()
-except:
-    ndevout=0
-Audio.gcom1.ndevout=ndevout
-						# Only valid for windows
-                                                # for now
-Audio.audio_init(ndevin,ndevout)                #Start the audio stream
-
-ltime.after(200,update)
-
-root.deiconify()
-g.showspecjt=2
-if g.Win32: root.iconbitmap(&quot;wsjt.ico&quot;)
-root.title('Waterfall')
-if(__name__==&quot;__main__&quot;):
-    Audio.gcom2.monitoring=1
-root.mainloop()
-
-#-------------------------------------------------- Save user params and quit
-f=open('MAP65.INI',mode='w')
-f.write(&quot;UpdateInterval &quot; + str(nspeed0.get()) + &quot;\n&quot;)
-f.write(&quot;Brightness &quot; + str(b0)+ &quot;\n&quot;)
-f.write(&quot;Contrast &quot; + str(c0)+ &quot;\n&quot;)
-f.write(&quot;DigitalGain &quot; + str(g0)+ &quot;\n&quot;)
-f.write(&quot;AxisLabel &quot; + str(naxis.get()) + &quot;\n&quot;)
-f.write(&quot;MarkTones &quot; + str(nmark.get()) + &quot;\n&quot;)
-f.write(&quot;Flatten &quot; + str(nflat.get()) + &quot;\n&quot;)
-f.write(&quot;Palette &quot; + g.cmap + &quot;\n&quot;)
-f.write(&quot;Frange &quot; + str(nfr.get()) + &quot;\n&quot;)
-f.write(&quot;Fmid &quot; + str(fmid) + &quot;\n&quot;)
-root_geom=root_geom[root_geom.index(&quot;+&quot;):]
-f.write(&quot;SpecJTGeometry &quot; + root_geom + &quot;\n&quot;)
-f.close()
-

Added: branches/map65/ss.bat
===================================================================
--- branches/map65/ss.bat	                        (rev 0)
+++ branches/map65/ss.bat	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1 @@
+svn status | grep -v '?'

Deleted: branches/map65/ssort.f
===================================================================
--- branches/map65/ssort.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/ssort.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,287 +0,0 @@
-      subroutine ssort (x,y,n,kflag)
-c***purpose  sort an array and optionally make the same interchanges in
-c            an auxiliary array.  the array may be sorted in increasing
-c            or decreasing order.  a slightly modified quicksort
-c            algorithm is used.
-c
-c   ssort sorts array x and optionally makes the same interchanges in
-c   array y.  the array x may be sorted in increasing order or
-c   decreasing order.  a slightly modified quicksort algorithm is used.
-c
-c   description of parameters
-c      x - array of values to be sorted
-c      y - array to be (optionally) carried along
-c      n - number of values in array x to be sorted
-c      kflag - control parameter
-c            =  2  means sort x in increasing order and carry y along.
-c            =  1  means sort x in increasing order (ignoring y)
-c            = -1  means sort x in decreasing order (ignoring y)
-c            = -2  means sort x in decreasing order and carry y along.
-
-      integer kflag, n
-!      real x(n), y(n)
-!      real r, t, tt, tty, ty
-      integer x(n), y(n)
-      integer r, t, tt, tty, ty
-      integer i, ij, j, k, kk, l, m, nn
-      integer il(21), iu(21)
-
-      nn = n
-      if (nn .lt. 1) then
-!         print*,'ssort: The number of sort elements is not positive.'
-!         print*,'ssort: n = ',nn,'   kflag = ',kflag
-         return
-      endif
-c
-      kk = abs(kflag)
-      if (kk.ne.1 .and. kk.ne.2) then
-         print *,
-     +      'the sort control parameter, k, is not 2, 1, -1, or -2.'
-         return
-      endif
-c
-c     alter array x to get decreasing order if needed
-c
-      if (kflag .le. -1) then
-         do 10 i=1,nn
-            x(i) = -x(i)
-   10    continue
-      endif
-c
-      if (kk .eq. 2) go to 100
-c
-c     sort x only
-c
-      m = 1
-      i = 1
-      j = nn
-      r = 0.375e0
-c
-   20 if (i .eq. j) go to 60
-      if (r .le. 0.5898437e0) then
-         r = r+3.90625e-2
-      else
-         r = r-0.21875e0
-      endif
-c
-   30 k = i
-c
-c     select a central element of the array and save it in location t
-c
-      ij = i + int((j-i)*r)
-      t = x(ij)
-c
-c     if first element of array is greater than t, interchange with t
-c
-      if (x(i) .gt. t) then
-         x(ij) = x(i)
-         x(i) = t
-         t = x(ij)
-      endif
-      l = j
-c
-c     if last element of array is less than than t, interchange with t
-c
-      if (x(j) .lt. t) then
-         x(ij) = x(j)
-         x(j) = t
-         t = x(ij)
-c
-c        if first element of array is greater than t, interchange with t
-c
-         if (x(i) .gt. t) then
-            x(ij) = x(i)
-            x(i) = t
-            t = x(ij)
-         endif
-      endif
-c
-c     find an element in the second half of the array which is smaller
-c     than t
-c
-   40 l = l-1
-      if (x(l) .gt. t) go to 40
-c
-c     find an element in the first half of the array which is greater
-c     than t
-c
-   50 k = k+1
-      if (x(k) .lt. t) go to 50
-c
-c     interchange these elements
-c
-      if (k .le. l) then
-         tt = x(l)
-         x(l) = x(k)
-         x(k) = tt
-         go to 40
-      endif
-c
-c     save upper and lower subscripts of the array yet to be sorted
-c
-      if (l-i .gt. j-k) then
-         il(m) = i
-         iu(m) = l
-         i = k
-         m = m+1
-      else
-         il(m) = k
-         iu(m) = j
-         j = l
-         m = m+1
-      endif
-      go to 70
-c
-c     begin again on another portion of the unsorted array
-c
-   60 m = m-1
-      if (m .eq. 0) go to 190
-      i = il(m)
-      j = iu(m)
-c
-   70 if (j-i .ge. 1) go to 30
-      if (i .eq. 1) go to 20
-      i = i-1
-c
-   80 i = i+1
-      if (i .eq. j) go to 60
-      t = x(i+1)
-      if (x(i) .le. t) go to 80
-      k = i
-c
-   90 x(k+1) = x(k)
-      k = k-1
-      if (t .lt. x(k)) go to 90
-      x(k+1) = t
-      go to 80
-c
-c     sort x and carry y along
-c
-  100 m = 1
-      i = 1
-      j = nn
-      r = 0.375e0
-c
-  110 if (i .eq. j) go to 150
-      if (r .le. 0.5898437e0) then
-         r = r+3.90625e-2
-      else
-         r = r-0.21875e0
-      endif
-c
-  120 k = i
-c
-c     select a central element of the array and save it in location t
-c
-      ij = i + int((j-i)*r)
-      t = x(ij)
-      ty = y(ij)
-c
-c     if first element of array is greater than t, interchange with t
-c
-      if (x(i) .gt. t) then
-         x(ij) = x(i)
-         x(i) = t
-         t = x(ij)
-         y(ij) = y(i)
-         y(i) = ty
-         ty = y(ij)
-      endif
-      l = j
-c
-c     if last element of array is less than t, interchange with t
-c
-      if (x(j) .lt. t) then
-         x(ij) = x(j)
-         x(j) = t
-         t = x(ij)
-         y(ij) = y(j)
-         y(j) = ty
-         ty = y(ij)
-c
-c        if first element of array is greater than t, interchange with t
-c
-         if (x(i) .gt. t) then
-            x(ij) = x(i)
-            x(i) = t
-            t = x(ij)
-            y(ij) = y(i)
-            y(i) = ty
-            ty = y(ij)
-         endif
-      endif
-c
-c     find an element in the second half of the array which is smaller
-c     than t
-c
-  130 l = l-1
-      if (x(l) .gt. t) go to 130
-c
-c     find an element in the first half of the array which is greater
-c     than t
-c
-  140 k = k+1
-      if (x(k) .lt. t) go to 140
-c
-c     interchange these elements
-c
-      if (k .le. l) then
-         tt = x(l)
-         x(l) = x(k)
-         x(k) = tt
-         tty = y(l)
-         y(l) = y(k)
-         y(k) = tty
-         go to 130
-      endif
-c
-c     save upper and lower subscripts of the array yet to be sorted
-c
-      if (l-i .gt. j-k) then
-         il(m) = i
-         iu(m) = l
-         i = k
-         m = m+1
-      else
-         il(m) = k
-         iu(m) = j
-         j = l
-         m = m+1
-      endif
-      go to 160
-c
-c     begin again on another portion of the unsorted array
-c
-  150 m = m-1
-      if (m .eq. 0) go to 190
-      i = il(m)
-      j = iu(m)
-c
-  160 if (j-i .ge. 1) go to 120
-      if (i .eq. 1) go to 110
-      i = i-1
-c
-  170 i = i+1
-      if (i .eq. j) go to 150
-      t = x(i+1)
-      ty = y(i+1)
-      if (x(i) .le. t) go to 170
-      k = i
-c
-  180 x(k+1) = x(k)
-      y(k+1) = y(k)
-      k = k-1
-      if (t .lt. x(k)) go to 180
-      x(k+1) = t
-      y(k+1) = ty
-      go to 170
-c
-c     clean up
-c
-  190 if (kflag .le. -1) then
-         do 200 i=1,nn
-            x(i) = -x(i)
-  200    continue
-      endif
-      return
-      end

Added: branches/map65/sss.bat
===================================================================
--- branches/map65/sss.bat	                        (rev 0)
+++ branches/map65/sss.bat	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1 @@
+svn status

Deleted: branches/map65/start_portaudio.c
===================================================================
--- branches/map65/start_portaudio.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/start_portaudio.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,30 +0,0 @@
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;pthread.h&gt;
-#include &lt;inttypes.h&gt;
-#include &lt;time.h&gt;
-#include &lt;sys/time.h&gt;
-
-extern void a2d_(int *iarg);
-extern void decode1_(int *iarg);
-extern void recvpkt_(int *iarg);
-
-int start_threads_(int *ndevin, int *ndevout, short y1[], short y2[],
-	int *nbuflen, int *iwrite, short iwave[],
-	int *nwave, int *nfsample, int *nsamperbuf,
-	int *TRPeriod, int *TxOK, int *ndebug,
-	int *Transmitting, double *Tsec, int *ngo, int *nmode,
-	double tbuf[], int *ibuf, int *ndsec)
-{
-  pthread_t thread1,thread2,thread3;
-  int iret1,iret2,iret3;
-  int iarg1=1, iarg2=2, iarg3=3;
-
-  iret1 = pthread_create(&amp;thread1,NULL,
-			 (void *)a2d_,&amp;iarg1);
-  iret2 = pthread_create(&amp;thread2,NULL,
-			 (void *)decode1_,&amp;iarg2);
-  iret3 = pthread_create(&amp;thread3,NULL,
-			 (void *)recvpkt_,&amp;iarg3);
-  return(iret1 | iret2 | iret3);
-}

Deleted: branches/map65/sun.f
===================================================================
--- branches/map65/sun.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/sun.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,86 +0,0 @@
-      subroutine sun(y,m,DD,UT,lon,lat,RA,Dec,LST,Az,El,mjd)
-
-      implicit none
-
-      integer y                         !Year
-      integer m                         !Month
-      integer DD                        !Day
-      integer mjd                       !Modified Julian Date
-      real UT                           !UTC in hours
-      real RA,Dec                       !RA and Dec of sun
-
-C  NB: Double caps here are single caps in the writeup.
-
-C  Orbital elements of the Sun (also N=0, i=0, a=1):
-      real w                            !Argument of perihelion
-      real e                            !Eccentricity
-      real MM                           !Mean anomaly
-      real Ls                           !Mean longitude
-
-C  Other standard variables:
-      real v                            !True anomaly
-      real EE                           !Eccentric anomaly
-      real ecl                          !Obliquity of the ecliptic
-      real d                            !Ephemeris time argument in days
-      real r                            !Distance to sun, AU
-      real xv,yv                        !x and y coords in ecliptic
-      real lonsun                       !Ecliptic long and lat of sun
-C Ecliptic coords of sun (geocentric)
-      real xs,ys
-C Equatorial coords of sun (geocentric)
-      real xe,ye,ze
-      real lon,lat
-      real GMST0,LST,HA
-      real xx,yy,zz
-      real xhor,yhor,zhor
-      real Az,El
-
-      real rad
-      data rad/57.2957795/
-
-C  Time in days, with Jan 0, 2000 equal to 0.0:
-      d=367*y - 7*(y+(m+9)/12)/4 + 275*m/9 + DD - 730530 + UT/24.0
-      mjd=d + 51543
-      ecl = 23.4393 - 3.563e-7 * d
-
-C  Compute updated orbital elements for Sun:
-      w = 282.9404 + 4.70935e-5 * d
-      e = 0.016709 - 1.151e-9 * d
-      MM = mod(356.0470d0 + 0.9856002585d0 * d + 360000.d0,360.d0)
-      Ls = mod(w+MM+720.0,360.0)
-
-      EE = MM + e*rad*sin(MM/rad) * (1.0 + e*cos(M/rad))
-      EE = EE - (EE - e*rad*sin(EE/rad)-MM) / (1.0 - e*cos(EE/rad))
-
-      xv = cos(EE/rad) - e
-      yv = sqrt(1.0-e*e) * sin(EE/rad)
-      v = rad*atan2(yv,xv)
-      r = sqrt(xv*xv + yv*yv)
-      lonsun = mod(v + w + 720.0,360.0)
-C  Ecliptic coordinates of sun (rectangular):
-      xs = r * cos(lonsun/rad)
-      ys = r * sin(lonsun/rad)
-
-C  Equatorial coordinates of sun (rectangular):
-      xe = xs
-      ye = ys * cos(ecl/rad)
-      ze = ys * sin(ecl/rad)
-
-C  RA and Dec in degrees:
-      RA = rad*atan2(ye,xe)
-      Dec = rad*atan2(ze,sqrt(xe*xe + ye*ye))
-
-      GMST0 = (Ls + 180.0)/15.0
-      LST = mod(GMST0+UT+lon/15.0+48.0,24.0)    !LST in hours
-      HA = 15.0*LST - RA                        !HA in degrees
-      xx = cos(HA/rad)*cos(Dec/rad)
-      yy = sin(HA/rad)*cos(Dec/rad)
-      zz =             sin(Dec/rad)
-      xhor = xx*sin(lat/rad) - zz*cos(lat/rad)
-      yhor = yy
-      zhor = xx*cos(lat/rad) + zz*sin(lat/rad)
-      Az = mod(rad*atan2(yhor,xhor) + 180.0 + 360.0,360.0)
-      El = rad*asin(zhor)
-
-      return
-      end

Deleted: branches/map65/symspec.f90
===================================================================
--- branches/map65/symspec.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/symspec.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,173 +0,0 @@
-subroutine symspec(dd,kbuf,kk,kkdone,nutc,newdat)
-
-!  Compute spectra at four polarizations, using half-symbol steps.
-
-  parameter (NSMAX=60*96000)
-  real*4  dd(4,NSMAX,2)
-  complex z
-  real*8 ts,hsym
-  include 'spcom.f90'
-  include 'gcom2.f90'
-  complex cx(NFFT),cy(NFFT)               !  pad to 32k with zeros
-  data kbuf0/-999/,n/0/
-  save
-
-  kkk=kk
-  if(kbuf.eq.2) kkk=kk-5760000
-  fac=0.0002
-  hsym=2048.d0*96000.d0/11025.d0          !Samples per half symbol
-  npts=hsym                               !Integral samples per half symbol
-  ntot=322                                !Half symbols per transmission
-!  ntot=279                               !Half symbols in 51.8 sec
-
-  if(kbuf.ne.kbuf0 .or. ndiskdat.eq.1) then
-     kkdone=0
-     kbuf0=kbuf
-     ts=1.d0 - hsym
-     n=0
-     do ip=1,4
-        do i=1,NFFT
-           szavg(ip,i)=0.
-        enddo
-     enddo
-
-! Get baseline power level for this minute
-     n1=200                               !Block size (somewhat arbitrary)
-     n2=(kkk-kkdone)/n1                   !Number of blocks
-     k=0                                  !Starting place
-     sqq=0.
-     nsqq=0
-     do j=1,n2
-        sq=0.
-        do i=1,n1                         !Find power in each block
-           k=k+1
-           x1=dd(1,k,kbuf)
-           x2=dd(2,k,kbuf)
-           x3=dd(3,k,kbuf)
-           x4=dd(4,k,kbuf)
-           sq=sq + x1*x1 + x2*x2 + x3*x3 + x4*x4
-        enddo
-        if(sq.lt.n1*10000.) then          !Find power in good blocks
-           sqq=sqq+sq
-           nsqq=nsqq+1
-        endif
-     enddo
-     sqave=sqq/nsqq                       !Average power in good blocks
-     nclip=0
-     nz2=0
-  endif
-
-  if(nblank.ne.0) then
-! Apply final noise blanking
-     n2=(kkk-kkdone)/n1
-     k=kkdone
-     do j=1,n2
-        sq=0.
-        do i=1,n1
-           k=k+1
-           x1=dd(1,k,kbuf)
-           x2=dd(2,k,kbuf)
-           x3=dd(3,k,kbuf)
-           x4=dd(4,k,kbuf)
-           sq=sq + x1*x1 + x2*x2 + x3*x3 + x4*x4
-        enddo
-! If power in this block is excessive, blank it.
-        if(sq.gt.1.5*sqave) then
-           do i=k-n1+1,k
-              dd(1,i,kbuf)=0
-              dd(2,i,kbuf)=0
-              dd(3,i,kbuf)=0
-              dd(4,i,kbuf)=0
-           enddo
-           nclip=nclip+1
-        endif
-     enddo
-     nz2=nz2+n2
-     pctblank=nclip*100.0/nz2
-  else
-     pctblank=0.
-  endif
-
-  do nn=1,ntot
-     i0=ts+hsym                           !Starting sample pointer
-     if((i0+npts-1).gt.kkk) go to 998     !See if we have enough points
-     i1=ts+2*hsym                         !Next starting sample pointer
-     ts=ts+hsym                           !OK, update the exact sample pointer
-     do i=1,npts                          !Copy data to FFT arrays
-        xr=fac*dd(1,i0+i,kbuf)
-        xi=fac*dd(2,i0+i,kbuf)
-        cx(i)=cmplx(xr,xi)
-        yr=fac*dd(3,i0+i,kbuf)
-        yi=fac*dd(4,i0+i,kbuf)
-        cy(i)=cmplx(yr,yi)
-     enddo
-
-     do i=npts+1,NFFT                   !Pad to 32k with zeros
-        cx(i)=0.
-        cy(i)=0.
-     enddo
-
-     call four2a(cx,NFFT,1,1,1)         !Do the FFTs
-     call four2a(cy,NFFT,1,1,1)
-            
-     n=n+1
-     do i=1,NFFT                        !Save and accumulate power spectra
-        sx=real(cx(i))**2 + aimag(cx(i))**2
-        ssz(1,n,i)=sx                    ! Pol = 0
-        szavg(1,i)=szavg(1,i) + sx
-        
-        z=cx(i) + cy(i)
-        s45=0.5*(real(z)**2 + aimag(z)**2)
-        ssz(2,n,i)=s45                   ! Pol = 45
-        szavg(2,i)=szavg(2,i) + s45
-
-        sy=real(cy(i))**2 + aimag(cy(i))**2
-        ssz(3,n,i)=sy                    ! Pol = 90
-        szavg(3,i)=szavg(3,i) + sy
-
-        z=cx(i) - cy(i)
-        s135=0.5*(real(z)**2 + aimag(z)**2)
-        ssz(4,n,i)=s135                  ! Pol = 135
-        szavg(4,i)=szavg(4,i) + s135
-
-        z=cx(i)*conjg(cy(i))
-
-! Leif's formula:
-!            ss5(n,i)=0.5*(sx+sy) + (real(z)**2 + aimag(z)**2 -
-!     +          sx*sy)/(sx+sy)
-
-! Leif's suggestion:
-!            ss5(n,i)=max(sx,s45,sy,s135)
-
-! Linearly polarized component, from the Stokes parameters:
-        q=sx - sy
-        u=2.0*real(z)
-!            v=2.0*aimag(z)
-        ssz5(n,i)=0.707*sqrt(q*q + u*u)
-
-     enddo
-!         if(n.eq.ntot) then
-     if(n.ge.279) then
-        call move(ssz5,ss5,322*NFFT)
-        call cs_lock('symspec')
-        write(utcdata,1002) nutc
-1002    format(i4.4)
-        call cs_unlock
-        utcdata=utcdata(1:2)//':'//utcdata(3:4)
-        newspec=1
-        call move(ssz,ss,4*322*NFFT)
-        call move(szavg,savg,4*NFFT)
-        newdat=1
-        ndecoding=1
-        go to 999
-     endif
-     kkdone=i1-1
-     nhsym=n
-     call sleep_msec(0)
-  enddo
-
-998 kkdone=i1-1
-999 continue
-
-  return
-end subroutine symspec

Deleted: branches/map65/symsync65.f
===================================================================
--- branches/map65/symsync65.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/symsync65.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,35 +0,0 @@
-      subroutine symsync65(c5,n5,k0,s,flip,pr,kmax,kpk,ccf,smax)
-
-      complex c5(n5)
-      real s(n5),pr(126),ccf(-128:128)
-      complex z
-
-      z=0.
-      do i=1,32
-         z=z + c5(i)
-      enddo
-      s(1)=real(z)*real(z) + aimag(z)*aimag(z)
-      smax=s(1)
-      do i=33,n5
-         z=z + c5(i) - c5(i-32)
-         s(i-31)=real(z)*real(z) + aimag(z)*aimag(z)
-         smax=max(s(i-31),smax)
-      enddo
-      iz=n5-31
-
-      smax=0.
-      do k=-kmax,kmax
-         sum=0.
-         do i=1,126
-            j=32*(i-1)+k+k0
-            if(j.ge.1 .and. j.le.iz) sum=sum + flip*pr(i)*s(j)
-         enddo
-         ccf(k)=sum
-         if(sum.gt.smax) then
-            smax=sum
-            kpk=k
-         endif
-      enddo
-
-      return
-      end

Deleted: branches/map65/sysqqq.f90
===================================================================
--- branches/map65/sysqqq.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/sysqqq.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,13 +0,0 @@
-subroutine sysqqq(cmnd,iret)
-
-#ifdef CVF
-  use dfport
-#else
-  integer system
-#endif
-  character*(*) cmnd
-
-  iret=system(cmnd)
-
-  return
-end subroutine sysqqq

Deleted: branches/map65/thcvf.f90
===================================================================
--- branches/map65/thcvf.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/thcvf.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,68 +0,0 @@
-subroutine cs_init
-  use dfmt
-  type (RTL_CRITICAL_SECTION) ncrit1
-  character*12 csub0
-  integer*8 mtx
-  common/mtxcom/mtx,ltrace,mtxstate,csub0
-  ltrace=0
-  mtx=loc(ncrit1)
-  mtxstate=0
-  csub0='**unlocked**'
-  call InitializeCriticalSection(mtx)
-  return
-end subroutine cs_init
-
-subroutine cs_destroy
-  use dfmt
-  type (RTL_CRITICAL_SECTION) ncrit1
-  character*12 csub0
-  integer*8 mtx
-  common/mtxcom/mtx,ltrace,mtxstate,csub0
-  call DeleteCriticalSection(mtx)
-  return
-end subroutine cs_destroy
-
-subroutine th_create(sub)
-  use dfmt
-  external sub
-  ith=CreateThread(0,0,sub,0,0,id)
-  return
-end subroutine th_create
-
-subroutine th_exit
-  use dfmt
-  ncode=0
-  call ExitThread(ncode)
-  return
-end subroutine th_exit
-
-subroutine cs_lock(csub)
-  use dfmt
-  character*(*) csub
-  character*12 csub0
-  integer*8 mtx
-  common/mtxcom/mtx,ltrace,mtxstate,csub0
-  n=TryEnterCriticalSection(mtx)
-  if(n.eq.0) then
-! Another thread has already locked the mutex
-     call EnterCriticalSection(mtx)
-     iz=index(csub0,' ')
-     if(ltrace.ge.1) print*,'&quot;',csub,'&quot; requested the mutex when &quot;',  &amp;
-          csub0(:iz-1),'&quot; owned it.'
-  endif
-  mtxstate=1
-  csub0=csub
-  if(ltrace.ge.3) print*,'Mutex locked by ',csub
-  return
-end subroutine cs_lock
-
-subroutine cs_unlock
-  use dfmt
-  character*12 csub0
-  integer*8 mtx
-  common/mtxcom/mtx,ltrace,mtxstate,csub0
-  mtxstate=0
-  if(ltrace.ge.3) print*,'Mutex unlocked'
-  call LeaveCriticalSection(mtx)
-  return
-end subroutine cs_unlock

Deleted: branches/map65/thnix.f90
===================================================================
--- branches/map65/thnix.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/thnix.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,58 +0,0 @@
-subroutine cs_init
-  character*12 csub0
-  integer*8 mtx
-  common/mtxcom/mtx,ltrace,mtxstate,csub0
-  ltrace=0
-  mtxstate=0
-  csub0='**unlocked**'
-  call fthread_mutex_init(mtx)
-  return
-end subroutine cs_init
-
-subroutine cs_destroy
-  character*12 csub0
-  integer*8 mtx
-  common/mtxcom/mtx,ltrace,mtxstate,csub0
-  call fthread_mutex_destroy(mtx)
-  return
-end subroutine cs_destroy
-
-subroutine th_create(sub)
-  call fthread_create(sub,id)
-  return
-end subroutine th_create
-
-subroutine th_exit
-  call fthread_exit
-  return
-end subroutine th_exit
-
-subroutine cs_lock(csub)
-  character*(*) csub
-  character*12 csub0
-  integer fthread_mutex_lock,fthread_mutex_trylock
-  integer*8 mtx
-  common/mtxcom/mtx,ltrace,mtxstate,csub0
-  n=fthread_mutex_trylock(mtx)
-  if(n.ne.0) then
-! Another thread has already locked the mutex
-     n=fthread_mutex_lock(mtx)
-     iz=index(csub0,' ')
-     if(ltrace.ge.1) print*,'&quot;',csub,'&quot; requested mutex when &quot;',   &amp;
-          csub0(:iz-1),'&quot; owned it.'
-  endif
-  mtxstate=1
-  csub0=csub
-  if(ltrace.ge.3) print*,'Mutex locked by ',csub
-  return
-end subroutine cs_lock
-
-subroutine cs_unlock
-  character*12 csub0
-  integer*8 mtx
-  common/mtxcom/mtx,ltrace,mtxstate,csub0
-  if(ltrace.ge.3) print*,'Mutex unlocked,',ltrace,mtx,mtxstate,csub0
-  mtxstate=0
-  call fthread_mutex_unlock(mtx)
-  return
-end subroutine cs_unlock

Deleted: branches/map65/timeval.h
===================================================================
--- branches/map65/timeval.h	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/timeval.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,74 +0,0 @@
-/*
- * timeval.h    1.0 01/12/19
- *
- * Defines gettimeofday, timeval, etc. for Win32
- *
- * By Wu Yongwei
- *
- */
-
-#ifndef _TIMEVAL_H
-#define _TIMEVAL_H
-
-#ifdef _WIN32
-
-#define WIN32_LEAN_AND_MEAN
-#include &lt;windows.h&gt;
-#include &lt;time.h&gt;
-
-#ifndef __GNUC__
-#define EPOCHFILETIME (116444736000000000i64)
-#else
-#define EPOCHFILETIME (116444736000000000LL)
-#endif
-
-//struct timeval {
-//    long tv_sec;        /* seconds */
-//    long tv_usec;  /* microseconds */
-//};
-
-struct timezone {
-    int tz_minuteswest; /* minutes W of Greenwich */
-    int tz_dsttime;     /* type of dst correction */
-};
-
-__inline int gettimeofday(struct timeval *tv, struct timezone *tz)
-{
-    FILETIME        ft;
-    LARGE_INTEGER   li;
-    __int64         t;
-    static int      tzflag;
-
-    if (tv)
-    {
-        GetSystemTimeAsFileTime(&amp;ft);
-        li.LowPart  = ft.dwLowDateTime;
-        li.HighPart = ft.dwHighDateTime;
-        t  = li.QuadPart;       /* In 100-nanosecond intervals */
-        t -= EPOCHFILETIME;     /* Offset to the Epoch time */
-        t /= 10;                /* In microseconds */
-        tv-&gt;tv_sec  = (long)(t / 1000000);
-        tv-&gt;tv_usec = (long)(t % 1000000);
-    }
-
-    if (tz)
-    {
-        if (!tzflag)
-        {
-            _tzset();
-            tzflag++;
-        }
-        tz-&gt;tz_minuteswest = _timezone / 60;
-        tz-&gt;tz_dsttime = _daylight;
-    }
-
-    return 0;
-}
-
-#else  /* _WIN32 */
-
-#include &lt;sys/time.h&gt;
-
-#endif /* _WIN32 */
-
-#endif /* _TIMEVAL_H */

Deleted: branches/map65/toxyz.f
===================================================================
--- branches/map65/toxyz.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/toxyz.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,25 +0,0 @@
-      subroutine toxyz(alpha,delta,r,vec)
-
-      implicit real*8 (a-h,o-z)
-      real*8 vec(3)
-
-      vec(1)=r*cos(delta)*cos(alpha)
-      vec(2)=r*cos(delta)*sin(alpha)
-      vec(3)=r*sin(delta)
-
-      return
-      end
-
-      subroutine fromxyz(vec,alpha,delta,r)
-
-      implicit real*8 (a-h,o-z)
-      real*8 vec(3)
-      data twopi/6.283185307d0/
-
-      r=sqrt(vec(1)**2 + vec(2)**2 + vec(3)**2)
-      alpha=atan2(vec(2),vec(1))
-      if(alpha.lt.0.d0) alpha=alpha+twopi
-      delta=asin(vec(3)/r)
-
-      return
-      end

Deleted: branches/map65/trimlist.f
===================================================================
--- branches/map65/trimlist.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/trimlist.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,29 +0,0 @@
-      subroutine trimlist(sig,kk,indx,nsiz,nz)
-
-      parameter (MAXMSG=1000)             !Size of decoded message list
-      real sig(MAXMSG,30)
-      integer indx(MAXMSG),nsiz(MAXMSG)
-      data ftol/0.02/
-
-C     1      2     3    4    5    6     7     8
-C   nfile  nutc  freq  snr  dt  ipol  flip  sync
-
-      call indexx(kk,sig(1,3),indx)            !Sort list by frequency
-
-      n=1
-      i0=1
-      do i=2,kk         
-         j0=indx(i-1)
-         j=indx(i)
-         if(sig(j,3)-sig(j0,3).gt.ftol) then
-            nsiz(n)=i-i0
-            i0=i
-            n=n+1
-         endif
-      enddo
-      nz=n
-      nsiz(nz)=kk+1-i0
-      nsiz(nz+1)=-1
-
-      return
-      end

Deleted: branches/map65/twkfreq.f
===================================================================
--- branches/map65/twkfreq.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/twkfreq.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,28 +0,0 @@
-      subroutine twkfreq(c4aa,c4bb,n5,a)
-
-      complex c4aa(n5)
-      complex c4bb(n5)
-      real a(5)
-      complex w,wstep
-      data twopi/6.283185307/
-
-C  Apply AFC corrections to the c4aa and c4bb data
-      w=1.0
-      x0=0.5*(n5+1)
-      s=2.0/n5
-      do i=1,n5
-         x=s*(i-x0)
-         if(mod(i,1000).eq.1) then
-            p2=1.5*x*x - 0.5
-!            p3=2.5*(x**3) - 1.5*x
-!            p4=4.375*(x**4) - 3.75*(x**2) + 0.375
-            dphi=(a(1) + x*a(2) + p2*a(3)) * (twopi/1378.125)
-            wstep=cmplx(cos(dphi),sin(dphi))
-         endif
-         w=w*wstep
-         c4aa(i)=w*c4aa(i)
-         c4bb(i)=w*c4bb(i)
-      enddo
-
-      return
-      end

Deleted: branches/map65/unpackcall.f
===================================================================
--- branches/map65/unpackcall.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/unpackcall.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,35 +0,0 @@
-      subroutine unpackcall(ncall,word)
-
-      character word*12,c*37
-
-      data c/'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ '/
-
-      n=ncall
-      word='......'
-      if(n.ge.262177560) go to 999            !Plain text message ...
-      i=mod(n,27)+11
-      word(6:6)=c(i:i)
-      n=n/27
-      i=mod(n,27)+11
-      word(5:5)=c(i:i)
-      n=n/27
-      i=mod(n,27)+11
-      word(4:4)=c(i:i)
-      n=n/27
-      i=mod(n,10)+1
-      word(3:3)=c(i:i)
-      n=n/10
-      i=mod(n,36)+1
-      word(2:2)=c(i:i)
-      n=n/36
-      i=n+1
-      word(1:1)=c(i:i)
-      do i=1,4
-         if(word(i:i).ne.' ') go to 10
-      enddo
-      go to 999
- 10   word=word(i:)
-
- 999  if(word(1:3).eq.'3D0') word='3DA0'//word(4:)
-      return
-      end

Deleted: branches/map65/unpackgrid.f
===================================================================
--- branches/map65/unpackgrid.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/unpackgrid.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,32 +0,0 @@
-      subroutine unpackgrid(ng,grid)
-
-      parameter (NGBASE=180*180)
-      character grid*4,grid6*6
-
-      grid='    '
-      if(ng.ge.32400) go to 10
-      dlat=mod(ng,180)-90
-      dlong=(ng/180)*2 - 180 + 2
-      call deg2grid(dlong,dlat,grid6)
-      grid=grid6
-      go to 100
-
- 10   n=ng-NGBASE-1
-      if(n.ge.1 .and.n.le.30) then
-         write(grid,1012) -n
- 1012    format(i3.2)
-      else if(n.ge.31 .and.n.le.60) then
-         n=n-30
-         write(grid,1022) -n
- 1022    format('R',i3.2)
-      else if(n.eq.61) then
-         grid='RO'
-      else if(n.eq.62) then
-         grid='RRR'
-      else if(n.eq.63) then
-         grid='73'
-      endif
-
- 100  return
-      end
-

Deleted: branches/map65/unpackmsg.f
===================================================================
--- branches/map65/unpackmsg.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/unpackmsg.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,89 +0,0 @@
-      subroutine unpackmsg(dat,msg)
-
-      parameter (NBASE=37*36*10*27*27*27)
-      parameter (NGBASE=180*180)
-      integer dat(12)
-      character c1*12,c2*12,grid*4,msg*22,grid6*6
-      logical cqnnn
-
-      cqnnn=.false.
-      nc1=ishft(dat(1),22) + ishft(dat(2),16) + ishft(dat(3),10)+
-     +  ishft(dat(4),4) + iand(ishft(dat(5),-2),15)
-
-      nc2=ishft(iand(dat(5),3),26) + ishft(dat(6),20) + 
-     +  ishft(dat(7),14) + ishft(dat(8),8) + ishft(dat(9),2) + 
-     +  iand(ishft(dat(10),-4),3)
-
-      ng=ishft(iand(dat(10),15),12) + ishft(dat(11),6) + dat(12)
-
-      if(ng.gt.32768) then
-         call unpacktext(nc1,nc2,ng,msg)
-         go to 100
-      endif
-
-      if(nc1.lt.NBASE) then
-         call unpackcall(nc1,c1)
-      else
-         c1='......'
-         if(nc1.eq.NBASE+1) c1='CQ    '
-         if(nc1.eq.NBASE+2) c1='QRZ   '
-         nfreq=nc1-NBASE-3
-         if(nfreq.ge.0 .and. nfreq.le.999) then
-            write(c1,1002) nfreq
- 1002       format('CQ ',i3.3)
-            cqnnn=.true.
-         endif         
-      endif
-
-      if(nc2.lt.NBASE) then
-         call unpackcall(nc2,c2)
-      else
-         c2='......'
-      endif
-
-      call unpackgrid(ng,grid)
-      grid6=grid//'ma'
-      call grid2k(grid6,k)
-      if(k.ge.1 .and. k.le.450)   call getpfx2(k,c1)
-      if(k.ge.451 .and. k.le.900) call getpfx2(k,c2)
-
-      i=index(c1,char(0))
-      if(i.ge.3) c1=c1(1:i-1)//'            '
-      i=index(c2,char(0))
-      if(i.ge.3) c2=c2(1:i-1)//'            '
-
-      msg='                      '
-      j=0
-      if(cqnnn) then
-         msg=c1//'                '
-         j=7                                  !### ??? ###
-         go to 10
-      endif
-
-      do i=1,12
-         j=j+1
-         msg(j:j)=c1(i:i)
-         if(c1(i:i).eq.' ') go to 10
-      enddo
-      j=j+1
-      msg(j:j)=' '
-
- 10   do i=1,12
-         if(j.le.21) j=j+1
-         msg(j:j)=c2(i:i)
-         if(c2(i:i).eq.' ') go to 20
-      enddo
-      j=j+1
-      msg(j:j)=' '
-
- 20   if(k.eq.0) then
-         do i=1,4
-            if(j.le.21) j=j+1
-            msg(j:j)=grid(i:i)
-         enddo
-         j=j+1
-         msg(j:j)=' '
-      endif
-
- 100  return
-      end

Deleted: branches/map65/unpacktext.f
===================================================================
--- branches/map65/unpacktext.f	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/unpacktext.f	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,35 +0,0 @@
-      subroutine unpacktext(nc1,nc2,nc3,msg)
-
-      character*22 msg
-      character*44 c
-      data c/'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ +-./?'/
-
-      nc3=iand(nc3,32767)                      !Remove the &quot;plain text&quot; bit
-      if(iand(nc1,1).ne.0) nc3=nc3+32768
-      nc1=nc1/2
-      if(iand(nc2,1).ne.0) nc3=nc3+65536
-      nc2=nc2/2
-
-      do i=5,1,-1
-         j=mod(nc1,42)+1
-         msg(i:i)=c(j:j)
-         nc1=nc1/42
-      enddo
-
-      do i=10,6,-1
-         j=mod(nc2,42)+1
-         msg(i:i)=c(j:j)
-         nc2=nc2/42
-      enddo
-
-      do i=13,11,-1
-         j=mod(nc3,42)+1
-         msg(i:i)=c(j:j)
-         nc3=nc3/42
-      enddo
-      msg(14:22) = '         '
-
-      return
-      end
-
-

Added: branches/map65/widegraph.cpp
===================================================================
--- branches/map65/widegraph.cpp	                        (rev 0)
+++ branches/map65/widegraph.cpp	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,318 @@
+#include &quot;widegraph.h&quot;
+#include &quot;ui_widegraph.h&quot;
+
+#define NFFT 32768
+
+WideGraph::WideGraph(QWidget *parent) :
+  QDialog(parent),
+  ui(new Ui::WideGraph)
+{
+  ui-&gt;setupUi(this);
+  this-&gt;setWindowFlags(Qt::Dialog);
+  this-&gt;installEventFilter(parent); //Installing the filter
+  ui-&gt;widePlot-&gt;setCursor(Qt::CrossCursor);
+  this-&gt;setMaximumWidth(2048);
+  this-&gt;setMaximumHeight(880);
+  ui-&gt;widePlot-&gt;setMaximumHeight(800);
+
+  connect(ui-&gt;widePlot, SIGNAL(freezeDecode1(int)),this,
+          SLOT(wideFreezeDecode(int)));
+
+  //Restore user's settings
+  QString inifile(QApplication::applicationDirPath());
+  inifile += &quot;/map65.ini&quot;;
+  QSettings settings(inifile, QSettings::IniFormat);
+
+  settings.beginGroup(&quot;WideGraph&quot;);
+  ui-&gt;widePlot-&gt;setPlotZero(settings.value(&quot;PlotZero&quot;, 20).toInt());
+  ui-&gt;widePlot-&gt;setPlotGain(settings.value(&quot;PlotGain&quot;, 0).toInt());
+  ui-&gt;zeroSpinBox-&gt;setValue(ui-&gt;widePlot-&gt;getPlotZero());
+  ui-&gt;gainSpinBox-&gt;setValue(ui-&gt;widePlot-&gt;getPlotGain());
+  int n = settings.value(&quot;FreqSpan&quot;,60).toInt();
+  int w = settings.value(&quot;PlotWidth&quot;,1000).toInt();
+  ui-&gt;freqSpanSpinBox-&gt;setValue(n);
+  ui-&gt;widePlot-&gt;setNSpan(n);
+  int nbpp = n * 32768.0/(w*96.0) + 0.5;
+  ui-&gt;widePlot-&gt;setBinsPerPixel(nbpp);
+  m_waterfallAvg = settings.value(&quot;WaterfallAvg&quot;,10).toInt();
+  ui-&gt;waterfallAvgSpinBox-&gt;setValue(m_waterfallAvg);
+  ui-&gt;freqOffsetSpinBox-&gt;setValue(settings.value(&quot;FreqOffset&quot;,0).toInt());
+  m_bForceCenterFreq=settings.value(&quot;ForceCenterFreqBool&quot;,false).toBool();
+  m_dForceCenterFreq=settings.value(&quot;ForceCenterFreqMHz&quot;,144.125).toDouble();
+  ui-&gt;cbFcenter-&gt;setChecked(m_bForceCenterFreq);
+  ui-&gt;fCenterLineEdit-&gt;setText(QString::number(m_dForceCenterFreq));
+  settings.endGroup();
+}
+
+
+WideGraph::~WideGraph()
+{
+  saveSettings();
+  delete ui;
+}
+
+void WideGraph::saveSettings()
+{
+  //Save user's settings
+  QString inifile(QApplication::applicationDirPath());
+  inifile += &quot;/map65.ini&quot;;
+  QSettings settings(inifile, QSettings::IniFormat);
+
+  settings.beginGroup(&quot;WideGraph&quot;);
+  settings.setValue(&quot;PlotZero&quot;,ui-&gt;widePlot-&gt;m_plotZero);
+  settings.setValue(&quot;PlotGain&quot;,ui-&gt;widePlot-&gt;m_plotGain);
+  settings.setValue(&quot;PlotWidth&quot;,ui-&gt;widePlot-&gt;plotWidth());
+  settings.setValue(&quot;FreqSpan&quot;,ui-&gt;freqSpanSpinBox-&gt;value());
+  settings.setValue(&quot;WaterfallAvg&quot;,ui-&gt;waterfallAvgSpinBox-&gt;value());
+  settings.setValue(&quot;FreqOffset&quot;,ui-&gt;widePlot-&gt;freqOffset());
+  settings.setValue(&quot;ForceCenterFreqBool&quot;,m_bForceCenterFreq);
+  settings.setValue(&quot;ForceCenterFreqMHz&quot;,m_dForceCenterFreq);
+  settings.endGroup();
+}
+
+void WideGraph::dataSink2(float s[], int nkhz, int ihsym, int ndiskdata,
+                          uchar lstrong[])
+{
+  static float splot[NFFT];
+  float swide[2048];
+  float smax;
+  double df;
+  int nbpp = ui-&gt;widePlot-&gt;binsPerPixel();
+  static int n=0;
+  static int nkhz0=-999;
+  static int n60z=0;
+
+  df = m_fSample/32768.0;
+  if(nkhz != nkhz0) {
+    ui-&gt;widePlot-&gt;setNkhz(nkhz);                   //Why do we need both?
+    ui-&gt;widePlot-&gt;SetCenterFreq(nkhz);             //Why do we need both?
+    ui-&gt;widePlot-&gt;setFQSO(nkhz,true);
+    nkhz0 = nkhz;
+  }
+
+  //Average spectra over specified number, m_waterfallAvg
+  if (n==0) {
+    for (int i=0; i&lt;NFFT; i++)
+      splot[i]=s[i];
+  } else {
+    for (int i=0; i&lt;NFFT; i++)
+      splot[i] += s[i];
+  }
+  n++;
+
+  if (n&gt;=m_waterfallAvg) {
+    for (int i=0; i&lt;NFFT; i++)
+        splot[i] /= n;                       //Normalize the average
+    n=0;
+
+    int w=ui-&gt;widePlot-&gt;plotWidth();
+    qint64 sf = nkhz + ui-&gt;widePlot-&gt;freqOffset() - 0.5*w*nbpp*df/1000.0;
+    if(sf != ui-&gt;widePlot-&gt;startFreq()) ui-&gt;widePlot-&gt;SetStartFreq(sf);
+    int i0=16384.0+(ui-&gt;widePlot-&gt;startFreq()-nkhz+1.27046+0.001*m_fCal) *
+        1000.0/df + 0.5;
+    int i=i0;
+    for (int j=0; j&lt;2048; j++) {
+        smax=0;
+        for (int k=0; k&lt;nbpp; k++) {
+            i++;
+            if(splot[i]&gt;smax) smax=splot[i];
+        }
+        swide[j]=smax;
+        if(lstrong[1 + i/32]!=0) swide[j]=-smax;   //Tag strong signals
+    }
+
+// Time according to this computer
+    qint64 ms = QDateTime::currentMSecsSinceEpoch() % 86400000;
+    int n60 = (ms/1000) % 60;
+
+    if((ndiskdata &amp;&amp; ihsym &lt;= m_waterfallAvg) || (!ndiskdata &amp;&amp; n60&lt;n60z)) {
+      for (int i=0; i&lt;2048; i++) {
+        swide[i] = 1.e30;
+      }
+      for (int i=0; i&lt;32768; i++) {
+        splot[i] = 1.e30;
+      }
+    }
+    n60z=n60;
+    ui-&gt;widePlot-&gt;draw(swide,i0,splot);
+  }
+}
+
+void WideGraph::on_freqOffsetSpinBox_valueChanged(int f)
+{
+  ui-&gt;widePlot-&gt;SetFreqOffset(f);
+}
+
+void WideGraph::on_freqSpanSpinBox_valueChanged(int n)
+{
+  ui-&gt;widePlot-&gt;setNSpan(n);
+  int w = ui-&gt;widePlot-&gt;plotWidth();
+  int nbpp = n * 32768.0/(w*96.0) + 0.5;
+  if(nbpp &lt; 1) nbpp=1;
+  if(w &gt; 0) {
+    ui-&gt;widePlot-&gt;setBinsPerPixel(nbpp);
+  }
+}
+
+void WideGraph::on_waterfallAvgSpinBox_valueChanged(int n)
+{
+  m_waterfallAvg = n;
+}
+
+void WideGraph::on_zeroSpinBox_valueChanged(int value)
+{
+  ui-&gt;widePlot-&gt;setPlotZero(value);
+}
+
+void WideGraph::on_gainSpinBox_valueChanged(int value)
+{
+  ui-&gt;widePlot-&gt;setPlotGain(value);
+}
+
+void WideGraph::keyPressEvent(QKeyEvent *e)
+{  
+  switch(e-&gt;key())
+  {
+  case Qt::Key_F11:
+    emit f11f12(11);
+    break;
+  case Qt::Key_F12:
+    emit f11f12(12);
+    break;
+  default:
+    e-&gt;ignore();
+  }
+}
+
+int WideGraph::QSOfreq()
+{
+  return ui-&gt;widePlot-&gt;fQSO();
+}
+
+int WideGraph::nSpan()
+{
+  return ui-&gt;widePlot-&gt;m_nSpan;
+}
+
+float WideGraph::fSpan()
+{
+  return ui-&gt;widePlot-&gt;m_fSpan;
+}
+
+int WideGraph::nStartFreq()
+{
+  return ui-&gt;widePlot-&gt;startFreq();
+}
+
+void WideGraph::wideFreezeDecode(int n)
+{
+  emit freezeDecode2(n);
+}
+
+void WideGraph::setTol(int n)
+{
+  ui-&gt;widePlot-&gt;m_tol=n;
+  ui-&gt;widePlot-&gt;DrawOverlay();
+  ui-&gt;widePlot-&gt;update();
+}
+
+int WideGraph::Tol()
+{
+  return ui-&gt;widePlot-&gt;m_tol;
+}
+
+void WideGraph::setDF(int n)
+{
+  ui-&gt;widePlot-&gt;m_DF=n;
+  ui-&gt;widePlot-&gt;DrawOverlay();
+  ui-&gt;widePlot-&gt;update();
+}
+
+void WideGraph::setFcal(int n)
+{
+  m_fCal=n;
+  ui-&gt;widePlot-&gt;setFcal(n);
+}
+
+
+int WideGraph::DF()
+{
+  return ui-&gt;widePlot-&gt;m_DF;
+}
+
+void WideGraph::on_autoZeroPushButton_clicked()
+{
+   int nzero=ui-&gt;widePlot-&gt;autoZero();
+   ui-&gt;zeroSpinBox-&gt;setValue(nzero);
+}
+
+void WideGraph::setPalette(QString palette)
+{
+  ui-&gt;widePlot-&gt;setPalette(palette);
+}
+void WideGraph::setFsample(int n)
+{
+  m_fSample=n;
+  ui-&gt;widePlot-&gt;setFsample(n);
+}
+
+void WideGraph::setMode65(int n)
+{
+  m_mode65=n;
+  ui-&gt;widePlot-&gt;setMode65(n);
+}
+
+void WideGraph::on_cbFcenter_stateChanged(int n)
+{
+  m_bForceCenterFreq = (n!=0);
+  if(m_bForceCenterFreq) {
+    ui-&gt;fCenterLineEdit-&gt;setEnabled(true);
+    ui-&gt;pbSetRxHardware-&gt;setEnabled(true);
+  } else {
+    ui-&gt;fCenterLineEdit-&gt;setDisabled(true);
+    ui-&gt;pbSetRxHardware-&gt;setDisabled(true);
+  }
+}
+
+void WideGraph::on_fCenterLineEdit_editingFinished()
+{
+  m_dForceCenterFreq=ui-&gt;fCenterLineEdit-&gt;text().toDouble();
+}
+
+void WideGraph::on_pbSetRxHardware_clicked()
+{
+#ifdef WIN32
+  int iret=set570(m_mult570*(1.0+0.000001*m_cal570)*m_dForceCenterFreq);
+  if(iret != 0) {
+    QMessageBox mb;
+    if(iret==-1) mb.setText(&quot;Failed to open Si570.&quot;);
+    if(iret==-2) mb.setText(&quot;Frequency out of permitted range.&quot;);
+    mb.exec();
+  }
+#endif
+}
+
+void WideGraph::initIQplus()
+{
+#ifdef WIN32
+  int iret=set570(288.0);
+  if(iret != 0) {
+    QMessageBox mb;
+    if(iret==-1) mb.setText(&quot;Failed to open Si570.&quot;);
+    if(iret==-2) mb.setText(&quot;Frequency out of permitted range.&quot;);
+    mb.exec();
+  } else {
+    on_pbSetRxHardware_clicked();
+  }
+#endif
+}
+
+void WideGraph::on_cbSpec2d_toggled(bool b)
+{
+  ui-&gt;widePlot-&gt;set2Dspec(b);
+}
+
+double WideGraph::fGreen()
+{
+  return ui-&gt;widePlot-&gt;fGreen();
+}

Added: branches/map65/widegraph.h
===================================================================
--- branches/map65/widegraph.h	                        (rev 0)
+++ branches/map65/widegraph.h	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,77 @@
+#ifndef WIDEGRAPH_H
+#define WIDEGRAPH_H
+#include &lt;QDialog&gt;
+
+namespace Ui {
+  class WideGraph;
+}
+
+class WideGraph : public QDialog
+{
+  Q_OBJECT
+
+public:
+  explicit WideGraph(QWidget *parent = 0);
+  ~WideGraph();
+
+  bool   m_bForceCenterFreq;
+  qint32 m_mult570;
+  double m_dForceCenterFreq;
+  double m_cal570;
+
+  void   dataSink2(float s[], int nkhz, int ihsym, int ndiskdata,
+                   uchar lstrong[]);
+  int    QSOfreq();
+  int    nSpan();
+  int    nStartFreq();
+  float  fSpan();
+  void   saveSettings();
+  void   setDF(int n);
+  int    DF();
+  int    Tol();
+  void   setTol(int n);
+  void   setFcal(int n);
+  void   setPalette(QString palette);
+  void   setFsample(int n);
+  void   setMode65(int n);
+  double fGreen();
+
+  qint32 m_qsoFreq;
+
+signals:
+  void freezeDecode2(int n);
+  void f11f12(int n);
+
+public slots:
+  void wideFreezeDecode(int n);
+  void initIQplus();
+
+protected:
+  virtual void keyPressEvent( QKeyEvent *e );
+
+private slots:
+  void on_waterfallAvgSpinBox_valueChanged(int arg1);
+  void on_freqSpanSpinBox_valueChanged(int arg1);
+  void on_freqOffsetSpinBox_valueChanged(int arg1);
+  void on_zeroSpinBox_valueChanged(int arg1);
+  void on_gainSpinBox_valueChanged(int arg1);
+  void on_autoZeroPushButton_clicked();
+  void on_cbFcenter_stateChanged(int arg1);
+  void on_fCenterLineEdit_editingFinished();
+  void on_pbSetRxHardware_clicked();
+  void on_cbSpec2d_toggled(bool checked);
+
+private:
+  qint32 m_waterfallAvg;
+  qint32 m_fCal;
+  qint32 m_fSample;
+  qint32 m_mode65;
+
+  Ui::WideGraph *ui;
+};
+
+#ifdef WIN32
+extern int set570(double freq_MHz);
+#endif
+
+#endif // WIDEGRAPH_H

Added: branches/map65/widegraph.ui
===================================================================
--- branches/map65/widegraph.ui	                        (rev 0)
+++ branches/map65/widegraph.ui	2012-05-22 14:28:39 UTC (rev 2461)
@@ -0,0 +1,421 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;class&gt;WideGraph&lt;/class&gt;
+ &lt;widget class=&quot;QDialog&quot; name=&quot;WideGraph&quot;&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;1178&lt;/width&gt;
+    &lt;height&gt;326&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;Dialog&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout_2&quot;&gt;
+   &lt;item&gt;
+    &lt;layout class=&quot;QVBoxLayout&quot; name=&quot;verticalLayout&quot;&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;CPlotter&quot; name=&quot;widePlot&quot;&gt;
+       &lt;property name=&quot;enabled&quot;&gt;
+        &lt;bool&gt;true&lt;/bool&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizePolicy&quot;&gt;
+        &lt;sizepolicy hsizetype=&quot;Expanding&quot; vsizetype=&quot;Expanding&quot;&gt;
+         &lt;horstretch&gt;0&lt;/horstretch&gt;
+         &lt;verstretch&gt;0&lt;/verstretch&gt;
+        &lt;/sizepolicy&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;minimumSize&quot;&gt;
+        &lt;size&gt;
+         &lt;width&gt;400&lt;/width&gt;
+         &lt;height&gt;200&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;frameShape&quot;&gt;
+        &lt;enum&gt;QFrame::StyledPanel&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;frameShadow&quot;&gt;
+        &lt;enum&gt;QFrame::Sunken&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;lineWidth&quot;&gt;
+        &lt;number&gt;1&lt;/number&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;layout class=&quot;QHBoxLayout&quot; name=&quot;horizontalLayout_3&quot;&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer_3&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeType&quot;&gt;
+          &lt;enum&gt;QSizePolicy::Preferred&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;20&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QSpinBox&quot; name=&quot;freqOffsetSpinBox&quot;&gt;
+         &lt;property name=&quot;sizePolicy&quot;&gt;
+          &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+           &lt;horstretch&gt;0&lt;/horstretch&gt;
+           &lt;verstretch&gt;0&lt;/verstretch&gt;
+          &lt;/sizepolicy&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;minimumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;60&lt;/width&gt;
+           &lt;height&gt;0&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;60&lt;/width&gt;
+           &lt;height&gt;16777215&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;suffix&quot;&gt;
+          &lt;string&gt; kHz&lt;/string&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;minimum&quot;&gt;
+          &lt;number&gt;-24&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximum&quot;&gt;
+          &lt;number&gt;24&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;singleStep&quot;&gt;
+          &lt;number&gt;1&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;value&quot;&gt;
+          &lt;number&gt;0&lt;/number&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QLabel&quot; name=&quot;f0Label&quot;&gt;
+         &lt;property name=&quot;minimumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;50&lt;/width&gt;
+           &lt;height&gt;0&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;Freq Offset&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer_4&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeType&quot;&gt;
+          &lt;enum&gt;QSizePolicy::Preferred&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;20&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QSpinBox&quot; name=&quot;freqSpanSpinBox&quot;&gt;
+         &lt;property name=&quot;sizePolicy&quot;&gt;
+          &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+           &lt;horstretch&gt;0&lt;/horstretch&gt;
+           &lt;verstretch&gt;0&lt;/verstretch&gt;
+          &lt;/sizepolicy&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;minimumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;60&lt;/width&gt;
+           &lt;height&gt;0&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;60&lt;/width&gt;
+           &lt;height&gt;16777215&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;suffix&quot;&gt;
+          &lt;string&gt; kHz&lt;/string&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;minimum&quot;&gt;
+          &lt;number&gt;5&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximum&quot;&gt;
+          &lt;number&gt;90&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;singleStep&quot;&gt;
+          &lt;number&gt;5&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;value&quot;&gt;
+          &lt;number&gt;60&lt;/number&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QLabel&quot; name=&quot;label_3&quot;&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;Freq Span&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer_6&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeType&quot;&gt;
+          &lt;enum&gt;QSizePolicy::Preferred&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;20&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QSpinBox&quot; name=&quot;waterfallAvgSpinBox&quot;&gt;
+         &lt;property name=&quot;sizePolicy&quot;&gt;
+          &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+           &lt;horstretch&gt;0&lt;/horstretch&gt;
+           &lt;verstretch&gt;0&lt;/verstretch&gt;
+          &lt;/sizepolicy&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;minimumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;0&lt;/width&gt;
+           &lt;height&gt;0&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;40&lt;/width&gt;
+           &lt;height&gt;16777215&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;minimum&quot;&gt;
+          &lt;number&gt;1&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximum&quot;&gt;
+          &lt;number&gt;20&lt;/number&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QLabel&quot; name=&quot;label_2&quot;&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;N Avg&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer_2&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeType&quot;&gt;
+          &lt;enum&gt;QSizePolicy::Preferred&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;20&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QSpinBox&quot; name=&quot;gainSpinBox&quot;&gt;
+         &lt;property name=&quot;maximumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;40&lt;/width&gt;
+           &lt;height&gt;16777215&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;minimum&quot;&gt;
+          &lt;number&gt;-20&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximum&quot;&gt;
+          &lt;number&gt;20&lt;/number&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QLabel&quot; name=&quot;label_4&quot;&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;Gain&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer_7&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeType&quot;&gt;
+          &lt;enum&gt;QSizePolicy::Preferred&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;20&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QSpinBox&quot; name=&quot;zeroSpinBox&quot;&gt;
+         &lt;property name=&quot;maximumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;40&lt;/width&gt;
+           &lt;height&gt;16777215&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;minimum&quot;&gt;
+          &lt;number&gt;-100&lt;/number&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximum&quot;&gt;
+          &lt;number&gt;100&lt;/number&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot;&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;Zero&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeType&quot;&gt;
+          &lt;enum&gt;QSizePolicy::Preferred&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;20&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QPushButton&quot; name=&quot;autoZeroPushButton&quot;&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;Auto Zero&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer_8&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeType&quot;&gt;
+          &lt;enum&gt;QSizePolicy::Preferred&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;20&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbSpec2d&quot;&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;2D Spectrum&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;spacer name=&quot;horizontalSpacer_5&quot;&gt;
+         &lt;property name=&quot;orientation&quot;&gt;
+          &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeType&quot;&gt;
+          &lt;enum&gt;QSizePolicy::Expanding&lt;/enum&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;20&lt;/width&gt;
+           &lt;height&gt;20&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+        &lt;/spacer&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbFcenter&quot;&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;Force Center Freq (MHz)&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QLineEdit&quot; name=&quot;fCenterLineEdit&quot;&gt;
+         &lt;property name=&quot;enabled&quot;&gt;
+          &lt;bool&gt;false&lt;/bool&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;sizePolicy&quot;&gt;
+          &lt;sizepolicy hsizetype=&quot;Fixed&quot; vsizetype=&quot;Fixed&quot;&gt;
+           &lt;horstretch&gt;0&lt;/horstretch&gt;
+           &lt;verstretch&gt;0&lt;/verstretch&gt;
+          &lt;/sizepolicy&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;maximumSize&quot;&gt;
+          &lt;size&gt;
+           &lt;width&gt;65&lt;/width&gt;
+           &lt;height&gt;16777215&lt;/height&gt;
+          &lt;/size&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;1296.065&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+       &lt;item&gt;
+        &lt;widget class=&quot;QPushButton&quot; name=&quot;pbSetRxHardware&quot;&gt;
+         &lt;property name=&quot;enabled&quot;&gt;
+          &lt;bool&gt;false&lt;/bool&gt;
+         &lt;/property&gt;
+         &lt;property name=&quot;text&quot;&gt;
+          &lt;string&gt;Set Rx Freq&lt;/string&gt;
+         &lt;/property&gt;
+        &lt;/widget&gt;
+       &lt;/item&gt;
+      &lt;/layout&gt;
+     &lt;/item&gt;
+    &lt;/layout&gt;
+   &lt;/item&gt;
+  &lt;/layout&gt;
+ &lt;/widget&gt;
+ &lt;customwidgets&gt;
+  &lt;customwidget&gt;
+   &lt;class&gt;CPlotter&lt;/class&gt;
+   &lt;extends&gt;QFrame&lt;/extends&gt;
+   &lt;header&gt;plotter.h&lt;/header&gt;
+   &lt;container&gt;1&lt;/container&gt;
+  &lt;/customwidget&gt;
+ &lt;/customwidgets&gt;
+ &lt;resources/&gt;
+ &lt;connections/&gt;
+&lt;/ui&gt;

Deleted: branches/map65/wrapkarn.c
===================================================================
--- branches/map65/wrapkarn.c	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/wrapkarn.c	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,83 +0,0 @@
-#include &lt;math.h&gt;
-#include &lt;stdio.h&gt;
-#include &lt;float.h&gt;
-#include &lt;limits.h&gt;
-#include &lt;stdlib.h&gt;
-#include &quot;rs.h&quot;
-
-void *rs;
-static int first=1;
-
-#ifdef CVF
-void __stdcall RS_ENCODE(int *dgen, int *sent)
-#else
-void rs_encode_(int *dgen, int *sent)
-#endif
-
-     // Encode JT65 data dgen[12], producing sent[63].
-{
-  int dat1[12];
-  int b[51];
-  int i;
-
-  if(first) {
-    // Initialize the JT65 codec
-    rs=init_rs_int(6,0x43,3,1,51,0);
-    first=0;
-  }
-
-  // Reverse data order for the Karn codec.
-  for(i=0; i&lt;12; i++) {
-    dat1[i]=dgen[11-i];
-  }
-  // Compute the parity symbols
-  encode_rs_int(rs,dat1,b);
-
-  // Move parity symbols and data into sent[] array, in reverse order.
-  for (i = 0; i &lt; 51; i++) sent[50-i] = b[i];
-  for (i = 0; i &lt; 12; i++) sent[i+51] = dat1[11-i];
-}
-
-#ifdef CVF
-void __stdcall RS_DECODE(int *recd0, int *era0, int *numera0, int *decoded, int *nerr)
-#else
-void rs_decode_(int *recd0, int *era0, int *numera0, int *decoded, int *nerr)
-#endif
-
-     // Decode JT65 received data recd0[63], producing decoded[12].
-     // Erasures are indicated in era0[numera].  The number of corrected
-     // errors is *nerr.  If the data are uncorrectable, *nerr=-1 is
-     // returned.
-{
-  int numera;
-  int i;
-  int era_pos[50];
-  int recd[63];
-
-  if(first) {
-    rs=init_rs_int(6,0x43,3,1,51,0);
-    first=0;
-  }
-
-  numera=*numera0;
-  for(i=0; i&lt;12; i++) recd[i]=recd0[62-i];
-  for(i=0; i&lt;51; i++) recd[12+i]=recd0[50-i];
-  if(numera) 
-    for(i=0; i&lt;numera; i++) era_pos[i]=era0[i];
-  *nerr=decode_rs_int(rs,recd,era_pos,numera);
-  for(i=0; i&lt;12; i++) decoded[i]=recd[11-i];
-}
-
-
-#ifndef CVF
-void rs_encode__(int *dgen, int *sent)
-{
-	rs_encode_(dgen, sent);
-}
-
-void rs_decode__(int *recd0, int *era0, int *numera0, int *decoded, int *nerr)
-{
-	rs_decode_(recd0, era0, numera0, decoded, nerr);
-}
-#endif
-

Deleted: branches/map65/wsjt
===================================================================
--- branches/map65/wsjt	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/wsjt	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,15 +0,0 @@
-#!/bin/sh
-if [ -e /usr/local/bin/python ] ; then
-	LOCALBASE=/usr/local/
-else
-	LOCALBASE=/usr/
-fi
-if [ ! -e ~/.wsjt ] ; then
-	mkdir ~/.wsjt
-	mkdir ~/.wsjt/RxWav
-fi
-if [ ! -e ~/.wsjt/CALL3.TXT ] ; then
-	cp -f ${LOCALBASE}/share/wsjt/CALL3.TXT ~/.wsjt
-fi
-cd ~/.wsjt
-python ${LOCALBASE}/bin/wsjt.py

Deleted: branches/map65/wsjt.ico
===================================================================
(Binary files differ)

Added: branches/map65/wsjt.ico
===================================================================
(Binary files differ)


Property changes on: branches/map65/wsjt.ico
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Deleted: branches/map65/wsjtgen.f90
===================================================================
--- branches/map65/wsjtgen.f90	2012-05-21 16:36:30 UTC (rev 2460)
+++ branches/map65/wsjtgen.f90	2012-05-22 14:28:39 UTC (rev 2461)
@@ -1,131 +0,0 @@
-subroutine wsjtgen
-
-! Compute the waveform to be transmitted.  
-
-! Input:    txmsg        message to be transmitted, up to 28 characters
-!           samfacout    fsample_out/11025.d0
-
-! Output:   iwave        waveform data, i*2 format
-!           nwave        number of samples
-!           sendingsh    0=normal; 1=shorthand (FSK441) or plain text (JT65)
-
-  parameter (NMSGMAX=28)             !Max characters per message
-  parameter (NSPD=25)                !Samples per dit
-  parameter (NDPC=3)                 !Dits per character
-  parameter (NWMAX=661500)           !Max length of waveform = 60*11025
-  parameter (NTONES=4)               !Number of FSK tones
-  character msg*28,msgsent*22,idmsg*22
-  real*8 freq,dpha,twopi
-  character testfile*27
-  logical lcwid
-  integer*2 icwid(110250),jwave(NWMAX)
-
-  integer*1 hdr(44)
-  integer*2 nfmt2,nchan2,nbitsam2,nbytesam2
-  character*4 ariff,awave,afmt,adata
-  common/hdr/ariff,lenfile,awave,afmt,lenfmt,nfmt2,nchan2, &amp;
-     nsamrate,nbytesec,nbytesam2,nbitsam2,adata,ndata,jwave
-  equivalence (ariff,hdr)
-
-  data twopi/6.28318530718d0/
-  include 'gcom1.f90'
-  include 'gcom2.f90'
-
-  fsample_out=11025.d0*samfacout
-  lcwid=.false.
-  if(idinterval.gt.0) then
-     n=(mod(int(tsec/60.d0),idinterval))
-     if(n.eq.(1-txfirst)) lcwid=.true.
-     if(idinterval.eq.1) lcwid=.true.
-  endif
-
-  msg=txmsg
-  call msgtrim(msg,nmsg)
-  txmsg=msg
-  ntxnow=ntxreq
-  nmsg0=nmsg
-
-  if(msg(1:1).eq.'@') then
-     if(msg(2:2).eq.'/' .or. ichar(msg(2:2)).eq.92) then
-        txmsg=msg
-        testfile=msg(2:)
-#ifdef CVF
-        open(18,file=testfile,form='binary',status='old',err=12)
-#else
-        open(18,file=testfile,access='stream',status='old',err=12)
-#endif
-        go to 14
-12      print*,'Cannot open test file ',msg(2:)
-        go to 999
-14      call cs_lock('wsjtgena')
-        read(18) hdr
-        if(ndata.gt.NTxMax) ndata=NTxMax
-        call rfile(18,iwave,ndata,ierr)
-        close(18)
-        call cs_unlock
-        if(ierr.ne.0) print*,'Error reading test file ',msg(2:)
-        nwave=ndata/2
-        do i=nwave,NTXMAX
-           iwave(i)=0
-        enddo
-	sending=txmsg
-	sendingsh=2
-        go to 999
-     endif
-
-! Transmit a fixed tone at specified frequency
-     freq=1000.0
-     if(msg(2:2).eq.'A' .or. msg(2:2).eq.'a') freq=882
-     if(msg(2:2).eq.'B' .or. msg(2:2).eq.'b') freq=1323
-     if(msg(2:2).eq.'C' .or. msg(2:2).eq.'c') freq=1764
-     if(msg(2:2).eq.'D' .or. msg(2:2).eq.'d') freq=2205
-     if(freq.eq.1000.0) then
-        call cs_lock('wsjtgenb')
-        read(msg(2:),*,err=1) freq
-        goto 2
-1       txmsg='@1000'
-        nmsg=5
-        nmsg0=5
-2       call cs_unlock
-     endif
-     nwave=60*fsample_out
-     dpha=twopi*freq/fsample_out
-     do i=1,nwave
-        iwave(i)=32767.0*sin(i*dpha)
-     enddo
-     goto 900
-  endif
-
-!  We're in JT65 mode.
-  if(mode(5:5).eq.'A') mode65=1
-  if(mode(5:5).eq.'B') mode65=2
-  if(mode(5:5).eq.'C') mode65=4
-  call cs_lock('wsjtgenc')
-  call gen65(msg,mode65,samfacout,iwave,nwave,sendingsh,msgsent)
-  call cs_unlock
-
-  if(lcwid) then
-!  Generate and insert the CW ID.
-     wpm=25.
-     freqcw=800.
-     idmsg=MyCall//'          '
-     call gencwid(idmsg,wpm,freqcw,samfacout,icwid,ncwid)
-     k=nwave
-     do i=1,ncwid
-        k=k+1
-        iwave(k)=icwid(i)
-     enddo
-     do i=1,2205                   !Add 0.2 s of silence
-        k=k+1
-        iwave(k)=0
-     enddo
-     nwave=k
-  endif
-
-900 sending=txmsg
-  if(sendingsh.ne.1) sending=msgsent
-  nmsg=nmsg0
-
-999  return
-end subroutine wsjtgen
-

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002152.html">[WSJT-SVN] r2460 - branches/wspr
</A></li>
	<LI>Next message: <A HREF="002153.html">[WSJT-SVN] r2462 - in branches/map65: . libm65
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2154">[ date ]</a>
              <a href="thread.html#2154">[ thread ]</a>
              <a href="subject.html#2154">[ subject ]</a>
              <a href="author.html#2154">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/wsjt-svn">More information about the wsjt-svn
mailing list</a><br>
</body></html>
