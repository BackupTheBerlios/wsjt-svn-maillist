<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [WSJT-SVN] r843 - trunk
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/wsjt-svn/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r843%20-%20trunk&In-Reply-To=%3C200806061604.m56G4mhC025327%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000530.html">
   <LINK REL="Next"  HREF="000532.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[WSJT-SVN] r843 - trunk</H1>
    <B>va3db at BerliOS</B> 
    <A HREF="mailto:wsjt-svn%40lists.berlios.de?Subject=Re%3A%20%5BWSJT-SVN%5D%20r843%20-%20trunk&In-Reply-To=%3C200806061604.m56G4mhC025327%40sheep.berlios.de%3E"
       TITLE="[WSJT-SVN] r843 - trunk">va3db at mail.berlios.de
       </A><BR>
    <I>Fri Jun  6 18:04:48 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000530.html">[WSJT-SVN] r842 - trunk
</A></li>
        <LI>Next message: <A HREF="000532.html">[WSJT-SVN] r844 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#531">[ date ]</a>
              <a href="thread.html#531">[ thread ]</a>
              <a href="subject.html#531">[ subject ]</a>
              <a href="author.html#531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: va3db
Date: 2008-06-06 18:04:48 +0200 (Fri, 06 Jun 2008)
New Revision: 843

Modified:
   trunk/Makefile.in
   trunk/configure
   trunk/configure.ac
Log:
- fix configure and Makefile to recognise fftw3 lib and add it to the link



Modified: trunk/Makefile.in
===================================================================
--- trunk/Makefile.in	2008-06-05 22:54:22 UTC (rev 842)
+++ trunk/Makefile.in	2008-06-06 16:04:48 UTC (rev 843)
@@ -5,7 +5,6 @@
 #
 # XXX N.B. this is non standard
 #
-LIBS	= ./libfftw3single.a
 LIBS	+= @LIBS@
 CPPFLAGS = @CPPFLAGS@
 CFLAGS	= @CFLAGS@

Modified: trunk/configure
===================================================================
--- trunk/configure	2008-06-05 22:54:22 UTC (rev 842)
+++ trunk/configure	2008-06-06 16:04:48 UTC (rev 843)
@@ -2,7 +2,7 @@
 # Guess values for system-dependent variables and create Makefiles.
 # Generated by GNU Autoconf 2.62 for wsjt 5.9.6.
 #
-# $Id: configure.ac 841 2008-06-05 21:57:06Z va3db $
+# $Id: configure.ac 842 2008-06-05 22:54:22Z va3db $
 #
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 # 2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
@@ -1451,7 +1451,7 @@
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 
-$Id: configure.ac 841 2008-06-05 21:57:06Z va3db $
+$Id: configure.ac 842 2008-06-05 22:54:22Z va3db $
 _ACEOF
   exit
 fi
@@ -3041,7 +3041,7 @@
 
 CPPFLAGS=&quot;-I/usr/local/include ${CPPFLAGS}&quot;
 LDFLAGS=&quot;-L/usr/local/lib ${LDFLAGS}&quot;
-LIBS=&quot; -lpthread -lfftw3f ${LIBS}&quot;
+LIBS=&quot; -lpthread ${LIBS}&quot;
 FCV=&quot;&quot;
 
 { $as_echo &quot;$as_me:$LINENO: checking uname -s for Cygwin, Solaris or HPUX&quot; &gt;&amp;5
@@ -4843,6 +4843,141 @@
 fi
 
 
+if test &quot;${ac_cv_header_fftw3_h+set}&quot; = set; then
+  { $as_echo &quot;$as_me:$LINENO: checking for fftw3.h&quot; &gt;&amp;5
+$as_echo_n &quot;checking for fftw3.h... &quot; &gt;&amp;6; }
+if test &quot;${ac_cv_header_fftw3_h+set}&quot; = set; then
+  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
+fi
+{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_fftw3_h&quot; &gt;&amp;5
+$as_echo &quot;$ac_cv_header_fftw3_h&quot; &gt;&amp;6; }
+else
+  # Is the header compilable?
+{ $as_echo &quot;$as_me:$LINENO: checking fftw3.h usability&quot; &gt;&amp;5
+$as_echo_n &quot;checking fftw3.h usability... &quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include &lt;fftw3.h&gt;
+_ACEOF
+rm -f conftest.$ac_objext
+if { (ac_try=&quot;$ac_compile&quot;
+case &quot;(($ac_try&quot; in
+  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
+$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
+  (eval &quot;$ac_compile&quot;) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &amp;&amp; {
+	 test -z &quot;$ac_c_werror_flag&quot; ||
+	 test ! -s conftest.err
+       } &amp;&amp; test -s conftest.$ac_objext; then
+  ac_header_compiler=yes
+else
+  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+	ac_header_compiler=no
+fi
+
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+$as_echo &quot;$ac_header_compiler&quot; &gt;&amp;6; }
+
+# Is the header present?
+{ $as_echo &quot;$as_me:$LINENO: checking fftw3.h presence&quot; &gt;&amp;5
+$as_echo_n &quot;checking fftw3.h presence... &quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+#include &lt;fftw3.h&gt;
+_ACEOF
+if { (ac_try=&quot;$ac_cpp conftest.$ac_ext&quot;
+case &quot;(($ac_try&quot; in
+  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
+$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
+  (eval &quot;$ac_cpp conftest.$ac_ext&quot;) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &gt;/dev/null &amp;&amp; {
+	 test -z &quot;$ac_c_preproc_warn_flag$ac_c_werror_flag&quot; ||
+	 test ! -s conftest.err
+       }; then
+  ac_header_preproc=yes
+else
+  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+  ac_header_preproc=no
+fi
+
+rm -f conftest.err conftest.$ac_ext
+{ $as_echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+$as_echo &quot;$ac_header_preproc&quot; &gt;&amp;6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+$as_echo &quot;$as_me: WARNING: fftw3.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: proceeding with the compiler's result&quot; &gt;&amp;5
+$as_echo &quot;$as_me: WARNING: fftw3.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: present but cannot be compiled&quot; &gt;&amp;5
+$as_echo &quot;$as_me: WARNING: fftw3.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+$as_echo &quot;$as_me: WARNING: fftw3.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: see the Autoconf documentation&quot; &gt;&amp;5
+$as_echo &quot;$as_me: WARNING: fftw3.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+$as_echo &quot;$as_me: WARNING: fftw3.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+$as_echo &quot;$as_me: WARNING: fftw3.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { $as_echo &quot;$as_me:$LINENO: WARNING: fftw3.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+$as_echo &quot;$as_me: WARNING: fftw3.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
+    ;;
+esac
+{ $as_echo &quot;$as_me:$LINENO: checking for fftw3.h&quot; &gt;&amp;5
+$as_echo_n &quot;checking for fftw3.h... &quot; &gt;&amp;6; }
+if test &quot;${ac_cv_header_fftw3_h+set}&quot; = set; then
+  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
+else
+  ac_cv_header_fftw3_h=$ac_header_preproc
+fi
+{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_header_fftw3_h&quot; &gt;&amp;5
+$as_echo &quot;$ac_cv_header_fftw3_h&quot; &gt;&amp;6; }
+
+fi
+if test $ac_cv_header_fftw3_h = yes; then
+  HAS_FFTW3_H=1
+else
+  HAS_FFTW3_H=0
+fi
+
+
+
 if test &quot;${ac_cv_header_samplerate_h+set}&quot; = set; then
   { $as_echo &quot;$as_me:$LINENO: checking for samplerate.h&quot; &gt;&amp;5
 $as_echo_n &quot;checking for samplerate.h... &quot; &gt;&amp;6; }
@@ -5173,7 +5308,78 @@
   ASOUNDLIBS=&quot;&quot;
 fi
 
+{ $as_echo &quot;$as_me:$LINENO: checking for fftwf_mkplan in -lfftw3f&quot; &gt;&amp;5
+$as_echo_n &quot;checking for fftwf_mkplan in -lfftw3f... &quot; &gt;&amp;6; }
+if test &quot;${ac_cv_lib_fftw3f_fftwf_mkplan+set}&quot; = set; then
+  $as_echo_n &quot;(cached) &quot; &gt;&amp;6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS=&quot;-lfftw3f  $LIBS&quot;
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern &quot;C&quot;
+#endif
+char fftwf_mkplan ();
+int
+main ()
+{
+return fftwf_mkplan ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (ac_try=&quot;$ac_link&quot;
+case &quot;(($ac_try&quot; in
+  *\&quot;* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo=&quot;\&quot;\$as_me:$LINENO: $ac_try_echo\&quot;&quot;
+$as_echo &quot;$ac_try_echo&quot;) &gt;&amp;5
+  (eval &quot;$ac_link&quot;) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  $as_echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &amp;&amp; {
+	 test -z &quot;$ac_c_werror_flag&quot; ||
+	 test ! -s conftest.err
+       } &amp;&amp; test -s conftest$ac_exeext &amp;&amp; {
+	 test &quot;$cross_compiling&quot; = yes ||
+	 $as_test_x conftest$ac_exeext
+       }; then
+  ac_cv_lib_fftw3f_fftwf_mkplan=yes
+else
+  $as_echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+	ac_cv_lib_fftw3f_fftwf_mkplan=no
+fi
+
+rm -rf conftest.dSYM
+rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
+      conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo &quot;$as_me:$LINENO: result: $ac_cv_lib_fftw3f_fftwf_mkplan&quot; &gt;&amp;5
+$as_echo &quot;$ac_cv_lib_fftw3f_fftwf_mkplan&quot; &gt;&amp;6; }
+if test $ac_cv_lib_fftw3f_fftwf_mkplan = yes; then
+  FFTW3LIBS=&quot;-lfftw3f&quot;
+else
+  FFTW3LIBS=&quot;&quot;
+fi
+
+
 # The cast to long int works around a bug in the HP C Compiler
 # version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
 # declarations like `int a3[[(sizeof (unsigned char)) &gt;= 0]];'.
@@ -7386,8 +7592,19 @@
 $as_echo &quot;$as_me: error: You need to install an usable portaudio v19; see README&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; }
 fi
+if test $HAS_FFTW3_H -eq 0; then
+	{ { $as_echo &quot;$as_me:$LINENO: error: You need to install the fftw3 libraries&quot; &gt;&amp;5
+$as_echo &quot;$as_me: error: You need to install the fftw3 libraries&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; }
+fi
+if test $HAS_SAMPLERATE_H -eq 0; then
+	{ { $as_echo &quot;$as_me:$LINENO: error: You need to install the samplerate library&quot; &gt;&amp;5
+$as_echo &quot;$as_me: error: You need to install the samplerate library&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; }
+fi
 
 
+
 if test $HAS_PORTAUDIO_H -eq 1; then
 	cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
 #define HAS_PORTAUDIO_H 1
@@ -7395,7 +7612,7 @@
 
 	LDFLAGS=&quot;-L${portaudio_lib_dir} ${LDFLAGS}&quot;
 	LIBS=&quot;${LIBS} -lportaudio&quot;
-	CPPFLAGS=&quot;-I${portaudio_include_dir} $(CPPFLAGS)&quot;
+	CPPFLAGS=&quot;-I${portaudio_include_dir} ${CPPFLAGS}&quot;
 fi
 
 if test $HAS_SAMPLERATE_H -eq 1; then
@@ -7406,6 +7623,14 @@
 	LIBS=&quot;${LIBS} -lsamplerate&quot;
 fi
 
+if test $HAS_FFTW3_H -eq 1; then
+	cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
+#define HAS_FFTW3_H 1
+_ACEOF
+
+	LIBS=&quot;${LIBS} -lfftw3f&quot;
+fi
+
 if test &quot;$F2PY&quot; = &quot;&quot;; then
 	{ { $as_echo &quot;$as_me:$LINENO: error: You are missing f2py&quot; &gt;&amp;5
 $as_echo &quot;$as_me: error: You are missing f2py&quot; &gt;&amp;2;}

Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2008-06-05 22:54:22 UTC (rev 842)
+++ trunk/configure.ac	2008-06-06 16:04:48 UTC (rev 843)
@@ -22,8 +22,7 @@
 dnl Lets guess at some likely places for extra libs/includes XXX -db
 CPPFLAGS=&quot;-I/usr/local/include ${CPPFLAGS}&quot;
 LDFLAGS=&quot;-L/usr/local/lib ${LDFLAGS}&quot;
-dnl XXX check for fftw3 in configure!
-LIBS=&quot; -lpthread -lfftw3f ${LIBS}&quot;
+LIBS=&quot; -lpthread ${LIBS}&quot;
 FCV=&quot;&quot;
 
 AC_MSG_CHECKING([uname -s for Cygwin, Solaris or HPUX])
@@ -107,6 +106,8 @@
 
 AC_HEADER_TIME
 
+AC_CHECK_HEADER([fftw3.h], [HAS_FFTW3_H=1], [HAS_FFTW3_H=0])
+
 AC_CHECK_HEADER([samplerate.h], [HAS_SAMPLERATE_H=1], [HAS_SAMPLERATE_H=0])
 HAS_PORTAUDIO_H=0
 HAS_PORTAUDIO_LIB=0
@@ -129,6 +130,7 @@
 
 AC_CHECK_LIB(rt, clock_gettime, [RTLIBS=&quot;-lrt&quot;], [RTLIBS=&quot;&quot;])
 AC_CHECK_LIB(asound, snd_pcm_open, [ASOUNDLIBS=&quot;-lasound&quot;], [ASOUNDLIBS=&quot;&quot;])
+AC_CHECK_LIB(fftw3f, fftwf_mkplan, [FFTW3LIBS=&quot;-lfftw3f&quot;], [FFTW3LIBS=&quot;&quot;])
 
 AC_CHECK_SIZEOF(int64_t)
 AC_CHECK_SIZEOF(long long)
@@ -310,6 +312,13 @@
 if test $HAS_PORTAUDIO -eq 0; then
 	AC_MSG_ERROR([You need to install an usable portaudio v19; see README])
 fi
+if test $HAS_FFTW3_H -eq 0; then
+	AC_MSG_ERROR([You need to install the fftw3 libraries])
+fi
+if test $HAS_SAMPLERATE_H -eq 0; then
+	AC_MSG_ERROR([You need to install the samplerate library])
+fi
+
 dnl =====================
 
 dnl set conf flags
@@ -319,7 +328,7 @@
 	AC_DEFINE(HAS_PORTAUDIO_H, 1, )
 	LDFLAGS=&quot;-L${portaudio_lib_dir} ${LDFLAGS}&quot;
 	LIBS=&quot;${LIBS} -lportaudio&quot;
-	CPPFLAGS=&quot;-I${portaudio_include_dir} $(CPPFLAGS)&quot;
+	CPPFLAGS=&quot;-I${portaudio_include_dir} ${CPPFLAGS}&quot;
 fi
 
 if test $HAS_SAMPLERATE_H -eq 1; then
@@ -327,6 +336,11 @@
 	LIBS=&quot;${LIBS} -lsamplerate&quot;
 fi
 
+if test $HAS_FFTW3_H -eq 1; then
+	AC_DEFINE(HAS_FFTW3_H, 1, )
+	LIBS=&quot;${LIBS} -lfftw3f&quot;
+fi
+
 if test &quot;$F2PY&quot; = &quot;&quot;; then
 	AC_MSG_ERROR([You are missing f2py])
 fi


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000530.html">[WSJT-SVN] r842 - trunk
</A></li>
	<LI>Next message: <A HREF="000532.html">[WSJT-SVN] r844 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#531">[ date ]</a>
              <a href="thread.html#531">[ thread ]</a>
              <a href="subject.html#531">[ subject ]</a>
              <a href="author.html#531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/wsjt-svn">More information about the wsjt-svn
mailing list</a><br>
</body></html>
